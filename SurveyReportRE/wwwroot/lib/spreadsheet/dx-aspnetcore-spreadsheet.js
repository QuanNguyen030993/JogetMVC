/**
* DevExpress AspNetCore Spreadsheet (dx-aspnetcore-spreadsheet.js)
* Version: 19.1.2
* Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED
* License: https://www.devexpress.com/Support/EULAs/NetComponents.xml
*/
/*# namespace DevExpress.Web.Scripts #*/

var ASPx = ASPx || {};
var dx = dx || {};

(function module(ASPx, dx) {
ASPx.modules = { Utils: module };
/*# public class JavaScriptObject : object #*/
    
if(!ASPx.attachToReady)
    ASPx.attachToReady = function (callback) { ASPx.Evt.AttachEventToElement(window, "load", callback); };
if(!ASPx.attachToLoad)
    ASPx.attachToLoad = function(callback) { ASPx.Evt.AttachEventToDocumentCore("DOMContentLoaded", callback); };
ASPx.EmptyObject = { };
ASPx.FalseFunction = function() { return false; };

ASPx.SSLSecureBlankUrl = '<%=WebResource("custom:SSLSecureBlankUrl")%>';
ASPx.EmptyImageUrl = '<%=WebResource("custom:EmptyImageUrl")%>';

ASPx.VersionInfo = '<%=WebResource("custom:VersionInfo")%>';
ASPx.Platform = '<%=WebResource("custom:Platform")%>';

ASPx.InvalidDimension = -10000;
ASPx.InvalidPosition = -10000;
ASPx.AbsoluteLeftPosition = -10000;
ASPx.EmptyGuid = "00000000-0000-0000-0000-000000000000";

ASPx.CallbackSeparator = ":";
ASPx.ItemIndexSeparator = "i";
ASPx.CallbackResultPrefix = "/*DX*/";
ASPx.StyleValueEncodedSemicolon = "DXsmcln";
ASPx.AccessibilityEmptyUrl = "javascript:;";
ASPx.AccessibilityPronounceTimeout = 500;

ASPx.MaxMobileWindowWidth = 576;

ASPx.PossibleNumberDecimalSeparators = [",", "."];

ASPx.CultureInfo = {
    twoDigitYearMax: 2029,
    ts: ":",
    ds: "/",
    am: "AM",
    pm: "PM",
	monthNames: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December", ""],
	genMonthNames: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December", ""],
	abbrMonthNames: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec", ""],
	abbrDayNames: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
	dayNames: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
	
	invariantCultureDecimalPoint: ".",

    numDecimalPoint: ".",
	numPrec: 2,
	numGroupSeparator: ",",	
	numGroups: [ 3 ],
	numNegPattern: 1,
	
	numPosInf: "Infinity",	
	numNegInf: "-Infinity", 
	numNan: "NaN",
	
	currency: "$",
	
	currDecimalPoint: ".",
	currPrec: 2,
	currGroupSeparator: ",",
	currGroups: [ 3 ],
	currPosPattern: 0,
	currNegPattern: 0,
	
	percentPattern: 0,

	shortTime: "h:mm tt",
	longTime: "h:mm:ss tt",
	shortDate: "M/d/yyyy",
	longDate: "dddd, MMMM d, yyyy",
	monthDay: "MMMM d",
	yearMonth: "MMMM yyyy"
};
ASPx.CultureInfo.genMonthNames = ASPx.CultureInfo.monthNames;

ASPx.Position = {
    Left: "Left",
    Right: "Right",
    Top: "Top",
    Bottom: "Bottom"
};

function setInnerHtmlInternal(el, trustedHtmlString) { 
    el.innerHTML = trustedHtmlString;
}

var DateUtils = { };
DateUtils.GetInvariantDateString = function(date) {
    if(!date)
        return "01/01/0001";
    var day = date.getDate();
    var month = date.getMonth() + 1;
    var year = date.getFullYear();
    var result = "";
    if(month < 10)
        result += "0";
    result += month.toString() + "/";
    if(day < 10)
        result += "0";
    result += day.toString() + "/";
    if(year < 1000)
        result += "0";
    result += year.toString();
    return result;
};
DateUtils.GetInvariantDateTimeString = function(date) {
    var dateTimeString = DateUtils.GetInvariantDateString(date);
    
    var time = {
        h: date.getHours(),
        m: date.getMinutes(),
        s: date.getSeconds()
    };
    for(var key in time) {
        if(time.hasOwnProperty(key)) {
            var str = time[key].toString();
            if(str.length < 2)
                str = "0" + str;
            time[key] = str;
        }
    }
    dateTimeString += " " + time.h + ":" + time.m + ":" + time.s;
    
    var msec = date.getMilliseconds();
    if(msec > 0)
        dateTimeString += "." + ("000" + msec.toString()).substr(-3);

    return dateTimeString;
};
DateUtils.ExpandTwoDigitYear = function(value) {
    value += 1900;
    if(value + 99 < ASPx.CultureInfo.twoDigitYearMax)
        value += 100;
    return value;	    
};
DateUtils.GetTimeZoneOffsetDifference = function(firstDate, secondDate) {
    if(!secondDate)
        secondDate = DateUtils.GetUtcDate(firstDate);
    return 60000 * (firstDate.getTimezoneOffset() - secondDate.getTimezoneOffset());
};

DateUtils.GetTimeZoneOffset = function(date) {
    var isECMA262Support = ASPx.Browser.Chrome && ASPx.Browser.Version >= 67;
    if(!isECMA262Support)
        return date.getTimezoneOffset() * 60000;

    var utcDate = DateUtils.GetUtcDate(date);
    var utcTimezoneOffsetDifference = DateUtils.GetTimeZoneOffsetDifference(date);

    if(utcTimezoneOffsetDifference !== 0)
        utcDate.setTime(utcDate.valueOf() + utcTimezoneOffsetDifference);

    return utcDate - date;
};
DateUtils.GetUtcDate = function(date) {
    var utcFullYear = date.getUTCFullYear();
    var result = new Date(utcFullYear, date.getUTCMonth(), date.getUTCDate(), date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds(), date.getUTCMilliseconds());
    if(utcFullYear < 100)
        result.setFullYear(utcFullYear);
    return result;
};
DateUtils.ToUtcTime = function(date) {
	var result = new Date();
	result.setTime(date.valueOf() + ASPx.DateUtils.GetTimeZoneOffset(date));
	return result;
};
DateUtils.ToLocalTime = function(date) {
	var result = new Date();
	result.setTime(date.valueOf() - ASPx.DateUtils.GetTimeZoneOffset(date));
	return result;	
};
DateUtils.AreDatesEqualExact = function(date1, date2) {
    if(date1 == null && date2 == null)
        return true;
    if(date1 == null || date2 == null)
        return false;
    return date1.getTime() == date2.getTime();    
};
DateUtils.FixTimezoneGap = function(oldDate, newDate) {
    // B31219, B95404, Q148106, Q151614, B159521
	var diff = newDate.getHours() - oldDate.getHours();
	if(diff == 0)
		return;

	var sign = (diff == 1 || diff == -23) ? -1 : 1;
	var trial = new Date(newDate.getTime() + sign * 3600000);
    var isDateChangedAsExpected = newDate.getHours() - trial.getHours() === diff;
	if(isDateChangedAsExpected && (sign > 0 || trial.getDate() == newDate.getDate()))
		newDate.setTime(trial.getTime());
};
DateUtils.GetDecadeStartYear = function(year) {
    return 10 * Math.floor(year / 10);
};
DateUtils.GetCenturyStartYear = function(year) {
    return 100 * Math.floor(year / 100);
};
DateUtils.GetCorrectedYear = function(date, pickerType) {
    var year = date.getFullYear();
    return pickerType != ASPx.DatePickerType.Decades ? year : DateUtils.GetDecadeStartYear(year);
};
DateUtils.GetCorrectedMonth = function(date, pickerType) {
    return pickerType < ASPx.DatePickerType.Years ? date.getMonth() : 0;
};
DateUtils.GetCorrectedDay = function(date, pickerType) {
    return pickerType == ASPx.DatePickerType.Days ? date.getDate() : 1;
};
DateUtils.CorrectDateByPickerType = function(date, pickerType) {
    if(!ASPx.IsExists(pickerType))
        pickerType = ASPx.DatePickerType.Days;
    if(!date || pickerType == ASPx.DatePickerType.Days)
        return date;
    var correctedYear = DateUtils.GetCorrectedYear(date, pickerType);
    var result = new Date(
        correctedYear,
        DateUtils.GetCorrectedMonth(date, pickerType),
        DateUtils.GetCorrectedDay(date, pickerType),
        date.getHours(), date.getMinutes(), date.getSeconds(), date.getMilliseconds()
    );
    result.setFullYear(correctedYear);
    return result;
};
DateUtils.GetYearRangeFormatString = function(startYear, rangeLength) {
    return startYear + " - " + (startYear + rangeLength - 1);
};
ASPx.DateUtils = DateUtils;

var Timer = { };
Timer.ClearTimer = function(timerID){
    if(timerID > -1)
        window.clearTimeout(timerID);
    return -1;
};
Timer.ClearInterval = function(timerID){
    if(timerID > -1)
        window.clearInterval(timerID);
    return -1;
};
var setControlBoundTimer = function(handler, control, setTimerFunction, clearTimerFunction, delay) {
    var timerId;
    var getTimerId = function() { return timerId; };
    var boundHandler = function() {
        var controlExists = control && ASPx.GetControlCollection().Get(control.name) === control && !control.IsDOMDisposed();
        if(controlExists)
            handler.aspxBind(control)();
        else
            clearTimerFunction(getTimerId());
    };
    timerId = setTimerFunction(boundHandler, delay);
    return timerId;
};
Timer.SetControlBoundTimeout = function(handler, control, delay) {
    return setControlBoundTimer(handler, control, window.setTimeout, Timer.ClearTimer, delay);
};
Timer.SetControlBoundInterval = function(handler, control, delay) {
    return setControlBoundTimer(handler, control, window.setInterval, Timer.ClearInterval, delay);
};
Timer.Throttle = function(func, delay) {
    var isThrottled = false,
      savedArgs,
      savedThis = this;
    function wrapper() {
        if(isThrottled) {
            savedArgs = arguments;
            savedThis = this;
            return;
        }
        func.apply(this, arguments);
        isThrottled = true;
        setTimeout(function() {
            isThrottled = false;
            if(savedArgs) {
                wrapper.apply(savedThis, savedArgs);
                savedArgs = null;
            }
        }, delay);
    }

    wrapper.cancel = function() {
        clearTimeout(delay);
        delay = savedArgs = savedThis = null;
    };

    return wrapper;
};
ASPx.Timer = Timer;

var Browser = { };
Browser.UserAgent = navigator.userAgent.toLowerCase();
Browser.Mozilla = false;
Browser.IE = false;
Browser.Firefox = false;
Browser.Netscape = false;
Browser.Safari = false;
Browser.Chrome = false;
Browser.Opera = false;
Browser.Edge = false;
    
Browser.Version = undefined; // {major}.{1-digit minor}
Browser.MajorVersion = undefined; // {major}
    
Browser.WindowsPlatform = false;
Browser.MacOSPlatform = false;
Browser.MacOSMobilePlatform = false;
Browser.AndroidMobilePlatform = false;
Browser.PlaformMajorVersion = false;
Browser.WindowsPhonePlatform = false;

Browser.AndroidDefaultBrowser = false;
Browser.AndroidChromeBrowser = false;
Browser.SamsungAndroidDevice = false;
Browser.WebKitTouchUI = false;
Browser.MSTouchUI = false;
Browser.TouchUI = false;
    
Browser.WebKitFamily = false; // Safari, Chrome or Opera(Blink)
Browser.NetscapeFamily = false; // Mozilla, Nestcape, or Firefox
Browser.HardwareAcceleration = false;
Browser.VirtualKeyboardSupported = false;
Browser.Info = "";

function indentPlatformMajorVersion(userAgent) {
    var regex = /(?:(?:windows nt|macintosh|mac os|cpu os|cpu iphone os|android|windows phone|linux) )(\d+)(?:[-0-9_.])*/;
    var matches = regex.exec(userAgent);
    if(matches)
        Browser.PlaformMajorVersion = matches[1];
}
function getIECompatibleVersionString() {
    if(document.compatible) {
        for(var i = 0; i < document.compatible.length; i++)
            if(document.compatible[i].userAgent === "IE" && document.compatible[i].version)
                return document.compatible[i].version.toLowerCase();
    }
    return "";
}
Browser.IdentUserAgent = function(userAgent, ignoreDocumentMode) {
    var browserTypesOrderedList = [ "Mozilla", "IE", "Firefox", "Netscape", "Safari", "Chrome", "Opera", "Opera10", "Edge" ];
    var defaultBrowserType = "IE";
    var defaultPlatform = "Win";
    var defaultVersions = { Safari: 2, Chrome: 0.1, Mozilla: 1.9, Netscape: 8, Firefox: 2, Opera: 9, IE: 6, Edge: 12 };

    if(!userAgent || userAgent.length == 0) {
        fillUserAgentInfo(browserTypesOrderedList, defaultBrowserType, defaultVersions[defaultBrowserType], defaultPlatform);
        return;
    }

    userAgent = userAgent.toLowerCase();
    indentPlatformMajorVersion(userAgent);
    try {
        var platformIdentStrings = {
            "Windows": "Win",
            "Macintosh": "Mac",
            "Mac OS": "Mac",
            "Mac_PowerPC": "Mac",
            "cpu os": "MacMobile",
            "cpu iphone os": "MacMobile",
            "Android": "Android",
            "!Windows Phone": "WinPhone",
            "!WPDesktop": "WinPhone",
            "!ZuneWP": "WinPhone"
        };

        var optSlashOrSpace = "(?:/|\\s*)?";
        var version = "(\\d+)(?:\\.((?:\\d+?[1-9])|\\d)0*?)?";
        var optVersion = "(?:" + version + ")?";
        var patterns = {
            Safari: "applewebkit(?:.*?(?:version/" + version + "[\\.\\w\\d]*?(?:\\s+mobile\/\\S*)?\\s+safari))?",
            Chrome: "(?:chrome|crios)(?!frame)" + optSlashOrSpace + optVersion,
            Mozilla: "mozilla(?:.*rv:" + optVersion + ".*Gecko)?",
            Netscape: "(?:netscape|navigator)\\d*/?\\s*" + optVersion,
            Firefox: "firefox" + optSlashOrSpace + optVersion,
            Opera: "(?:opera|\sopr)" + optSlashOrSpace + optVersion,
            Opera10: "opera.*\\s*version" + optSlashOrSpace + optVersion,
            IE: "msie\\s*" + optVersion,
            Edge: "edge" + optSlashOrSpace + optVersion
        };

        var browserType;
        var version = -1;
        for(var i = 0; i < browserTypesOrderedList.length; i++) {
            var browserTypeCandidate = browserTypesOrderedList[i];

            var regExp = new RegExp(patterns[browserTypeCandidate], "i");
            if(regExp.compile)
                regExp.compile(patterns[browserTypeCandidate], "i");
            var matches = regExp.exec(userAgent);

            if(matches && matches.index >= 0) {
                if(browserType == "IE" && version >= 11 && browserTypeCandidate == "Safari") // WinPhone8.1 update
                    continue;
                browserType = browserTypeCandidate;
                if(browserType == "Opera10")
                    browserType = "Opera";
                var tridentPattern = "trident" + optSlashOrSpace + optVersion;
                version = Browser.GetBrowserVersion(userAgent, matches, tridentPattern, getIECompatibleVersionString());
                if(browserType == "Mozilla" && version >= 11)
                    browserType = "IE";
            }
        }
        
        if(!browserType)
            browserType = defaultBrowserType;
        var browserVersionDetected = version != -1;
		if(!browserVersionDetected)
            version = defaultVersions[browserType];
        
        var platform;
        var minOccurenceIndex = Number.MAX_VALUE;
        for(var identStr in platformIdentStrings) {
            if(!platformIdentStrings.hasOwnProperty(identStr)) continue;
            var importantIdent = identStr.substr(0,1) == "!";
            var occurenceIndex = userAgent.indexOf((importantIdent ? identStr.substr(1) : identStr).toLowerCase());
            if(occurenceIndex >= 0 && (occurenceIndex < minOccurenceIndex || importantIdent)) {
                minOccurenceIndex = importantIdent ? 0 : occurenceIndex;
                platform = platformIdentStrings[identStr];
            }
        }
        var samsungPattern = "SM-[A-Z]";
        var matches = userAgent.toUpperCase().match(samsungPattern);
        var isSamsungAndroidDevice = matches && matches.length > 0;
        if(platform == "WinPhone" && version < 9)
            version = Math.floor(getVersionFromTrident(userAgent, "trident" + optSlashOrSpace + optVersion));

        if(!ignoreDocumentMode && browserType == "IE" && version > 7 && document.documentMode < version)
            version = document.documentMode;
        
        if(platform == "WinPhone")
            version = Math.max(9, version);

        if(!platform)
            platform = defaultPlatform;
        if(platform == platformIdentStrings["cpu os"] && !browserVersionDetected) // Terra browser
            version = 4;

        fillUserAgentInfo(browserTypesOrderedList, browserType, version, platform, isSamsungAndroidDevice);
    } catch(e) {
        fillUserAgentInfo(browserTypesOrderedList, defaultBrowserType, defaultVersions[defaultBrowserType], defaultPlatform);
    }
};
function getVersionFromMatches(matches) {
    var result = -1;
    var versionStr = "";
    if(matches[1]) {
        versionStr += matches[1];
        if(matches[2])
            versionStr += "." + matches[2];
    }
    if(versionStr != "") {
        result = parseFloat(versionStr);
        if(isNaN(result))
            result = -1;
    }
    return result;
}
function getVersionFromTrident(userAgent, tridentPattern) {
    var tridentDiffFromVersion = 4;
    var matches = new RegExp(tridentPattern, "i").exec(userAgent);
    return getVersionFromMatches(matches) + tridentDiffFromVersion;
}
Browser.GetBrowserVersion = function(userAgent, matches, tridentPattern, ieCompatibleVersionString) {
    var version = getVersionFromMatches(matches);
    if(ieCompatibleVersionString) {
        var versionFromTrident = getVersionFromTrident(userAgent, tridentPattern);
        if(ieCompatibleVersionString === "edge" || parseInt(ieCompatibleVersionString) === versionFromTrident)
            return versionFromTrident;
    }
    return version;
};
function fillUserAgentInfo(browserTypesOrderedList, browserType, version, platform, isSamsungAndroidDevice) {
    for(var i = 0; i < browserTypesOrderedList.length; i++) {
        var type = browserTypesOrderedList[i];
        Browser[type] = type == browserType;
    }
    Browser.Version = Math.floor(10.0 * version) / 10.0;
    Browser.MajorVersion = Math.floor(Browser.Version);
    Browser.WindowsPlatform = platform == "Win" || platform == "WinPhone";
    Browser.MacOSPlatform = platform == "Mac";
    Browser.MacOSMobilePlatform = platform == "MacMobile";
    Browser.AndroidMobilePlatform = platform == "Android";
    Browser.WindowsPhonePlatform = platform == "WinPhone";
    Browser.WebKitFamily = Browser.Safari || Browser.Chrome || Browser.Opera && Browser.MajorVersion >= 15;
    Browser.NetscapeFamily = Browser.Netscape || Browser.Mozilla || Browser.Firefox;
    Browser.HardwareAcceleration = (Browser.IE && Browser.MajorVersion >= 9) || (Browser.Firefox && Browser.MajorVersion >= 4) || 
        (Browser.AndroidMobilePlatform && Browser.Chrome) || (Browser.Chrome && Browser.MajorVersion >= 37) || 
        (Browser.Safari && !Browser.WindowsPlatform) || Browser.Edge || (Browser.Opera && Browser.MajorVersion >= 46);

    Browser.WebKitTouchUI = Browser.MacOSMobilePlatform || Browser.AndroidMobilePlatform;
    var isIETouchUI = Browser.IE && Browser.MajorVersion > 9 && Browser.WindowsPlatform && Browser.UserAgent.toLowerCase().indexOf("touch") >= 0;
    Browser.MSTouchUI = isIETouchUI || (Browser.Edge && !!window.navigator.maxTouchPoints);
    Browser.TouchUI = Browser.WebKitTouchUI || Browser.MSTouchUI;
    Browser.MobileUI = Browser.WebKitTouchUI || Browser.WindowsPhonePlatform;
    Browser.AndroidDefaultBrowser = Browser.AndroidMobilePlatform && !Browser.Chrome;
    Browser.AndroidChromeBrowser = Browser.AndroidMobilePlatform && Browser.Chrome;
    if(isSamsungAndroidDevice)
        Browser.SamsungAndroidDevice = isSamsungAndroidDevice;
    if(Browser.MSTouchUI) {
        var isARMArchitecture = Browser.UserAgent.toLowerCase().indexOf("arm;") > -1;       
        Browser.VirtualKeyboardSupported = isARMArchitecture || Browser.WindowsPhonePlatform;      
    } else {
        Browser.VirtualKeyboardSupported = Browser.WebKitTouchUI;
    }
    fillDocumentElementBrowserTypeClassNames(browserTypesOrderedList);
}
function fillDocumentElementBrowserTypeClassNames(browserTypesOrderedList) {
    var documentElementClassName = "";
    var browserTypeslist = browserTypesOrderedList.concat(["WindowsPlatform", "MacOSPlatform", "MacOSMobilePlatform", "AndroidMobilePlatform",
      "WindowsPhonePlatform", "WebKitFamily", "WebKitTouchUI", "MSTouchUI", "TouchUI", "AndroidDefaultBrowser", "MobileUI"]);
    for(var i = 0; i < browserTypeslist.length; i++) {
        var type = browserTypeslist[i];
        if(Browser[type])
            documentElementClassName += "dx" + type + " ";
    }
    documentElementClassName += "dxBrowserVersion-" + Browser.MajorVersion;
    if(document && document.documentElement) {
        if(document.documentElement.className != "")
            documentElementClassName = " " + documentElementClassName;
        document.documentElement.className += documentElementClassName;
        Browser.Info = documentElementClassName;
    }
}
Browser.SupportsStickyPositioning = function() {
    return this.Chrome && this.MajorVersion >= 56
        || this.Firefox && this.MajorVersion >= 32
        || this.Safari && this.MajorVersion >= 6 && this.Version !== "6"
        || this.Opera && this.MajorVersion >= 42;
};
Browser.IdentUserAgent(Browser.UserAgent);
ASPx.Browser = Browser;

ASPx.BlankUrl = Browser.IE ? ASPx.SSLSecureBlankUrl : (Browser.Opera ? "about:blank" : "");

var Data = { };
Data.ArrayInsert = function(array, element, position){
    if(0 <= position && position < array.length){
        for(var i = array.length; i > position; i --)
            array[i] = array[i - 1];
        array[position] = element;
    }
    else
        array.push(element);
};
Data.ArrayRemove = function(array, element){
    var index = Data.ArrayIndexOf(array, element);
    if(index > -1) Data.ArrayRemoveAt(array, index);
};
Data.ArrayRemoveAt = function(array, index){
    if(index >= 0  && index < array.length){
        for(var i = index; i < array.length - 1; i++)
            array[i] = array[i + 1];
        array.pop();
    }
};
Data.ArrayClear = function(array){
    while(array.length > 0)
        array.pop();
};
Data.ArrayIndexOf = function(array, element, comparer) {
    if(!comparer) {
        for(var i = 0; i < array.length; i++) {
            if(array[i] == element)
                return i;
        }
    } else {
        for(var i = 0; i < array.length; i++) {
            if(comparer(array[i], element))
                return i;
        }
    }
    return -1;
};
Data.ArrayContains = function(array, element) {    
    return Data.ArrayIndexOf(array, element) >= 0;
};
Data.ArrayEqual = function(array1, array2) {
    var count1 = array1.length;
    var count2 = array2.length;
    if(count1 != count2)
        return false;
    for(var i = 0; i < count1; i++)
        if(array1[i] != array2[i])
            return false;
    return true;
};
Data.ArraySame = function(array1, array2) {
    if(array1.length !== array2.length)
        return false;
    return array1.every(function(elem) { return Data.ArrayContains(array2, elem); });
};
Data.ArrayGetIntegerEdgeValues = function(array) {
    var arrayToSort = Data.CollectionToArray(array);
    Data.ArrayIntegerAscendingSort(arrayToSort);
    return {
        start: arrayToSort[0],
        end: arrayToSort[arrayToSort.length - 1]
    };
};
Data.ArrayIntegerAscendingSort = function(array){
    Data.ArrayIntegerSort(array);
};
Data.ArrayIntegerSort = function(array, desc) {
    array.sort(function(i1, i2) {
        var res = 0;
        if(i1 > i2)
            res = 1;
        else if(i1 < i2)
            res = -1;
        if(desc)
            res *= -1;
        return res;
    });
};
Data.CollectionsUnionToArray = function(firstCollection, secondCollection) {
    var result = [];
    var firstCollectionLength = firstCollection.length;
    var secondCollectionLength = secondCollection.length;
    for(var i = 0; i < firstCollectionLength + secondCollectionLength; i++) {
        if(i < firstCollectionLength)
            result.push(firstCollection[i]);
        else
            result.push(secondCollection[i - firstCollectionLength]);
    }
    return result;
};
Data.CollectionToArray = function(collection) {
    var array = [];
    for(var i = 0; i < collection.length; i++)
        array.push(collection[i]);
    return array;
};
Data.CreateHashTableFromArray = function(array) {
    var hash = [];
    for(var i = 0; i < array.length; i++)
        hash[array[i]] = 1;
    return hash;
};
Data.CreateIndexHashTableFromArray = function(array) {
    var hash = [];
    for(var i = 0; i < array.length; i++)
        hash[array[i]] = i;
    return hash;
};
Data.ArrayToHash = function(array, getKeyFunc, getValueFunc) {
    if(!(array instanceof Array)) 
        return { };
    return array.reduce(function(map, element, index) { 
        var key = getKeyFunc(element, index);
        var value = getValueFunc(element, index);
        map[key] = value;
        return map; 
    }, { });
};
Data.Sum = function(array, getValueFunc) {
    if(!(array instanceof Array)) 
        return 0;
    return array.reduce(function(prevValue, item) {
        var value = getValueFunc ? getValueFunc(item) : item;
        if(!ASPx.IsNumber(value))
            value = 0;
        return prevValue + value;
    }, 0);
};
Data.Min = function(array, getValueFunc) { return CalculateArrayMinMax(array, getValueFunc, false); };
Data.Max = function(array, getValueFunc) { return CalculateArrayMinMax(array, getValueFunc, true); };

var CalculateArrayMinMax = function(array, getValueFunc, isMax) {
    if(!(array instanceof Array)) 
        return 0;
    var startValue = isMax ? Number.NEGATIVE_INFINITY : Number.POSITIVE_INFINITY;
    return array.reduce(function(prevValue, item) {
        var value = getValueFunc ? getValueFunc(item) : item;
        if(!ASPx.IsNumber(value))
            value = startValue;
        var func = isMax ? Math.max : Math.min;
        return func(value, prevValue);
    }, startValue);
};

var defaultBinarySearchComparer = function(array, index, value) {
    var arrayElement = array[index];
    if(arrayElement == value)
        return 0;
    else
        return arrayElement < value ? -1 : 1;
};
Data.NearestLeftBinarySearchComparer = function(array, index, value) { 
    var arrayElement = array[index];
    
    var leftPoint = arrayElement < value;
    var lastLeftPoint = leftPoint && index == array.length - 1;
    var nearestLeftPoint = lastLeftPoint || (leftPoint && array[index + 1] >= value);
    if(nearestLeftPoint)
        return 0;
    else
        return arrayElement < value ? -1 : 1;
};
Data.ArrayBinarySearch = function(array, value, binarySearchComparer, startIndex, length) {
    if(!binarySearchComparer)
        binarySearchComparer = defaultBinarySearchComparer;
    if(!ASPx.IsExists(startIndex))
        startIndex = 0;
    if(!ASPx.IsExists(length))
        length = array.length - startIndex;
    var endIndex = (startIndex + length) - 1;
    while(startIndex <= endIndex) {
        var middle = (startIndex + ((endIndex - startIndex) >> 1));
        var compareResult = binarySearchComparer(array, middle, value);
        if(compareResult == 0)
            return middle;
        if(compareResult < 0)
            startIndex = middle + 1;
        else
            endIndex = middle - 1;
    }
    return -(startIndex + 1);
};
Data.ArrayFlatten = function(arrayOfArrays) {
    return [].concat.apply([], arrayOfArrays);
};
Data.GetDistinctArray = function(array) {
    var resultArray = [];
    for(var i = 0; i < array.length; i++) {
        var currentEntry = array[i];
        if(Data.ArrayIndexOf(resultArray, currentEntry) == -1) {
            resultArray.push(currentEntry);
        }
    }

    return resultArray;
};
Data.ForEach = function(arr, callback) {
    if(Array.prototype.forEach) {
        Array.prototype.forEach.call(arr, callback);
    } else {
        for(var i = 0, len = arr.length; i < len; i++) {
            callback(arr[i], i, arr);
        }
    }
};
Data.MergeHashTables = function(target, object) {
    if(!object || typeof (object) == "string")
        return target;

    if(!target)
        target = {};
    for(var key in object)
        if(key && !(key in target))
            target[key] = object[key];
    return target;
};
Data.Range = function(count, start) {
    count = parseInt(count) || 0;
    start = parseInt(start) || 0;
    if(count < 0) count = 0;
    if(start < 0) start = 0;
    return Array.apply(null, Array(count)).map(function(val, i) { return start + i; });
};
ASPx.Data = Data;

var Cookie = { };
Cookie.DelCookie = function(name){
    setCookieInternal(name, "", new Date(1970, 1, 1));
};
Cookie.GetCookie = function(name) {
    name = escape(name);
    var cookies = document.cookie.split(';');
    for(var i = 0; i < cookies.length; i++) {
        var cookie = Str.Trim(cookies[i]);
        if(cookie.indexOf(name + "=") == 0)
            return unescape(cookie.substring(name.length + 1, cookie.length));
        else if(cookie.indexOf(name + ";") == 0 || cookie === name)
            return "";
    }
    return null;
};
Cookie.SetCookie = function(name, value, expirationDate){
    if(!ASPx.IsExists(value)) {
        Cookie.DelCookie(name);
        return;
    }

    if(!ASPx.Ident.IsDate(expirationDate)) {
        expirationDate = new Date();
        expirationDate.setFullYear(expirationDate.getFullYear() + 1);
    }
    setCookieInternal(name, value, expirationDate);
};
function setCookieInternal(name, value, date){
    document.cookie = escape(name) + "=" + escape(value.toString()) + "; expires=" + date.toGMTString() + "; path=/";
}
ASPx.Cookie = Cookie;

ASPx.ImageUtils = {
    GetImageSrc: function (image){
        return image.src;
    },
    SetImageSrc: function(image, src){
        if(isSourceResetRequired())
            image.src = "";
        image.src = src;
    },
    SetSize: function(image, width, height){
        image.style.width = width + "px";
        image.style.height = height + "px";
    },
    GetSize: function(image, isWidth) {
        return (isWidth ? ASPx.GetElementOffsetWidth(image) : ASPx.GetElementOffsetHeight(image));
    }
};

var Str = { };
Str.ApplyReplacement = function(text, replecementTable) {
    if(typeof(text) != "string")
        text = text.toString();
    for(var i = 0; i < replecementTable.length; i++) {
        var replacement = replecementTable[i];
        text = text.replace(replacement[0], replacement[1]);
    }
    return text;
};
Str.CompleteReplace = function(text, regexp, newSubStr) {
    if(typeof(text) != "string")
        text = text.toString();
    var textPrev;
    do {
        textPrev = text;
        text = text.replace(regexp, newSubStr);
    } while(text != textPrev);
    return text;
};

Str.EncodeHtml = function(html) {
    return Str.ApplyReplacement(html, [
        [ /&amp;/g,  '&ampx;'  ], [ /&/g, '&amp;'  ],
        [ /&quot;/g, '&quotx;' ], [ /"/g, '&quot;' ],
        [ /&lt;/g,   '&ltx;'   ], [ /</g, '&lt;'   ],
        [ /&gt;/g,   '&gtx;'   ], [ />/g, '&gt;'   ]
    ]);
};
Str.DecodeHtml = function(html) {
    return Str.ApplyReplacement(html, [
        [ /&gt;/g,   '>' ], [ /&gtx;/g,  '&gt;'   ],
        [ /&lt;/g,   '<' ], [ /&ltx;/g,  '&lt;'   ],
        [ /&quot;/g, '"' ], [ /&quotx;/g,'&quot;' ],
        [ /&amp;/g,  '&' ], [ /&ampx;/g, '&amp;'  ]
    ]);
};
Str.DecodeHtmlViaTextArea = function(html) {
    var textArea = document.createElement("TEXTAREA");
    setInnerHtmlInternal(textArea, html);
    return textArea.value;
};
Str.TrimStart = function(str) {    
    return trimInternal(str, true);
};
Str.TrimEnd = function(str) {    
    return trimInternal(str, false, true);
};
Str.Trim = function(str) {    
    return trimInternal(str, true, true);    
};
Str.EscapeForRegEx = function(str) {
    return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&");
};
var whiteSpaces = { 
    0x0009: 1, 0x000a: 1, 0x000b: 1, 0x000c: 1, 0x000d: 1, 0x0020: 1, 0x0085: 1, 
    0x00a0: 1, 0x1680: 1, 0x180e: 1, 0x2000: 1, 0x2001: 1, 0x2002: 1, 0x2003: 1, 
    0x2004: 1, 0x2005: 1, 0x2006: 1, 0x2007: 1, 0x2008: 1, 0x2009: 1, 0x200a: 1, 
    0x200b: 1, 0x2028: 1, 0x2029: 1, 0x202f: 1, 0x205f: 1, 0x3000: 1
};
var caretWidth = 1;
function trimInternal(source, trimStart, trimEnd) {
    var len = source.length;
    if(!len)
        return source;

    if(len < 0xBABA1) { // B181394        
        var result = source;
        if(trimStart) {
            result = result.replace(/^\s+/, "");
        }
        if(trimEnd) {
            result = result.replace(/\s+$/, "");
        }
        return result;        
    } else {
        var start = 0;
        if(trimEnd) {            
            while(len > 0 && whiteSpaces[source.charCodeAt(len - 1)]) {
                len--;
            }
        }
        if(trimStart && len > 0) {
            while(start < len && whiteSpaces[source.charCodeAt(start)]) { 
                start++; 
            }            
        }
        return source.substring(start, len);
    }
}
Str.Insert = function(str, subStr, index) {    
    var leftText = str.slice(0, index);
    var rightText = str.slice(index);
    return leftText + subStr + rightText;
};
Str.InsertEx = function(str, subStr, startIndex, endIndex) {    
    var leftText = str.slice(0, startIndex);
    var rightText = str.slice(endIndex);
    return leftText + subStr + rightText;
};
var greekSLFSigmaChar = String.fromCharCode(962);
var greekSLSigmaChar = String.fromCharCode(963);
Str.PrepareStringForFilter = function(s){
    s = s.toLowerCase();
    if(ASPx.Browser.WebKitFamily) {
        return s.replace(new RegExp(greekSLFSigmaChar, "g"), greekSLSigmaChar);
    }
    return s;
};
Str.GetCoincideCharCount = function(text, filter, textMatchingDelegate) {
    var coincideText = ASPx.Str.PrepareStringForFilter(filter);
    var originText = ASPx.Str.PrepareStringForFilter(text);
    while(coincideText != "" && !textMatchingDelegate(originText, coincideText)) {
        coincideText = coincideText.slice(0, -1);
    }
    return coincideText.length;
};
ASPx.Str = Str;

var Xml = { };
Xml.Parse = function(xmlStr) {
    if(window.DOMParser) {
        var parser = new DOMParser();
        return parser.parseFromString(xmlStr, "text/xml");
    }
    else if(window.ActiveXObject) {
        var xmlDoc = new window.ActiveXObject("Microsoft.XMLDOM");
        if(xmlDoc) {
            xmlDoc.async = false;
            xmlDoc.loadXML(xmlStr);
            return xmlDoc;
        }
    }
    return null;
};
ASPx.Xml = Xml;

ASPx.Key = {
    F1           : 112,
    F2           : 113,
    F3           : 114,
    F4           : 115,
    F5           : 116,
    F6           : 117,
    F7           : 118,
    F8           : 119,
    F9           : 120,
    F10          : 121,
    F11          : 122,
    F12          : 123,
    Ctrl         : 17,
    Shift        : 16,
    Alt          : 18,
    Enter        : 13,
    Home         : 36,
    End          : 35,
    Left         : 37,
    Right        : 39,
    Up           : 38,
    Down         : 40,
    PageUp       : 33,
    PageDown     : 34,
    Esc          : 27,
    Space        : 32,
    Tab          : 9,
    Backspace    : 8,
    Delete       : 46,
    Insert       : 45,
    ContextMenu  : 93,
    Windows      : 91,
    Decimal      : 110
};

ASPx.ModifierKey = {
    None: 0,
    Ctrl: 1 << (0 + 16),
    Shift: 1 << (2 + 16),
    Alt: 1 << (4 + 16),
    Meta: 1 << (8 + 16)
};

ASPx.KeyCode = {
    Backspace    : 8,
    Tab          : 9,
    Enter        : 13,
    Pause        : 19,
    CapsLock     : 20,
    Esc          : 27,
    Space        : 32,
    PageUp       : 33,
    PageDown     : 34,
    End          : 35,
    Home         : 36,
    Left         : 37,
    Up           : 38,
    Right        : 39,
    Down         : 40,
    Insert       : 45,
    Delete       : 46,
    Key_0        : 48,
    Key_1        : 49,
    Key_2        : 50,
    Key_3        : 51,
    Key_4        : 52,
    Key_5        : 53,
    Key_6        : 54,
    Key_7        : 55,
    Key_8        : 56,
    Key_9        : 57,
    Key_a        : 65,
    Key_b        : 66,
    Key_c        : 67,
    Key_d        : 68,
    Key_e        : 69,
    Key_f        : 70,
    Key_g        : 71,
    Key_h        : 72,
    Key_i        : 73,
    Key_j        : 74,
    Key_k        : 75,
    Key_l        : 76,
    Key_m        : 77,
    Key_n        : 78,
    Key_o        : 79,
    Key_p        : 80,
    Key_q        : 81,
    Key_r        : 82,
    Key_s        : 83,
    Key_t        : 84,
    Key_u        : 85,
    Key_v        : 86,
    Key_w        : 87,
    Key_x        : 88,
    Key_y        : 89,
    Key_z        : 90,
    Windows      : 91,
    ContextMenu  : 93,
    Numpad_0     : 96,
    Numpad_1     : 97,
    Numpad_2     : 98,
    Numpad_3     : 99,
    Numpad_4     : 100,
    Numpad_5     : 101,
    Numpad_6     : 102,
    Numpad_7     : 103,
    Numpad_8     : 104,
    Numpad_9     : 105,
    Multiply     : 106,
    Add          : 107,
    Subtract     : 109,
    Decimal      : 110,
    Divide       : 111,
    F1           : 112,
    F2           : 113,
    F3           : 114,
    F4           : 115,
    F5           : 116,
    F6           : 117,
    F7           : 118,
    F8           : 119,
    F9           : 120,
    F10          : 121,
    F11          : 122,
    F12          : 123,
    NumLock      : 144,
    ScrollLock   : 145,
    Semicolon    : 186,
    Equals       : 187,
    Comma        : 188,
    Dash         : 189,
    Period       : 190,
    ForwardSlash : 191,
    GraveAccent  : 192,
    OpenBracket  : 219,
    BackSlash    : 220,
    CloseBracket : 221,
    SingleQuote  : 222
};

ASPx.ScrollBarMode = { Hidden: 0, Visible: 1, Auto: 2 };
ASPx.ColumnResizeMode = { None: 0, Control: 1, NextColumn: 2 };

var Selection = { };
Selection.Set = function(input, startPos, endPos, scrollToSelection, isApi) {
    if(!ASPx.IsExistsElement(input))
        return;
    var isInputFocused = ASPx.GetActiveElement() === input;
    var isInputNativeFocusLocked = ASPx.VirtualKeyboardUI.getInputNativeFocusLocked();
    if(!isApi && Browser.VirtualKeyboardSupported && (!isInputFocused || isInputNativeFocusLocked))
        return;

    var textLen = input.value.length;

    startPos = ASPx.GetDefinedValue(startPos, 0);
    endPos = ASPx.GetDefinedValue(endPos, textLen);

    if(startPos < 0)
        startPos = 0;

    if(endPos < 0 || endPos > textLen)
        endPos = textLen;

    if(startPos > endPos)
        startPos = endPos;

    var makeReadOnly = false;
    if(Browser.WebKitFamily && input.readOnly) {
        input.readOnly = false;
        makeReadOnly = true;
    }
    
    try {
        if(Browser.Firefox && Browser.Version >= 8) 
            input.setSelectionRange(startPos, endPos, "backward");
        else if(Browser.IE && input.createTextRange) {
            var range = input.createTextRange();
            range.collapse(true);
            range.moveStart("character", startPos);
            range.moveEnd("character", endPos - startPos);
            range.select();
        } else {
            forceScrollToSelectionRange(input, startPos, endPos);
            input.setSelectionRange(startPos, endPos);
        }
        if(Browser.Opera || Browser.Firefox || Browser.Chrome) // B188482
            input.focus();
    } catch(e) { }

    if(scrollToSelection && input.tagName == 'TEXTAREA') {
        var scrollHeight = input.scrollHeight;
        var approxCaretPos = startPos;
        var scrollTop = Math.max(Math.round(approxCaretPos * scrollHeight / textLen  - input.clientHeight / 2), 0);
        input.scrollTop = scrollTop;
    }

    if(makeReadOnly)
        input.readOnly = true;
};
var getTextWidthBeforePos = function(input, pos) {
    return ASPx.GetSizeOfText(input.value.toString().substr(0, pos), ASPx.GetCurrentStyle(input)).width;
};
var forceScrollToSelectionRange = function(input, startPos, endPos) {
    if(endPos === input.value.length)
        input.scrollLeft = input.scrollWidth;
    else if(startPos === 0 && endPos === 0)
        input.scrollLeft = 0;
    else {
        var inputRawWidth = ASPx.GetElementOffsetWidth(input) - ASPx.GetLeftRightBordersAndPaddingsSummaryValue(input);
        if(inputRawWidth < input.scrollWidth) {
            var widthBeforeEndPos = getTextWidthBeforePos(input, endPos) + caretWidth;
            if(input.scrollLeft < widthBeforeEndPos - inputRawWidth)
                input.scrollLeft = widthBeforeEndPos - inputRawWidth;
            else {
                var widthBeforeStartPos = getTextWidthBeforePos(input, startPos) - caretWidth;
                if(input.scrollLeft > widthBeforeStartPos)
                    input.scrollLeft = widthBeforeStartPos;
            }
        }
    }
};

Selection.GetInfo = function(input) {
    var start, end;
    if(Browser.IE && Browser.Version < 9) {
        var range = document.selection.createRange();
        var rangeCopy = range.duplicate();
        range.move('character', -input.value.length);
        range.setEndPoint('EndToStart', rangeCopy);
        start = range.text.length;
        end = start + rangeCopy.text.length;
    } else {
        try {
            start = input.selectionStart;
            end = input.selectionEnd;
        } catch (e) {
        }
    }
    return { startPos: start, endPos: end };
};
Selection.GetExtInfo = function(input) {
    var start = 0, end = 0, textLen = 0;

    if(Browser.IE && Browser.Version < 9) {
        var normalizedValue;
        var range, textInputRange, textInputEndRange;

        range = document.selection.createRange();
        if(range && range.parentElement() == input) {
            textLen = input.value.length;
            normalizedValue = input.value.replace(/\r\n/g, "\n");

            textInputRange = input.createTextRange();
            textInputRange.moveToBookmark(range.getBookmark());

            textInputEndRange = input.createTextRange();
            textInputEndRange.collapse(false);

            if(textInputRange.compareEndPoints("StartToEnd", textInputEndRange) > -1) {
                start = textLen;
                end = textLen;
            } else {
                start = normalizedValue.slice(0, start).split("\n").length - textInputRange.moveStart("character", -textLen) -1;
                if(textInputRange.compareEndPoints("EndToEnd", textInputEndRange) > -1)
                    end = textLen;
                else
                    end = normalizedValue.slice(0, end).split("\n").length - textInputRange.moveEnd("character", -textLen) - 1;                
            }
        }
        return {startPos: start, endPos: end};
    }
    try {
        start = input.selectionStart;
        end = input.selectionEnd;
    } catch (e) {
    }
    return {startPos: start, endPos: end};    
};
Selection.SetCaretPosition = function(input, caretPos) {
    if(typeof caretPos === "undefined" || caretPos < 0)
        caretPos = input.value.length;
    Selection.Set(input, caretPos, caretPos, true);
};
Selection.GetCaretPosition = function(element, isDialogMode) {
    var pos = 0;

    if("selectionStart" in element) {
        pos = element.selectionStart;
    } else if("selection" in document) {
        element.focus();
        var sel = document.selection.createRange(),
            selLength = document.selection.createRange().text.length;

        sel.moveStart("character", -element.value.length);
        pos = sel.text.length - selLength;
    }

    if(isDialogMode && !pos) {
        pos = element.value.length - 1;
    }

    return pos;
};
Selection.Clear = function() {
    try {
        if(window.getSelection) {
            window.getSelection().removeAllRanges();
        }
        else if(document.selection) {
            if(document.selection.empty)
                document.selection.empty();
            else if(document.selection.clear)
                document.selection.clear();
        }
    } catch(e) {

    }
};
Selection.ClearOnMouseMove = function(evt) {
    if(!Browser.IE || (evt.button != 0)) 
        Selection.Clear();
};
Selection.SetElementSelectionEnabled = function(element, value) {
    var userSelectValue = value ? "" : "none";
    var func = value ? Evt.DetachEventFromElement : Evt.AttachEventToElement;
    if(Browser.Firefox)
        element.style.MozUserSelect = userSelectValue;
    else if(Browser.WebKitFamily)
        element.style.webkitUserSelect = userSelectValue;
    else if(Browser.IE && Browser.Version > 10 || Browser.Edge)
        element.style.msUserSelect = userSelectValue;
    else if(Browser.Opera)
        func(element, "mousemove", Selection.Clear);
    else {
        func(element, "selectstart", ASPx.FalseFunction);
        func(element, "mousemove", Selection.Clear);
    }
};
Selection.SetElementAsUnselectable = function(element, isWithChild, recursive) {
    if(element && element.nodeType == 1) {
        element.unselectable = "on";
        if(Browser.NetscapeFamily)
            element.onmousedown = ASPx.FalseFunction;
        if((Browser.IE && Browser.Version >= 9) || Browser.WebKitFamily)
            Evt.AttachEventToElement(element, "mousedown", Evt.PreventEventAndBubble);
        if(isWithChild === true){
            for(var j = 0; j < element.childNodes.length; j ++)
                Selection.SetElementAsUnselectable(element.childNodes[j], (!!recursive ? true : false), (!!recursive));
        }
    }
};
Selection.AreEqual = function(selection1, selection2) {
    return selection1.startPos === selection2.startPos && selection1.endPos === selection2.endPos;
};
ASPx.Selection = Selection;

var MouseScroller = { };
MouseScroller.MinimumOffset = 10;
MouseScroller.Create = function(getElement, getScrollXElement, getScrollYElement, needPreventScrolling, vertRecursive, onMouseDown, onMouseMove, onMouseUp, onMouseUpMissed) {
    var element = getElement();
    if(!element) 
        return;
    if(!element.dxMouseScroller)
        element.dxMouseScroller = new MouseScroller.Extender(getElement, getScrollXElement, getScrollYElement, needPreventScrolling, vertRecursive, onMouseDown, onMouseMove, onMouseUp, onMouseUpMissed);
    return element.dxMouseScroller;
};
MouseScroller.Extender = function(getElement, getScrollXElement, getScrollYElement, needPreventScrolling, vertRecursive, onMouseDown, onMouseMove, onMouseUp, onMouseUpMissed) {
    this.getElement = getElement;
    this.getScrollXElement = getScrollXElement;
    this.getScrollYElement = getScrollYElement;
    this.needPreventScrolling = needPreventScrolling;
    this.vertRecursive = !!vertRecursive;

    this.createHandlers(onMouseDown || function() { }, onMouseMove || function() { }, onMouseUp || function() { }, onMouseUpMissed || function() { });
    this.update();
};
MouseScroller.Extender.prototype = {
    update: function() {
        if(this.element)
            Evt.DetachEventFromElement(this.element, ASPx.TouchUIHelper.touchMouseDownEventName, this.mouseDownHandler);

        this.element = this.getElement();
        Evt.AttachEventToElement(this.element, ASPx.TouchUIHelper.touchMouseDownEventName, this.mouseDownHandler);        
        Evt.AttachEventToElement(this.element, "click", this.mouseClickHandler);   
        if(Browser.MSTouchUI && this.element.className.indexOf(ASPx.TouchUIHelper.msTouchDraggableClassName) < 0)
            this.element.className += " " + ASPx.TouchUIHelper.msTouchDraggableClassName;

        this.scrollXElement = this.getScrollXElement();
        this.scrollYElement = this.getScrollYElement();
    },
    createHandlers: function(onMouseDown, onMouseMove, onMouseUp, onMouseUpMissed) {
        var mouseDownCounter = 0;
        this.onMouseDown = onMouseDown;
        this.onMouseMove = onMouseMove;
        this.onMouseUp = onMouseUp;        
        this.mouseDownHandler = function(e) {
            if(mouseDownCounter++ > 0) {
                this.finishScrolling();
                onMouseUpMissed();
            }
            var eventSource = Evt.GetEventSource(e);
            var requirePreventCustonScroll = ASPx.IsExists(ASPx.TouchUIHelper.RequirePreventCustomScroll) && ASPx.TouchUIHelper.RequirePreventCustomScroll(eventSource, this.element);
            this.requirePreventScroll = requirePreventCustonScroll || this.needPreventScrolling && this.needPreventScrolling(eventSource);
            if(this.requirePreventScroll)
                return;
            this.scrollableTreeLine = this.GetScrollableElements();
            this.firstX = this.prevX = Evt.GetEventX(e);
            this.firstY = this.prevY = Evt.GetEventY(e);
            Evt.AttachEventToDocument(ASPx.TouchUIHelper.touchMouseMoveEventName, this.mouseMoveHandler);
            Evt.AttachEventToDocument(ASPx.TouchUIHelper.touchMouseUpEventName, this.mouseUpHandler);
            this.onMouseDown(e);
        }.aspxBind(this);
        this.mouseMoveHandler = function(e) {
            if(ASPx.TouchUIHelper.isGesture)
                return;
            var x = Evt.GetEventX(e);
            var y = Evt.GetEventY(e);
            var xDiff = this.prevX - x;
            var yDiff = this.prevY - y;
            if(this.vertRecursive) {
                var isTopDirection = yDiff < 0;
                this.scrollYElement = this.GetElementForVertScrolling(isTopDirection, this.prevIsTopDirection, this.scrollYElement);
                this.prevIsTopDirection = isTopDirection;
            }
            if(this.scrollXElement && xDiff != 0)
                this.scrollXElement.scrollLeft += xDiff;
            if(this.scrollYElement && yDiff != 0) {
                this.scrollYElement.scrollTop += yDiff;
                var isOuterScrollableElement = this.scrollableTreeLine[this.scrollableTreeLine.length - 1] == this.scrollYElement;
                if(isOuterScrollableElement)
                    y += yDiff;
            }

            this.prevX = x;
            this.prevY = y;
            e.preventDefault();

            this.onMouseMove(e);
        }.aspxBind(this);
        this.mouseUpHandler = function(e) {
            this.finishScrolling();
            this.onMouseUp(e);
        }.aspxBind(this);
        this.mouseClickHandler = function(e){
            if(this.requirePreventScroll)
                return;
            var xDiff = this.firstX - Evt.GetEventX(e);
            var yDiff = this.firstY - Evt.GetEventY(e);
            if(xDiff > MouseScroller.MinimumOffset || yDiff > MouseScroller.MinimumOffset)
                return Evt.PreventEventAndBubble(e);
        }.aspxBind(this);

        this.finishScrolling = function() {
            Evt.DetachEventFromDocument(ASPx.TouchUIHelper.touchMouseMoveEventName, this.mouseMoveHandler);
            Evt.DetachEventFromDocument(ASPx.TouchUIHelper.touchMouseUpEventName, this.mouseUpHandler);
            this.scrollableTreeLine = [];
            this.prevIsTopDirection = null;
            mouseDownCounter--;
        };
    },
    GetScrollableElements: function() {
        if(!this.vertRecursive) return [ ];
        var outerScrollableElementTag = ASPx.Browser.IE ? "HTML" : "BODY";
        return ASPx.GetElementTreeLine(this.element, null, function(el) { return el == document; })
            .filter(function(el) { return ASPx.IsScrollableElement(el, false, true) || el.tagName == outerScrollableElementTag; }.bind(this));
    },
    GetElementForVertScrolling: function(currentIsTop, prevIsTop, prevElement) {
        if(prevElement && currentIsTop === prevIsTop && this.GetVertScrollExcess(prevElement, currentIsTop) > 0)
            return prevElement;
        for(var i = 0; i < this.scrollableTreeLine.length; i++) {
            var element = this.scrollableTreeLine[i];
            var excess = this.GetVertScrollExcess(element, currentIsTop);
            if(excess > 0)
                return element;
        }
        return null;
    },
    GetVertScrollExcess: function(element, isTop) {
        if(isTop)
            return element.scrollTop;
        var isBodyElement = element.tagName == "BODY";
        var clientHeight = isBodyElement ? ASPx.GetDocumentClientHeight() : element.clientHeight;
        return element.scrollHeight - clientHeight - element.scrollTop;
    }
};
ASPx.MouseScroller = MouseScroller;

var Evt = { };
Evt.GetEvent = function(evt){
    return (typeof(event) != "undefined" && event != null && Browser.IE) ? event : evt; 
};
Evt.IsEventPrevented = function(evt) {
    return evt.defaultPrevented || evt.returnValue === false;
};
Evt.PreventEvent = function(evt){
    if(evt.preventDefault)
        evt.preventDefault();
    else
        evt.returnValue = false;
    return false;
};
Evt.PreventEventAndBubble = function(evt){
    Evt.PreventEvent(evt);
    if(evt.stopPropagation)
        evt.stopPropagation();
    evt.cancelBubble = true;
    return false;
};
Evt.CancelBubble = function(evt){
    evt.cancelBubble = true;
    return false;
};

Evt.PreventImageDragging = function(image) {
    if(image)
        image.ondragstart = function() { return false; };
};
Evt.PreventDragStart = function(evt) {
    evt = Evt.GetEvent(evt);
    var element = Evt.GetEventSource(evt);
    if(element.releaseCapture)
        element.releaseCapture(); 
    return false;
};
Evt.PreventElementDrag = function(element) {
    if(Browser.IE)
        Evt.AttachEventToElement(element, "dragstart", Evt.PreventEvent);
    else
        Evt.AttachEventToElement(element, "mousedown", Evt.PreventEvent);
};
Evt.PreventElementDragAndSelect = function(element, skipMouseMove, skipIESelect){
    if(Browser.WebKitFamily)
        Evt.AttachEventToElement(element, "selectstart", Evt.PreventEventAndBubble);
    if(Browser.IE){
        if(!skipIESelect)
            Evt.AttachEventToElement(element, "selectstart", ASPx.FalseFunction);
        if(!skipMouseMove)
            Evt.AttachEventToElement(element, "mousemove", Selection.ClearOnMouseMove);
        Evt.AttachEventToElement(element, "dragstart", Evt.PreventDragStart);
    }
};
Evt.GetEventSource = function(evt){
    if(!ASPx.IsExists(evt)) return null; 
    return evt.srcElement ? evt.srcElement : evt.target;
};
Evt.GetKeyCode = function(srcEvt) {
    return Browser.NetscapeFamily || Browser.Opera ? srcEvt.which : srcEvt.keyCode;
};
function clientEventRequiresDocScrollCorrection() {
    var isSafariVerLess3 = Browser.Safari && Browser.Version < 3,
        isMacOSMobileVerLess51 = Browser.MacOSMobilePlatform && Browser.Version < 5.1;

    return Browser.AndroidDefaultBrowser || Browser.AndroidChromeBrowser || !(isSafariVerLess3 || isMacOSMobileVerLess51);
}
Evt.GetEventX = function(evt){
    if(ASPx.TouchUIHelper.isTouchEvent(evt))
        return ASPx.TouchUIHelper.getEventX(evt);
    return evt.clientX + (clientEventRequiresDocScrollCorrection() ? ASPx.GetDocumentScrollLeft() : 0);
};
Evt.GetEventY = function(evt){
    if(ASPx.TouchUIHelper.isTouchEvent(evt))
        return ASPx.TouchUIHelper.getEventY(evt);
    return evt.clientY + (clientEventRequiresDocScrollCorrection() ? ASPx.GetDocumentScrollTop() : 0 );
};
Evt.IsLeftButtonPressed = function(evt) {
    if(ASPx.TouchUIHelper.isTouchEvent(evt))
        return true;

    evt = Evt.GetEvent(evt);
    if(!evt) return false;
    if(Browser.IE && Browser.Version < 11) {
        if(Browser.MSTouchUI)
            return true;
        return evt.button % 2 == 1; // B213431
    } else if(Browser.WebKitFamily) {
        if(evt.type === "pointermove")
            return evt.buttons === 1;
        return evt.which == 1;
    } else if(Browser.NetscapeFamily || Browser.Edge || (Browser.IE && Browser.Version >= 11)) {
        if(evt.type === ASPx.TouchUIHelper.touchMouseMoveEventName)
            return evt.buttons === 1;
        return evt.which == 1;
    } else if(Browser.Opera)
        return evt.button == 0;

    return true;
};
Evt.IsRightButtonPressed = function(evt){
    evt = Evt.GetEvent(evt);
    if(!ASPx.IsExists(evt)) return false;
    if(Browser.IE || Browser.Edge) {
        if(evt.type === "pointermove")
            return evt.buttons === 2;
        return evt.button == 2;
    }
    else if(Browser.NetscapeFamily || Browser.WebKitFamily)
        return evt.which == 3;
    else if (Browser.Opera)
        return evt.button == 1;
    return true;
};
Evt.GetWheelDelta = function(evt) {
    var ret;
    if(Browser.NetscapeFamily && Browser.MajorVersion < 17)
        ret = -evt.detail;
    else if(Browser.Safari)
        ret = evt.wheelDelta;
    else
        ret = -evt.deltaY;
    if(Browser.Opera && Browser.Version < 9)
        ret = -ret;
    return ret;
};
Evt.IsWheelEventWithDirection = function(evt) {
    return ASPx.Data.ArrayContains(["wheel", "mousewheel"], evt.type);
};
Evt.GetWheelDeltaX = function(evt) {
    if(evt.type === "wheel")
        return -evt.deltaX;
    if(evt.type === "mousewheel")
        return evt.wheelDeltaX;
};
Evt.GetWheelDeltaY = function(evt) {
    if(evt.type === "wheel")
        return -evt.deltaY;
    if(evt.type === "mousewheel")
        return evt.wheelDeltaY;
};

Evt.IsPassiveListenersSupported = function() {
    if(Browser.Chrome && Browser.MajorVersion > 69 || Browser.Edge && Browser.MajorVersion > 15 || Browser.Firefox && Browser.MajorVersion > 62)
        return true;
    if(Evt.isPassiveListenersSupported === undefined) {
        Evt.isPassiveListenersSupported = false;
        try {
            var options = Object.defineProperty({}, "passive", { get: function() { Evt.isPassiveListenersSupported = true; } });
            window.addEventListener("test", options, options);
            window.removeEventListener("test", options, options);
        }
        catch(err) { Evt.isPassiveListenersSupported = false; }
    }
    return !!Evt.isPassiveListenersSupported;
};
Evt.AttachEventToElement = function(element, eventName, func, onlyBubbling, passive) {
    if(element.addEventListener)
        element.addEventListener(eventName, func, Evt.IsPassiveListenersSupported() ? { capture: !onlyBubbling, passive: !!passive } : !onlyBubbling);
    else
        element.attachEvent("on" + eventName, func);
};
Evt.DetachEventFromElement = function(element, eventName, func) {
    if(element.removeEventListener)
        element.removeEventListener(eventName, func, true);
    else
        element.detachEvent("on" + eventName, func);
};
Evt.AttachEventToDocument = function(eventName, func) {
    var attachingAllowed = ASPx.TouchUIHelper.onEventAttachingToDocument(eventName, func);
    if(attachingAllowed)
        Evt.AttachEventToDocumentCore(eventName, func);
};
Evt.AttachEventToDocumentCore = function(eventName, func) {
    Evt.AttachEventToElement(document, eventName, func);
};
Evt.DetachEventFromDocument = function(eventName, func) {
    Evt.DetachEventFromDocumentCore(eventName, func);
    ASPx.TouchUIHelper.onEventDettachedFromDocument(eventName, func);
};
Evt.DetachEventFromDocumentCore = function(eventName, func){
    Evt.DetachEventFromElement(document, eventName, func);
};
Evt.GetMouseWheelEventName = function() {
    if(Browser.Safari)
        return "mousewheel";
    if(Browser.NetscapeFamily && Browser.MajorVersion < 17)
        return "DOMMouseScroll";
    return "wheel";
};
Evt.AttachMouseEnterToElement = function (element, onMouseOverHandler, onMouseOutHandler) {
    Evt.AttachEventToElement(element, ASPx.TouchUIHelper.pointerEnabled ? ASPx.TouchUIHelper.pointerOverEventName : "mouseover", function (evt) { mouseEnterHandler(evt, element, onMouseOverHandler, onMouseOutHandler); });
    Evt.AttachEventToElement(element, ASPx.TouchUIHelper.pointerEnabled ? ASPx.TouchUIHelper.pointerOutEventName : "mouseout", function (evt) { mouseEnterHandler(evt, element, onMouseOverHandler, onMouseOutHandler); });
};
Evt.GetEventRelatedTarget = function(evt, isMouseOverEvent) {
    return evt.relatedTarget || (isMouseOverEvent ? evt.srcElement : evt.toElement);
};
function mouseEnterHandler(evt, element, onMouseOverHandler, onMouseOutHandler) {
    var isMouseOverExecuted = !!element.dxMouseOverExecuted;
    var isMouseOverEvent = (evt.type == "mouseover" || evt.type == ASPx.TouchUIHelper.pointerOverEventName);
    if(isMouseOverEvent && isMouseOverExecuted || !isMouseOverEvent && !isMouseOverExecuted)
        return;
    var source = Evt.GetEventRelatedTarget(evt, isMouseOverEvent);
    if(!ASPx.GetIsParent(element, source)) {
        element.dxMouseOverExecuted = isMouseOverEvent;
        if(isMouseOverEvent)
            onMouseOverHandler(element);
        else
            onMouseOutHandler(element);
    }
    else if(isMouseOverEvent && !isMouseOverExecuted) {
        element.dxMouseOverExecuted = true;
        onMouseOverHandler(element);
    }
}
Evt.DispatchEvent = function(target, eventName, canBubble, cancellable) {
    var event;

    if(Browser.IE && Browser.Version < 9) {
        eventName = "on" + eventName;

        if(eventName in target) {
            event = document.createEventObject();
            target.fireEvent("on" + eventName, event);
        }
    } else {
        event = document.createEvent("Event");
        event.initEvent(eventName, canBubble || false, cancellable || false);
        target.dispatchEvent(event);
    }
};
// Method doesn't work in WebKit browsers
Evt.EmulateDocumentOnMouseDown = function(evt) {
    Evt.EmulateOnMouseDown(document, evt);
};
Evt.EmulateOnMouseDown = function(element, evt) {
    if(Browser.IE && Browser.Version < 9)
        element.fireEvent("onmousedown", evt);
    else if(!Browser.WebKitFamily){
        var emulatedEvt = document.createEvent("MouseEvents");
        emulatedEvt.initMouseEvent("mousedown", true, true, window, 0, evt.screenX, evt.screenY, 
            evt.clientX, evt.clientY, evt.ctrlKey, evt.altKey, evt.shiftKey, false, 0, null);
        element.dispatchEvent(emulatedEvt);
    }
};
Evt.EmulateOnMouseEvent = function (type, element, evt) {
    evt.type = type;
    var emulatedEvt = document.createEvent("MouseEvents");
    emulatedEvt.initMouseEvent(type, true, true, window, 0, evt.screenX, evt.screenY,
        evt.clientX, evt.clientY, evt.ctrlKey, evt.altKey, evt.shiftKey, false, 0, null);
    emulatedEvt.target = element;
    element.dispatchEvent(emulatedEvt);
};
Evt.EmulateMouseClick = function (element, evt) {
    var x = ASPx.GetElementOffsetWidth(element) / 2;
    var y = ASPx.GetElementOffsetHeight(element) / 2;
    if (!evt)
        evt = {
            bubbles: true,
            cancelable: true,
            view: window,
            detail: 1,
            screenX: 0,
            screenY: 0,
            clientX: x,
            clientY: y,
            ctrlKey: false,
            altKey: false,
            shiftKey: false,
            metaKey: false,
            button: 0,
            relatedTarget: null
        };
    Evt.EmulateOnMouseEvent("mousedown", element, evt);
    Evt.EmulateOnMouseEvent("mouseup", element, evt);
    Evt.EmulateOnMouseEvent("click", element, evt);
};
Evt.DoElementClick = function(element) {
    try{
        element.click();
    }
    catch(e){ // B153651
    }
};
Evt.IsActionKeyPressed = function(evt) {
    return evt.keyCode === ASPx.Key.Space ||
           evt.keyCode === ASPx.Key.Enter ||
          (evt.keyCode === ASPx.Key.Down && evt.altKey);
};
Evt.InvokeMouseClickByKeyDown = function(evt, handler) {
    if(Evt.IsActionKeyPressed(evt)) {
        ASPx.Evt.PreventEvent(evt);	
		if(!handler)
            ASPx.Evt.GetEventSource(evt).onclick();
        else
            handler(evt);
    }
};

Evt.AttachContextMenuToElement = function (element, handler, onlyBubbling) {
    if (ASPx.TouchUIHelper.useLongTapHelper())
        element.detachContextMenuEventHandler = ASPx.TouchUIHelper.attachLongTapHandler(element, handler, onlyBubbling);
    else
        Evt.AttachEventToElement(element, "contextmenu", handler, onlyBubbling);
};
Evt.DetachContextMenuFromElement = function (element, handler) {
    if (element.detachContextMenuEventHandler)
        element.detachContextMenuEventHandler();
    else
        Evt.DetachEventFromElement(element, "contextmenu", handler);
};
ASPx.Evt = Evt;

var Attr = { };

Attr.GetAttribute = function(obj, attrName){
    if(obj.getAttribute)
        return obj.getAttribute(attrName);
    else if(obj.getPropertyValue) {
        if(Browser.Firefox) { //T644613
            try {
                return obj.getPropertyValue(attrName);
            } catch(e) {
                return obj[attrName];
            }
        }
        return obj.getPropertyValue(attrName);
    }
    return null;
};
Attr.SetAttribute = function(obj, attrName, value){
    if(obj.setAttribute) {
        if(isSourceResetRequired() && attrName.toLowerCase() === "src") // T481593
            obj.setAttribute(attrName, "");
        obj.setAttribute(attrName, value);
    } else if(obj.setProperty)
        obj.setProperty(attrName, value, "");
};
Attr.ToggleAttribute = function(obj, attrName, value, condition) {
    if(condition)
        Attr.SetAttribute(obj, attrName, value);
    else
        Attr.RemoveAttribute(obj, attrName);
};
Attr.RemoveAttribute = function(obj, attrName){
    if(obj.removeAttribute)
        obj.removeAttribute(attrName);
    else if(obj.removeProperty)
        obj.removeProperty(attrName);
};
Attr.IsExistsAttribute = function(obj, attrName){
    var value = Attr.GetAttribute(obj, attrName);
    return (value != null) && (value !== "");
};
Attr.SetOrRemoveAttribute = function(obj, attrName, value) {
    if(!value)
        Attr.RemoveAttribute(obj, attrName);
    else
        Attr.SetAttribute(obj, attrName, value);
};
Attr.SaveAttribute = function(obj, attrName, savedObj, savedAttrName){
    if(!Attr.IsExistsAttribute(savedObj, savedAttrName)){
        var oldValue = Attr.IsExistsAttribute(obj, attrName) ? Attr.GetAttribute(obj, attrName) : ASPx.EmptyObject;
        Attr.SetAttribute(savedObj, savedAttrName, oldValue);
    }
};
Attr.SaveStyleAttribute = function(obj, attrName){
    Attr.SaveAttribute(obj.style, attrName, obj, "saved" + attrName);
};
Attr.ChangeAttributeExtended = function(obj, attrName, savedObj, savedAttrName, newValue){
    Attr.SaveAttribute(obj, attrName, savedObj, savedAttrName);
    Attr.SetAttribute(obj, attrName, newValue);
};
Attr.ChangeAttribute = function(obj, attrName, newValue){
    Attr.ChangeAttributeExtended(obj, attrName, obj, "saved" + attrName, newValue);
};
Attr.ChangeStyleAttribute = function(obj, attrName, newValue){
    Attr.ChangeAttributeExtended(obj.style, attrName, obj, "saved" + attrName, newValue);
};
Attr.ResetAttributeExtended = function(obj, attrName, savedObj, savedAttrName){
    Attr.SaveAttribute(obj, attrName, savedObj, savedAttrName);
    Attr.SetAttribute(obj, attrName, "");
    Attr.RemoveAttribute(obj, attrName);
};
Attr.ResetAttribute = function(obj, attrName){
    Attr.ResetAttributeExtended(obj, attrName, obj, "saved" + attrName);
};
Attr.ResetStyleAttribute = function(obj, attrName){
    Attr.ResetAttributeExtended(obj.style, attrName, obj, "saved" + attrName);
};
Attr.RestoreAttributeExtended = function(obj, attrName, savedObj, savedAttrName){
    if(Attr.IsExistsAttribute(savedObj, savedAttrName)){
        var oldValue = Attr.GetAttribute(savedObj, savedAttrName);
        if(oldValue != ASPx.EmptyObject)
            Attr.SetAttribute(obj, attrName, oldValue);
        else
            Attr.RemoveAttribute(obj, attrName);
        Attr.RemoveAttribute(savedObj, savedAttrName);
        return true;
    }
    return false;
};
Attr.RestoreAttribute = function(obj, attrName){
    return Attr.RestoreAttributeExtended(obj, attrName, obj, "saved" + attrName);
};
Attr.RestoreStyleAttribute = function(obj, attrName){
    return Attr.RestoreAttributeExtended(obj.style, attrName, obj, "saved" + attrName);
};
Attr.CopyAllAttributes = function(sourceElem, destElement) {
    var attrs = sourceElem.attributes;
    for(var n = 0; n < attrs.length; n++) {
	    var attr = attrs[n];
	    if(attr.specified) {
	        var attrName = attr.nodeName;
	        var attrValue = sourceElem.getAttribute(attrName, 2);
	        if(attrValue == null)
	            attrValue = attr.nodeValue;
	        destElement.setAttribute(attrName, attrValue, 0); // 0 : Case Insensitive
		}
	}
	if(sourceElem.style.cssText !== '')
	    destElement.style.cssText = sourceElem.style.cssText;
};
Attr.RemoveAllAttributes = function(element, excludedAttributes) {
    var excludedAttributesHashTable = {};
    if(excludedAttributes)
        excludedAttributesHashTable = Data.CreateHashTableFromArray(excludedAttributes);
        
    if(element.attributes) {
        var attrArray = element.attributes;
        for(var i = 0; i < attrArray.length; i++) {
            var attrName = attrArray[i].name;
            if(!ASPx.IsExists(excludedAttributesHashTable[attrName.toLowerCase()])) {
                try {
                    attrArray.removeNamedItem(attrName);
                } catch (e) { }
            }
        }
    }
};
Attr.RemoveStyleAttribute = function(element, attrName) {
    if(element.style) {
        if(Browser.Firefox && element.style[attrName]) // attribute isn't removed if it isn't empty
            element.style[attrName] = "";
        if(element.style.removeAttribute && element.style.removeAttribute != "")
            element.style.removeAttribute(attrName);
        else if(element.style.removeProperty && element.style.removeProperty != "")
            element.style.removeProperty(attrName);
    }
};
Attr.RemoveAllStyles = function(element) {
    if(element.style) {
        /* jshint ignore:start */
        for(var key in element.style)
            Attr.RemoveStyleAttribute(element, key);
        /* jshint ignore:end */
       Attr.RemoveAttribute(element, "style");
    }
};
Attr.GetTabIndexAttributeName = function(){
    return Browser.IE  ? "tabIndex" : "tabindex";
};
Attr.ChangeTabIndexAttribute = function(element){
    var attribute = Attr.GetTabIndexAttributeName();    
    if(Attr.GetAttribute(element, attribute) != -1)
       Attr.ChangeAttribute(element, attribute, -1);
};
Attr.SaveTabIndexAttributeAndReset = function(element) {
    var attribute = Attr.GetTabIndexAttributeName();
    Attr.SaveAttribute(element, attribute, element, "saved" + attribute);
    Attr.SetAttribute(element, attribute, -1);
};
Attr.RestoreTabIndexAttribute = function(element){
    var attribute = Attr.GetTabIndexAttributeName();
    if(Attr.IsExistsAttribute(element, attribute)) {
        if(Attr.GetAttribute(element, attribute) == -1) {
            if(Attr.IsExistsAttribute(element, "saved" + attribute)){
                var oldValue = Attr.GetAttribute(element, "saved" + attribute);
                if(oldValue != ASPx.EmptyObject)
                    Attr.SetAttribute(element, attribute, oldValue);
                else {
                    if(Browser.WebKitFamily) 
                        Attr.SetAttribute(element, attribute, 0); 
                    Attr.RemoveAttribute(element, attribute);            
                }
                Attr.RemoveAttribute(element, "saved" + attribute); 
            }
        }
    }
};

Attr.ChangeAttributesMethod = function(enabled){
    return enabled ? Attr.RestoreAttribute : Attr.ResetAttribute;
};
Attr.InitiallyChangeAttributesMethod = function(enabled){
    return enabled ? Attr.ChangeAttribute : Attr.ResetAttribute;
};
Attr.ChangeStyleAttributesMethod = function(enabled){
    return enabled ? Attr.RestoreStyleAttribute : Attr.ResetStyleAttribute;
};
Attr.InitiallyChangeStyleAttributesMethod = function(enabled){
    return enabled ? Attr.ChangeStyleAttribute : Attr.ResetStyleAttribute;
};
Attr.ChangeEventsMethod = function(enabled){
    return enabled ? Evt.AttachEventToElement : Evt.DetachEventFromElement;
};
Attr.ChangeDocumentEventsMethod = function(enabled){
    return enabled ? Evt.AttachEventToDocument : Evt.DetachEventFromDocument;
};
Attr.ChangeCellSpanCount = function(cell, value, isColumnSpan) {
    if(!cell) return;
    var propertyKey = isColumnSpan ? "colSpan" : "rowSpan";
    var prevValue = cell[propertyKey];
    if(value > 1)
        cell[propertyKey] = value;
    else if(prevValue !== 1)
        Attr.RemoveAttribute(cell, propertyKey);
};

function isSourceResetRequired() {
    return Browser.IE && Browser.MajorVersion >= 11;
}

ASPx.Attr = Attr;

var Aria = {
    atomic: "aria-atomic",
    checked: "aria-checked",
    descendant: "aria-activedescendant",
    described: "aria-describedby",
    disabled: "aria-disabled",
    expanded: "aria-expanded",
    haspopup: "aria-haspopup",
    invalid: "aria-invalid",
    label: "aria-label",
    labelled: "aria-labelledby",
    level: "aria-level",
    owns: "aria-owns",
    posinset: "aria-posinset",
    role: "role",
    selected: "aria-selected",
    setsize: "aria-setsize",
    valuemax: "aria-valuemax",
    valuemin: "aria-valuemin",
    valuenow: "aria-valuenow"
};
Aria.SetOrRemoveDescendant = function(obj, value) {
    ASPx.Attr.SetOrRemoveAttribute(obj, Aria.descendant, value);
};
Aria.SetOrRemoveLabel = function(obj, value) {
    ASPx.Attr.SetOrRemoveAttribute(obj, Aria.label, value);
};
Aria.AppendLabel = function(obj, value, checkExists) {
    var currentValue = ASPx.Attr.GetAttribute(obj, Aria.label) || "";
    var resultParts = [ ];
    if(currentValue)
        resultParts.push(currentValue);
    var needAppendValue = value && (!checkExists || currentValue.indexOf(value) == -1);
    if(needAppendValue)
        resultParts.push(value);
    ASPx.Attr.SetAttribute(obj, Aria.label, resultParts.join(" "));
};
Aria.SetOrRemoveLabelled = function(obj, value) {
    ASPx.Attr.SetOrRemoveAttribute(obj, Aria.labelled, value);
};
Aria.SetApplicationRole = function(obj) {
     ASPx.Attr.SetAttribute(obj, Aria.role, "application");
};
Aria.SetSilence = function(obj) {
    ASPx.Attr.SetAttribute(obj, Aria.label, ";");
};
Aria.SetExpanded = function(obj, expanded) {
    if(!obj || !ASPx.Attr.GetAttribute(obj, Aria.expanded)) return;

    Aria.SetBoolAttribute(obj, Aria.expanded, expanded);
};
Aria.SetAtomic = function(obj, value) {
    Aria.SetBoolAttribute(obj, Aria.atomic, value);
};
Aria.SetBoolAttribute = function(obj, attribute, value) {
    if(value)
        ASPx.Attr.SetAttribute(obj, attribute, true);
    else 
        ASPx.Attr.SetAttribute(obj, attribute, false);
};

ASPx.Attr.Aria = Aria;

var Color = { };
function _aspxToHex(d) {
    return (d < 16) ? ("0" + d.toString(16)) : d.toString(16);
}
Color.RGBRegexp = /rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/;
Color.RGBARegexp = /rgba?\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*,?\s*([0-9]*\.?[0-9]*)\s*\)/;
Color.ColorToHexadecimal = function(colorValue, isRGBA) {
    if(typeof(colorValue) == "number") {
        var r = colorValue & 0xFF;
        var g = (colorValue >> 8) & 0xFF;
        var b = (colorValue >> 16) & 0xFF;
        return "#" + _aspxToHex(r) + _aspxToHex(g) + _aspxToHex(b);
    }
    if(colorValue && (colorValue.substr(0, 3).toLowerCase() == "rgb")) {
        // in rgb(...) form -- Mozilla
        var regResult = colorValue.toLowerCase().match(isRGBA ? Color.RGBARegexp : Color.RGBRegexp);
        if(regResult) {
            var r = parseInt(regResult[1]);
            var g = parseInt(regResult[2]);
            var b = parseInt(regResult[3]);
            if (isRGBA)
                return { r: r, g: g, b: b, a: regResult[4] !== undefined ? parseFloat(regResult[4]) : 1 };
            return "#" + _aspxToHex(r) + _aspxToHex(g) + _aspxToHex(b);
        }
        return null;
    }    
    if(colorValue && (colorValue.charAt(0) == "#"))
        return colorValue;
    return null;
};
Color.Names = {
    AddColorNames: function(stringResourcesObj) {
        if(stringResourcesObj) {
            for(var key in stringResourcesObj)
                if(stringResourcesObj.hasOwnProperty(key))
                    this[key] = stringResourcesObj[key];
        }
    }
};

ASPx.Color = Color;

var Url = { };
Url.Navigate = function(url, target) {
    var javascriptPrefix = "javascript:";
    if(!url || url === "")
        return;
    else if(url.indexOf(javascriptPrefix) != -1) 
        eval(url.substr(javascriptPrefix.length));
    else {
        try{
            if(target != "")
                navigateTo(url, target);
            else
                location.href = url;
        }
        catch(e){
            // fix IE bug - B145116
        }
    }
};
Url.NavigateByLink = function(linkElement) {
    Url.Navigate(Attr.GetAttribute(linkElement, "href"), linkElement.target);
};
Url.GetAbsoluteUrl = function(url) {
    if(url)
        url = Url.getURLObject(url).href;
    return url;
};
Url.Redirect = function(url) {
    if(!ASPx.Browser.IE)
        window.location.href = url;
    else { // B194434
        var fakeLink = document.createElement("a");
        fakeLink.href = url;
        document.body.appendChild(fakeLink);
        try { fakeLink.click(); } catch(e) { } // T307446
    }
};

var absolutePathPrefixes = 
    [ "about:", "file:///", "ftp://", "gopher://", "http://", "https://", "javascript:", "mailto:", "news:", "res://", "telnet://", "view-source:" ];

Url.isAbsoluteUrl = function(url) {
    if (url) {
        for (var i = 0; i < absolutePathPrefixes.length; i++) {
            if(url.indexOf(absolutePathPrefixes[i]) == 0)
                return true;
        }
    }
    return false;
};

Url.getURLObject = function(url) {
    var link = document.createElement('A');
    link.href = url || "";
    return { 
        href: link.href,
        protocol: link.protocol,
        host: link.host,
        port: link.port,
        pathname: link.pathname,
        search: link.search,
        hash: link.hash
    };    
};

Url.getRootRelativeUrl = function(url) {
    return getRelativeUrl(url, !Url.isRootRelativeUrl(url), true);    
};

Url.getPathRelativeUrl = function(url) {
    return getRelativeUrl(url, !Url.isPathRelativeUrl(url), false);
};

function getRelativeUrl(url, isValid, isRootRelative) {
    if(url && !(/data:([^;]+\/?[^;]*)(;charset=[^;]*)?(;base64,)/.test(url)) && isValid) {
        var urlObject = Url.getURLObject(url);
        var baseUrlObject = Url.getURLObject();
        if(!Url.isAbsoluteUrl(url) || urlObject.host === baseUrlObject.host && urlObject.protocol === baseUrlObject.protocol) {
            url = urlObject.pathname;
            if(!isRootRelative)
                url = getPathRelativeUrl(baseUrlObject.pathname, url);
            url = url + urlObject.search + urlObject.hash;
        }
    }
    return url;         
}
    
function getPathRelativeUrl(baseUrl, url) {
    var requestSegments = getSegments(baseUrl, false);
    var urlSegments = getSegments(url, true);
    return buildPathRelativeUrl(requestSegments, urlSegments, 0, 0, "");
}
function getSegments(url, addTail) {
    var segments = [];
    var startIndex = 0;
    var endIndex = -1;
    while ((endIndex = url.indexOf("/", startIndex)) != -1) {
        segments.push(url.substring(startIndex, ++endIndex));
        startIndex = endIndex;
    }
    if(addTail && startIndex < url.length)
        segments.push(url.substring(startIndex, url.length));    
    return segments;
}

function buildPathRelativeUrl(requestSegments, urlSegments, reqIndex, urlIndex, buffer) {
    if(urlIndex >= urlSegments.length)
        return buffer;
    if(reqIndex >= requestSegments.length)
        return buildPathRelativeUrl(requestSegments, urlSegments, reqIndex, urlIndex + 1, buffer + urlSegments[urlIndex]);
    if(requestSegments[reqIndex] === urlSegments[urlIndex] && urlIndex === reqIndex)
        return buildPathRelativeUrl(requestSegments, urlSegments, reqIndex + 1, urlIndex + 1, buffer);
    return buildPathRelativeUrl(requestSegments, urlSegments, reqIndex + 1, urlIndex, buffer + "../");
}

Url.isPathRelativeUrl = function(url) {
    return !!url && !Url.isAbsoluteUrl(url) && url.indexOf("/") != 0;  
};

Url.isRootRelativeUrl = function(url) {
    return !!url && !Url.isAbsoluteUrl(url) && url.indexOf("/") == 0 && url.indexOf("//") != 0;
};

function navigateTo(url, target) {
    var lowerCaseTarget = target.toLowerCase();
    if("_top" == lowerCaseTarget)
        top.location.href = url;
    else if("_self" == lowerCaseTarget)
        location.href = url;
    else if("_search" == lowerCaseTarget)
        openInNewWindow(url);
    else if("_media" == lowerCaseTarget)
        openInNewWindow(url);
    else if("_parent" == lowerCaseTarget)
        window.parent.location.href = url;
    else if("_blank" == lowerCaseTarget)
        openInNewWindow(url);
    else {
        var frame = getFrame(top.frames, target);
        if(frame != null)
            frame.location.href = url;
        else
            openInNewWindow(url);
    }
}
function openInNewWindow(url) {
    if(ASPx.Browser.Safari)
        openInNewWindowViaIframe(url);
    else {
        var newWindow = window.open();
        newWindow.opener = null;
        newWindow.location = url;
    }
}
function openInNewWindowViaIframe(url) {
    var iframe = document.createElement('iframe');
    iframe.style.display = 'none';
    document.body.appendChild(iframe);
    var iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

    var openArgs = '"' + url + '"';
    var script = iframeDoc.createElement('script');
    script.type = 'text/javascript';
    script.text = 'window.parent = null; ' +
        'window.top = null;' +
        'window.frameElement = null;' +
        'var child = window.open(' + openArgs + ');' +
        'child.opener = null';
    iframeDoc.body.appendChild(script);

    document.body.removeChild(iframe);
}
ASPx.Url = Url;

var Json = { };
function isValid(JsonString) {
    return !(/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(JsonString.replace(/"(\\.|[^"\\])*"/g, '')));
}
Json.Eval = function(jsonString, controlName) {
    if(isValid(jsonString))
        return eval("(" + jsonString + ")");
    else
        throw new Error(controlName + " received incorrect JSON-data: " + jsonString);
};
Json.ToJson = function(param, skipEncodeHtml){
    var paramType = typeof(param);
    if((paramType == "undefined") || (param == null))
        return null;
    if((paramType == "object") && (typeof(param.__toJson) == "function"))
        return param.__toJson();
    if((paramType == "number") || (paramType == "boolean"))
        return param;
    if(param.constructor == Date)
        return dateToJson(param);
    if(paramType == "string") {
        var result = param.replace(/\\/g, "\\\\");
        result = result.replace(/"/g, "\\\"");
        result = result.replace(/\n/g, "\\n");
        result = result.replace(/\r/g, "\\r");
        // For request validation
        if(!skipEncodeHtml) {
            result = result.replace(/</g, "\\u003c");
            result = result.replace(/>/g, "\\u003e");
        }
        return "\"" + result + "\"";
    }
    if(param.constructor == Array){
        var values = [];
        for(var i = 0; i < param.length; i++) {
            var jsonValue = Json.ToJson(param[i], skipEncodeHtml);
            if(jsonValue === null)
                jsonValue = "null";
            values.push(jsonValue);
        }
        return "[" + values.join(",") + "]";
    }
    var exceptKeys = {};
    if(ASPx.Ident.IsArray(param.__toJsonExceptKeys))
        exceptKeys = Data.CreateHashTableFromArray(param.__toJsonExceptKeys);
    exceptKeys["__toJsonExceptKeys"] = 1;
    var values = [];
    for(var key in param) {
        if(param.hasOwnProperty(key)) {
            if(ASPx.IsFunction(param[key]))
                continue;
            if(exceptKeys[key] == 1)
                continue;
            values.push(Json.ToJson(key) + ":" + Json.ToJson(param[key], skipEncodeHtml));
        }
    }
    return "{" + values.join(",") + "}";
};
function dateToJson(date) {
    var result = [ 
        date.getFullYear(),
        date.getMonth(),
        date.getDate()
    ];
    var time = {
        h: date.getHours(),
        m: date.getMinutes(),
        s: date.getSeconds(),
        ms: date.getMilliseconds()
    };
    if(time.h || time.m || time.s || time.ms)
        result.push(time.h);
    if(time.m || time.s || time.ms)
        result.push(time.m);
    if(time.s || time.ms)
        result.push(time.s);
    if(time.ms)
        result.push(time.ms);
    return "new Date(" + result.join() + ")";
}
ASPx.Json = Json;

// Classes
ASPx.CreateClass = function(parentClass, properties) {
    if(arguments.length == 1) {
        properties = parentClass;
        parentClass = null;
    }
    var ret = function() {
        if(ret.preparing) 
            return delete(ret.preparing);
        if(ret.constr) {
            this.constructor = ret;
            ret.constr.apply(this, arguments);
        }
    };
    ret.prototype = {};
    if(parentClass) {
        parentClass.preparing = true;
        for(var name in parentClass) {
            if(parentClass.hasOwnProperty(name) && name != 'constr' && ASPx.IsFunction(parentClass[name]) && !ret[name])
                ret[name] = parentClass[name].aspxBind(parentClass);
        }
        /*jshint -W058 */
        ret.prototype = new parentClass;
        /*jshint +W058 */
        ret.prototype.constructor = parentClass;
        ret.constr = parentClass;
    }
    if(properties) {
        var constructorName = "constructor";
        for(var name in properties) {
            if(!properties.hasOwnProperty(name)) 
                continue;
            var getter = Object.getOwnPropertyDescriptor(properties, name).get;
            var setter = Object.getOwnPropertyDescriptor(properties, name).set;
            if(getter || setter)
                Object.defineProperty(ret.prototype, name, {
                    set: setter,
                    get: getter,
                    enumerable: true,
                    configurable: true
                });


            if(name != constructorName && !getter && !setter)
                ret.prototype[name] = properties[name];
        }
        if(properties[constructorName] && properties[constructorName] != Object)
            ret.constr = properties[constructorName];
    }
    return ret;
};
var registeredMixins = {};
ASPx.GetMixin = function (name, baseClass) {
    var mixinCache = baseClass._mixins || (baseClass._mixins = {});
    var resultClass = mixinCache[name];
    if (!resultClass) {
        var mixinCodeBuilder = registeredMixins[name];
        if (!mixinCodeBuilder)
            throw new Error("mixin with the '" + name + "' is not registered");
        var mixinCode = mixinCodeBuilder(baseClass);
        mixinCode.mixinName = name;
        resultClass = ASPx.CreateClass(baseClass, mixinCode);
        mixinCache[name] = resultClass;
    }
    return resultClass;
};
ASPx.RegisterMixin = function() {
    var name = arguments.length == 1 ? "mixin_" + ASPx.CreateGuid() : arguments[0];
    var mixinCodeBuilder = arguments[arguments.length - 1];
    if (registeredMixins[name])
        throw new Error("mixin with the '" + name + "' name is already defined");
    registeredMixins[name] = mixinCodeBuilder;
    return function(baseClass) { return ASPx.GetMixin(name, baseClass); };
};

// Callbacks
ASPx.FormatCallbackArg = function(prefix, arg) {
    // [Victor] TODO: refactor HtmlEditor->Dialogs.js and remove this logics (only simple data types are expected)
    if(prefix == null && arg == null)
        return "";    
    if(prefix == null) prefix = "";
    if(arg == null) arg = "";
    
    if(arg != null && !ASPx.IsExists(arg.length) && ASPx.IsExists(arg.value))
        arg = arg.value;
    arg = arg.toString();
    return [prefix, '|', arg.length, '|' , arg].join('');
};
ASPx.FormatCallbackArgs = function(callbackData) {
    var sb = [ ];
    for(var i = 0; i < callbackData.length; i++)
        sb.push(ASPx.FormatCallbackArg(callbackData[i][0], callbackData[i][1]));
    return sb.join("");
};

// Shortcuts
ASPx.ParseShortcutString = function(shortcutString) {
    if(!shortcutString)
        return 0;

    var isCtrlKey = false;
    var isShiftKey = false;
    var isAltKey = false;
    var isMetaKey = false;
    var keyCode = null;
    
    var shcKeys = shortcutString.toString().split("+");
    
    if(shcKeys.length > 0) {
        for(var i = 0; i < shcKeys.length; i++) {
            var key = Str.Trim(shcKeys[i].toUpperCase());
            switch (key) {
                case "CONTROL":
                case "CONTROLKEY":
                case "CTRL":
                    isCtrlKey = true;
                    break;
                case "SHIFT":
                case "SHIFTKEY":
                    isShiftKey = true;
                    break;
                case "ALT":
                    isAltKey = true;
                    break;
                case "CMD":
                    isMetaKey = true;
                    break;

                case "F1":    keyCode = ASPx.Key.F1; break;
                case "F2":    keyCode = ASPx.Key.F2; break;
                case "F3":    keyCode = ASPx.Key.F3; break;
                case "F4":    keyCode = ASPx.Key.F4; break;
                case "F5":    keyCode = ASPx.Key.F5; break;
                case "F6":    keyCode = ASPx.Key.F6; break;
                case "F7":    keyCode = ASPx.Key.F7; break;
                case "F8":    keyCode = ASPx.Key.F8; break;
                case "F9":    keyCode = ASPx.Key.F9; break;
                case "F10":   keyCode = ASPx.Key.F10; break;
                case "F11":   keyCode = ASPx.Key.F11; break;
                case "F12":   keyCode = ASPx.Key.F12; break;

                case "RETURN":
                case "ENTER": keyCode = ASPx.Key.Enter; break;
                case "HOME":  keyCode = ASPx.Key.Home; break;
                case "END":   keyCode = ASPx.Key.End; break;
                case "LEFT":  keyCode = ASPx.Key.Left; break;
                case "RIGHT": keyCode = ASPx.Key.Right; break;
                case "UP":    keyCode = ASPx.Key.Up; break;
                case "DOWN":  keyCode = ASPx.Key.Down; break;
                case "PAGEUP": keyCode = ASPx.Key.PageUp; break;
                case "PAGEDOWN": keyCode = ASPx.Key.PageDown; break;
                case "SPACE": keyCode = ASPx.Key.Space; break;
                case "TAB":   keyCode = ASPx.Key.Tab; break;
                case "BACKSPACE": 
                case "BACK": keyCode = ASPx.Key.Backspace; break;
                case "CONTEXT": keyCode = ASPx.Key.ContextMenu; break;

                case "ESCAPE":
                case "ESC":
                    keyCode = ASPx.Key.Esc;
                    break;

                case "DELETE":
                case "DEL":
                    keyCode = ASPx.Key.Delete;
                    break;

                case "INSERT":
                case "INS":
                    keyCode = ASPx.Key.Insert;
                    break;

                case "PLUS":
                    keyCode = "+".charCodeAt(0);
                    break;
                default:
                    keyCode = key.charCodeAt(0);
                    break;
            }
        }
    } else
        ASPx.ShowErrorAlert("Invalid shortcut");
    return ASPx.GetShortcutCode(keyCode, isCtrlKey, isShiftKey, isAltKey, isMetaKey);
};
ASPx.GetShortcutCode = function(keyCode, isCtrlKey, isShiftKey, isAltKey, isMetaKey) {
    var value = keyCode;
    value |= isCtrlKey ? ASPx.ModifierKey.Ctrl : 0;
    value |= isShiftKey ? ASPx.ModifierKey.Shift : 0;
    value |= isAltKey ? ASPx.ModifierKey.Alt : 0;
    value |= isMetaKey ? ASPx.ModifierKey.Meta : 0;
    return value;
};
ASPx.GetShortcutCodeByEvent = function(evt) {
    return ASPx.GetShortcutCode(Evt.GetKeyCode(evt), evt.ctrlKey, evt.shiftKey, evt.altKey, ASPx.Browser.MacOSPlatform ? evt.metaKey : false);
};
ASPx.IsPasteShortcut = function(evt) {
    if(evt.type === "paste")
        return true;
    var keyCode = Evt.GetKeyCode(evt);
    
    if(Browser.NetscapeFamily && evt.which == 0)        
        keyCode = evt.keyCode;
    
    return (evt.ctrlKey && (keyCode == 118 /*v*/ || (keyCode == 86)/*V*/)) ||
           (evt.shiftKey && !evt.ctrlKey && !evt.altKey &&
           (keyCode == ASPx.Key.Insert)) ;
};
var NotPrintableKeyCodes = null;
ASPx.IsPrintableKey = function(keyCode) {
    if (!NotPrintableKeyCodes)
        NotPrintableKeyCodes = Object.keys(ASPx.Key).map(function(key) { return ASPx.Key[key]; });
    return !ASPx.Data.ArrayContains(NotPrintableKeyCodes, keyCode);
};

// Focus
ASPx.SetFocus = function(element, selectAction) {
    function focusCore(element, selectAction){
        try {
                element.focus();
                if(Browser.IE && document.activeElement != element)
                    element.focus();

                // Q339238
                if(selectAction) {
                    var currentSelection = Selection.GetInfo(element);
                    // apply selection only if there is no selection present already
                    if(currentSelection.startPos == currentSelection.endPos) {
                    
                        switch(selectAction) {
                            case "start":
                                Selection.SetCaretPosition(element, 0);
                                break;
                            case "all":
                                Selection.Set(element);
                                break;
                        }
                    }
                }
            } catch (e) {
        }
    }
    if(ASPxClientUtils.iOSPlatform) // Q471191
        focusCore(element, selectAction);
    else {
        window.setTimeout(function() { // B39538
            focusCore(element, selectAction);
        }, 100);
    }
};
ASPx.IsFocusableCore = function(element, skipContainerVisibilityCheck) {
    var current = element;
    while(current && current.nodeType == 1) {
        if(current == element || !skipContainerVisibilityCheck(current)) {
            var tagName = current.tagName.toUpperCase();
            if(tagName == "BODY")
                return true;
            var disabledElementTags = ["INPUT", "BUTTON", "TEXTAREA", "SELECT", "OPTION"];
            if(disabledElementTags.indexOf(tagName) !== -1 && current.disabled || !ASPx.GetElementDisplay(current) || !ASPx.GetElementVisibility(current))
                return false;
        }
        current = current.parentNode;
    }
    return true;
};
ASPx.IsFocusable = function(element) {
    return ASPx.IsFocusableCore(element, ASPx.FalseFunction);
};
ASPx.IsActionElement = function(element) {
    if(!ASPx.IsExistsElement(element))
        return false;
    var tabIndex = parseInt(ASPx.Attr.GetAttribute(element, ASPx.Attr.GetTabIndexAttributeName()));
    var hasTabIndex = !isNaN(tabIndex);
    var hasNonNegativeTabIndex = hasTabIndex && tabIndex > -1;
    var hasNegativeTabIndex = hasTabIndex && tabIndex < 0;
    var tagName = element.tagName;
    var focusableElementTags = ["BUTTON", "SELECT", "TEXTAREA", "OPTION", "IFRAME"];

    var isFocusableCore = ASPx.IsFocusable(element);
    var isFocusableTag = focusableElementTags.indexOf(tagName) !== -1;
    var isFocusableLink = tagName === "A" && (!!element.href || hasNonNegativeTabIndex);
    var isFocusableInput = tagName === "INPUT" && element.type.toLowerCase() !== "hidden";
    var isFocusableByTabIndex = tagName !== "INPUT" && hasNonNegativeTabIndex;
    var isEditableDiv = tagName == "DIV" && element.contentEditable === "true";

    return isFocusableCore && !hasNegativeTabIndex && (isFocusableTag || isFocusableLink || isFocusableInput || isFocusableByTabIndex || isEditableDiv);
};
ASPx.GetCanBeActiveElementsInContainer = function(container) {
    var canBeActiveTags = ["INPUT", "A", "UL", "BUTTON", "TEXTAREA", "SELECT", "IFRAME"],
        canBeActiveElements = [];
    Data.ForEach(canBeActiveTags, function(tag) {
        var elements = container.getElementsByTagName(tag);
        canBeActiveElements = canBeActiveElements.concat([].slice.call(elements));
    });
    return canBeActiveElements;
};

function isActionElementAllowedByPredicate(element, predicate) {
     var allowedByPredicate = !predicate || predicate(element);
     return allowedByPredicate && ASPx.IsActionElement(element);
}
ASPx.FindChildActionElements = function(container, predicate) {
    return ASPx.GetNodes(container, function(el) {
        return isActionElementAllowedByPredicate(el, predicate);
    });
};
ASPx.FindAllSortedActionElements = function(container, predicate) {
    var result = [ ];
    if(!container || !container.getElementsByTagName) return result;
    var actionElements = ASPx.FindChildActionElements(container, predicate);

    var getTabOrderValue = function(el) {
        var tabIndex = parseInt(ASPx.Attr.GetAttribute(el, ASPx.Attr.GetTabIndexAttributeName()));
        return isNaN(tabIndex) ? 0 : tabIndex;
    };
    var positiveTabIndexElements = actionElements.filter(function(x) { return getTabOrderValue(x) > 0; });
    var nonPositiveTabIndexElements = actionElements.filter(function(x) { return getTabOrderValue(x) === 0; });
    var sortedTabIndexElements = positiveTabIndexElements.sort(function(x, y) { return getTabOrderValue(x) - getTabOrderValue(y); });
    result = sortedTabIndexElements.concat(nonPositiveTabIndexElements);
    return result;
};
ASPx.FindFirstChildActionElement = function(container, predicate) {
    if(!container || isActionElementAllowedByPredicate(container, predicate))
        return !container ? null : container;
    var sortedActionElements = ASPx.FindAllSortedActionElements(container, predicate);
    return sortedActionElements[0];
};
ASPx.FindLastChildActionElement = function(container, predicate) {
    if(!container)
        return null;
    var sortedActionElements = ASPx.FindAllSortedActionElements(container, predicate);
    var actionElement = sortedActionElements[sortedActionElements.length - 1];
    if(!actionElement && isActionElementAllowedByPredicate(container, predicate))
        actionElement = container;
    return actionElement;
};

ASPx.GetParentClientControls = function(name) {
    var nameParts = name.split("_");
    var result = [ ];
    var controlCollection = ASPx.GetControlCollection();
    for(var i = 1; i <= nameParts.length; i++) {
        var controlName = nameParts.slice(0, i).join("_");
        var control = controlCollection.Get(controlName);
        if(control)
            result.push(control);
    }
    return result;
};
ASPx.GetRootClientControl = function(childControlName) {
    var parentControls = ASPx.GetParentClientControls(childControlName);
    return parentControls[0];
};
ASPx.GetClientControlByElementID = function(elementID) {
    var parentControls = ASPx.GetParentClientControls(elementID);
    return parentControls[parentControls.length - 1];
};

// Common
ASPx.IsExists = function(obj){
    return (typeof(obj) != "undefined") && (obj != null);
};
ASPx.IsFunction = function(obj){
    return typeof(obj) == "function";
};
ASPx.IsNumber = function(str) {
    return !isNaN(parseFloat(str)) && isFinite(str);
};
ASPx.GetDefinedValue = function(value, defaultValue){
    return (typeof(value) != "undefined") ? value : defaultValue;
};
ASPx.CorrectJSFloatNumber = function(number) {
    // Hack: 3.12 + 10 = 13.1200000000000001 - bug is javascript
    var ret = 21; // max number
    var numString = number.toPrecision(21);
    numString = numString.replace("-", ""); // B196112
    var integerDigitsCount = numString.indexOf(ASPx.PossibleNumberDecimalSeparators[0]);

    if(integerDigitsCount < 0)
        integerDigitsCount = numString.indexOf(ASPx.PossibleNumberDecimalSeparators[1]);

    var floatDigitsCount = numString.length - integerDigitsCount - 1;
    if(floatDigitsCount < 10)
        return number;

    if(integerDigitsCount > 0) {
        // 12 was fitted. Elsewise, the testChangeNumberInternal isn't successful
        ret = integerDigitsCount + 12;
    }
    
    var toPrecisionNumber = Math.min(ret, 21);
    var newValueString = number.toPrecision(toPrecisionNumber);
    return parseFloat(newValueString, 10);
};
ASPx.CorrectRounding = function(number, step) { //T222586
    var regex = /[,|.](.*)/,
        isFloatValue = regex.test(number),
        isFloatStep = regex.test(step);

    if(isFloatValue || isFloatStep) {
        var valueAccuracy = (isFloatValue) ? regex.exec(number)[0].length - 1 : 0,
            stepAccuracy = (isFloatStep) ? regex.exec(step)[0].length - 1 : 0,
            accuracy = Math.max(valueAccuracy, stepAccuracy);

        var multiplier = Math.pow(10, accuracy);
        number = Math.round((number + step) * multiplier) / multiplier;
        return number;
    }

    return number + step;
};

// DOM
ASPx.GetActiveElement = function() {
    try{ return document.activeElement; } catch(e) { return null; }
};
var verticalScrollBarWidth;
ASPx.GetVerticalScrollBarWidth = function() {
    if(typeof(verticalScrollBarWidth) == "undefined") {
        var container = document.createElement("DIV");
        container.style.cssText = "position: absolute; top: 0px; left: 0px; visibility: hidden; width: 200px; height: 150px; overflow: hidden; box-sizing: content-box";
        document.body.appendChild(container);

        var child = document.createElement("P");
        container.appendChild(child);
        child.style.cssText = "width: 100%; height: 200px;";

        var widthWithoutScrollBar = child.offsetWidth;
        container.style.overflow = "scroll";
        var widthWithScrollBar = child.offsetWidth;
        if(widthWithoutScrollBar == widthWithScrollBar)
            widthWithScrollBar = container.clientWidth;

        verticalScrollBarWidth = widthWithoutScrollBar - widthWithScrollBar;
        
        document.body.removeChild(container);
    }
    return verticalScrollBarWidth;
};
function hideScrollBarCore(element, scrollName) {
    if(element.tagName == "IFRAME") {
        if((element.scrolling == "yes") || (element.scrolling == "auto")) {
            Attr.ChangeAttribute(element, "scrolling", "no");
            return true;
        }
    }
    else if(element.tagName == "DIV") {
        if((element.style[scrollName] == "scroll") || (element.style[scrollName] == "auto")) {
            Attr.ChangeStyleAttribute(element, scrollName, "hidden");
            return true;
        }
    }
    return false;
}
function restoreScrollBarCore(element, scrollName) {
    if(element.tagName == "IFRAME")
        return Attr.RestoreAttribute(element, "scrolling");
    else if(element.tagName == "DIV")
        return Attr.RestoreStyleAttribute(element, scrollName);
    return false;
}
ASPx.SetScrollBarVisibilityCore = function(element, scrollName, isVisible) {
    return isVisible ? restoreScrollBarCore(element, scrollName) : hideScrollBarCore(element, scrollName);
};
ASPx.SetScrollBarVisibility = function(element, isVisible) {
    if(ASPx.SetScrollBarVisibilityCore(element, "overflow", isVisible)) // B143193
        return true;
    var result = ASPx.SetScrollBarVisibilityCore(element, "overflowX", isVisible)
        || ASPx.SetScrollBarVisibilityCore(element, "overflowY", isVisible);
    return result;
};

ASPx.SetInnerHtml = function(element, html) {
    if(Browser.IE) {
        setInnerHtmlInternal(element, "<em>&nbsp;</em>" + html);
        element.removeChild(element.firstChild);
    } else
        setInnerHtmlInternal(element, html);
};
ASPx.GetInnerText = function(container) {
    if(Browser.Safari && Browser.MajorVersion <= 5) {
        var filter = getHtml2PlainTextFilter();
        setInnerHtmlInternal(filter, container.innerHTML);
        ASPx.SetElementDisplay(filter, true);
        var innerText = filter.innerText;
        ASPx.SetElementDisplay(filter, false);
        return innerText;
    } else if(Browser.NetscapeFamily || Browser.WebKitFamily || (Browser.IE && Browser.Version >= 9) || Browser.Edge) {
        return container.textContent;
    } else
        return container.innerText;
};
var html2PlainTextFilter = null;
function getHtml2PlainTextFilter() {
    if(html2PlainTextFilter == null) {
        html2PlainTextFilter = document.createElement("DIV");
        html2PlainTextFilter.style.width = "0";
        html2PlainTextFilter.style.height = "0";
        html2PlainTextFilter.style.overflow = "visible";
        ASPx.SetElementDisplay(html2PlainTextFilter, false);
        document.body.appendChild(html2PlainTextFilter);
    }
    return html2PlainTextFilter;
}
ASPx.CreateHiddenField = function(name, id, parent) {
    var input = document.createElement("INPUT");
    input.setAttribute("type", "hidden");
    if(name)
        input.setAttribute("name", name);
    if(id)
        input.setAttribute("id", id);
    if(parent)
        parent.appendChild(input);
    return input;
};
ASPx.CloneObject = function(srcObject) {
    if(typeof(srcObject) != 'object' || srcObject == null)
        return srcObject;
    var newObject = {};
    /* jshint ignore:start */
    for(var i in srcObject)
        newObject[i] = srcObject[i];
    /* jshint ignore:end */
    return newObject;
};

ASPx.InsertRowsBefore = function(table, rowsHtml, index) {
    var row = null;
    if(index >= 0 && index < table.rows.length)
        row = table.rows[index];

    var func = ASPx.Browser.IE && ASPx.Browser.Version < 10 ? insertRowsBefore_IE9 : insertRowsBefore;
    func(table, rowsHtml, row);
};
var insertRowsBefore = function(table, rowsHtml, row) {
    if(!row && table.tBodies.length > 0) {
        row = document.createElement("TR");
        table.tBodies[0].appendChild(row);
        row.shouldRemove = true;
    }
    if(row) {
        row.insertAdjacentHTML("beforeBegin", rowsHtml);
        if(row.shouldRemove)
            ASPx.RemoveElement(row);
    }
};
var insertRowsBefore_IE9 = function(table, rowsHtml, nextRow) {
    var row = document.createElement("TR");
    var cell = document.createElement("TD");
    setInnerHtmlInternal(cell, "<table><tbody>" + rowsHtml + "</tbody></table>");

    var tbody = table.tBodies[0];
    tbody.appendChild(row);
    row.appendChild(cell);
        
    var newTable = ASPx.GetNodeByTagName(cell, "TABLE", 0);
    var rowCount = newTable.rows.length;

    for(var i = rowCount - 1; i >= 0; i--) {
        var newRow = newTable.rows[i];
        if(nextRow == null)
            tbody.appendChild(newRow);
        else
            tbody.insertBefore(newRow, nextRow);
        nextRow = newRow;
    }
    ASPx.RemoveElement(row);
};

ASPx.IsPercentageSize = function(size) {
    return size && size.indexOf('%') != -1;
};

ASPx.GetElementById = function(id) {
    if(document.getElementById)
        return document.getElementById(id);
    else
        return document.all[id];
};
ASPx.GetInputElementById = function(id) {
    var elem = ASPx.GetElementById(id);
    if(!Browser.IE)
        return elem;

    if(elem) {
        if(elem.id == id)
            return elem;
        else {
            for(var i = 1; i < document.all[id].length; i++) {
                if(document.all[id][i].id == id)
                    return document.all[id][i];
            }
        }
    }
    return null;
};
ASPx.GetElementByIdInDocument = function(documentObj, id) {
    if(documentObj.getElementById)
        return documentObj.getElementById(id);
    else
        return documentObj.all[id];
};
ASPx.GetIsParent = function(parentElement, element) {
    if(!parentElement || !element)
        return false;
    while(element){
        if(element === parentElement)
            return true;
        if(element.tagName === "BODY")
            return false;
        element = element.parentNode;
    }
    return false;
};
ASPx.GetParentById = function(element, id) {
    element = element.parentNode;
    while(element){
        if(element.id === id)
            return element;
        element = element.parentNode;
    }
    return null;
};
ASPx.GetParentByPartialId = function(element, idPart){
    while(element && element.tagName != "BODY") {
        if(element.id && element.id.match(idPart)) 
            return element;

        element = element.parentNode;
    }
    return null;
};
ASPx.GetParentByTagName = function(element, tagName) {
    tagName = tagName.toUpperCase();
    while(element) {
        if(element.tagName === "BODY")
            return null;
        if(element.tagName === tagName)
            return element;
        element = element.parentNode;
    }
    return null;
};
function getParentByClassNameInternal(element, className, selector) {
    while(element != null) {
        if(element.tagName == "BODY" || element.nodeName == "#document")
            return null;
        if(selector(element, className))
            return element;
        element = element.parentNode;
    }
    return null;
}
ASPx.GetParentByPartialClassName = function(element, className) {
    return getParentByClassNameInternal(element, className, ASPx.ElementContainsCssClass);
};
ASPx.GetParentByClassName = function(element, className) {
    return getParentByClassNameInternal(element, className, ASPx.ElementHasCssClass);
};
ASPx.GetParentByTagNameAndAttributeValue = function(element, tagName, attrName, attrValue) {
    tagName = tagName.toUpperCase();
    while(element != null) {
        if(element.tagName == "BODY")
            return null;
        if(element.tagName == tagName && element[attrName] == attrValue)
            return element;
        element = element.parentNode;
    }
    return null;
};
ASPx.GetParent = function(element, testFunc){
    if (!ASPx.IsExists(testFunc)) return null;
    
    while(element != null && element.tagName != "BODY"){
        if(testFunc(element))
            return element;
        element = element.parentNode;
    }
    return null;
};

ASPx.GetElementTreeLine = function(element, stopTagName, stopFunc) {
    var result = [];

    stopTagName = stopTagName || "BODY";

    while(element != null) {
        if(!stopFunc && element.tagName == stopTagName)
            break;
        if(stopFunc && stopFunc(element))
            break;
        result.push(element);
        element = element.parentNode;
    }

    return result;
};

ASPx.IsScrollableElement = function(element, isHorzScrollable, isVertScrollable) {
    isHorzScrollable = ASPx.IsExists(isHorzScrollable) ? isHorzScrollable : true;
    isVertScrollable = ASPx.IsExists(isVertScrollable) ? isVertScrollable : true;

    var style = ASPx.GetCurrentStyle(element);
    var overflowStyleNames = ["overflow"];
    if(isHorzScrollable)
        overflowStyleNames.push("overflowX");
    if(isVertScrollable)
        overflowStyleNames.push("overflowY");
    for(var i = 0; i < overflowStyleNames.length; i++)
        if(style[overflowStyleNames[i]] == "scroll" || style[overflowStyleNames[i]] == "auto")
            return true;
    return false;
};


ASPx.GetPreviousSibling = function(el) {
    if(el.previousElementSibling) {
        return el.previousElementSibling;
    } else {
        while(el = el.previousSibling) {
            if(el.nodeType === 1)
                return el;
        }
    }
};
ASPx.ElementMatchesSelector = (function (e) {
    return (function (matches) {
        return function (el, selector) { return !!el && !!selector && matches.call(el, selector); };
    })(e.matches || e.matchesSelector || e.webkitMatchesSelector || e.mozMatchesSelector || e.msMatchesSelector || e.oMatchesSelector);
})(Element.prototype);
ASPx.ElementHasCssClass = function(element, className) {
    //B220674
    try {
        var elementClasses;
        var classList = ASPx.GetClassNameList(element);
        if(!classList) {
            var elementClassName = ASPx.GetClassName(element);
            if(!elementClassName) {
                return false;
            }
            elementClasses = elementClassName.split(" ");
        }
        var classNames = className.split(" ");
        for(var i = classNames.length - 1; i >= 0; i--) {
            if(classList) {
                if(classList.indexOf(classNames[i]) === -1)
                    return false;
                continue;
            }
            if(Data.ArrayIndexOf(elementClasses, classNames[i]) < 0)
                return false;
        }
        return true;
    } catch(e) {
        return false;
    }
};
ASPx.ElementContainsCssClass = function(element, className) {
    //B187659
    try {
        var elementClassName = ASPx.GetClassName(element);
        if(!elementClassName) {
            return false;
        }
        return elementClassName.indexOf(className) != -1;
    } catch(e) {
        return false;
    }
};
ASPx.AddClassNameToElement = function (element, className) {
    if(!element || typeof(className) !== "string" ) return;
    className = className.trim();
    if(!ASPx.ElementHasCssClass(element, className) && className !== "") {
        var oldClassName = ASPx.GetClassName(element);
        ASPx.SetClassName(element, (oldClassName === "") ? className : oldClassName + " " + className);
    }
};
ASPx.RemoveClassNameFromElement = function(element, className) {
    if(!element) return;
    var elementClassName = ASPx.GetClassName(element);
    var updClassName = " " + elementClassName + " ";
    var newClassName = updClassName.replace(" " + className + " ", " ");
    if(updClassName.length != newClassName.length)
        ASPx.SetClassName(element, Str.Trim(newClassName));        
};
ASPx.RemoveClassNamesFromElement = function(element, classNames) {
    if(!element) return;
    for(var i = 0; i < classNames.length; i++) {
        var className = classNames[i];
        if(ASPx.Browser.IE && ASPx.Browser.Version < 10)
            ASPx.RemoveClassNameFromElement(element, className);
        else
            element.classList.remove(className);
    }
};
ASPx.ToggleClassNameToElement = function(element, className, contains) {
    if (!contains)
        ASPx.RemoveClassNameFromElement(element, className);
    if (contains && !ASPx.ElementHasCssClass(element, className))
        ASPx.AddClassNameToElement(element, className);
};
ASPx.GetClassNameList = function (element) {
    return element.classList ? [].slice.call(element.classList) : ASPx.GetClassName(element).replace(/^\s+|\s+$/g, '').split(/\s+/);
};
ASPx.GetClassName = function(element) {
    if(element.tagName === "svg") {
        elementClassName = element.className.baseVal;
    }
    else {
        elementClassName = element.className;
    }
    return elementClassName;
};
ASPx.SetClassName = function(element, className) {
    if(element.tagName === "svg") {
        element.className.baseVal = Str.Trim(className);
    }
    else {
        element.className = Str.Trim(className);
    }
};
ASPx.GetElementOffsetWidth = function(element) {
    if(element.tagName === "svg") {
        return element.getBoundingClientRect().width;
    }
    else {
        return element.offsetWidth;
    }
};

ASPx.GetElementOffsetHeight = function(element) {
    if(element.tagName === "svg") {
        return element.getBoundingClientRect().height;
    }
    else {
        return element.offsetHeight;
    }
};
function nodeListToArray(nodeList, filter) {
    var result = [];
    for(var i = 0, element; element = nodeList[i]; i++) {
        if(filter && !filter(element))
            continue;

        result.push(element);
    }
    return result;
}
ASPx.NodeListToArray = nodeListToArray;
function getItemByIndex(collection, index) {
    if(!index) index = 0;
    if(collection != null && collection.length > index)
        return collection[index];
    return null;
}

ASPx.GetChildNodesByQuerySelector = function (parent, selector) {
    return nodeListToArray(parent.querySelectorAll(selector), function (el) { return el.parentNode === parent; });
};

ASPx.GetChildNodesByClassName = function(parent, className) {
    if(!parent) return [];
    if(parent.querySelectorAll) {
        var children = parent.querySelectorAll('.' + className);

        return nodeListToArray(children, function(element) { 
            return element.parentNode === parent;
        });
    }
    return ASPx.GetChildNodes(parent, function(elem) { return elem.className && ASPx.ElementHasCssClass(elem, className); });
};

ASPx.GetChildNodesByPartialClassName = function(element, className) {
    return ASPx.GetChildElementNodesByPredicate(element,
        function(child) {
            return ASPx.ElementContainsCssClass(child, className);
        });
};

ASPx.GetChildByPartialClassName = function(element, className, index) {
    if(element != null){                
        var collection = ASPx.GetChildNodesByPartialClassName(element, className);
        return getItemByIndex(collection, index);
    }
    return null;
};

ASPx.GetChildByClassName = function(element, className, index) {
    if(element != null){                
        var collection = ASPx.GetChildNodesByClassName(element, className);
        return getItemByIndex(collection, index);
    }
    return null;
};
ASPx.GetNodesByPartialClassName = function(element, className) {
    if(element.querySelectorAll) {
        var list = element.querySelectorAll('*[class*=' + className + ']');
        return nodeListToArray(list);
    }
    var collection = element.all || element.getElementsByTagName('*');
    var ret = [ ];
    if(collection != null) {
        for(var i = 0; i < collection.length; i ++) {
            if(ASPx.ElementContainsCssClass(collection[i], className))
                ret.push(collection[i]);
        }
    }
    return ret;
};
ASPx.GetNodesByClassName = function(parent, className) {
    if(parent.querySelectorAll) {
        var children = parent.querySelectorAll('.' + className);
        return nodeListToArray(children);
    }

    return ASPx.GetNodes(parent, function(elem) { return elem.className && ASPx.ElementHasCssClass(elem, className); });
};
ASPx.GetNodeByClassName = function(element, className, index) {
    if(element != null){                
        var collection = ASPx.GetNodesByClassName(element, className);
        return getItemByIndex(collection, index);
    }
    return null;
};
ASPx.GetChildById = function(element, id) {
    if(element.all) {
        var child = element.all[id];
        if(!child) {
            child = element.all(id); //fix id starts with digit Q506841
        	if(!child)
                return Browser.IE ? document.getElementById(id) : null; //fix id contain "-" Q524740
		} 
		if(!ASPx.IsExists(child.length)) // fix two element with the same name and id
            return child;
        else
            return ASPx.GetElementById(id);
    }
    else
        return ASPx.GetElementById(id);
};
ASPx.GetNodesByPartialId = function(element, partialName, list) {
    if(element.id && element.id.indexOf(partialName) > -1) 
        list.push(element);

    if(element.childNodes) {
        for(var i = 0; i < element.childNodes.length; i ++) 
            ASPx.GetNodesByPartialId(element.childNodes[i], partialName, list);
    }
};
ASPx.GetNodesByTagName = function(element, tagName) {
    var tagNameToUpper = tagName.toUpperCase();
    var result = null;
    if(element) {
        if(element.getElementsByTagName) {
            result = element.getElementsByTagName(tagNameToUpper);
            if(result.length === 0) {
                result = element.getElementsByTagName(tagName);
            }
        }
        else if(element.all && element.all.tags !== undefined)
            result = Browser.Netscape ? element.all.tags[tagNameToUpper] : element.all.tags(tagNameToUpper);
    }
    return result;
};
ASPx.GetNodeByTagName = function(element, tagName, index) {
    if(element != null){                
        var collection = ASPx.GetNodesByTagName(element, tagName);
        return getItemByIndex(collection, index);
    }
    return null;
};
ASPx.GetChildNodesByTagName = function(parent, tagName) {
    return ASPx.GetChildNodes(parent, function (child) { return child.tagName === tagName; });
};
ASPx.GetChildByTagName = function(element, tagName, index) {
    if(element != null){                
        var collection = ASPx.GetChildNodesByTagName(element, tagName);
        return getItemByIndex(collection, index);
    }
    return null;
};
ASPx.RetrieveByPredicate = function(scourceCollection, predicate) {
    var result = [];
    for(var i = 0; i < scourceCollection.length; i++) {
        var element = scourceCollection[i];
        if(!predicate || predicate(element)) 
            result.push(element);
    }
    return result;
};
ASPx.GetChildNodes = function(parent, predicate) {
    return ASPx.RetrieveByPredicate(parent.childNodes, predicate);
};
ASPx.GetNodes = function(parent, predicate) {
    var c = parent.all || parent.getElementsByTagName('*');
    return ASPx.RetrieveByPredicate(c, predicate);
};


ASPx.GetChildElementNodes = function(parent) {
    if(!parent) return null;
    return ASPx.GetChildNodes(parent, function(e) { return e.nodeType == 1; });
};
ASPx.GetChildElementNodesByPredicate = function(parent, predicate) {
    if(!parent) return null;
    if(!predicate) return ASPx.GetChildElementNodes(parent);
    return ASPx.GetChildNodes(parent, function(e) { return e.nodeType == 1 && predicate(e); });
};
ASPx.GetTextNode = function(element, index) {
    if(element != null){
        var collection = [ ];
        ASPx.GetTextNodes(element, collection);
        return getItemByIndex(collection, index);
    }
    return null;
};
ASPx.GetTextNodes = function(element, collection) {
    if(element.tagName === "svg")
        return;
    for(var i = 0; i < element.childNodes.length; i ++){
        var childNode = element.childNodes[i];
        if(ASPx.IsExists(childNode.nodeValue))
            collection.push(childNode);
        ASPx.GetTextNodes(childNode, collection);
    }
};
ASPx.GetNormalizedTextNode = function(element, index) {
    var textNode = ASPx.GetTextNode(element, index);
    if(textNode != null)
        ASPx.MergeAdjacentTextNodes(textNode);
    return textNode;
};
ASPx.MergeAdjacentTextNodes = function(firstTextNode) {
    if(!ASPx.IsExists(firstTextNode.nodeValue))
        return;
    var textNode = firstTextNode;
    while(textNode.nextSibling && ASPx.IsExists(textNode.nextSibling.nodeValue)) {
        textNode.nodeValue += textNode.nextSibling.nodeValue;
        textNode.parentNode.removeChild(textNode.nextSibling);
    }
};

ASPx.GetElementDocument = function(element) {
    return element.document || element.ownerDocument;
};
ASPx.RemoveElement = function(element) {
    if(element && element.parentNode)
        element.parentNode.removeChild(element);
};
ASPx.ReplaceTagName = function(element, newTagName, cloneChilds) {
    if(element.nodeType != 1)
        return null;
    if(element.nodeName == newTagName)
        return element;
    cloneChilds = cloneChilds !== undefined ? cloneChilds : true;

    var doc = element.ownerDocument;
    var newElem = doc.createElement(newTagName);
    Attr.CopyAllAttributes(element, newElem);
    
    if(cloneChilds) {
        for(var i = 0; i < element.childNodes.length; i++)
            newElem.appendChild(element.childNodes[i].cloneNode(true));
    }
    else {
        for(var child; child = element.firstChild; )
            newElem.appendChild(child);
    }
    element.parentNode.replaceChild(newElem, element);
    return newElem;
};
ASPx.RemoveOuterTags = function(element) {
    if(ASPx.Browser.IE) {
        element.insertAdjacentHTML( 'beforeBegin', element.innerHTML ) ;
        ASPx.RemoveElement(element);
    } else {
        var docFragment = element.ownerDocument.createDocumentFragment();
        for(var i = 0; i < element.childNodes.length; i++)
            docFragment.appendChild(element.childNodes[i].cloneNode(true));
        element.parentNode.replaceChild(docFragment, element);
    }
};
ASPx.WrapElementInNewElement = function(element, newElementTagName) {    
    var wrapElement = null;
    if(Browser.IE) {
        var wrapElement = element.ownerDocument.createElement(newElementTagName);
        wrapElement.appendChild(element.cloneNode(true));
        element.parentNode.insertBefore(wrapElement, element);
        element.parentNode.removeChild(element);
    } else {
        var docFragment = element.ownerDocument.createDocumentFragment();
        wrapElement = element.ownerDocument.createElement(newElementTagName);
        docFragment.appendChild(wrapElement);
        wrapElement.appendChild(element.cloneNode(true));
        element.parentNode.replaceChild(docFragment, element);
    }
    return wrapElement;
};
ASPx.InsertElementAfter = function(newElement, targetElement) {
    var parentElem = targetElement.parentNode;
    
    if(parentElem.childNodes[parentElem.childNodes.length - 1] == targetElement)
		parentElem.appendChild(newElement);
    else if(newElement !== targetElement.nextSibling)
		parentElem.insertBefore(newElement, targetElement.nextSibling);
};

ASPx.SetElementOpacity = function(element, value) {
     var useOpacityStyle = !Browser.IE || Browser.Version > 8;
     if(useOpacityStyle){
         element.style.opacity = value;
     } else {
         if(typeof(element.filters) === "object" && element.filters["DXImageTransform.Microsoft.Alpha"])
             element.filters.item("DXImageTransform.Microsoft.Alpha").Opacity = value*100;
         else
            element.style.filter = "alpha(opacity=" + (value * 100) + ")";
     }
};
ASPx.GetElementOpacity = function(element) {
    var useOpacityStyle = !Browser.IE || Browser.Version > 8;
    if(useOpacityStyle)
        return parseFloat(ASPx.GetCurrentStyle(element).opacity);
    else {
        if(typeof(element.filters) === "object" && element.filters["DXImageTransform.Microsoft.Alpha"]){
            return element.filters.item("DXImageTransform.Microsoft.Alpha").Opacity / 100;
        } else {
            var alphaValue = ASPx.GetCurrentStyle(element).filter;
            var value = alphaValue.replace("alpha(opacity=", "");
            value = value.replace(")", "");
            return parseInt(value) / 100;
        }
        return 100;
    }
};

ASPx.HiddenChangable = "dx-hc";
ASPx.DefaultDisplayNoneSelectors = [ "dxmodalSys" ];
ASPx.DefaultDisplaySelectors = ["show"];
function getIsDefaultDisplayNone(element) {
    for(var i = 0; i < ASPx.DefaultDisplayNoneSelectors.length; i++) {
        if(ASPx.ElementHasCssClass(element, ASPx.DefaultDisplayNoneSelectors[i]))
            return true;
    }
    return false;
}
ASPx.GetElementDisplay = function(element, isCurrentStyle) {
    if(isCurrentStyle)
        return ASPx.GetCurrentStyle(element).display != "none";
    if(getIsDefaultDisplayNone(element))
        return element.style.display != "none" && element.style.display != "" || ASPx.DefaultDisplaySelectors.some(function(s) { return ASPx.ElementHasCssClass(element, s); });
    return element.style.display != "none" && !ASPx.ElementHasCssClass(element, ASPx.HiddenChangable);
};
ASPx.SetElementDisplay = function(element, value) {
    if(!element) return;

    if(ASPx.ElementHasCssClass(element, ASPx.HiddenChangable))
        ASPx.RemoveClassNameFromElement(element, ASPx.HiddenChangable);

    if(typeof(value) === "string")
        element.style.display = value;
    else if(getIsDefaultDisplayNone(element))
        element.style.display = value ? (element.tagName === "TABLE" ? "table" : "block") : "";
    else if(!value)
        element.style.display = "none";
    else
        element.style.display = "";
};
ASPx.GetElementVisibility = function(element, isCurrentStyle) {
    if(isCurrentStyle)
        return ASPx.GetCurrentStyle(element).visibility != "hidden";
    return element.style.visibility != "hidden";
};
ASPx.SetElementVisibility = function(element, value) {
    if(!element) return;
    if(typeof(value) === "string")
        element.style.visibility = value;
    else
        element.style.visibility = value ? "visible" : "hidden";
};
ASPx.IsElementVisible = function(element, isCurrentStyle) {
    while(element && element.tagName != "BODY") {
        if(!ASPx.GetElementDisplay(element, isCurrentStyle) || (!ASPx.GetElementVisibility(element, isCurrentStyle) && !Attr.IsExistsAttribute(element, "errorFrame")))
           return false;
        element = element.parentNode;
    }
    return true;
};
ASPx.IsElementDisplayed = function(element) {
    while(element && element.tagName != "BODY") {
        if(!ASPx.GetElementDisplay(element))
           return false;
        element = element.parentNode;
    }
    return true;
};

ASPx.GetElementInitializedFlag = function(element) {
    return element["dxinit"];
};
ASPx.SetElementInitializedFlag = function(element) {
    element["dxinit"] = true;
};

ASPx.AddStyleSheetLinkToDocument = function(doc, linkUrl) {
    var newLink = createStyleLink(doc, linkUrl);
    var head = ASPx.GetHeadElementOrCreateIfNotExist(doc);
    head.appendChild(newLink);
    return newLink;
};
ASPx.GetHeadElementOrCreateIfNotExist = function(doc) {
    var elements = ASPx.GetNodesByTagName(doc, "head");
    var head = null;
    // The Head element might not exist in the Safari browser, if the document content 
    // was created via the document.write() method. In this situation, we must create it.
    if(elements.length == 0) {
        head = doc.createElement("head");
        head.visibility = "hidden";
        doc.insertBefore(head, doc.body);
    } else
        head = elements[0];
    return head;
};
function createStyleLink(doc, url) {
    var newLink = doc.createElement("link");
    Attr.SetAttribute(newLink, "href", url);
    Attr.SetAttribute(newLink, "type", "text/css");
    Attr.SetAttribute(newLink, "rel", "stylesheet");
    return newLink;
}
ASPx.GetCurrentStyle = function(element) {
    if(document.defaultView && document.defaultView.getComputedStyle) { 
        var result = document.defaultView.getComputedStyle(element, null);
        if(!result && Browser.Firefox && window.frameElement) {
            var changes = [];
            var curElement = window.frameElement;
            while(!(result = document.defaultView.getComputedStyle(element, null))) {
                changes.push([curElement, curElement.style.display]);
                ASPx.SetStylesCore(curElement, "display", "block", true);
                curElement = curElement.tagName == "BODY" ? curElement.ownerDocument.defaultView.frameElement : curElement.parentNode;
            }
            result = ASPx.CloneObject(result);
            for(var ch, i = 0; ch = changes[i]; i++)
                ASPx.SetStylesCore(ch[0], "display", ch[1]);
            var dummy = document.body.offsetWidth; //T334387
        }
        if(Browser.Firefox && Browser.MajorVersion >= 62 && window.frameElement && result.length === 0) { //T689462
            result = ASPx.CloneObject(result);
            result.display = element.style.display;
        }
        return result;
    }
    return window.getComputedStyle(element, null);
};
ASPx.CreateStyleSheetInDocument = function(doc) {
    if(doc.createStyleSheet) {
        try {
            return doc.createStyleSheet();
        }
        catch(e) {
            var message = "The CSS link limit (31) has been exceeded. Please enable CSS merging or reduce the number of CSS files on the page. For details, see http://www.devexpress.com/Support/Center/p/K18487.aspx.";
            throw new Error(message);
        }
    }
    else {
        var styleSheet = doc.createElement("STYLE");
        ASPx.GetNodeByTagName(doc, "HEAD", 0).appendChild(styleSheet);
        return styleSheet.sheet;
    }
};

ASPx.currentStyleSheet = null;
ASPx.GetCurrentStyleSheet = function() {
    if(!ASPx.currentStyleSheet)
        ASPx.currentStyleSheet = ASPx.CreateStyleSheetInDocument(document);
    return ASPx.currentStyleSheet;
};
function getStyleSheetRules(styleSheet){
    try {
        if (styleSheet.href && styleSheet.href.indexOf("file:///") === 0)
            return null;
        return Browser.IE && Browser.Version == 8 ? styleSheet.rules : styleSheet.cssRules;
    }
    catch(e) {
        return null;
    }
}
ASPx.cachedCssRules = { };
ASPx.GetStyleSheetRules = function (className, stylesStorageDocument) {
    if(ASPx.cachedCssRules[className]) {
        if(ASPx.cachedCssRules[className] != ASPx.EmptyObject)
            return ASPx.cachedCssRules[className];
        return null;
    }
    var result = iterateStyleSheetRules(stylesStorageDocument, function(rule) {
        if(rule.selectorText == "." + className){
            ASPx.cachedCssRules[className] = rule;
            return rule;
        }
    });
    if(ASPx.IsExists(result))
        return result;
    ASPx.cachedCssRules[className] = ASPx.EmptyObject;
    return null;
};
function iterateStyleSheetRules(stylesStorageDocument, callback) {
    var doc = stylesStorageDocument || document;
    for(var i = 0; i < doc.styleSheets.length; i ++){
        var styleSheet = doc.styleSheets[i];
        var rules = getStyleSheetRules(styleSheet);
        if(rules != null){
            for(var j = 0; j < rules.length; j ++) {
                var result = callback(rules[j]);
                if(result !== undefined)
                    return result;
            }
        }
    }
}
ASPx.ProcessStyleSheetRules = function(prefix, callback) {
    iterateStyleSheetRules(null, function(rule) {
        if(!!rule.selectorText && rule.selectorText.indexOf(prefix) === 0) {
            var name = rule.selectorText.substring(prefix.length);
            var result = callback(name, rule.style, rule);
            if(result !== undefined)
                return result;
        }
    });
};
ASPx.ClearCachedCssRules = function(){
    ASPx.cachedCssRules = { };
};

var styleCount = 0;
var styleNameCache = { };
ASPx.CreateImportantStyleRule = function(styleSheet, cssText, postfix, prefix) {
    styleSheet = styleSheet || ASPx.GetCurrentStyleSheet();
    var cacheKey = (postfix ? postfix + "||" : "") + cssText + (prefix ? "||" + prefix : "");
    if(styleNameCache[cacheKey])
		return styleNameCache[cacheKey];
    prefix = prefix ? prefix + " " : "";
	var className = "dxh" + styleCount + (postfix ? postfix : "");
	ASPx.AddStyleSheetRule(styleSheet, prefix + "." + className, ASPx.CreateImportantCssText(cssText));
	styleCount++;
	styleNameCache[cacheKey] = className;
	return className;	
};
ASPx.CreateImportantCssText = function(cssText) {
    var newText = "";
    var hasEncodedSemicolon = cssText.indexOf(ASPx.StyleValueEncodedSemicolon) > -1;
	var attributes = cssText.split(";");
	for(var i = 0; i < attributes.length; i++) {
        var rule = attributes[i];
		if(rule != "")
            newText += ASPx.CreateImportantCssRule(rule, hasEncodedSemicolon);
	}
    return newText;
};
ASPx.CreateImportantCssRule = function(rule, hasEncodedSemicolon) {
    var result = rule;
    if(hasEncodedSemicolon) {
        var regex = new RegExp(ASPx.StyleValueEncodedSemicolon, "g");
        result = result.replace(regex, ";");
    }
    result = result + " !important;";
    return result;
};
ASPx.AddStyleSheetRule = function(styleSheet, selector, cssText){
    if(!cssText) return;
    styleSheet.insertRule(selector + " { " + cssText + " }", styleSheet.cssRules.length);
};

ASPx.GetPointerCursor = function() {
    return "pointer";
};
ASPx.SetPointerCursor = function(element) {
    if(element.style.cursor == "")
        element.style.cursor = ASPx.GetPointerCursor();
};

ASPx.SetElementFloat = function(element, value) {
    if(ASPx.IsExists(element.style.cssFloat))
        element.style.cssFloat = value;
    else if(ASPx.IsExists(element.style.styleFloat))
        element.style.styleFloat = value;
    else
        Attr.SetAttribute(element.style, "float", value);
};
ASPx.GetElementFloat = function(element) {
    var currentStyle = ASPx.GetCurrentStyle(element);
    
    if(ASPx.IsExists(currentStyle.cssFloat))
        return currentStyle.cssFloat;
    if(ASPx.IsExists(currentStyle.styleFloat))
        return currentStyle.styleFloat;
    return Attr.GetAttribute(currentStyle, "float");
};

function getElementDirection(element) {
    return ASPx.GetCurrentStyle(element).direction;
}
ASPx.IsElementRightToLeft = function(element) {
    return getElementDirection(element) == "rtl";
};

ASPx.AdjustVerticalMarginsInContainer = function(container) {
    var containerBorderAndPaddings = ASPx.GetTopBottomBordersAndPaddingsSummaryValue(container);
    var flowElements = [], floatElements = [], floatTextElements = [];
    var maxHeight = 0, maxFlowHeight = 0;
    
    for(var i = 0; i < container.childNodes.length; i++) {
        var element = container.childNodes[i];
        if(!element.offsetHeight) continue;

        ASPx.ClearVerticalMargins(element);
    }
    for(var i = 0; i < container.childNodes.length; i++) {
        var element = container.childNodes[i];
        if(!element.offsetHeight) continue;

        var float = ASPx.GetElementFloat(element);
        var isFloat = (float === "left" || float === "right");
        if(isFloat)
            floatElements.push(element);
        else {
            flowElements.push(element);
            if(element.tagName !== "IMG"){
                if(!ASPx.IsTextWrapped(element))
                    element.style.verticalAlign = 'baseline'; // prevent extra height
                floatTextElements.push(element);
            }
            if(element.tagName === "DIV")
                Attr.ChangeStyleAttribute(element, "float", "left"); // prevent extra height
        }
        if(element.offsetHeight > maxHeight) 
            maxHeight = element.offsetHeight;
        if(!isFloat && element.offsetHeight > maxFlowHeight) 
            maxFlowHeight = element.offsetHeight;
    }

    for(var i = 0; i < flowElements.length; i++) 
        Attr.RestoreStyleAttribute(flowElements[i], "float");
    
    var containerBorderAndPaddings = ASPx.GetTopBottomBordersAndPaddingsSummaryValue(container);
    var containerHeight = container.offsetHeight - containerBorderAndPaddings;
    if(maxHeight == containerHeight) {
        var verticalAlign = ASPx.GetCurrentStyle(container).verticalAlign;
        for(var i = 0; i < floatTextElements.length; i++)
            floatTextElements[i].style.verticalAlign = '';
        containerHeight = container.offsetHeight - containerBorderAndPaddings;

        for(var i = 0; i < floatElements.length; i++)
            adjustVerticalMarginsCore(floatElements[i], containerHeight, verticalAlign, true);
        for(var i = 0; i < flowElements.length; i++) {
            if(maxFlowHeight != maxHeight)
                adjustVerticalMarginsCore(flowElements[i], containerHeight, verticalAlign);
        }
    }
};
ASPx.AdjustVerticalMargins = function(element) {
    ASPx.ClearVerticalMargins(element);

    var parentElement = element.parentNode;
    var parentHeight = parentElement.getBoundingClientRect().height - ASPx.GetTopBottomBordersAndPaddingsSummaryValue(parentElement);
    adjustVerticalMarginsCore(element, parentHeight, ASPx.GetCurrentStyle(parentElement).verticalAlign);
};
function adjustVerticalMarginsCore(element, parentHeight, verticalAlign, toBottom) {
    var marginTop;
    if(verticalAlign == "top")
        marginTop = 0;
    else if(verticalAlign == "bottom")
        marginTop = parentHeight - element.getBoundingClientRect().height;
    else
        marginTop = (parentHeight - element.getBoundingClientRect().height) / 2;
    if(marginTop !== 0){
        element.style.marginTop = marginTop + "px";
    }
}
ASPx.ClearVerticalMargins = function(element) {
    element.style.marginTop = "";
    element.style.marginBottom = "";
};
ASPx.AdjustHeightInContainer = function(container) {
    var height = container.offsetHeight - ASPx.GetTopBottomBordersAndPaddingsSummaryValue(container);

    for(var i = 0; i < container.childNodes.length; i++) {
        var element = container.childNodes[i];
        if(!element.offsetHeight) continue;

        ASPx.ClearHeight(element);
    }

    var elements = [];
    var childrenHeight = 0;
    for(var i = 0; i < container.childNodes.length; i++) {
        var element = container.childNodes[i];
        if(!element.offsetHeight) continue;

        childrenHeight += element.offsetHeight + ASPx.GetTopBottomMargins(element);
        elements.push(element);
    }
    if(elements.length > 0 && childrenHeight < height) {
        var correctedHeight = 0;
        for(var i = 0; i < elements.length; i++) {
            var elementHeight = 0;
            if(i < elements.length - 1){
                var elementHeight = Math.floor(height / elements.length);
                correctedHeight += elementHeight;
            }
            else{
                var elementHeight = height - correctedHeight;
                if(elementHeight < 0) elementHeight = 0;
            }
            adjustHeightCore(elements[i], elementHeight);
        }
    }
};
ASPx.AdjustHeight = function(element) {
    ASPx.ClearHeight(element);

    var parentElement = element.parentNode;
    var height = parentElement.getBoundingClientRect().height - ASPx.GetTopBottomBordersAndPaddingsSummaryValue(parentElement);
    adjustHeightCore(element, height);
};
function adjustHeightCore(element, height) {
    var height = height - ASPx.GetTopBottomBordersAndPaddingsSummaryValue(element);
    if(height < 0) height = 0;
    element.style.height = height + "px";
}
ASPx.ClearHeight = function(element) {
    element.style.height = "";
};
ASPx.ShrinkWrappedTextInContainer = function(container) {
    if(!container) return;
    
    for(var i = 0; i < container.childNodes.length; i++){
        var child = container.childNodes[i];
        if(child.style && ASPx.IsTextWrapped(child)) {
            Attr.ChangeStyleAttribute(child, "width", "1px");
            child.shrinkedTextContainer = true;
        }
    }
};
ASPx.AdjustWrappedTextInContainer = function(container) {
    if(!container) return;
    
    var textContainer, leftWidth = 0, rightWidth = 0;
    for(var i = 0; i < container.childNodes.length; i++){
        var child = container.childNodes[i];

        if(child.tagName === "BR")
            return;
        if(!child.tagName)
            continue;
        if(child.tagName !== "IMG"){
            textContainer = child;
            if(ASPx.IsTextWrapped(textContainer)){
                if(!textContainer.shrinkedTextContainer)
                    textContainer.style.width = "";
                textContainer.style.marginRight = "";
            }
        }
        else {
            if(ASPx.GetElementOffsetWidth(child)=== 0)
                /*jshint -W083 */
                Evt.AttachEventToElement(child, "load", function(evt) { ASPx.AdjustWrappedTextInContainer(container); });
                /*jshint +W083 */
            else {
                var width = ASPx.GetElementOffsetWidth(child) + ASPx.GetLeftRightMargins(child);
                if(textContainer)
                    rightWidth += width;
                else
                    leftWidth += width;
            }
        }
    }
    
    if(textContainer && ASPx.IsTextWrapped(textContainer)) {
        var containerWidth = ASPx.GetElementOffsetWidth(container) - ASPx.GetLeftRightBordersAndPaddingsSummaryValue(container);
        if(textContainer.shrinkedTextContainer) {
            Attr.RestoreStyleAttribute(textContainer, "width");
            Attr.ChangeStyleAttribute(container, "width", containerWidth + "px");
        }
        if(ASPx.GetElementOffsetWidth(textContainer) + leftWidth + rightWidth >= containerWidth) {
             if(rightWidth > 0 && !textContainer.shrinkedTextContainer)
                textContainer.style.width = (containerWidth - rightWidth) + "px";
            else if(leftWidth > 0){
                if(ASPx.IsElementRightToLeft(container))
                    textContainer.style.marginLeft = leftWidth + "px";
                else
                    textContainer.style.marginRight = leftWidth + "px";
            }
        }
    }
};
ASPx.IsTextWrapped = function(element) {
    return element && ASPx.GetCurrentStyle(element).whiteSpace !== "nowrap";
};

ASPx.IsValidPosition = function(pos){
    return pos != ASPx.InvalidPosition && pos != -ASPx.InvalidPosition;
};
ASPx.getSpriteMainElement = function(element) {
    var cssClassMarker = "dx-acc";
    if(ASPx.ElementContainsCssClass(element, cssClassMarker))
        return element;
    if(element.parentNode && ASPx.ElementContainsCssClass(element.parentNode, cssClassMarker))
        return element.parentNode;
    return element;
};
ASPx.GetAbsoluteX = function(curEl){
    return ASPx.GetAbsolutePositionX(curEl);
};
ASPx.GetAbsoluteY = function(curEl){
    return ASPx.GetAbsolutePositionY(curEl);
};
ASPx.SetAbsoluteX = function(element, x){
    element.style.left = ASPx.PrepareClientPosForElement(x, element, true) + "px";
};
ASPx.SetAbsoluteY = function(element, y){
    element.style.top = ASPx.PrepareClientPosForElement(y, element, false) + "px";
};
ASPx.GetAbsolutePositionX = function(element){
    if(Browser.IE)
        return getAbsolutePositionX_IE(element);
    else if(Browser.Firefox && Browser.Version >= 3)
        return getAbsolutePositionX_FF3(element);
    else if(Browser.Opera)
        return getAbsolutePositionX_Opera(element);
    else if(Browser.NetscapeFamily && (!Browser.Firefox || Browser.Version < 3))
        return getAbsolutePositionX_NS(element);
    else if(Browser.WebKitFamily || Browser.Edge)
        return getAbsolutePositionX_FF3(element);
    else
        return getAbsolutePositionX_Other(element);
};
function getAbsolutePositionX_Opera(curEl){
    var isFirstCycle = true;
    var pos = getAbsoluteScrollOffset_OperaFF(curEl, true);
    while(curEl != null) {
        pos += curEl.offsetLeft;
        if(!isFirstCycle)
            pos -= curEl.scrollLeft;
        curEl = curEl.offsetParent;
        isFirstCycle = false;
    }
    pos += document.body.scrollLeft;
    return pos;
}
function getAbsolutePositionX_IE(element){
    if(element == null || Browser.IE && element.parentNode == null) return 0; // B96664
    return element.getBoundingClientRect().left + ASPx.GetDocumentScrollLeft();
}
function getAbsolutePositionX_FF3(element){
    if(element == null) return 0;
    var x = element.getBoundingClientRect().left + ASPx.GetDocumentScrollLeft();
    return x;
}
function getAbsolutePositionX_NS(curEl){
    var pos = getAbsoluteScrollOffset_OperaFF(curEl, true);
    var isFirstCycle = true;
    while(curEl != null) {
        pos += curEl.offsetLeft;
        if(!isFirstCycle && curEl.offsetParent != null)
            pos -= curEl.scrollLeft;
        if(!isFirstCycle && Browser.Firefox){
            var style = ASPx.GetCurrentStyle(curEl);
            if(curEl.tagName == "DIV" && style.overflow != "visible")
                pos += ASPx.PxToInt(style.borderLeftWidth);
        }
        isFirstCycle = false;
        curEl = curEl.offsetParent;
    }
    return pos;
}
//function getAbsolutePositionX_Safari(curEl){
//    var pos = getAbsoluteScrollOffset_WebKit(curEl, true);
//	var isSafariVerNonLessThan3OrChrome = Browser.Safari && Browser.Version >= 3 || Browser.Chrome;
//    if(curEl != null){
//        var isFirstCycle = true;
//        if(isSafariVerNonLessThan3OrChrome && curEl.tagName == "TD") {
//            pos += curEl.offsetLeft;
//            curEl = curEl.offsetParent;
//            isFirstCycle = false;
//        }
//        var hasNonStaticElement = false;
//        while (curEl != null) {
//            pos += curEl.offsetLeft;

//            var style = ASPx.GetCurrentStyle(curEl);
//            var isNonStatic = style.position !== "" && style.position !== "static";
//            if(isNonStatic)
//                hasNonStaticElement = true;
//            var safariDisplayTable = Browser.Safari && Browser.Version >= 8 && style.display === "table";
//            var posDiv = curEl.tagName == "DIV" && isNonStatic && !safariDisplayTable;
//            if(!isFirstCycle && (curEl.tagName == "TD" || curEl.tagName == "TABLE" || posDiv))
//                pos += curEl.clientLeft;
//            isFirstCycle = false;
//            curEl = curEl.offsetParent;
//        }
//        if(!hasNonStaticElement && (document.documentElement.style.position === "" || document.documentElement.style.position === "static"))
//            pos += document.documentElement.offsetLeft;
//    }
//    return pos;
//}
function getAbsolutePositionX_Other(curEl){
    var pos = 0;
    var isFirstCycle = true;
    while(curEl != null) {
        pos += curEl.offsetLeft;
        if(!isFirstCycle && curEl.offsetParent != null)
            pos -= curEl.scrollLeft;
        isFirstCycle = false;
        curEl = curEl.offsetParent;
    }
    return pos;
}
ASPx.GetAbsolutePositionY = function(element){
    if(Browser.IE)
        return getAbsolutePositionY_IE(element);
    else if(Browser.Firefox && Browser.Version >= 3)
        return getAbsolutePositionY_FF3(element);
    else if(Browser.Opera)
        return getAbsolutePositionY_Opera(element);
    else if(Browser.NetscapeFamily && (!Browser.Firefox || Browser.Version < 3))
        return getAbsolutePositionY_NS(element);
    else if(Browser.WebKitFamily || Browser.Edge)
        return getAbsolutePositionY_FF3(element);
    else
        return getAbsolutePositionY_Other(element);
};
function getAbsolutePositionY_Opera(curEl){
    var isFirstCycle = true;
    if(curEl && curEl.tagName == "TR" && curEl.cells.length > 0)
        curEl = curEl.cells[0];
    var pos = getAbsoluteScrollOffset_OperaFF(curEl, false);
    while(curEl != null) {
        pos += curEl.offsetTop;
        if(!isFirstCycle)
            pos -= curEl.scrollTop;
        curEl = curEl.offsetParent;
        isFirstCycle = false;
    }
    pos += document.body.scrollTop;
    return pos;
}
function getAbsolutePositionY_IE(element){
    if(element == null || Browser.IE && element.parentNode == null) return 0; // B96664
    return element.getBoundingClientRect().top + ASPx.GetDocumentScrollTop();
}
function getAbsolutePositionY_FF3(element){
    if(element == null) return 0;
    var y = element.getBoundingClientRect().top + ASPx.GetDocumentScrollTop();
    return y;
}
function getAbsolutePositionY_NS(curEl){
    var pos = getAbsoluteScrollOffset_OperaFF(curEl, false);
    var isFirstCycle = true;
    while(curEl != null) {
        pos += curEl.offsetTop;
        if(!isFirstCycle && curEl.offsetParent != null)
            pos -= curEl.scrollTop;
        if(!isFirstCycle && Browser.Firefox){
            var style = ASPx.GetCurrentStyle(curEl);
            if(curEl.tagName == "DIV" && style.overflow != "visible")
                pos += ASPx.PxToInt(style.borderTopWidth);
        }
        isFirstCycle = false;
        curEl = curEl.offsetParent;
    }
    return pos;
}
//var WebKit3TDRealInfo = {
//    GetOffsetTop: function(tdElement){
//        switch(ASPx.GetCurrentStyle(tdElement).verticalAlign){
//            case "middle":
//                return Math.round(tdElement.offsetTop - (tdElement.offsetHeight - tdElement.clientHeight )/2 + tdElement.clientTop);
//            case "bottom":
//                return tdElement.offsetTop - tdElement.offsetHeight + tdElement.clientHeight + tdElement.clientTop;
//        }
//        return tdElement.offsetTop;
//    },
//    GetClientHeight: function(tdElement){
//        var valign = ASPx.GetCurrentStyle(tdElement).verticalAlign;
//        switch(valign){
//            case "middle":
//                return tdElement.clientHeight + tdElement.offsetTop * 2;
//            case "top":
//                return tdElement.offsetHeight - tdElement.clientTop * 2;
//            case "bottom":
//                return tdElement.clientHeight + tdElement.offsetTop;
//        }
//        return tdElement.clientHeight;
//    }
//};
//function getAbsolutePositionY_Safari(curEl){
//    var pos = getAbsoluteScrollOffset_WebKit(curEl, false);
//    var isSafariVerNonLessThan3OrChrome = Browser.Safari && Browser.Version >= 3 || Browser.Chrome;
//    if(curEl != null){
//        var isFirstCycle = true;
//        if(isSafariVerNonLessThan3OrChrome && curEl.tagName == "TD") {
//            pos += WebKit3TDRealInfo.GetOffsetTop(curEl);
//            curEl = curEl.offsetParent;
//            isFirstCycle = false;
//        }
//        var hasNonStaticElement = false;
//        while (curEl != null) {
//            pos += curEl.offsetTop;

//            var style = ASPx.GetCurrentStyle(curEl);
//            var isNonStatic = style.position !== "" && style.position !== "static";
//            if(isNonStatic)
//                hasNonStaticElement = true;
//            var safariDisplayTable = Browser.Safari && Browser.Version >= 8 && style.display === "table";
//            var posDiv = curEl.tagName == "DIV" && isNonStatic && !safariDisplayTable;
//            if(!isFirstCycle && (curEl.tagName == "TD" || curEl.tagName == "TABLE" || posDiv))
//                pos += curEl.clientTop;
//            isFirstCycle = false;
//            curEl = curEl.offsetParent;
//        }
//        if(!hasNonStaticElement && (document.documentElement.style.position === "" || document.documentElement.style.position === "static"))
//            pos += document.documentElement.offsetTop;
//    }
//    return pos;
//}
// B91523
function getAbsoluteScrollOffset_OperaFF(curEl, isX) {
    var pos = 0;   
    var isFirstCycle = true;
    while(curEl != null) {
        if(curEl.tagName == "BODY")
            break;
        var style = ASPx.GetCurrentStyle(curEl);
        if(style.position == "absolute")
            break;
        if(!isFirstCycle && curEl.tagName == "DIV" && (style.position == "" || style.position == "static"))
            pos -= isX ? curEl.scrollLeft : curEl.scrollTop;
        curEl = curEl.parentNode;
        isFirstCycle = false;
    }
    return pos; 
}
//function getAbsoluteScrollOffset_WebKit(curEl, isX) {
//    var pos = 0;   
//    var isFirstCycle = true;
//    var step = 0;
//    var absoluteWasFoundAtStep = -1;
//    var isThereFixedParent = false;
//    while(curEl != null) {
//        if(curEl.tagName == "BODY")
//            break;
//        var style = ASPx.GetCurrentStyle(curEl);

//        var positionIsDefault = style.position == "" || style.position == "static";
//        var absoluteWasFoundAtPreviousStep = absoluteWasFoundAtStep >= 0 && absoluteWasFoundAtStep < step;
//        var canHaveScrolls = curEl.tagName == "DIV" || curEl.tagName == "SECTION" || curEl.tagName == "FORM";
//        if(!isFirstCycle && canHaveScrolls && (!positionIsDefault || !absoluteWasFoundAtPreviousStep))
//            pos -= isX ? curEl.scrollLeft : curEl.scrollTop;
        
//        if(style.position == "absolute")
//            absoluteWasFoundAtStep = step;
//        else if(style.position == "relative")
//            absoluteWasFoundAtStep = -1;
//        else if(style.position == "fixed")
//            isThereFixedParent = true;

//        curEl = curEl.parentNode;
//        isFirstCycle = false;
//        step ++;
//    }
//	if(isThereFixedParent)
//		pos += isX ? ASPx.GetDocumentScrollLeft() : ASPx.GetDocumentScrollTop();
//    return pos; 
//}
function getAbsolutePositionY_Other(curEl){
    var pos = 0;
    var isFirstCycle = true;
    while(curEl != null) {
        pos += curEl.offsetTop;
        if(!isFirstCycle && curEl.offsetParent != null)
            pos -= curEl.scrollTop;
        
        isFirstCycle = false;
        curEl = curEl.offsetParent;
    }
    return pos;
}

function createElementMock(element) {
    var div = document.createElement('DIV');
    div.style.top = "0px";
    div.style.left = "0px";
    div.visibility = "hidden";
    div.style.position = ASPx.GetCurrentStyle(element).position;
    return div;
}
ASPx.PrepareClientPosElementForOtherParent = function(pos, element, otherParent, isX) {
    if(element.parentNode == otherParent)
        return ASPx.PrepareClientPosForElement(pos, element, isX);
    var elementMock = createElementMock(element);
    otherParent.appendChild(elementMock); 
    var preparedPos = ASPx.PrepareClientPosForElement(pos, elementMock, isX);
    otherParent.removeChild(elementMock);
    return preparedPos;
};
ASPx.PrepareClientPosForElement = function(pos, element, isX) {
    pos -= ASPx.GetPositionElementOffset(element, isX);
    return pos;
};

function getExperimentalPositionOffset(element, isX) {
    var div = createElementMock(element);
    if(div.style.position == "static")
        div.style.position = "absolute";
    element.parentNode.appendChild(div); 
    var realPos = isX ? ASPx.GetAbsoluteX(div) : ASPx.GetAbsoluteY(div);
    element.parentNode.removeChild(div);
    return realPos;
}
ASPx.GetPositionElementOffset = function(element, isX) {
    return getExperimentalPositionOffset(element, isX);
};
//function getPositionElementOffsetCore(element, isX) {
//    var curEl = element.offsetParent;
//    var offset = 0;
//    var scroll = 0;
//    var isThereFixedParent = false;
//    var isFixed = false;
//    var hasDisplayTableParent = false;
//    var position = "";
//    while(curEl != null) {
//        var tagName = curEl.tagName;
//        if(tagName == "HTML"){
//            break;
//        }
//        if(tagName == "BODY"){
//            if(!Browser.Opera && !Browser.Chrome && !Browser.Edge){
//                var style = ASPx.GetCurrentStyle(curEl);
//                if(style.position != "" && style.position != "static"){
//                    offset += ASPx.PxToInt(isX ? style.left : style.top);
//                    offset += ASPx.PxToInt(isX ? style.marginLeft : style.marginTop);
//                }
//            }
//            break;
//        }
//        var style = ASPx.GetCurrentStyle(curEl);
//        isFixed = style.position == "fixed";
//        if(isFixed) {
//            isThereFixedParent = true;
//            if(Browser.IE) 
//                return getExperimentalPositionOffset(element, isX); //Q260707, B157137
//        }
            
//        hasDisplayTableParent = style.display == "table" && (style.position == "absolute" || style.position == "relative");
//        if(hasDisplayTableParent && Browser.IE)
//            return getExperimentalPositionOffset(element, isX);

//        if(style.position == "absolute" || isFixed || style.position == "relative") {
//            offset += isX ? curEl.offsetLeft : curEl.offsetTop;
//            offset += ASPx.PxToInt(isX ? style.borderLeftWidth : style.borderTopWidth);
//        }
//        if(style.position == "relative") // B199061
//            scroll += getElementChainScroll(curEl, curEl.offsetParent, isX);
//        scroll += isX ? curEl.scrollLeft : curEl.scrollTop;
//        curEl = curEl.offsetParent;
//    }
//    offset -= scroll; // Bug B92105
//    if((Browser.IE || Browser.Firefox && Browser.Version >= 3 || Browser.WebKitFamily || Browser.Edge) && isThereFixedParent)
//        offset += isX ? ASPx.GetDocumentScrollLeft() : ASPx.GetDocumentScrollTop();
//    return offset;
//}
//function getElementChainScroll(startElement, endElement, isX){
//    var curEl = startElement.parentNode;
//    var scroll = 0;
//    while(curEl != endElement){
//        scroll += isX ? curEl.scrollLeft : curEl.scrollTop;
//        curEl = curEl.parentNode;
//    }
//    return scroll;
//}

ASPx.GetSizeOfText = function(text, textCss) {
    var testContainer = document.createElement("tester");
    var defaultLineHeight = ASPx.Browser.Firefox ? "1" : "";
    
    testContainer.style.fontSize = textCss.fontSize;
    testContainer.style.fontFamily = textCss.fontFamily;
    testContainer.style.fontWeight = textCss.fontWeight;
    testContainer.style.letterSpacing = textCss.letterSpacing;
    testContainer.style.lineHeight = textCss.lineHeight || defaultLineHeight;
    
    testContainer.style.position = "absolute";
    testContainer.style.top = ASPx.InvalidPosition + "px";
    testContainer.style.left = ASPx.InvalidPosition + "px";
    testContainer.style.width = "auto";
    testContainer.style.whiteSpace = "nowrap";
    
    testContainer.appendChild(document.createTextNode(text));
    var testElement = document.body.appendChild(testContainer);
    var size = {
        "width": testElement.offsetWidth,
        "height": testElement.offsetHeight
    };
    document.body.removeChild(testElement);
    return size;
};
ASPx.PointToPixel = function(points, addPx) {  
    var result = 0;
    try {
        var indexOfPt = points.toLowerCase().indexOf("pt");
        if(indexOfPt > -1)
            result = parseInt(points.substr(0, indexOfPt)) * 96 / 72;
        else
            result = parseInt(points) * 96 / 72;
        if(addPx)
            result = result + "px";
    } catch(e) {}
    return result;
};
ASPx.PixelToPoint = function(pixels, addPt) { 
    var result = 0;
    try {
        var indexOfPx = pixels.toLowerCase().indexOf("px");
        if(indexOfPx > -1)
            result = parseInt(pixels.substr(0, indexOfPx)) * 72 / 96;
        else
            result = parseInt(pixels) * 72 / 96;
        if(addPt)
            result = result + "pt";
    } catch(e) {}
    return result;                           
};
ASPx.PxToInt = function(px) {
    return pxToNumber(px, parseInt);
};
ASPx.PxToFloat = function(px) {
    return pxToNumber(px, parseFloat);
};
function pxToNumber(px, parseFunction) {
    var result = 0;
    if(px != null && px != "") {
        try {
            var indexOfPx = px.indexOf("px");
            if(indexOfPx > -1)
                result = parseFunction(px.substr(0, indexOfPx));
        } catch(e) { }
    }
    return result;
}
ASPx.PercentageToFloat = function(perc) {
    var result = 0;
    if(perc != null && perc != "") {
        try {
            var indexOfPerc = perc.indexOf("%");
            if(indexOfPerc > -1)
                result = parseFloat(perc.substr(0, indexOfPerc)) / 100;
        } catch(e) { }
    }
    return result;
};
ASPx.CreateGuid = function() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) { 
            var r = Math.random()*16|0,v=c=='x'?r:r&0x3|0x8;
        return v.toString(16);
    });
};

ASPx.GetLeftRightBordersAndPaddingsSummaryValue = function(element, currentStyle) {
    return ASPx.GetLeftRightPaddings(element, currentStyle) + ASPx.GetHorizontalBordersWidth(element, currentStyle);
};
ASPx.GetTopBottomBordersAndPaddingsSummaryValue = function(element, currentStyle) {
    return ASPx.GetTopBottomPaddings(element, currentStyle) + ASPx.GetVerticalBordersWidth(element, currentStyle);
};
ASPx.GetVerticalBordersWidth = function(element, style) {
    if(!ASPx.IsExists(style))
        style = (Browser.IE && Browser.MajorVersion != 9 && window.getComputedStyle) ? window.getComputedStyle(element) : ASPx.GetCurrentStyle(element);
    var res = 0;

    if(style.borderTopStyle != "none") {
		res += ASPx.PxToFloat(style.borderTopWidth);
        if(Browser.IE && Browser.MajorVersion < 9)
            res += getIe8BorderWidthFromText(style.borderTopWidth);
    }
    if(style.borderBottomStyle != "none") {
		res += ASPx.PxToFloat(style.borderBottomWidth);
        if(Browser.IE && Browser.MajorVersion < 9)
            res += getIe8BorderWidthFromText(style.borderBottomWidth);
    }
    return res;
};
ASPx.GetHorizontalBordersWidth = function(element, style) {
    if(!ASPx.IsExists(style))
        style = (Browser.IE && window.getComputedStyle) ? window.getComputedStyle(element) : ASPx.GetCurrentStyle(element);
    var res = 0;

    if(style.borderLeftStyle != "none") {
		res += ASPx.PxToFloat(style.borderLeftWidth);
        if(Browser.IE && Browser.MajorVersion < 9)
            res += getIe8BorderWidthFromText(style.borderLeftWidth);
    }
    if(style.borderRightStyle != "none") {
		res += ASPx.PxToFloat(style.borderRightWidth);
        if(Browser.IE && Browser.MajorVersion < 9)
            res += getIe8BorderWidthFromText(style.borderRightWidth);
    }

    return res;
};
function getIe8BorderWidthFromText(textWidth) {
    var availableWidth = { "thin": 1, "medium" : 3, "thick": 5 };
    var width = availableWidth[textWidth];
    return width ? width : 0;
}
ASPx.GetTopBottomPaddings = function(element, style) {
    var currentStyle = style ? style : ASPx.GetCurrentStyle(element);
    return ASPx.PxToInt(currentStyle.paddingTop) + ASPx.PxToInt(currentStyle.paddingBottom);
};
ASPx.GetTopPaddings = function(element, style) {
    var currentStyle = style ? style : ASPx.GetCurrentStyle(element);
    return ASPx.PxToInt(currentStyle.paddingTop);
};
ASPx.GetBottomPaddings = function(element, style) {
    var currentStyle = style ? style : ASPx.GetCurrentStyle(element);
    return ASPx.PxToInt(currentStyle.paddingBottom);
};
ASPx.GetLeftRightPaddings = function(element, style) {
    var currentStyle = style ? style : ASPx.GetCurrentStyle(element);
    return ASPx.PxToInt(currentStyle.paddingLeft) + ASPx.PxToInt(currentStyle.paddingRight);
};
ASPx.GetTopBottomMargins = function(element, style) {
    var currentStyle = style ? style : ASPx.GetCurrentStyle(element);
    return ASPx.PxToInt(currentStyle.marginTop) + ASPx.PxToInt(currentStyle.marginBottom);
};
ASPx.GetLeftRightMargins = function(element, style) {
    var currentStyle = style ? style : ASPx.GetCurrentStyle(element);
    return ASPx.PxToInt(currentStyle.marginLeft) + ASPx.PxToInt(currentStyle.marginRight);
};

ASPx.GetClearClientWidth = function(element) {
    return ASPx.GetElementOffsetWidth(element)- ASPx.GetLeftRightBordersAndPaddingsSummaryValue(element);
};
ASPx.GetClearClientHeight = function(element) {
    return ASPx.GetElementOffsetHeight(element) - ASPx.GetTopBottomBordersAndPaddingsSummaryValue(element);
};
ASPx.SetOffsetWidth = function(element, widthValue, currentStyle) {
    if(!ASPx.IsExists(currentStyle))
        currentStyle = ASPx.GetCurrentStyle(element);
    var value = widthValue - ASPx.PxToInt(currentStyle.marginLeft) - ASPx.PxToInt(currentStyle.marginRight);
        value -= ASPx.GetLeftRightBordersAndPaddingsSummaryValue(element, currentStyle);
    // B90988
    if(value > -1)
        element.style.width = value + "px";
};
ASPx.SetOffsetHeight = function(element, heightValue, currentStyle) {
    if(!ASPx.IsExists(currentStyle))
        currentStyle = ASPx.GetCurrentStyle(element);
    var value = heightValue - ASPx.PxToInt(currentStyle.marginTop) - ASPx.PxToInt(currentStyle.marginBottom);
        value -= ASPx.GetTopBottomBordersAndPaddingsSummaryValue(element, currentStyle);
    // B90988
    if(value > -1)
        element.style.height = value + "px";
};
ASPx.FindOffsetParent = function(element) {
    var currentElement = element.parentNode;
    while(ASPx.IsExistsElement(currentElement) && currentElement.tagName != "BODY") {
        if(ASPx.GetElementOffsetWidth(currentElement) > 0 && ASPx.GetElementOffsetHeight(currentElement) > 0)
            return currentElement;
        currentElement = currentElement.parentNode;
    }
    return document.body;
};
ASPx.GetDocumentScrollTop = function(){
    var isScrollBodyIE = Browser.IE && ASPx.GetCurrentStyle(document.body).overflow == "hidden" && document.body.scrollTop > 0;
    if(Browser.WebKitFamily || Browser.Edge || isScrollBodyIE) {
        if(Browser.MacOSMobilePlatform) //B157267
            return window.pageYOffset;
        if(Browser.WebKitFamily)
            return document.documentElement.scrollTop || document.body.scrollTop;
        return document.body.scrollTop;
    }
    else
        return document.documentElement.scrollTop;
};
ASPx.SetDocumentScrollTop = function(scrollTop) {
    if(Browser.WebKitFamily && Browser.Version < 60 || Browser.Edge)
        document.body.scrollTop = scrollTop;
    else
        document.documentElement.scrollTop = scrollTop;
};
ASPx.GetDocumentScrollLeft = function(){
    var isScrollBodyIE = Browser.IE && ASPx.GetCurrentStyle(document.body).overflow == "hidden" && document.body.scrollLeft > 0;
    if(Browser.Edge || isScrollBodyIE)
        return document.body ? document.body.scrollLeft : document.documentElement.scrollLeft;
    if(Browser.WebKitFamily)
        return document.documentElement.scrollLeft || document.body.scrollLeft;
    return document.documentElement.scrollLeft;
};
ASPx.SetDocumentScrollLeft = function (scrollLeft) {
    if(Browser.WebKitFamily && Browser.Version < 60 || Browser.Edge)
        document.body.scrollLeft = scrollLeft;
    else
        document.documentElement.scrollLeft = scrollLeft;
};
ASPx.GetDocumentClientWidth = function(){
    if(document.documentElement.clientWidth == 0)
        return document.body.clientWidth;
    else
        return document.documentElement.clientWidth;
};
ASPx.GetDocumentClientHeight = function() {
    if(Browser.Firefox && window.innerHeight - document.documentElement.clientHeight > ASPx.GetVerticalScrollBarWidth()) {
        return window.innerHeight;
    } else if(Browser.Opera && Browser.Version < 9.6 || document.documentElement.clientHeight == 0) {
         return document.body.clientHeight;
    }
    return document.documentElement.clientHeight;
};

ASPx.GetDocumentWidth = function(){
    var bodyWidth = document.body.offsetWidth;
    var docWidth = Browser.IE ? document.documentElement.clientWidth : document.documentElement.offsetWidth;
    var bodyScrollWidth = document.body.scrollWidth;
    var docScrollWidth = document.documentElement.scrollWidth;
    return getMaxDimensionOf(bodyWidth, docWidth, bodyScrollWidth, docScrollWidth);
};
ASPx.GetDocumentHeight = function(){
    var bodyHeight = document.body.offsetHeight;
    var docHeight = Browser.IE ? document.documentElement.clientHeight : document.documentElement.offsetHeight;
    var bodyScrollHeight = document.body.scrollHeight;
    var docScrollHeight = document.documentElement.scrollHeight;
    var maxHeight = getMaxDimensionOf(bodyHeight, docHeight, bodyScrollHeight, docScrollHeight);

    if(Browser.Opera && Browser.Version >= 9.6){
        if(Browser.Version < 10)
            maxHeight = getMaxDimensionOf(bodyHeight, docHeight, bodyScrollHeight);
        var visibleHeightOfDocument = document.documentElement.clientHeight;
        if(maxHeight > visibleHeightOfDocument)
            maxHeight = getMaxDimensionOf(window.outerHeight, maxHeight);
        else
            maxHeight = document.documentElement.clientHeight;
        return maxHeight;
    }
    return maxHeight;
};
ASPx.GetDocumentMaxClientWidth = function(){
    var bodyWidth = document.body.offsetWidth;
    var docWidth = document.documentElement.offsetWidth;
    var docClientWidth = document.documentElement.clientWidth;
    return getMaxDimensionOf(bodyWidth, docWidth, docClientWidth);
};
ASPx.GetDocumentMaxClientHeight = function(){
    var bodyHeight = document.body.offsetHeight;
    var docHeight = document.documentElement.offsetHeight;
    var docClientHeight = document.documentElement.clientHeight;
    return getMaxDimensionOf(bodyHeight, docHeight, docClientHeight);
};
ASPx.verticalScrollIsNotHidden = null;
ASPx.horizontalScrollIsNotHidden = null;
ASPx.GetVerticalScrollIsNotHidden = function() {
    if(!ASPx.IsExists(ASPx.verticalScrollIsNotHidden))
        ASPx.verticalScrollIsNotHidden = ASPx.GetCurrentStyle(document.body).overflowY !== "hidden"
            && ASPx.GetCurrentStyle(document.documentElement).overflowY !== "hidden";
    return ASPx.verticalScrollIsNotHidden;
};
ASPx.GetHorizontalScrollIsNotHidden = function() {
    if(!ASPx.IsExists(ASPx.horizontalScrollIsNotHidden))
        ASPx.horizontalScrollIsNotHidden = ASPx.GetCurrentStyle(document.body).overflowX !== "hidden"
            && ASPx.GetCurrentStyle(document.documentElement).overflowX !== "hidden";
    return ASPx.horizontalScrollIsNotHidden;
};
ASPx.GetCurrentDocumentWidth = function() {
    var result = ASPx.GetDocumentClientWidth();
    if(!ASPx.Browser.Safari && ASPx.GetVerticalScrollIsNotHidden() && ASPx.GetDocumentHeight() > ASPx.GetDocumentClientHeight())
        result += ASPx.GetVerticalScrollBarWidth();
    return result;
};
ASPx.GetCurrentDocumentHeight = function() {
    var result = ASPx.GetDocumentClientHeight();
    if(!ASPx.Browser.Safari && ASPx.GetHorizontalScrollIsNotHidden() && ASPx.GetDocumentWidth() > ASPx.GetDocumentClientWidth())
        result += ASPx.GetVerticalScrollBarWidth();
    return result;
};
function getMaxDimensionOf(){
    var max = ASPx.InvalidDimension;
    for(var i = 0; i < arguments.length; i++){
        if(max < arguments[i])
            max = arguments[i];
    }
    return max;
}
ASPx.GetClientLeft = function(element) {
    return ASPx.IsExists(element.clientLeft) ? element.clientLeft : (ASPx.GetElementOffsetWidth(element)- element.clientWidth) / 2;
};
ASPx.GetClientTop = function(element) {
    return ASPx.IsExists(element.clientTop) ? element.clientTop : (ASPx.GetElementOffsetHeight(element) - element.clientHeight) / 2;
};
var requestAnimationFrameFunc = window.requestAnimationFrame || function(callback) { callback(); };
var cancelAnimationFrameFunc = window.cancelAnimationFrame || function(id) { };
ASPx.CancelAnimationFrame = function(id) { cancelAnimationFrameFunc(id); };
ASPx.RequestAnimationFrame = function (callback) { return requestAnimationFrameFunc(callback); };
ASPx.SetStyles = function(element, styles, makeImportant) {
    if(ASPx.IsExists(styles.cssText))
        element.style.cssText = styles.cssText;
    if(ASPx.IsExists(styles.className)) {
        ASPx.SetClassName(element, styles.className);
    }
    for(var property in styles) {
        if(!styles.hasOwnProperty(property))
            continue;
        var value = styles[property];
        switch (property) {
            case "cssText":
            case "className":
                break;
            case "float":
                ASPx.SetElementFloat(element, value);
                break;
            case "opacity":
                ASPx.SetElementOpacity(element, value);
                break;
            case "zIndex":
                ASPx.SetStylesCore(element, property, value, makeImportant);
                break;
            /*jshint -W086 */
            case "fontWeight":
                if(ASPx.Browser.IE && ASPx.Browser.Version < 9 && typeof(styles[property]) == "number")
                    value = styles[property].toString();
            default:
                ASPx.SetStylesCore(element, property, value + (typeof (value) == "number" ? "px" : ""), makeImportant);
            /*jshint +W086 */
        }
    }
};
ASPx.SetStylesCore = function(element, property, value, makeImportant) {
    if(makeImportant) {
        var index = property.search("[A-Z]");
        if(index != -1)
            property = property.replace(property.charAt(index), "-" + property.charAt(index).toLowerCase());
        if(element.style.setProperty)
            element.style.setProperty(property, value, "important");
        else 
            element.style.cssText += ";" + property + ":" + value + "!important";
    }
    else
        element.style[property] = value;
};

ASPx.RemoveBordersAndShadows = function(el) {
    if(!el || !el.style)
        return;
    el.style.borderWidth = 0;
    if(ASPx.IsExists(el.style.boxShadow))
        el.style.boxShadow = "none";
    else if(ASPx.IsExists(el.style.MozBoxShadow))
        el.style.MozBoxShadow = "none";
    else if(ASPx.IsExists(el.style.webkitBoxShadow))
        el.style.webkitBoxShadow = "none";
};

ASPx.GetCellSpacing = function(element) {
    var val = parseInt(element.cellSpacing);
    if(!isNaN(val)) return val;
    val = parseInt(ASPx.GetCurrentStyle(element).borderSpacing);
    if(!isNaN(val)) return val;
    return 0;
};

ASPx.GetInnerScrollPositions = function(element) {
    var scrolls = [];
    getInnerScrollPositionsCore(element, scrolls);
    return scrolls;
};
function getInnerScrollPositionsCore(element, scrolls) {
    for(var child = element.firstChild; child; child = child.nextSibling) {
        var scrollTop = child.scrollTop,
            scrollLeft = child.scrollLeft;
        if(scrollTop > 0 || scrollLeft > 0)
            scrolls.push([child, scrollTop, scrollLeft]);
        getInnerScrollPositionsCore(child, scrolls);
    }
}
ASPx.RestoreInnerScrollPositions = function(scrolls) {
    for(var i = 0, scrollArr; scrollArr = scrolls[i]; i++) {
        if(scrollArr[1] > 0)
            scrollArr[0].scrollTop = scrollArr[1];
        if(scrollArr[2] > 0)
            scrollArr[0].scrollLeft = scrollArr[2];
    }
};
ASPx.GetOuterScrollPosition = function(element) {
    while(element && element.tagName !== "BODY") {
        var scrollTop = element.scrollTop,
            scrollLeft = element.scrollLeft;
        if(scrollTop > 0 || scrollLeft > 0) {
            return {
                scrollTop: scrollTop,
                scrollLeft: scrollLeft,
                element: element
            };
        }
        element = element.parentNode;
    }
    return {
        scrollTop: ASPx.GetDocumentScrollTop(),
        scrollLeft: ASPx.GetDocumentScrollLeft()
    };
};
ASPx.RestoreOuterScrollPosition = function(scrollInfo) {
    if(scrollInfo.element) {
        if(scrollInfo.scrollTop > 0)
            scrollInfo.element.scrollTop = scrollInfo.scrollTop;
        if(scrollInfo.scrollLeft > 0)
            scrollInfo.element.scrollLeft = scrollInfo.scrollLeft;
    }
    else {
        if(scrollInfo.scrollTop > 0)
            ASPx.SetDocumentScrollTop(scrollInfo.scrollTop);
        if(scrollInfo.scrollLeft > 0)
            ASPx.SetDocumentScrollLeft(scrollInfo.scrollLeft);
    }
};

ASPx.ChangeElementContainer = function(element, container, savePreviousContainer) {
    if(element.parentNode != container) {
        var parentNode = element.parentNode;
        parentNode.removeChild(element);
        container.appendChild(element);
        if(savePreviousContainer)
            element.previousContainer = parentNode;
    }
};
ASPx.RestoreElementContainer = function(element) {
    if(element.previousContainer) {
        ASPx.ChangeElementContainer(element, element.previousContainer, false);
        element.previousContainer = null;
    }
};
ASPx.MoveChildrenToElement = function(sourceElement, destinationElement){
    while(sourceElement.childNodes.length > 0)
        destinationElement.appendChild(sourceElement.childNodes[0]);
};

ASPx.GetScriptCode = function(script) {
    var useFirstChildElement = Browser.Chrome && Browser.Version < 11 || Browser.Safari && Browser.Version < 5; //B184987
	var text = useFirstChildElement ? script.firstChild.data : script.text;
    var comment = "<!--";
    var pos = text.indexOf(comment);
    if(pos > -1)
        text = text.substr(pos + comment.length);
    return text;
};
ASPx.AppendScript = function(script) {
    var parent = document.getElementsByTagName("head")[0];
    if(!parent)
        parent = document.body;
    if(parent)
        parent.appendChild(script);
};

function getFrame(frames, name) {
    if(frames[name])
        return frames[name];
    for(var i = 0; i < frames.length; i++) {
        try {
            var frame = frames[i];
            if(frame.name == name) 
                return frame;    

            frame = getFrame(frame.frames, name);
            if(frame != null)   
                return frame;    
        } catch(e) {
        
        }    
    }
    return null;
}

ASPx.IsValidElement = function(element) {
    if(!element) 
        return false;
    if(!(Browser.Firefox && Browser.Version < 4)) {
        if(element.ownerDocument && element.ownerDocument.body && element.ownerDocument.body.compareDocumentPosition)
            return element.ownerDocument.body.compareDocumentPosition(element) % 2 === 0;
    }
    if(!Browser.Opera && !(Browser.IE && Browser.Version < 9) && element.offsetParent && element.parentNode.tagName)
        return true;
    while(element != null){
        if(element.tagName == "BODY")
            return true;
        element = element.parentNode;
    }
    return false;
};
ASPx.IsValidElements = function(elements) {
    if(!elements)
        return false;    
    for(var i = 0; i < elements.length; i++) {
        if(elements[i] && !ASPx.IsValidElement(elements[i]))
            return false;
    }
    return true;
};
ASPx.IsExistsElement = function(element) {
    return element && ASPx.IsValidElement(element);
};

ASPx.CreateHtmlElementFromString = function(str) {
    var dummy = ASPx.CreateHtmlElement();
    setInnerHtmlInternal(dummy, str);
    return dummy.firstChild;
};
ASPx.CreateHtmlElement = function(tagName, styles) {
    var element = document.createElement(tagName || "DIV");
    if(styles)
        ASPx.SetStyles(element, styles);
    return element;
};

ASPx.RestoreElementOriginalWidth = function(element) {
    if(!ASPx.IsExistsElement(element)) 
        return;
    element.style.width = element.dxOrigWidth = ASPx.GetElementOriginalWidth(element);
};
ASPx.GetElementOriginalWidth = function(element) {
    if(!ASPx.IsExistsElement(element)) 
        return null;
    var width;
    if(!ASPx.IsExists(element.dxOrigWidth)) {
        width = String(element.style.width).length > 0
            ? element.style.width
            : ASPx.GetElementOffsetWidth(element) + "px";
    } else {
        width = element.dxOrigWidth;
    }
    return width;
};
ASPx.DropElementOriginalWidth = function(element) {
    if(ASPx.IsExists(element.dxOrigWidth))
        element.dxOrigWidth = null;
};

ASPx.GetObjectKeys = function(obj) {
    if(!obj) return [ ];
    if(Object.keys)
        return Object.keys(obj);

    var keys = [ ];
    for(var key in obj) {
        if(obj.hasOwnProperty(key))
            keys.push(key);
    }
    return keys;
};

ASPx.ShowErrorAlert = function(message) {
    message = ASPx.Str.DecodeHtmlViaTextArea(message);
    if(ASPx.IsExists(message) && message !== "")
        alert(message);
};

ASPx.ShowKBErrorMessage = function(text, kbid) {
    ASPx.ShowErrorMessage(text + "https://www.devexpress.com/kbid=" + kbid + ".");
};
ASPx.ShowErrorMessage = function(errorMessage) {
    var console = window.console;
    if(!console || !ASPx.IsFunction(console.error))
        return;

    console.error(errorMessage);
};

ASPx.IsInteractiveControl = function(element, extremeParent) { //TODO remove, use ASPx.IsActionElement instead
    return Data.ArrayIndexOf(["A", "INPUT", "SELECT", "OPTION", "TEXTAREA", "BUTTON", "IFRAME"], element.tagName) > -1;
};

ASPx.IsUrlContainsClientScript = function(url) {
    return url.toLowerCase().indexOf("javascript:") !== -1;
};

ASPx.GetMSAjaxRequestManager = function() {
    if(window.Sys && Sys.WebForms && Sys.WebForms.PageRequestManager && Sys.WebForms.PageRequestManager.getInstance)
        return Sys.WebForms.PageRequestManager.getInstance();
    return null;
};

/*jshint -W121 */
Function.prototype.aspxBind = function(scope) {
    var func = this;
    return function() {
        return func.apply(scope, arguments);
    };
};
/*jshint +W121 */

var FilteringUtils = { };
FilteringUtils.EventKeyCodeChangesTheInput = function(evt) {
    if(ASPx.IsPasteShortcut(evt))
        return true;
    else if(evt.ctrlKey && !evt.altKey)
        return false;

    if(ASPx.Browser.AndroidMobilePlatform || ASPx.Browser.MacOSMobilePlatform) return true; // Q525327 and T110630(bluetooth keyboard)
        
    var keyCode = ASPx.Evt.GetKeyCode(evt);
    var isSystemKey = ASPx.Key.Windows <= keyCode && keyCode <= ASPx.Key.ContextMenu;
    var isFKey = ASPx.Key.F1 <= keyCode && keyCode <= 127; // 127 - F16 for MAC
    return ASPx.Key.Delete <= keyCode && !isSystemKey && !isFKey || keyCode == ASPx.Key.Backspace || keyCode == ASPx.Key.Space;
};
FilteringUtils.FormatCallbackArg = function(prefix, arg) {
    return (ASPx.IsExists(arg) ? prefix + "|" + arg.length + ';' + arg + ';' : "");
};
ASPx.FilteringUtils = FilteringUtils;

var FormatStringHelper = { };
FormatStringHelper.PlaceHolderTemplateStruct = function(startIndex, length, index, placeHolderString){
    this.startIndex = startIndex;
    this.realStartIndex = 0;
    this.length = length;
    this.realLength = 0;
        
    this.index = index;
    this.placeHolderString = placeHolderString;
};
FormatStringHelper.GetPlaceHolderTemplates = function(formatString){
    formatString = this.CollapseDoubleBrackets(formatString);
    var templates = this.CreatePlaceHolderTemplates(formatString);
    return templates;
};
FormatStringHelper.CreatePlaceHolderTemplates = function(formatString){
    var templates = [];
    var templateStrings = formatString.match(/{[^}]+}/g);
    if(templateStrings != null){
        var pos = 0;
        for(var i = 0; i < templateStrings.length; i++){
            var tempString = templateStrings[i];
            var startIndex = formatString.indexOf(tempString, pos);
            var length = tempString.length;
            var indexString = tempString.slice(1).match(/^[0-9]+/);
            var index = parseInt(indexString);
            templates.push(new this.PlaceHolderTemplateStruct(startIndex, length, index, tempString));
            pos = startIndex + length;
        }
    }
    return templates;
};
FormatStringHelper.CollapseDoubleBrackets = function(formatString){
    formatString = this.CollapseOpenDoubleBrackets(formatString);
    formatString = this.CollapseCloseDoubleBrackets(formatString);
    return formatString;
};
FormatStringHelper.CollapseOpenDoubleBrackets = function(formatString){
    return formatString.replace(/{{/g, "_");
};
FormatStringHelper.CollapseCloseDoubleBrackets = function(formatString){
    while(true){
        var index = formatString.lastIndexOf("}}");
        if(index == -1) 
            break;
        else
            formatString = formatString.substr(0, index) + "_" + formatString.substr(index + 2);
    }
    return formatString;
};
ASPx.FormatStringHelper = FormatStringHelper;

var StartWithFilteringUtils = { };
StartWithFilteringUtils.HighlightSuggestedText = function(input, suggestedText, control, onChangeInput){
    if(this.NeedToLockAndoidKeyEvents(control))
        control.LockAndroidKeyEvents();
    var selInfo = ASPx.Selection.GetInfo(input);
    var currentTextLenght = ASPx.Str.GetCoincideCharCount(suggestedText, input.value, 
        function(text, filter) { 
            return text.indexOf(filter) == 0;
        });
    var suggestedTextLenght = suggestedText.length;
     
    var isSelected = selInfo.startPos == 0 && selInfo.endPos == currentTextLenght && 
        selInfo.endPos == suggestedTextLenght && input.value == suggestedText;
    if(!isSelected) {    
        input.value = suggestedText;
        if(onChangeInput)
            onChangeInput();
        if(this.NeedToLockAndoidKeyEvents(control)) {
            window.setTimeout(function() {
                this.SelectText(input, currentTextLenght, suggestedTextLenght);
                control.UnlockAndroidKeyEvents();
            }.aspxBind(this), control.adroidSamsungBugTimeout);
        } else
            this.SelectText(input, currentTextLenght, suggestedTextLenght);
    }
};
StartWithFilteringUtils.SelectText = function(input, startPos, stopPos) {
    if(startPos < stopPos)
        ASPx.Selection.Set(input, startPos, stopPos);
};
StartWithFilteringUtils.RollbackOneSuggestedChar = function(input){
    var currentText = input.value;
    var cutText = currentText.slice(0, -1);
    if(cutText != currentText)
        input.value = cutText;
};
StartWithFilteringUtils.NeedToLockAndoidKeyEvents = function(control) {
    return ASPx.Browser.AndroidMobilePlatform && control && control.LockAndroidKeyEvents;
};
ASPx.StartWithFilteringUtils = StartWithFilteringUtils;

var ContainsFilteringUtils = { };
ContainsFilteringUtils.ColumnSelectionStruct = function(index, startIndex, length){
    this.index = index;
    this.length = length;
    this.startIndex = startIndex;
};
ContainsFilteringUtils.IsFilterCrossPlaseHolder = function(filterStartIndex, filterEndIndex, template) {
    var left = Math.max(filterStartIndex, template.realStartIndex);
    var right = Math.min(filterEndIndex,  template.realStartIndex + template.realLength);
    return left < right;
};
ContainsFilteringUtils.GetColumnSelectionsForItem = function(itemValues, formatString, filterString) {
    if(formatString == "") 
        return this.GetSelectionForSingleColumnItem(itemValues, filterString); 
        
    var result = [];
    var formatedString = ASPx.Formatter.Format(formatString, itemValues);
            
    var filterStartIndex = ASPx.Str.PrepareStringForFilter(formatedString).indexOf(ASPx.Str.PrepareStringForFilter(filterString));
    if(filterStartIndex == -1) return result;
    var filterEndIndex = filterStartIndex + filterString.length;
                    
    var templates = FormatStringHelper.GetPlaceHolderTemplates(formatString);
    this.SupplyTemplatesWithRealValues(itemValues, templates);
            
    for(var i = 0; i < templates.length ; i++) {
        if(this.IsFilterCrossPlaseHolder(filterStartIndex, filterEndIndex, templates[i])) 
            result.push(this.GetColumnSelectionsForItemValue(templates[i], filterStartIndex, filterEndIndex));
    }
    return result;
};
ContainsFilteringUtils.GetColumnSelectionsForItemValue = function(template, filterStartIndex, filterEndIndex) {
    var selectedTextStartIndex = filterStartIndex < template.realStartIndex ? 0 :
        filterStartIndex - template.realStartIndex;
    var selectedTextEndIndex = filterEndIndex >  template.realStartIndex + template.realLength ? template.realLength :
        filterEndIndex - template.realStartIndex;
    var selectedTextLength = selectedTextEndIndex - selectedTextStartIndex;
    return new this.ColumnSelectionStruct(template.index, selectedTextStartIndex, selectedTextLength);
};
ContainsFilteringUtils.GetSelectionForSingleColumnItem = function(itemValues, filterString) {
    var selectedTextStartIndex = ASPx.Str.PrepareStringForFilter(itemValues[0]).indexOf(ASPx.Str.PrepareStringForFilter(filterString));
    var selectedTextLength = filterString.length;
    return [new this.ColumnSelectionStruct(0, selectedTextStartIndex, selectedTextLength)];
};
ContainsFilteringUtils.ResetFormatStringIndex = function(formatString, index) {
    if(index != 0)
        return formatString.replace(index.toString(), "0");
    return formatString;
};
ContainsFilteringUtils.SupplyTemplatesWithRealValues = function(itemValues, templates) {
    var shift = 0;
    for(var i = 0; i < templates.length; i++) {
        var formatString = this.ResetFormatStringIndex(templates[i].placeHolderString, templates[i].index);
        var currentItemValue = itemValues[templates[i].index];
        templates[i].realLength = ASPx.Formatter.Format(formatString, currentItemValue).length;
        templates[i].realStartIndex  += templates[i].startIndex + shift; 
        shift += templates[i].realLength - templates[i].placeHolderString.length; 
    }
};
ContainsFilteringUtils.PrepareElementText = function(itemText) {
    return itemText ? itemText.replace(/\&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;") : '';
};
ContainsFilteringUtils.UnselectContainsTextInElement = function(element, selection, highlightTagName) {
    var currentText =  ASPx.Attr.GetAttribute (element, "DXText");
    if(ASPx.IsExists(currentText)) {
        currentText = ContainsFilteringUtils.PrepareElementText(currentText);
        ASPx.Security.setInnerHtml(element, currentText === "" ? "&nbsp;" : currentText, ASPx.Security.DataType.Trusted);
    }
};
ContainsFilteringUtils.ReselectContainsTextInElement = function(element, selection, highlightTagName) {
    var currentText = ASPx.GetInnerText(element);
    if(!highlightTagName)
        highlightTagName = "em";
    highlightTagName = highlightTagName.toLowerCase();
    if(currentText.indexOf("</" + highlightTagName + ">") != -1)
        ContainsFilteringUtils.UnselectContainsTextInElement(element, selection, highlightTagName);
    return ContainsFilteringUtils.SelectContainsTextInElement(element, selection, highlightTagName);
};
ContainsFilteringUtils.SelectContainsTextInElement = function(element, selection, highlightTagName) {
    if(selection.startIndex == -1)
        return;
    var currentText =  ASPx.Attr.GetAttribute (element, "DXText");
    if(!ASPx.IsExists(currentText)) ASPx.Attr.SetAttribute (element, "DXText", ASPx.GetInnerText(element));
    if(!highlightTagName)
        highlightTagName = "em";
    highlightTagName = highlightTagName.toLowerCase();
    var oldInnerText = ASPx.GetInnerText(element);
    var newInnerText = ContainsFilteringUtils.PrepareElementText(oldInnerText.substr(0, selection.startIndex)) + "<" + highlightTagName + ">" +
                        ContainsFilteringUtils.PrepareElementText(oldInnerText.substr(selection.startIndex, selection.length)) + "</" + highlightTagName + ">" +
                        ContainsFilteringUtils.PrepareElementText(oldInnerText.substr(selection.startIndex + selection.length));
    ASPx.Security.setInnerHtml(element, newInnerText, ASPx.Security.DataType.Trusted);
};
ASPx.ContainsFilteringUtils = ContainsFilteringUtils;

ASPx.MakeEqualControlsWidth = function(name1, name2){
    var control1 = ASPx.GetControlCollection().Get(name1);
    var control2 = ASPx.GetControlCollection().Get(name2);
    if(control1 && control2){
        var width = Math.max(control1.GetWidth(), control2.GetWidth());
        control1.SetWidth(width);
        control2.SetWidth(width);
    }
};

ASPx.HighContrastForeColorHighlightColorMap = {
    "#ffff00" : "#008000",
    "#00ff00" : "#0000ff",
    "#ffffff" : "#00838f",
    "#000000" : "#a347ff"
};

var BadgeManagerBase = ASPx.CreateClass(null, {
    createBadge: function(text, iconCssClass) {
        var badge = document.createElement("SPAN");
        ASPx.SetClassName(badge, this.getBadgeClassName());
        if(iconCssClass && iconCssClass.length)
            this.setBadgeIconCssClass(badge, iconCssClass);
        if(text && text.length)
            this.setBadgeText(badge, text);
        return badge;
    },
    findBadge: function(element) {
        if(!element)
            return null;
        return element.querySelector("." + this.getBadgeClassName());
    },
    setBadgeIconCssClass: function(badge, iconCssClass) {
        if(!badge || iconCssClass === undefined)
            return;
        var iconElement = this.getBadgeIconElement(badge);
        if(!iconCssClass) {
            if(iconElement)
                badge.removeChild(iconElement);
        }
        else {
            if(!iconElement) {
                iconElement = document.createElement("SPAN");
                badge.insertBefore(iconElement, badge.childNodes[0]);
            }
            ASPx.SetClassName(iconElement, iconCssClass + " " + this.getBadgeIconDefaultClassName());
        }
    },
    getBadgeIconCssClass: function(element) {
        var badge = this.findBadge(element);
        if(badge) {
            var iconElement = this.getBadgeIconElement(badge);
            var regEx = new RegExp("(?:^|\\s)" + this.getBadgeIconDefaultClassName() + "(?!\\S)");
            return iconElement ? ASPx.Str.Trim(ASPx.GetClassName(iconElement).replace(regEx, "")) : "";
        }
        return "";
    },
    setBadgeText: function(badge, text) {
        if(!badge || text === undefined)
            return;

        var textElement = this.getBadgeTextElement(badge);
        if(!text) {
            if(textElement)
                badge.removeChild(textElement);
        }
        else {
            if(!textElement) {
                textElement = document.createElement("SPAN");
                badge.appendChild(textElement);
            }
            ASPx.Security.setInnerHtml(textElement, text, ASPx.Security.DataType.Trusted);
        }
    },
    getBadgeText: function(element) {
        var badge = this.findBadge(element);
        if(badge) {
            var textElement = this.getBadgeTextElement(badge);
            return textElement ? ASPx.GetInnerText(textElement) : "";
        }
        return "";
    },
    getBadgeClassName: function() {
        return "";
    },
    getBadgeIconDefaultClassName: function() {
        return "";
    },
    getBadgeIconElement: function(badge) {
        return badge.childNodes.length ? badge.querySelector("." + this.getBadgeIconDefaultClassName()) : null;
    },
    getBadgeTextElement: function(badge) {
        return badge.childNodes.length ? badge.querySelector("span:not(." + this.getBadgeIconDefaultClassName() + ")") : null;
    }
});
ASPx.BadgeManagerBase = BadgeManagerBase;

var BadgeManager = ASPx.CreateClass(BadgeManagerBase, {
    getBadgeClassName: function() {
        return "dxBadge";
    },
    getBadgeIconDefaultClassName: function() {
        return "dxBadgeImage";
    }
});
ASPx.BadgeManager = new BadgeManager();

var AccessibilityUtils = {
    isInitialized: false,
    highContrastCssClassMarker: "dxHighContrast",
    highContrastBackgroundCssClassMarker: "dxHCB",
    highContrastDefaultBackgroundColor: "#a347ff",
    highContrastThemeActive: false,
    accessibleBackgroundCssMarker: ".dx-runtime-background",
    createAccessibleBackgrounds: function(control) {
        if(!this.highContrastThemeActive || control.accessibleBackgroundsCreated || !control.accessibilityCompliant)
            return;
        var className = this.accessibleBackgroundCssMarker;
        var styleSheetRuleNames = [];
        iterateStyleSheetRules(null, function(rule) {
            var selectorTxt = rule.selectorText;
            if(selectorTxt && selectorTxt.indexOf(className) > -1)
                styleSheetRuleNames.push(ASPx.Str.CompleteReplace(selectorTxt, className, "")); 
        });
        for(var i = 0; i < styleSheetRuleNames.length; i++) {
            var name = styleSheetRuleNames[i];
            var rule = ASPx.GetStyleSheetRules(name.substring(1));
            if(rule && rule.style && rule.style.backgroundImage)
                this.createAccessibleBackground(control.GetMainElement(), rule.style, name);
        }
        control.accessibleBackgroundsCreated = true;
    },
    createAccessibleBackground: function(container, style, selector) {
        if(!container)
            return;
        var backgroundUrl = style.backgroundImage.substring(5, style.backgroundImage.length - 2);
        var elements = container.querySelectorAll(selector);
        var accessibleBackgroundClassName = "dx-acc-bi";
        for(var i = 0; i < elements.length; i++) {
            var element = elements[i];
            if(ASPx.ElementHasCssClass(element, accessibleBackgroundClassName))
                continue;
            var image = null;
            if(element.tagName !== "IMG") {
                ASPx.AddClassNameToElement(element, accessibleBackgroundClassName);
                image = element.ownerDocument.createElement("IMG");
                ASPx.SetStyles(image, { width: "100%", height: "100%" });
                if(element.firstChild)
                    element.insertBefore(image, element.firstChild);
                else
                    element.appendChild(image);
            } else
                image = element;
            image.src = backgroundUrl;
        }
    },
    createHighContrastBackgroundStyle: function() {
        var style = document.createElement('style');
        style.type = 'text/css';
        var styleContent = [
            "." + this.highContrastCssClassMarker + " ." + this.highContrastBackgroundCssClassMarker + ":after {",
            "border-image: url(" + this.getHighContrastBackgroundUrl() + ") 0 1 0 0 round;",
            "}",
        ];
        setInnerHtmlInternal(style, styleContent.join('\n'));
        document.getElementsByTagName('head')[0].appendChild(style);
    },
    getHighContrastBackgroundUrl: function() {
        var canvas = document.createElement("canvas"),
		ctx = canvas.getContext('2d');
        canvas.width = 1;
        canvas.height = 1;
        ctx.fillStyle = this.getHighContrastBackgroundColor();
		ctx.fillRect(0, 0, canvas.width, canvas.height);
        return canvas.toDataURL();
    },
    getHighContrastBackgroundColor: function() {
        var foreColor = ASPx.GetCurrentStyle(document.body).color;
        var hexColor = ASPx.Color.ColorToHexadecimal(foreColor);
        return ASPx.HighContrastForeColorHighlightColorMap[hexColor] || this.highContrastDefaultBackgroundColor;
    },
    initialize: function() {
        if(this.isInitialized)
            return;
        this.isInitialized = true;
        this.detectHighContrastTheme();
        if(this.highContrastThemeActive)
            this.createHighContrastBackgroundStyle();
    },
    detectHighContrastTheme: function() {
        var testElement = document.createElement("DIV");
        ASPx.SetStyles(testElement, {
            backgroundImage: "url('" + ASPx.EmptyImageUrl + "')",
            display: "none"
        }, true);
        var docElement = document.documentElement;
        docElement.appendChild(testElement);

        var actualBackgroundImg = ASPx.GetCurrentStyle(testElement).backgroundImage;
        docElement.removeChild(testElement);
        if(actualBackgroundImg === "none") {
            this.highContrastThemeActive = true;
            ASPx.AddClassNameToElement(docElement, this.highContrastCssClassMarker);
        }
    }
};
ASPx.AccessibilityUtils = AccessibilityUtils;
ASPx.AccessibilityUtils.SendMessageToAssistiveTechnology = function(message) {
    var messageParts = ASPx.Ident.IsArray(message) ? message : [message];
    var args = new ASPxClientControlBeforePronounceEventArgs(messageParts, null);
    ASPx.AccessibilityPronouncer.EnsureInitialize();
    ASPx.AccessibilityPronouncer.Pronounce(args, ASPx.AccessibilityPronouncerType.live);
};
ASPx.AccessibilityUtils.SetFocusAccessible = function(focusableElement) {
    if(!focusableElement)
        return;
    var elementId = focusableElement.id;
    if(!elementId) {
        var namedParent = ASPx.GetParent(focusableElement, function(element) {
            return !!element.id;
        });
        if(ASPx.IsExists(namedParent))
            elementId = namedParent.id;
    }
    var focusableControl = ASPx.GetClientControlByElementID(elementId);
    if(focusableControl && focusableControl.OnAssociatedLabelClick)
        focusableControl.OnAssociatedLabelClick(focusableElement);
    else
        window.setTimeout(function() {
            ASPx.AccessibilityUtils.SetFocusAccessibleCore(focusableElement);
        }, 0);
};
ASPx.AccessibilityUtils.SetFocusAccessibleCore = function(focusableElement) {
    if(!ASPx.IsExists(focusableElement))
        return;
    
    if(!ASPx.IsValidElement(focusableElement) && focusableElement.id)
        focusableElement = ASPx.GetElementById(focusableElement.id);
    if(!ASPx.IsActionElement(focusableElement))
        focusableElement = ASPx.RestoreFocusHelper.findNeighbourFocusElement(focusableElement, document.body);
    if(ASPx.IsExistsElement(focusableElement))
        focusableElement.focus();
};

var Security = {
    setInnerHtml: function(el, html, dataType) {
        if(!html) {
            while(el.firstChild)
                ASPx.RemoveElement(el.firstChild);
        } else
            Security.setData(html, function(d) { ASPx.SetInnerHtml.call(window, el, d); }, dataType);
    },
    setText: function(control, text, dataType) { Security.setData(text, control.SetText.aspxBind(control), dataType); },
    safeEncodeHtml: function(html) { return ASPx.Str.EncodeHtml(ASPx.Str.DecodeHtml(html)); },
    setData: function(data, dataSetter, dataType) {
        if(dataType === undefined)
            throw new Error("Specify the dataType");
        if(dataType == Security.DataType.Untrusted)
            data = Security.safeEncodeHtml(data);
        dataSetter(data);
    }
};
Security.DataType = {
    Trusted: 0,
    Untrusted: 1
};

ASPx.EnableCssAnimation = true;

var AnimationTransitionBase = ASPx.CreateClass(null, {
    constructor: function(element, options) {
        if(element) {
            AnimationTransitionBase.Cancel(element);
            this.element = element;
            this.element.aspxTransition = this;
        }
        this.duration = options.duration || AnimationConstants.Durations.DEFAULT;
        this.transition = options.transition || AnimationConstants.Transitions.SINE;
        this.property = options.property;
        this.unit = options.unit || "";
        this.onComplete = options.onComplete;
        this.to = null;
        this.from = null;
    },
    /* Public */
    Start: function(from, to) {
        if(to != undefined) {
            this.to = to;
            this.from = from;
            this.SetValue(this.from);
        }
        else
            this.to = from;
    },
    Cancel: function() {
        if(!this.element)
            return;
        try {
            delete this.element.aspxTransition;
        } catch(e) {
            this.element.aspxTransition = undefined;
        }
    },
    GetValue: function() {
        return this.getValueInternal(this.element, this.property);
    },
    SetValue: function(value) {
        this.setValueInternal(this.element, this.property, this.unit, value);
    },
    /* Private */
    setValueInternal: function(element, property, unit, value) {
        if(property == "opacity")
            AnimationUtils.setOpacity(element, value);
        else
            element.style[property] = value + unit;
    },
    getValueInternal: function(element, property) {
        if(property == "opacity")
            return ASPx.GetElementOpacity(element);
        var value = parseFloat(element.style[property]);
        return isNaN(value) ? 0 : value;
    },
    performOnComplete: function() {
        if(this.onComplete)
            this.onComplete(this.element);
    },
    getTransition: function() {
        return this.transition;
    }
});
AnimationTransitionBase.Cancel = function(element) {
    if(element.aspxTransition)
        element.aspxTransition.Cancel();
};

var AnimationConstants = {};
AnimationConstants.Durations = {
    SHORT: 200,
    DEFAULT: 400,
    LONG: 600
};
AnimationConstants.Transitions = {
    LINER: {
        Css: "cubic-bezier(0.250, 0.250, 0.750, 0.750)",
        Js: function(progress) { return progress; }
    },
    SINE: {
        Css: "cubic-bezier(0.470, 0.000, 0.745, 0.715)",
        Js: function(progress) { return Math.sin(progress * 1.57); }
    },
    POW: {
        Css: "cubic-bezier(0.755, 0.050, 0.855, 0.060)",
        Js: function(progress) { return Math.pow(progress, 4); }
    },
    POW_EASE_OUT: {
        Css: "cubic-bezier(0.165, 0.840, 0.440, 1.000)",
        Js: function(progress) { return 1 - AnimationConstants.Transitions.POW.Js(1 - progress); }
    },
    RIPPLE: {
        Css: "cubic-bezier(0.47, 0.06, 0.23, 0.99)",
        Js: function(progress) {
            return Math.pow((progress), 3) * 0.47 + 3 * progress * Math.pow((1 - progress), 2) * 0.06 + 3 * Math.pow(progress, 2) *
                (1 - progress) * 0.23 + 0.99 * Math.pow(progress, 3);
        }
    }
};

var JsAnimationTransition = ASPx.CreateClass(AnimationTransitionBase, {
    constructor: function(element, options) {
        this.constructor.prototype.constructor.call(this, element, options);
        this.onStep = options.onStep;
        this.fps = 60;
        this.startTime = null;
    },
    /* Public */
    Start: function(from, to) {
        if(from == to) {
            this.from = this.to = from;
            setTimeout(this.complete.aspxBind(this), 0);
        }
        else {
            AnimationTransitionBase.prototype.Start.call(this, from, to);
            if(to == undefined)
                this.from = this.GetValue();
            this.initTimer();
        }
    },
    Cancel: function() {
        AnimationTransitionBase.prototype.Cancel.call(this);
        if(this.timerId)
            clearInterval(this.timerId);
    },
    /* Private */
    initTimer: function() {
        this.startTime = new Date();
        this.timerId = window.setInterval(function() { this.onTick(); }.aspxBind(this), 1000 / this.fps);
    },
    onTick: function() {
        var progress = (new Date() - this.startTime) / this.duration;
        if(progress >= 1)
            this.complete();
        else {
            this.update(progress);
            if(this.onStep)
                this.onStep();
        }
    },
    update: function(progress) {
        this.SetValue(this.gatCalculatedValue(this.from, this.to, progress));
    },
    complete: function() {
        this.Cancel();
        this.update(1);
        this.performOnComplete();
    },
    gatCalculatedValue: function(from, to, progress) {
        if(progress == 1)
            return to;
        return from + (to - from) * this.getTransition()(progress);
    },
    getTransition: function() {
        return this.transition.Js;
    }
});

var SimpleAnimationTransition = ASPx.CreateClass(JsAnimationTransition, {
    constructor: function(options) {
        this.constructor.prototype.constructor.call(this, null, options);
        this.transition = options.transition || AnimationConstants.Transitions.POW_EASE_OUT;
        this.onUpdate = options.onUpdate;
        this.lastValue = 0;
    },
    SetValue: function(value) {
        this.onUpdate(value - this.lastValue);
        this.lastValue = value;
    },
    GetValue: function() {
        return this.lastValue;
    },
    performOnComplete: function() {
        if(this.onComplete)
            this.onComplete();
    }
});

var MultipleJsAnimationTransition = ASPx.CreateClass(JsAnimationTransition, {
    constructor: function(element, options) {
        this.constructor.prototype.constructor.call(this, element, options);
        this.properties = {};
    },
    Start: function(properties) {
        this.initProperties(properties);
        this.initTimer();
    },
    /* Private */
    initProperties: function(properties) {
        this.properties = properties;
        for(var propName in this.properties)
            if(properties[propName].from == undefined)
                properties[propName].from = this.getValueInternal(this.element, propName);
    },
    update: function(progress) {
        for(var propName in this.properties) {
            if(this.properties.hasOwnProperty(propName)) {
                var property = this.properties[propName];
                if(property.from != property.to)
                    this.setValueInternal(this.element, propName, property.unit, this.gatCalculatedValue(property.from, property.to, progress));
            }
        }
    }
});

var CssAnimationTransition = ASPx.CreateClass(AnimationTransitionBase, {
    constructor: function(element, options) {
        this.constructor.prototype.constructor.call(this, element, options);
        this.transitionPropertyName = AnimationUtils.CurrentTransition.property;
        this.eventName = AnimationUtils.CurrentTransition.event;
    },
    /* Public */
    Start: function(from, to) {
        AnimationTransitionBase.prototype.Start.call(this, from, to);
        // B251923
        // This code should be executed on the end of all calculation.
        // It is not correct to modify an object while animation is running.
        this.startTimerId = window.setTimeout(function() {
            if(this.from == this.to)
                this.onTransitionEnd();
            else {
                var isHidden = ASPx.GetElementOffsetHeight(this.element) == 0 && ASPx.GetElementOffsetWidth(this.element) == 0; // B252495
                if(!isHidden)
                    this.prepareElementBeforeAnimation();
                this.SetValue(this.to);
                if(isHidden)
                    this.onTransitionEnd();
            }
        }.aspxBind(this), 0);
    },
    Cancel: function() {
        window.clearTimeout(this.startTimerId);
        AnimationTransitionBase.prototype.Cancel.call(this);
        ASPx.Evt.DetachEventFromElement(this.element, this.eventName, CssAnimationTransition.transitionEnd);
        this.setValueInternal(this.element, this.transitionPropertyName, "", "");
        this.stopAnimation();
    },
    /* Private */
    prepareElementBeforeAnimation: function() {
        ASPx.Evt.AttachEventToElement(this.element, this.eventName, CssAnimationTransition.transitionEnd);
        var dummy = this.element.offsetHeight;
        this.element.style[this.transitionPropertyName] = this.getTransitionCssString();

        if(ASPx.Browser.Safari && ASPx.Browser.MacOSMobilePlatform && ASPx.Browser.MajorVersion >= 8) //T267914
            setTimeout(function() {
                if(this.element && this.element.aspxTransition) {
                    this.element.style[this.transitionPropertyName] = "";
                    this.element.aspxTransition.onTransitionEnd();
                }
            }.aspxBind(this), this.duration + 100);
    },
    stopAnimation: function() {
        this.SetValue(ASPx.GetCurrentStyle(this.element)[this.property]);
    },
    onTransitionEnd: function() {
        this.Cancel();
        this.performOnComplete();
    },
    getTransition: function() {
        return this.transition.Css;
    },
    getTransitionCssString: function() {
        return this.getTransitionCssStringInternal(this.getCssName(this.property));
    },
    getTransitionCssStringInternal: function(cssProperty) {
        return cssProperty + " " + this.duration + "ms " + this.getTransition();
    },
    getCssName: function(property) {
        switch(property) {
            case "marginLeft":
                return "margin-left";
            case "marginTop":
                return "margin-top";
        }
        return property;
    }
});

var MultipleCssAnimationTransition = ASPx.CreateClass(CssAnimationTransition, {
    constructor: function(element, options) {
        this.constructor.prototype.constructor.call(this, element, options);
        this.properties = null;
    },
    Start: function(properties) {
        this.properties = properties;
        this.forEachProperties(function(property, propName) {
            if(property.from !== undefined)
                this.setValueInternal(this.element, propName, property.unit, property.from);
        }.aspxBind(this));

        this.prepareElementBeforeAnimation();

        window.setTimeout(function() {
            this.forEachProperties(function(property, propName) {
                this.setValueInternal(this.element, propName, property.unit, property.to);
            }.aspxBind(this));
        }.aspxBind(this), 0);
    },
    /* Private */
    stopAnimation: function() {
        var style = ASPx.GetCurrentStyle(this.element);
        this.forEachProperties(function(property, propName) {
            this.setValueInternal(this.element, propName, "", style[propName]);
        }.aspxBind(this));
    },
    getTransitionCssString: function() {
        var str = "";
        this.forEachProperties(function(property, propName) {
            str += this.getTransitionCssStringInternal(this.getCssName(propName)) + ",";
        }.aspxBind(this));
        str = str.substring(0, str.length - 1);
        return str;
    },
    forEachProperties: function(func) {
        for(var propName in this.properties) {
            if(this.properties.hasOwnProperty(propName)) {
                var property = this.properties[propName];
                if(property.from == undefined)
                    property.from = this.getValueInternal(this.element, propName);
                if(property.from != property.to)
                    func(property, propName);
            }
        }
    }
});

CssAnimationTransition.transitionEnd = function(evt) {
    var element = evt.target;
    if(element && element.aspxTransition)
        element.aspxTransition.onTransitionEnd();
};
var AnimationUtils = {
    CanUseCssTransition: function() { return ASPx.EnableCssAnimation && this.CurrentTransition; },
    CanUseCssTransform: function() { return this.CanUseCssTransition() && this.CurrentTransform; },

    CurrentTransition: (function() {
        if(ASPx.Browser.IE) //TODO ASPxFileManager, ASPxHtmlEditor
            return null;
        var transitions = [
            { property: "webkitTransition", event: "webkitTransitionEnd" },
            { property: "MozTransition", event: "transitionend" },
            { property: "OTransition", event: "oTransitionEnd" },
            { property: "transition", event: "transitionend" }
        ];
        var fakeElement = document.createElement("DIV");
        for(var i = 0; i < transitions.length; i++)
            if(transitions[i].property in fakeElement.style)
                return transitions[i];
    })(),
    CurrentTransform: (function() {
        var transforms = ["transform", "MozTransform", "-webkit-transform", "msTransform", "OTransform"];
        var fakeElement = document.createElement("DIV");
        for(var i = 0; i < transforms.length; i++)
            if(transforms[i] in fakeElement.style)
                return transforms[i];
    })(),

    SetTransformValue: function(element, position, isTop) {
        if(this.CanUseCssTransform())
            element.style[this.CurrentTransform] = this.GetTransformCssText(position, isTop);
        else
            element.style[!isTop ? "left" : "top"] = position + "px";
    },
    GetTransformValue: function(element, isTop) {
        if(this.CanUseCssTransform()) {
            var cssValue = element.style[this.CurrentTransform];
            return cssValue && cssValue != "none" ? Number(cssValue.replace('matrix(1, 0, 0, 1,', '').replace(')', '').split(',')[!isTop ? 0 : 1]) : 0;
        }
        else
            return !isTop ? element.offsetLeft : element.offsetTop;
    },
    GetTransformCssText: function(position, isTop) {
        if(!position)
            return "none";
        return "matrix(1, 0, 0, 1," + (!isTop ? position : 0) + ", " + (!isTop ? 0 : position) + ")";
    },
    createMultipleAnimationTransition: function (element, options) {
        return this.CanUseCssTransition() && !options.onStep ? new MultipleCssAnimationTransition(element, options) : new MultipleJsAnimationTransition(element, options);
    },
    createSimpleAnimationTransition: function(options) {
        return new SimpleAnimationTransition(options);
    },
    createJsAnimationTransition: function(element, options) {
        return new JsAnimationTransition(element, options);
    },
    createCssAnimationTransition: function(element, options) {
        return new CssAnimationTransition(element, options);
    },
    setOpacity: function(element, value) {
        ASPx.SetElementOpacity(element, value);
    }
};

var AsyncTracker = function() {
    var currentToken,
        lockedTokens,
        onDoneDelegates,
        lockedDelegates;

    function clearState() {
        currentToken = 1;
        lockedTokens = [];
        onDoneDelegates = [];
        lockedDelegates = {};
    }
    clearState();
                

    var log = function(msg) { };
    function setLog(delegate){
        log = delegate;
    }

    function getLockToken() {
        if(onDoneDelegates.length === 0)
            return -1;

        var token = currentToken++;

        lockedTokens.push(token);
        lockedDelegates[token] = [];

        for (var i = 0; i < onDoneDelegates.length; i++) {
            lockedDelegates[token].push(onDoneDelegates[i]);
        }

        log("module locks token " + token);

        return token;
    }

    function releaseToken(token) {
        if(token < 0) return;

        log("module releasing token " + token);

        ASPx.Data.ArrayRemove(lockedTokens, token);
        delete lockedDelegates[token];

        invokeUnlockedDelegates();

        if(lockedTokens.length === 0)
            clearState();

        log("module released token " + token);
    }
    function invokeUnlockedDelegates() {
        var onDoneDelegate;
        for (var i = onDoneDelegates.length - 1; i >= 0; i--) {
            if(onDoneDelegates[i] && !isDelegateLocked(onDoneDelegates[i])) {
                onDoneDelegate = onDoneDelegates[i];
                delete onDoneDelegates[i];
                onDoneDelegate();
            }
        }
    }
    function isDelegateLocked(delegate) {
        for (var i = lockedTokens.length - 1; i >= 0; i--) {
            var token = lockedTokens[i];
            var delegates = lockedDelegates[token];
            if(delegates) {
                for (var j = delegates.length - 1; j >= 0; j--) {
                    if(delegates[j] && delegates[j] === delegate)
                        return true;
                }
            }
        }
        return false;
    }

    function track(doDelegate, onDoneDelegate) {
        if(onDoneDelegate)
            onDoneDelegates.push(onDoneDelegate);

        doDelegate();
        
        if(onDoneDelegate)
            invokeUnlockedDelegates();
    }

    return {
        getLockToken: getLockToken,
        releaseToken: releaseToken,
        track: track,
        setLog:setLog,
    };
};

var GetEditorValuesInContainer = function(containerOrId, processInvisibleEditors, needSerialize) {
    var container = typeof(containerOrId) === "string" ? ASPx.GetElementById(containerOrId) : containerOrId;
    var result = {};
    if(!ASPx.ProcessEditorsInContainer) //T687593
        return result;
    ASPx.ProcessEditorsInContainer(container, function(editor){
        result[editor.name] = GetCorrectedByTypeValue(ASPx.GetEditorValueByControl(editor), needSerialize);
    }, null, null, processInvisibleEditors, false);
    return result;
};
var SetEditorValues = function(values) {
    for(var controlName in values) {
        if(values.hasOwnProperty(controlName)) {
            var trackedControl = ASPxClientControl.GetControlCollection().Get(controlName);
            if(!trackedControl)
                continue;
            var setValueMethod = trackedControl.SetTokenCollection || trackedControl.SelectValues || trackedControl.SetValue;
            if(setValueMethod === trackedControl.SelectValues)
                trackedControl.UnselectAll();
            setValueMethod.call(trackedControl, values[controlName]);
        }
    }
};
var GetCorrectedByTypeValue = function(value, needSerialize){
    if(ASPx.Ident.IsArray(value))
        for(var i = 0; i < value.length; i++)
            value[i] = GetCorrectedByTypeValue(value[i]);
    if(needSerialize && ASPx.Ident.IsDate(value))
        return ASPx.DateUtils.GetInvariantDateTimeString(value);
    return value;
};

var ListBoxTemporaryCache = ASPx.CreateClass(null, {
    constructor: function() { 
        this.cache = { };
        this.invalidateTimerID = -1;
    },

    Get: function(key, getObjectFunc, context, args) {
        if(this.invalidateTimerID < 0) {
            this.invalidateTimerID = window.setTimeout(function() {
                this.Invalidate();
            }.aspxBind(this), 0);
        }

        if(!ASPx.IsExists(this.cache[key])) {
            if(!ASPx.IsExists(args))
                args = [ ];
            this.cache[key] = getObjectFunc.apply(context, args);
        }
        return this.cache[key];
    },

    Invalidate: function() {
        this.cache = { };
        this.invalidateTimerID = ASPx.Timer.ClearTimer(this.invalidateTimerID);
    }
});

ASPx.GetEditorValueByControl = function(control, needSerialize) {
    var result;
    if(ASPx.IsMultipleValueOwner(control))
        result = control.GetSelectedValues();
    if(ASPx.IsTokenBox(control)) {
        if(needSerialize)
            result = control.GetTokenValuesCollection();
        else
            result = control.GetTokenCollection();
    }
    return result || control.GetValue();
};

ASPx.IsMultipleValueOwner = function(control) {
    return ASPx.IsListBox(control) || ASPx.IsCheckBoxList(control);
};
ASPx.IsCheckBoxList = function(control) {
    return control && typeof(ASPxClientCheckBoxList) != "undefined" && control instanceof ASPxClientCheckBoxList;
};
ASPx.IsListBox = function(control) {
    return control && typeof(ASPxClientListBox) != "undefined" && control instanceof ASPxClientListBox;
};
ASPx.IsComboBox = function(control) {
    return control && typeof(ASPxClientComboBox) != "undefined" && control instanceof ASPxClientComboBox;
};
ASPx.IsTokenBox = function(control) {
    return control && typeof(ASPxClientTokenBox) != "undefined" && control instanceof ASPxClientTokenBox;
};
ASPx.IsGridLookup = function(control) {
    return control && typeof(MVCxClientGridLookup) != "undefined" && control instanceof MVCxClientGridLookup;
};
ASPx.IsSpinEdit = function(control) {
    return control && typeof(ASPxClientSpinEdit) != "undefined" && control instanceof ASPxClientSpinEdit;
};

ASPx.DatePickerType = {
    Days: 0,
    Months: 1,
    Years: 2,
    Decades: 3
};

ASPx.FullScreenUtils = {
    subscribeChange: function(handler) {
        Evt.AttachEventToElement(document, "fullscreenchange", handler);
        Evt.AttachEventToElement(document, "msfullscreenchange", handler); // Edge
        Evt.AttachEventToElement(document, "MSFullscreenChange", handler); // IE11
        Evt.AttachEventToElement(document, "webkitfullscreenchange", handler);
        Evt.AttachEventToElement(document, "mozfullscreenchange", handler);
    },
    unsubscribeChange: function(handler) {
        Evt.DetachEventFromElement(document, "fullscreenchange", handler);
        Evt.DetachEventFromElement(document, "msfullscreenchange", handler);
        Evt.DetachEventFromElement(document, "MSFullscreenChange", handler);
        Evt.DetachEventFromElement(document, "webkitfullscreenchange", handler);
        Evt.DetachEventFromElement(document, "mozfullscreenchange", handler);
    },
    setFullscreen: function(on) {
        var element = window.self.document.body;

        if(on) {
            if(element.requestFullscreen) {
                element.requestFullscreen();
            } else if(element.mozRequestFullScreen) {
                element.mozRequestFullScreen();
            } else if(element.webkitRequestFullscreen) {
                element.webkitRequestFullscreen();
            } else if(element.msRequestFullscreen) {
                element.msRequestFullscreen();
            }
        } else {
            if(document.exitFullscreen) {
                document.exitFullscreen();
            } else if(document.mozCancelFullScreen) {
                document.mozCancelFullScreen();
            } else if(document.webkitCancelFullScreen) {
                document.webkitCancelFullScreen();
            } else if(document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }
    },
    inFullscreen: function() {
        var fullscreenElement = document.fullscreenElement || document.msFullscreenElement || document.webkitFullscreenElement;
        var isInFullscreen = fullscreenElement === document.body || document.webkitIsFullScreen;
        return !!isInFullscreen;
    }
};

/*# public class ASPxClientUtils : JavaScriptObject #*/
ASPxClientUtils = {};
/*# public static string agent{ get{ return ""; } } #*/
ASPxClientUtils.agent = Browser.UserAgent;
/*# public static bool opera{ get{ return false; } } #*/
ASPxClientUtils.opera = Browser.Opera;
/*# [Obsolete("This property is now obsolete. Use the ASPxClientUtils.opera and ASPxClientUtils.browserMajorVersion properties instead.")] public static bool opera9 { get { return false; } } #*/
ASPxClientUtils.opera9 = Browser.Opera && Browser.MajorVersion == 9;
/*# public static bool safari{ get{ return false; } } #*/
ASPxClientUtils.safari = Browser.Safari;
/*# [Obsolete("This property is now obsolete. Use the ASPxClientUtils.safari and ASPxClientUtils.browserMajorVersion properties instead.")] public static bool safari3 { get { return false; } } #*/
ASPxClientUtils.safari3 = Browser.Safari && Browser.MajorVersion == 3;
/*# [Obsolete("This property is now obsolete. Use the ASPxClientUtils.safari and ASPxClientUtils.macOSPlatform properties instead.")] public static bool safariMacOS{ get { return false; } } #*/
ASPxClientUtils.safariMacOS = Browser.Safari && Browser.MacOSPlatform;
/*# public static bool chrome { get { return false; } } #*/
ASPxClientUtils.chrome = Browser.Chrome;
/*# public static bool ie{ get{ return false; } } #*/
ASPxClientUtils.ie = Browser.IE;
/*# [Obsolete("This property is now obsolete. Use the ASPxClientUtils.ie and ASPxClientUtils.browserMajorVersion properties instead.")] public static bool ie7 { get { return false; } } #*/
ASPxClientUtils.ie7 = Browser.IE && Browser.MajorVersion == 7;
/*# public static bool firefox{ get{ return false; } } #*/
ASPxClientUtils.firefox = Browser.Firefox;
/*# [Obsolete("This property is now obsolete. Use the ASPxClientUtils.firefox and ASPxClientUtils.browserMajorVersion properties instead.")] public static bool firefox3 { get { return false; } } #*/
ASPxClientUtils.firefox3 = Browser.Firefox && Browser.MajorVersion == 3;
/*# public static bool mozilla { get { return false; } } #*/
ASPxClientUtils.mozilla = Browser.Mozilla;
/*# public static bool netscape{ get{ return false; } } #*/
ASPxClientUtils.netscape = Browser.Netscape;
/*# public static double browserVersion { get { return 0.0; } } #*/
ASPxClientUtils.browserVersion = Browser.Version;
/*# public static int browserMajorVersion { get { return 0; } } #*/
ASPxClientUtils.browserMajorVersion = Browser.MajorVersion;
/*# public static bool macOSPlatform { get { return false; } } #*/
ASPxClientUtils.macOSPlatform = Browser.MacOSPlatform;
/*# public static bool windowsPlatform { get { return false; } } #*/
ASPxClientUtils.windowsPlatform = Browser.WindowsPlatform;
/*# public static bool webKitFamily { get { return false; } } #*/
ASPxClientUtils.webKitFamily = Browser.WebKitFamily;
/*# public static bool netscapeFamily { get { return false; } } #*/
ASPxClientUtils.netscapeFamily = Browser.NetscapeFamily;

/*# public static bool touchUI { get { return false; } } #*/
ASPxClientUtils.touchUI = Browser.TouchUI;
/*# public static bool webKitTouchUI { get { return false; } } #*/
ASPxClientUtils.webKitTouchUI = Browser.WebKitTouchUI;
/*# public static bool msTouchUI { get { return false; } } #*/
ASPxClientUtils.msTouchUI = Browser.MSTouchUI;

/*# public static bool iOSPlatform { get { return false; } } #*/
ASPxClientUtils.iOSPlatform = Browser.MacOSMobilePlatform;
/*# public static bool androidPlatform { get { return false; } } #*/
ASPxClientUtils.androidPlatform = Browser.AndroidMobilePlatform;


/*# public static void ArrayInsert(object[] array, object element){ } #*/
ASPxClientUtils.ArrayInsert = Data.ArrayInsert;
/*# public static void ArrayRemove(object[] array, object element){ } #*/
ASPxClientUtils.ArrayRemove = Data.ArrayRemove;
/*# public static void ArrayRemoveAt(object[] array, int index){ } #*/
ASPxClientUtils.ArrayRemoveAt = Data.ArrayRemoveAt;
/*# public static void ArrayClear(object[] array){ } #*/
ASPxClientUtils.ArrayClear = Data.ArrayClear;
/*# public static int ArrayIndexOf(object[] array, object element){ return 0; } #*/
ASPxClientUtils.ArrayIndexOf = Data.ArrayIndexOf;

/*# public static void AttachEventToElement(object element, string eventName, object method){ } #*/
ASPxClientUtils.AttachEventToElement = Evt.AttachEventToElement;
/*# public static void DetachEventFromElement(object element, string eventName, object method){ } #*/
ASPxClientUtils.DetachEventFromElement = Evt.DetachEventFromElement;

/*# public static object GetEventSource(object htmlEvent){ return null; } #*/
ASPxClientUtils.GetEventSource = Evt.GetEventSource;
/*# public static int GetEventX(object htmlEvent){ return 0; } #*/
ASPxClientUtils.GetEventX = Evt.GetEventX;
/*# public static int GetEventY(object htmlEvent){ return 0; } #*/
ASPxClientUtils.GetEventY = Evt.GetEventY;
/*# public static int GetKeyCode(object htmlEvent){ return 0; } #*/
ASPxClientUtils.GetKeyCode = Evt.GetKeyCode;

/*# public static bool PreventEvent(object htmlEvent){ return false; } #*/
ASPxClientUtils.PreventEvent = Evt.PreventEvent;
/*# public static bool PreventEventAndBubble(object htmlEvent){ return false; } #*/
ASPxClientUtils.PreventEventAndBubble = Evt.PreventEventAndBubble;
/*# public static bool PreventDragStart(object htmlEvent){ return false; } #*/
ASPxClientUtils.PreventDragStart = Evt.PreventDragStart;
/*# public static void ClearSelection(){ } #*/
ASPxClientUtils.ClearSelection = Selection.Clear;

/*# public static bool IsExists(object obj){ return false; } #*/
ASPxClientUtils.IsExists = ASPx.IsExists;
/*# public static bool IsFunction(object obj){ return false; } #*/
ASPxClientUtils.IsFunction = ASPx.IsFunction;

/*# public static int GetAbsoluteX(object element){ return 0; } #*/
ASPxClientUtils.GetAbsoluteX = ASPx.GetAbsoluteX;
/*# public static int GetAbsoluteY(object element){ return 0; } #*/
ASPxClientUtils.GetAbsoluteY = ASPx.GetAbsoluteY;
/*# public static void SetAbsoluteX(object element, int x){ } #*/
ASPxClientUtils.SetAbsoluteX = ASPx.SetAbsoluteX;
/*# public static void SetAbsoluteY(object element, int y){ } #*/
ASPxClientUtils.SetAbsoluteY = ASPx.SetAbsoluteY;

/*# public static int GetDocumentScrollTop(){ return 0; } #*/
ASPxClientUtils.GetDocumentScrollTop = ASPx.GetDocumentScrollTop;
/*# public static int GetDocumentScrollLeft(){ return 0; } #*/
ASPxClientUtils.GetDocumentScrollLeft = ASPx.GetDocumentScrollLeft;
/*# public static int GetDocumentClientWidth(){ return 0; } #*/
ASPxClientUtils.GetDocumentClientWidth = ASPx.GetDocumentClientWidth;
/*# public static int GetDocumentClientHeight(){ return 0; } #*/
ASPxClientUtils.GetDocumentClientHeight = ASPx.GetDocumentClientHeight;

/*# public static void AddClassNameToElement(object element, string className){ return; } #*/
ASPxClientUtils.AddClassNameToElement = ASPx.AddClassNameToElement;
/*# public static void RemoveClassNameFromElement(object element, string className){ return; } #*/
ASPxClientUtils.RemoveClassNameFromElement = ASPx.RemoveClassNameFromElement;

/*# public static bool GetIsParent(object parentElement, object element){ return false; } #*/
ASPxClientUtils.GetIsParent = ASPx.GetIsParent;
/*# public static object GetParentById(object element, string id){ return null; } #*/
ASPxClientUtils.GetParentById = ASPx.GetParentById;
/*# public static object GetParentByTagName(object element, string tagName){ return null; } #*/
ASPxClientUtils.GetParentByTagName = ASPx.GetParentByTagName;
/*# public static object GetParentByClassName(object element, string className){ return null; } #*/
ASPxClientUtils.GetParentByClassName = ASPx.GetParentByPartialClassName;

/*# public static object GetChildById(object element, string id){ return null; } #*/
ASPxClientUtils.GetChildById = ASPx.GetChildById;
/*# public static object GetChildByTagName(object element, string tagName, int index){ return null; } #*/
ASPxClientUtils.GetChildByTagName = ASPx.GetChildByTagName;

/*# public static void SetCookie(string name, string value) { return; } #*/
/*# public static void SetCookie(string name, string value, DateTime expirationDate) { return; } #*/
ASPxClientUtils.SetCookie = Cookie.SetCookie;
/*# public static string GetCookie(string name) { return ""; } #*/
ASPxClientUtils.GetCookie = Cookie.GetCookie;
/*# public static void DeleteCookie(string name) { return; } #*/
ASPxClientUtils.DeleteCookie = Cookie.DelCookie;

/*# public static int GetShortcutCode(int keyCode, bool isCtrlKey, bool isShiftKey, bool isAltKey) { return 0; } #*/
ASPxClientUtils.GetShortcutCode = ASPx.GetShortcutCode; 
/*# public static int GetShortcutCodeByEvent(object htmlEvent) { return 0; } #*/
ASPxClientUtils.GetShortcutCodeByEvent = ASPx.GetShortcutCodeByEvent;
/*# public static int StringToShortcutCode(string shortcutString) { return 0; } #*/
ASPxClientUtils.StringToShortcutCode = ASPx.ParseShortcutString;

/*# public static string Trim(string str) { return ""; } #*/
ASPxClientUtils.Trim = Str.Trim; 
/*# public static string TrimStart(string str) { return ""; } #*/
ASPxClientUtils.TrimStart = Str.TrimStart;
/*# public static string TrimEnd(string str) { return ""; } #*/
ASPxClientUtils.TrimEnd = Str.TrimEnd;

/*# public static object GetEditorValuesInContainer(object containerOrId) {return null;} #*/
/*# public static object GetEditorValuesInContainer(object containerOrId, bool processInvisibleEditors) {return null;} #*/
ASPxClientUtils.GetEditorValuesInContainer = GetEditorValuesInContainer;

/*# public static void SetEditorValues(object values) { } #*/
ASPxClientUtils.SetEditorValues = SetEditorValues;

/*# public static void SendMessageToAssistiveTechnology(string message) { } #*/
ASPxClientUtils.SendMessageToAssistiveTechnology = ASPx.AccessibilityUtils.SendMessageToAssistiveTechnology;

window.ASPxClientUtils = ASPxClientUtils;
window.ListBoxTemporaryCache = ListBoxTemporaryCache;

ASPx.AnimationUtils = AnimationUtils;
ASPx.AnimationTransitionBase = AnimationTransitionBase;
ASPx.AnimationConstants = AnimationConstants;
ASPx.AsyncTracker = AsyncTracker;
ASPx.Security = Security;
})(ASPx, dx);
      

/// <reference path="Utils.js"/>
/*# namespace DevExpress.Web.Scripts #*/

(function module(ASPx, options) {
ASPx.modules.Classes = module;

ASPx.classesScriptParsed = false;
ASPx.documentLoaded = false; 
ASPx.CallbackType = {
    Data: "d",
    Common: "c"
};
ASPx.callbackState = {
    aborted: "aborted",
    inTurn: "inTurn",
    sent: "sent"
};

/*# public class ASPxClientEvent : JavaScriptObject #*/
var ASPxClientEvent = ASPx.CreateClass(null, {
    constructor: function() {
        this.handlerInfoList = [];
        this.firingIndex = -1;
    },
    /*# public void AddHandler(object handler){} #*/
    AddHandler: function(handler, executionContext) {
        if(typeof(executionContext) == "undefined")
            executionContext = null;
        this.RemoveHandler(handler, executionContext);
        var handlerInfo = ASPxClientEvent.CreateHandlerInfo(handler, executionContext);
        this.handlerInfoList.push(handlerInfo);
    },
    /*# public void RemoveHandler(object handler){} #*/
    RemoveHandler: function(handler, executionContext) {
        this.removeHandlerByCondition(function(handlerInfo) {
            return handlerInfo.handler == handler && 
                (!executionContext || handlerInfo.executionContext == executionContext);
        });
    },

    removeHandlerByCondition: function(predicate) {
         for(var i = this.handlerInfoList.length - 1; i >= 0; i--) {
            var handlerInfo = this.handlerInfoList[i];
            if(predicate(handlerInfo)) {
                ASPx.Data.ArrayRemoveAt(this.handlerInfoList, i);
                if(i <= this.firingIndex)
                    this.firingIndex--;
            }
        }
    },

    removeHandlerByControlName: function(controlName) {
        this.removeHandlerByCondition(function(handlerInfo) {
            return handlerInfo.executionContext &&  
                handlerInfo.executionContext.name === controlName;
        });
    },

    /*# public void ClearHandlers(){} #*/
    ClearHandlers: function() {
        this.handlerInfoList.length = 0;
    },
    /*# public void FireEvent(object source, ASPxClientEventArgs e){} #*/
    FireEvent: function(obj, args) {
        for(this.firingIndex = 0; this.firingIndex < this.handlerInfoList.length; this.firingIndex++) {
            var handlerInfo = this.handlerInfoList[this.firingIndex];
            handlerInfo.handler.call(handlerInfo.executionContext, obj, args);
        }
    },
    InsertFirstHandler: function(handler, executionContext){
        if(typeof(executionContext) == "undefined")
            executionContext = null;
        var handlerInfo = ASPxClientEvent.CreateHandlerInfo(handler, executionContext);
        ASPx.Data.ArrayInsert(this.handlerInfoList, handlerInfo, 0);
    },
    IsEmpty: function() {
        return this.handlerInfoList.length == 0;
    }
});
ASPxClientEvent.CreateHandlerInfo = function(handler, executionContext) {
    return {
        handler: handler,
        executionContext: executionContext
    };
};

/*# public delegate void ASPxClientEventHandler(object source, ASPxClientEventArgs e);#*/
/*# public class ASPxClientEventArgs: JavaScriptObject #*/
var ASPxClientEventArgs = ASPx.CreateClass(null, {
    /*# public ASPxClientEventArgs() : base(){} #*/
    constructor: function() {

    }
});
ASPxClientEventArgs.Empty = new ASPxClientEventArgs();

/*# public delegate void ASPxClientCancelEventHandler(object source, ASPxClientCancelEventArgs e);#*/
/*# public class ASPxClientCancelEventArgs: ASPxClientEventArgs #*/
var ASPxClientCancelEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
    /*# public ASPxClientCancelEventArgs() : base(){} #*/
    constructor: function(){
        this.constructor.prototype.constructor.call(this);
        /*# public bool cancel{ get{return false;} set{} } #*/
        this.cancel = false;
    }
});

/*# public delegate void ASPxClientProcessingModeEventHandler(object source, ASPxClientProcessingModeEventArgs e);#*/
/*# public class ASPxClientProcessingModeEventArgs: ASPxClientEventArgs #*/
var ASPxClientProcessingModeEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
    /*# public ASPxClientProcessingModeEventArgs(bool processOnServer) : base(){} #*/
    constructor: function(processOnServer){
        this.constructor.prototype.constructor.call(this);
        /*# public bool processOnServer{ get{return false;} set{} } #*/
        this.processOnServer = !!processOnServer;
    }
});

/*# public delegate void ASPxClientProcessingModeCancelEventHandler(object source, ASPxClientProcessingModeCancelEventArgs e);#*/
/*# public class ASPxClientProcessingModeCancelEventArgs: ASPxClientProcessingModeEventArgs #*/
var ASPxClientProcessingModeCancelEventArgs = ASPx.CreateClass(ASPxClientProcessingModeEventArgs, {
    /*# public ASPxClientProcessingModeCancelEventArgs(bool processOnServer) : base(processOnServer){} #*/
    constructor: function(processOnServer){
        this.constructor.prototype.constructor.call(this, processOnServer);
        /*# public bool cancel{ get{return false;} set{} } #*/
        this.cancel = false;
    }
});

/*# public class KnockoutObservableBoolean : JavaScriptObject #*/
/*# public class KnockoutObservableArray : JavaScriptObject #*/
    
var OrderedMap = ASPx.CreateClass(null, {
    constructor: function(){
        this.entries = {};
        this.firstEntry = null;
        this.lastEntry = null;
    },
    add: function(key, element) {
        var entry = this.addEntry(key, element);
        this.entries[key] = entry;
    },
    remove: function(key) {
        var entry = this.entries[key];
        if(entry === undefined)
            return;
        
        this.removeEntry(entry);
        delete this.entries[key];
    },
    clear: function() {
        this.markAllEntriesAsRemoved();
        this.entries = {};
        this.firstEntry = null;
        this.lastEntry = null;
    },
    get: function(key) {
        var entry = this.entries[key];
        return entry ? entry.value : undefined;
    },
    forEachEntry: function(processFunc, context) {
        context = context || this;
        for(var entry = this.firstEntry; entry; entry = entry.next) {
            if(entry.removed)
                continue;
            if(processFunc.call(context, entry.key, entry.value))
                return;
        }
    },
    addEntry: function(key, element) {
        var entry = { key: key, value: element, next: null, prev: null };
        if(!this.firstEntry)
            this.firstEntry = entry;
        else {
            entry.prev = this.lastEntry;
            this.lastEntry.next = entry;
        }
        this.lastEntry = entry;
        return entry;
    },
    removeEntry: function(entry) {
        if(this.firstEntry == entry)
            this.firstEntry = entry.next;
        if(this.lastEntry == entry)
            this.lastEntry = entry.prev;
        if(entry.prev)
            entry.prev.next = entry.next;
        if(entry.next)
            entry.next.prev = entry.prev;
        entry.removed = true;
    },
    markAllEntriesAsRemoved: function() {
        for(var entry = this.firstEntry; entry; entry = entry.next)
            entry.removed = true;
    }
});

var CollectionBase = ASPx.CreateClass(null, {
    constructor: function(){
        this.elementsMap = new OrderedMap();
        this.isASPxClientCollection = true;
    },
    
    Add: function(key, element) {
        this.elementsMap.add(key, element);
    },
    Remove: function(key) {
        this.elementsMap.remove(key);
    },
    Clear: function(){
        this.elementsMap.clear();
    },
    Get: function(key){
        return this.elementsMap.get(key);
    }
});

var GarbageCollector = ASPx.CreateClass(null, {
    constructor: function() {
        this.interval = options.GCCheckInterval;
        this.intervalID = window.setInterval(function(){ this.CollectObjects(); }.aspxBind(this), this.interval);
    },
    canCollectObjects: function () {
        if (!ASPx.GetControlCollection) return false;
        var collection = ASPx.GetControlCollection();
        return !(collection && !collection.InCallback());
    },
    CollectObjects: function(){
        if (!this.canCollectObjects()) return;

        ASPx.GetControlCollectionCollection().RemoveDisposedControls();
        if(typeof(ASPx.GetStateController) != "undefined")
            ASPx.GetStateController().RemoveDisposedItems();
        if(ASPx.TableScrollHelperCollection)
            ASPx.TableScrollHelperCollection.RemoveDisposedObjects();
        if(ASPx.Ident.scripts.ASPxClientRatingControl)
            ASPxClientRatingControl.RemoveDisposedElementUnderCursor();
        
        var postHandler = aspxGetPostHandler();
        if(postHandler)
            postHandler.RemoveDisposedFormsFromCache();
    }
});
var dummyGcCollector = new GarbageCollector(); 

var ControlTree = ASPx.CreateClass(null, {
    constructor: function(controlCollection, container, controlFilter) {
        this.container = container;
        this.domMap = { };
        this.rootNode = this.createNode(null, null);
        this.createControlTree(controlCollection, container, controlFilter);
    },
    createControlTree: function(controlCollection, container, controlFilter) {
        controlCollection.ProcessControlsInContainer(container, function(control) {
            control.RegisterInControlTree(this);
        }.aspxBind(this), controlFilter);

        var fixedNodes = [];
        var fixedNodesChildren = [];
        for(var domElementID in this.domMap) {
            if(!this.domMap.hasOwnProperty(domElementID)) continue;
            var node = this.domMap[domElementID];
            var controlOwner = node.control ? node.control.controlOwner : null;
            if(controlOwner && this.domMap[controlOwner.name])
                continue;
            if(this.isFixedNode(node))
                fixedNodes.push(node);
            else {
                var parentNode = this.findParentNode(domElementID);
                parentNode = parentNode || this.rootNode;
                if(this.isFixedNode(parentNode))
                    fixedNodesChildren.push(node);
                else {
                    var childNode = node.mainNode || node;
                    this.addChildNode(parentNode, childNode);
                }
            }
        }
        for(var i = fixedNodes.length - 1; i >= 0; i--)
            this.insertChildNode(this.rootNode, fixedNodes[i], 0);
        for(var i = fixedNodesChildren.length - 1; i >= 0; i--)
            this.insertChildNode(this.rootNode, fixedNodesChildren[i], 0);
    },
    findParentNode: function(id) {
        var element = document.getElementById(id).parentNode;
        while(element && element.tagName !== "BODY") {
            if(element.id) {
                var parentNode = this.domMap[element.id];
                if(parentNode)
                    return parentNode;
            }
            element = element.parentNode;
        }
        return null;
    },
    addChildNode: function(node, childNode) {
        if(!childNode.parentNode) {
            node.children.push(childNode);
            childNode.parentNode = node;
        }
    },
    insertChildNode: function(node, childNode, index) {
        if(!childNode.parentNode) {
            ASPx.Data.ArrayInsert(node.children, childNode, index);
            childNode.parentNode = node;
        }
    },
    addRelatedNode: function(node, relatedNode) {
        this.addChildNode(node, relatedNode);
        relatedNode.mainNode = node;
    },
    isFixedNode: function(node) {
        var control = node.mainNode ? node.mainNode.control : node.control;
        return control && control.HasFixedPosition();
    },
    createNode: function(domElementID, control) {
        var node = {
            control: control,
            children: [],
            parentNode: null,
            mainNode: null
        };
        if(domElementID)
            this.domMap[domElementID] = node;
        return node;
    }
});

var ControlAdjuster = ASPx.CreateClass(null, {
    constructor: function() {
    },

    adjustControlsInHierarchy: function(controlCollection, adjustFunc, container, collapseControls, controlFilter) {
        var controlTree = new ASPx.ControlTree(controlCollection, container, controlFilter);
        this.adjustControlsInTree(controlTree.rootNode, adjustFunc, container, collapseControls);
    },
    adjustControlsInTree: function(treeNode, adjustFunc, container, collapseControls) {
        var observer = _aspxGetDomObserver();
        observer.pause(container, true);
        var documentScrollInfo;
        if(collapseControls) {
            documentScrollInfo = ASPx.GetOuterScrollPosition(document.body);
            this.collapseControls(treeNode);
        }
        var adjustNodes = [], 
            autoHeightNodes = [];
        var requireReAdjust = this.forEachControlCore(treeNode, collapseControls, adjustFunc, adjustNodes, autoHeightNodes);
        if(requireReAdjust)
            this.forEachControlsBackward(adjustNodes, collapseControls, adjustFunc);
        else {
            for(var i = 0, node; node = autoHeightNodes[i]; i++)
                node.control.AdjustAutoHeight();
        }
        if(collapseControls)
            ASPx.RestoreOuterScrollPosition(documentScrollInfo);
        observer.resume(container, true);
    },

    forEachControlCore: function(node, collapseControls, processFunc, adjustNodes, autoHeightNodes) {
        var requireReAdjust = false,
            size, newSize;
        if(node.control) {
            var checkReadjustment = collapseControls && node.control.IsControlCollapsed() && node.control.CanCauseReadjustment();
            if(checkReadjustment)
                size = node.control.GetControlPercentMarkerSize(false, true);
            if(node.control.IsControlCollapsed() && !node.control.IsExpandableByAdjustment())
                node.control.ExpandControl();
            node.control.isInsideHierarchyAdjustment = true;
            processFunc(node.control);
            node.control.isInsideHierarchyAdjustment = false;
            if(checkReadjustment) {
                newSize = node.control.GetControlPercentMarkerSize(false, true);
                requireReAdjust = size.width !== newSize.width;
            }
            if(node.control.sizingConfig.supportAutoHeight)
                autoHeightNodes.push(node);
            node.control.ResetControlPercentMarkerSize();
        }

        for(var childNode, i = 0; childNode = node.children[i]; i++)
            requireReAdjust = this.forEachControlCore(childNode, collapseControls, processFunc, adjustNodes, autoHeightNodes) || requireReAdjust;

        adjustNodes.push(node);
        return requireReAdjust;
    },
    forEachControlsBackward: function(adjustNodes, collapseControls, processFunc) {
        for(var i = 0, node; node = adjustNodes[i]; i++)
            this.forEachControlsBackwardCore(node, collapseControls, processFunc);
    },
    forEachControlsBackwardCore: function(node, collapseControls, processFunc) {
        if(node.control)
            processFunc(node.control);
        if(node.children.length > 1) {
            for(var i = 0, childNode; childNode = node.children[i]; i++) {
                if(childNode.control)
                    processFunc(childNode.control);
            }
        }
    },
    collapseControls: function(node) {
        for(var childNode, i = 0; childNode = node.children[i]; i++)
            this.collapseControls(childNode);
        if(node.control && node.control.NeedCollapseControl())
            node.control.CollapseControl();
    }
});

var controlAdjuster = null;
function GetControlAdjuster() {
    if(!controlAdjuster)
        controlAdjuster = new ControlAdjuster();
    return controlAdjuster;
}

/*# public delegate void ASPxClientDataCallback(object sender, string result); #*/

function _aspxFunctionIsInCallstack(currentCallee, targetFunction, depthLimit) {
    var candidate = currentCallee;
    var depth = 0;
    while(candidate && depth <= depthLimit) {
        candidate = candidate.caller;
        if(candidate == targetFunction)
            return true;
        depth++;
    }
    return false;
}
ASPx.attachToReady(aspxClassesWindowOnLoad);
function aspxClassesWindowOnLoad(){
    ASPx.documentLoaded = true;
    _aspxSweepDuplicatedLinks();
    ResourceManager.SynchronizeResources();
    var externalScriptProcessor = GetExternalScriptProcessor();
    if(externalScriptProcessor)
        externalScriptProcessor.ShowErrorMessages();
    ASPx.AccessibilityUtils.initialize();
    ASPx.GetControlCollection().Initialize();
    _aspxInitializeScripts();
    _aspxInitializeLinks();
    _aspxInitializeFocus();
    ASPx.GetControlCollection().FinalizeInitialization();
}

// Identification
Ident = { };
Ident.IsDate = function(obj) {
    return obj && obj.constructor == Date;
};
Ident.IsRegExp = function(obj) {
    return obj && obj.constructor === RegExp;
};
Ident.IsArray = function(obj) {
    return obj && obj.constructor == Array;
};
Ident.IsASPxClientCollection = function(obj) {
    return obj && obj.isASPxClientCollection;
};
Ident.IsASPxClientControl = function(obj) {
    return obj && obj instanceof ASPxClientControlBase;
};
Ident.IsASPxClientEdit = function(obj) {
    return obj && obj.isASPxClientEdit;
};
Ident.IsFocusableElementRegardlessTabIndex = function (element) {
    var tagName = element.tagName;
    return tagName == "TEXTAREA" || tagName == "INPUT" || tagName == "A" || 
        tagName == "SELECT" || tagName == "IFRAME" || tagName == "OBJECT";
};
Ident.isDialogInvisibleControl = function(control) {
    return !!ASPx.Dialog && ASPx.Dialog.isDialogInvisibleControl(control);
};
Ident.isBatchEditUnusedEditor = function(control) {
    return !!ASPx.BatchEditHelper && ASPx.BatchEditHelper.isBatchEditUnusedEditor(control);
};
Ident.scripts = {};

// Values of unnamed fields must not be sent to the server on a callback
if(ASPx.IsFunction(window.WebForm_InitCallbackAddField)) {
    (function() {
        var original = window.WebForm_InitCallbackAddField;
        window.WebForm_InitCallbackAddField = function(name, value) {
            if(typeof(name) == "string" && name)
                original.apply(null, arguments);
        };
    })();
}

// Default button
ASPx.FireDefaultButton = function(evt, buttonID) {
    if(_aspxIsDefaultButtonEvent(evt, buttonID)) {
        var defaultButton = ASPx.GetElementById(buttonID);
        if(defaultButton && defaultButton.click) {
            if(ASPx.IsFocusable(defaultButton))
                defaultButton.focus();
            ASPx.Evt.DoElementClick(defaultButton);
            ASPx.Evt.PreventEventAndBubble(evt);
            return false;
        }
    }
    return true;
};
function _aspxIsDefaultButtonEvent(evt, defaultButtonID) {
    if(evt.keyCode != ASPx.Key.Enter)
        return false;
    var srcElement = ASPx.Evt.GetEventSource(evt);
    if(!srcElement || srcElement.id === defaultButtonID)
        return true;
    var tagName = srcElement.tagName;
    var type = srcElement.type;
    return tagName != "TEXTAREA" && tagName != "BUTTON" && tagName != "A" &&
        (tagName != "INPUT" || type != "checkbox" && type != "radio" && type != "button" && type != "submit" && type != "reset");
}

// Post Handler
var PostHandler = ASPx.CreateClass(null, {
    constructor: function() {
        this.Post = new ASPxClientEvent();
        this.PostFinalization = new ASPxClientEvent();

        this.observableForms = [];
        this.dxCallbackTriggers = {};
        this.lastSubmitElementName = null;
        this.beforeOnSubmit = function() { };

        this.ReplaceGlobalPostFunctions();
        this.HandleDxCallbackBeginning();
        this.HandleMSAjaxRequestBeginning();
    },
    Update: function() {
        this.ReplaceFormsSubmit(true);
    },
    ProcessPostRequest: function(ownerID, isCallback, isMSAjaxRequest, isDXCallback) {
        this.cancelPostProcessing = false;
        this.isMSAjaxRequest = isMSAjaxRequest;

        if(this.SkipRaiseOnPost(ownerID, isCallback, isDXCallback))
            return;
        var args = new PostHandlerOnPostEventArgs(ownerID, isCallback, isMSAjaxRequest, isDXCallback);
        this.Post.FireEvent(this, args);

        this.cancelPostProcessing = args.cancel;
        if(!args.cancel)
            this.PostFinalization.FireEvent(this, args);
    },

    SkipRaiseOnPost: function(ownerID, isCallback, isDXCallback) { // skip double callback processing (BeforeInitCallback, WebForm_DoCallback)
        if(!isCallback)
            return false;
        var dxOwner = isDXCallback && ASPx.GetControlCollection().GetByName(ownerID);
        if(dxOwner) {
            this.dxCallbackTriggers[dxOwner.uniqueID] = true;
            return false;
        }
        if(this.dxCallbackTriggers[ownerID]) {
            this.dxCallbackTriggers[ownerID] = false;
            return true;
        }
        return false;
    },
    ReplaceGlobalPostFunctions: function() {
        if(ASPx.IsFunction(window.__doPostBack))
            this.ReplaceDoPostBack();
        if(ASPx.IsFunction(window.WebForm_DoCallback))
            this.ReplaceDoCallback();
        if(ASPx.IsFunction(window.WebForm_ExecuteCallback))
            this.ReplaceExecuteCallback();
                        
        this.ReplaceFormsSubmit();
    },
    HandleDxCallbackBeginning: function() {
        ASPx.GetControlCollection().BeforeInitCallback.AddHandler(function(s, e) {
            aspxRaisePostHandlerOnPost(e.callbackOwnerID, true, false, true); 
        });
    },
    HandleMSAjaxRequestBeginning: function() {
        var pageRequestManager = ASPx.GetMSAjaxRequestManager();
        if(pageRequestManager != null && Ident.IsArray(pageRequestManager._onSubmitStatements)) {
            pageRequestManager._onSubmitStatements.unshift(function() {
                var postbackSettings = Sys.WebForms.PageRequestManager.getInstance()._postBackSettings;
                var postHandler = aspxGetPostHandler();
                aspxRaisePostHandlerOnPost(postbackSettings.asyncTarget, true, true);
                return !postHandler.cancelPostProcessing;
            });
        }
    },
    ReplaceDoPostBack: function() {
        var original = __doPostBack;
        __doPostBack = function(eventTarget, eventArgument) {
            var postHandler = aspxGetPostHandler();
            aspxRaisePostHandlerOnPost(eventTarget);
            if(postHandler.cancelPostProcessing)
                return;
            ASPxClientControl.postHandlingLocked = true;
            original(eventTarget, eventArgument);
            delete ASPxClientControl.postHandlingLocked;
        };
    },
    ReplaceDoCallback: function() {
        var original = WebForm_DoCallback;
        WebForm_DoCallback = function(eventTarget, eventArgument, eventCallback, context, errorCallback, useAsync) {
            var postHandler = aspxGetPostHandler();
            aspxRaisePostHandlerOnPost(eventTarget, true);
            if(postHandler.cancelPostProcessing)
                return;
            
            return original(eventTarget, eventArgument, eventCallback, context, errorCallback, useAsync);
        };
    },
    ReplaceExecuteCallback: function() {
        var original = WebForm_ExecuteCallback;
        var handler = this;
        WebForm_ExecuteCallback = function(callbackObject) {
            var isDxCallback = callbackObject && callbackObject.context && ASPx.GetControlCollection().Get(callbackObject.context) !== null;
            ASPx.callbackProcessed = false;
            original(callbackObject);
            if(isDxCallback && !ASPx.callbackProcessed) {
                var request = callbackObject.xmlRequest;
                if(handler.HasAppErrorOnCallback(request) && ASPxClientUtils.IsExists(callbackObject.eventCallback))
                    callbackObject.eventCallback(handler.GetServerErrorText(), callbackObject.context);
            }
        };
    },
    HasAppErrorOnCallback: function(request) {
        if(!request) return false;
        var isServerError = request.status && request.status == 500;
        var pattern = /<html[^>]*>([\w|\W]*)<\/html>/im;
        var text = request.responseText;
        return isServerError && !!text && pattern.test(text);
    },
    GetServerErrorText: function() {
        return "Internal Server Error";
    },    
    ReplaceFormsSubmit: function(checkObservableCollection) {
        for(var i = 0; i < document.forms.length; i++) { // In WebForms there will be only one form, but in MVC page can have multiple forms (B203688)
            var form = document.forms[i];
            
            if(checkObservableCollection && ASPx.Data.ArrayIndexOf(this.observableForms, form) >= 0)
                continue;

            if(form.submit)
                this.ReplaceFormSubmit(form);
            this.ReplaceFormOnSumbit(form);
            this.observableForms.push(form);
        }
    },
    ReplaceFormSubmit: function(form) {
        var originalSubmit = form.submit;
        form.submit = function() {
            var postHandler = aspxGetPostHandler();
            aspxRaisePostHandlerOnPost();
            if(postHandler.cancelPostProcessing)
                return false;
            var callee = arguments.callee;
            this.submit = originalSubmit;
            var submitResult = this.submit();
            this.submit = callee;
            return submitResult;
        };
        form = null;
    },
    ReplaceFormOnSumbit: function(form) {
        var originalSubmit = form.onsubmit;
        form.onsubmit = function() {
            var postHandler = aspxGetPostHandler();

            postHandler.beforeOnSubmit();

            if(postHandler.isMSAjaxRequest)
                postHandler.isMsAjaxRequest = false;
            else
                aspxRaisePostHandlerOnPost(postHandler.GetLastSubmitElementName());

            if(postHandler.cancelPostProcessing)
                return false;

            return ASPx.IsFunction(originalSubmit)
                ? originalSubmit.apply(this, arguments)
                : true;
        };
        form = null;
    },
    SetBeforeOnSubmit: function(action) {
        this.beforeOnSubmit = action;
    },
    SetLastSubmitElementName: function(elementName) {
        this.lastSubmitElementName = elementName;
    },
    GetLastSubmitElementName: function() {
        return this.lastSubmitElementName;
    },
    RemoveDisposedFormsFromCache: function(){
        for(var i = 0; this.observableForms && i < this.observableForms.length; i++){
            var form = this.observableForms[i];
            if(!ASPx.IsExistsElement(form)){
                ASPx.Data.ArrayRemove(this.observableForms, form);
                i--;
            }
        }
    }
});

function aspxRaisePostHandlerOnPost(ownerID, isCallback, isMSAjaxRequest, isDXCallback) {
    if(ASPxClientControl.postHandlingLocked) return;
    var postHandler = aspxGetPostHandler();
    if(postHandler)
        postHandler.ProcessPostRequest(ownerID, isCallback, isMSAjaxRequest, isDXCallback);
}
var aspxPostHandler;
function aspxGetPostHandler() {
    if(!aspxPostHandler)
        aspxPostHandler = new PostHandler();
    return aspxPostHandler;
}

var PostHandlerOnPostEventArgs = ASPx.CreateClass(ASPxClientCancelEventArgs, {
    constructor: function(ownerID, isCallback, isMSAjaxCallback, isDXCallback){
        this.constructor.prototype.constructor.call(this);
        this.ownerID = ownerID;
        this.isCallback = !!isCallback;
        this.isDXCallback = !!isDXCallback;
        this.isMSAjaxCallback = !!isMSAjaxCallback;
    }
});

// Resources manager
var ResourceManager = {
    HandlerStr: "DXR.axd?r=",
    ResourceHashes: {},
    
    SynchronizeResources: function(method){
        if(!method){
            method = function(name, resource) { 
                this.UpdateInputElements(name, resource); 
            }.aspxBind(this);
        }

        var resources = this.GetResourcesData();
        for(var name in resources)
            if(resources.hasOwnProperty(name))
                method(name, resources[name]);
    },
    GetResourcesData: function(){
        return {
            DXScript: this.GetResourcesElementsString(_aspxGetIncludeScripts(), "src", "DXScript"),
            DXCss: this.GetResourcesElementsString(_aspxGetLinks(), "href", "DXCss")
        };
    },
	ParseBundleSrc: function(elements, urlAttr){
        var timeStamp = "";
		var resourceUrlArray = [];

		for(var i = 0; i < elements.length; i++) {
            var resourceUrl = ASPx.Attr.GetAttribute(elements[i], urlAttr);
            if(resourceUrl) {
                var pos = resourceUrl.indexOf(this.HandlerStr);
                if(pos > -1){
                    var list = resourceUrl.substr(pos + this.HandlerStr.length);
                    
                    var ampPos = list.lastIndexOf("-");
                    if(ampPos > -1) {
                        timeStamp = list.substr(ampPos);
                        list = list.substr(0, ampPos);
                    }
                    var indexes = list.split(",");
                    for(var j = 0; j < indexes.length; j++) {
						resourceUrlArray.push(indexes[j]);
                    }
                }
                else
					resourceUrlArray.push(resourceUrl);
            }
        }
		return {
			'resourceUrlArray': resourceUrlArray,
			'timeStamp': timeStamp
		};
	},
	GetResourceHashes: function (id) {
	    if (!this.ResourceHashes[id])
	        this.ResourceHashes[id] = {};
	    return this.ResourceHashes[id];
	},
	GetResourcesElementsString: function (elements, urlAttr, id) {
        var hash = this.GetResourceHashes(id);
		
		var resourceUrlArray = this.ParseBundleSrc(elements, urlAttr).resourceUrlArray;
	    for(var i = 0; i < resourceUrlArray.length; i++) {
            hash[resourceUrlArray[i]] = resourceUrlArray[i];
        }

		var array = [];
    	for(var key in hash)
        	if(hash.hasOwnProperty(key))
            	array.push(key);
		return array.join(",");
	},
    GetNewResourcesElementString: function (element, urlAttr, id) {
        var originalUrl = ASPx.Attr.GetAttribute(element, urlAttr);
        var handlerStrIndex = originalUrl.indexOf(this.HandlerStr);
        var dxResources = handlerStrIndex > -1;
		if(!dxResources) return element[urlAttr];

	    var hash = this.GetResourceHashes(id);
		
		var srcInfo = this.ParseBundleSrc([element], urlAttr);
		var resourceUrlArray = srcInfo.resourceUrlArray;
		var timeStamp = srcInfo.timeStamp;
		var newResourceArray = [];

	    for(var i = 0; i < resourceUrlArray.length; i++) {
			 if(!hash[resourceUrlArray[i]])
				newResourceArray.push(resourceUrlArray[i]);
        }

	    var newResources = "";
	    if(newResourceArray.length > 0) {
	        var baseUrl = originalUrl.substr(0, handlerStrIndex);
	        newResources = baseUrl + this.HandlerStr + newResourceArray.join(",") + timeStamp;
	    }
		return newResources;
    },
    UpdateInputElements: function(typeName, list){
        for(var i = 0; i < document.forms.length; i++){
            var inputElement = document.forms[i][typeName];
            if(!inputElement)
                inputElement = this.CreateInputElement(document.forms[i], typeName);
            inputElement.value = list;
        }
    },
    CreateInputElement: function(form, typeName){
        var inputElement = ASPx.CreateHiddenField(typeName);
        form.appendChild(inputElement);
        return inputElement;
    }
};

// Javascript manager
ASPx.includeScriptPrefix = "dxis_";
ASPx.startupScriptPrefix = "dxss_";

var includeScriptsCache = {};
var createdIncludeScripts = [];
var appendedScriptsCount = 0;
var callbackOwnerNames = [];
var scriptsRestartHandlers = { };

function _aspxIsKnownIncludeScript(script) {
    return !!includeScriptsCache[script.src];
}
function _aspxCacheIncludeScript(script) {
    includeScriptsCache[script.src] = 1;
}

function _aspxProcessScriptsAndLinks(ownerName, isCallback) {
    if(!ASPx.documentLoaded) return; // Q206563

    _aspxProcessScripts(ownerName, isCallback);
    getLinkProcessor().process();
    ASPx.ClearCachedCssRules();
}
function _aspxGetStartupScripts(container) {
    return _aspxGetScriptsCore(ASPx.startupScriptPrefix, container);
}
function _aspxGetIncludeScripts() {
    return _aspxGetScriptsCore(ASPx.includeScriptPrefix);
}
function _aspxGetScriptsCore(prefix, container) {
    var result = [];
    var scripts;
    if(ASPx.IsExists(container))
        scripts = ASPx.GetNodesByTagName(container, "SCRIPT");
    else
        scripts = document.getElementsByTagName("SCRIPT");
    for(var i = 0; i < scripts.length; i++) {
        if(scripts[i].id.indexOf(prefix) == 0)
            result.push(scripts[i]);
    }
    return result;
}
function _aspxGetLinks() {
    var result = [];
    var links = document.getElementsByTagName("LINK");
    for(var i = 0; i < links.length; i++) 
        result[i] = links[i];
    return result;
}
/* jshint ignore:start */
function _aspxIsLinksLoaded() {
    var links = _aspxGetLinks();
    for(var i = 0, link; link = links[i]; i++)
        if(link.readyState && link.readyState.toLowerCase() == "loading")// B208826, B220948, B209968
                return false;
    return true;
}
/* jshint ignore:end */

function _aspxInitializeLinks() {
    var links = _aspxGetLinks();
    for(var i = 0; i < links.length; i++)
        links[i].loaded = true;    
}
var scriptExecutedAttrName = "data-executed";
var scriptDelayedExecutionAttrName = "data-dx-delayedeval";
ASPx.MarkInnerScriptBlocksAsDelayedExecution = function(scriptsContainer) {
    var scripts = scriptsContainer.querySelectorAll("script[id^=" + ASPx.startupScriptPrefix + "]");
    for(var i = 0; i < scripts.length; i++)
        ASPx.Attr.SetAttribute(scripts[i], scriptDelayedExecutionAttrName, true);
};
function isScriptExecuted(script) {
    return ASPx.Attr.GetAttribute(script, scriptExecutedAttrName);
}
function markScriptAsExecuted(script) {
    if(ASPx.Attr.GetAttribute(script, scriptDelayedExecutionAttrName))
        ASPx.Attr.RemoveAttribute(script, scriptDelayedExecutionAttrName);
    else
        ASPx.Attr.SetAttribute(script, scriptExecutedAttrName, true);
}
function _aspxInitializeScripts() {
    var scripts = _aspxGetIncludeScripts();
    for(var i = 0; i < scripts.length; i++)
        _aspxCacheIncludeScript(scripts[i]);            
        
    var startupScripts = _aspxGetStartupScripts();
    for(var i = 0; i < startupScripts.length; i++)
        markScriptAsExecuted(startupScripts[i]);
}
function _aspxSweepDuplicatedLinks() {
    var hash = { };
    var links = _aspxGetLinks();
    for(var i = 0; i < links.length; i++) {
        var href = links[i].href;
        if(!href)
            continue;
            
        if(hash[href]){
            if((ASPx.Browser.IE || !hash[href].loaded) && links[i].loaded) {
                ASPx.RemoveElement(hash[href]);
                hash[href] = links[i];
            }
            else
                ASPx.RemoveElement(links[i]);
        }
        else
            hash[href] = links[i];
    }
}
function _aspxSweepDuplicatedScripts() {
    var hash = { };
    var scripts = _aspxGetIncludeScripts();
    for(var i = 0; i < scripts.length; i++) {
        var src = scripts[i].src;
        if(!src) continue;
        
        if(hash[src])
            ASPx.RemoveElement(scripts[i]);
        else
            hash[src] = scripts[i];
    }
}
function _aspxAreScriptsEqual(script1, script2) {
    return script1.src == script2.src;
}
function _aspxProcessScripts(ownerName, isCallback) {
    var scripts = _aspxGetIncludeScripts();
    var previousCreatedScript = null;
    var firstCreatedScript = null;

    for(var i = 0; i < scripts.length; i++) {
        var script = scripts[i];
        if(script.src == "") continue; // B134651
        if(_aspxIsKnownIncludeScript(script))
            continue;
		
		var getOnlyNewResources = true;
        var onlyNewScripts = ResourceManager.GetNewResourcesElementString(script, "src", "DXScript", getOnlyNewResources);
        if (onlyNewScripts == "")
            continue;
        
		var createdScript = document.createElement("script");

        createdScript.type = "text/javascript";
        createdScript.src = onlyNewScripts;
        createdScript.id = script.id;
        if(ASPx.Data.ArrayIndexOf(createdIncludeScripts, createdScript, _aspxAreScriptsEqual) >= 0)
            continue;

        createdIncludeScripts.push(createdScript);
        ASPx.RemoveElement(script);

        if(ASPx.Browser.IE && ASPx.Browser.Version < 9) {
            createdScript.onreadystatechange = new Function("ASPx.OnScriptReadyStateChangedCallback(this, " + isCallback + ");");
        } else if(ASPx.Browser.Edge || ASPx.Browser.WebKitFamily || (ASPx.Browser.Firefox && ASPx.Browser.Version >= 4) || ASPx.Browser.IE && ASPx.Browser.Version >= 9) {
            // Organizing scripts into a linked list to perform their loading and execution sequentially
            createdScript.onload = new Function("ASPx.OnScriptLoadCallback(this, " + isCallback + ");");
            if(firstCreatedScript == null)
                firstCreatedScript = createdScript;
            createdScript.nextCreatedScript = null;
            if(previousCreatedScript != null)
                previousCreatedScript.nextCreatedScript = createdScript;
            previousCreatedScript = createdScript;
        } else {
            // Immediate script loading
            createdScript.onload = new Function("ASPx.OnScriptLoadCallback(this);");
            ASPx.AppendScript(createdScript);
            _aspxCacheIncludeScript(createdScript);
        }
    }

    // If a scripts linked list was organized, start script loading and executing from the first list element
    if(firstCreatedScript != null) {
        ASPx.AppendScript(firstCreatedScript);
        _aspxCacheIncludeScript(firstCreatedScript);
    }

    if(isCallback)
        callbackOwnerNames.push(ownerName);

    if(createdIncludeScripts.length == 0) {
        var newLinks = ASPx.GetNodesByTagName(document.body, "link");
        var needProcessLinks = isCallback && newLinks.length > 0;
        if(needProcessLinks)
            needProcessLinks = getLinkProcessor().addLinks(newLinks);
        if(!needProcessLinks)
            ASPx.FinalizeScriptProcessing(isCallback);
    }
}
ASPx.FinalizeScriptProcessing = function(isCallback) {
    createdIncludeScripts = [];
    appendedScriptsCount = 0;
    
    var linkProcessor = getLinkProcessor();
    if(linkProcessor.hasLinks())
        _aspxSweepDuplicatedLinks();
    linkProcessor.reset();

    _aspxSweepDuplicatedScripts();
    ResourceManager.SynchronizeResources();
    _aspxRunStartupScripts(isCallback);
};

var startupScriptsRunning = false;
function _aspxRunStartupScripts(isCallback, container) {
    startupScriptsRunning = true;
    try {
        _aspxRunStartupScriptsCore(container);
    }
    finally {
        startupScriptsRunning = false;
    }

    if(ASPx.documentLoaded) {// B133784
        ASPx.GetControlCollection().InitializeElements(isCallback);
    
        for(var key in scriptsRestartHandlers)
            if(scriptsRestartHandlers.hasOwnProperty(key))
                scriptsRestartHandlers[key]();

        _aspxRunEndCallbackScript();
    }
}
function _aspxIsStartupScriptsRunning(isCallback) {
    return startupScriptsRunning;
}
function _aspxRunStartupScriptsCore(container) {
    var scripts = _aspxGetStartupScripts(container);
    var code;
    for(var i = 0; i < scripts.length; i++){
        var script = scripts[i];
        if(!isScriptExecuted(script)) {
            _aspxEnsureStartupScriptIsUnique(script.id); //T454370
            code = ASPx.GetScriptCode(script);
            eval(code);
            markScriptAsExecuted(script);
        }
    }
}
function _aspxEnsureStartupScriptIsUnique(scriptId) {
    if(!scriptId)
        return;
    var scriptExecutedSelector = "script[" + scriptExecutedAttrName + "='true']#" + scriptId;
    ASPx.RemoveElement(document.querySelector(scriptExecutedSelector));
}
function _aspxRunEndCallbackScript() {
    while(callbackOwnerNames.length > 0) {
        var callbackOwnerName = callbackOwnerNames.pop();
        var callbackOwner = ASPx.GetControlCollection().Get(callbackOwnerName);
        if(callbackOwner)
            callbackOwner.DoEndCallback();
    }
}

ASPx.OnScriptReadyStateChangedCallback = function(scriptElement, isCallback) {
    if(scriptElement.readyState == "loaded") {
        _aspxCacheIncludeScript(scriptElement);

        for(var i = 0; i < createdIncludeScripts.length; i++) {
            var script = createdIncludeScripts[i];
            if(_aspxIsKnownIncludeScript(script)) {
                if(!isScriptExecuted(script)) {
                    markScriptAsExecuted(script);
                    ASPx.AppendScript(script);
                    appendedScriptsCount++;
                }
            } else
                break;
        }

        if(createdIncludeScripts.length == appendedScriptsCount)
            ASPx.FinalizeScriptProcessing(isCallback);
    }
};
ASPx.OnScriptLoadCallback = function(scriptElement, isCallback) {
    appendedScriptsCount++;

    if(scriptElement.nextCreatedScript) {
        ASPx.AppendScript(scriptElement.nextCreatedScript);
        _aspxCacheIncludeScript(scriptElement.nextCreatedScript);
    }

    if(createdIncludeScripts.length == appendedScriptsCount)
        ASPx.FinalizeScriptProcessing(isCallback);
};

function _aspxAddScriptsRestartHandler(objectName, handler) {
    scriptsRestartHandlers[objectName] = handler;
}

function _aspxMoveLinkElements() {
    var head = ASPx.GetNodesByTagName(document, "head")[0];
    var bodyLinks = ASPx.GetNodesByTagName(document.body, "link");
    if(head && bodyLinks.length > 0){
        var headLinks = ASPx.GetNodesByTagName(head, "link");
        var dxLinkAnchor = head.firstChild;
        for(var i = 0; i < headLinks.length; i++){
            if(headLinks[i].href.indexOf(ResourceManager.HandlerStr) > -1)
                dxLinkAnchor = headLinks[i].nextSibling;
        }
        while(bodyLinks.length > 0) 
            head.insertBefore(bodyLinks[0], dxLinkAnchor);
    }
}

var LinkProcessor = ASPx.CreateClass(null, {
    constructor: function() {
        this.loadedLinkCount = 0;
        this.linkInfos = [];
        this.loadingObservationTimerID = -1;
    },
    process: function() {
        if(this.hasLinks()) {
            if(this.isLinkLoadEventSupported())
                this.processViaLoadEvent();
            else
                this.processViaTimer();
        }
        else
            _aspxSweepDuplicatedLinks();

        _aspxMoveLinkElements();
    },
    addLinks: function(links) {
        var prevLinkCount = this.linkInfos.length;
        for(var i = 0; i < links.length; i++) {
            var link = links[i];
            if(link.loaded || link.rel != "stylesheet" || link.type != "text/css" || link.href.toLowerCase().indexOf("dxr.axd?r=") == -1)
                continue;

            var linkInfo = {
                link: link,
                href: link.href
            };
            this.linkInfos.push(linkInfo);
        }
        return prevLinkCount != this.linkInfos.length;
    },
    hasLinks: function() {
        return this.linkInfos.length > 0;
    },
    reset: function() {
        this.linkInfos = [];
        this.loadedLinkCount = 0;
    },
    processViaLoadEvent: function() {
        var that = this;
        for(var i = 0, linkInfo; linkInfo = this.linkInfos[i]; i++) {
            if(ASPx.Browser.IE && ASPx.Browser.Version < 9)
                /*jshint -W083 */
                linkInfo.link.onreadystatechange = function() { that.onLinkReadyStateChanged(this); };
                /*jshint +W083 */
            else
                linkInfo.link.onload = this.onLinkLoad.aspxBind(this);
        }
    },
    isLinkLoadEventSupported: function() {
        return !(ASPx.Browser.Chrome && ASPx.Browser.MajorVersion < 19 || ASPx.Browser.Firefox && ASPx.Browser.MajorVersion < 9 ||
            ASPx.Browser.Safari && ASPx.Browser.MajorVersion < 6 || ASPx.Browser.AndroidDefaultBrowser && ASPx.Browser.MajorVersion < 4.4);
    },
    processViaTimer: function() {
        if(this.loadingObservationTimerID == -1)
            this.onLinksLoadingObserve();
    },
    onLinksLoadingObserve: function() {
        if(this.getIsAllLinksLoaded()) {
            this.loadingObservationTimerID = -1;
            this.onAllLinksLoad();
        }
        else
            this.loadingObservationTimerID = window.setTimeout(this.onLinksLoadingObserve.aspxBind(this), 100);
    },
    getIsAllLinksLoaded: function() {
        var styleSheets = document.styleSheets;
        var loadedLinkHrefs = { };
        for(var i = 0; i < styleSheets.length; i++) {
            var styleSheet = styleSheets[i];
            try {
                if(styleSheet.cssRules)
                    loadedLinkHrefs[styleSheet.href] = 1;
            }
            catch(ex) { }
        }
    
        var loadedLinksCount = 0;
        for(var i = 0, linkInfo; linkInfo = this.linkInfos[i]; i++) {
            if(loadedLinkHrefs[linkInfo.href])
                loadedLinksCount++;
        }

        return loadedLinksCount == this.linkInfos.length;
    },
    onAllLinksLoad: function() {
        this.reset();
        _aspxSweepDuplicatedLinks();
        if(createdIncludeScripts.length == 0)
            ASPx.FinalizeScriptProcessing(true);
    },
    onLinkReadyStateChanged: function(linkElement) {
        if(linkElement.readyState == "complete")
            this.onLinkLoadCore(linkElement);
    },
    onLinkLoad: function(evt) {
        var linkElement = ASPx.Evt.GetEventSource(evt);
        this.onLinkLoadCore(linkElement);
    },
    onLinkLoadCore: function(linkElement) {
        if(!this.hasLinkElement(linkElement)) return;
    
        this.loadedLinkCount++;

        if(!ASPx.Browser.Firefox && this.loadedLinkCount == this.linkInfos.length || 
            ASPx.Browser.Firefox && this.loadedLinkCount == 2 * this.linkInfos.length) {
            this.onAllLinksLoad();
        }
    },
    hasLinkElement: function(linkElement) {
        for(var i = 0, linkInfo; linkInfo = this.linkInfos[i]; i++) {
            if(linkInfo.link == linkElement)
                return true;
        }
        return false;
    }
});
var linkProcessor = null;
function getLinkProcessor() {
    if(linkProcessor == null)
        linkProcessor = new LinkProcessor();
    return linkProcessor;
}
ASPx.LinkProcessor = LinkProcessor;

// IFrame helper
var IFrameHelper = ASPx.CreateClass(null, {
    constructor: function(params) {
        this.params = params || {};
        this.params.src = this.params.src || "";
        this.CreateElements();
    },
    CreateElements: function() {
        var elements = IFrameHelper.Create(this.params);
        this.containerElement = elements.container;
        this.iframeElement = elements.iframe;

        this.AttachOnLoadHandler(this, this.iframeElement);
        this.SetLoading(true);
        
        if(this.params.onCreate)
            this.params.onCreate(this.containerElement, this.iframeElement);
    },
    AttachOnLoadHandler: function(instance, element) {
        ASPx.Evt.AttachEventToElement(element, "load", function() {
            instance.OnLoad(element);
        });
    },
    OnLoad: function(element) {
        this.SetLoading(false, element);
        if(!element.preventCustomOnLoad && this.params.onLoad)
            this.params.onLoad();
    },
    IsLoading: function(element) {
        element = element || this.iframeElement;
        if(element)
            return element.loading;
        return false;
    },
    SetLoading: function(value, element) {
        element = element || this.iframeElement;
        if(element)
            element.loading = value;
    },

    GetContentUrl: function() {
        return this.params.src;
    },
    SetContentUrl: function(url, preventBrowserCaching) {
        if(url) {
            this.params.src = url;
            if(preventBrowserCaching)
                url = IFrameHelper.AddRandomParamToUrl(url);
            this.SetLoading(true);
            this.iframeElement.src = url;
        }
    },
    RefreshContentUrl: function() {
        if(this.IsLoading())
            return;
        this.SetLoading(true);

        var oldContainerElement = this.containerElement;
        var oldIframeElement = this.iframeElement;
        
        var postfix = "_del" + Math.floor(Math.random()*100000).toString();
        if(this.params.id)
            oldIframeElement.id = this.params.id + postfix;
        if(this.params.name)
            oldIframeElement.name = this.params.name + postfix;
        
        ASPx.SetStyles(oldContainerElement, { height: 0 });

        this.CreateElements();

        oldIframeElement.preventCustomOnLoad = true;
        oldIframeElement.src = ASPx.BlankUrl;
        window.setTimeout(function() {
            oldContainerElement.parentNode.removeChild(oldContainerElement);
        }, 10000); // This value has been chosen randomly. We hope that the new page will be loaded after the 10 seconds
    }
});
IFrameHelper.Create = function(params) {
    var iframeHtmlStringParts = [ "<iframe frameborder='0'" ];
    if(params) {
        if(params.id)
            iframeHtmlStringParts.push(" id='", params.id, "'");
        if(params.name)
            iframeHtmlStringParts.push(" name='", params.name, "'");
        if(params.title)
            iframeHtmlStringParts.push(" title='", params.title, "'");
        if(params.scrolling)
            iframeHtmlStringParts.push(" scrolling='", params.scrolling, "'");
        if(params.src)
            iframeHtmlStringParts.push(" src='", params.src, "'");
    }
    iframeHtmlStringParts.push("></iframe>");
    
    var containerElement = ASPx.CreateHtmlElementFromString("<div style='border-width: 0px; padding: 0px; margin: 0px'></div>");
    var iframeElement = ASPx.CreateHtmlElementFromString(iframeHtmlStringParts.join(""));
    containerElement.appendChild(iframeElement);

    return {
        container: containerElement,
        iframe: iframeElement
    };
};
IFrameHelper.AddRandomParamToUrl = function(url) {
    var prefix = url.indexOf("?") > -1
        ? "&"
        : "?";
    var param = prefix + Math.floor(Math.random()*100000).toString();
    
    var anchorIndex = url.indexOf("#");
    return anchorIndex == -1
        ? url + param
        : url.substr(0, anchorIndex) + param + url.substr(anchorIndex);
};
IFrameHelper.GetWindow = function(name) {
    if(ASPx.Browser.IE)
        return window.frames[name].window;
    else{
        var frameElement = document.getElementById(name);
        return (frameElement != null) ? frameElement.contentWindow : null;
    }
};
IFrameHelper.GetDocument = function(name) {
    var frameElement;
    if(ASPx.Browser.IE) {
        frameElement = window.frames[name];
        return (frameElement != null) ? frameElement.document : null;
    }
    else {
        frameElement = document.getElementById(name);
        return (frameElement != null) ? frameElement.contentDocument : null;
    }
};
IFrameHelper.GetDocumentBody = function(name) {
    var doc = IFrameHelper.GetDocument(name);
    return (doc != null) ? doc.body : null;
};
IFrameHelper.GetDocumentHead = function (name) {
    var doc = IFrameHelper.GetDocument(name);
    return (doc != null) ? doc.head || doc.getElementsByTagName('head')[0] : null;
};
IFrameHelper.GetElement = function(name) {
    if(ASPx.Browser.IE)
        return window.frames[name].window.frameElement;
    else
        return document.getElementById(name);
};

// Keyboard helper
var KbdHelper = ASPx.CreateClass(null, {

    constructor: function(control) {
        this.control = control;
    },
    
    Init: function() {
        KbdHelper.GlobalInit();
        var elements = this.getFocusableElements();
        for(var i = 0; i < elements.length; i++) {
            var element = elements[i];
            element.tabIndex = Math.max(element.tabIndex, 0);
        
            ASPx.Evt.AttachEventToElement(element, "click", function(e) { this.HandleClick(e); }.aspxBind(this));
            ASPx.Evt.AttachEventToElement(element, "focus", function(e) {             
                return this.onElementFocus(e);
            }.aspxBind(this));
            ASPx.Evt.AttachEventToElement(element, "blur", function () { this.onBlur(); }.aspxBind(this)); 
        }         
    },
    onElementFocus: function(e) {
        if(!this.CanFocus(e))
            return true;
        KbdHelper.active = this;
    },

    getFocusableElements: function() {
        return [this.GetFocusableElement()];    
    },
    GetFocusableElement: function() { return this.control.GetMainElement(); },
    canHandleNoFocusAction: function() { 
        var focusableElements = this.getFocusableElements();
        for(var i = 0; i < focusableElements.length; i++) {
            if(focusableElements[i] === _aspxGetFocusedElement())
                return false;
        }
        return true;
    },
    
    CanFocus: function(e) {
        var tag = ASPx.Evt.GetEventSource(e).tagName;
        return !(tag === "A" || tag === "TEXTAREA" || tag === "INPUT" || tag === "SELECT" || tag === "IFRAME" || tag === "OBJECT");
    },
    
    HandleClick: function(e) {
        if(!this.CanFocus(e))
            return;
        this.Focus();
    },
    Focus: function() {
        try {
            this.GetFocusableElement().focus();   
        } catch(e) {
        }
    },
    onBlur: function(){
        delete KbdHelper.active;
    },
    
    HandleKeyDown: function(e) { },    
    HandleKeyPress: function(e) { },    
    HandleKeyUp: function (e) { },
    HandleNoFocusAction: function(e) { },
    FocusByAccessKey: function () { }
});

KbdHelper.GlobalInit = function() {
    if(KbdHelper.ready)
        return;
    ASPx.Evt.AttachEventToDocument("keydown", KbdHelper.OnKeyDown);
    ASPx.Evt.AttachEventToDocument("keypress", KbdHelper.OnKeyPress);
    ASPx.Evt.AttachEventToDocument("keyup", KbdHelper.OnKeyUp);
    KbdHelper.ready = true;    
};

KbdHelper.swallowKey = false;
KbdHelper.accessKeys = { };

KbdHelper.ProcessKey = function(e, actionName) {
    if(!KbdHelper.active) 
        return;
    if (KbdHelper.active.canHandleNoFocusAction()) {
        KbdHelper.active["HandleNoFocusAction"](e, actionName);
        return;
    }
    //B208466
    var ctl = KbdHelper.active.control;
    if(ctl !== ASPx.GetControlCollection().Get(ctl.name)) {
        delete KbdHelper.active;
        return;
    }

    if(!KbdHelper.swallowKey) 
        KbdHelper.swallowKey = KbdHelper.active[actionName](e);
    if(KbdHelper.swallowKey)
        ASPx.Evt.PreventEvent(e);
};

KbdHelper.OnKeyDown = function(e) {
    KbdHelper.swallowKey = false;
    if(KbdHelper.TryAccessKey(KbdHelper.getKeyName(e)))
        ASPx.Evt.PreventEvent(e);
    else    
        KbdHelper.ProcessKey(e, "HandleKeyDown"); 
};
KbdHelper.OnKeyPress = function(e) { KbdHelper.ProcessKey(e, "HandleKeyPress"); };
KbdHelper.OnKeyUp = function(e) { KbdHelper.ProcessKey(e, "HandleKeyUp"); };

KbdHelper.RegisterAccessKey = function(obj) {
    var key;
    if(obj.accessKey)
        key = "CtrlShift" + obj.accessKey;
    else if(obj.keyTipModeShortcut)
        key = obj.keyTipModeShortcut;
    if(!key) return;
    KbdHelper.accessKeys[key.toLowerCase()] = obj.name;
};
KbdHelper.TryAccessKey = function(code) {
    var key = code.toLowerCase ? code.toLowerCase() : String.fromCharCode(code).toLowerCase();
    var name = KbdHelper.accessKeys[key];
    if(!name) return false;
    var obj = ASPx.GetControlCollection().Get(name);
    return KbdHelper.ClickAccessKey(obj);
};

KbdHelper.ClickAccessKey = function (control) {
    if (!control) return false;
    var el = control.GetMainElement();
    if (!el) return false;
    el.focus();
    setTimeout(function () {
        if (KbdHelper.active && KbdHelper.active.FocusByAccessKey)
            KbdHelper.active.FocusByAccessKey();
    }.aspxBind(this), 100);
    return true;
};

KbdHelper.getKeyName = function(e) {
    var name = "";
    if(e.altKey)
        name += "Alt";
    if(e.ctrlKey)
        name += "Ctrl";
    if(e.shiftKey)
        name += "Shift";
    var keyCode = e.key || e.code || String.fromCharCode(ASPx.Evt.GetKeyCode(e));
    if(keyCode.match(/key/i))
        name += keyCode.replace(/key/i, "");
    else if(keyCode.match(/digit/i))
        name += keyCode.replace(/digit/i, "");
    else if(keyCode.match(/arrow/i))
        name += keyCode.replace(/arrow/i, "");
    else if(keyCode.match(/ins/i))
        name += "Ins";
    else if(keyCode.match(/del/i))
        name += "Del";
    else if(keyCode.match(/back/i))
        name += "Back";
    else if(!keyCode.match(/alt/i) && !keyCode.match(/control/i) && !keyCode.match(/shift/i))
        name += keyCode;
    return name.replace(/^a-zA-Z0-9/, "");
};

AccessKeysHelper = ASPx.CreateClass(KbdHelper, {

    constructor: function (control) {
        this.constructor.prototype.constructor.call(this, control);
        this.accessKeysVisible = false;
        this.activeKey = null;
        this.accessKey = control.createAccessKey ? control.createAccessKey(control.accessKey) : new AccessKey(control.accessKey);
        this.accessKeys = this.accessKey.accessKeys;
        this.charIndex = 0;
        this.onFocusByAccessKey = null;
        this.onClose = null;
        this.manualStopProcessing = false;
        this.isActive = false;
        this.areAccessKeysShown = false;
    },

    Init: function (control) {
        KbdHelper.prototype.Init.call(this);
        KbdHelper.RegisterAccessKey(control);            
    },

    Add: function (accessKey) {
        this.accessKey.Add(accessKey);
    },

    HandleKeyDown: function (e) {
        var keyCode = ASPx.Evt.GetKeyCode(e);
        var stopProcessing = this.processKeyDown(keyCode);
        if (stopProcessing.value) {
            this.stopProcessing();
            if(this.onClosedOnEscape && (keyCode == ASPx.Key.Esc || stopProcessing.fireEvent))
                this.onClosedOnEscape();
        }
        return stopProcessing;
    },
    HandleNoFocusAction: function (e, actionName) {
        var keyCode = ASPx.Evt.GetKeyCode(e);
        if (this.onClosedOnEscape && keyCode == ASPx.Key.Esc && actionName == "HandleKeyDown")
            this.onClosedOnEscape();
    },
    Activate: function () {
        KbdHelper.ClickAccessKey(this.control);
        this.areAccessKeysShown = true;
    },
    Stop: function() {
        this.stopProcessing();
    },
    stopProcessing: function () {
        this.HideAccessKeys();
        if (KbdHelper.active && this.isActive) {
            this.isActive = false;
            KbdHelper.active.control.GetMainElement().blur();
            delete KbdHelper.active;
        }
    },
    onBlur: function() {
        if (this.manualStopProcessing) {
            this.manualStopProcessing = false;
            return;
        }
        this.HideAccessKeys();
        KbdHelper.prototype.onBlur.call(this);
    },
    processKeyDown: function (keyCode) {
        switch (keyCode) {
            case ASPx.Key.Left:
                this.TryMoveFocusLeft();
                return { value: false };
            case ASPx.Key.Right:
                this.TryMoveFocusRight();
                return { value: false };
            case ASPx.Key.Esc:
                if(this.control.hideAllPopups)
                    this.control.hideAllPopups(true, true);
                if(this.activeKey)
                    this.activeKey = this.activeKey.Return();
                this.charIndex = 0;
                if (!this.activeKey)
                    return { value: true };
                break;
            case ASPx.Key.Enter:
                return { value: true };
            default:
                if (!ASPx.IsPrintableKey(keyCode))
                    return { value: false };
                var char = String.fromCharCode(keyCode).toUpperCase();
                var needToContinue = { value: false };
                var keyResult;
                if(this.activeKey)
                    keyResult = this.activeKey.TryAccessKey(char, this.charIndex, needToContinue);
                if (needToContinue.value) {
                    this.charIndex++;
                    return { value: false };
                }
                this.charIndex = 0;
                if(keyResult !== undefined)
                    this.activeKey = keyResult;
                else
                    return { value: true, fireEvent: true };
                if (!this.activeKey || !this.activeKey.accessKeys || this.activeKey.accessKeys.length == 0) {
                    if (this.activeKey && this.activeKey.manualStopProcessing) {
                        this.manualStopProcessing = true;
                        break;
                    }
                    return { value: true, fireEvent: true };
                }
        }
        return { value: false };
    },
    TryMoveFocusLeft: function (modifier) {},
    TryMoveFocusRight: function (modifier) {},
    TryMoveFocusUp: function (modifier) {},
    TryMoveFocusDown: function (modifier) {},
    FocusByAccessKey: function() {
        if (this.onFocusByAccessKey)
            this.onFocusByAccessKey();
        this.HideAccessKeys();
        KbdHelper.prototype.FocusByAccessKey.call(this);
        this.activeKey = this.accessKey;
        this.activeKey.execute();
        this.isActive = true;
        this.areAccessKeysShown = true;
    },
    HideAccessKeys: function() {
        this.areAccessKeysShown = false;
        this.hideAccessKeys(this.accessKey);
    },
    Update: function() {
        // 10 times in one second
        this.throttleMethod(this.refresh, 100);
    },
    refresh: function() {
        if(this.activeKey && this.areAccessKeysShown) {
            this.activeKey.execute();
        }
    },
    throttleMethod: function(method, delay) {
        clearTimeout(method.timerId);
        method.timerId = setTimeout(function() {
            method.call(this);
        }.aspxBind(this), delay);

    },
    AreAccessKeysShown: function() {
        return this.areAccessKeysShown;
    },

    hideAccessKeys: function (accessKey) {
        for (var i = 0, ak; ak = accessKey.accessKeys[i]; i++) {
            this.hideAccessKeys(ak);
        }
        if (accessKey)
            accessKey.hide();
    },
    HandleClick: function(e) {
        KbdHelper.prototype.HandleClick.call(this, e);
        this.stopProcessing();
    }
});

AccessKey = ASPx.CreateClass(null, {
    constructor: function (popupItem, getPopupElement, keyTipElement, key, onlyClick, manualStopProcessing) {
        this.key = key ? key : keyTipElement ? ASPxClientUtils.Trim(ASPx.GetInnerText(keyTipElement)) : null;
        this.popupItem = popupItem;
        this.getPopupElement = getPopupElement;
        this.keyTipElement = keyTipElement;
        this.accessKeys = [];
        this.needShowChilds = true;
        this.parent = null;
        this.onlyClick = onlyClick;
        this.manualStopProcessing = manualStopProcessing;
    },

    Add: function (accessKey) {
        this.accessKeys.push(accessKey);
        accessKey.parent = this;
    },

    TryAccessKey: function (char, index, needToContinue) {
        if (!this.accessKeys || this.accessKeys.length == 0)
            return;
        for (var i = 0, accessKey; accessKey = this.accessKeys[i]; i++) {
            if (accessKey.key[index] == char && accessKey.isVisible()) {
                if (accessKey.key[index + 1]) {
                    needToContinue.value = true;
                }
                else {
                    accessKey.execute();
                    return accessKey;
                }
            } else {
                accessKey.hide();
            }
        }
        for (var i = 0, accessKey; accessKey = this.accessKeys[i]; i++) {
            var key = accessKey.TryAccessKey(char, index, needToContinue);
            if (key)
                return key;
        }
        return;
    },

    isVisible: function(){
        return ASPx.GetElementVisibility(this.keyTipElement);
    },

    Return: function () {
        this.hideChildAccessKeys();
        if (this.parent) {
            this.parent.showAccessKeys(true);
        }        
        return this.parent;
    },

    execute: function () {
        this.hideAll();
        if (this.popupItem && this.popupItem.accessKeyClick && !this.onlyClick)
            this.popupItem.accessKeyClick();
        if (this.getPopupElement && this.onlyClick)
            ASPx.Evt.EmulateMouseClick(this.getPopupElement(this.popupItem));
        if (this.accessKeys)
            setTimeout(function () {
                this.showAccessKeys(true);
            }.aspxBind(this), 100);
    },

    showAccessKeys: function(directShow) {
        if (!directShow && !this.needShowChilds)
            return;
        for (var i = 0; i < this.accessKeys.length; i++) {
            var accessKey = this.accessKeys[i];
            if (accessKey) {
                var popupElement = accessKey.getPopupElement ? accessKey.getPopupElement(accessKey.popupItem) : null;
                if (popupElement && this.isElementVisible(popupElement)) {
                    this.show(accessKey);
                }
                accessKey.showAccessKeys();
            }
        }
    },
    isElementVisible: function (el) { return ASPx.IsElementVisible(el, true); },
    show: function(accessKey) {
        var keyTipElement = accessKey.keyTipElement;
        var popupElement = accessKey.getPopupElement(accessKey.popupItem);
        this.showKeyTipElement(keyTipElement, this.calculateCoordinates(accessKey, keyTipElement, popupElement));
    },
    showKeyTipElement: function (keyTipElement, coordinates) {
        ASPx.SetAbsoluteY(keyTipElement, coordinates.top);
        ASPx.SetAbsoluteX(keyTipElement, coordinates.left);
        ASPx.SetElementVisibility(keyTipElement, true); 
    },
    calculateCoordinates: function (accessKey, keyTipElement, popupElement) {
        var top = ASPx.GetAbsolutePositionY(popupElement);
        var left = ASPx.GetAbsolutePositionX(popupElement);
        
        if (accessKey.popupItem.getAccessKeyPosition)
            switch (accessKey.popupItem.getAccessKeyPosition()) {
                case "AboveRight":
                    left = left + popupElement.offsetWidth - keyTipElement.offsetWidth / 3;
                    top = top - keyTipElement.offsetHeight / 2;
                    break;
                case "Right":
                    left = left + popupElement.offsetWidth - keyTipElement.offsetWidth / 3;
                    top = top + popupElement.offsetHeight / 2 - keyTipElement.offsetHeight / 2;
                    break;
                case "BelowRight":
                    left = left + popupElement.offsetWidth - keyTipElement.offsetWidth / 3;
                    top = top + keyTipElement.offsetHeight / 2;
                    break;
                default:
                    top = top + popupElement.offsetHeight;
                    left = left + popupElement.offsetWidth / 2 - keyTipElement.offsetWidth / 2;
                    break;
            }
        else {
            top = top + popupElement.offsetHeight;
            left = left + popupElement.offsetWidth / 2 - keyTipElement.offsetWidth / 2;
        }
        return { top: top, left: left };
    },

    hide: function() {
        if (this.keyTipElement)
            ASPx.SetElementVisibility(this.keyTipElement, false);
    },

    hideChildAccessKeys: function () {
        this.hideAccessKeys(this.accessKeys);
    },

    hideAccessKeys: function (accessKeys) {
        if (accessKeys) {
            for (var i = 0, accessKey; accessKey = accessKeys[i]; i++) {
                if (accessKey.keyTipElement)
                    accessKey.hide();
                accessKey.hideChildAccessKeys();
            }
        }
    },
    hideAll: function () {
        this.getRoot(this).hideChildAccessKeys();
    },
    getRoot: function (accessKey) {
        if (!accessKey.parent)
            return accessKey;
        return this.getRoot(accessKey.parent);
    }
});

// Focusing
var focusedElement = null;
function aspxOnElementFocused(evt) {
    evt = ASPx.Evt.GetEvent(evt);
    if(evt && evt.target)
        focusedElement = evt.target;
}
function _aspxInitializeFocus() {
    if(!ASPx.GetActiveElement())
        ASPx.Evt.AttachEventToDocument("focus", aspxOnElementFocused);
}
function _aspxGetFocusedElement() {
    var activeElement = ASPx.GetActiveElement();
    return activeElement ? activeElement : focusedElement;
}

// CheckBox
CheckBoxCheckState = {
    Checked : "Checked",
    Unchecked : "Unchecked",
    Indeterminate : "Indeterminate"
};

CheckBoxInputKey = { 
    Checked : "C",
    Unchecked : "U",
    Indeterminate : "I"
};

var CheckableElementStateController = ASPx.CreateClass(null, {
    constructor: function(imageProperties) {
        this.checkBoxStates = [];
        this.imageProperties = imageProperties;
        this.customImageMarkerClassName = "dxcbCI";
    },
    
    GetValueByInputKey: function(inputKey) {
        return this.GetFirstValueBySecondValue("Value", "StateInputKey", inputKey);
    },
    GetInputKeyByValue: function(value) {
        return this.GetFirstValueBySecondValue("StateInputKey", "Value", value);
    },
    GetImagePropertiesNumByInputKey: function(value) {
        return this.GetFirstValueBySecondValue("ImagePropertiesNumber", "StateInputKey", value);
    },
    GetNextCheckBoxValue: function(currentValue, allowGrayed) {
        var currentInputKey = this.GetInputKeyByValue(currentValue);
        var nextInputKey = '';
        
        switch(currentInputKey) {
            case CheckBoxInputKey.Checked:
                nextInputKey = CheckBoxInputKey.Unchecked; break;
            case CheckBoxInputKey.Unchecked:
                nextInputKey = allowGrayed ? CheckBoxInputKey.Indeterminate : CheckBoxInputKey.Checked; break;
            case CheckBoxInputKey.Indeterminate:
                nextInputKey = CheckBoxInputKey.Checked; break;
        }
        return this.GetValueByInputKey(nextInputKey);
    },
    GetCheckStateByInputKey: function(inputKey) {
        switch(inputKey) {
            case CheckBoxInputKey.Checked: 
                return CheckBoxCheckState.Checked;
            case CheckBoxInputKey.Unchecked: 
                return CheckBoxCheckState.Unchecked;
            case CheckBoxInputKey.Indeterminate: 
                return CheckBoxCheckState.Indeterminate;
        }
    },
    GetValueByCheckState: function(checkState) {
        switch(checkState) {
            case CheckBoxCheckState.Checked: 
                return this.GetValueByInputKey(CheckBoxInputKey.Checked);
            case CheckBoxCheckState.Unchecked: 
                return this.GetValueByInputKey(CheckBoxInputKey.Unchecked);
            case CheckBoxCheckState.Indeterminate: 
                return this.GetValueByInputKey(CheckBoxInputKey.Indeterminate);
        }
    },
    GetFirstValueBySecondValue: function(firstValueName, secondValueName, secondValue) {
        return this.GetValueByFunc(firstValueName, 
            function(checkBoxState) { return checkBoxState[secondValueName] === secondValue; });
    },
    GetValueByFunc: function(valueName, func) {
        for(var i = 0; i < this.checkBoxStates.length; i++) {
            if(func(this.checkBoxStates[i]))
                return this.checkBoxStates[i][valueName];
        }        
    },
    AssignElementClassName: function(element, cssClassPropertyKey, disabledCssClassPropertyKey, assignedClassName) {
	    var classNames = [ ];
	    for(var i = 0; i < this.imageProperties[cssClassPropertyKey].length; i++) {
		    classNames.push(this.imageProperties[disabledCssClassPropertyKey][i]);
		    classNames.push(this.imageProperties[cssClassPropertyKey][i]);
	    }
	    var elementClassName = element.className;
	    for(var i = 0; i < classNames.length; i++) {
		    var className = classNames[i];
		    var index = elementClassName.indexOf(className);
		    if(index > -1)
			    elementClassName = elementClassName.replace((index == 0 ? '' : ' ') + className, "");
	    }
	    elementClassName += " " + assignedClassName;
	    element.className = elementClassName;
    },

    UpdateInternalCheckBoxDecoration: function(mainElement, inputKey, enabled) {
        var imagePropertiesNumber = this.GetImagePropertiesNumByInputKey(inputKey);
        for(var imagePropertyKey in this.imageProperties) {
            if(this.imageProperties.hasOwnProperty(imagePropertyKey)) {
                var propertyValue = this.imageProperties[imagePropertyKey][imagePropertiesNumber];
                propertyValue = propertyValue || !isNaN(propertyValue) ? propertyValue : "";
                switch(imagePropertyKey) {
                    case "0" : mainElement.title = propertyValue; break;
                    case "1" : mainElement.style.width = propertyValue + (propertyValue != "" ? "px" : ""); break;
                    case "2" : mainElement.style.height = propertyValue + (propertyValue != "" ? "px" : ""); break;
                }
                if(enabled) {
                    switch(imagePropertyKey) {
                        case "3" : this.SetImageSrc(mainElement, propertyValue); break;
                        case "4" : 
                            this.AssignElementClassName(mainElement, "4", "8", propertyValue);
                            break;
                        case "5" : this.SetBackgroundPosition(mainElement, propertyValue, true); break;
                        case "6" : this.SetBackgroundPosition(mainElement, propertyValue, false); break;
                    }
                } else {
                    switch(imagePropertyKey) {
                        case "7" : this.SetImageSrc(mainElement, propertyValue); break;
                        case "8" : 
                            this.AssignElementClassName(mainElement, "4", "8", propertyValue);
                            break;
                        case "9" : this.SetBackgroundPosition(mainElement, propertyValue, true); break;
                        case "10" : this.SetBackgroundPosition(mainElement, propertyValue, false); break;
                    }
                }
            }
        }
    },
	SetImageSrc: function(mainElement, src) {
        if(src === ""){
            mainElement.style.backgroundImage = "";
            mainElement.style.backgroundPosition = "";
            ASPx.RemoveClassNameFromElement(mainElement, this.customImageMarkerClassName);
        }
        else{
		    mainElement.style.backgroundImage = "url('" + src + "')";
		    this.SetBackgroundPosition(mainElement, 0, true);
            this.SetBackgroundPosition(mainElement, 0, false);
            ASPx.AddClassNameToElement(mainElement, this.customImageMarkerClassName);
        }
	},
    SetBackgroundPosition: function(element, value, isX) {
        if(value === "") {
            element.style.backgroundPosition = value;
            return;
        }
        if(element.style.backgroundPosition === "")
            element.style.backgroundPosition = isX ? "-" + value.toString() + "px 0px" : "0px -" + value.toString() + "px";
        else {
            var position = element.style.backgroundPosition.split(' ');
            element.style.backgroundPosition = isX ? '-' + value.toString() + "px " + position[1] :  position[0] + " -" + value.toString() + "px";
        }
    },
   
    AddState: function(value, stateInputKey, imagePropertiesNumber) {
        this.checkBoxStates.push({
            "Value" : value, 
            "StateInputKey" : stateInputKey, 
            "ImagePropertiesNumber" : imagePropertiesNumber
        });
    },
    GetAriaCheckedValue: function(state) {
        switch(state) {
            case ASPx.CheckBoxCheckState.Checked: return "true";
            case ASPx.CheckBoxCheckState.Unchecked: return "false";
            case ASPx.CheckBoxCheckState.Indeterminate: return "mixed";
            default: return "";
        }
    }
});

CheckableElementStateController.Create = function(imageProperties, valueChecked, valueUnchecked, valueGrayed, allowGrayed) {
    var stateController = new CheckableElementStateController(imageProperties);
    stateController.AddState(valueChecked, CheckBoxInputKey.Checked, 0);
    stateController.AddState(valueUnchecked, CheckBoxInputKey.Unchecked, 1);
    if(typeof(valueGrayed) != "undefined")
        stateController.AddState(valueGrayed, CheckBoxInputKey.Indeterminate, allowGrayed ? 2 : 1);
    stateController.allowGrayed = allowGrayed;
    return stateController;
};

var CheckableElementHelper = ASPx.CreateClass(null, {
    InternalCheckBoxInitialize: function(internalCheckBox) {
        this.AttachToMainElement(internalCheckBox);
        this.AttachToInputElement(internalCheckBox);
    },
    AttachToMainElement: function(internalCheckBox) {
        var instance = this;
        if(internalCheckBox.mainElement) {
             var toggleEvent = internalCheckBox.displaySwitch ? ASPx.TouchUIHelper.touchMouseDownEventName : "click";
             ASPx.Evt.AttachEventToElement(internalCheckBox.mainElement, toggleEvent,
                function (evt) {
                    if(ASPx.Evt.IsRightButtonPressed(evt))
                        return;
                    instance.InvokeClick(internalCheckBox, evt);
                    if(!internalCheckBox.disableCancelBubble)
                        return ASPx.Evt.PreventEventAndBubble(evt);
                }
            );
            ASPx.Evt.AttachEventToElement(internalCheckBox.mainElement, "mousedown",
                function (evt) {
                    internalCheckBox.Refocus();
                }
            );
            ASPx.Evt.PreventElementDragAndSelect(internalCheckBox.mainElement, true);
        }
    },
    AttachToInputElement: function(internalCheckBox) {
        var instance = this;
        if(internalCheckBox.inputElement && internalCheckBox.mainElement) {
            var checkableElement = internalCheckBox.accessibilityCompliant ? internalCheckBox.mainElement : internalCheckBox.inputElement;
            ASPx.Evt.AttachEventToElement(checkableElement, "focus",
                function (evt) { 
                    if(!internalCheckBox.enabled)
                        checkableElement.blur();
                    else
                        internalCheckBox.OnFocus();
                }
            );
            ASPx.Evt.AttachEventToElement(checkableElement, "blur", 
                function (evt) { 
                    internalCheckBox.OnLostFocus();
                }
            );
            ASPx.Evt.AttachEventToElement(checkableElement, "keyup",
                function (evt) { 
                    if(ASPx.Evt.GetKeyCode(evt) == ASPx.Key.Space)
                        instance.InvokeClick(internalCheckBox, evt);
                }
            );
            ASPx.Evt.AttachEventToElement(checkableElement, "keydown",
                function (evt) { 
                    if(ASPx.Evt.GetKeyCode(evt) == ASPx.Key.Space)
                        return ASPx.Evt.PreventEvent(evt);
                }
            );
        }
    },
    IsKBSInputWrapperExist: function() {
        return ASPx.Browser.Opera || ASPx.Browser.WebKitFamily;
    },
    GetICBMainElementByInput: function(icbInputElement) {
        return this.IsKBSInputWrapperExist() ? icbInputElement.parentNode.parentNode : icbInputElement.parentNode;
    },
    RequirePreventFocus: function() { return false; },
    InvokeClick: function(internalCheckBox, evt) {
        if(internalCheckBox.enabled && !internalCheckBox.GetReadOnly()) {
            var inputElementValue = internalCheckBox.inputElement.value;
            var focusableElement = internalCheckBox.accessibilityCompliant ? internalCheckBox.mainElement : internalCheckBox.inputElement; 
            if(!this.RequirePreventFocus())
                focusableElement.focus();
            if(!ASPx.Browser.IE) // Q413117
                internalCheckBox.inputElement.value = inputElementValue;
            this.InvokeClickCore(internalCheckBox, evt);
         }
    },
    InvokeClickCore: function(internalCheckBox, evt) {
        internalCheckBox.OnClick(evt);
    }
});
CheckableElementHelper.Instance = new CheckableElementHelper();

var CheckBoxInternal = ASPx.CreateClass(null, {
    constructor: function(inputElement, stateController, allowGrayed, allowGrayedByClick, helper, container, storeValueInInput, key, disableCancelBubble,
        accessibilityCompliant, displaySwitch) {
        this.inputElement = inputElement;
        this.mainElement = helper.GetICBMainElementByInput(this.inputElement);
        this.name = (key ? key : this.inputElement.id) + CheckBoxInternal.GetICBMainElementPostfix();
        this.mainElement.id = this.name;
        this.stateController = stateController;
        this.container = container;

        this.allowGrayed = allowGrayed;
        this.allowGrayedByClick = allowGrayedByClick;
        this.autoSwitchEnabled = true;
        this.displaySwitch = displaySwitch;

        this.storeValueInInput = !!storeValueInInput;
        this.storedInputKey = !this.storeValueInInput ? this.inputElement.value : null;
        this.disableCancelBubble = !!disableCancelBubble;
        this.accessibilityCompliant = accessibilityCompliant;
        
		this.focusDecoration = null;
        this.focused = false;
        this.focusLocked = false;

        this.enabled = !this.mainElement.className.match(/dxWeb_\w+Disabled(\b|_)/);
        this.readOnly = false;

        this.preventFocus = helper.RequirePreventFocus();
        
        this.CheckedChanged = new ASPxClientEvent();
        this.Focus = new ASPxClientEvent();
        this.LostFocus = new ASPxClientEvent();
        
        helper.InternalCheckBoxInitialize(this);
    },
    GetReadOnly: function() {
        return this.readOnly;
    },
    ChangeInputElementTabIndex: function() {        
        var changeMethod = this.enabled ? ASPx.Attr.RestoreTabIndexAttribute : ASPx.Attr.SaveTabIndexAttributeAndReset;
        changeMethod(this.inputElement);
    },
	CreateFocusDecoration: function(focusedStyle) {
		 this.focusDecoration = new FocusedStyleDecoration(this);
         this.focusDecoration.AddStyle('F', focusedStyle[0], focusedStyle[1]);
         this.focusDecoration.AddPostfix("");
	},
    UpdateFocusDecoration: function() {
    	this.focusDecoration.Update();
    },        
    StoreInputKey: function(inputKey) {
        if(this.storeValueInInput)
            this.inputElement.value = inputKey;
        else
            this.storedInputKey = inputKey;
    },
    GetStoredInputKey: function() {
        if(this.storeValueInInput)
            return this.inputElement.value;
        else
            return this.storedInputKey;
    },
    OnClick: function(e) {
        if(this.autoSwitchEnabled) {
            var currentValue = this.GetValue();
            var value = this.stateController.GetNextCheckBoxValue(currentValue, this.allowGrayedByClick && this.allowGrayed);
            this.SetValue(value);
        }
        this.CheckedChanged.FireEvent(this, e);
    },
    OnFocus: function() {
        if(!this.IsFocusLocked()) {
            this.focused = true;
            this.UpdateFocusDecoration();
            this.Focus.FireEvent(this, null);
        } else
            this.UnlockFocus();
    },
    OnLostFocus: function() {
        if(!this.IsFocusLocked()) {
            this.focused = false;
            this.UpdateFocusDecoration();
            this.LostFocus.FireEvent(this, null);
        }
    },
    Refocus: function() {
        if(this.preventFocus) return;
        if(this.focused) {
            this.LockFocus();
            this.inputElement.blur();

            if(ASPx.Browser.MacOSMobilePlatform) {
                window.setTimeout(function() {
                    ASPx.SetFocus(this.inputElement);
                }, 100);
            } else {
                ASPx.SetFocus(this.inputElement);
            }
        }
    },
    LockFocus: function() {
        this.focusLocked = true;
    },
    UnlockFocus: function() {
        this.focusLocked = false;
    },
    IsFocusLocked: function() {
        if(!!ASPx.Attr.GetAttribute(this.mainElement, ASPx.Attr.GetTabIndexAttributeName()))
            return false;
        return this.focusLocked;
    },
    SetValue: function(value, force) {
        var currentValue = this.GetValue();
        if(currentValue !== value || force) {
            var newInputKey = this.stateController.GetInputKeyByValue(value);
            if(newInputKey) {
                this.StoreInputKey(newInputKey);            
                this.stateController.UpdateInternalCheckBoxDecoration(this.mainElement, newInputKey, this.enabled);
            }
        }
        if(this.accessibilityCompliant) {
            var state = this.GetCurrentCheckState();
            var value = this.stateController.GetAriaCheckedValue(state);
            if(this.mainElement.attributes["aria-checked"] !== undefined)
                this.mainElement.setAttribute("aria-checked", value); 
            if(this.mainElement.attributes["aria-selected"] !== undefined)
                this.mainElement.setAttribute("aria-selected", value); 
        }
    },
    GetValue: function() {
        return this.stateController.GetValueByInputKey(this.GetCurrentInputKey());
    },
    GetCurrentCheckState: function() {
        return this.stateController.GetCheckStateByInputKey(this.GetCurrentInputKey());
    },
    GetCurrentInputKey: function() {
        return this.GetStoredInputKey();
    },
    GetChecked: function() {
        return this.GetCurrentInputKey() === CheckBoxInputKey.Checked;
    },
    SetChecked: function(checked) {
        var newValue = this.stateController.GetValueByCheckState(checked ? CheckBoxCheckState.Checked : CheckBoxCheckState.Unchecked);
        this.SetValue(newValue);
    },
    SetEnabled: function(enabled) {
        if(this.enabled != enabled) {
            this.enabled = enabled;
            this.stateController.UpdateInternalCheckBoxDecoration(this.mainElement, this.GetCurrentInputKey(), this.enabled);
            this.ChangeInputElementTabIndex();
        }
    },
    GetEnabled: function() {
        return this.enabled;
    }
});

CheckBoxInternal.GetICBMainElementPostfix = function() {
    return "_D";
};

var CheckBoxInternalCollection = ASPx.CreateClass(CollectionBase, {
    constructor: function(imageProperties, allowGrayed, storeValueInInput, helper, disableCancelBubble, accessibilityCompliant) {
        this.constructor.prototype.constructor.call(this);

        this.stateController = allowGrayed 
            ? CheckableElementStateController.Create(imageProperties, CheckBoxInputKey.Checked, CheckBoxInputKey.Unchecked, CheckBoxInputKey.Indeterminate, true)
            : CheckableElementStateController.Create(imageProperties, CheckBoxInputKey.Checked, CheckBoxInputKey.Unchecked);

        this.helper = helper || CheckableElementHelper.Instance;
        this.storeValueInInput = !!storeValueInInput;
        this.disableCancelBubble = !!disableCancelBubble;
        this.accessibilityCompliant = accessibilityCompliant;
    },
    Add: function(key, inputElement, container) {
        this.Remove(key);
        
        var checkBox = this.CreateInternalCheckBox(key, inputElement, container);
        CollectionBase.prototype.Add.call(this, key, checkBox);
        return checkBox;
    },
    SetImageProperties: function(imageProperties) {
        this.stateController.imageProperties = imageProperties;
    },
    CreateInternalCheckBox: function(key, inputElement, container) {
        return new CheckBoxInternal(inputElement, this.stateController, this.stateController.allowGrayed, false, this.helper, container, 
            this.storeValueInInput, key, this.disableCancelBubble, this.accessibilityCompliant);
    }
});

var FocusedStyleDecoration = ASPx.CreateClass(null, {
    constructor: function(editor) {
        this.editor = editor;
        this.postfixList = [];
        this.styles = {};
        this.innerStyles = {};
    },

    AddPostfix: function(value) {
        this.postfixList.push(value);
    },
    AddStyle: function(key, className, cssText) {
        this.styles[key] = this.CreateRule(className, cssText);
        this.innerStyles[key] = this.CreateRule("", this.FilterInnerCss(cssText));
    },
    CreateRule: function(className, cssText) {
        return ASPx.Str.Trim(className + " " + ASPx.CreateImportantStyleRule(this.GetStyleSheet(), cssText));
    },
    GetStyleSheet: function() {
        return ASPx.GetCurrentStyleSheet();
    },
    FilterInnerCss: function(css) {
        return css.replace(/(border|background-image)[^:]*:[^;]+/gi, "");
    },
    Update: function() {
        for(var i = 0; i < this.postfixList.length; i++) {
            var postfix = this.postfixList[i];
            var inner = postfix.length > 0;
            var element = this.GetElementByPostfix(postfix);
            if(element)
                this.ApplyStyles(element, inner);
        }
    },
    GetElementByPostfix: function(postfix) {
        return ASPx.GetElementById(this.editor.name + postfix);
    },
    ApplyStyles: function(element, inner) {
        this.ApplyFocusedStyle(element, inner);
    },
    ApplyFocusedStyle: function(element, inner) {
        if(this.HasDecoration("F"))
            this.ApplyDecoration("F", element, inner, this.editor.focused);
    },
    HasDecoration: function(key) {
        return !!this.styles[key];
    },
    ApplyDecoration: function(key, element, inner, active) {
        var value = inner ? this.innerStyles[key] : this.styles[key];
        this.RemoveDecoration(element, value);
        if(active) {
            ASPx.AddClassNameToElement(element, value);

            if(ASPx.Browser.IE && ASPx.Browser.Version > 10 && element.border != null) //B251467
                this.EnsureElementBorder(element);
        }
    },
    RemoveDecoration: function(element, value) {
        ASPx.RemoveClassNameFromElement(element, value);
        if(ASPx.Browser.IE && ASPx.Browser.MajorVersion >= 11)
            var dummy = element.offsetWidth; //T113180
    },
    ApplyDecorationCore: function() {

    },
    EnsureElementBorder: function(element) {
        var border = parseInt(element.border) || 0;
        element.border = 1;
        element.border = border;
    }
});

// Inheritance in the bootstrap prevents the transfer of helpers to the appropriate files

var EditorStyleDecoration = ASPx.CreateClass(FocusedStyleDecoration, {
    constructor: function(editor) {
        this.constructor.prototype.constructor.call(this, editor);

        this.lockUpdate = false;
    },

    LockUpdate: function() {
        this.lockUpdate = true;
    },
    UnlockUpdate: function() {
        this.lockUpdate = false;
    },
    IsUpdateLocked: function() {
        return this.lockUpdate;
    },
    Update: function () {
        if(this.IsUpdateLocked())
            return;
        ASPx.FocusedStyleDecoration.prototype.Update.call(this);
    },
    ApplyStyles: function (element, inner) {
        this.ApplyInvalidStyle(element, inner);
        ASPx.FocusedStyleDecoration.prototype.ApplyStyles.call(this, element, inner);
    },
    ApplyInvalidStyle: function (element, inner) {
        if(this.HasDecoration("I")) {
            var isValid = this.editor.GetIsValid();
            this.ApplyDecoration("I", element, inner, !isValid);
        }
    }
});

var TextEditorStyleDecoration = ASPx.CreateClass(EditorStyleDecoration, {
    constructor: function(editor) {
        this.constructor.prototype.constructor.call(this, editor);

        this.nullTextClassName = "";
    },

    ApplyStyles: function(element, inner) {
        ASPx.EditorStyleDecoration.prototype.ApplyStyles.call(this, element, inner);
        this.ApplyNullTextStyle(element, inner);
    },
    ApplyNullTextStyle: function(element, inner) {
        if(!this.HasDecoration("N"))
            return;
        var apply = !this.editor.focused && this.editor.CanApplyNullTextDecoration();
        this.EnsureSpellcheckAttribute(element, apply);
        this.ApplyDecoration("N", element, inner, apply);
    },
    EnsureSpellcheckAttribute: function(element, apply) {
        if(apply)
            ASPx.Attr.ChangeAttribute(element, "spellcheck", "false");
        else
            ASPx.Attr.RestoreAttribute(element, "spellcheck");
    },

    ApplyNullTextClassName: function(active) {
        var nullTextClassName = this.GetNullTextClassName();
        var editorMainElement = this.editor.GetMainElement();
        if(active)
            ASPx.AddClassNameToElement(editorMainElement, nullTextClassName);
        else
            ASPx.RemoveClassNameFromElement(editorMainElement, nullTextClassName);
    },

    GetNullTextClassName: function() {
        if (!this.nullTextClassName)
            this.InitializeNullTextClassName();
        return this.nullTextClassName;
    },

    InitializeNullTextClassName: function() {
        var nullTextStyle = this.styles["N"];
        if (nullTextStyle) {
            var nullTextStyleClassNames = nullTextStyle.split(" ");
            for (var i = 0; i < nullTextStyleClassNames.length; i++)
                if (nullTextStyleClassNames[i].match("dxeNullText"))
                    this.nullTextClassName = nullTextStyleClassNames[i];
        }
    }
});

var TouchUIHelper = {
    isGesture: false,
    isMouseEventFromScrolling: false,
    isNativeScrollingAllowed: true,
    clickSensetivity: 10,
    documentTouchHandlers: {},
    documentEventAttachingAllowed: true,

    msTouchDraggableClassName: "dxMSTouchDraggable",

    touchMouseDownEventName: ASPx.Browser.WebKitTouchUI ? "touchstart" : (ASPx.Browser.Edge && ASPx.Browser.MSTouchUI && window.PointerEvent ? "pointerdown" : "mousedown"),
    touchMouseUpEventName:   ASPx.Browser.WebKitTouchUI ? "touchend"   : (ASPx.Browser.Edge && ASPx.Browser.MSTouchUI && window.PointerEvent ? "pointerup" : "mouseup"),
    touchMouseMoveEventName: ASPx.Browser.WebKitTouchUI ? "touchmove"  : (ASPx.Browser.Edge && ASPx.Browser.MSTouchUI && window.PointerEvent ? "pointermove" : "mousemove"),

    isTouchEvent: function(evt) {
        if(!evt) return false;
        return ASPx.Browser.WebKitTouchUI && ASPx.IsExists(evt.changedTouches); 
    },
    isTouchEventName: function(eventName) {
        return ASPx.Browser.WebKitTouchUI && (eventName.indexOf("touch") > -1 || eventName.indexOf("gesture") > -1);
    },
    getEventX: function(evt) { 
        return ASPx.Browser.IE ? evt.pageX : evt.changedTouches[0].pageX; 
    },
    getEventY: function (evt) { 
        return ASPx.Browser.IE ? evt.pageY :evt.changedTouches[0].pageY; 
    },
    getWebkitMajorVersion: function(){
        if(!this.webkitMajorVersion){
            var regExp = new RegExp("applewebkit/(\\d+)", "i");
            var matches = regExp.exec(ASPx.Browser.UserAgent);
            if(matches && matches.index >= 1)
                this.webkitMajorVersion = matches[1];
        }
        return this.webkitMajorVersion;
    },
    getIsLandscapeOrientation: function(){
        if(ASPx.Browser.MacOSMobilePlatform || ASPx.Browser.AndroidMobilePlatform)
            return Math.abs(window.orientation) == 90;
        return ASPx.GetDocumentClientWidth() > ASPx.GetDocumentClientHeight();
    },
    nativeScrollingSupported: function() {
        var allowedSafariVersion = ASPx.Browser.Version >= 5.1 && ASPx.Browser.Version < 8; //T250059
        var allowedWebKitVersion = this.getWebkitMajorVersion() > 533 && (ASPx.Browser.Chrome || this.getWebkitMajorVersion() < 600);
        return (ASPx.Browser.MacOSMobilePlatform && (allowedSafariVersion || allowedWebKitVersion))
            || (ASPx.Browser.AndroidMobilePlatform && ASPx.Browser.PlaformMajorVersion >= 3) || (ASPx.Browser.MSTouchUI && (!ASPx.Browser.WindowsPhonePlatform || !ASPx.Browser.IE));
    },
    makeScrollableIfRequired: function(element, options) {
        if(ASPx.Browser.WebKitTouchUI && element) {
            var overflow = ASPx.GetCurrentStyle(element).overflow;
            if(element.tagName == "DIV" &&  overflow != "hidden" && overflow != "visible" ){
                return this.MakeScrollable(element);
            }
        }
    },
    preventScrollOnEvent: function(evt){
    },

    handleFastTapIfRequired: function(evt, action, preventCommonClickEvents) {
        if(ASPx.Browser.WebKitTouchUI && evt.type == 'touchstart' && action) {
            this.FastTapHelper.HandleFastTap(evt, action, preventCommonClickEvents);
            return true;
        }
        return false;
    },

    ensureDocumentSizesCorrect: function (){
        return (document.documentElement.clientWidth - document.documentElement.clientHeight) / (screen.width - screen.height) > 0;
    },
    ensureOrientationChanged: function(onOrientationChangedFunction){
        if(ASPxClientUtils.iOSPlatform || this.ensureDocumentSizesCorrect())
            onOrientationChangedFunction();
        else {
            window.setTimeout(function(){
                this.ensureOrientationChanged(onOrientationChangedFunction);
            }.aspxBind(this), 100);
        }
    },

    onEventAttachingToDocument: function(eventName, func){
        if(ASPx.Browser.MacOSMobilePlatform && this.isTouchEventName(eventName)) {
            if(!this.documentTouchHandlers[eventName])
                this.documentTouchHandlers[eventName] = [];
            this.documentTouchHandlers[eventName].push(func);
			return this.documentEventAttachingAllowed;
        }
        return true;
    },
    onEventDettachedFromDocument: function(eventName, func){
        if(ASPx.Browser.MacOSMobilePlatform && this.isTouchEventName(eventName)) {
            var handlers = this.documentTouchHandlers[eventName];
            if(handlers)
                ASPx.Data.ArrayRemove(handlers, func);
        }
    },
    processDocumentTouchEventHandlers: function(proc) {
        var touchEventNames = ["touchstart", "touchend", "touchmove", "gesturestart", "gestureend"];
        for(var i = 0; i < touchEventNames.length; i++) {
            var eventName = touchEventNames[i];
            var handlers = this.documentTouchHandlers[eventName];
            if(handlers) {
                for(var j = 0; j < handlers.length; j++) {
                    proc(eventName,handlers[j]);
                }
            }
        }
    },
    removeDocumentTouchEventHandlers: function() {
        if(ASPx.Browser.MacOSMobilePlatform) {
            this.documentEventAttachingAllowed = false;
            this.processDocumentTouchEventHandlers(ASPx.Evt.DetachEventFromDocumentCore);
        }
    },
    restoreDocumentTouchEventHandlers: function () {
        if(ASPx.Browser.MacOSMobilePlatform) {
            this.documentEventAttachingAllowed = true;
            this.processDocumentTouchEventHandlers(ASPx.Evt.AttachEventToDocumentCore);
        }
    },
    IsNativeScrolling: function() {
        return TouchUIHelper.nativeScrollingSupported() && TouchUIHelper.isNativeScrollingAllowed;
    },
    
    pointerEnabled: !!(window.PointerEvent || window.MSPointerEvent),
    pointerDownEventName: window.PointerEvent ? "pointerdown" : "MSPointerDown",
    pointerUpEventName: window.PointerEvent ? "pointerup" : "MSPointerUp",
    pointerCancelEventName: window.PointerEvent ? "pointercancel" : "MSPointerCancel",
    pointerMoveEventName: window.PointerEvent ? "pointermove" : "MSPointerMove",
	pointerOverEventName: window.PointerEvent ? "pointerover" : "MSPointerOver",
    pointerOutEventName: window.PointerEvent ? "pointerout" : "MSPointerOut",
    pointerType: {
        Touch: (ASPx.Browser.IE && ASPx.Browser.Version == 10) ? 2 : "touch",
        Pen: (ASPx.Browser.IE && ASPx.Browser.Version == 10) ? 3 : "pen",
        Mouse: (ASPx.Browser.IE && ASPx.Browser.Version == 10) ? 4 : "mouse"
    },

    msGestureEnabled: !!(window.PointerEvent || window.MSPointerEvent) && typeof(MSGesture) != "undefined",
    msTouchCreateGesturesWrapper: function(element, onTap){
        if(!TouchUIHelper.msGestureEnabled) 
            return;
        var gesture = new MSGesture();
        gesture.target = element;
        ASPx.Evt.AttachEventToElement(element, TouchUIHelper.pointerDownEventName, function(evt){
            gesture.addPointer(evt.pointerId);
        });
        ASPx.Evt.AttachEventToElement(element, TouchUIHelper.pointerUpEventName, function(evt){
            gesture.stop();
        });
        if(onTap)
            ASPx.Evt.AttachEventToElement(element, "MSGestureTap", onTap);
        return gesture;
    },
    useLongTapHelper: function () {
        return ASPx.Browser.Safari && ASPx.Browser.TouchUI;
    },
    attachLongTapHandler: function(element, handler, onlyBubbling) {
        var timerID = -1;
        var timeout = 1000;
        var event = null;
        var preventClickEvent = false;
        var startX = -1;
        var startY = -1;
        var pixelLimit = 5;

        function onTouchMouseDown(evt) {
            abortWating();
            event = evt;
            startX = evt.pageX;
            startY = evt.pageY;
            preventClickEvent = false;
            timerID = window.setTimeout(onTimeout, timeout);
        }
        function onTouchMouseMove(evt) {
            if (!isUnderTouch())
                return;
            var shiftX = Math.abs(startX - evt.pageX),
                shiftY = Math.abs(startY - evt.pageY),
                maxShift = Math.max(shiftX, shiftY);
            if (maxShift > pixelLimit)
                abortWating();
        }
        function onTouchMouseUp(evt) {
            abortWating();
            if (preventClickEvent) {
                ASPx.Evt.PreventEventAndBubble(evt);
                preventClickEvent = false;
            }
        }
        function onTimeout() {
            handler(event);
            preventClickEvent = true;
            abortWatingInternal();
        }
        function isUnderTouch() {
            return timerID !== -1;
        }
        function abortWating() {
            if (isUnderTouch()) {
                window.clearTimeout(timerID);
                abortWatingInternal();
            }
        }
        function abortWatingInternal() {
            timerID = -1;
            event = null;
        }

        ASPx.Evt.AttachEventToElement(element, TouchUIHelper.touchMouseDownEventName, onTouchMouseDown, onlyBubbling);
        ASPx.Evt.AttachEventToElement(element, TouchUIHelper.touchMouseMoveEventName, onTouchMouseMove, onlyBubbling);
        ASPx.Evt.AttachEventToElement(element, TouchUIHelper.touchMouseUpEventName, onTouchMouseUp, onlyBubbling);
        element.style["-webkit-user-select"] = "none";
        return function () {
            ASPx.Evt.DetachEventFromElement(element, TouchUIHelper.touchMouseDownEventName, onTouchMouseDown);
            ASPx.Evt.DetachEventFromElement(element, TouchUIHelper.touchMouseMoveEventName, onTouchMouseMove);
            ASPx.Evt.DetachEventFromElement(element, TouchUIHelper.touchMouseUpEventName, onTouchMouseUp);
            element.style["-webkit-user-select"] = "";
        };
    }
};

var CacheHelper = {};
CacheHelper.GetCachedValueCore = function(obj, key, func, cacheObj, fillValueMethod) {
    if(!cacheObj)
        cacheObj = obj;
    if(!cacheObj.cache)
        cacheObj.cache = {};
    if(!key) 
        key = "default";
    fillValueMethod(obj, key, func, cacheObj);
    return cacheObj.cache[key];
};
CacheHelper.GetCachedValue = function(obj, key, func, cacheObj) {
    return CacheHelper.GetCachedValueCore(obj, key, func, cacheObj, 
        function(obj, key, func, cacheObj) {
            if(!ASPx.IsExists(cacheObj.cache[key]))
                cacheObj.cache[key] = func.apply(obj, []);
        });
};
CacheHelper.GetCachedElement = function(obj, key, func, cacheObj) {
    return CacheHelper.GetCachedValueCore(obj, key, func, cacheObj, 
        function(obj, key, func, cacheObj) {
            if(!ASPx.IsValidElement(cacheObj.cache[key]))
                cacheObj.cache[key] = func.apply(obj, []);
        });
};
CacheHelper.GetCachedElements = function(obj, key, func, cacheObj) {
    return CacheHelper.GetCachedValueCore(obj, key, func, cacheObj, 
        function(obj, key, func, cacheObj) {
            if(!ASPx.IsValidElements(cacheObj.cache[key])){
                var elements = func.apply(obj, []);
                if(!Ident.IsArray(elements))
                    elements = [elements];
                cacheObj.cache[key] = elements;
            }
        });
};
CacheHelper.GetCachedElementById = function(obj, id, cacheObj) {
    return CacheHelper.GetCachedElement(obj, id, function() { return ASPx.GetElementById(id); }, cacheObj);
};
CacheHelper.GetCachedChildById = function(obj, parent, id, cacheObj) {
    return CacheHelper.GetCachedElement(obj, id, function() { return ASPx.GetChildById(parent, id); }, cacheObj);
};
CacheHelper.DropCachedValue = function(cacheObj, key) {
    cacheObj.cache[key] = null;
};  
CacheHelper.DropCache = function(cacheObj) {
    cacheObj.cache = null;
};  

var DomObserver = ASPx.CreateClass(null, {
    constructor: function() {
        this.items = { };
    },
    subscribe: function(elementID, callbackFunc) {
        var item = this.items[elementID];
        if(item)
            this.unsubscribe(elementID);

        item = {
            elementID: elementID,
            callbackFunc: callbackFunc,
            pauseCount: 0
        };
        this.prepareItem(item);
        this.items[elementID] = item;
    },
    prepareItem: function(item) {
    },
    unsubscribe: function(elementID) {
        this.items[elementID] = null;
    },
    getItemElement: function(item) {
        var element = this.getElementById(item.elementID);
        if(element)
            return element;
        this.unsubscribe(item.elementID);
        return null;
    },
    getElementById: function(elementID) {
        var element = document.getElementById(elementID);
        return element && ASPx.IsValidElement(element) ? element : null;
    },
    pause: function(element, includeSubtree) {
        this.changeItemsState(element, includeSubtree, true);
    },
    resume: function(element, includeSubtree) {
        this.changeItemsState(element, includeSubtree, false);
    },
    forEachItem: function(processFunc, context) {
        context = context || this;
        for(var itemName in this.items) {
            if(!this.items.hasOwnProperty(itemName))
                continue;

            var item = this.items[itemName];
            if(item) {
                var needBreak = processFunc.call(context, item);
                if(needBreak)
                    return;
            }
        }
    },
    changeItemsState: function(element, includeSubtree, pause) {
        this.forEachItem(function(item) {
            if(!element)
                this.changeItemState(item, pause);
            else {
                var itemElement = this.getItemElement(item);
                if(itemElement && (element == itemElement || (includeSubtree && ASPx.GetIsParent(element, itemElement)))) {
                    this.changeItemState(item, pause);
                    if(!includeSubtree)
                        return true;
                }
            }
        }.aspxBind(this));
    },
    changeItemState: function(item, pause) {
        if(pause)
            this.pauseItem(item);
        else
            this.resumeItem(item);
    },
    pauseItem: function(item) {
        item.paused = true;
        item.pauseCount++;
    },
    resumeItem: function(item) {
        if(item.pauseCount > 0) {
            if(item.pauseCount == 1)
                item.paused = false;
            item.pauseCount--;
        }
    }
});

DomObserver.IsMutationObserverAvailable = function() {
    return !!window.MutationObserver;
};

var TimerObserver = ASPx.CreateClass(DomObserver, {
    constructor: function() {
        this.constructor.prototype.constructor.call(this);
        this.timerID = -1;
        this.observationTimeout = 300;
    },
    subscribe: function(elementID, callbackFunc) {
        DomObserver.prototype.subscribe.call(this, elementID, callbackFunc);
        if(!this.isActivated())
            this.startObserving();
    },
    isActivated: function() {
        return this.timerID !== -1;
    },
    startObserving: function() {
        if(this.isActivated())
            window.clearTimeout(this.timerID);
        this.timerID = window.setTimeout(this.onTimeout, this.observationTimeout);
    },
    onTimeout: function() {
        var observer = _aspxGetDomObserver();
        observer.doObserve();
        observer.startObserving();
    },
    doObserve: function() {
        if(!ASPx.documentLoaded) return;
        this.forEachItem(function(item) {
            if(!item.paused)
                this.doObserveForItem(item);
        }.aspxBind(this));
    },
    doObserveForItem: function(item) {
        var element = this.getItemElement(item);
        if(element)
            item.callbackFunc.call(this, element);
    }
});

var MutationObserver = ASPx.CreateClass(DomObserver, {
    constructor: function() {
        this.constructor.prototype.constructor.call(this);
        this.callbackTimeout = 10;
    },
    prepareItem: function(item) {
        item.callbackTimerID = -1;

        var target = this.getElementById(item.elementID);
        if(!target)
            return;

        var observerCallbackFunc = function() {
            if(item.callbackTimerID === -1) {
                var timeoutHander = function() {
                    item.callbackTimerID = -1;
                    item.callbackFunc.call(this, target);
                }.aspxBind(this);
                item.callbackTimerID = window.setTimeout(timeoutHander, this.callbackTimeout);
            }
        }.aspxBind(this);
        var observer = new window.MutationObserver(observerCallbackFunc);
        var config = { attributes: true, childList: true, characterData: true, subtree: true };
        observer.observe(target, config);
            
        item.observer = observer;
        item.config = config;
    },
    unsubscribe: function(elementID) {
        var item = this.items[elementID];
        if(item) {
            item.observer.disconnect();
            item.observer = null;
        }
        DomObserver.prototype.unsubscribe.call(this, elementID);
    },
    pauseItem: function(item) {
        DomObserver.prototype.pauseItem.call(this, item);
        item.observer.disconnect();
    },
    resumeItem: function(item) {
        DomObserver.prototype.resumeItem.call(this, item);
        if(!item.paused) {
            var target = this.getItemElement(item);
            if(target)
                item.observer.observe(target, item.config);
        }
    }
});

var domObserver = null;
function _aspxGetDomObserver() {
    if(domObserver == null)
        domObserver = DomObserver.IsMutationObserverAvailable() ? new MutationObserver() : new TimerObserver();
    return domObserver;
}

var ControlUpdateWatcher = ASPx.CreateClass(null, {
    constructor: function() {
        this.helpers = { };
        this.clearLockerTimerID = -1;
        this.clearLockerTimerDelay = 15;
        this.postProcessing = false;
        this.init();
    },
    init: function() {
        var postHandler = aspxGetPostHandler();
        postHandler.Post.AddHandler(this.OnPost, this);
    },
    Add: function(helper) {
        this.helpers[helper.GetName()] = helper;
    },
    CanSendCallback: function(dxCallbackOwner, arg) {
        this.LockConfirmOnBeforeWindowUnload();

        var modifiedHelpers = this.FilterModifiedHelpersByDXCallbackOwner(this.GetModifiedHelpers(), dxCallbackOwner, arg);
        if(modifiedHelpers.length === 0) return true;
        var modifiedHelpersInfo = this.GetToConfirmAndToResetLists(modifiedHelpers, dxCallbackOwner.name);
        if(!modifiedHelpersInfo) return true;

        if(modifiedHelpersInfo.toConfirm.length === 0) {
            this.ResetClientChanges(modifiedHelpersInfo.toReset);
            return true;
        }

        var helper = modifiedHelpersInfo.toConfirm[0];
        if(!confirm(helper.GetConfirmUpdateText()))
            return false;

        this.ResetClientChanges(modifiedHelpersInfo.toReset);
        return true;
    },
    OnPost: function(s, e) {
        if(this.isDxCallback(e))
            return;

		this.postProcessing = true;
        this.LockConfirmOnBeforeWindowUnload();

        var modifiedHelpersInfo = this.GetModifedHelpersInfo(e);
        if(!modifiedHelpersInfo)
            return;

        if(modifiedHelpersInfo.toConfirm.length === 0) {
            this.ResetClientChanges(modifiedHelpersInfo.toReset);
            return;
        }

        var helper = modifiedHelpersInfo.toConfirm[0];
        if(!confirm(helper.GetConfirmUpdateText())) {
            e.cancel = true;
            this.finishPostProcessing();
        }

        if(!e.cancel)
            this.ResetClientChanges(modifiedHelpersInfo.toReset);
    },
    isDxCallback: function(e) {
        return e.isDXCallback || this.isInternalUploadControlCallback();
    },
    isInternalUploadControlCallback: function() {
        var isInCallback = false;
        for(var key in this.helpers) {
            if(this.helpers.hasOwnProperty(key)) {
                var helper = this.helpers[key];
                isInCallback = isInCallback || helper.isInUploadCallback();
            }
        }
        return isInCallback;
    },
    finishPostProcessing: function() {
        this.postProcessing = false;
    },

    GetModifedHelpersInfo: function(e) {
        var modifiedHelpers = this.FilterModifiedHelpers(this.GetModifiedHelpers(), e);
        if(modifiedHelpers.length === 0) return;

        return this.GetToConfirmAndToResetLists(modifiedHelpers, e && e.ownerID);
    },
    GetToConfirmAndToResetLists: function(modifiedHelpers, ownerID) {
        var resetList = [ ];
        var confirmList = [ ];
        for(var i = 0; i < modifiedHelpers.length; i++) {
            var helper = modifiedHelpers[i];
            if(!helper.GetConfirmUpdateText()) { // ShowConfirmOnLosingChanges
                resetList.push(helper);
                continue;
            }
            if(helper.CanShowConfirm(ownerID)) { // Grid event
                resetList.push(helper);
                confirmList.push(helper);
            }
        }
        return { toConfirm: confirmList, toReset: resetList };
    },

    FilterModifiedHelpers: function(modifiedHelpers, e) {
        if(modifiedHelpers.length === 0)
            return [ ];
        if(this.RequireProcessUpdatePanelCallback(e))
            return this.FilterModifiedHelpersByUpdatePanels(modifiedHelpers);
        if(this.postProcessing)
            return this.FilterModifiedHelpersByPostback(modifiedHelpers);
        return modifiedHelpers;
    },

    FilterModifiedHelpersByDXCallbackOwner: function(modifiedHelpers, dxCallbackOwner, arg) {
        var result = [ ];
        for(var i = 0; i < modifiedHelpers.length; i++) {
            var helper = modifiedHelpers[i];
            if(helper.NeedConfirmOnCallback(dxCallbackOwner, arg))
                result.push(helper);
        }
        return result;
    },

    FilterModifiedHelpersByUpdatePanels: function(modifiedHelpers) {
        var result = [ ];
        var updatePanels = this.GetUpdatePanelsWaitedForUpdate();
        for(var i = 0; i < updatePanels.length; i++) {
            var panelID = updatePanels[i].replace(/\$/g, "_");
            var panel = ASPx.GetElementById(panelID);
            if(!panel) continue;
            for(var j = 0; j < modifiedHelpers.length; j++) {
                var helper = modifiedHelpers[j];
                if(ASPx.GetIsParent(panel, helper.GetControlMainElement()))
                    result.push(helper);
            }
        }
        return result;
    },

    FilterModifiedHelpersByPostback: function(modifiedHelpers) {
        var result = [ ];
        for(var i = 0; i < modifiedHelpers.length; i++) {
            var helper = modifiedHelpers[i];
            if(helper.NeedConfirmOnPostback())
                result.push(helper);
        }
        return result;
    },

    RequireProcessUpdatePanelCallback: function(e) {
        var rManager = this.GetMSRequestManager();
        if(rManager && e && e.isMSAjaxCallback)
            return rManager._postBackSettings.async;
        return false;
    },

    GetUpdatePanelsWaitedForUpdate: function() {
        var rManager = this.GetMSRequestManager();
        if(!rManager) return [ ];
        var panelUniqueIDs = rManager._postBackSettings.panelsToUpdate || [ ];

        var panelClientIDs = [ ];
        for(var i = 0; i < panelUniqueIDs.length; i++) {
            var index = ASPx.Data.ArrayIndexOf(rManager._updatePanelIDs, panelUniqueIDs[i]);
            if(index >= 0)
                panelClientIDs.push(rManager._updatePanelClientIDs[index]);
        }

        return panelClientIDs;
    },

    GetMSRequestManager: function() {
        return ASPx.GetMSAjaxRequestManager();
    },

    GetModifiedHelpers: function() {
        var result = [ ];
        for(var key in this.helpers) { 
            if(this.helpers.hasOwnProperty(key)) {
                var helper = this.helpers[key];
                if(helper.HasChanges())
                    result.push(helper);
            }
        }
        return result;
    },

    ResetClientChanges: function(modifiedHelpers) {
        for(var i = 0; i < modifiedHelpers.length; i++)
            modifiedHelpers[i].ResetClientChanges();
    },

    GetConfirmUpdateMessage: function() {
        if(this.confirmOnWindowUnloadLocked) return;

        var modifiedHelpersInfo = this.GetModifedHelpersInfo();
        if(!modifiedHelpersInfo || modifiedHelpersInfo.toConfirm.length === 0) 
            return;
        var helper = modifiedHelpersInfo.toConfirm[0];
        return helper.GetConfirmUpdateText();
    },

    LockConfirmOnBeforeWindowUnload: function() {
        this.confirmOnWindowUnloadLocked = true;
        this.clearLockerTimerID = ASPx.Timer.ClearTimer(this.clearLockerTimerID);
        this.clearLockerTimerID = window.setTimeout(function() {
            this.confirmOnWindowUnloadLocked = false;
        }.aspxBind(this), this.clearLockerTimerDelay);
    },

    OnWindowBeforeUnload: function(e) {
        var confirmMessage = this.GetConfirmUpdateMessage();
        if(confirmMessage)
            e.returnValue = confirmMessage;
        this.finishPostProcessing();
        return confirmMessage;
    },
    OnWindowUnload: function(e) {
        if(this.confirmOnWindowUnloadLocked) return;
        var modifiedHelpersInfo = this.GetModifedHelpersInfo();
        if(!modifiedHelpersInfo) return;
        this.ResetClientChanges(modifiedHelpersInfo.toReset);
    },
    OnMouseDown: function(e) {
        if(ASPx.Browser.IE)
            this.PreventBeforeUnloadOnLinkClick(e);
    },
    OnFocusIn: function(e) {
        if(ASPx.Browser.IE)
            this.PreventBeforeUnloadOnLinkClick(e);
    },

    PreventBeforeUnloadOnLinkClick: function(e) {
        if(ASPx.GetObjectKeys(this.helpers).length == 0)
            return;
        var link = ASPx.GetParentByTagName(ASPx.Evt.GetEventSource(e), "A");
        if(!link || link.dxgvLinkClickHanlderAssigned)
            return;
        var url = ASPx.Attr.GetAttribute(link, "href");
        if(!url || url.indexOf("javascript:") < 0)
            return;
        ASPx.Evt.AttachEventToElement(link, "click", function(ev) { return ASPx.Evt.PreventEvent(ev); });
        link.dxgvLinkClickHanlderAssigned = true;
    }
});

ControlUpdateWatcher.Instance = null;
ControlUpdateWatcher.getInstance = function () {
    if (!ControlUpdateWatcher.Instance) {
        ControlUpdateWatcher.Instance = new ControlUpdateWatcher();

        ASPx.Evt.AttachEventToElement(window, "beforeunload", function(e) {
            return ControlUpdateWatcher.Instance.OnWindowBeforeUnload(e);
        });
        ASPx.Evt.AttachEventToElement(window, "unload", function(e) {
            ControlUpdateWatcher.Instance.OnWindowUnload(e);
        });
        ASPx.Evt.AttachEventToDocument("mousedown", function(e) {
            ControlUpdateWatcher.Instance.OnMouseDown(e);
        });
        ASPx.Evt.AttachEventToDocument("focusin", function(e) {
            ControlUpdateWatcher.Instance.OnFocusIn(e);
        });
    }
    return ControlUpdateWatcher.Instance;
};

var UpdateWatcherHelper = ASPx.CreateClass(null, {
    constructor: function(owner) {
        this.owner = owner;
        this.ownerWatcher = ControlUpdateWatcher.getInstance();
        this.ownerWatcher.Add(this);
    },
    GetName: function() {
        return this.owner.name;
    },
    GetControlMainElement: function() {
        return this.owner.GetMainElement();
    },
    GetControlParentForm: function(){
        return ASPx.GetParentByTagName(this.GetControlMainElement(), "FORM");
    },
    CanShowConfirm: function(requestOwnerID) {
        return true;
    },
    HasChanges: function() {
        return false;
    },
    GetConfirmUpdateText: function() {
        return "";
    },
    NeedConfirmOnCallback: function(dxCallbackOwner) {
        return true;
    },
    NeedConfirmOnPostback: function() {
        if(ASPx.IsUploadSubmitRequest)
            return !ASPx.IsUploadSubmitRequest(this.GetControlParentForm());
        return true;
    },
    ResetClientChanges: function() {
    },
    ConfirmOnCustomControlEvent: function() {
        var confirmMessage = this.GetConfirmUpdateText();
        if(confirmMessage)
            return confirm(confirmMessage);
        return false;
    },
    isInUploadCallback: function() {
        return false;
    }
});

var ControlTabIndexManager = ASPx.CreateClass(null, {
    constructor: function() {
        this.elementsWithChangedTabIndex = {};
    },

    getChangedElementsForControlId: function(id) {
        if(!this.elementsWithChangedTabIndex[id])
            this.elementsWithChangedTabIndex[id] = [];
        return this.elementsWithChangedTabIndex[id];
    },

    isElementWithChangedIndex: function(element) {
        for(var key in this.elementsWithChangedTabIndex)
            if(this.elementsWithChangedTabIndex.hasOwnProperty(key))
                if(this.elementsWithChangedTabIndex[key].indexOf(element) !== -1)
                    return true;
        return false;
    },

    changeTabIndexAttribute: function(element, id) {
        var elements = this.getChangedElementsForControlId(id);
        ASPx.Attr.ChangeTabIndexAttribute(element);
        if(elements.indexOf(element) === -1)
            elements.push(element);
    },

    restoreTabIndexAttribute: function(element, id) {
        var elements = this.getChangedElementsForControlId(id),
            index = elements.indexOf(element);
        if(index !== -1) {
            elements.splice(index, 1);
            if(!this.isElementWithChangedIndex(element))
                ASPx.Attr.RestoreTabIndexAttribute(element);
        }
    }
});

ControlTabIndexManager.Instance = null;
ControlTabIndexManager.getInstance = function() {
    if(!ControlTabIndexManager.Instance)
        ControlTabIndexManager.Instance = new ControlTabIndexManager();
    return ControlTabIndexManager.Instance;
};

var ControlCallbackHandlersQueue = ASPx.CreateClass(null, {
    constructor: function (owner) {
        this.owner = owner;
        this.handlerInfos = [];
    },
    addCallbackHandler: function(handlerInfo) {
        this.handlerInfos.push(handlerInfo);
    },
    executeCallbacksHandlers: function() {
        for(var i = 0, handlerInfo; handlerInfo = this.handlerInfos[i]; i++)
            handlerInfo.handler.call(this.owner, handlerInfo.result);
        this.handlerInfos = [];
    }
});

var ControlCallbackQueueHelper = ASPx.CreateClass(null, {
    constructor: function (owner) {
        this.owner = owner;
        this.pendingCallbacks = [];
        this.receivedCallbacks = [];
        this.attachEvents();
    },
    showLoadingElements: function () {
        this.owner.ShowLoadingDiv();
        if (this.owner.IsCallbackAnimationEnabled())
            this.owner.StartBeginCallbackAnimation();
        else
            this.owner.ShowLoadingElementsInternal();
    },
    attachEvents: function () {
        this.owner.EndCallback.AddHandler(this.onEndCallback.aspxBind(this));
        this.owner.CallbackError.AddHandler(this.onCallbackError.aspxBind(this));
    },
    detachEvents: function () {
        this.owner.EndCallback.RemoveHandler(this.onEndCallback);
        this.owner.CallbackError.RemoveHandler(this.onCallbackError);
    },
    onCallbackError: function (owner, result) {
        this.sendErrorToChildControl(result);
    },
    ignoreDuplicates: function () {
        return true;
    },
    hasDuplicate: function (arg) {
        for (var i in this.pendingCallbacks) {
            if (this.pendingCallbacks[i].arg == arg && this.pendingCallbacks[i].state != ASPx.callbackState.aborted)
                return true;
        }
        return false;
    },
    getToken: function (halperContext, callbackInfo) {
        return {
            cancel: function () {
                if (callbackInfo.state == ASPx.callbackState.sent) {
                    callbackInfo.state = ASPx.callbackState.aborted;
                    halperContext.sendNext();
                }
                if (callbackInfo.state == ASPx.callbackState.inTurn)
                    ASPx.Data.ArrayRemove(halperContext.pendingCallbacks, callbackInfo);
            },
            callbackId: -1
        };
    },
    sendCallback: function (arg, handlerContext, handler, commandName, onBeforeSend) {
        if (this.ignoreDuplicates() && this.hasDuplicate(arg))
            return false;
        var handlerContext = handlerContext || this.owner;
        var callbackInfo = {
            arg: arg,
            handlerContext: handlerContext,
            handler: handler || handlerContext.OnCallback,
            state: ASPx.callbackState.inTurn,
            callbackId: -1,
            onBeforeSend: onBeforeSend
        };
        this.pendingCallbacks.push(callbackInfo);
        if (!this.hasActiveCallback()) {
            this.createCallbackByCallbackInfo(callbackInfo, commandName);
        }
        return this.getToken(this, callbackInfo);
    },
    hasActiveCallback: function () {
        return this.getCallbacksInfoByState(ASPx.callbackState.sent).length > 0;
    },
    sendNext: function () {
        var nextCallbackInfo = this.getCallbacksInfoByState(ASPx.callbackState.inTurn)[0];
        if (nextCallbackInfo) {
            this.createCallbackByCallbackInfo(nextCallbackInfo);
            return nextCallbackInfo.callbackId;
        }
    },
    createCallbackByCallbackInfo: function(callbackInfo, commandName) {
        if(callbackInfo.onBeforeSend)
            callbackInfo.onBeforeSend();
        callbackInfo.callbackId = this.owner.CreateCallback(callbackInfo.arg, commandName);
        callbackInfo.state = ASPx.callbackState.sent;
    },
    onEndCallback: function () {
        if (!this.owner.isErrorOnCallback && this.hasPendingCallbacks()) {
            var curCallbackId;
            var curCallbackInfo;
            var handlerContext;

            for (var i in this.receivedCallbacks) {
                if(this.receivedCallbacks.hasOwnProperty(i)) {
                    curCallbackId = this.receivedCallbacks[i];
                    curCallbackInfo = this.getCallbackInfoById(curCallbackId);
                    if (curCallbackInfo.state != ASPx.callbackState.aborted) {
                        handlerContext = curCallbackInfo.handlerContext;
                        if (handlerContext.OnEndCallback)
                            handlerContext.OnEndCallback();
                        this.sendNext();
                    }
                    ASPx.Data.ArrayRemove(this.pendingCallbacks, curCallbackInfo);
                }
            }
            ASPx.Data.ArrayClear(this.receivedCallbacks);
        }
    },
    hasPendingCallbacks: function () {
        return this.pendingCallbacks && this.pendingCallbacks.length && this.pendingCallbacks.length > 0;
    },
    processCallback: function (result, callbackId) {
        this.receivedCallbacks.push(callbackId);
        if (this.hasPendingCallbacks()) {
            var callbackInfo = this.getCallbackInfoById(callbackId);
            if (callbackInfo.state != ASPx.callbackState.aborted)
                callbackInfo.handler.call(callbackInfo.handlerContext, result);
        }
    },
    getCallbackInfoById: function (id) {
        for (var i in this.pendingCallbacks) {
            if (this.pendingCallbacks[i].callbackId == id)
                return this.pendingCallbacks[i];
        }
    },
    getCallbacksInfoByState: function (state) {
        var result = [];
        for (var i in this.pendingCallbacks) {
            if (this.pendingCallbacks[i].state == state)
                result.push(this.pendingCallbacks[i]);
        }
        return result;
    },
    sendErrorToChildControl: function (callbackObj) {
        if (!this.hasPendingCallbacks())
            return;

        var callbackInfo = this.getCallbackInfoById(callbackObj.callbackId || 0);
        if (!callbackInfo)
            return;

        var hasChildControlHandler = (callbackInfo.handlerContext != this.owner) && callbackInfo.handlerContext.OnCallbackError;
        if (hasChildControlHandler)
            callbackInfo.handlerContext.OnCallbackError.call(callbackInfo.handlerContext, callbackObj.message, callbackObj.data);
    }
});

var AccessibilityHelperBase = ASPx.CreateClass(null, {
    constructor: function(control) {
        this.control = control;
        this.timerID = -1;
        this.pronounceMessageTimeout = 500;

        this.activeItem = this.getItems()[0];
        this.pronounceIsStarted = false;
    },

    PronounceMessage: function(text, activeItemArgs, inactiveItemArgs, mainElementArgs, ownerMainElement) {   
        this.timerID = ASPx.Timer.ClearTimer(this.timerID);
        this.pronounceIsStarted = true;
        this.timerID = window.setTimeout(function() {
            this.PronounceMessageCore(text, activeItemArgs, inactiveItemArgs, mainElementArgs, ownerMainElement);
        }.aspxBind(this), this.getPronounceTimeout());
    },
    PronounceMessageCore: function(text, activeItemArgs, inactiveItemArgs, mainElementArgs, ownerMainElement) {
        if(!this.getItems())
            return;
        this.toogleItem();

        var mainElement = this.getMainElement();
        var activeItem = this.getItem(true);
        var inactiveItem = this.getItem();

        if(ASPx.Attr.GetAttribute(mainElement, "role") != "application")
            mainElementArgs = this.addArguments(mainElementArgs, { "aria-activedescendant" : activeItem.id });
        
        var messageAttrObj = {};
        var activeItemRole = ASPx.Attr.GetAttribute(activeItem, "role");
        var attrName = activeItemRole == "combobox" ? "aria-label" : "innerHtml";
        messageAttrObj[attrName] = ASPx.Str.EncodeHtml(text);
        activeItemArgs = this.addArguments(activeItemArgs, messageAttrObj);
        messageAttrObj[attrName] = "";
        inactiveItemArgs = this.addArguments(inactiveItemArgs, messageAttrObj);
        
        var errorTextElement = null;
        if(this.control.GetErrorCell()) {
            errorTextElement = this.getAriaExplanatoryTextManager().GetErrorTextElement();
            activeItemArgs = this.addArguments(activeItemArgs,      {"aria-invalid"  : !this.control.isValid ? "true" : "" });
            mainElementArgs = this.addArguments(mainElementArgs,    { "aria-invalid" : "" });
            inactiveItemArgs = this.addArguments(inactiveItemArgs,  { "aria-invalid" : "" });
        }

        this.changeActivityAttributes(activeItem, activeItemArgs);
        if(errorTextElement) {
            this.getAriaExplanatoryTextManager().SetOrRemoveText([activeItem], errorTextElement, !this.control.isValid, false, true);
            this.getAriaExplanatoryTextManager().SetOrRemoveText([mainElement, inactiveItem], errorTextElement, false, false, false);
        }
        this.changeActivityAttributes(mainElement, mainElementArgs);

        if(!!ownerMainElement && ASPx.Attr.GetAttribute(ownerMainElement, "role") != "application")
            this.changeActivityAttributes(ownerMainElement, { "aria-activedescendant": activeItem.id });
        this.changeActivityAttributes(inactiveItem, inactiveItemArgs);
        this.pronounceIsStarted = false;
    },

    GetActiveElement: function(inputIsMainElement) {
        if(this.pronounceIsStarted) return null;
        var mainElement = inputIsMainElement ? this.control.GetInputElement() : this.getMainElement();
        var activeElementId = ASPx.Attr.GetAttribute(mainElement, 'aria-activedescendant');
        return activeElementId ? ASPx.GetElementById(activeElementId) : mainElement;
    },

    getMainElement: function() {
        if(!ASPx.IsExistsElement(this.mainElement))
            this.mainElement = this.control.GetAccessibilityAssistantElement();
        return this.mainElement;
    },
    getItems: function() {
        if(!ASPx.IsExistsElement(this.items))
            this.items = ASPx.GetChildElementNodes(this.getMainElement());
        return this.items;
    },
    getItem: function(isActive) {
        if(isActive)
            return this.activeItem;
        var items = this.getItems();
        return items[0] === this.activeItem ? items[1] : items[0];
    },
    getAriaExplanatoryTextManager: function() { return this.control.ariaExplanatoryTextManager; },
    getPronounceTimeout: function() { return this.pronounceMessageTimeout; },
    toogleItem: function() {
        this.activeItem = this.getItem();
    },
    addArguments: function(targetArgs, newArgs) {
        if(!targetArgs) targetArgs = { };
        for(var key in newArgs) {
            if(newArgs.hasOwnProperty(key) && !targetArgs.hasOwnProperty(key))
                targetArgs[key] = newArgs[key];
        }
        return targetArgs;
    },
    changeActivityAttributes: function(element, args) {
        if(!element)
            return;
        for(var key in args) {
            if(args.hasOwnProperty(key)) {
                var value = args[key];
                if(key == "innerHtml")
                    ASPx.SetInnerHtml(element, value);
                else {
                    var action = value !== "" ? ASPx.Attr.SetAttribute : ASPx.Attr.RemoveAttribute;
                    action(element, key, value);
                }
            }
        }
    }
});

var AccessibilityPronouncer = ASPx.CreateClass(null, {
    constructor: function() {
        this.pronouncerId = "dxPronouncer";

        this.initialized = false;
        this.focusableMessageElement = null;
        this.messageElement = null;

        this.pronouncers = {
            live: new AccessibilityLivePronouncer(this),
            descendant: new AccessibilityDescendantPronouncer(this)
        };
    },
    Pronounce: function(args, type) {
        this.pronouncers[type].Pronounce(args);
    },
    EnsureInitialize: function() {
        if(!this.initialized)
            this.initialize();
    },
    RemoveState: function() {
        for(var pronouncer in this.pronouncers)
            if(this.pronouncers.hasOwnProperty(pronouncer))
                pronouncer.RemoveState();
    },
    RestoreControlState: function(type, mainElement) {
        this.pronouncers[type].RestoreControlState(mainElement);
    },
    RestoreElementsState: function(type, elements) {
        this.pronouncers[type].RestoreElementsState(elements);
    },
    RestoreElementState: function(type, element) {
        this.pronouncers[type].RestoreElementState(element);
    },

    initialize: function() {
        this.createFocusableMessageElement();
        this.createMessageElement();

        this.prepareFocusableMessageElement();
        this.setAttributesForKeyboardNavigation();
        this.initialized = true;
    },
    createFocusableMessageElement: function() {
        var focusableMessageElement = document.createElement("DIV");
        document.body.appendChild(focusableMessageElement);
        this.focusableMessageElement = focusableMessageElement;   
    },
    prepareFocusableMessageElement: function() {
        this.focusableMessageElement.className = "dxAIFME";
    },
    setAttributesForKeyboardNavigation: function() {
        ASPx.Attr.Aria.SetApplicationRole(this.focusableMessageElement);
        ASPx.Attr.Aria.SetSilence(this.focusableMessageElement);
    },
    createMessageElement: function() {
        var messageElement = document.createElement("DIV");
        messageElement.id = this.pronouncerId;
        ASPx.Attr.SetAttribute(messageElement, "role", "note");

        this.focusableMessageElement.appendChild(messageElement);
        this.messageElement = messageElement;
    },
    getMessage: function(messagePartsArg) {
        var messageParts = messagePartsArg.filter(function(x) { return ASPx.IsExists(x); });
        return messageParts.join(", ");
    }
});

var AccessibilityPronouncerBase = ASPx.CreateClass(null, {
    constructor: function() {
        this.state = { };
    },
    Pronounce: function(args) {
        var messageElement = this.getMessageElement();
        ASPx.Attr.Aria.SetOrRemoveLabel(messageElement);
        ASPx.SetInnerHtml(messageElement, "");
        this.PronounceCore(args);
    },
    PronounceCore: function(args) { },
    SaveElementState: function(element) { 
        if(this.state[element.id])
            return;

        this.state[element.id] = {
            element: element,
            descendant: ASPx.Attr.GetAttribute(element, ASPx.Attr.Aria.descendant)
        };
    },
    RemoveState: function() {
        this.state = { };
    },
    RestoreControlState: function(mainElement) { 
        for(var elementInfo in this.state) {
            if(this.state.hasOwnProperty(elementInfo)) {
                var element = this.state[elementInfo].element;
                if(!mainElement || ASPx.GetIsParent(mainElement, element))
                    this.RestoreElementState(element);
            }
        }
    },
    RestoreElementsState: function(elements) { 
        for(var i = 0; i < elements.length; i++)
            this.RestoreElementState(elements[i]);
    },
    RestoreElementState: function(element) {
        var elementState = this.state[element.id];
        if(!elementState)
            return;

        ASPx.Attr.Aria.SetOrRemoveDescendant(element, elementState.descendant);
        delete this.state[element.id];
    },
    getMessage: function(args) {
        return ASPx.AccessibilityPronouncer.getMessage(args.messageParts);
    },
    getMessageElement: function() {
        return ASPx.AccessibilityPronouncer.messageElement;
    },
    getFocusableMessageElement: function() {
         return ASPx.AccessibilityPronouncer.focusableMessageElement;
    }
});
var AccessibilityLivePronouncer = ASPx.CreateClass(AccessibilityPronouncerBase, {
    constructor: function() {
        this.constructor.prototype.constructor.call(this);
    },
    PronounceCore: function(args) {
        var message = this.getMessage(args);
        var messageElement = this.getMessageElement();
        ASPx.Attr.SetAttribute(this.getFocusableMessageElement(), "aria-live", "assertive");
        ASPx.Attr.Aria.SetAtomic(this.getFocusableMessageElement(), "true");

        ASPx.SetInnerHtml(messageElement, ASPx.Str.EncodeHtml(message));
    }
});
var AccessibilityDescendantPronouncer = ASPx.CreateClass(AccessibilityPronouncerBase, {
    constructor: function() {
        this.constructor.prototype.constructor.call(this);
    },
    PronounceCore: function(args) {
        var message = this.getMessage(args);
        var activeElement = ASPx.GetActiveElement();
        var messageElement = this.getMessageElement();
        
        this.SaveElementState(activeElement);
        ASPx.Attr.RemoveAttribute(this.getFocusableMessageElement(), "aria-live");
        ASPx.Attr.RemoveAttribute(this.getFocusableMessageElement(), "aria-atomic");
        ASPx.Attr.Aria.SetOrRemoveLabel(messageElement, message);
        ASPx.Attr.Aria.SetOrRemoveDescendant(activeElement, messageElement.id);
    }
});
ASPx.AccessibilityPronouncerType = {
    live: "live",
    descendant: "descendant"
};
ASPx.AccessibilityPronouncer = new AccessibilityPronouncer();

var RestoreFocusHelper = ASPx.CreateClass(null, {
    constructor: function() {
        this.excludedIDs = [ "DXCBtn" ]; // command button id is autogenerated
        this.pronouncerType = ASPx.AccessibilityPronouncerType.live;
        this.callbackQueue = [];
        this.Initialize();
    },
    Initialize: function() {
        var that = this;
        ASPx.attachToLoad(function() {
            ASPxClientControl.GetControlCollection().BeginCallback.AddHandler(that.OnBeginCallback, that);
            ASPxClientControl.GetControlCollection().EndCallback.AddHandler(that.OnEndCallback, that);
        });
    },
    OnBeginCallback: function(s, e) {
        var control = e.control;
        if(!control.allowRestoreFocusOnCallbacks())
            return;
        
        control.accessibilityFocusTreeLine = this.getFocusTreeLine(control);
        var controlHasCallbackTreeLine = this.callbackQueueContainsTreeLine(control);
        this.pushTreeLineInfoIntoCallbackQueue(control);
        if(control.accessibilityFocusTreeLine && !controlHasCallbackTreeLine)
            control.SendMessageToAssistiveTechnology(this.getDefaultCallbackMessage());
    },
    OnEndCallback: function(s, e) {
        var control = e.control;
        if(!control.allowRestoreFocusOnCallbacks())
            return;
      
        var treeLineInfo = this.shiftTreeLineInfoFromCallbackQueue(control);
        if(treeLineInfo.queueLength == 0) {
            if(!control.accessibilityFocusTreeLine && treeLineInfo.treeLine)
                control.accessibilityFocusTreeLine = treeLineInfo.treeLine;

            var focusElement = this.findFocusElement(control);
            if(!this.isFocusManagedByActivePopupWindow(focusElement))
                ASPx.AccessibilityUtils.SetFocusAccessible(focusElement);
            delete control.accessibilityFocusTreeLine;
        }
    },
    pushTreeLineInfoIntoCallbackQueue: function(control) {
        var controlTreeLine = control.accessibilityFocusTreeLine ? control.accessibilityFocusTreeLine.slice(0) : null;
        if(!this.callbackQueue[control.name])
            this.callbackQueue[control.name] = [];
        this.callbackQueue[control.name].push(controlTreeLine);
    },
    shiftTreeLineInfoFromCallbackQueue: function(control) {
        var treeLineInfo = { queueLength: 0, treeLine: null };
        var treeLines = this.callbackQueue[control.name];
        if(treeLines && treeLines.length > 0) {
            treeLineInfo.treeLine = treeLines.shift();
            var linesCount = treeLines.length;
            treeLineInfo.queueLength = linesCount;
            if(linesCount > 0 && !treeLines[0] && treeLineInfo.treeLine)
                treeLines[0] = treeLineInfo.treeLine.slice(0);
        }
        return treeLineInfo;
    },
    callbackQueueContainsTreeLine: function(control) {
        var treeLines = this.callbackQueue[control.name];
        if(!treeLines || treeLines.length == 0) 
            return false;
        if(treeLines[treeLines.length - 1])
            return true;
        return false;
    },
    getDefaultCallbackMessage: function() {
        return ASPx.AccessibilitySR.DefaultCallbackMessage;
    },
    isFocusManagedByActivePopupWindow: function(focusElement) {
        var popupControl = this.getActivePopupControl();
        if(!popupControl || popupControl.accessibleFocusElement)
            return false;

        this.initializePopupAccessibleFocusElement(popupControl, focusElement);
        return popupControl.setFocusOnCallback;
    },
    getActivePopupControl: function() {
        var activePopupWindow = ASPx.GetPopupControlCollection && ASPx.GetPopupControlCollection().GetCurrentActiveWindowElement();
        if(!activePopupWindow)
            return null;

        var popupInfo = ASPx.GetPopupControlCollection().GetPopupWindowFromID(activePopupWindow.id);
        return popupInfo.popupControl;
    },
    initializePopupAccessibleFocusElement: function(popupControl, focusElement) {
        if(popupControl.setFocusOnCallback)
            popupControl.accessibleFocusElement = focusElement;
        else {
            var parentControl = popupControl.GetParentControl();
            if(parentControl && parentControl.GetMainElement())
                popupControl.accessibleFocusElement = ASPx.FindFirstChildActionElement(parentControl.GetMainElement());
        }
    },
    getFocusTreeLine: function(control) {
        var element = ASPx.GetActiveElement();
        if(!ASPx.IsExistsElement(element))
            return null;
        var mainElement = control.GetMainElement();
        if(!ASPx.GetIsParent(mainElement, element)) {
            var treeInfo = this.findFocusedControlElement(mainElement, element);
            element = treeInfo.focusElement;
            mainElement = treeInfo.rootElement;
        }
        return this.getTreeLineCore(mainElement, element);
    },
    getTreeLineCore: function(mainElement, element) {
        if(!element) return null;
        
        treeLine = [ ];
        while(element) {
            treeLine.push({ 
                id: element.id,
                tagName: element.tagName,
                index: ASPx.Data.ArrayIndexOf(element.parentNode.childNodes, element)
            });
            if(element === mainElement || element === document.body)
                break;
            element = element.parentNode;
        }
        return treeLine;
    },
    findFocusedControlElement: function(mainElement, activeElement) {
        var element = null;
        var parentElement = mainElement;
        var focusedEditor = ASPx.IsExists(ASPx.GetFocusedEditor) ? ASPx.GetFocusedEditor() : null;
        if(focusedEditor && ASPx.GetIsParent(mainElement, focusedEditor.GetMainElement()))
            element = focusedEditor.GetFocusableInputElement();
        else {
            if(mainElement && activeElement) {
                var mainControl = ASPx.GetClientControlByElementID(mainElement.id);
                var parentControls = ASPx.GetParentClientControls(activeElement.id);
                for(var i = parentControls.length - 1; i > -1; i--) {   
                    if(mainControl.name == parentControls[i].name) {
                        element = activeElement;
                        var rootIndex = i > 0 ? i - 1 : i;
                        parentElement = parentControls[rootIndex].GetMainElement();
                        if(!parentElement && parentControls[rootIndex].GetCurrentWindowElement)
                            parentElement = parentControls[rootIndex].GetCurrentWindowElement();
                        break;
                    }
                }
            }
        }
        return { focusElement: element, rootElement: parentElement };    
    },
    findFocusElement: function(control) {
        if(!control.accessibilityFocusTreeLine)
            return;

        var treeLine = control.accessibilityFocusTreeLine.slice(0);
        var focusElementParent = this.findFocusElementParentById(treeLine);
        if(!focusElementParent) 
            return;

        return this.findFocusElementFromDOMTree(treeLine, focusElementParent);
    },
    findFocusElementParentById: function(treeLine) {
        for(var i = 0; i < treeLine.length; i++) {
            var id = treeLine[i].id;
            if(!this.isValidId(id))
                continue;
            var element = document.getElementById(id);
            if(element) {
                // get first part of tree line and reverse it
                treeLine.splice(i, treeLine.length - i);
                treeLine.reverse();
                return element;
            }
        }
        return null;
    },
    findFocusElementFromDOMTree: function(treeLine, focusElementParent) {
        var element = focusElementParent;
        for(var i = 0; i < treeLine.length; i++) {
            var info = treeLine[i];

            if(info.index >= element.childNodes.length) {
                element = element.childNodes.length > 0 ? element.childNodes[element.childNodes.length - 1] : null;
                return this.findNeighbourFocusElement(element, focusElementParent);
            }

            var child = element.childNodes[info.index];
            if(child.tagName !== info.tagName)
                return this.findNeighbourFocusElement(child, focusElementParent);

            element = child;
        }
        return element;
    },
    findNeighbourFocusElement: function(element, focusElementParent) {
        if(!element || !element.parentNode) return null;

        var neighbours = element.parentNode.childNodes;
        var indices = this.calcLeftRightIndices(ASPx.Data.ArrayIndexOf(neighbours, element), neighbours.length);

        for(var i = 0; i < indices.length; i++) {
            var index = indices[i];
            var actionElement = ASPx.FindFirstChildActionElement(neighbours[index]);
            if(actionElement)
                return actionElement;
        }

        if(element === focusElementParent)
            return null;
        return this.findNeighbourFocusElement(element.parentNode, focusElementParent);
    },
    calcLeftRightIndices: function(startIndex, count) {
        var indices = [ ];
        var incSides = [ 0, 0 ];
        var index = startIndex;

        for(var i = 0; i < count; i++) {
            indices.push(index);

            var even = i % 2 === 0;
            var nextIndex = this.calcNextIndex(startIndex, count, incSides, even);
            if(nextIndex < 0)
                nextIndex = this.calcNextIndex(startIndex, count, incSides, !even);
            
            index = nextIndex;
        }
        return indices;
    },
    calcNextIndex: function(startIndex, count, incSides, even) {
        var sideIndex = even ? 0 : 1;
        var inc = incSides[sideIndex];
        inc += even ? -1 : 1;

        var nextIndex = startIndex + inc;
        if(nextIndex >= 0 && nextIndex < count) {
            incSides[sideIndex] = inc;
            return nextIndex;
        }
        return -1;
    },
    isValidId: function(id) {
        return id && !this.isExcludedId(id);
    },
    isExcludedId: function(id) {
        var result = false;
        for(var i = 0; i < this.excludedIDs.length; i++) {
            if(id.indexOf(this.excludedIDs[i]) > -1) {
                result = true;
                break;
            }
        }
        return result;
    }
});

var EventStorage = ASPx.CreateClass(null, {
    constructor: function() {
        this.bag = { };
    },
    Save: function(e, data, overwrite) {
        var key = this.getEventKey(e);
        if(this.bag.hasOwnProperty(key) && !overwrite)
            return;
        this.bag[key] = data;
        window.setTimeout(function() { delete this.bag[key]; }.aspxBind(this), 100);
    },
    Load: function(e) {
        var key = this.getEventKey(e);
        return this.bag[key];
    },
    getEventKey: function(e) {
        if(ASPx.IsExists(e.timeStamp))
            return e.timeStamp.toString();
        var eventSource = ASPx.Evt.GetEventSource(e);
        var type = e.type.toString();
        return eventSource ? type + "_" + eventSource.uniqueID.toString() : type;
    }
});
ASPx.RestoreFocusHelper = new RestoreFocusHelper();

EventStorage.Instance = null;
EventStorage.getInstance = function() {
    if(!EventStorage.Instance)
        EventStorage.Instance = new EventStorage();
    return EventStorage.Instance;
};
var GetGlobalObject = function(objectName) {
    var fields = objectName.split('.');
    var obj = window[fields[0]];
    for(var i = 1; obj && i < fields.length; i++) {
        obj = obj[fields[i]];
    }
    return obj;
};
var GetExternalScriptProcessor = function() {
    return ASPx.ExternalScriptProcessor ? ASPx.ExternalScriptProcessor.getInstance() : null;
};

var SAVED_WIDTH_ATTR = "data-dx-ripple-saved-width";
var RIPPLE_FIXED_ROW_ATTR = "data-dx-ripple-locked";
var READ_ONLY_COMBOBOX_MARKER_CSS_CLASS = "dxICBReadonlyMarker";
var ThemesWithRipple = ['Material'];
var RippleHelper = {
    rippleTargetClassName: "dxRippleTarget",
    rippleTargetExternalClassName: "dxRippleTargetExternal",
    rippleContainerClassName: "dxRippleContainer",
    rippleClassName: "dxRipple",
    touchRadius: -1,
    isMobileExternalRipple: null,
    zoom: 1,

    Init: function() {
        if(this.getIsRippleFunctionalityEnabled()) {
            setTimeout(function() {
                this.calcTouchRadius();
            }.aspxBind(this), 0);
        }
    },
    calcTouchRadius: function() {
        var testBlock = document.createElement("DIV");
        ASPx.SetStyles(testBlock, {
            height: "1in",
            width: "1in",
            left: "-100%",
            top: "-100%",
            position: "absolute"
        });
        document.body.appendChild(testBlock);
        this.touchRadius = (1.8 / 2.54) * Math.max(testBlock.offsetWidth, testBlock.offsetHeight);
        document.body.removeChild(testBlock);
    },
    isRippleFunctionalityEnabled: null,
    checkRippleFunctionality: function() {
        if(ASPx.Browser.Safari && ASPx.Browser.Version <= 5.1)
            return false;
        for(var i = 0; i < ThemesWithRipple.length; i++) {
            var firstRippleThemeElement = document.querySelector("[class*='_" + ThemesWithRipple[i] + "']");
            if(firstRippleThemeElement)
                return true;
        }  
        return false;
    },
    ReInit: function() {
        this.isRippleFunctionalityEnabled = null;
        this.Init();
    },

    onDocumentMouseDown: function(evt) {
        if(RippleHelper.getIsRippleFunctionalityEnabled())
            RippleHelper.processMouseDown(evt);
    },
    getIsRippleFunctionalityEnabled: function() {
        if(!ASPx.IsExists(this.isRippleFunctionalityEnabled))
            this.isRippleFunctionalityEnabled = this.checkRippleFunctionality();
        return this.isRippleFunctionalityEnabled;
    },

   createTargetInfo: function(target) {
        return { 
            x: ASPx.GetAbsoluteX(target),
            y: ASPx.GetAbsoluteY(target),
            width: target.offsetWidth,
            height: target.offsetHeight,
            classNames: ASPx.GetClassNameList(target),

            getTarget: function() { return target; },
            getRect: function() { return {x: this.x, y: this.y, width: this.width, height: this.height }; }
        };
    },
    createEventInfo: function(evt) {
        return { x: this.getEventX(evt), y: this.getEventY(evt) };
    },
    processMouseDown: function(evt) {
        var evtSource = ASPx.Evt.GetEventSource(evt);
        var rippleTarget = this.getRippleTargetElement(evtSource);
        if(this.needToProcessRipple(rippleTarget, evtSource))
            this.processRipple(this.createTargetInfo(rippleTarget), this.createEventInfo(evt));
    },
    getRippleTargetElement: function(evtSource) {
        if(this.hasRippleMarker(evtSource))
            return evtSource;

        if(evtSource.tagName && evtSource.tagName.toLowerCase() == "input" && ASPx.ElementContainsCssClass(evtSource, "dxTI")) {
            var elements = ASPx.GetChildElementNodesByPredicate(evtSource.parentNode.parentNode, function(element) {
                return this.hasRippleMarker(element);
            }.aspxBind(this));
            return elements && elements[0];
        }

        return ASPx.GetParent(evtSource, function(element) {
            return this.hasRippleMarker(element);
        }.aspxBind(this));
    },
    hasRippleMarker: function(element) {
        if(!ASPx.IsExistsElement(element))
            return false;
        var computedStyles = window.getComputedStyle(element, ":before");
        if(ASPx.IsExists(computedStyles)) {
            var content = computedStyles.getPropertyValue("content");
            if(content.indexOf(this.rippleTargetExternalClassName) > -1) {
                ASPx.AddClassNameToElement(element, this.rippleTargetExternalClassName);
                return true;
            }
            return content.indexOf(this.rippleTargetClassName) > -1;
        }
        return false;
    },
    needToProcessRipple: function(rippleTarget, evtSource) {
        if(!rippleTarget || !ASPx.AnimationUtils)
            return false;
        var isClearButton = ASPx.ElementContainsCssClass(rippleTarget, "dxeButton") && rippleTarget.id && rippleTarget.id.indexOf("B-100") !== -1;
        var isEmptyCalendarDay = ASPx.ElementContainsCssClass(rippleTarget, "dxeCalendarDay") && ASPx.Str.Trim(rippleTarget.textContent) == "";
        var isReadonly = ASPx.ElementContainsCssClass(rippleTarget, READ_ONLY_COMBOBOX_MARKER_CSS_CLASS);
        var tempFixDisable = ASPx.ElementContainsCssClass(rippleTarget, "dxSwitcher") && ASPx.Browser.MacOSMobilePlatform;
        var rippleIsForbidden = isReadonly || isClearButton || isEmptyCalendarDay || ASPx.GetParentByPartialClassName(rippleTarget, "Disabled") ||
            ASPx.ElementContainsCssClass(rippleTarget, "dxgvBatchEditCell") || ASPx.ElementContainsCssClass(rippleTarget, "dxcvEditForm") ||
            ASPx.GetParentByPartialClassName(evtSource, "dxcvFocusedCell") || tempFixDisable;
        return !rippleIsForbidden;
    },
    hasBothOverflow: function(style) {
        return style.overflow == "scroll" || style.overflow == "auto" || style.overflow == "hidden";
    },
    hasOverflowX: function(style) {
        return style.overflowX == "scroll" || style.overflowX == "auto" || style.overflowX == "hidden";
    },
    hasOverflowY: function(style) {
        return style.overflowY == "scroll" || style.overflowY == "auto" || style.overflowY == "hidden";
    },
    getExternalRippleContainerSize: function(targetRect) {
        if(ASPx.Browser.MobileUI) {
            var origTouchRadius = this.getOriginTouchRadius();
            if(origTouchRadius < targetRect.width || origTouchRadius < targetRect.height)
                origTouchRadius = Math.max(targetRect.width, targetRect.height);
            return {x: targetRect.x + (targetRect.width - origTouchRadius) / 2, y: targetRect.y + (targetRect.height - origTouchRadius) / 2, width: origTouchRadius, height: origTouchRadius };
        }

        var result = { x: 0, y: 0, width: 0, height: 0 };
        var diff = targetRect.width - targetRect.height;
        if(diff > 0) {
            result.x = targetRect.x;
            result.y = targetRect.y - diff / 2;
            result.width = targetRect.width;
            result.height = targetRect.width;
        } else {
            result.x = targetRect.x + diff / 2;
            result.y = targetRect.y;
            result.width = targetRect.height;
            result.height = targetRect.height;
        }

        return result;
    },
    getInternalContainerSize: function(targetInfo) {
        var parentWithOverflow = RippleHelper.getParentWithOverflow(targetInfo.getTarget());
        if(!ASPx.IsExists(parentWithOverflow))
            return targetInfo;

        var parentWithOverflowStyle = ASPx.GetCurrentStyle(parentWithOverflow);
        var bothOverflow = this.hasBothOverflow(parentWithOverflowStyle);
        var overflowX = this.hasOverflowX(parentWithOverflowStyle);
        var overflowY = this.hasOverflowY(parentWithOverflowStyle);

        var parentRect = {
            x: ASPx.GetAbsoluteX(parentWithOverflow),
            y: ASPx.GetAbsoluteY(parentWithOverflow),
            width: parentWithOverflow.offsetWidth,
            height: parentWithOverflow.offsetHeight
        };

        return this.getInternalContainerSizeCore(targetInfo, parentRect, bothOverflow, overflowX, overflowY);
    },
    getInternalContainerSizeCore: function(targetRect, parentRect, bothOverflow, overflowX, overflowY) {
        var result = {};
        ASPx.Data.MergeHashTables(result, targetRect);

        if(bothOverflow || overflowX) {
            result.x = targetRect.x < parentRect.x ? parentRect.x : targetRect.x;

            if(targetRect.x + targetRect.width > parentRect.x + parentRect.width)
                result.width = parentRect.x + parentRect.width - targetRect.x;
            if(parentRect.x > targetRect.x)
                result.width -= (parentRect.x - targetRect.x);
        }
        if(bothOverflow || overflowY) {
            result.y = targetRect.y < parentRect.y ? parentRect.y : targetRect.y;

            if(targetRect.y + targetRect.height > parentRect.y + parentRect.height)
                result.height = parentRect.y + parentRect.height - targetRect.y;
            if(parentRect.y > targetRect.y)
                result.height -= (parentRect.y - targetRect.y);
        }
        return result;
    },
    calculateRippleContainerSize: function(targetInfo, isExternalRipple) {
        return isExternalRipple ? this.getExternalRippleContainerSize(targetInfo) : this.getInternalContainerSize(targetInfo);
    },
    getParentWithOverflow: function(rippleTarget) {
        var result = ASPx.GetParent(rippleTarget, function(element) {
            var elementStyle = ASPx.GetCurrentStyle(element);
            return this.hasBothOverflow(elementStyle) || this.hasOverflowX(elementStyle) || this.hasOverflowY(elementStyle);
        }.aspxBind(this));

        return result;
    },
    getDuration: function(targetInfo) {
        return this.IsExternalRipple(targetInfo) || ASPx.Browser.MobileUI ? 650 : 450;
    },
    createRippleTransition: function(container, rippleElement, radius, targetInfo) {
        var rippleSize = 2 * radius;
        var transitionEndIsAborted = true;
        var transitionProperties = {
            width: { from: 0, to: rippleSize, transition: ASPx.AnimationConstants.Transitions.RIPPLE, propName: "width", unit: "px" },
            height: { from: 0, to: rippleSize, transition: ASPx.AnimationConstants.Transitions.RIPPLE, propName: "height", unit: "px" },
            marginLeft: { from: 0, to: -rippleSize / 2, transition: ASPx.AnimationConstants.Transitions.RIPPLE, propName: "marginLeft", unit: "px" },
            marginTop: { from: 0, to: -rippleSize / 2, transition: ASPx.AnimationConstants.Transitions.RIPPLE, propName: "marginTop", unit: "px" },
            opacity: { from: 1, to: 0.05, transition: ASPx.AnimationConstants.Transitions.RIPPLE, propName: "opacity", unit: "%" }
        };
        var rippleTransition = ASPx.AnimationUtils.createMultipleAnimationTransition(rippleElement, {
            transition: ASPx.AnimationConstants.Transitions.RIPPLE,
            duration: this.getDuration(targetInfo),
            onComplete: function() {
                this.RemoveRippleContainer(container.parentElement);
                transitionEndIsAborted = false;
            }.bind(this)
        });
        rippleTransition.Start(transitionProperties);
        window.setTimeout(function() {
            if(transitionEndIsAborted)
                this.RemoveRippleContainer(container.parentElement);
        }.bind(this), 500);
    },
    calculateRadius: function(isExternalRipple, posX, posY, containerRect) {
        var radius = -1;
        if(isExternalRipple) {
            if(ASPx.Browser.MobileUI)
                radius = this.getOriginTouchRadius() / 2;
            else
                radius = Math.max(containerRect.height, containerRect.width);
        } else {
            var width1 = posX - containerRect.x;
            var width2 = containerRect.width - width1;

            var height1 = posY - containerRect.y;
            var height2 = containerRect.height - height1;

            var rippleWidth = Math.max(width1, width2);
            var rippleHeight = Math.max(height1, height2);

            radius = Math.sqrt(Math.pow(rippleHeight, 2) + Math.pow(rippleWidth, 2));
        }
        return radius;
    },
    createRippleElement: function(container, rippleCenter) {
        var rippleElement = document.createElement("DIV");
        rippleElement.className = this.rippleClassName;

        container.appendChild(rippleElement);

        ASPxClientUtils.SetAbsoluteX(rippleElement, rippleCenter.x);
        ASPxClientUtils.SetAbsoluteY(rippleElement, rippleCenter.y);

        return rippleElement;
    },
    processRipple: function(targetInfo, eventInfo) {
        this.initRippleProcess();

        var isExternalRipple = this.IsExternalRipple(targetInfo);

        var rippleCenter = this.getRippleCenter(targetInfo.getRect(), eventInfo, isExternalRipple);
        var container = this.createRippleContainer(targetInfo, isExternalRipple);
        var rippleElement = this.createRippleElement(container, rippleCenter);
   
        var radius = this.calculateRadius(isExternalRipple, rippleCenter.x, rippleCenter.y, this.getElementRect(container));
        this.createRippleTransition(container, rippleElement, radius, targetInfo);
    },
    initRippleProcess: function() {
        this.isMobileExternalRipple = null;
        this.zoom = screen.width / window.innerWidth;
    },
    getRippleCenter: function(targetInfo, eventInfo, isExternalRipple) {
        var posX = 0;
        var posY = 0;
        if(isExternalRipple) {
            posX = targetInfo.x + targetInfo.width / 2;
            posY = targetInfo.y + targetInfo.height / 2;
        } else {
            posX = eventInfo.x;
            posY = eventInfo.y;
        }
        return {x: posX, y: posY};
    },
    createRippleContainer: function(targetInfo, isExternalRipple) {
        var containerParent = targetInfo.getTarget();
        if(!containerParent)
            return;
        var containerTagName = containerParent.tagName == "TR" ? "TD" : "DIV";
        var container = document.createElement(containerTagName);
        container.className = this.rippleContainerClassName;

        if(containerParent.parentNode && containerParent.tagName == "IMG")
            containerParent = containerParent.parentNode;
        if(this.isARowInFixedLayoutTable(containerParent))
            this.lockFixedLayoutTableSizes(containerParent);
        containerParent.appendChild(container);
        if(isExternalRipple)
            container.style.borderRadius = "50%";

        var containerRect = this.calculateRippleContainerSize(targetInfo, isExternalRipple);
        this.assignContainerSettings(container, containerRect);

        return container;
    },
    isARowInFixedLayoutTable: function(containerParent) {
        if(containerParent.tagName !== "TR")
            return false;
        var parentTable = this.getParentTable(containerParent);
        return parentTable && ASPx.GetCurrentStyle(parentTable)["table-layout"] === "fixed";
    },
    processFirstRowOfFixedTable: function(containerRow, rowAction, cellAction) {
        var firstRow = this.getFirstRow(containerRow);
        rowAction(firstRow);
        var cells = ASPx.Data.CollectionToArray(firstRow.cells);
        cells.forEach(cellAction);
    },
    getParentTable: function(element) {
        var parentTable = element;
        while(parentTable && parentTable.tagName !== "TABLE")
            parentTable = parentTable.parentElement;
        return parentTable;
    },
    lockFixedLayoutTableSizes: function(containerRow) {
        var firstRow = this.getFirstRow(containerRow);
        if(this.incLockCount(firstRow) === 1) {
            var cells = ASPx.Data.CollectionToArray(firstRow.cells);
            var widths = cells.map(function(cell) { return cell.style.width; });
            var computedWidths = cells.map(function(cell) {
                if(ASPx.Browser.IE && ASPx.ElementHasCssClass(cell, "dxeCM"))
                    return cell.offsetWidth + "px";
                return window.getComputedStyle(cell).width;
            });
            var fixWidth = function(cell, i) {
                if(ASPx.Attr.IsExistsAttribute(cell, SAVED_WIDTH_ATTR))
                    return;
                if(widths[i])
                    ASPx.Attr.SetAttribute(cell, SAVED_WIDTH_ATTR, widths[i]);
                cell.style.width = computedWidths[i];
            };
            cells.forEach(fixWidth);
        }
    }, 
    unlockFixedLayoutTableSizes: function(containerRow) {
        var firstRow = this.getFirstRow(containerRow);            
        if(this.decLockCount(firstRow) === 0) {
            var cells = ASPx.Data.CollectionToArray(firstRow.cells);
            var restoreState = function(cell) {
                if(ASPx.Attr.IsExistsAttribute(cell, SAVED_WIDTH_ATTR)) {
                    cell.style.width = ASPx.Attr.GetAttribute(cell, SAVED_WIDTH_ATTR);
                    ASPx.Attr.RemoveAttribute(cell, SAVED_WIDTH_ATTR);
                } else {
                    cell.style.width = null;
                }
            };
            cells.forEach(restoreState);
        }
    },
    getFirstRow: function(containerRow) { return ASPx.GetChildByTagName(containerRow.parentElement, "TR", 0); },
    incLockCount: function(elem) { return this.changeLockCount(elem, 1); },
    decLockCount: function(elem) { return this.changeLockCount(elem, -1); },
    changeLockCount: function(elem, diff) {
        var lockCounter = this.getLockCount(elem);
        lockCounter += diff;
        lockCounter = Math.max(0, lockCounter);
        if(lockCounter === 0)
            ASPx.Attr.RemoveAttribute(elem, RIPPLE_FIXED_ROW_ATTR);
        else
            ASPx.Attr.SetAttribute(elem, RIPPLE_FIXED_ROW_ATTR, lockCounter);
        return lockCounter;
    },
    getLockCount: function(lockElement) {
        var attrValue = ASPx.Attr.GetAttribute(lockElement, RIPPLE_FIXED_ROW_ATTR);
        return parseInt(attrValue) || 0;
    },
    assignContainerSettings: function(container, containerRect) {
        var properties = {
            height: containerRect.height,
            width: containerRect.width,
            left: ASPx.PrepareClientPosForElement(containerRect.x, container, true),
            top: ASPx.PrepareClientPosForElement(containerRect.y, container, false)
        };

        if(ASPx.Browser.MobileUI)
            ASPx.Data.MergeHashTables(properties, {marginTop: 0, marginLeft: 0 });
        
        ASPx.SetStyles(container, properties, ASPx.Browser.MobileUI);
    },
    IsExternalRipple: function(targetInfo) {
        var hasExternalRippleClassName = ASPx.ElementContainsCssClass(targetInfo.getTarget(), this.rippleTargetExternalClassName);
        if(!ASPx.Browser.MobileUI)
            return hasExternalRippleClassName;
        return hasExternalRippleClassName || this.IsMobileExternalRipple(targetInfo);
    },
    IsMobileExternalRipple: function(targetInfo) {
        if(this.isMobileExternalRipple == null) {
            var originTouchRadius = this.getOriginTouchRadius();
            this.isMobileExternalRipple = ASPx.Browser.MobileUI && targetInfo.width < originTouchRadius && targetInfo.height < originTouchRadius;
        }
        return this.isMobileExternalRipple;
    },
    RemoveRippleContainer: function(element) {
        if(!element)
            return;
        var childs = ASPx.GetChildNodesByClassName(element, this.rippleContainerClassName);
        var rippleContainer = childs.length > 0 ? childs[0] : null;
        if(rippleContainer != null) {
            var containerParent = rippleContainer.parentNode;
            containerParent.removeChild(rippleContainer);
            if(this.isARowInFixedLayoutTable(containerParent))
                this.unlockFixedLayoutTableSizes(containerParent);
        }
    },

    getEventX: function(evt) {
        return ASPxClientUtils.GetEventX(evt);
    },
    getEventY: function(evt) {
        return ASPxClientUtils.GetEventY(evt);
    },
    getOriginTouchRadius: function() {
        return this.touchRadius / this.zoom;
    },
    getElementRect: function(element) {
        return { x: ASPx.GetAbsoluteX(element), y: ASPx.GetAbsoluteY(element), width: element.offsetWidth, height: element.offsetHeight };
    }
};
var AccessibilitySR = {
    AddStringResources: function(stringResourcesObj) {
        if(stringResourcesObj) {
            for(var key in stringResourcesObj)
                if(stringResourcesObj.hasOwnProperty(key))
                    this[key] = stringResourcesObj[key];
        }
    }
};

ASPx.CollectionBase = CollectionBase;
ASPx.FunctionIsInCallstack = _aspxFunctionIsInCallstack;
ASPx.RaisePostHandlerOnPost = aspxRaisePostHandlerOnPost;
ASPx.GetPostHandler = aspxGetPostHandler;
ASPx.ProcessScriptsAndLinks = _aspxProcessScriptsAndLinks;
ASPx.InitializeLinks = _aspxInitializeLinks;
ASPx.InitializeScripts = _aspxInitializeScripts;
ASPx.RunStartupScripts = _aspxRunStartupScripts;
ASPx.IsStartupScriptsRunning = _aspxIsStartupScriptsRunning;
ASPx.AddScriptsRestartHandler = _aspxAddScriptsRestartHandler;
ASPx.GetFocusedElement = _aspxGetFocusedElement;
ASPx.GetDomObserver = _aspxGetDomObserver;
ASPx.CacheHelper = CacheHelper;
ASPx.ControlTree = ControlTree;
ASPx.ControlAdjuster = ControlAdjuster;
ASPx.GetControlAdjuster = GetControlAdjuster;
ASPx.ControlCallbackHandlersQueue = ControlCallbackHandlersQueue;

ASPx.ResourceManager = ResourceManager;
ASPx.UpdateWatcherHelper = UpdateWatcherHelper;
ASPx.EventStorage = EventStorage;
ASPx.GetGlobalObject = GetGlobalObject;
ASPx.GetExternalScriptProcessor = GetExternalScriptProcessor;

ASPx.CheckBoxCheckState = CheckBoxCheckState;
ASPx.CheckBoxInputKey = CheckBoxInputKey;
ASPx.CheckableElementStateController = CheckableElementStateController;
ASPx.CheckableElementHelper = CheckableElementHelper;
ASPx.CheckBoxInternal = CheckBoxInternal;
ASPx.CheckBoxInternalCollection = CheckBoxInternalCollection;
ASPx.ControlCallbackQueueHelper = ControlCallbackQueueHelper;
ASPx.FocusedStyleDecoration = FocusedStyleDecoration;
ASPx.EditorStyleDecoration = EditorStyleDecoration;
ASPx.TextEditorStyleDecoration = TextEditorStyleDecoration;
ASPx.AccessibilitySR = AccessibilitySR;
ASPx.KbdHelper = KbdHelper;
ASPx.AccessKeysHelper = AccessKeysHelper;
ASPx.AccessKey = AccessKey;
ASPx.IFrameHelper = IFrameHelper;
ASPx.Ident = Ident;
ASPx.TouchUIHelper = TouchUIHelper;
ASPx.ControlUpdateWatcher = ControlUpdateWatcher;
ASPx.ControlTabIndexManager = ControlTabIndexManager;
ASPx.AccessibilityHelperBase = AccessibilityHelperBase;
ASPx.RippleHelper = RippleHelper;
ASPx.ThemesWithRipple = ThemesWithRipple;
window.ASPxClientEvent = ASPxClientEvent;
window.ASPxClientEventArgs = ASPxClientEventArgs;
window.ASPxClientCancelEventArgs = ASPxClientCancelEventArgs;
window.ASPxClientProcessingModeEventArgs = ASPxClientProcessingModeEventArgs;
window.ASPxClientProcessingModeCancelEventArgs = ASPxClientProcessingModeCancelEventArgs;

ASPx.Evt.AttachEventToDocument(TouchUIHelper.touchMouseDownEventName, RippleHelper.onDocumentMouseDown);
ASPx.classesScriptParsed = true;
/* Don't write any code below this line!!! */
})(ASPx, { GCCheckInterval: 5000 });

/// <reference path="Utils.js"/>
/*# namespace DevExpress.Web.Scripts #*/

(function module(ASPx) {
ASPx.modules.Controls = module;
/*# public delegate void ASPxClientBeginCallbackEventHandler(object source, ASPxClientBeginCallbackEventArgs e);#*/
/*# public class ASPxClientBeginCallbackEventArgs : ASPxClientEventArgs #*/
var ASPxClientBeginCallbackEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
    /*# public ASPxClientBeginCallbackEventArgs(string command) : base(){} #*/
    constructor: function(command){
        this.constructor.prototype.constructor.call(this);
        /*# public string command{ get{return string.Empty;} } #*/
        this.command = command;
    }
});
/*# public delegate void ASPxClientGlobalBeginCallbackEventHandler(object source, ASPxClientGlobalBeginCallbackEventArgs e);#*/
/*# public class ASPxClientGlobalBeginCallbackEventArgs : ASPxClientBeginCallbackEventArgs #*/
var ASPxClientGlobalBeginCallbackEventArgs = ASPx.CreateClass(ASPxClientBeginCallbackEventArgs, {
    /*# public ASPxClientGlobalBeginCallbackEventArgs(ASPxClientControl control, string command) : base(command){} #*/
    constructor: function(control, command){
        this.constructor.prototype.constructor.call(this, command);
        /*# public ASPxClientControl control{ get{return null;} } #*/
        this.control = control;
    }
});
/*# public delegate void ASPxClientEndCallbackEventHandler(object source, ASPxClientEndCallbackEventArgs e);#*/
/*# public class ASPxClientEndCallbackEventArgs : ASPxClientEventArgs #*/
var ASPxClientEndCallbackEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
    /*# public ASPxClientEndCallbackEventArgs(string command) : base(){} #*/
    constructor: function(command){
        this.constructor.prototype.constructor.call(this);
        /*# public string command{ get{return string.Empty;} } #*/
        this.command = command;
    }
});
/*# public delegate void ASPxClientGlobalEndCallbackEventHandler(object source, ASPxClientGlobalEndCallbackEventArgs e);#*/
/*# public class ASPxClientGlobalEndCallbackEventArgs : ASPxClientEndCallbackEventArgs #*/
var ASPxClientGlobalEndCallbackEventArgs = ASPx.CreateClass(ASPxClientEndCallbackEventArgs, {
    /*# public ASPxClientGlobalEndCallbackEventArgs(ASPxClientControl control) : base(){} #*/
    constructor: function(control){
        this.constructor.prototype.constructor.call(this);
        /*# public ASPxClientControl control{ get{return null;} } #*/
        this.control = control;
    }
});
/*# public delegate void ASPxClientCustomDataCallbackEventHandler(object source, ASPxClientCustomDataCallbackEventArgs e);#*/
/*# public class ASPxClientCustomDataCallbackEventArgs : ASPxClientEventArgs #*/
var ASPxClientCustomDataCallbackEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
    /*# public ASPxClientCustomDataCallbackEventArgs(string result) : base() { } #*/
    constructor: function(result) {
        this.constructor.prototype.constructor.call(this);
        /*# public string result { get { return string.Empty; } set { } } #*/
        this.result = result;
    }
});
/*# public delegate void ASPxClientCallbackErrorEventHandler(object source, ASPxClientCallbackErrorEventArgs e);#*/
/*# public class ASPxClientCallbackErrorEventArgs : ASPxClientEventArgs #*/
var ASPxClientCallbackErrorEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
    /*# public ASPxClientCallbackErrorEventArgs(string message) : base(){} #*/
    constructor: function (message, callbackId) {
        this.constructor.prototype.constructor.call(this);
        /*# public string message{ get{return string.Empty;} set{} } #*/
        this.message = message;
        /*# public bool handled{ get{return false;} set{} } #*/
        this.handled = false;
        this.callbackId = callbackId;
    }
});
/*# public delegate void ASPxClientGlobalCallbackErrorEventHandler(object source, ASPxClientGlobalCallbackErrorEventArgs e);#*/
/*# public class ASPxClientGlobalCallbackErrorEventArgs : ASPxClientCallbackErrorEventArgs #*/
var ASPxClientGlobalCallbackErrorEventArgs = ASPx.CreateClass(ASPxClientCallbackErrorEventArgs, {
    /*# public ASPxClientGlobalCallbackErrorEventArgs(ASPxClientControl control, string message) : base(message){} #*/
    constructor: function (control, message, callbackId) {
        this.constructor.prototype.constructor.call(this, message, callbackId);
        /*# public ASPxClientControl control{ get{return null;} } #*/
        this.control = control;
    }
});

/*# public delegate void ASPxClientValidationCompletedEventHandler(object source, ASPxClientValidationCompletedEventArgs e); #*/
/*# public class ASPxClientValidationCompletedEventArgs : ASPxClientEventArgs #*/
var ASPxClientValidationCompletedEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
    /*# public ASPxClientValidationCompletedEventArgs(object container, string validationGroup, bool invisibleControlsValidated, bool isValid, ASPxClientControl firstInvalidControl, ASPxClientControl firstVisibleInvalidControl) : base() { } #*/
    constructor: function (container, validationGroup, invisibleControlsValidated, isValid, firstInvalidControl, firstVisibleInvalidControl) {
        this.constructor.prototype.constructor.call(this);

        /*# public object container { get { return null; } } #*/
        this.container = container;
        /*# public string validationGroup { get { return null; } } #*/
        this.validationGroup = validationGroup;
        /*# public bool invisibleControlsValidated { get { return true; } } #*/
        this.invisibleControlsValidated = invisibleControlsValidated;
        /*# public bool isValid { get { return true; } set { } } #*/
        this.isValid = isValid;
        /*# public ASPxClientControl firstInvalidControl { get { return null; } } #*/
        this.firstInvalidControl = firstInvalidControl;
        /*# public ASPxClientControl firstVisibleInvalidControl { get { return null; } } #*/
        this.firstVisibleInvalidControl = firstVisibleInvalidControl;
    }
});

/*# public delegate void ASPxClientControlsInitializedEventHandler(object source, ASPxClientControlsInitializedEventArgs e); #*/
/*# public class ASPxClientControlsInitializedEventArgs : ASPxClientEventArgs  #*/
var ASPxClientControlsInitializedEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
    /*# public ASPxClientControlsInitializedEventArgs(bool isCallback) : base() { } #*/
    constructor: function(isCallback) {
        /*# public bool isCallback { get { return false; } } #*/
        this.isCallback = isCallback;
    }
});

var ASPxClientControlBeforePronounceEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
    constructor: function(messageParts, control){
        this.constructor.prototype.constructor.call(this);
        this.messageParts = messageParts;
        this.control = control;
    }
});

var ASPxClientControlUnloadEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
    constructor: function(control){
        this.constructor.prototype.constructor.call(this);
        this.control = control;
    }
});

var ASPxClientEndFocusEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
    constructor: function(item) {
        this.constructor.prototype.constructor.call(this);
        this.item = item;
    }
});
var ASPxClientItemFocusedEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
    constructor: function(item) {
        this.constructor.prototype.constructor.call(this);
        this.item = item;
    }
});

var BeforeInitCallbackEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
    constructor: function(callbackOwnerID){
        this.constructor.prototype.constructor.call(this);
        this.callbackOwnerID = callbackOwnerID;
    }
});

ASPx.createControl = function(type, name, windowName, properties, events, setupMethod, data){
    var globalName = windowName && windowName.length > 0 ? windowName : name;
    var dxo = new type(name);
    var haveWrapper = ASPx.Platform === "NETCORE" && dxo.createWrapper && !DevExpress.AspNetCore.Internal.BackwardCompatibility.useLegacyClientAPI;
    if(haveWrapper) {
        window[globalName] = dxo.createWrapper();
        dxo.aspNetCoreWrapperInstance = window[globalName];
    }
    else
        dxo.InitGlobalVariable(globalName);
    if(properties)
        dxo.SetProperties(properties);
    if(events)
        dxo.SetEvents(events);
    if(setupMethod)
        setupMethod.call(dxo);
    if(data)
        dxo.SetData(data);
    dxo.AfterCreate();
};

/*# public class ASPxClientControlBase: JavaScriptObject #*/
var ASPxClientControlBase = ASPx.CreateClass(null, {
    constructor: function(name){
        /*# public string name{ get{ return ""; } } #*/    
        this.name = name;
        this.uniqueID = name;   
        this.globalName = name;
        this.stateObject = null;
        this.needEncodeState = true;

        this.encodeHtml = true;
        this.enabled = true;
        this.clientEnabled = true;
        this.savedClientEnabled = true;
        this.clientVisible = true;
        this.accessibilityCompliant = false;
        this.parseJSPropertiesOnCallbackError = false;

        this.autoPostBack = false;
        this.allowMultipleCallbacks = true;
        this.callBack = null;
        this.enableCallbackAnimation = false;
        this.enableSlideCallbackAnimation = false;
        this.slideAnimationDirection = null;
        this.beginCallbackAnimationProcessing = false;
        this.endCallbackAnimationProcessing = false;
        this.savedCallbackResult = null;
        this.savedCallbacks = null;
        this.isCallbackAnimationPrevented = false;
        this.lpDelay = 300;
        this.lpTimer = -1;
        this.requestCount = 0;
        this.enableSwipeGestures = false;
        this.disableSwipeGestures = false;
        this.supportGestures = false;
        this.repeatedGestureValue = 0;
        this.repeatedGestureCount = 0;

        this.isInitialized = false;
        this.initialFocused = false;
        this.leadingAfterInitCall = ASPxClientControl.LeadingAfterInitCallConsts.None; // AfterInitialize call will be displaced to the beginning of call queue
        this.serverEvents = [];
        
        this.loadingPanelElement = null;
        this.loadingDivElement = null;        
        this.hasPhantomLoadingElements = false;
        this.mainElement = null;
        this.touchUIMouseScroller = null;
        this.hiddenFields = {};

        this.scPrefix = "dx";

        this.callbackHandlersQueue = new ASPx.ControlCallbackHandlersQueue(this);
        this.callbackCommand = {};
        this.currentCallbackID = -1;

        /*# public event ASPxClientEventHandler Init{ add{} remove{}}#*/
        this.Init = new ASPxClientEvent();
        this.BeginCallback = new ASPxClientEvent();
        this.EndCallback = new ASPxClientEvent();
        this.EndCallbackAnimationStart = new ASPxClientEvent();
        this.CallbackError = new ASPxClientEvent();
        this.CustomDataCallback = new ASPxClientEvent();
        this.BeforePronounce = new ASPxClientEvent();
        this.Unload = new ASPxClientEvent();
        aspxGetControlCollection().Add(this);
    },

    Initialize: function() {
        if(this.callBack != null)
            this.InitializeCallBackData();
        if (this.useCallbackQueue())
            this.callbackQueueHelper = new ASPx.ControlCallbackQueueHelper(this);
        ASPx.AccessibilityUtils.createAccessibleBackgrounds(this);
        if(this.accessibilityCompliant)
            ASPx.AccessibilityPronouncer.EnsureInitialize();
    },
    FinalizeInitialization: function() { },
    InlineInitialize: function() {
        this.savedClientEnabled = this.clientEnabled;
    },
    InitializeGestures: function() {
        if(this.isSwipeGesturesEnabled() && this.supportGestures) {
            ASPx.GesturesHelper.AddSwipeGestureHandler(this.name, 
                function() { return this.GetCallbackAnimationElement(); }.aspxBind(this), 
                function(evt) { return this.CanHandleGestureCore(evt); }.aspxBind(this), 
                function(value) { return this.AllowStartGesture(value); }.aspxBind(this),
                function(value) { return this.StartGesture(); }.aspxBind(this),
                function(value) { return this.AllowExecuteGesture(value); }.aspxBind(this),
                function(value) { this.ExecuteGesture(value); }.aspxBind(this),
                function(value) { this.CancelGesture(value); }.aspxBind(this),
                this.GetDefaultanimationEngineType(),
                this.rtl
            );
            if(ASPx.Browser.MSTouchUI)
                this.touchUIMouseScroller = ASPx.MouseScroller.Create(
                    function() { return this.GetCallbackAnimationElement(); }.aspxBind(this),
                    function() { return null; },
                    function() { return this.GetCallbackAnimationElement(); }.aspxBind(this),
                    function(element) { return this.NeedPreventTouchUIMouseScrolling(element); }.aspxBind(this),
                    true
                );
        }
    },
    isSwipeGesturesEnabled: function() {
        return !this.disableSwipeGestures && (this.enableSwipeGestures || ASPx.Browser.TouchUI);
    },
    isSlideCallbackAnimationEnabled: function() {
        return this.enableSlideCallbackAnimation || this.isSwipeGesturesEnabled();    
    },
    InitGlobalVariable: function(varName){
        if(!window) return;
        
        this.globalName = varName;
        window[varName] = this;
    },
    SetElementDisplay: function(element, value, checkCurrentStyle, makeInline) {
        ASPx.SetElementDisplay(element, value, checkCurrentStyle, makeInline);
    },
    SetProperties: function(properties, obj){
        if(!obj) obj = this;
        var isAspNetCoreWrapperInstanceExist = !!obj.aspNetCoreWrapperInstance;
        for(var name in properties){
            if(!properties.hasOwnProperty(name)) continue;
            
            obj[name] = properties[name];
            if(isAspNetCoreWrapperInstanceExist && name.indexOf("cp") === 0)
                obj.aspNetCoreWrapperInstance[name] = properties[name]; 
        }
    },
    SetEvents: function(events, obj){
        if(!obj) obj = this;
        for(var name in events){
            if(events.hasOwnProperty(name) && obj[name] && obj[name].AddHandler)
                obj[name].AddHandler(events[name]);
        }
    },
    SetData: function(data){
    },

    useCallbackQueue: function(){
        return false;
    },
    NeedPreventTouchUIMouseScrolling: function(element) {
        return false;
    },
    InitailizeFocus: function() {
        if(this.initialFocused && this.IsVisible())
            this.Focus();
    },
    AfterCreate: function() {
        this.AddDefaultStateControllerItems();
        this.InlineInitialize();
        this.InitializeGestures();
    },
    AfterInitialize: function() {
        this.initializeAriaDescriptor();
        this.InitailizeFocus();
        this.isInitialized = true;
        this.RaiseInit();
            
        if(this.savedCallbacks) {
            for(var i = 0; i < this.savedCallbacks.length; i++) 
                this.CreateCallbackInternal(this.savedCallbacks[i].arg, this.savedCallbacks[i].command, 
                    false, this.savedCallbacks[i].callbackInfo);
            this.savedCallbacks = null;
        }
    },
    InitializeCallBackData: function() {
    },
    AtlasPreInitialize: function() {
    },
    AtlasInitialize: function() {
    },
    IsDOMDisposed: function() { 
        return !ASPx.IsExistsElement(this.GetMainElement());
    },
    initializeAriaDescriptor: function() {
        if(this.ariaDescription) {
            var descriptionObject = ASPx.Json.Eval(this.ariaDescription);
            if(descriptionObject) {
                this.ariaDescriptor = new AriaDescriptor(this, descriptionObject);
                this.applyAccessibilityAttributes(this.ariaDescriptor);    
            }
        }
    },
    applyAccessibilityAttributes: function() { },
    setAriaDescription: function(selector, argsList) {
        if(this.ariaDescriptor)
            this.ariaDescriptor.setDescription(selector, argsList || [[]]);
    },
    allowRestoreFocusOnCallbacks: function(){
        return this.accessibilityCompliant;
    },

    HtmlEncode: function(text) {
        return this.encodeHtml ? ASPx.Str.EncodeHtml(text) : text;
    },
    IsServerEventAssigned: function(eventName){
        return ASPx.Data.ArrayIndexOf(this.serverEvents, eventName) >= 0;
    },

    OnPost: function(args){
        this.SerializeStateHiddenField();
    },
    SerializeStateHiddenField: function() {
        this.UpdateStateObject();
        if(this.stateObject != null)
            this.UpdateStateHiddenField();
    },
    OnPostFinalization: function(args){
    },
    UpdateStateObject: function(){
    },
    UpdateStateObjectWithObject: function(obj){
        if(!obj) return;

        if(!this.stateObject)
            this.stateObject = { };
        for(var key in obj)
            if(obj.hasOwnProperty(key))
                this.stateObject[key] = obj[key];
    },
    UpdateStateHiddenField: function() {
        var stateHiddenField = this.GetStateHiddenField();
        if(stateHiddenField) {
            var stateObjectStr = ASPx.Json.ToJson(this.stateObject, !this.needEncodeState);
            stateHiddenField.value = this.needEncodeState ? ASPx.Str.EncodeHtml(stateObjectStr) : stateObjectStr;
        }
    },
    GetStateHiddenField: function() {
        return this.GetHiddenField(this.GetStateHiddenFieldName(), this.GetStateHiddenFieldID(), 
            this.GetStateHiddenFieldParent(), this.GetStateHiddenFieldOrigin());
    },
    GetStateHiddenFieldName: function() {
        return this.uniqueID;
    },
    GetStateHiddenFieldID: function() {
        return this.name + "_State";
    },
    GetStateHiddenFieldOrigin: function() {
        return this.GetMainElement();
    },
    GetStateHiddenFieldParent: function() {
        var element = this.GetStateHiddenFieldOrigin();
        return element ? element.parentNode : null;
    },
    GetHiddenField: function(name, id, parent, beforeElement) {
        var hiddenField = this.hiddenFields[id];
        if(!hiddenField || !ASPx.IsValidElement(hiddenField)) {
            if(parent) {
                var existingHiddenField = ASPx.GetElementById(this.GetStateHiddenFieldID());
                this.hiddenFields[id] = hiddenField = existingHiddenField || ASPx.CreateHiddenField(name, id);
                if(existingHiddenField)
                    return existingHiddenField;

                if(beforeElement)
                    parent.insertBefore(hiddenField, beforeElement);
                else
                    parent.appendChild(hiddenField);
            }
        }
        return hiddenField;
    },

    GetChildElement: function(idPostfix){
        var mainElement = this.GetMainElement();
        if(idPostfix.charAt && idPostfix.charAt(0) !== "_")
            idPostfix = "_" + idPostfix;
        return mainElement ? ASPx.CacheHelper.GetCachedChildById(this, mainElement, this.name + idPostfix) : null;
    },
    getChildControl: function(idPostfix) {
        var result = null;
        var childControlId = this.getChildControlUniqueID(idPostfix);
        ASPx.GetControlCollection().ProcessControlsInContainer(this.GetMainElement(), function(control) {
            if(control.uniqueID == childControlId)
                result = control;
        });
        return result;        
    },
    getChildControlUniqueID: function(idPostfix) {
        idPostfix = idPostfix.split("_").join("$");
        if(idPostfix.charAt && idPostfix.charAt(0) !== "$")
            idPostfix = "$" + idPostfix;
        return this.uniqueID + idPostfix;        
    },
    getInnerControl: function(idPostfix) {
        var name = this.name + idPostfix;
        var result = window[name];
        return result && Ident.IsASPxClientControl(result)
            ? result
            : null;
    },
    GetParentForm: function(){
        return ASPx.GetParentByTagName(this.GetMainElement(), "FORM");
    },
    /*# public object GetMainElement() { return null; } #*/
    GetMainElement: function(){
        if(!ASPx.IsExistsElement(this.mainElement))
            this.mainElement = ASPx.GetElementById(this.GetMainElementId());
        return this.mainElement;
    },
    GetMainElementId: function() {
        return this.name;
    },

    // Callback
    IsLoadingContainerVisible: function(){
        return this.IsVisible();
    },
    GetLoadingPanelElement: function(){
        return ASPx.GetElementById(this.name + "_LP");
    },
    GetClonedLoadingPanel: function(){
        return document.getElementById(this.GetLoadingPanelElement().id + "V");    
    },
    CloneLoadingPanel: function(element, parent) {
        var clone = element.cloneNode(true);
        clone.id = element.id + "V";
        parent.appendChild(clone);
        return clone;
    },
    CreateLoadingPanelWithoutBordersInsideContainer: function(container) {
        var loadingPanel = this.CreateLoadingPanelInsideContainer(container, false, true, true);
        var contentStyle = ASPx.GetCurrentStyle(container);
        if(!loadingPanel || !contentStyle)
            return;
        var elements = [ ];
        var table = (loadingPanel.tagName == "TABLE") ? loadingPanel : ASPx.GetNodeByTagName(loadingPanel, "TABLE", 0);
        if(table != null)
            elements.push(table);
        else
            elements.push(loadingPanel);
        var cells = ASPx.GetNodesByTagName(loadingPanel, "TD");
        if(!cells) cells = [ ];
        for(var i = 0; i < cells.length; i++)
            elements.push(cells[i]);

        for(var i = 0; i < elements.length; i++) {
            var el = elements[i];
            el.style.backgroundColor = contentStyle.backgroundColor;
            ASPx.RemoveBordersAndShadows(el);
        }
    },
    CreateLoadingPanelInsideContainer: function(parentElement, hideContent, collapseHeight, collapseWidth) {
        if(this.ShouldHideExistingLoadingElements())
            this.HideLoadingPanel();
        if(parentElement == null)
            return null;
        if(!this.IsLoadingContainerVisible()) {
            this.hasPhantomLoadingElements = true;
            return null;
        }

        var element = this.GetLoadingPanelElement();
        if(element != null){
            var width = collapseWidth ? 0 : ASPx.GetClearClientWidth(parentElement);
            var height = collapseHeight ? 0 : ASPx.GetClearClientHeight(parentElement);
            if(hideContent){
                for(var i = parentElement.childNodes.length - 1; i > -1; i--){
                    if(parentElement.childNodes[i].style)
                        parentElement.childNodes[i].style.display = "none";
                    else if(parentElement.childNodes[i].nodeType == 3) // Q353968
                        parentElement.removeChild(parentElement.childNodes[i]);
                }
            }
            else
                parentElement.innerHTML = "";
            
            var table = document.createElement("TABLE");
            parentElement.appendChild(table);
            table.border = 0;
            table.cellPadding = 0;
            table.cellSpacing = 0;
            ASPx.SetStyles(table, {
                width: (width > 0) ? width : "100%",
                height: (height > 0) ? height : "100%"
            });
            var tbody = document.createElement("TBODY");
            table.appendChild(tbody);
            var tr = document.createElement("TR");
            tbody.appendChild(tr);
            var td = document.createElement("TD");
            tr.appendChild(td);
            td.align = "center";
            td.vAlign = "middle";
            
            element = this.CloneLoadingPanel(element, td);
            ASPx.SetElementDisplay(element, true);
            this.loadingPanelElement = element;
            return element;
        } else
            parentElement.innerHTML = "&nbsp;";
        return null;
    },
    CreateLoadingPanelWithAbsolutePosition: function(parentElement, offsetElement) {
        if(this.ShouldHideExistingLoadingElements())
            this.HideLoadingPanel();
        if(parentElement == null)
            return null;
        if(!this.IsLoadingContainerVisible()) {
            this.hasPhantomLoadingElements = true;
            return null;
        }
        
        if(!offsetElement)
            offsetElement = parentElement;
        var element = this.GetLoadingPanelElement();
        if(element != null) {
            element = this.CloneLoadingPanel(element, parentElement);
            ASPx.SetStyles(element, {
                position: "absolute"
            });
            ASPx.SetElementDisplay(element, true);
            ASPx.Evt.AttachEventToElement(element, ASPx.Evt.GetMouseWheelEventName(), ASPx.Evt.PreventEvent);
            this.SetLoadingPanelLocation(offsetElement, element);
            this.loadingPanelElement = element;
            return element;
        }
        return null;
    },
    CreateLoadingPanelInline: function(parentElement, centerInParent){
        if(this.ShouldHideExistingLoadingElements())
            this.HideLoadingPanel();
        if(parentElement == null)
            return null;
        if(!this.IsLoadingContainerVisible()) {
            this.hasPhantomLoadingElements = true;
            return null;
        }

        var element = this.GetLoadingPanelElement();
        if(element != null) {
            element = this.CloneLoadingPanel(element, parentElement);
            if(centerInParent){
                ASPx.SetElementDisplay(element, true);
                parentElement.style.textAlign = "center";
            }
            else
                ASPx.SetElementDisplay(element, true);
            this.loadingPanelElement = element;
            return element;
        }
        return null;
    },
    ShowLoadingPanel: function() {
    },
    ShowLoadingElements: function() {
        if(this.InCallback() || this.lpTimer > -1) return;
        
        this.ShowLoadingDiv();
        if(this.IsCallbackAnimationEnabled())
            this.StartBeginCallbackAnimation();
        else
            this.ShowLoadingElementsInternal();
    },
    ShowLoadingElementsInternal: function() {
		if(this.lpDelay > 0 && !this.IsCallbackAnimationEnabled()) 
			this.lpTimer = window.setTimeout(function() { 
                this.ShowLoadingPanelOnTimer(); 
            }.aspxBind(this), this.lpDelay);
        else {
            this.RestoreLoadingDivOpacity();
			this.ShowLoadingPanel();
        }
    },
    GetLoadingPanelOffsetElement: function (baseElement) {
        if(this.IsCallbackAnimationEnabled()) {
            var element = this.GetLoadingPanelCallbackAnimationOffsetElement();
            if(element) {
                var container = typeof(ASPx.AnimationHelper) != "undefined" ? ASPx.AnimationHelper.findSlideAnimationContainer(element) : null;
                if(container)
                    return container.parentNode.parentNode;
                else
                    return element;
            }
        }
        return baseElement;
    },
    GetLoadingPanelCallbackAnimationOffsetElement: function () {
        return this.GetCallbackAnimationElement();
    },
    IsCallbackAnimationEnabled: function () {
        return (this.enableCallbackAnimation || this.isSlideCallbackAnimationEnabled()) && !this.isCallbackAnimationPrevented;
    },
    GetDefaultanimationEngineType: function() {
        return ASPx.AnimationEngineType.DEFAULT;
    },
    StartBeginCallbackAnimation: function () {
        this.beginCallbackAnimationProcessing = true;
        this.isCallbackFinished = false;

        var element = this.GetCallbackAnimationElement();
        if (element && this.isSlideCallbackAnimationEnabled() && this.slideAnimationDirection)
            ASPx.AnimationHelper.slideOut(element, this.slideAnimationDirection, this.FinishBeginCallbackAnimation.aspxBind(this), this.GetDefaultanimationEngineType(), this.rtl);
        else if(element && this.enableCallbackAnimation) 
            ASPx.AnimationHelper.fadeOut(element, this.FinishBeginCallbackAnimation.aspxBind(this));
        else
            this.FinishBeginCallbackAnimation();
    },
    CancelBeginCallbackAnimation: function() {
        if(this.beginCallbackAnimationProcessing) {
            this.beginCallbackAnimationProcessing = false;
            var element = this.GetCallbackAnimationElement();
            ASPx.AnimationHelper.cancelAnimation(element);
        }
    },
    FinishBeginCallbackAnimation: function () {
        this.beginCallbackAnimationProcessing = false;
        if(!this.isCallbackFinished)
            this.ShowLoadingElementsInternal();
        else {
            this.DoCallback(this.savedCallbackResult);
            this.savedCallbackResult = null;
        }
    },
    CheckBeginCallbackAnimationInProgress: function(callbackResult) {
        if(this.beginCallbackAnimationProcessing) {
            this.savedCallbackResult = callbackResult;
            this.isCallbackFinished = true;
            return true;
        }
        return false;
    },
    StartEndCallbackAnimation: function () {
        this.HideLoadingPanel();
        this.SetInitialLoadingDivOpacity();

        this.RaiseEndCallbackAnimationStart();

        this.endCallbackAnimationProcessing = true;

        var element = this.GetCallbackAnimationElement();
        if(element && this.isSlideCallbackAnimationEnabled() && this.slideAnimationDirection) 
            ASPx.AnimationHelper.slideIn(element, this.slideAnimationDirection, this.FinishEndCallbackAnimation.aspxBind(this), this.GetDefaultanimationEngineType(), this.rtl);
        else if(element && this.enableCallbackAnimation) 
            ASPx.AnimationHelper.fadeIn(element, this.FinishEndCallbackAnimation.aspxBind(this));
        else
            this.FinishEndCallbackAnimation();
        this.slideAnimationDirection = null;
    },
    FinishEndCallbackAnimation: function () {
        this.DoEndCallback();
        this.endCallbackAnimationProcessing = false;

        this.CheckRepeatGesture();
    },
    CheckEndCallbackAnimationNeeded: function() {
        if(!this.endCallbackAnimationProcessing && this.requestCount == 1) {
            this.StartEndCallbackAnimation();
            return true;
        }
        return false;
    },
    PreventCallbackAnimation: function() {
        this.isCallbackAnimationPrevented = true;
    },
    GetCallbackAnimationElement: function() {
        return null;
    },
    AssignSlideAnimationDirectionByPagerArgument: function(arg, currentPageIndex) {
        this.slideAnimationDirection = null;
        if(this.isSlideCallbackAnimationEnabled() && typeof(ASPx.AnimationHelper) != "undefined") {
            if(arg == PagerCommands.Next || arg == PagerCommands.Last)
                this.slideAnimationDirection = ASPx.AnimationHelper.SLIDE_LEFT_DIRECTION;
            else if(arg == PagerCommands.First || arg == PagerCommands.Prev)
                this.slideAnimationDirection = ASPx.AnimationHelper.SLIDE_RIGHT_DIRECTION;
            else if(!isNaN(currentPageIndex) && arg.indexOf(PagerCommands.PageNumber) == 0) {
                var newPageIndex = parseInt(arg.substring(2));
                if (!isNaN(newPageIndex)) {
                    var leftDir = this.rtl ? ASPx.AnimationHelper.SLIDE_LEFT_DIRECTION : ASPx.AnimationHelper.SLIDE_RIGHT_DIRECTION;
                    var rightDir = this.rtl ? ASPx.AnimationHelper.SLIDE_RIGHT_DIRECTION : ASPx.AnimationHelper.SLIDE_LEFT_DIRECTION;
                    this.slideAnimationDirection = newPageIndex < currentPageIndex ? leftDir : rightDir;
                }
            }
        }
    },
    TryShowPhantomLoadingElements: function () {
        if(this.hasPhantomLoadingElements && this.InCallback()) {
            this.hasPhantomLoadingElements = false;
            this.ShowLoadingDivAndPanel();
        }
    },
    ShowLoadingDivAndPanel: function () {
        this.ShowLoadingDiv();
        this.RestoreLoadingDivOpacity();
        this.ShowLoadingPanel();
    },
    HideLoadingElements: function() {
        this.CancelBeginCallbackAnimation();
        this.HideLoadingPanel();
        this.HideLoadingDiv();
    },
    ShowLoadingPanelOnTimer: function() {
        this.ClearLoadingPanelTimer();
        if(!this.IsDOMDisposed()) {
            this.RestoreLoadingDivOpacity();
            this.ShowLoadingPanel();
        }
    },
    ClearLoadingPanelTimer: function() {
		this.lpTimer = ASPx.Timer.ClearTimer(this.lpTimer);		
    },
    HideLoadingPanel: function() {
        this.ClearLoadingPanelTimer();

        this.hasPhantomLoadingElements = false;
        if(ASPx.IsExistsElement(this.loadingPanelElement)) {
            ASPx.RemoveElement(this.loadingPanelElement);
            this.loadingPanelElement = null;
        }
    },
    SetLoadingPanelLocation: function(offsetElement, loadingPanel, x, y, offsetX, offsetY) {
        if(!ASPx.IsExists(x) || !ASPx.IsExists(y)){
            var x1 = ASPx.GetAbsoluteX(offsetElement);
            var y1 = ASPx.GetAbsoluteY(offsetElement);
            var x2 = x1;
            var y2 = y1;
            if(offsetElement == document.body) {
                x1 = 0;
                y1 = 0;
                x2 = ASPx.GetDocumentMaxClientWidth();
                y2 = ASPx.GetDocumentMaxClientHeight();
            }
            else{
                x2 += offsetElement.offsetWidth;
                y2 += offsetElement.offsetHeight;
            }
            if(x1 < ASPx.GetDocumentScrollLeft())
                x1 = ASPx.GetDocumentScrollLeft();
            if(y1 < ASPx.GetDocumentScrollTop())
                y1 = ASPx.GetDocumentScrollTop();
            if(x2 > ASPx.GetDocumentScrollLeft() + ASPx.GetDocumentClientWidth())
                x2 = ASPx.GetDocumentScrollLeft() + ASPx.GetDocumentClientWidth();
            if(y2 > ASPx.GetDocumentScrollTop() + ASPx.GetDocumentClientHeight())
                y2 = ASPx.GetDocumentScrollTop() + ASPx.GetDocumentClientHeight();

            x = x1 + ((x2 - x1 - loadingPanel.offsetWidth) / 2);
            y = y1 + ((y2 - y1 - loadingPanel.offsetHeight) / 2);
        }
        if(ASPx.IsExists(offsetX) && ASPx.IsExists(offsetY)){
            x += offsetX;
            y += offsetY;
        }
        x = ASPx.PrepareClientPosForElement(x, loadingPanel, true);
        y = ASPx.PrepareClientPosForElement(y, loadingPanel, false);
        if(ASPx.Browser.IE && ASPx.Browser.Version > 8) {
            x = Math.round(x);
            y = Math.round(y);
        }
        ASPx.SetStyles(loadingPanel, { left: x, top: y });
    },
    GetLoadingDiv: function(){
        return ASPx.GetElementById(this.name + "_LD");
    },
    CreateLoadingDiv: function(parentElement, offsetElement){
        if(this.ShouldHideExistingLoadingElements())
            this.HideLoadingDiv();
        if(parentElement == null) 
            return null;
        if(!this.IsLoadingContainerVisible()) {
            this.hasPhantomLoadingElements = true;
            return null;
        }

        if(!offsetElement)
            offsetElement = parentElement;
        var div = this.GetLoadingDiv();
        if(div != null){
            div = div.cloneNode(true);
            parentElement.appendChild(div);
            ASPx.SetElementDisplay(div, true);
            ASPx.Evt.AttachEventToElement(div, ASPx.TouchUIHelper.touchMouseDownEventName, ASPx.Evt.PreventEvent);
            ASPx.Evt.AttachEventToElement(div, ASPx.TouchUIHelper.touchMouseMoveEventName, ASPx.Evt.PreventEvent);
            ASPx.Evt.AttachEventToElement(div, ASPx.TouchUIHelper.touchMouseUpEventName, ASPx.Evt.PreventEvent);
            ASPx.Evt.AttachEventToElement(div, ASPx.Evt.GetMouseWheelEventName(), ASPx.Evt.PreventEvent);
            this.SetLoadingDivBounds(offsetElement, div);
            this.loadingDivElement = div;
            this.SetInitialLoadingDivOpacity();
            return div;
        }
        return null;
    },
    SetInitialLoadingDivOpacity: function() {
        if(!this.loadingDivElement) return;

        ASPx.Attr.SaveStyleAttribute(this.loadingDivElement, "opacity");
        ASPx.Attr.SaveStyleAttribute(this.loadingDivElement, "filter");
        ASPx.SetElementOpacity(this.loadingDivElement, 0.01);
    },
    RestoreLoadingDivOpacity: function() {
        if(!this.loadingDivElement) return;
       
        ASPx.Attr.RestoreStyleAttribute(this.loadingDivElement, "opacity");
        ASPx.Attr.RestoreStyleAttribute(this.loadingDivElement, "filter");
    },
    SetLoadingDivBounds: function(offsetElement, loadingDiv) {
        var absX = (offsetElement == document.body) ? 0 : ASPx.GetAbsoluteX(offsetElement);
        var absY = (offsetElement == document.body) ? 0 : ASPx.GetAbsoluteY(offsetElement);
        ASPx.SetStyles(loadingDiv, {
            left: ASPx.PrepareClientPosForElement(absX, loadingDiv, true),
            top: ASPx.PrepareClientPosForElement(absY, loadingDiv, false)
        });
        var width = (offsetElement == document.body) ? ASPx.GetDocumentWidth() : offsetElement.offsetWidth;
        var height = (offsetElement == document.body) ? ASPx.GetDocumentHeight() : offsetElement.offsetHeight;
        if(height < 0) // B148866
            height = 0;
        ASPx.SetStyles(loadingDiv, { width: width, height: height });
        var correctedWidth = 2 * width - loadingDiv.offsetWidth;
        if(correctedWidth <= 0) correctedWidth = width;
        var correctedHeight = 2 * height - loadingDiv.offsetHeight;
        if(correctedHeight <= 0) correctedHeight = height;
        ASPx.SetStyles(loadingDiv, { width: correctedWidth, height: correctedHeight });
    },
    ShowLoadingDiv: function() {
    },
    HideLoadingDiv: function() {
        this.hasPhantomLoadingElements = false;
        if(ASPx.IsExistsElement(this.loadingDivElement)){
            ASPx.RemoveElement(this.loadingDivElement);
            this.loadingDivElement = null;
        }
    },
    CanHandleGesture: function(evt) {
        return false;
    },
    CanHandleGestureCore: function(evt) {
        var source = ASPx.Evt.GetEventSource(evt);
        if(ASPx.GetIsParent(this.loadingPanelElement, source) || ASPx.GetIsParent(this.loadingDivElement, source))
            return true; 
        var callbackAnimationElement = this.GetCallbackAnimationElement();
        if(!callbackAnimationElement)
            return false;
        var animationContainer = ASPx.AnimationHelper.getSlideAnimationContainer(callbackAnimationElement, false, false);
        if(animationContainer && ASPx.GetIsParent(animationContainer, source) && !ASPx.GetIsParent(animationContainer.childNodes[0], source))
            return true; 
        return this.CanHandleGesture(evt); 
    },
    AllowStartGesture: function() {
        return !this.beginCallbackAnimationProcessing && !this.endCallbackAnimationProcessing;
    },
    StartGesture: function() {
    },
    AllowExecuteGesture: function(value) {
        return false;
    },
    ExecuteGesture: function(value) {
    },
    CancelGesture: function(value) {
        if(this.repeatedGestureCount === 0) {
            this.repeatedGestureValue = value;
            this.repeatedGestureCount = 1;
        }
        else {
            if(this.repeatedGestureValue * value > 0)
                this.repeatedGestureCount++;
            else
                this.repeatedGestureCount--;
            if(this.repeatedGestureCount === 0)
                this.repeatedGestureCount = 0;
        }
    },
    CheckRepeatGesture: function() {
        if(this.repeatedGestureCount !== 0) {
            if(this.AllowExecuteGesture(this.repeatedGestureValue))
                this.ExecuteGesture(this.repeatedGestureValue, this.repeatedGestureCount);
            this.repeatedGestureValue = 0;
            this.repeatedGestureCount = 0;
        }
    },
    AllowExecutePagerGesture: function (pageIndex, pageCount, value) {
        if(pageIndex < 0) return false;
        if(pageCount <= 1) return false;
        if(value > 0 && pageIndex === 0) return false;
        if(value < 0 && pageIndex === pageCount - 1) return false;
        return true;
    },
    ExecutePagerGesture: function(pageIndex, pageCount, value, count, method) {
        if(!count) count = 1;

        var pageIndex = pageIndex + (value < 0 ? count : -count);
        if(pageIndex < 0) pageIndex = 0;
        if(pageIndex > pageCount - 1) pageIndex = pageCount - 1;
        method(PagerCommands.PageNumber + pageIndex);
    },

    RaiseInit: function(){
        if(!this.Init.IsEmpty()){
            var args = new ASPxClientEventArgs();
            this.Init.FireEvent(this, args);
        }
    },
    RaiseBeginCallbackInternal: function(command){
        if(!this.BeginCallback.IsEmpty()){
            var args = new ASPxClientBeginCallbackEventArgs(command);
            this.BeginCallback.FireEvent(this, args);
        }
    },
    RaiseEndCallbackInternal: function(command) {
        if(!this.EndCallback.IsEmpty()){
            var args = new ASPxClientEndCallbackEventArgs(command);
            this.EndCallback.FireEvent(this, args);
        }
    },
    RaiseCallbackErrorInternal: function(message, callbackId) {
        if(!this.CallbackError.IsEmpty()) {
            var args = new ASPxClientCallbackErrorEventArgs(message, callbackId);
            this.CallbackError.FireEvent(this, args);
            if(args.handled)
                return { isHandled: true, errorMessage: args.message };
        }
    },
    RaiseBeginCallback: function(command){
        this.RaiseBeginCallbackInternal(command);       
        aspxGetControlCollection().RaiseBeginCallback(this, command);
    },
    RaiseEndCallback: function(command){
        this.RaiseEndCallbackInternal(command);
        aspxGetControlCollection().RaiseEndCallback(this, command);
    },
    RaiseCallbackError: function (message, callbackId) {
        var result = this.RaiseCallbackErrorInternal(message, callbackId);
        if(!result) 
            result = aspxGetControlCollection().RaiseCallbackError(this, message, callbackId);
        return result;
    },
    RaiseEndCallbackAnimationStart: function(){
        if(!this.EndCallbackAnimationStart.IsEmpty()){
            var args = new ASPxClientEventArgs();
            this.EndCallbackAnimationStart.FireEvent(this, args);
        }
    },
    RaiseBeforePronounce: function(message) {
        var args = new ASPxClientControlBeforePronounceEventArgs(message, this);
        if(!this.BeforePronounce.IsEmpty())
            this.BeforePronounce.FireEvent(this, args);
        return args;
    },
    RaiseUnload: function() {
        var args = new ASPxClientControlUnloadEventArgs(this);
        if(!this.Unload.IsEmpty())
            this.Unload.FireEvent(this, args);
    },
    /*# public void SendMessageToAssistiveTechnology(string message) {} #*/
    SendMessageToAssistiveTechnology: function(message) {
        if(!this.accessibilityCompliant)
            return;
        this.PronounceMessageInternal(message, ASPx.AccessibilityPronouncerType.live);
    },
    PronounceMessageInternal: function(messageArg, type) {
        var message = messageArg;
        if(!ASPx.Ident.IsArray(messageArg))
            message = [messageArg];
        var args = this.RaiseBeforePronounce(message);
        ASPx.AccessibilityPronouncer.Pronounce(args, type);
    },
    IsVisible: function() {
        var element = this.GetMainElement();
        return ASPx.IsElementVisible(element);
    },
    IsDisplayedElement: function(element) {
        while(element && element.tagName != "BODY") {
            if(!ASPx.GetElementDisplay(element)) 
                return false;
            element = element.parentNode;
        }
        return true;
    },
    IsDisplayed: function() {
        return this.IsDisplayedElement(this.GetMainElement());
    },
    IsHiddenElement: function(element) {
        return element && element.offsetWidth == 0 && element.offsetHeight == 0;
    },
    IsHidden: function() {
        return this.IsHiddenElement(this.GetMainElement());
    },

    /*# public object GetParentControl() { return null; } #*/
    GetParentControl: function() {
        var mainElement = this.GetMainElement() || (this.GetCurrentWindowElement && this.GetCurrentWindowElement());
        var popupPostfix = ASPx.PCWIdSuffix + "-1";
        var result = null;
        ASPx.GetParent(mainElement, function(element) {
            if(element === mainElement || !element.id)
                return false;
            var controlName = element.id.replace(popupPostfix, "");
            result = ASPx.GetControlCollection().Get(controlName);
            return !!result;
        });
        return result;
    },
    findParentByType: function (type) {
        var ctrl = this;
        while (ctrl) {
            var parent = ctrl.GetParentControl();
            if (parent && parent instanceof type)
                return parent;
            ctrl = parent;
        }
        return null;
    },
    Focus: function() {
    
    },
    /*# [Obsolete("Use the GetVisible method instead.")]public bool GetClientVisible() { return false; } #*/    
    GetClientVisible: function(){
        return this.GetVisible();
    },
    /*# [Obsolete("Use the SetVisible method instead.")]public void SetClientVisible(bool visible) {} #*/
    SetClientVisible: function(visible){
        this.SetVisible(visible);
    },
    /*# public bool GetVisible() { return false; } #*/    
    GetVisible: function(){
        return this.clientVisible;
    },
    /*# public void SetVisible(bool visible) {} #*/
    SetVisible: function(visible){
        if(this.clientVisible != visible){
            this.clientVisible = visible;
            ASPx.SetElementDisplay(this.GetMainElement(), visible);
            if(visible) {
                this.AdjustControl();
                
                var mainElement = this.GetMainElement();
                if(mainElement)
                    aspxGetControlCollection().AdjustControls(mainElement);
            }
        }
    },
    GetEnabled: function() {
        return this.clientEnabled;
    },
    SetEnabled: function(enabled) {
        this.clientEnabled = enabled;

        if(ASPxClientControl.setEnabledLocked)
            return;
        else
            ASPxClientControl.setEnabledLocked = true;

        this.savedClientEnabled = enabled;
        aspxGetControlCollection().ProcessControlsInContainer(this.GetMainElement(), function(control) {
            if(ASPx.IsFunction(control.SetEnabled))
                control.SetEnabled(enabled && control.savedClientEnabled);
        });

        delete ASPxClientControl.setEnabledLocked;
    },
    /*# public bool InCallback() { return false; } #*/        
    InCallback: function() {
        return this.requestCount > 0;
    },
    DoBeginCallback: function(command) {
        this.RaiseBeginCallback(command || "");

        aspxGetControlCollection().Before_WebForm_InitCallback(this.name);
        if(typeof(WebForm_InitCallback) != "undefined" && WebForm_InitCallback) {
            __theFormPostData = "";
            __theFormPostCollection = [ ];
            this.ClearPostBackEventInput("__EVENTTARGET");
            this.ClearPostBackEventInput("__EVENTARGUMENT");
            WebForm_InitCallback();
            this.savedFormPostData = __theFormPostData;            
            this.savedFormPostCollection = __theFormPostCollection;
        }
    },
    ClearPostBackEventInput: function(id){
        var element = ASPx.GetElementById(id);
        if(element != null) element.value = "";
    },
    PerformDataCallback: function(arg, handler) {
        this.CreateCustomDataCallback(arg, "", handler);
    },
    sendCallbackViaQueue: function (prefix, arg, showLoadingPanel, context, handler, onBeforeSend) {
        if (!this.useCallbackQueue())
            return false;
        var context = context || this;
        var token = this.callbackQueueHelper.sendCallback(ASPx.FormatCallbackArg(prefix, arg), context, handler || context.OnCallback, prefix, onBeforeSend);
        if (showLoadingPanel)
            this.callbackQueueHelper.showLoadingElements();
        return token;
    },
    CreateCallback: function (arg, command, handler) {
        var callbackInfo = this.CreateCallbackInfo(ASPx.CallbackType.Common, handler || null);
        var callbackID = this.CreateCallbackByInfo(arg, command, callbackInfo);
        return callbackID;
    },
    CreateCustomDataCallback: function(arg, command, handler) {
        var callbackInfo = this.CreateCallbackInfo(ASPx.CallbackType.Data, handler);
        this.CreateCallbackByInfo(arg, command, callbackInfo);
    },
    CreateCallbackByInfo: function(arg, command, callbackInfo) {
        if(!this.CanCreateCallback()) return;
        var callbackID;
        if(typeof(WebForm_DoCallback) != "undefined" && WebForm_DoCallback && ASPx.documentLoaded || ASPx.Platform === "NETCORE")
            callbackID = this.CreateCallbackInternal(arg, command, true, callbackInfo);
        else {
            if(!this.savedCallbacks)
                this.savedCallbacks = [];
            var callbackInfo = { arg: arg, command: command, callbackInfo: callbackInfo };
            if(this.allowMultipleCallbacks)
                this.savedCallbacks.push(callbackInfo);
            else
                this.savedCallbacks[0] = callbackInfo;
        }
        return callbackID;
    },
    CreateCallbackInternal: function(arg, command, viaTimer, callbackInfo) {
        var watcher = ASPx.ControlUpdateWatcher.getInstance();
        if(watcher && !watcher.CanSendCallback(this, arg)) {
            this.CancelCallbackInternal();
            return;
        }
        this.requestCount++;
        this.DoBeginCallback(command);
        
        if(typeof(arg) == "undefined")
            arg = "";
        if(typeof(command) == "undefined")
            command = "";
        
        var callbackID = this.SaveCallbackInfo(callbackInfo, command),
            customArgs = this.GetCustomCallbackArgs();
        if(viaTimer)
            window.setTimeout(function() { this.CreateCallbackCoreWithCustomArgs(arg, command, callbackID, customArgs); }.aspxBind(this), 0);
        else
            this.CreateCallbackCoreWithCustomArgs(arg, command, callbackID, customArgs);
        return callbackID;
    },
    CreateCallbackCoreWithCustomArgs: function(arg, command, callbackID, customArgs) {
        this.CreateCallbackCore(arg, command, callbackID);
    },
    GetCustomCallbackArgs: function() {
        return {};
    },
    CancelCallbackInternal: function() {
        this.CancelCallbackCore();
        this.HideLoadingElements();
    },
    CancelCallbackCore: function() {
    },
    CreateCallbackCore: function(arg, command, callbackID) {
        var callBackMethod = this.GetCallbackMethod(command);
        __theFormPostData = this.savedFormPostData;
        __theFormPostCollection = this.savedFormPostCollection;
        callBackMethod.call(this, this.GetSerializedCallbackInfoByID(callbackID) + arg);
    },
    GetCallbackMethod: function(command){
        return this.callBack;
    },
    CanCreateCallback: function() {
        return !this.InCallback() || (this.allowMultipleCallbacks && !this.beginCallbackAnimationProcessing && !this.endCallbackAnimationProcessing);
    },
    DoLoadCallbackScripts: function() {
        ASPx.ProcessScriptsAndLinks(this.name, true);
    },
    DoEndCallback: function() {
        if(this.IsCallbackAnimationEnabled() && this.CheckEndCallbackAnimationNeeded()) 
            return;

        this.requestCount--;
        if (this.requestCount < 1) 
            this.callbackHandlersQueue.executeCallbacksHandlers();
        if(this.HideLoadingPanelOnCallback() && this.requestCount < 1) 
            this.HideLoadingElements();

        if(this.isSwipeGesturesEnabled() && this.supportGestures) {
            ASPx.GesturesHelper.UpdateSwipeAnimationContainer(this.name);
            if(this.touchUIMouseScroller)
                this.touchUIMouseScroller.update();
        }
        this.isCallbackAnimationPrevented = false;

        this.OnCallbackFinalized();
        this.AssignEllipsisTooltips();

        var command = this.GetCallbackCommand();
        this.RaiseEndCallback(command);
        this.currentCallbackID = -1;
    },
    DoFinalizeCallback: function() {
    },
    OnCallbackFinalized: function() {
    },
    AssignEllipsisTooltips: function() { },
    GetCallbackCommand: function() {
        var result = "";
        if(this.currentCallbackID != -1) {
            var command = this.callbackCommand[this.currentCallbackID];
            if(command)
                result = command;
        }
        return result;
    },
    HideLoadingPanelOnCallback: function() {
        return true;
    },
	ShouldHideExistingLoadingElements: function() {
        return true;
    },
    EvalCallbackResult: function(resultString){
        return eval(resultString);
    },
    ParseJSProperties: function(resultObj) {
        if(resultObj.cp) {
            for(var name in resultObj.cp)
                if(resultObj.cp.hasOwnProperty(name)) {
                    this[name] = resultObj.cp[name];
                    if(this.aspNetCoreWrapperInstance)
                        this.aspNetCoreWrapperInstance[name] = resultObj.cp[name]; 
                }
        }
    },
    DoCallback: function(result) {
        if(this.IsCallbackAnimationEnabled() && this.CheckBeginCallbackAnimationInProgress(result))
            return;

        result = ASPx.Str.Trim(result);
        if(result.indexOf(ASPx.CallbackResultPrefix) != 0) 
            this.ProcessCallbackGeneralError(result, false);
        else {
            var resultObj = null;
            try {
                resultObj = this.EvalCallbackResult(result);
            } 
            catch(e) {
                // B36430
            }
            if(resultObj) {
                this.currentCallbackID = resultObj.id;
                ASPx.CacheHelper.DropCache(this);

                if(resultObj.redirect) {
                    this.ParseJSProperties(resultObj); //T547999
                    ASPx.Url.Redirect(resultObj.redirect);
                }
                else if(ASPx.IsExists(resultObj.generalError)) {
                    this.ProcessCallbackGeneralError(resultObj.generalError, true);
                }
                else {
                    var errorObj = resultObj.error;
                    if(errorObj) { 
                        if(this.parseJSPropertiesOnCallbackError)
                            this.ParseJSProperties(resultObj);
                        this.ProcessCallbackError(errorObj,resultObj.id);
                    } else {
                        this.ParseJSProperties(resultObj);
                        var callbackInfo = this.DequeueCallbackInfo(resultObj.id);
                        if(callbackInfo && callbackInfo.type == ASPx.CallbackType.Data)
                            this.ProcessCustomDataCallback(resultObj.result, callbackInfo);
                        else {
                            if (this.useCallbackQueue() && this.callbackQueueHelper.getCallbackInfoById(resultObj.id))
                                this.callbackQueueHelper.processCallback(resultObj.result, resultObj.id);
                            else {
                                this.ProcessCallback(resultObj.result, resultObj.id);
                                if(callbackInfo && callbackInfo.handler) {
                                    var handlerInfo = { handler: callbackInfo.handler, result: resultObj.result.data };
                                    this.callbackHandlersQueue.addCallbackHandler(handlerInfo);
                                }
                            }
                        }
                    }
                    
                }
            }
        }
        // B156350, B148956, B204609
        this.DoLoadCallbackScripts();
    },
    DoCallbackError: function(result) {
        this.HideLoadingElements();
        this.ProcessCallbackGeneralError(result, false); // B191862
    },
    DoControlClick: function(evt) {
        this.OnControlClick(ASPx.Evt.GetEventSource(evt), evt);
    },
    ProcessCallback: function (result, callbackId) {
        this.OnCallback(result, callbackId);
    },
    ProcessCustomDataCallback: function(result, callbackInfo) {
        if(callbackInfo.handler != null)
            callbackInfo.handler(this, result);
        this.RaiseCustomDataCallback(result);
    },
    RaiseCustomDataCallback: function(result) {
        if(!this.CustomDataCallback.IsEmpty()) {
            var arg = new ASPxClientCustomDataCallbackEventArgs(result);
            this.CustomDataCallback.FireEvent(this, arg);
        }
    },
    OnCallback: function(result) {
    
    },
    CreateCallbackInfo: function(type, handler) {
        return { type: type, handler: handler };
    },
    GetSerializedCallbackInfoByID: function(callbackID) {
        return this.GetCallbackInfoByID(callbackID).type + callbackID + ASPx.CallbackSeparator;
    },
    SaveCallbackInfo: function(info, command) {
        var callbacks = this.GetActiveCallbacksInfo();
        var index = callbacks.indexOf(null);
        if(index === -1)
            index = callbacks.length;
        callbacks[index] = info;
        this.callbackCommand[index] = command;
        return index;
    },
    GetActiveCallbacksInfo: function() {
        var persistentProperties = this.GetPersistentProperties();
        if(!persistentProperties.activeCallbacks)
            persistentProperties.activeCallbacks = [ ];
        return persistentProperties.activeCallbacks;
    },
    GetPersistentProperties: function() {
        var storage = _aspxGetPersistentControlPropertiesStorage();
        var persistentProperties = storage[this.name];
        if(!persistentProperties) {
            persistentProperties = { };
            storage[this.name] = persistentProperties;
        }
        return persistentProperties;
    },
    GetCallbackInfoByID: function(callbackID) {
        return this.GetActiveCallbacksInfo()[callbackID];
    },
    DequeueCallbackInfo: function(index) {
        var activeCallbacksInfo = this.GetActiveCallbacksInfo();
        if(index < 0 || index >= activeCallbacksInfo.length)
            return null;
        var result = activeCallbacksInfo[index];
        activeCallbacksInfo[index] = null;
        return result;
    },
    ProcessCallbackError: function (errorObj, callbackId) {
        var data = ASPx.IsExists(errorObj.data) ? errorObj.data : null;
        var result = this.RaiseCallbackError(errorObj.message, callbackId);
        if(result.isHandled)
            this.OnCallbackErrorAfterUserHandle(result.errorMessage, data);    
        else
            this.OnCallbackError(result.errorMessage, data);    
    },
    OnCallbackError: function(errorMessage, data) {
        if(errorMessage)
            ASPx.ShowErrorAlert(errorMessage);
    },
    OnCallbackErrorAfterUserHandle: function(errorMessage, data) {
    },
    ProcessCallbackGeneralError: function(errorMessage, serverExceptionOnLastCallback) {
        this.serverExceptionOnLastCallback = serverExceptionOnLastCallback;
        var result = this.RaiseCallbackError(errorMessage);
        if(result.isHandled)
            this.OnCallbackGeneralErrorAfterUserHandle(result.errorMessage);
        else
            this.OnCallbackGeneralError(result.errorMessage);
    },
    OnCallbackGeneralError: function(errorMessage) {
        this.OnCallbackError(errorMessage, null);
    },
    OnCallbackGeneralErrorAfterUserHandle: function (errorMessage) {
    },

    SendPostBack: function(params, preventConvertToUpdatePanelCallback) {
        if(preventConvertToUpdatePanelCallback)
            this.sendMSAjaxCompatPostBack(params);
        else
            this.sendPostBackInternal(params);
    },
    sendPostBackInternal: function(params) {
        if(typeof(__doPostBack) != "undefined")
            __doPostBack(this.uniqueID, params);
        else{
            var form = this.GetParentForm();
            if(form) form.submit();
        }
    },
    sendMSAjaxCompatPostBack: function(params) {
        var rm = ASPx.GetMSAjaxRequestManager();
        var triggers = rm ? rm._postBackControlClientIDs : null;
        var needRegister = triggers && ASPx.Ident.IsArray(triggers) && ASPx.Data.ArrayIndexOf(triggers, this.name) == -1;
        if(needRegister)
            triggers.unshift(this.name);
        this.sendPostBackInternal(params);
        if(needRegister)
            triggers.shift();
    },

    IsValidInstance: function () {
        return aspxGetControlCollection().GetByName(this.name) === this;
    },
    OnDispose: function() { 
        var varName = this.globalName;
        if(varName && varName !== "" && window && window[varName] && window[varName] == this){
            try{
                delete window[varName];
            }
            catch(e){ /* For IE8 */ }
        }
        if(this.callbackQueueHelper)
            this.callbackQueueHelper.detachEvents();
    },

    OnGlobalControlsInitialized: function(args) { 
    },
    OnGlobalBrowserWindowResized: function(args) { 
    },
    OnGlobalBeginCallback: function(args) { 
    },
    OnGlobalEndCallback: function(args) { 
    },
    OnGlobalCallbackError: function(args) { 
    },
    OnGlobalValidationCompleted: function(args) { 
    },

    AddDefaultStateControllerItems: function() {
        var states = this.scStates;
        if(!states) return;
        var postfix = this.scPostfix ? ("_" + this.scPostfix) : "";
        var mainElementId = this.GetMainElementId();
        if(states & 2)
            this.AddDefaultReadOnlyStateControllerItem(this.scPrefix + "ReadOnly" + postfix, mainElementId);
        if(states & 4)
            this.AddDefaultDisabledStateControllerItem(this.scPrefix + "Disabled" + postfix, mainElementId);
    },
    AddDefaultReadOnlyStateControllerItem: function(cssClass, mainElementId) { throw "Not implemented"; },
    AddDefaultDisabledStateControllerItem: function(cssClass, mainElementId) { throw "Not implemented"; },

    // from ClientControl:
    DOMContentLoaded: function() { },
    IsStateControllerEnabled: function() { return false; },
    InitializeDOM: function() {
        var mainElement = this.GetMainElement();
        if(mainElement)
            ASPx.SetElementInitializedFlag(mainElement);
    },
    IsDOMInitialized: function() {
        var mainElement = this.GetMainElement();
        return mainElement && ASPx.GetElementInitializedFlag(mainElement);
    },
    AdjustControl: function(nestedCall) { },
    OnBrowserWindowResizeInternal: function(e) { },
    RegisterInControlTree: function(tree) { }
});

/*# public static ASPxClientControlBase Cast(object obj){ return null; } #*/ 
ASPxClientControlBase.Cast = function(obj) {
    if(typeof obj == "string")
        return window[obj];
    return obj;
};

var persistentControlPropertiesStorage = null;
function _aspxGetPersistentControlPropertiesStorage() {
    if(persistentControlPropertiesStorage == null)
        persistentControlPropertiesStorage = { };
    return persistentControlPropertiesStorage;
}

var ELLIPSIS_MARKER_CLASS = "dx-ellipsis";
var ELLIPSIS_TOOLTIP_MARKER_ATTR = "dxEllipsisTitle";
/*# public class ASPxClientControl: ASPxClientControlBase #*/
var ASPxClientControl = ASPx.CreateClass(ASPxClientControlBase, {
    constructor: function(name){
        this.constructor.prototype.constructor.call(this, name);
        
        this.rtl = false;
        this.enableEllipsis = false;

        this.isNative = false;

        this.isControlCollapsed = false;
        this.isInsideHierarchyAdjustment = false;
        this.controlOwner = null;
        this.adjustedSizes = { };
        
        this.dialogContentHashTable = { };
        this.renderIFrameForPopupElements = false;
        this.widthValueSetInPercentage = false;
        this.heightValueSetInPercentage = false;
        this.verticalAlignedElements = { };
        this.wrappedTextContainers = { };
        this.scrollPositionState = { };

        this.sizingConfig = {
            allowSetWidth: true,
            allowSetHeight: true,
            correction : false,
            adjustControl : false,
            supportPercentHeight: false,
            supportAutoHeight: false
        };

        this.percentSizeConfig = {
            width: -1,
            height: -1,
            markerWidth: -1,
            markerHeight: -1
        };        
    },
    querySelector: function(selector) { return this.querySelectorAll(selector)[0] || null; },
    querySelectorAll: function(selector) {
        return ASPx.CacheHelper.GetCachedElement(this, "querySelectorAll_" + selector,
            function() { return Array.prototype.slice.call(this.GetMainElement().querySelectorAll(selector)); });
    },
    createAccessKey: function (popupItem, getPopupElement, keyTipElement, key, onlyClick, manualStopProcessing) {
        return new ASPx.AccessKey(popupItem, getPopupElement, keyTipElement, key, onlyClick, manualStopProcessing);
    },
    InlineInitialize: function() {
        this.InitializeDOM();
        ASPxClientControlBase.prototype.InlineInitialize.call(this);
    },

    AfterCreate: function() { // Don't override it
        ASPxClientControlBase.prototype.AfterCreate.call(this);

        if(!this.CanInitializeAdjustmentOnDOMContentLoaded() || ASPx.IsStartupScriptsRunning())
            this.InitializeAdjustment();
    },
    DOMContentLoaded: function() {
        if(this.CanInitializeAdjustmentOnDOMContentLoaded()) 
            this.InitializeAdjustment();
    },
    CanInitializeAdjustmentOnDOMContentLoaded: function() {
        return !ASPx.Browser.IE || ASPx.Browser.Version >= 10; // IE9- browsers flick if adjust control bounds on DOMContentLoaded
    },
    InitializeAdjustment: function() {
        this.UpdateAdjustmentFlags();
        this.AdjustControl();
    },
    AfterInitialize: function() {
        this.AdjustControl();
        ASPxClientControlBase.prototype.AfterInitialize.call(this);
    },

    IsStateControllerEnabled: function(){
        return typeof(ASPx.GetStateController) != "undefined" && ASPx.GetStateController();
    },
    
    // Sizes
    /*# public int GetWidth() { return 0; } #*/
    GetWidth: function() {
        return this.GetMainElement().offsetWidth;
    },
    /*# public int GetHeight() { return 0; } #*/
    GetHeight: function() {
        return this.GetMainElement().offsetHeight;
    },
    /*# public void SetWidth(int width) { } #*/
    SetWidth: function(width) {
        if(this.sizingConfig.allowSetWidth)
            this.SetSizeCore("width", width, "GetWidth", false);
    },
    /*# public void SetHeight(int height) { } #*/
    SetHeight: function(height) {
        if(this.sizingConfig.allowSetHeight)
            this.SetSizeCore("height", height, "GetHeight", false);
    },
    SetSizeCore: function(sizePropertyName, size, getFunctionName, corrected) {
        if(size < 0)
            return;
            
        this.GetMainElement().style[sizePropertyName] = size + "px";
        this.UpdateAdjustmentFlags(sizePropertyName);
        if(this.sizingConfig.adjustControl)
            this.AdjustControl(true);
        
        if(this.sizingConfig.correction && !corrected) {
            var realSize = this[getFunctionName]();
            if(realSize != size) {
                var correctedSize = size - (realSize - size);
                this.SetSizeCore(sizePropertyName, correctedSize, getFunctionName, true);
            }
        }
    },
    
    // Size correction
    /*# public void AdjustControl() { } #*/
    AdjustControl: function(nestedCall) {
        if(this.IsAdjustmentRequired() && (!ASPxClientControl.adjustControlLocked || nestedCall)) {
            ASPxClientControl.adjustControlLocked = true;
            try {
                if(!this.IsAdjustmentAllowed())
                    return;
            
                this.AdjustControlCore();
                this.UpdateAdjustedSizes();
            } 
            finally {
                delete ASPxClientControl.adjustControlLocked;
            }
        }
        this.AssignEllipsisTooltips();
        this.TryShowPhantomLoadingElements();
    },
    ResetControlAdjustment: function () {
        this.adjustedSizes = { };
    },
	UpdateAdjustmentFlags: function(sizeProperty) {
		var mainElement = this.GetMainElement();
	    if(mainElement) {
	        var mainElementStyle = ASPx.GetCurrentStyle(mainElement);
            this.UpdatePercentSizeConfig([mainElementStyle.width, mainElement.style.width], [mainElementStyle.height, mainElement.style.height], sizeProperty);
	    }
	},
    UpdatePercentSizeConfig: function(widths, heights, modifyStyleProperty) {
        switch(modifyStyleProperty) {
            case "width":
                this.UpdatePercentWidthConfig(widths);
                break;
            case "height":
                this.UpdatePercentHeightConfig(heights);
                break;
            default:
                this.UpdatePercentWidthConfig(widths);
                this.UpdatePercentHeightConfig(heights);
                break;
        }
        this.ResetControlPercentMarkerSize();
    },
    UpdatePercentWidthConfig: function(widths) {
        this.widthValueSetInPercentage = false;
        for(var i = 0; i < widths.length; i++) {
            if(this.IsPercentageWidth(widths[i])) {
                this.percentSizeConfig.width = widths[i];
                this.widthValueSetInPercentage = true;
                break;
            }
        }
    },
    IsPercentageWidth: function(width) { return ASPx.IsPercentageSize(width); },
    UpdatePercentHeightConfig: function(heights) {
        this.heightValueSetInPercentage = false;
                for(var i = 0; i < heights.length; i++) {
            if(ASPx.IsPercentageSize(heights[i])) {
                this.percentSizeConfig.height = heights[i];
                this.heightValueSetInPercentage = true;
                break;
            }
        }
    },
    GetAdjustedSizes: function() {
		var mainElement = this.GetMainElement();
	    if(mainElement) 
            return { width: mainElement.offsetWidth, height: mainElement.offsetHeight };
        return { width: 0, height: 0 };
    },
    IsAdjusted: function() {
        return (this.adjustedSizes.width && this.adjustedSizes.width > 0) && (this.adjustedSizes.height && this.adjustedSizes.height > 0);
    },
	IsAdjustmentRequired: function() {
        if(!this.IsAdjusted())
            return true;
        if(this.widthValueSetInPercentage)
            return true;
        if(this.heightValueSetInPercentage)
            return true;

        var sizes = this.GetAdjustedSizes();
        for(var name in sizes){
            if(this.adjustedSizes[name] !== sizes[name])
                return true;
        }

        return false;
	},
    IsAdjustmentAllowed: function() {
        var mainElement = this.GetMainElement();
        return mainElement && this.IsDisplayed() && !this.IsHidden() && this.IsDOMInitialized();
    },
	UpdateAdjustedSizes: function() {
        var sizes = this.GetAdjustedSizes();
        for(var name in sizes)
            if(sizes.hasOwnProperty(name))
                this.adjustedSizes[name] = sizes[name];
	},
    AdjustControlCore: function() {
    },
    AdjustAutoHeight: function() {
    },
    IsControlCollapsed: function() {
        return this.isControlCollapsed;
    },
    NeedCollapseControl: function() {
        return this.NeedCollapseControlCore() && this.IsAdjustmentRequired() && this.IsAdjustmentAllowed();
    },
    NeedCollapseControlCore: function() {
        return false;
    },
    CollapseEditor: function() {
    },
    CollapseControl: function() {
        this.SaveScrollPositions();

        var mainElement = this.GetMainElement(),
            marker = this.GetControlPercentSizeMarker();

        marker.style.height = this.heightValueSetInPercentage && this.sizingConfig.supportPercentHeight
            ? this.percentSizeConfig.height 
            : (mainElement.offsetHeight + "px");
        
        mainElement.style.display = "none";
        this.isControlCollapsed = true;
    },
    ExpandControl: function() {
        var mainElement = this.GetMainElement();
        mainElement.style.display = "";
        this.GetControlPercentSizeMarker().style.height = "0px";
        this.isControlCollapsed = false;
        
        this.RestoreScrollPositions();
    },
    CanCauseReadjustment: function() {
        return this.NeedCollapseControlCore();
    },
    IsExpandableByAdjustment: function() {
        return false;
    },
    HasFixedPosition: function() {
        return false;
    },
    SaveScrollPositions: function() {
        var mainElement = this.GetMainElement();
        this.scrollPositionState.outer = ASPx.GetOuterScrollPosition(mainElement.parentNode);
        this.scrollPositionState.inner = ASPx.GetInnerScrollPositions(mainElement);
    },
    RestoreScrollPositions: function() {
        ASPx.RestoreOuterScrollPosition(this.scrollPositionState.outer);
        ASPx.RestoreInnerScrollPositions(this.scrollPositionState.inner);
    },
    GetControlPercentSizeMarker: function() {
        if(this.percentSizeMarker === undefined) {
            this.percentSizeMarker = ASPx.CreateHtmlElementFromString("<div style='height:0px;font-size:0px;line-height:0;width:100%;'></div>");
            ASPx.InsertElementAfter(this.percentSizeMarker, this.GetMainElement());
        }
        return this.percentSizeMarker;
    },
    KeepControlPercentSizeMarker: function(needCollapse, needCalculateHeight) {
        var marker = this.GetControlPercentSizeMarker(),
            markerHeight;

        if(needCollapse)
            this.CollapseControl();
        if(this.widthValueSetInPercentage && marker.style.width !== this.percentSizeConfig.width)
            marker.style.width = this.percentSizeConfig.width;
        
        if(needCalculateHeight) {
            if(this.IsControlCollapsed())
                markerHeight = marker.style.height;
            marker.style.height = this.percentSizeConfig.height;
        }
        this.percentSizeConfig.markerWidth = marker.offsetWidth;
        if(needCalculateHeight) {
            this.percentSizeConfig.markerHeight = marker.offsetHeight;
            if(this.IsControlCollapsed())
                marker.style.height = markerHeight;
            else
                marker.style.height = "0px";
        }

        if(needCollapse)
            this.ExpandControl();
    },
    ResetControlPercentMarkerSize: function() {
        this.percentSizeConfig.markerWidth = -1;
        this.percentSizeConfig.markerHeight = -1;
    },
    GetControlPercentMarkerSize: function(hideControl, force) {
        var needCalculateHeight = this.heightValueSetInPercentage && this.sizingConfig.supportPercentHeight;
        if(force || this.percentSizeConfig.markerWidth < 1 || (needCalculateHeight && this.percentSizeConfig.markerHeight < 1))
            this.KeepControlPercentSizeMarker(hideControl && !this.IsControlCollapsed(), needCalculateHeight);
        return {
            width: this.percentSizeConfig.markerWidth,
            height: this.percentSizeConfig.markerHeight
        };
    },

    // Ellipsis
    AssignEllipsisTooltips: function() {
        if(this.RequireAssignTooltips())
            this.AssignEllipsisTooltipsCore();
    },
    AssignEllipsisTooltipsCore: function(rootElement, reassingExistingTooltips) {
        var requirePaddingManipulation = ASPx.Browser.IE || ASPx.Browser.Edge || ASPx.Browser.Firefox;
        rootElement = rootElement || this.GetMainElement();
        var nodes = this.GetEllipsisNodes(rootElement);
        var nodeInfos = [];
        var nodesCount = nodes.length;

        for(var i = 0; i < nodesCount; i++) {
            var node = nodes[i];
            var info = { node: node };
            if(requirePaddingManipulation) {
                var style = ASPx.GetCurrentStyle(node);
                info.paddingLeft = node.style.paddingLeft;
                info.totalPadding = ASPx.GetLeftRightPaddings(node, style);
            }
            nodeInfos.push(info);
        }
        if(requirePaddingManipulation) {
            for(var i = 0; i < nodesCount; i++) {
                var info = nodeInfos[i];
                ASPx.SetStyles(info.node, { paddingLeft: info.totalPadding }, true);
            }
        }
        for(var i = 0; i < nodesCount; i++) {
            var info = nodeInfos[i];
            var node = info.node;

            info.isTextShortened = node.scrollWidth > node.clientWidth;
            info.hasTitle = ASPx.Attr.GetAttribute(node, "title") !== null;

            if(!info.hasTitle || reassingExistingTooltips)
                info.title = this.GetEllipsisTooltipText(node);
        }
        for(var i = 0; i < nodesCount; i++) {
            var info = nodeInfos[i];
            var node = info.node;

            if(info.isTextShortened && info.title) {
                ASPx.Attr.SetAttribute(node, "title", info.title);
                ASPx.Attr.SetAttribute(node, ELLIPSIS_TOOLTIP_MARKER_ATTR, true);
            }
            if(!info.isTextShortened && info.hasTitle)
                ASPx.Attr.RemoveAttribute(node, "title");
        }
        if(requirePaddingManipulation) {
            for(var i = 0; i < nodesCount; i++) {
                var info = nodeInfos[i];
                var node = info.node;
                node.style.paddingLeft = info.paddingLeft;
            }
        }
    },
    GetEllipsisNodes: function(element) {
        var ellipsibleNodes = ASPx.Data.CollectionToArray(ASPx.GetNodesByClassName(element, ELLIPSIS_MARKER_CLASS));
        if(ASPx.ElementHasCssClass(element, ELLIPSIS_MARKER_CLASS))
            ellipsibleNodes.push(element);
        return ellipsibleNodes.filter(function(node) {
            return !ASPx.Attr.IsExistsAttribute(node, "title") || ASPx.Attr.IsExistsAttribute(node, ELLIPSIS_TOOLTIP_MARKER_ATTR);
        });
    },
    GetEllipsisTooltipText: function(element) {
        return ASPx.GetInnerText(element);
    },
    RequireAssignTooltips: function() {
        return this.enableEllipsis && !ASPx.Browser.MobileUI;
    },
    RemoveEllipsisFromNode: function(node) {
        ASPx.RemoveClassNameFromElement(node, ELLIPSIS_MARKER_CLASS);
        this.RemoveEllipsisTooltip(node);
    },
    RemoveEllipsisTooltip: function(node) {
        if(ASPx.Attr.IsExistsAttribute(node, ELLIPSIS_TOOLTIP_MARKER_ATTR)) {
            ASPx.Attr.RemoveAttribute(node, "title");
            ASPx.Attr.RemoveAttribute(node, ELLIPSIS_TOOLTIP_MARKER_ATTR);
        }
    },
    OnBrowserWindowResize: function(e) {
    },
	OnBrowserWindowResizeInternal: function(e){
        if(this.BrowserWindowResizeSubscriber()) 
            this.OnBrowserWindowResize(e);
    },
    BrowserWindowResizeSubscriber: function() {
        return this.widthValueSetInPercentage || !this.IsAdjusted();
    },
    ShrinkWrappedText: function(getElements, key, reCorrect) {
        if(!ASPx.Browser.Safari) return;
       
        var elements = ASPx.CacheHelper.GetCachedElements(this, key, getElements, this.wrappedTextContainers);
        for(var i = 0; i < elements.length; i++)
            this.ShrinkWrappedTextInContainer(elements[i], reCorrect);
    },
    ShrinkWrappedTextInContainer: function(container, reCorrect) {
        if(!ASPx.Browser.Safari || !container || (container.dxWrappedTextShrinked && !reCorrect) || container.offsetWidth === 0) return;

        ASPx.ShrinkWrappedTextInContainer(container);
        container.dxWrappedTextShrinked = true;
    },
    CorrectWrappedText: function(getElements, key, reCorrect) {
        var elements = ASPx.CacheHelper.GetCachedElements(this, key, getElements, this.wrappedTextContainers);
        for(var i = 0; i < elements.length; i++)
            this.CorrectWrappedTextInContainer(elements[i], reCorrect);
    },
    CorrectWrappedTextInContainer: function(container, reCorrect) {
        if(!container || (container.dxWrappedTextCorrected && !reCorrect) || container.offsetWidth === 0) return;

        ASPx.AdjustWrappedTextInContainer(container);
        container.dxWrappedTextCorrected = true;
    },
    CorrectVerticalAlignment: function(alignMethod, getElements, key, reAlign) {
        var elements = ASPx.CacheHelper.GetCachedElements(this, key, getElements, this.verticalAlignedElements);
        for(var i = 0; i < elements.length; i++)
            this.CorrectElementVerticalAlignment(alignMethod, elements[i], reAlign);
    },
    CorrectElementVerticalAlignment: function(alignMethod, element, reAlign) {
        if(!element || (element.dxVerticalAligned && !reAlign) || element.offsetHeight === 0) return;

        alignMethod(element);
        element.dxVerticalAligned = true;
    },
    ClearVerticalAlignedElementsCache: function() {
        ASPx.CacheHelper.DropCache(this.verticalAlignedElements);
    },
    ClearWrappedTextContainersCache: function() {
        ASPx.CacheHelper.DropCache(this.wrappedTextContainers);
    },
    AdjustPagerControls: function() {
        if(typeof(ASPx.GetPagersCollection) != "undefined")
            ASPx.GetPagersCollection().AdjustControls(this.GetMainElement());
    },
    
    RegisterInControlTree: function(tree) {
        var mainElement = this.GetMainElement();
        if(mainElement && mainElement.id)
            tree.createNode(mainElement.id, this);
    },

    GetItemElementName: function(element) {
        var name = "";
        if(element.id)
            name = element.id.substring(this.name.length + 1);
        return name;
    },
    GetLinkElement: function(element) {
        if(element == null) return null;
        return (element.tagName == "A") ? element : ASPx.GetNodeByTagName(element, "A", 0);
    },
    GetInternalHyperlinkElement: function(parentElement, index) {
        var element = ASPx.GetNodeByTagName(parentElement, "A", index);
        if(element == null) 
            element = ASPx.GetNodeByTagName(parentElement, "SPAN", index);
        return element;
    },

    OnControlClick: function(clickedElement, htmlEvent) {

    }
});

/*# public static ASPxClientControl Cast(object obj){ return null; } #*/ 
ASPxClientControl.Cast = function(obj) {
    if(typeof obj == "string")
        return window[obj];
    return obj;
};
/*# public static void AdjustControls(){ } #*/ 
/*# public static void AdjustControls(object container){ } #*/ 
ASPxClientControl.AdjustControls = function(container, collapseControls){
    aspxGetControlCollection().AdjustControls(container, collapseControls);
};
/*# public static ASPxClientControlCollection GetControlCollection(){return null;} #*/
ASPxClientControl.GetControlCollection = function(){
    return aspxGetControlCollection();
};

ASPxClientControl.LeadingAfterInitCallConsts = {
    None: 0,
    Direct: 1,
    Reverse: 2
};

var ASPxClientComponent = ASPx.CreateClass(ASPxClientControl, {
    constructor: function (name) {
        this.constructor.prototype.constructor.call(this, name);
    },
    IsDOMDisposed: function() { 
        return false;
    }
});

/*# public delegate bool ASPxClientControlPredicate(object control); #*/
/*# public delegate void ASPxClientControlAction(object control); #*/

/*# public class ASPxClientControlCollection: JavaScriptObject #*/
var ASPxClientControlCollection = ASPx.CreateClass(ASPx.CollectionBase, {
    constructor: function(){
        this.constructor.prototype.constructor.call(this);

        this.prevWndWidth = "";
        this.prevWndHeight = "";

        this.requestCountInternal = 0; // for testCafe tests only

        this.BeforeInitCallback = new ASPxClientEvent();
        /*# public event ASPxClientControlsInitializedEventHandler ControlsInitialized { add{} remove{} } #*/
        this.ControlsInitialized = new ASPxClientEvent();
        /*# public event ASPxClientEventHandler BrowserWindowResized { add{} remove{} } #*/
        this.BrowserWindowResized = new ASPxClientEvent();
        /*# public event ASPxClientGlobalBeginCallbackEventHandler BeginCallback { add{} remove{} }#*/
        this.BeginCallback = new ASPxClientEvent();
        /*# public event ASPxClientGlobalEndCallbackEventHandler EndCallback { add{} remove{} }#*/
        this.EndCallback = new ASPxClientEvent();
        /*# public event ASPxClientGlobalCallbackErrorEventHandler CallbackError { add{} remove{} }#*/
        this.CallbackError = new ASPxClientEvent();
        /*# public event ASPxClientValidationCompletedEventHandler ValidationCompleted { add{} remove{} }#*/
        this.ValidationCompleted = new ASPxClientEvent();

        aspxGetControlCollectionCollection().Add(this);
    },
    
    Add: function(element) {
        var existsElement = this.Get(element.name);
        if(existsElement && existsElement !== element) 
            this.Remove(existsElement);

        ASPx.CollectionBase.prototype.Add.call(this, element.name, element);
    },
    Remove: function(element) {
        if(element && element instanceof ASPxClientControl)
            element.OnDispose();

        ASPx.CollectionBase.prototype.Remove.call(this, element.name);
    },
    GetGlobal: function(name) {
        var result = window[name];
        return result && Ident.IsASPxClientControl(result)
            ? result
            : null;
    },
    /*# [Obsolete("Use the GetByName method instead.")]public object Get(object name){return null;} #*/    
    /*# public object GetByName(string name){return null;} #*/    
    GetByName: function(name){
        return this.Get(name) || this.GetGlobal(name);
    },
    GetCollectionType: function(){
        return ASPxClientControlCollection.BaseCollectionType;
    },
    /*# public object[] GetControlsByPredicate(ASPxClientControlPredicate predicate){ return new object[] { };} #*/ 
    GetControlsByPredicate: function(predicate) {
        var result = [];
        this.ForEachControl(function(control) {
            if(!predicate || predicate(control))
                result.push(control);
        });
        return result;
    },
    /*# public object[] GetControlsByType(object type){ return new object[] { };} #*/ 
    GetControlsByType: function(type) {
        return this.GetControlsByPredicate(function(control) { 
            return type && (control instanceof type);
        });
    },
    /*# public void ForEachControl(ASPxClientControlAction action){ } #*/
    ForEachControl: function(action, context) {
        context = context || this;
        this.elementsMap.forEachEntry(function(name, control) {
            if(Ident.IsASPxClientControl(control))
                return action.call(context, control);
        }, context);
    },

    adjustControlsInternal: function(container, context, collapseControls, adjustFunc) {
        context = context || this;
        var func = function(control) {
            adjustFunc.call(context, control);
        };
        ASPx.GetControlAdjuster().adjustControlsInHierarchy(this, func, container, collapseControls);
    },
    
    // controls group operations
    AdjustControls: function(container, collapseControls) {
        container = container || null;
        window.setTimeout(function() {
            this.AdjustControlsCore(container, collapseControls);
        }.aspxBind(this), 0);
    },
    AdjustControlsCore: function(container, collapseControls) {
        var adjustFunction = function(control) { control.AdjustControl(); };
        this.adjustControlsInternal(container, this, collapseControls, adjustFunction);
    },
    CollapseControls: function(container) {
        this.ProcessControlsInContainer(container, function(control) {
            if(control.isASPxClientEdit)
                control.CollapseEditor();
            else if(!!window.ASPxClientRibbon && control instanceof ASPxClientRibbon)
                control.CollapseControl();
        });
    },
    
    AtlasInitialize: function(isCallback) {
        this.ForEachControl(function(control) {
            control.AtlasPreInitialize();
        });

        ASPx.ProcessScriptsAndLinks("", isCallback);

        this.ForEachControl(function(control) {
            control.AtlasInitialize();
        });
    },
    DOMContentLoaded: function() {
        this.ForEachControl(function(control){
             control.DOMContentLoaded();
        });
    },
    OnDocumentUnload: function() {
        this.ForEachControl(function(control) {
            control.RaiseUnload();
        });
    },
    Initialize: function() {
        ASPx.GetPostHandler().Post.AddHandler(
            function(s, e) { this.OnPost(e); }.aspxBind(this)
        );
        ASPx.GetPostHandler().PostFinalization.AddHandler(
            function(s, e) { this.OnPostFinalization(e); }.aspxBind(this)
        );

        this.InitializeElements(false /* isCallback */);
        if(typeof(Sys) != "undefined" && typeof(Sys.Application) != "undefined") {
            var checkIsInitialized = function() {
                if(Sys.Application.get_isInitialized())
                    Sys.Application.add_load(aspxCAInit);
                else
                    setTimeout(checkIsInitialized, 0);
            };
            checkIsInitialized();
        }
        this.InitWindowSizeCache();
    },
    FinalizeInitialization: function() {
        this.ForEachControl(function(control) {
            control.FinalizeInitialization();
        });
    },
    InitializeElements: function(isCallback) {
        this.ForEachControl(function(control){
            if(!control.isInitialized)
                control.Initialize();
        });
        
        this.AfterInitializeElementsLeadingCall();
        this.AfterInitializeElements();
        this.RaiseControlsInitialized(isCallback);
    },
    AfterInitializeElementsLeadingCall: function() {
        var controls = {};
        controls[ASPxClientControl.LeadingAfterInitCallConsts.Direct] = [];
        controls[ASPxClientControl.LeadingAfterInitCallConsts.Reverse] = [];
        
        this.ForEachControl(function(control) {
            if(control.leadingAfterInitCall != ASPxClientControl.LeadingAfterInitCallConsts.None && !control.isInitialized)
                controls[control.leadingAfterInitCall].push(control);
        });

        var directInitControls = controls[ASPxClientControl.LeadingAfterInitCallConsts.Direct],
            reverseInitControls = controls[ASPxClientControl.LeadingAfterInitCallConsts.Reverse];
        
        for(var i = 0, control; control = directInitControls[i]; i++)
            control.AfterInitialize();
        for(var i = reverseInitControls.length - 1, control; control = reverseInitControls[i]; i--)
            control.AfterInitialize();
    },
    AfterInitializeElements: function() {
        this.ForEachControl(function(control) {
            if(control.leadingAfterInitCall == ASPxClientControl.LeadingAfterInitCallConsts.None && !control.isInitialized)
                control.AfterInitialize();
        });
        ASPx.RippleHelper.Init();
    },
    DoFinalizeCallback: function() {
        this.ForEachControl(function(control){
            control.DoFinalizeCallback();
        });
    },
    ProcessControlsInContainer: function(container, processFunc, filterFunc) {
        this.ForEachControl(function(control){
            if((!filterFunc || filterFunc(control)) && (!container || this.IsControlInContainer(container, control)))
                processFunc(control);
        });
    },
    IsControlInContainer: function(container, control) {
        if(control.GetMainElement) {
            var mainElement = control.GetMainElement();
            if(mainElement && (mainElement != container)) {
                if(ASPx.GetIsParent(container, mainElement))
                    return true;
            }
        }
        return false;
    },
    RaiseControlsInitialized: function(isCallback) {
        if(typeof(isCallback) == "undefined")
            isCallback = true;
        var args = new ASPxClientControlsInitializedEventArgs(isCallback);
        if(!this.ControlsInitialized.IsEmpty())        
            this.ControlsInitialized.FireEvent(this, args);

        this.ForEachControl(function(control){
            control.OnGlobalControlsInitialized(args);
        });
    },
    RaiseBrowserWindowResized: function() {
        var args = new ASPxClientEventArgs();
        if(!this.BrowserWindowResized.IsEmpty())
            this.BrowserWindowResized.FireEvent(this, args);

        this.ForEachControl(function(control){
            control.OnGlobalBrowserWindowResized(args);
        });
    },
    RaiseBeginCallback: function (control, command) {
        var args = new ASPxClientGlobalBeginCallbackEventArgs(control, command);
        if(!this.BeginCallback.IsEmpty())
            this.BeginCallback.FireEvent(this, args);

        this.ForEachControl(function(control){
            control.OnGlobalBeginCallback(args);
        });
        this.IncrementRequestCount();
    },
    RaiseEndCallback: function (control) {
        var args = new ASPxClientGlobalEndCallbackEventArgs(control);
        if (!this.EndCallback.IsEmpty()) 
            this.EndCallback.FireEvent(this, args);
        
        this.ForEachControl(function(control){
            control.OnGlobalEndCallback(args);
        });
        this.DecrementRequestCount();
    },
    InCallback: function() {
        return this.requestCountInternal > 0;
    },
    RaiseCallbackError: function (control, message, callbackId) {
        var args = new ASPxClientGlobalCallbackErrorEventArgs(control, message, callbackId);
        if (!this.CallbackError.IsEmpty()) 
            this.CallbackError.FireEvent(this, args);
        
        this.ForEachControl(function(control){
            control.OnGlobalCallbackError(args);
        });

        if(args.handled)
            return { isHandled: true, errorMessage: args.message };        
        return { isHandled: false, errorMessage: message };
    },
    RaiseValidationCompleted: function (container, validationGroup, invisibleControlsValidated, isValid, firstInvalidControl, firstVisibleInvalidControl) {
        var args = new ASPxClientValidationCompletedEventArgs(container, validationGroup, invisibleControlsValidated, isValid, firstInvalidControl, firstVisibleInvalidControl);
        if (!this.ValidationCompleted.IsEmpty()) 
            this.ValidationCompleted.FireEvent(this, args);

        this.ForEachControl(function(control){
            control.OnGlobalValidationCompleted(args);
        });
        return args.isValid;
    },
    Before_WebForm_InitCallback: function(callbackOwnerID){
        var args = new BeforeInitCallbackEventArgs(callbackOwnerID);
        this.BeforeInitCallback.FireEvent(this, args);
    },
    
    InitWindowSizeCache: function(){
        this.prevWndWidth = ASPx.GetDocumentClientWidth();
        this.prevWndHeight = ASPx.GetDocumentClientHeight();
    },
    OnBrowserWindowResize: function(evt){
        var shouldIgnoreNestedEvents = ASPx.Browser.IE && ASPx.Browser.MajorVersion == 8;
        if(shouldIgnoreNestedEvents) {
            if(this.prevWndWidth === "" || this.prevWndHeight === "" || this.browserWindowResizeLocked)
                return;
            this.browserWindowResizeLocked = true;
        }
        this.OnBrowserWindowResizeCore(evt);
        if(shouldIgnoreNestedEvents)
            this.browserWindowResizeLocked = false;
    },
    OnBrowserWindowResizeCore: function(htmlEvent){
        var args = this.CreateOnBrowserWindowResizeEventArgs(htmlEvent);
        if(this.CalculateIsBrowserWindowSizeChanged()) {
            this.adjustControlsInternal(null, this, true, function(control) {
                if(control.IsDOMInitialized())
                    control.OnBrowserWindowResizeInternal(args);
            });
            this.RaiseBrowserWindowResized();
        }
    },
    CreateOnBrowserWindowResizeEventArgs: function(htmlEvent){
        return {
            htmlEvent: htmlEvent,
            wndWidth: ASPx.GetDocumentClientWidth(),
            wndHeight: ASPx.GetDocumentClientHeight(),
            prevWndWidth: this.prevWndWidth,
            prevWndHeight: this.prevWndHeight
        };
    },
    CalculateIsBrowserWindowSizeChanged: function(){
        var wndWidth = ASPx.GetDocumentClientWidth();
        var wndHeight = ASPx.GetDocumentClientHeight();
        var isBrowserWindowSizeChanged = (this.prevWndWidth != wndWidth) || (this.prevWndHeight != wndHeight);
        if(isBrowserWindowSizeChanged){
            this.prevWndWidth = wndWidth;
            this.prevWndHeight = wndHeight;
            return true;
        }
        return false;
    },
    OnPost: function(args){
        this.ForEachControl(function(control) {
            control.OnPost(args);
        }, null);
    },
    OnPostFinalization: function(args){
        this.ForEachControl(function(control) {
            control.OnPostFinalization(args);
        }, null);
    },
    IncrementRequestCount: function() {
        this.requestCountInternal++;
    },
    DecrementRequestCount: function() {
        this.requestCountInternal--;
    },
    ResetRequestCount: function() {
        this.requestCountInternal = 0;
    }
});
ASPxClientControlCollection.BaseCollectionType = "Control";

var controlCollection = null;
function aspxGetControlCollection(){
    if(controlCollection == null) {
        controlCollection = new ASPxClientControlCollection();
        if(ASPx.loadControlCollectionPreloadHandlers)
            ASPx.loadControlCollectionPreloadHandlers(controlCollection);
    }
    return controlCollection;
}

var ControlCollectionCollection = ASPx.CreateClass(ASPx.CollectionBase, {
    constructor: function(){
        this.constructor.prototype.constructor.call(this);
    },
    Add: function(element) {
        var key = element.GetCollectionType();
        if(!key) throw "The collection type isn't specified.";
        if(this.Get(key)) throw "The collection with type='" + key + "' already exists.";

        ASPx.CollectionBase.prototype.Add.call(this, key, element);
    },
    RemoveDisposedControls: function(){
        var baseCollection = this.Get(ASPxClientControlCollection.BaseCollectionType);
        var disposedControls = [];
        baseCollection.elementsMap.forEachEntry(function(name, control) {
            if(!ASPx.Ident.IsASPxClientControl(control)) return;

            if(control.IsDOMDisposed())
                disposedControls.push(control);
        });
        this.RemoveControls(disposedControls);
    },
    RemoveControls: function(controls){
        for(var i = 0; i < controls.length; i++) {
            /* jshint ignore:start */
            this.elementsMap.forEachEntry(function(key, collection) {
                if(ASPx.Ident.IsASPxClientCollection(collection))
                    collection.Remove(controls[i]);
            });
            /* jshint ignore:end */
        }
    }
});

var controlCollectionCollection = null;
function aspxGetControlCollectionCollection(){
    if(controlCollectionCollection == null)
        controlCollectionCollection = new ControlCollectionCollection();
    return controlCollectionCollection;
}

var AriaDescriptionAttributes = {
    Role: "0",
    AriaLabel: "1",
    TabIndex: "2",
    AriaOwns: "3",
    AriaDescribedBy: "4",
    AriaDisabled: "5",
    AriaHasPopup: "6",
    AriaLevel: "7"
};
var AriaDescriptor = ASPx.CreateClass(null, {
    constructor: function(ownerControl, description) {
        this.ownerControl = ownerControl;
        this.rootElement = ownerControl.GetMainElement();
        this.description = description;
    },
    setDescription: function(name, argList) {
        var description = this.findChildDescription(name);
        if(description) {
            var elements = name ? this.rootElement.querySelectorAll(this.getDescriptionSelector(description)) : [this.rootElement];
            for(var i = 0; i < elements.length; i++)
                this.applyDescriptionToElement(elements[i], description, argList[i] || argList[0]);
        }
    },
    getDescriptionName: function(description) {
        return description.n;
    },
    getDescriptionSelector: function(description) {
        return description.s;
    },
    findChildDescription: function(name) {
        if(name === this.getDescriptionName(this.description))
            return this.description;
        var childCollection = this.description.c || [];
        for(var i = 0; i < childCollection.length; i++) {
            var childDescription = childCollection[i];
            if(this.getDescriptionName(childDescription) === name)
                return childDescription;
        }
        return null;
    },
    applyDescriptionToElement: function(element, description, args) {
        if(!description || !element)
            return;
        this.trySetAriaOwnsAttribute(element, description);
        this.trySetAriaDescribedByAttribute(element, description);
        this.trySetAttribute(element, description, AriaDescriptionAttributes.Role, "role");
        this.trySetAttribute(element, description, AriaDescriptionAttributes.TabIndex, "tabindex");
        this.trySetAttribute(element, description, AriaDescriptionAttributes.AriaLevel, "aria-level");
        this.executeOnDescription(description, AriaDescriptionAttributes.AriaLabel, function(value) {
            ASPx.Attr.SetAttribute(element, "aria-label", ASPx.Str.ApplyReplacement(value, args));
        });
        this.executeOnDescription(description, AriaDescriptionAttributes.AriaDisabled, function(value) {
            ASPx.Attr.SetAttribute(element, "aria-disabled", !!value);    
        });
        this.executeOnDescription(description, AriaDescriptionAttributes.AriaHasPopup, function(value) {
            ASPx.Attr.SetAttribute(element, "aria-haspopup", !!value);
        });
    },
    trySetAriaDescribedByAttribute: function(element, description) {
        this.executeOnDescription(description, AriaDescriptionAttributes.AriaDescribedBy, function(selectorInfo) {
            var descriptor = this.getNodesBySelector(element, selectorInfo.descriptorSelector)[0];
            var target = this.getNodesBySelector(element, selectorInfo.targetSelector)[0];
            if(!target || !descriptor)
                return;
            ASPx.Attr.SetAttribute(target, "aria-describedby", this.getNodeId(descriptor));
        });
    },
    trySetAriaOwnsAttribute: function(element, description) {
        this.executeOnDescription(description, AriaDescriptionAttributes.AriaOwns, function(selector) {
            var ownedNodes = this.getNodesBySelector(element, selector);
            var ariaOwnsAttributeValue = "";
            for(var i = 0; i < ownedNodes.length; i++)
                ariaOwnsAttributeValue += (this.getNodeId(ownedNodes[i]) + (i != ownedNodes.length - 1 ? " " : ""));
            ASPx.Attr.SetAttribute(element, "aria-owns", ariaOwnsAttributeValue);
        });
    },
    trySetAttribute: function(element, description, ariaAttribute, attributeName) {
        this.executeOnDescription(description, ariaAttribute, function(value) { 
            ASPx.Attr.SetAttribute(element, attributeName, description[ariaAttribute]); 
        });
    },
    executeOnDescription: function(description, ariaDescAttr, callback) {
        var descInfo = description[ariaDescAttr];
        if(ASPx.IsExists(descInfo))
            callback.aspxBind(this)(descInfo);
    },
    getNodesBySelector: function(element, selector) {
        var id = element.id || "";
        var childNodes = element.querySelectorAll("#" + this.getNodeId(element) + " > " + selector);
        ASPx.Attr.SetOrRemoveAttribute(element, "id", id);
        return childNodes;
    },
    getNodeId: function(node) {
        if(!node.id)
            node.id = this.createRandomId();
        return node.id; 
    },
    createRandomId: function() {
        return "r" + ASPx.CreateGuid();
    }
});

PagerCommands = {
    Next : "PBN",
    Prev : "PBP",
    Last : "PBL",
    First : "PBF",
    PageNumber : "PN",
    PageSize : "PSP"
};
ASPx.callbackProcessed = false;

ASPx.Callback = function(result, context){    
    var collection = aspxGetControlCollection();
    collection.DoFinalizeCallback();
    var control = collection.Get(context);
    if(control != null)
        control.DoCallback(result);
    ASPx.RippleHelper.ReInit();
    ASPx.callbackProcessed = true;
};
ASPx.CallbackError = function(result, context){
    var control = aspxGetControlCollection().Get(context);
    if(control != null)
        control.DoCallbackError(result, false);
    ASPx.callbackProcessed = true;
};

ASPx.CClick = function(name, evt) {
    var control = aspxGetControlCollection().Get(name);
    if(control != null) control.DoControlClick(evt);
};

function aspxCAInit() {
    var isAppInit = typeof(Sys$_Application$initialize) != "undefined" &&
        ASPx.FunctionIsInCallstack(arguments.callee, Sys$_Application$initialize, 10 /* depthLimit */);
    aspxGetControlCollection().AtlasInitialize(!isAppInit);
}

ASPx.Evt.AttachEventToElement(window, "resize", aspxGlobalWindowResize);
function aspxGlobalWindowResize(evt){
    aspxGetControlCollection().OnBrowserWindowResize(evt);    
}

ASPx.Evt.AttachEventToElement(window, "unload", aspxClassesUnload);
function aspxClassesUnload(evt) {
    aspxGetControlCollection().OnDocumentUnload();
}

ASPx.attachToLoad(aspxClassesDOMContentLoaded);
function aspxClassesDOMContentLoaded(evt){
    aspxGetControlCollection().DOMContentLoaded();
}

ASPx.GetControlCollection = aspxGetControlCollection;
ASPx.GetControlCollectionCollection = aspxGetControlCollectionCollection;
ASPx.GetPersistentControlPropertiesStorage = _aspxGetPersistentControlPropertiesStorage;
ASPx.PagerCommands = PagerCommands;
ASPx.ELLIPSIS_MARKER_CLASS = ELLIPSIS_MARKER_CLASS;

window.ASPxClientBeginCallbackEventArgs = ASPxClientBeginCallbackEventArgs;
window.ASPxClientGlobalBeginCallbackEventArgs = ASPxClientGlobalBeginCallbackEventArgs;
window.ASPxClientEndCallbackEventArgs = ASPxClientEndCallbackEventArgs;
window.ASPxClientGlobalEndCallbackEventArgs = ASPxClientGlobalEndCallbackEventArgs;
window.ASPxClientCallbackErrorEventArgs = ASPxClientCallbackErrorEventArgs;
window.ASPxClientGlobalCallbackErrorEventArgs = ASPxClientGlobalCallbackErrorEventArgs;
window.ASPxClientCustomDataCallbackEventArgs = ASPxClientCustomDataCallbackEventArgs;
window.ASPxClientValidationCompletedEventArgs = ASPxClientValidationCompletedEventArgs;
window.ASPxClientControlsInitializedEventArgs = ASPxClientControlsInitializedEventArgs;
window.ASPxClientControlBeforePronounceEventArgs = ASPxClientControlBeforePronounceEventArgs;
window.ASPxClientControlUnloadEventArgs = ASPxClientControlUnloadEventArgs;
window.ASPxClientEndFocusEventArgs = ASPxClientEndFocusEventArgs;
window.ASPxClientItemFocusedEventArgs = ASPxClientItemFocusedEventArgs;

window.ASPxClientControlCollection = ASPxClientControlCollection;
window.ASPxClientControlBase = ASPxClientControlBase;
window.ASPxClientControl = ASPxClientControl;
window.ASPxClientComponent = ASPxClientComponent;


})(ASPx);

/// <reference path="_references.js"/>

/*# namespace DevExpress.Web.Scripts #*/
(function() {
    /*# public class ASPxClientOfficeDocumentLinkType : JavaScriptObject #*/
    var ASPxClientOfficeDocumentLinkType = {
        Hyperlink: 0,
        Bookmark: 1,
        EmailAddress: 2,
        Document: 3
    };

    var OfficeWorkSessionIDInputHelper = {
        InputName: "ASPxOfficeWorkSessionID",
        
        SetValue: function(value){
            for(var i = 0; i < document.forms.length; i++){
                var inputElement = document.forms[i][this.InputName];
                if(!inputElement)
                    inputElement = this.CreateInputElementCore(document.forms[i]);
                inputElement.value = value;
            }
        },
        CreateInputElementCore: function(form){
            var inputElement = ASPx.CreateHiddenField(this.InputName, this.InputName);
            form.appendChild(inputElement);
            return inputElement;
        }

    };

    var PDFPluginHelper = {
        IsInstalled: function() {
            return !!this.GetPDFPlugin();
        },
        GetPDFPlugin: function() {
            if(!this.plugin)
                this.plugin = ASPx.Browser.IE ? this.getActiveXObject("AcroPDF.PDF") || this.getActiveXObject("PDF.PdfCtrl") :
                    this.getNavigatorPlugin("Adobe Acrobat") || this.getNavigatorPlugin("Chrome PDF Viewer") ||
                    this.getNavigatorPlugin("WebKit built-in PDF") || this.getNavigatorPlugin("Chromium PDF Viewer");
            return this.plugin;
        },
        getActiveXObject: function(name) {
            try {
                return new ActiveXObject(name);
            } catch(e) {
                return null;
            }
        },
        getNavigatorPlugin: function(name) {
            var plugins = navigator.plugins;
            for(var key in plugins) {
                if(!plugins.hasOwnProperty(key)) continue;
                var plugin = plugins[key];
                if(plugin.name == name)
                    return plugin;
            }
            return null;
        },
        GetVersion: function() {
            try {
                var plugin = this.GetPDFPlugin();
                if(ASPx.Browser.IE) {
                    var versions = plugin.GetVersions().split(',');
                    var latest = versions[0].split('=');
                    return parseFloat(latest[1]);
                }
                if(plugin.version)
                    return parseInt(plugin.version);
                return plugin.name;
            } catch(e) {
                return null;
            }
        }
    };


    var OfficeHandlerUtils = (function() {
        //var currentHandlerResourceUrl = getHandlerResourceUrl();

        function getHandlerResourceUrl(pageUrl) {
            var url = pageUrl ? pageUrl : document.URL;
            if(url.indexOf("?") != -1)
                url = url.substring(0, url.indexOf("?"));

            if(url.indexOf("#") != -1) //XAF view separator
                url = url.substring(0, url.indexOf("#"));

            if(/.*\.aspx$/.test(url))
                url = url.substring(0, url.lastIndexOf("/") + 1);
            else if(url.lastIndexOf("/") != url.length - 1)
                url += "/";
            return url;
        }

        // Does not work in IE
        //function detectLoginRedirect(originUrl, xmlHttp) {
        //    var hasReturnUrlWithOriginUrl = false;
        //    if(xmlHttp.responseURL) {
        //        var responseURL = xmlHttp.responseURL.toLowerCase();
        //        //var urlChanged = responseURL !== originUrl.toLowerCase();
        //        //var hasReturnUrl = responseURL.indexOf("?returnurl=") >= 0;

        //        var relativeResource = originUrl.replace(currentHandlerResourceUrl, "");
        //        relativeResource = encodeURIComponent("/" + relativeResource).toLowerCase();    

        //        hasReturnUrlWithOriginUrl = responseURL.indexOf("?returnurl=" + relativeResource) >= 0;
        //    }
        //    return hasReturnUrlWithOriginUrl;
        //}

        return {
            getHandlerResourceUrl: getHandlerResourceUrl,
            //detectLoginRedirect: detectLoginRedirect,
        };
    })();

    var OfficeBuffer = {
        isBrowserSupportExtendedClientBuffer: function() {
            return ASPx.Browser.WebKitFamily || (ASPx.Browser.Firefox && ASPx.Browser.MajorVersion >= 50) || (ASPx.Browser.Edge && ASPx.Browser.MajorVersion >= 14);
        },
        isBufferContainText: function(items) {
            if(this.isBrowserSupportExtendedClientBuffer()) {
                var len = items.length;
                while(len--) {
                    if(items[len].type.indexOf("text/plain") >= 0)
                        return true;
                }
            }
            return false;
        },
        getBufferImage: function(items) {
            var len = items.length;
            while(len--) {
                if(items[len].type.indexOf("image") >= 0)
                    return items[len].getAsFile();
            }
            return null;
        }
    };

    var OfficePopupMenuItem = ASPx.CreateClass(null, {
        constructor: function(name, text, parentItem, itemProperties) {
            this.parent = parentItem;
            this.name = name;
            this.text = text;
            this.enabled = true;
            this.imageClassName = "";
            this.navigateUrl = "";
            this.imageUrl = "";
            this.beginGroup = false;
            this.tooltip = "";
            this.target = "";
            this.checked = false;

            this.dropDownMode = false;
            this.clientEnabled = true;
            this.visible = true;
            this.clientVisible = true;
            this.initializeItem(itemProperties);
        },
        GetSubItems: function() {
            return this.items;
        },
        GetItem: function(index) {
            return this.items.Get[index];
        },
        GetItemByName: function(name) {
            return this.items.GetByName(name);
        },
        GetItemCount: function() {
            return this.items.GetCount();
        },

        // private methods
        initializeItem: function(itemProperties) {
            if(itemProperties) {
                this.createItemInternal(itemProperties);
                this.items = this.createItems(itemProperties.items);
            } else
                this.items = this.createItems(null);

        },
        createItems: function(itemsFromProperties) {
            return new ASPx.OfficePopupMenuItemCollection(this, itemsFromProperties);
        },
        createItemInternal: function(itemProperties) {
            this.name = itemProperties.name || "";
            if(ASPx.IsExists(itemProperties.text))
                this.text = itemProperties.text;

            if(ASPx.IsExists(itemProperties.imageUrl))
                this.imageUrl = itemProperties.imageUrl;

            if(ASPx.IsExists(itemProperties.imageHottrackSrc))
                this.imageHottrackSrc = itemProperties.imageHottrackSrc;

            if(ASPx.IsExists(itemProperties.imageClassName))
                this.imageClassName = itemProperties.imageClassName;

            if(ASPx.IsExists(itemProperties.navigateUrl))
                this.navigateUrl = itemProperties.navigateUrl;

            if(ASPx.IsExists(itemProperties.beginGroup))
                this.beginGroup = itemProperties.beginGroup;

            if(ASPx.IsExists(itemProperties.enabled))
                this.enabled = itemProperties.enabled;

            if(ASPx.IsExists(itemProperties.clientEnabled))
                this.clientEnabled = itemProperties.clientEnabled;

            if(ASPx.IsExists(itemProperties.visible))
                this.visible = itemProperties.visible;

            if(ASPx.IsExists(itemProperties.clientVisible))
                this.clientVisible = itemProperties.clientVisible;

            if(ASPx.IsExists(itemProperties.tooltip))
                this.tooltip = itemProperties.tooltip;

            if(ASPx.IsExists(itemProperties.target))
                this.target = itemProperties.target;

            if(ASPx.IsExists(itemProperties.dropDownMode))
                this.dropDownMode = itemProperties.dropDownMode;

            if(ASPx.IsExists(itemProperties.value))
                this.checked = !!itemProperties.value;

            if(ASPx.IsExists(itemProperties.groupName))
                this.groupName = itemProperties.groupName;

            if(ASPx.IsExists(itemProperties.checked))
                this.checked = itemProperties.checked;

            if(ASPx.IsExists(itemProperties.isSvg))
                this.isSvg = itemProperties.isSvg;
        }
    });

    var OfficePopupMenuItemCollection = ASPx.CreateClass(Array, {
        constructor: function(parent, items) {
            this.constructor.prototype.constructor.call(this);
            this.parent = parent;
            this.initializeItems(items);
        },

        Add: function(item) {
            item.parent = this.parent;
            this.push(item);
        },
        Remove: function(index) {
            ASPx.Data.ArrayRemoveAt(this, index);
        },
        RemoveByName: function(itemName) {
            var index = ASPx.Data.ArrayIndexOf(this, itemName, function(item, name) { return item.name == name; });
            if(index >= 0)
                ASPx.Data.ArrayRemoveAt(this, index);
        },
        Insert: function(index, item) {
            item.parent = this.parent;
            this.splice(index, 0, item);
        },
        GetCount: function() {
            return this.length;
        },
        GetByName: function(itemName) {
            var len = this.GetCount();
            while(len--)
                if(this[len].name === itemName)
                    return this[len];
            return null;
        },
        Get: function(index) {
            return this[index];
        },
        Clear: function() {
            while(this.GetCount())
                this.pop();
        },

        // private methods
        initializeItems: function(items) {
            if(items && items.length) {
                for(var i = 0, item; item = items[i]; i++) {
                    if(!ASPx.IsExists(item.visible) || item.visible == true)
                        this.push(this.createNewItem(item));
                }
            }
        },
        createNewItem: function(item) {
            return new ASPx.OfficePopupMenuItem(item.name, item.text, this.parent, item);
        }
    });

    ASPx.OfficeWorkSessionIDInputHelper = OfficeWorkSessionIDInputHelper;
    ASPx.PDFPluginHelper = PDFPluginHelper;
    ASPx.OfficeHandlerUtils = OfficeHandlerUtils;
    ASPx.OfficeBuffer = OfficeBuffer;
    ASPx.OfficePopupMenuItem = OfficePopupMenuItem;
    ASPx.OfficePopupMenuItemCollection = OfficePopupMenuItemCollection;

    window.ASPxClientOfficeDocumentLinkType = ASPxClientOfficeDocumentLinkType;
})();
/// <reference path="..\_references.js"/>

/*# namespace DevExpress.Web.Scripts #*/
(function() {
    var constants = {
        InsertTableControlPostfix: "_ITC",
        InsertTableControlTablePostfix: "_ITCT",
        InsertTableControlCaptionPostfix: "_ITCC",

        InsertTableItemClass: "dxitcItem",
        InsertTableItemHoverClass: "dxitcItemHover"
    };

    var InsertTableControlTableInsertedEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
        constructor: function(rowCount, columnCount) {
            this.constructor.prototype.constructor.call(this);
            this.rowCount = rowCount;
            this.columnCount = columnCount;
        }
    });

    var InsertTableControl = ASPx.CreateClass(ASPxClientControl, {
        constructor: function(name) {
            this.constructor.prototype.constructor.call(this, name);

            this.columnCount = null;
            this.rowCount = null;
            this.insertTableText = null;

            this.cells = [];
            this.currentCell = null;
            this.currentX = 0;
            this.currentY = 0;

            this.captionTextNode = null;

            this.TableInserted = new ASPxClientEvent();
        },
        Initialize: function() {
            var caption = this.GetCaptionElement();
            while(caption.firstChild)
                ASPx.RemoveElement(caption.firstChild);
            this.captionTextNode = document.createTextNode('');
            caption.appendChild(this.captionTextNode);

            this.InitializeTable();
            this.InitializeEventHandlers();
            this.ChangeCaption();
            this.InitializeKeyboardHelper();
            ASPxClientControl.prototype.Initialize.call(this);
        },
        InitializeTable: function() {
            var tableElement = this.GetTableElement();
            var table = ASPx.CreateHtmlElement("table");
            this.prepareTableElement(table);
            for(var i = 0; i < this.rowCount; i++) {
                var row = ASPx.CreateHtmlElement("tr");
                table.appendChild(row);
                for(var j = 0; j < this.columnCount; j++) {
                    var cellContainer = ASPx.CreateHtmlElement("td");
                    row.appendChild(cellContainer);
                    this.AddCell(cellContainer, i, j);
                }
            }
            tableElement.appendChild(table);
            if(this.isStateControllerNeeded())
                ASPx.GetStateController().AddHoverItem(tableElement.id, [""], [""], [""], null, null, false);
        },
        isStateControllerNeeded: function() { return true; },
        prepareTableElement: function(table) {},
        InitializeEventHandlers: function() {
            ASPx.Evt.AttachEventToElement(this.GetTableElement(), "mouseup", function(evt) { this.OnTableMouseUp(evt); }.aspxBind(this));
            ASPx.Evt.AttachEventToElement(this.GetTableElement(), "mousemove", function(evt) { this.OnTableMouseMove(evt); }.aspxBind(this));
            ASPx.AddAfterClearHoverState(function(s, e) { this.OnTableMouseOut(e); }.aspxBind(this));
        },
        OnTableMouseUp: function(evt) {
            if(!ASPx.Evt.IsLeftButtonPressed(evt))
                return;
            var cell = this.GetCellByEvent(evt);
            if(cell)
                this.RaiseTableInserted(cell.GetX(), cell.GetY());
        },
        OnTableMouseMove: function(evt) {
            var cell = this.GetCellByEvent(evt);
            if(cell != this.currentCell) {
                this.currentCell = cell;
                this.ChangeSelection();
            }
        },
        OnTableMouseOut: function(evt) {
            if(evt.element == this.GetTableElement() && this.currentCell) {
                this.currentCell = null;
                this.ChangeSelection();
            }
        },
        RaiseTableInserted: function(rowCount, columnCount) {
            if(!this.TableInserted.IsEmpty()) {
                var args = new InsertTableControlTableInsertedEventArgs(rowCount, columnCount);
                this.TableInserted.FireEvent(this, args);
            }
        },
        RaiseRibbonExecCommand: function(ribbonName, ribbonItemName, rowCount, columnCount) {
            var params = {};
            if(rowCount > 0 && columnCount > 0)
                var params = { rowCount: rowCount, cellCount: columnCount };
            var ribbon = ASPx.GetControlCollection().GetByName(ribbonName);
            var item = ribbon.GetItemByName(ribbonItemName);
            item.hidePopup();
            if(params)
                ribbon.onExecCommand(item, params);
        },
        AddCell: function(parentElement, x, y) {
            var cell = new TableCell(this, parentElement, x, y);
            this.cells[cell.id] = cell;
        },
        ChangeSelection: function() {
            var x = this.currentCell ? this.currentCell.GetX() : 0;
            var y = this.currentCell ? this.currentCell.GetY() : 0;

            var minX = Math.min(this.currentX, x);
            var maxX = Math.max(this.currentX, x);
            var minY = Math.min(this.currentY, y);
            var maxY = Math.max(this.currentY, y);

            for(var i = 0; i < minX; i++)
                for(var j = minY; j < maxY; j++)
                    this.ChangeCellClass(i, j, i < x && j < y);
            for(var i = minX; i < maxX; i++)
                for(var j = 0; j < minY; j++)
                    this.ChangeCellClass(i, j, i < x && j < y);
            for(var i = minX; i < maxX; i++)
                for(var j = minY; j < maxY; j++)
                    this.ChangeCellClass(i, j, i < x && j < y);

            this.currentX = x;
            this.currentY = y;

            this.ChangeCaption();
        },
        ChangeCaption: function() {
            var text = this.currentX > 0 ? this.currentX + " x " + this.currentY : this.insertTableText;
            var node = this.captionTextNode;
            ASPx.RequestAnimationFrame(function() {
                node.data = text;
            });
        },
        ChangeCellClass: function(rowIndex, columnIndex, isHover) {
            var element = ASPx.GetElementById(this.name + "_" + rowIndex + "_" + columnIndex);
            var cssClass = this.getInsertTableItemHoverClass();
            ASPx.RequestAnimationFrame(function() {
                ASPx.ToggleClassNameToElement(element, cssClass, isHover);
            });
        },
        getInsertTableItemHoverClass: function() {
            return constants.InsertTableItemHoverClass;
        },
        GetCellByEvent: function(evt) {
            var srcElement = ASPx.Evt.GetEventSource(evt);
            if(!srcElement.id)
                srcElement = ASPx.GetChildByTagName(srcElement, "DIV", 0);
            return srcElement ? this.cells[srcElement.id] : null;
        },
        GetMainElement: function() {
            return ASPx.GetElementById(this.name + constants.InsertTableControlPostfix);
        },
        GetTableElement: function() {
            return ASPx.GetElementById(this.name + constants.InsertTableControlTablePostfix);
        },
        GetCaptionElement: function() {
            return ASPx.GetElementById(this.name + constants.InsertTableControlCaptionPostfix);
        },

        getEnabledCore: function() {
            return true;
        },
        getInsertTableItemClass: function() {
            return constants.InsertTableItemClass;
        },

        // Keyboard Support
        InitializeKeyboardHelper: function() {
            this.keyboardHelper = new ASPxInserTableControlKeyboardHelper(this);
            this.keyboardHelper.Init();
        }
    });

    var TableCell = ASPx.CreateClass(null, {
        constructor: function(owner, parentElement, rowIndex, columnIndex) {
            this.owner = owner;
            this.rowIndex = rowIndex;
            this.columnIndex = columnIndex;
            this.id = owner.name + "_" + rowIndex + "_" + columnIndex;

            this.CreateElement(parentElement);
        },
        CreateElement: function(parentElement) {
            var element = ASPx.CreateHtmlElement();
            element.id = this.id;
            ASPx.AddClassNameToElement(element, this.owner.getInsertTableItemClass());
            parentElement.appendChild(element);
        },
        GetX: function() {
            return this.rowIndex + 1;
        },
        GetY: function() {
            return this.columnIndex + 1;
        }
    });

    var ASPxInserTableControlKeyboardHelper = ASPx.CreateClass(ASPx.KbdHelper, {
        constructor: function(insertTableControl) {
            this.constructor.prototype.constructor.call(this, insertTableControl);
            this.control = insertTableControl;

            this.currenCell = null;
            this.focusedRowIndex = -1;
            this.focusedColumnIndex = -1;
            this.GetCurrentCellIndexes();
        },
        GetFocusableElement: function() {
            return this.control.GetMainElement();
        },
        HandleKeyDown: function(e) {
            switch(ASPx.Evt.GetKeyCode(e)) {
                case ASPx.Key.Left:
                    this.TryMoveFocus("left");
                    return true;
                case ASPx.Key.Right:
                    this.TryMoveFocus("right");
                    return true;
                case ASPx.Key.Up:
                    this.TryMoveFocus("up");
                    return true;
                case ASPx.Key.Down:
                    this.TryMoveFocus("down");
                    return true;
                case ASPx.Key.Enter:
                    this.ProcessEnterKey();
                    return true;
                case ASPx.Key.Esc:
                    this.ClearSelection();
                    this.control.RaiseTableInserted();
                    return true;
            }
            return false;
        },
        ProcessEnterKey: function() {
            var rowIndex = this.focusedRowIndex + 1;
            var columnIndex = this.focusedColumnIndex + 1;
            this.control.RaiseTableInserted(rowIndex, columnIndex);
            this.ClearSelection();
        },

        ReceivedFocus: function() {
            var result = false;
            if(this.focusedRowIndex < 0) {
                this.focusedRowIndex = 0;
                result = true;
            }    
            if(this.focusedColumnIndex < 0) {
                this.focusedColumnIndex = 0;
                result = true;
            }
            if(result)
                this.TryFocusItemByIndex(this.focusedRowIndex, this.focusedColumnIndex);
            return result;
        },
        TryMoveFocus: function(direction) {
            this.GetCurrentCellIndexes();
            if(this.ReceivedFocus()) {
                return;
            }
            var rowIndex = this.focusedRowIndex;
            var columnIndex = this.focusedColumnIndex;
            switch(direction) {
                case "left":
                    columnIndex--;
                    if(columnIndex < 0)
                        columnIndex = 0;
                    this.TryFocusItemByIndex(rowIndex, columnIndex);
                    break;
                case "right":
                    columnIndex++;
                    if(columnIndex >= this.control.columnCount)
                        columnIndex = this.control.columnCount - 1;
                    this.TryFocusItemByIndex(rowIndex, columnIndex);
                    break;
                case "up":
                    rowIndex--;
                    if(rowIndex < 0)
                        rowIndex = 0;
                    this.TryFocusItemByIndex(rowIndex, columnIndex);
                    break;
                case "down":
                    rowIndex++;
                    if(rowIndex >= this.control.rowCount)
                        rowIndex = this.control.rowCount - 1;
                    this.TryFocusItemByIndex(rowIndex, columnIndex);
                    break;
            }
        },
        TryFocusItemByIndex: function(rowIndex, columnIndex) {
            this.focusedRowIndex = rowIndex;
            this.focusedColumnIndex = columnIndex;

            var id = this.control.name + "_" + rowIndex + "_" + columnIndex;
            var element = this.control.cells[id];

            this.control.currentCell = element;
            this.control.ChangeSelection();

            this.GetCurrentCell();
        },

        GetCurrentCell: function() {
            this.currentCell = this.control.currentCell;
        },
        GetCurrentCellIndexes: function() {
            this.GetCurrentCell();
            if(this.currentCell) {
                this.focusedRowIndex = this.currentCell.rowIndex;
                this.focusedColumnIndex = this.currentCell.columnIndex;
            }
            else {
                this.focusedRowIndex = -1;
                this.focusedColumnIndex = -1;
            }
        },
        ClearSelection: function() {
            this.focusedRowIndex = -1;
            this.focusedColumnIndex = -1;
            this.control.currentCell = null;
            this.control.ChangeSelection();
        },

        onBlur: function() {
            ASPx.KbdHelper.prototype.onBlur.call(this);
            this.ClearSelection();
        }
    });

    ASPx.InsertTableControl = InsertTableControl;
})();
(function() {
    var Dialog = {};

    Dialog.PushDialogToCollection = function(ownerControl, dialog) {
        if(!ownerControl.dialogArray)
            ownerControl.dialogArray = [];
        ownerControl.dialogArray.push(dialog);
    };

    Dialog.GetLastDialog = function(ownerControl) {
        if(ownerControl.dialogArray) {
            var length = ownerControl.dialogArray.length;
            return length > 0 ? ownerControl.dialogArray[length - 1] : null;
        }
        return null;
    };

    Dialog.RemoveLastDialog = function(ownerControl) {
        var array = ownerControl.dialogArray;
        if(array && array.length > 0)
            ASPx.Data.ArrayRemoveAt(array, array.length - 1);
    };

    Dialog.GetCurrentDialog = function(name) {
        var ownerControl = Dialog.GetOwnerControl(name);
        return ownerControl ? Dialog.GetLastDialog(ownerControl) : null;
    };

    Dialog.GetOwnerControl = function(name) {
        return ASPx.GetControlCollection().Get(name ? name : ASPx.currentControlNameInDialog);
    };

    ASPx.Dialog = Dialog;
})();
/// <reference path="_references.js"/>

(function () {

    var PositionAnimationTransition = ASPx.CreateClass(ASPx.AnimationTransitionBase, {
        constructor: function (element, options) {
            this.constructor.prototype.constructor.call(this, element, options);
            this.direction = options.direction;
            this.animationTransition = this.createAnimationTransition();
            AnimationHelper.appendWKAnimationClassNameIfRequired(this.element);
        },
        /* Public */
        Start: function (to) {
            var from = this.GetValue();
            if(ASPx.AnimationUtils.CanUseCssTransform()) {
                from = this.convertPosToCssTransformPos(from);
                to = this.convertPosToCssTransformPos(to);
            }
            this.animationTransition.Start(from, to);
        },
        SetValue: function (value) {
            ASPx.AnimationUtils.SetTransformValue(this.element, value, this.direction == AnimationHelper.SLIDE_VERTICAL_DIRECTION);
        },
        GetValue: function () {
            return ASPx.AnimationUtils.GetTransformValue(this.element, this.direction == AnimationHelper.SLIDE_VERTICAL_DIRECTION);
        },
        /* Private */
        createAnimationTransition: function () {
            var transition = ASPx.AnimationUtils.CanUseCssTransform() ? this.createTransformAnimationTransition() : this.createPositionAnimationTransition();
            transition.transition = ASPx.AnimationConstants.Transitions.POW_EASE_OUT;
            return transition;
        },
        createTransformAnimationTransition: function () {
            return ASPx.AnimationUtils.createCssAnimationTransition(this.element, {
                property: ASPx.AnimationUtils.CanUseCssTransform(),
                duration: this.duration,
                onComplete: this.onComplete
            });
        },
        createPositionAnimationTransition: function () {
            return AnimationHelper.createAnimationTransition(this.element, {
                property: this.direction == AnimationHelper.SLIDE_VERTICAL_DIRECTION ? "top" : "left",
                unit: "px",
                duration: this.duration,
                onComplete: this.onComplete
            });
        },
        convertPosToCssTransformPos: function (position) {
            return ASPx.AnimationUtils.GetTransformCssText(position, this.direction == AnimationHelper.SLIDE_VERTICAL_DIRECTION);
        }
    });

    var AnimationHelper = {
        SLIDE_HORIZONTAL_DIRECTION: 0,
        SLIDE_VERTICAL_DIRECTION: 1,

        SLIDE_TOP_DIRECTION: 0,
        SLIDE_RIGHT_DIRECTION: 1,
        SLIDE_BOTTOM_DIRECTION: 2,
        SLIDE_LEFT_DIRECTION: 3,

        SLIDE_CONTAINER_CLASS: "dxAC",
        MAXIMUM_DEPTH: 3,

        // Public
        createAnimationTransition: function (element, options) {
            if(options.onStep) 
                options.animationEngine = "js";

            switch (options.animationEngine) {
                case "js":
                    return ASPx.AnimationUtils.createJsAnimationTransition(element, options);
                case "css":
                    return ASPx.AnimationUtils.createCssAnimationTransition(element, options);
                default:
                    return ASPx.AnimationUtils.CanUseCssTransition() ? ASPx.AnimationUtils.createCssAnimationTransition(element, options) :
                        ASPx.AnimationUtils.createJsAnimationTransition(element, options);
            }
        },
        createMultipleAnimationTransition: function (element, options) {
            return ASPx.AnimationUtils.createMultipleAnimationTransition(element, options);
        },
        createSimpleAnimationTransition: function (options) {
            return ASPx.AnimationUtils.createSimpleAnimationTransition(options);
        },
        cancelAnimation: function (element) {
            ASPx.AnimationTransitionBase.Cancel(element);
        },

        fadeIn: function (element, onComplete, duration) {
            AnimationHelper.fadeTo(element, {
                from: 0, to: 1,
                onComplete: onComplete,
                duration: duration || ASPx.AnimationConstants.Durations.DEFAULT
            });
        },
        fadeOut: function (element, onComplete, duration) {
            AnimationHelper.fadeTo(element, {
                from: ASPx.GetElementOpacity(element), to: 0,
                onComplete: onComplete,
                duration: duration || ASPx.AnimationConstants.Durations.DEFAULT
            });
        },
        fadeTo: function (element, options) {
            options.property = "opacity";
            if(!options.duration)
                options.duration = ASPx.AnimationConstants.Durations.SHORT;
            var transition = AnimationHelper.createAnimationTransition(element, options);
            if(!ASPx.IsExists(options.from))
                options.from = transition.GetValue();
            transition.Start(options.from, options.to);
        },
        slideIn: function (element, direction, onComplete, animationEngineType, rtl) {
            AnimationHelper.setOpacity(element, 1);
            var animationContainer = AnimationHelper.getSlideAnimationContainer(element, true, true);
            var pos = AnimationHelper.getSlideInStartPos(animationContainer, direction, rtl);
            var transition = AnimationHelper.createSlideTransition(animationContainer, direction,
                function (el) {
                    AnimationHelper.resetSlideAnimationContainerSize(animationContainer);
                    if(onComplete)
                        onComplete(el);
                }, animationEngineType, rtl);
            transition.Start(pos, 0);
        },
        slideOut: function (element, direction, onComplete, animationEngineType, rtl) {
            var animationContainer = AnimationHelper.getSlideAnimationContainer(element, true, true);
            var pos = AnimationHelper.getSlideOutFinishPos(animationContainer, direction, rtl);
            var transition = AnimationHelper.createSlideTransition(animationContainer, direction,
                function (el) {
                    AnimationHelper.setOpacity(el.firstChild, 0);
                    if(onComplete)
                        onComplete(el);
                }, animationEngineType, rtl);
            transition.Start(pos);
        },
        slideTo: function (element, options) {
            if(!ASPx.IsExists(options.direction))
                options.direction = AnimationHelper.SLIDE_HORIZONTAL_DIRECTION;
            var transition = new PositionAnimationTransition(element, options);
            transition.Start(options.to);
        },

        // Private 
        setOpacity: function (element, value) {
            ASPx.AnimationUtils.setOpacity(element, value);
        },
        appendWKAnimationClassNameIfRequired: function (element) {
            if(ASPx.AnimationUtils.CanUseCssTransform() && ASPx.Browser.WebKitFamily && !ASPx.ElementHasCssClass(element, "dx-wbv"))
                element.className += " dx-wbv";
        },

        findSlideAnimationContainer: function (element) {
            var container = element;
            for(var i = 0; i < AnimationHelper.MAXIMUM_DEPTH; i++) {
                if(container.tagName == "BODY")
                    return null;
                if(ASPx.ElementHasCssClass(container, AnimationHelper.SLIDE_CONTAINER_CLASS))
                    return container;
                container = container.parentNode;
            }
            return null;
        },
        createSlideAnimationContainer: function (element) {
            var rootContainer = document.createElement("DIV");
            ASPx.SetStyles(rootContainer, {
                className: AnimationHelper.SLIDE_CONTAINER_CLASS,
                overflow: "hidden"
            });
            var elementContainer = document.createElement("DIV");
            rootContainer.appendChild(elementContainer);

            var parentNode = element.parentNode;
            parentNode.insertBefore(rootContainer, element);

            elementContainer.appendChild(element);
            return rootContainer;
        },
        getSlideAnimationContainer: function (element, create, fixSize) {
            if(!element) return;
            var width = element.offsetWidth;
            var height = element.offsetHeight;
            var container;
            if(element.className == AnimationHelper.SLIDE_CONTAINER_CLASS)
                container = element;
            if(!container)
                container = AnimationHelper.findSlideAnimationContainer(element);
            if(!container && create)
                container = AnimationHelper.createSlideAnimationContainer(element);
            if(container && fixSize) {
                ASPx.SetStyles(container, {
                    width: width, height: height
                });
                ASPx.SetStyles(container.firstChild, {
                    width: width, height: height
                });
            }
            return container;
        },
        resetSlideAnimationContainerSize: function (container) {
            ASPx.SetStyles(container, {
                width: "", height: ""
            });
            ASPx.SetStyles(container.firstChild, {
                width: "", height: ""
            });
        },
        getModifyProperty: function (direction, rtl) {
            if(direction == AnimationHelper.SLIDE_TOP_DIRECTION || direction == AnimationHelper.SLIDE_BOTTOM_DIRECTION)
                return "marginTop";
            return rtl ? "margin-right" : "margin-left";
        },
        createSlideTransition: function (animationContainer, direction, complete, animationEngineType, rtl) {
            if(rtl == undefined)
                rtl = false;
            var animationEngine = "";
            switch(animationEngineType) {
                case AnimationEngineType.JS:
                    animationEngine = "js";
                    break;
                case AnimationEngineType.CSS:
                    animationEngine = "css";
                    break;
            }
            return AnimationHelper.createAnimationTransition(animationContainer.firstChild, {
                unit: "px",
                property: AnimationHelper.getModifyProperty(direction, rtl),
                onComplete: complete,
                animationEngine: animationEngine
            });
        },
        getSlideInStartPos: function (animationContainer, direction, rtl) {
            var dir = rtl ? -1 : 1;
            switch (direction) {
                case AnimationHelper.SLIDE_TOP_DIRECTION:
                    return animationContainer.offsetHeight;
                case AnimationHelper.SLIDE_LEFT_DIRECTION:
                    return animationContainer.offsetWidth * dir;
                case AnimationHelper.SLIDE_RIGHT_DIRECTION:
                    return -animationContainer.offsetWidth * dir;
                case AnimationHelper.SLIDE_BOTTOM_DIRECTION:
                    return -animationContainer.offsetHeight;
            }
        },
        getSlideOutFinishPos: function (animationContainer, direction, rtl) {
            var dir = rtl ? -1 : 1;
            switch (direction) {
                case AnimationHelper.SLIDE_TOP_DIRECTION:
                    return -animationContainer.offsetHeight;
                case AnimationHelper.SLIDE_LEFT_DIRECTION:
                    return -animationContainer.offsetWidth * dir;
                case AnimationHelper.SLIDE_RIGHT_DIRECTION:
                    return animationContainer.offsetWidth * dir;
                case AnimationHelper.SLIDE_BOTTOM_DIRECTION:
                    return animationContainer.offsetHeight;
            }
        }
    };

    var GestureHandler = ASPx.CreateClass(null, {
        constructor: function (getAnimationElement, canHandle, allowStart) {
            this.getAnimationElement = getAnimationElement;
            this.canHandle = canHandle;
            this.allowStart = allowStart;
            this.startMousePosX = 0;
            this.startMousePosY = 0;
            this.startTime = null;
            this.isEventsPrevented = false;

            this.savedElements = [];
        },
        // handlers
        OnSelectStart: function(evt) {
            ASPx.Evt.PreventEvent(evt);    
        },
        OnDragStart: function(evt) {
            ASPx.Evt.PreventEvent(evt);  
        },
        OnMouseDown: function (evt) {
            this.startMousePosX = ASPx.Evt.GetEventX(evt);
            this.startMousePosY = ASPx.Evt.GetEventY(evt);
            this.startTime = new Date();
        },
        OnMouseMove: function(evt) {
            if(!ASPx.Browser.MobileUI)
                ASPx.Selection.Clear();
            if(Math.abs(this.GetCurrentDistanceX(evt)) < GestureHandler.SLIDER_MIN_START_DISTANCE && Math.abs(this.GetCurrentDistanceY(evt)) < GestureHandler.SLIDER_MIN_START_DISTANCE)
                GesturesHelper.isExecutedGesture = false;
        },
        OnMouseUp: function (evt) {
        },
        CanHandleEvent: function (evt) {
            return !this.canHandle || this.canHandle(evt);
        },
        IsStartAllowed: function(value) {
            return !this.allowStart || this.allowStart(value);
        },
        RollbackGesture: function () {
        },
        GetRubberPosition: function (position) {
            return position / GestureHandler.FACTOR_RUBBER;
        },
        GetCurrentDistanceX: function (evt) {
            return ASPx.Evt.GetEventX(evt) - this.startMousePosX;
        },
        GetCurrentDistanceY: function (evt) {
            return ASPx.Evt.GetEventY(evt) - this.startMousePosY;
        },
        GetDistanceLimit: function () {
            return (new Date() - this.startTime) < GestureHandler.MAX_TIME_SPAN ? GestureHandler.MIN_DISTANCE_LIMIT : GestureHandler.MAX_DISTANCE_LIMIT;
        },
        GetContainerElement: function () {
        },
        AttachPreventEvents: function (evt) {
            if(!this.isEventsPrevented) {
                var element = ASPx.Evt.GetEventSource(evt);
                var container = this.GetContainerElement();
                while(element && element != container) {
                    ASPx.Evt.AttachEventToElement(element, "mouseup", ASPx.Evt.PreventEvent);
                    ASPx.Evt.AttachEventToElement(element, "click", ASPx.Evt.PreventEvent);
                    this.savedElements.push(element);
                    element = element.parentNode;
                }
                this.isEventsPrevented = true;
            }
        },
        DetachPreventEvents: function () {
            if(this.isEventsPrevented) {
                window.setTimeout(function () {
                    while(this.savedElements.length > 0) {
                        var element = this.savedElements.pop();
                        ASPx.Evt.DetachEventFromElement(element, "mouseup", ASPx.Evt.PreventEvent);
                        ASPx.Evt.DetachEventFromElement(element, "click", ASPx.Evt.PreventEvent);
                    }
                }.aspxBind(this), 0);
                this.isEventsPrevented = false;
            }
        }
    });
    GestureHandler.MAX_DISTANCE_LIMIT = 70;
    GestureHandler.MIN_DISTANCE_LIMIT = 10;
    GestureHandler.MIN_START_DISTANCE = 0;
    GestureHandler.SLIDER_MIN_START_DISTANCE = 5;
    GestureHandler.MAX_TIME_SPAN = 300;
    GestureHandler.FACTOR_RUBBER = 4;
    GestureHandler.RETURN_ANIMATION_DURATION = 150;

    var SwipeSlideGestureHandler = ASPx.CreateClass(GestureHandler, {
        constructor: function (getAnimationElement, direction, canHandle, backward, forward, rollback, move) {
            this.constructor.prototype.constructor.call(this, getAnimationElement, canHandle);
            this.slideElement = this.getAnimationElement();
            this.container = this.slideElement.parentNode;
            this.direction = direction;

            this.backward = backward;
            this.forward = forward;
            this.rollback = rollback;

            this.slideElementSize = 0;
            this.containerElementSize = 0;
            this.startSliderElementPosition = 0;
            this.centeredSlideElementPosition = 0;
        },
        OnMouseDown: function (evt) {
            GestureHandler.prototype.OnMouseDown.call(this, evt);
            this.slideElementSize = this.GetElementSize();
            this.startSliderElementPosition = this.GetElementPosition();
            this.containerElementSize = this.GetContainerElementSize();
            if(this.slideElementSize <= this.containerElementSize)
                this.centeredSlideElementPosition = (this.containerElementSize - this.slideElementSize) / 2;
        },
        OnMouseMove: function (evt) {
            GestureHandler.prototype.OnMouseMove.call(this, evt);
            if(!ASPx.Browser.TouchUI && !ASPx.GetIsParent(this.container, ASPx.Evt.GetEventSource(evt))) {
                GesturesHelper.OnDocumentMouseUp(evt);
                return;
            }
            var distance = this.GetCurrentDistance(evt);
            if(Math.abs(distance) < GestureHandler.SLIDER_MIN_START_DISTANCE || ASPx.TouchUIHelper.isGesture)
                return;

            this.SetElementPosition(this.GetCalculatedPosition(distance));
            this.AttachPreventEvents(evt);
            ASPx.Evt.PreventEvent(evt);
        },
        GetCalculatedPosition: function (distance) {
            ASPx.AnimationTransitionBase.Cancel(this.slideElement);
            var position = this.startSliderElementPosition + distance,
                maxPosition = -(this.slideElementSize - this.containerElementSize),
                minPosition = 0;

            if(this.centeredSlideElementPosition > 0)
                position = this.GetRubberPosition(distance) + this.centeredSlideElementPosition;
            else if(position > minPosition)
                position = this.GetRubberPosition(distance);
            else if(position < maxPosition)
                position = this.GetRubberPosition(distance) + maxPosition;

            return position;
        },
        OnMouseUp: function (evt) {
            this.DetachPreventEvents();
            if(this.GetCurrentDistance(evt) != 0)
                this.OnMouseUpCore(evt);
        },
        OnMouseUpCore: function (evt) {
            var distance = this.GetCurrentDistance(evt);
            if(this.centeredSlideElementPosition > 0 || this.CheckSlidePanelIsOutOfBounds())
                this.PerformRollback();
            else
                this.PerformAction(distance);
        },
        PerformAction: function (distance) {
            if(Math.abs(distance) < this.GetDistanceLimit())
                this.PerformRollback();
            else if(distance < 0)
                this.PerformForward();
            else
                this.PerformBackward();
        },
        PerformBackward: function () {
            this.backward();
        },
        PerformForward: function () {
            this.forward();
        },
        PerformRollback: function () {
            this.rollback();
        },
        CheckSlidePanelIsOutOfBounds: function () {
            var minOffset = -(this.slideElementSize - this.containerElementSize), maxOffset = 0;
            var slideElementPos = this.GetElementPosition();
            if(slideElementPos > maxOffset || slideElementPos < minOffset)
                return true;
            return false;
        },
        GetContainerElement: function () {
            return this.container;
        },
        GetElementSize: function () {
            return this.IsHorizontalDirection() ? this.slideElement.offsetWidth : this.slideElement.offsetHeight;
        },
        GetContainerElementSize: function () {
            return this.IsHorizontalDirection() ? ASPx.GetClearClientWidth(this.container) : ASPx.GetClearClientHeight(this.container);
        },
        GetCurrentDistance: function (evt) {
            return this.IsHorizontalDirection() ? this.GetCurrentDistanceX(evt) : this.GetCurrentDistanceY(evt);
        },
        GetElementPosition: function () {
            return ASPx.AnimationUtils.GetTransformValue(this.slideElement, !this.IsHorizontalDirection());
        },
        SetElementPosition: function (position) {
            ASPx.AnimationUtils.SetTransformValue(this.slideElement, position, !this.IsHorizontalDirection());
        },
        IsHorizontalDirection: function () {
            return this.direction == AnimationHelper.SLIDE_HORIZONTAL_DIRECTION;
        }
    });
    var SwipeSimpleSlideGestureHandler = ASPx.CreateClass(SwipeSlideGestureHandler, {
        constructor: function (getAnimationElement, direction, canHandle, backward, forward, rollback, updatePosition) {
            this.constructor.prototype.constructor.call(this, getAnimationElement, direction, canHandle, backward, forward, rollback);
            this.container = this.slideElement;
            this.updatePosition = updatePosition;
            this.prevDistance = 0;
        },
        OnMouseDown: function (evt) {
            GestureHandler.prototype.OnMouseDown.call(this, evt);
            this.prevDistance = 0;
        },
        OnMouseUpCore: function (evt) {
            this.PerformAction(this.GetCurrentDistance(evt));
        },
        PerformAction: function (distance) {
            if(Math.abs(distance) < this.GetDistanceLimit())
                this.PerformRollback();
            else if(distance < 0)
                this.PerformForward();
            else
                this.PerformBackward();
        },
        GetCalculatedPosition: function (distance) {
            var position = distance - this.prevDistance;
            this.prevDistance = distance;
            return position;
        },
        SetElementPosition: function (position) {
            this.updatePosition(position);
        }
    });

    var SwipeGestureHandler = ASPx.CreateClass(GestureHandler, {
        constructor: function (getAnimationElement, canHandle, allowStart, start, allowComplete, complete, cancel, animationEngineType, rtl) {
            this.constructor.prototype.constructor.call(this, getAnimationElement, canHandle, allowStart);

            this.start = start;
            this.allowComplete = allowComplete;
            this.complete = complete;
            this.cancel = cancel;

            this.animationTween = null;
            this.currentDistanceX = 0;
            this.currentDistanceY = 0;
            this.tryStartGesture = false;
            this.tryStartScrolling = false;
            this.animationEngineType = animationEngineType;
            this.rtl = rtl;

            this.UpdateAnimationContainer();
        },
        UpdateAnimationContainer: function () {
            this.animationContainer = AnimationHelper.getSlideAnimationContainer(this.getAnimationElement(), true, false);
        },
        CanHandleEvent: function (evt) {
            if(GestureHandler.prototype.CanHandleEvent.call(this, evt))
                return true;
            return this.animationTween && this.animationContainer && ASPx.GetIsParent(this.animationContainer, ASPx.Evt.GetEventSource(evt));
        },
        OnMouseDown: function (evt) {
            GestureHandler.prototype.OnMouseDown.call(this, evt);
            if(this.animationTween)
                this.animationTween.Cancel();

            this.currentDistanceX = 0;
            this.currentDistanceY = 0;
            this.tryStartGesture = false;
            this.tryStartScrolling = false;
        },
        OnMouseMove: function (evt) {
            GestureHandler.prototype.OnMouseMove.call(this, evt);

            var isZoomGestureConflict = evt.touches && evt.touches.length > 1;
            if (isZoomGestureConflict)
                return false;

            this.currentDistanceX = this.GetCurrentDistanceX(evt);
            this.currentDistanceY = this.GetCurrentDistanceY(evt);

            if(this.rtl)
                this.currentDistanceX = -this.currentDistanceX;

            if(!this.animationTween && !this.tryStartScrolling && (Math.abs(this.currentDistanceX) >
                GestureHandler.MIN_START_DISTANCE || Math.abs(this.currentDistanceY) > GestureHandler.MIN_START_DISTANCE)) {
                if(Math.abs(this.currentDistanceY) < Math.abs(this.currentDistanceX)) {
                    this.tryStartGesture = true;
                    if(this.IsStartAllowed(this.currentDistanceX)) {
                        this.animationContainer = AnimationHelper.getSlideAnimationContainer(this.getAnimationElement(), true, true);
                        this.animationTween = AnimationHelper.createSlideTransition(this.animationContainer, AnimationHelper.SLIDE_LEFT_DIRECTION,
                            function () {
                                AnimationHelper.resetSlideAnimationContainerSize(this.animationContainer);
                                this.animationContainer = null;
                                this.animationTween = null;
                            }.aspxBind(this), this.animationEngineType, this.rtl);
                        this.PerformStart(this.currentDistanceX);
                        this.AttachPreventEvents(evt);
                    }
                }
                else
                    this.tryStartScrolling = true;
            }
            if(this.animationTween) {
                if(this.allowComplete && !this.allowComplete(this.currentDistanceX))
                    this.currentDistanceX = this.GetRubberPosition(this.currentDistanceX);
                this.animationTween.SetValue(this.currentDistanceX);
            }
            if(!this.tryStartScrolling && !ASPx.TouchUIHelper.isGesture && evt.touches && evt.touches.length < 2)
                ASPx.Evt.PreventEvent(evt);
        },
        OnMouseUp: function (evt) {
            if(!this.animationTween) {
                if(this.tryStartGesture)
                    this.PerformCancel(this.currentDistanceX);
            }
            else {
                if(Math.abs(this.currentDistanceX) < this.GetDistanceLimit())
                    this.RollbackGesture();
                else {
                    if(this.IsCompleteAllowed(this.currentDistanceX)) {
                        this.PerformComplete(this.currentDistanceX);
                        this.animationContainer = null;
                        this.animationTween = null;
                    }
                    else
                        this.RollbackGesture();
                }
            }
            this.DetachPreventEvents();

            this.tryStartGesture = false;
            this.tryStartScrolling = false;
        },
        PerformStart: function (value) {
            if(this.start)
                this.start(value);
        },
        IsCompleteAllowed: function (value) {
            return !this.allowComplete || this.allowComplete(value);
        },
        PerformComplete: function (value) {
            if(this.complete)
                this.complete(value);
        },
        PerformCancel: function (value) {
            if(this.cancel)
                this.cancel(value);
        },
        RollbackGesture: function () {
            this.animationTween.Start(this.currentDistanceX, 0);
        },
        ResetGestureElementPosition: function () {
            if (this.currentDistanceX === 0) return;

            var container = AnimationHelper.getSlideAnimationContainer(this.getAnimationElement());
            var onComplete = function () { AnimationHelper.resetSlideAnimationContainerSize(container); };
            var animation = AnimationHelper.createSlideTransition(container, AnimationHelper.SLIDE_LEFT_DIRECTION, onComplete, this.animationEngineType, this.rtl);
            animation.Start(this.currentDistanceX, 0);
        },
        GetContainerElement: function () {
            return this.animationContainer;
        }
    });

    var GesturesHelper = {
        handlers: {},
        activeHandler: null,
        isAttachedEvents: false,
        isExecutedGesture: false,

        // For paging 
        AddSwipeGestureHandler: function (id, getAnimationElement, canHandle, allowStart, start, allowComplete, complete, cancel, animationEngineType, rtl) {
            this.handlers[id] = new SwipeGestureHandler(getAnimationElement, canHandle, allowStart, start, allowComplete, complete, cancel, animationEngineType, rtl);
        },
        UpdateSwipeAnimationContainer: function (id) {
            if(this.handlers[id])
                this.handlers[id].UpdateAnimationContainer();
        },
        // For image slider
        AddSwipeSlideGestureHandler: function (id, getAnimationElement, direction, canHandle, backward, forward, rollback, updatePosition) {
            if(updatePosition)
                this.handlers[id] = new SwipeSimpleSlideGestureHandler(getAnimationElement, direction, canHandle, backward, forward, rollback, updatePosition);
            else
                this.handlers[id] = new SwipeSlideGestureHandler(getAnimationElement, direction, canHandle, backward, forward, rollback);
        },

        getParentDXEditorWithSwipeGestures: function(element) {
           return ASPx.GetParent(element, function(parent) {
               var parentObj = ASPx.GetControlCollection().Get(parent.id);
               return parentObj && parentObj.supportGestures && parentObj.isSwipeGesturesEnabled();
            });
        },

        canHandleMouseDown: function(evt) {
            if(!ASPx.Evt.IsLeftButtonPressed(evt))
                return false;
            var element = ASPx.Evt.GetEventSource(evt);

            var dxFocusedEditor = ASPx.Ident.scripts.ASPxClientEdit && ASPx.GetFocusedEditor();
            if(dxFocusedEditor && dxFocusedEditor.IsEditorElement(element)) {
                var elementParentDXEditorWithSwipeGestures = GesturesHelper.getParentDXEditorWithSwipeGestures(element);
                if(!elementParentDXEditorWithSwipeGestures || !dxFocusedEditor.IsEditorElement(elementParentDXEditorWithSwipeGestures))
                    return false;
            }

            var isTextEditor = element.tagName == "TEXTAREA" || element.tagName == "INPUT" && ASPx.Attr.GetAttribute(element, "type") == "text";
            if(isTextEditor && document.activeElement == element)
                return false;

            return true;        
        },
        OnDocumentDragStart: function(evt) {
            if(GesturesHelper.activeHandler)
                GesturesHelper.activeHandler.OnDragStart(evt);
        },
        OnDocumentSelectStart: function(evt) {
            if(GesturesHelper.activeHandler)
                GesturesHelper.activeHandler.OnSelectStart(evt);
        },
        OnDocumentMouseDown: function (evt) {
            if(!GesturesHelper.canHandleMouseDown(evt))
                return;
            GesturesHelper.activeHandler = GesturesHelper.FindHandler(evt);
            if(GesturesHelper.activeHandler)
                GesturesHelper.activeHandler.OnMouseDown(evt);
        },
        OnDocumentMouseMove: function (evt) {
            if(GesturesHelper.activeHandler) {
                GesturesHelper.isExecutedGesture = true;
                GesturesHelper.activeHandler.OnMouseMove(evt);
            }
        },
        OnDocumentMouseUp: function (evt) {
            if(GesturesHelper.activeHandler) {
                GesturesHelper.activeHandler.OnMouseUp(evt);
                GesturesHelper.activeHandler = null;
                window.setTimeout(function () { GesturesHelper.isExecutedGesture = false; }, 0);
            }
        },
        AttachEvents: function () {
            if(!GesturesHelper.isAttachedEvents) {
                GesturesHelper.Attach(ASPx.Evt.AttachEventToElement);
                GesturesHelper.isAttachedEvents = true;
            }
        },
        DetachEvents: function () {
            if(GesturesHelper.isAttachedEvents) {
                GesturesHelper.Attach(ASPx.Evt.DetachEventFromElement);
                GesturesHelper.isAttachedEvents = false;
            }
        },
        Attach: function (changeEventsMethod) {
            var doc = window.document;
            changeEventsMethod(doc, ASPx.TouchUIHelper.touchMouseDownEventName, GesturesHelper.OnDocumentMouseDown);
            changeEventsMethod(doc, ASPx.TouchUIHelper.touchMouseMoveEventName, GesturesHelper.OnDocumentMouseMove);
            changeEventsMethod(doc, ASPx.TouchUIHelper.touchMouseUpEventName, GesturesHelper.OnDocumentMouseUp);
            if(!ASPx.Browser.MobileUI) {
                changeEventsMethod(doc, "selectstart", GesturesHelper.OnDocumentSelectStart);
                changeEventsMethod(doc, "dragstart", GesturesHelper.OnDocumentDragStart);
            }
        },
        FindHandler: function (evt) {
            var handlers = [];
            for(var id in GesturesHelper.handlers) {
                if(GesturesHelper.handlers.hasOwnProperty(id)) {
                    var handler = GesturesHelper.handlers[id];
                    if(handler.CanHandleEvent && handler.CanHandleEvent(evt))
                        handlers.push(handler);
                }
            }
            if(!handlers.length)
                return null;
            handlers.sort(function (a, b) {
                return ASPx.GetIsParent(a.getAnimationElement(), b.getAnimationElement()) ? 1 : -1;
            });
            return handlers[0];
        },
        IsExecutedGesture: function () {
            return GesturesHelper.isExecutedGesture;
        }
    };
    GesturesHelper.AttachEvents();
    
    var AnimationEngineType = {
        "JS": 0,
        "CSS": 1,
        "DEFAULT" : 2
    };

    ASPx.AnimationEngineType = AnimationEngineType;
    ASPx.AnimationHelper = AnimationHelper;
    ASPx.GesturesHelper = GesturesHelper;
})();

/// <reference path="_references.js"/>
/// <reference path="PopupUtils.js"/>

/*# namespace DevExpress.Web.Scripts #*/

(function () {

    /*# public class ASPxClientHint : ASPxClientControl #*/
    var ASPxClientHint = ASPx.CreateClass(ASPxClientControl, {
        constructor: function (name) {
            this.constructor.prototype.constructor.call(this, name);
        },

        /*# public new object GetMainElement() { return null; } #*/
        GetMainElement: function () {
            return null;
        }

    });

    /*# public event ASPxClientHintShowingEventHandler Showing { add{} remove{} } #*/
    /*# public event ASPxClientHintHidingEventHandler Hiding { add{} remove{} } #*/

    /*# public static void Update(){ } #*/
    ASPxClientHint.Update = function () {
        ASPxClientHint.Instances.each(function (instance) { instance.update(); });
    };

    /*# public static void UpdatePosition(){ } #*/
    /*# public static void UpdatePosition(object hintElementOrTargetElement){ } #*/
    ASPxClientHint.UpdatePosition = function (element) {
        if (element) {
            var wnd = ASPxClientHint.createdWindows.find(element);
            if (wnd)
                wnd.UpdatePosition();
        } else
            ASPxClientHint.createdWindows.each(function (wnd) { wnd.UpdatePosition(); });
    };

    ASPx.attachToReady(function () {
        window.setTimeout(function () {
            ASPxClientHint.Update();
        }, 0);
    });

    ASPxClientHint.TriggerHelper = (function () {
        var triggers = {

            none: {
                subscribeActivation: function () { },
                unsubscribeActivation: function () { },
                subscribeDeactivation: function () { },
            },

            hover: {
                activationEvent: "mouseover", // "mouseover"
                deactivationEvent: "mouseleave", // "mouseout";
                subscribeActivation: function (targetSelector, handler) {
                    return ASPxClientHint.events.subscribe(targetSelector, this.activationEvent, handler);
                },
                unsubscribeActivation: function (targetElements, handler) {
                    ASPxClientHint.events.unsubscribe(targetElements, this.activationEvent, handler);
                },
                subscribeDeactivation: function (targetElement, hintElement, handler) {
                    var onMouseoutDeactivating = function (evt) {
                        // INFO: https://developer.mozilla.org/ru/docs/Web/API/MouseEvent/relatedTarget
                        var relatedTargetElement = ASPx.Evt.GetEventRelatedTarget(evt, false);
                        var mouseOutsToTarget = ASPxClientUtils.GetIsParent(targetElement, relatedTargetElement);
                        var mouseOutsToHint = ASPxClientUtils.GetIsParent(hintElement, relatedTargetElement);
                        if (!mouseOutsToTarget && !mouseOutsToHint) {
                            ASPx.Evt.DetachEventFromElement(targetElement, this.deactivationEvent, onMouseoutDeactivating);
                            handler();
                        }
                    }.aspxBind(this);

                    ASPx.Evt.AttachEventToElement(targetElement, this.deactivationEvent, onMouseoutDeactivating);
                    ASPx.Evt.AttachEventToElement(hintElement, this.deactivationEvent, onMouseoutDeactivating);
                },
            },

            click: {
                subscribeActivation: function (targetSelector, handler) {
                    return ASPxClientHint.events.subscribe(targetSelector, "click", handler);
                },
                unsubscribeActivation: function (targetElements, handler) {
                    ASPxClientHint.events.unsubscribe(targetElements, "click", handler);
                },
                subscribeDeactivation: function (targetElement, hintElement, handler) {
                    var closeAction = "click";
                    var reactivationAction = "click";

                    var onHintClickReactivating = function () {
                        ASPx.Evt.DetachEventFromElement(hintElement, reactivationAction, onHintClickReactivating);

                        handler("reactivation");
                    };

                    var onDeactivating = function (evt) {
                        var eventSourceElement = ASPx.Evt.GetEventSource(evt);
                        var clickTarget = ASPxClientUtils.GetIsParent(targetElement, eventSourceElement);
                        var clickHint = ASPxClientUtils.GetIsParent(hintElement, eventSourceElement);
                        if (!clickTarget && !clickHint) {
                            ASPx.Evt.DetachEventFromDocument(closeAction, onDeactivating);
                            handler("deactivation");

                            ASPx.Evt.AttachEventToElement(hintElement, reactivationAction, onHintClickReactivating);
                        }
                    };

                    ASPx.Evt.AttachEventToDocument(closeAction, onDeactivating);
                },
            },

            focus: {
                subscribeActivation: function (targetSelector, handler) {
                    return ASPxClientHint.events.subscribe(targetSelector, "focus", handler);
                },
                unsubscribeActivation: function (targetElement, handler) {
                    ASPxClientHint.events.unsubscribe(targetElement, "focus", handler);
                },
                subscribeDeactivation: function (targetElement, hintElement, handler) {
                    var closeAction = "blur";
                    var onMouseoutDeactivating = function (evt) {
                        // INFO: https://developer.mozilla.org/ru/docs/Web/API/MouseEvent/relatedTarget
                        var relatedTargetElement = ASPx.Evt.GetEventRelatedTarget(evt, false);
                        var focusToTarget = ASPxClientUtils.GetIsParent(targetElement, relatedTargetElement);
                        var focusToHint = ASPxClientUtils.GetIsParent(hintElement, relatedTargetElement);
                        if (!focusToTarget && !focusToHint) {
                            ASPx.Evt.DetachEventFromElement(targetElement, closeAction, onMouseoutDeactivating);
                            handler();
                        }
                    };

                    ASPx.Evt.AttachEventToElement(targetElement, closeAction, onMouseoutDeactivating);
                },
            },
        };

        var validTriggers = [];
        for (var trigger in triggers) {
            if (triggers.hasOwnProperty(trigger)) {
                validTriggers.push(trigger);
            }
        }
        var defaultTriggerAction = "hover focus";

        function validate(triggerString) {
            var trigger = triggerString.split(" ");
            for (var i = 0; i < trigger.length; i++) {
                if (trigger[i] && ASPx.Data.ArrayIndexOf(validTriggers, trigger[i]) == -1)
                    ASPx.ShowErrorMessage("Property 'triggerAction' has an inappropriate value '" + trigger[i] + "'");
            }
        }

        function fixTriggerString(triggerString) {
            if(ASPxClientUtils.webKitTouchUI) {
                if(triggerString === "hover" || triggerString === "focus")
                    return "click";

                var triggerStrings = triggerString.split(" ");
                for (var i = triggerStrings.length - 1; i >= 0 ; i--) {
                    if(triggerStrings[i] === "hover" || triggerStrings[i] === "focus")
                        triggerStrings.splice(i, 1);
                }
                if(triggerStrings.length === 0)
                    return "click";
                return triggerStrings.join(" ");
            }
            return triggerString;
        }

        function subscribeActivation(triggerString, targetSelector, handler) {
            triggerString = fixTriggerString(triggerString);

            var targetElements;
            var trigger = triggerString.split(" ");
            for (var i = 0; i < trigger.length; i++)
                targetElements = triggers[trigger[i]].subscribeActivation(targetSelector, handler);
            return targetElements;
        }

        function unsubscribActivatione(triggerString, targetElements, handler) {
            triggerString = fixTriggerString(triggerString);

            var trigger = triggerString.split(" ");
            for (var i = 0; i < trigger.length; i++)
                triggers[trigger[i]].unsubscribeActivation(targetElements, handler);
        }
        function subscribeDeactivation(triggerString, targetElement, hintElement, handler) {
            triggerString = fixTriggerString(triggerString);

            var trigger = triggerString.split(" ");
            for (var i = 0; i < trigger.length; i++)
                triggers[trigger[i]].subscribeDeactivation(targetElement, hintElement, handler);
        }

        return {
            defaultTriggerAction: defaultTriggerAction,

            validate: validate,

            subscribeActivation: subscribeActivation,
            unsubscribActivatione: unsubscribActivatione,
            subscribeDeactivation: subscribeDeactivation,
        };
    })();

    ASPxClientHint.Instances = (function () {
        var all = {};

        function composeKey(targetSelector, triggerAction) {
            return targetSelector + "|" + triggerAction;
        }

        function add(targetSelector, triggerAction, instance, onExists) {
            var key = composeKey(targetSelector, triggerAction);
            var oldInstance = all[key];
            if (oldInstance) onExists(oldInstance);

            all[key] = instance;
        }

        function each(delegate) {
            for (var item in all) {
                if (all.hasOwnProperty(item)) {
                    var stop = delegate(all[item]);
                    if (stop) break;
                }
            }
        }

        return {
            add: add,
            each: each
        };
    })();

    ASPxClientHint.createdWindows = (function () {
        var all = [];

        function add(wnd) {
            var index = ASPxClientUtils.ArrayIndexOf(all, wnd);
            if (index == -1)
                all.push(wnd);
        }
        function remove(wnd) {
            ASPxClientUtils.ArrayRemove(all, wnd);
        }
        function each(delegate) {
            var fihished = false;
            for (var i = all.length - 1; i >= 0; i--) {
                fihished = delegate(all[i]);
                if (fihished)
                    break;
            }
        }
        function findFirst(comparer) {
            var foundWnd = null;
            each(function (wnd) {
                if (comparer(wnd)) {
                    foundWnd = wnd;
                    return true;
                }
            }.aspxBind(this));

            return foundWnd;
        }
        function findByHintElement(hintElement) {
            return ASPxClientHint.createdWindows.findFirst(function (wnd) { return wnd.hintElement == hintElement; });
        }
        function findByTargetElement(targetElement) {
            return ASPxClientHint.createdWindows.findFirst(function (wnd) { return wnd.targetElement == targetElement; });
        }
        function find(element) {
            var wnd = findByHintElement(element);
            if (!wnd)
                wnd = findByTargetElement(element);
            return wnd;
        }

        return {
            add: add,
            remove: remove,
            each: each,
            find: find,
            findFirst: findFirst,
            findByTargetElement: findByTargetElement,
            findByHintElement: findByHintElement,
        };
    })();

    ASPxClientHint.errorMessages = {
        selectorArgumentRequired: "ASPxHint: The first Register's method argument (selector) is required"
    };
    ASPxClientHint.showErrorMessage = function (errorMessage) {
        ASPx.ShowErrorMessage(errorMessage);
        throw new Error(errorMessage);
    };

    /*# public static ASPxClientHint Register(string targetSelector, ASPxClientHintOptions options){ return null; } #*/
    /*# public static ASPxClientHint Register(string targetSelector, string contentAttribute){ return null; } #*/
    /*# public static ASPxClientHint Register(string targetSelector, ASPxClientHintShowingEventHandler onShowing){ return null; } #*/
    ASPxClientHint.Register = function (targetSelector, options) {
        var oldInstanceDetachDelegate = function (oldInstance) { oldInstance.detach(); };

        var instance = new ASPxClientHint.Instance(targetSelector, options);

        if(targetSelector) {
            ASPxClientHint.Instances.add(
                targetSelector,
                instance.options.triggerAction,
                instance,
                oldInstanceDetachDelegate
            );
        }

        return instance;
    };

    /*# public static void Show(string targetSelector, ASPxClientHintOptions options){ } #*/
    /*# public static void Show(string targetSelector, string content){ } #*/
    /*# public static void Show(object targetElement, ASPxClientHintOptions options){ } #*/
    /*# public static void Show(object targetElement, string content){ } #*/
    /*# public static void Show(ASPxClientHintOptions options){ } #*/
    ASPxClientHint.Show = function (/*targetSelector, options*/) {
        var hasNoTargetSelector = arguments.length == 1;
        var hasTargetSelectorAndOptions = arguments.length == 2;
        var targetSelector, options, targetElement;

        if (hasNoTargetSelector) {
            targetSelector = "body";
            options = arguments[0];
            targetElement = document.body;
        } else if (hasTargetSelectorAndOptions) {
            if (typeof arguments[0] === "string") {
                targetSelector = arguments[0];
                targetElement = document.querySelectorAll(targetSelector)[0];
            } else {
                targetSelector = "";
                targetElement = arguments[0];
            }
            options = arguments[1];
        } else
            return;

        if (typeof options === "string") options = { content: options };
        options = ASPxClientHint.OptionsParser.patchOptionsForShow(hasNoTargetSelector, options);

        var instance = new ASPxClientHint.Instance(targetSelector, options);
        instance.Show(targetElement);

        return instance;
    };

    /*# public static void Hide(string targetSelector){ } #*/
    /*# public static void Hide(object targetElementOrHintElement){ } #*/
    ASPxClientHint.Hide = function (target, immediately) {
        if (typeof target === "string") {
            var targetSelector = target;
            var targetElements = document.querySelectorAll(targetSelector);
            for (var i = 0, length = targetElements.length; i < length; i++) {
                ASPxClientHint.hideByTargetElement(targetElements[i], immediately);
            }
        } else {
            var targetElements = target;
            var wasHidden = ASPxClientHint.hideByTargetElement(targetElements, immediately);
            if (!wasHidden) {
                var hintElement = targetElements;
                ASPxClientHint.HideByHintElement(hintElement, immediately);
            }
        }
    };
    ASPxClientHint.hideByTargetElement = function (targetElement, immediately) {
        var wasHidden = false;
        ASPxClientHint.createdWindows.each(function (wnd) {
            if (wnd.targetElement === targetElement) {
                ASPxClientHint.HideByWnd(wnd, immediately);
                wasHidden = true;
            }
        });
        return wasHidden;
    };
    ASPxClientHint.hideByTargetsContainerElement = function(containerElement, immediately) {
        var wasHidden = false;
        ASPxClientHint.createdWindows.each(function(wnd) {
            if(containerElement.contains(wnd.targetElement)) {
                ASPxClientHint.HideByWnd(wnd, immediately);
                wasHidden = true;
            }
        });
        return wasHidden;
    };
    ASPxClientHint.HideByHintElement = function (hintElement, immediately) {
        ASPxClientHint.createdWindows.each(function (wnd) {
            if (wnd.hintElement === hintElement) {
                ASPxClientHint.HideByWnd(wnd, immediately);
                return true;
            }
        });
    };

    /*# public static void HideAll(){ } #*/
    ASPxClientHint.HideAll = function (immediately) {
        ASPxClientHint.createdWindows.each(function (wnd) { ASPxClientHint.HideByWnd(wnd, immediately); });
    };

    ASPxClientHint.HideByWnd = function (wnd, immediately) {
        if (wnd) {
            if (immediately)
                wnd.hideCore();
            else
                wnd.hide(true);
        }
    };

    ASPxClientHint.Instance = function (targetSelector, options) {
        var legalTargetSelector = typeof targetSelector === "string";
        if (!legalTargetSelector) {
            ASPxClientHint.showErrorMessage(ASPxClientHint.errorMessages.selectorArgumentRequired);
            return null;
        }

        this.targetSelector = targetSelector;

        this.options = ASPxClientHint.OptionsParser.parse(options);

        if(this.options.hideNativeTooltipForNestedTitleAttributes) {
            var children = document.querySelectorAll(targetSelector + " [title]");
            for (var key in children) {
                if (children.hasOwnProperty(key)) {
                     ASPxClientHint.AttributeHelper.getRelocateTitleAttribute(children[key]);
                }
            }
        }

        var notEmptyTargetSelector = legalTargetSelector && targetSelector !== "";
        if(notEmptyTargetSelector)
            this.attach();
    };


    ASPxClientHint.Instance.prototype = {
        /*# public ASPxClientHintWindow Show(object targetElement){ return null; } #*/
        /*# public ASPxClientHintWindow Show(string targetSelector){ return null; } #*/
        Show: function (targetElement) {
            var viaAPI = true;

            if (typeof targetElement === "string")
                targetElement = document.querySelector(targetElement);

            if(!targetElement && this.targetSelector)
                targetElement = document.querySelector(this.targetSelector);
            if(!targetElement)
                targetElement = document.body;
            
            return this.showAtElement(targetElement, viaAPI);
        },
        showAtElement: function (targetElement, viaAPI) {
            var wnd = this.startShowing(targetElement, viaAPI);
            if (wnd)
                this.completeShowing(wnd);
            return wnd;
        },

        attach: function () {
            this.onActivatingHandler = this.onActivatingHandler || function (evt) { this.activating(evt); }.aspxBind(this);
            this.targetElements = ASPxClientHint.TriggerHelper.subscribeActivation(this.options.triggerAction, this.targetSelector, this.onActivatingHandler);
        },
        detach: function () {
            ASPxClientHint.TriggerHelper.unsubscribActivatione(this.options.triggerAction, this.targetElements, this.onActivatingHandler);
        },
        update: function () {
            this.detach();
            this.attach();
        },
        getTargetElementFromEvent: function (evt) {
            if (!ASPx.IsExists(evt)) return null;

            return evt.currentTarget ?
                evt.currentTarget :
                evt.srcElement ?
                    evt.srcElement :
                    evt.target;
        },
        activating: function (evt) {
            var targetElement = this.getTargetElementFromEvent(evt);
            this.activatingAtElement(targetElement, evt);
        },
        activatingAtElement: function (targetElement, evt) {
            var wnd = ASPxClientHint.createdWindows.findByTargetElement(targetElement);
            var wndAlreadyCreated = wnd && wnd.getStatus() >= ASPxClientHintWindow.Statuses.created;

            if (wndAlreadyCreated){
                var ieFamily = ASPx.Browser.IE || ASPx.Browser.Edge;
                var T568873 = ieFamily && evt.buttons === 1;
                if(!T568873)
                    this.reactivation(wnd);
            }

            if (!wndAlreadyCreated)
                wnd = this.startShowing(targetElement);

            if (this.options.appearAfter > 0) {
                window.setTimeout(function () {
                    this.completeActivation(wnd);
                }.aspxBind(this), this.options.appearAfter);
            } else
                this.completeActivation(wnd);

            return wnd;
        },
        completeActivation: function (wnd) {
            if (wnd && wnd.getStatus() === ASPxClientHintWindow.Statuses.created)
                this.completeShowing(wnd);
        },

        reactivation: function (wnd) {
            if (wnd && wnd.disappearAfterTimerIsActive()) {
                wnd.stopDisappearTimer();
                this.subscribeDeactivation(wnd); // T534303
            }
        },

        startShowing: function (targetElement, viaAPI) {
            var contentHtmlContainer = this.getContentHtml(targetElement);
            if (!contentHtmlContainer.valid)
                return;

            var contentHtml = contentHtmlContainer.content;

            var titleHtml = this.getTitleHtml(targetElement);

            var hasNoContent = !contentHtml && !titleHtml && !this.options.onShowing;
            if (hasNoContent && !viaAPI)
                return;

            var wnd = new ASPxClientHintWindow(targetElement, this.options);

            wnd.getCreateRender(
                contentHtml,
                titleHtml
            );

            this.subscribeDeactivation(wnd);

            wnd.setStatus(ASPxClientHintWindow.Statuses.created);

            return wnd;
        },
        completeShowing: function (wnd) {
            var statusBeforeEvent =  wnd.getStatus();
            var customContent = this.raiseOnShowing(wnd, wnd.targetElement, wnd.hintElement, wnd.getContentElement(), wnd.getTitleElement());
            this.processCustomContent(customContent, wnd);
            var statusAfterEvent =  wnd.getStatus();
            if(statusAfterEvent < statusBeforeEvent) return;

            wnd.show();
            wnd.setStatus(ASPxClientHintWindow.Statuses.activated);

            var completeShown = function () {
                wnd.setStatus(ASPxClientHintWindow.Statuses.shown);
                if (this.options.autoDisappearAfter > 0)
                    setTimeout(function () { wnd.hide(); }, this.options.autoDisappearAfter);
            }.aspxBind(this);

            if (ASPxClientHint.OptionsParser.getShowAnimationEnabled(this.options)) {
                var duration = ASPxClientHint.OptionsParser.getShowAnimationDuration(this.options);
                ASPx.AnimationHelper.fadeIn(
                    wnd.hintElement,
                    completeShown,
                    duration);
            } else
                completeShown();

        },
        raiseOnShowing: function (wnd, targetElement, hintElement, contentElement, titleElement) {
            var customContent;
            var cancel = false;

            if (this.options.onShowing) {
                var args = new ASPxClientHintShowingEventArgs(targetElement, hintElement, contentElement, titleElement, false);
                customContent = this.options.onShowing(wnd, args);
                cancel = args.cancel;
            }

            if(cancel)
                ASPxClientHint.Hide(targetElement);

            return customContent;
        },

        processCustomContent: function (customContent, wnd) {
            wnd.beforeHtmlSet();
            
            if (typeof customContent === "string") {
                wnd.setContent(customContent);
            } else if (typeof customContent === "object") {
                if (typeof customContent.title === "string")
                    wnd.setTitle(customContent.title);
                if (typeof customContent.content === "string")
                    wnd.setContent(customContent.content);
            }

            wnd.afterHtmlSet();

        },

        subscribeDeactivation: function (wnd) {
            ASPxClientHint.TriggerHelper.subscribeDeactivation(
                this.options.triggerAction,
                wnd.targetElement,
                wnd.hintElement,
                function (message) {
                    if (message === "reactivation")
                        this.reactivation(wnd);
                    else // if(message === "deactivation")
                        wnd.deactivating();
                }.aspxBind(this)
            );
        },

        getContentHtml: function (targetElement) {
            var contentContainer = {
                content: "",
                valid: true
            };

            if (this.options.content) {
                contentContainer.content = this.options.content;
                contentContainer.valid = true;
            } else if (this.options.contentAttribute) {
                contentContainer.content = ASPxClientHint.AttributeHelper.getAttributeValue(targetElement, this.options.contentAttribute);
                contentContainer.valid = contentContainer.content !== null;
            } else {
                var titleValue = ASPxClientHint.AttributeHelper.getAttributeValue(targetElement, "title");
                if (titleValue !== null) {
                    contentContainer.content = titleValue;
                    contentContainer.valid = true;
                }
            }

            return contentContainer;
        },
        getTitleHtml: function (targetElement) {
            if (this.options.title)
                return this.options.title;
            if (this.options.titleAttribute)
                return targetElement.getAttribute(this.options.titleAttribute);
            return "";
        },
    };

    /*# public class ASPxClientHintWindow : JavaScriptObject #*/
    var ASPxClientHintWindow = function (targetElement, options) {
        this.targetElement = targetElement;
        this.options = options;
        this.hintElement = null;
    };

    ASPxClientHintWindow.prototype = {
        hintElement: null,

        /*# public void UpdatePosition() { } #*/
        UpdatePosition: function () {
            var targetElementWasDeleted = this.targetElement && !ASPx.IsExistsElement(this.targetElement);
            if(targetElementWasDeleted)
                this.hide(true);
            else
                ASPxClientHint.RenderHelper.updatePosition(this.targetElement, this.hintElement, this.options);
        },

        getCreateRender: function (contentHtml, titleHtml) {
            this.hintElement = ASPxClientHint.RenderHelper.create(this.targetElement, contentHtml, titleHtml, this.options);
        },

        getContentElement: function () {
            return ASPxClientHint.RenderHelper.getContentElement(this.hintElement, this.options.classNames);
        },
        getTitleElement: function () {
            return ASPxClientHint.RenderHelper.getTitleElement(this.hintElement, this.options.classNames);
        },

        setContent: function (contentHTML) {
            var contentElement = this.getContentElement();
            if(!contentElement) return;

            contentElement.innerHTML = contentHTML;
            this.setHTMLChanged();
        },
        setTitle: function (titleHTML) {
            var titleElement = this.getTitleElement();
            if(!titleElement) return;

            titleElement.innerHTML = titleHTML;
            this.setHTMLChanged();
        },
        setHtml: function (html) {
            if(!this.hintElement) return;

            this.hintElement.innerHTML = html;
            this.setHTMLChanged();
        },
        /*# public void SetContent(object html, ASPxClientHintOptions options){ } #*/
        SetContent: function (html, options) {
            this.setContent(html);
            this.onHtmlSetted(options);
        },
        SetTitle: function (html, options) {
            this.setTitle(html);
            this.onHtmlSetted(options);
        },
        SetHTML: function (html, options) {
            this.setHtml(html);
            this.onHtmlSetted(options);
        },
        
        setHTMLChanged: function() {
            this.htmlChanged = true;
        },
        beforeHtmlSet: function() {
            this.htmlChanged = false;
        },
        afterHtmlSet: function() {
            if(this.htmlChanged === true) {
                this.onHtmlSetted();
                this.htmlChanged = false;
            }
        },
        onHtmlSetted: function(options) {
            if(!this.hintElement) return;

            if(this.options.autoProcessScriptsAndLinks || ( options && options.autoProcessScriptsAndLinks))
                ASPx.ProcessScriptsAndLinks(); // XAF: ASPx.ProcessScriptsAndLinks('_fakeControlId');
            if(this.options.autoUpdatePosition || ( options && options.autoUpdatePosition)) {
                this.UpdatePosition();
                //window.setTimeout(function(){ this.UpdatePosition(); }.aspxBind(this), 0);
            }
        },
        /*# public void SetContentLoading(){ } #*/
        SetContentLoading:function() {
            var contentElement = this.getContentElement();
            this.createLoadingPanel(contentElement);
        },
        SetTitleLoading:function() {
            var titleElement = this.getTitleElement();
            this.createLoadingPanel(titleElement);
        },
        createLoadingPanel: function(parent) {
            parent.innerHTML = "";
            ASPxClientHint.RenderHelper.createLoadingPanel(parent, this.options);
        },

        show: function () {
            ASPxClientHint.RenderHelper.show(this.targetElement, this.hintElement, this.options);
        },
        hideCore: function () {
            var cancel = false;

            // TODO move event into deactivating method
            var onShowingHasBeenCalled = this.getStatus() >= ASPxClientHintWindow.Statuses.activated;
            if (this.options.onHiding && onShowingHasBeenCalled) {
                var args = new ASPxClientHintHidingEventArgs(this.targetElement, this.hintElement, this.getContentElement(), this.getTitleElement(), cancel);
                this.options.onHiding(this, args);
                cancel = args.cancel;
            }

            if (!cancel)
                this.dismiss();
        },

        hide: function (viaAPI) {
            var notVisibleYet = this.getStatus() <= ASPxClientHintWindow.Statuses.created;
            if(notVisibleYet)
                this.hideCore();

            this.deactivating(viaAPI);
        },
        deactivating: function (viaAPI) {
            if (!this || this.getStatus() < ASPxClientHintWindow.Statuses.created) return;

            if (!viaAPI && this.options.disappearAfter > 0) {
                this.setDisappearTimer(function () {
                    this.completeDeactivating();
                }.aspxBind(this), this.options.disappearAfter);
            } else
                this.completeDeactivating();
        },
        completeDeactivating: function () {
            if (ASPxClientHint.OptionsParser.getHideAnimationEnabled(this.options)) {
                var duration = ASPxClientHint.OptionsParser.getHideAnimationDuration(this.options);
                if (this.hintElement) { // Info: in case of multiple deactivation
                    ASPx.AnimationHelper.fadeOut(this.hintElement, function () {
                        this.hideCore();
                    }.aspxBind(this), duration);
                }
            } else
                this.hideCore();
        },
        dismiss: function () {
            this.setStatus(ASPxClientHintWindow.Statuses.destroyed);
            if (this.hintElement !== null) {
                this.hintElement.parentNode.removeChild(this.hintElement);
                this.hintElement = null;
            }
        },

        status: 0,
        setStatus: function (status) {
            if (status === ASPxClientHintWindow.Statuses.created)
                ASPxClientHint.createdWindows.add(this);
            if (status === ASPxClientHintWindow.Statuses.destroyed)
                ASPxClientHint.createdWindows.remove(this);
            this.status = status;
        },
        getStatus: function () {
            return this.status;
        },

        disappearAfterTimerId: -1,
        disappearAfterTimerIsActive: function() {
            return this.disappearAfterTimerId >= 0;
        },
        setDisappearTimer: function (handler, disappearAfter) {
            this.disappearAfterTimerId = window.setTimeout(handler, disappearAfter);
        },
        stopDisappearTimer: function () {
            window.clearTimeout(this.disappearAfterTimerId);
            this.disappearAfterTimerId = -1;
        }

    };

    ASPxClientHintWindow.Statuses = {
        destroyed: -1,
        created: 1,
        activated: 2,
        shown: 3,
    };

    ASPxClientHint.RenderHelper = (function () {
        var CSS_PREFIX = "dxh-";

        function findBestParentToNest(targetElement, options) {
            if (typeof options.container === "string")
                return document.querySelectorAll(options.container)[0];
            else if (typeof options.container === "object")
                return options.container;
            return findBestParentToNestCore(targetElement, options);
        }
        function findBestParentToNestCore(element, options) {
            var renderToBody = !options.renderToTargetParent;
            if (renderToBody)
                return getFormOrBody();

            if (element.tagName == "TR" || element.tagName == "TD" || element.tagName == "TBODY")
                return element.offsetParent.parentNode;

            if (element.tagName == "BODY")
                return getFormOrBody();

            return element.parentNode;
        }
        function getFormOrBody() {
            var form = document.querySelectorAll("FORM")[0];
            return form && ASPx.IsElementVisible(form) ? form : document.body;
        }

        function getPositionClassName(position) {
            return CSS_PREFIX + position.toLowerCase();
        }
        function ensureCalloutPosition(mainElement, prevPosition, currentPosition) {
            var prevClassName = getPositionClassName(prevPosition);
            var currentClassName = getPositionClassName(currentPosition);

            ASPx.RemoveClassNameFromElement(mainElement, prevClassName);
            ASPx.AddClassNameToElement(mainElement, currentClassName);
        }
        function isPositionHorizontal(position) { // TODO refactor (unite with others)
            return position == "left" || position == "right";
        }
        function ensureCalloutShift(mainElement, options, shift) {
            var calloutElement = ASPxClientHint.RenderHelper.getCalloutElement(mainElement, options.classNames);
            if (!calloutElement) return;

            var isX = !isPositionHorizontal(options.position);
            var hintSize = isX ? mainElement.offsetWidth : mainElement.offsetHeight;
            var shiftSize = isX ? shift.x : shift.y;

            var calloutPos = hintSize / 2 - shiftSize;
            calloutPos = LimitCalloutPos(calloutPos, hintSize);

            var propName = isX ? "left" : "top";
            calloutElement.style[propName] = calloutPos;
        }
        function LimitCalloutPos(calloutPos, hintSize) {
            var padding = 15;
            var limits = { min: padding, max: hintSize - padding };
            var outsideMin = calloutPos < limits.min;
            var outsideMax = calloutPos > limits.max;

            if (outsideMax) calloutPos = limits.max;
            if (outsideMin) calloutPos = limits.min;
            calloutPos += "px";

            if (outsideMin && outsideMax) calloutPos = "50%";

            return calloutPos;
        }
        function getMainElementClasses(options) {
            var theme = options.theme || window['_aspxHintTheme'];
            if(theme == 'Default')
                theme = '';
            return getMainElementClassName(options.classNames.mainElementClassName, theme) + " " + options.classNames.sysClassName + " " + options.className + " " + getPositionClassName(options.position);
        }
        function getMainElementClassName(className, postfix) {
            if(className !== ASPxClientHint.OptionsParser.dxHintClassNames.mainElementClassName)
                return className;
            else
                return postfix ? className + "_" + postfix : className;
        }
        function createLoadingPanel(parent, options) {
            var loadingElement = document.createElement("DIV");
            loadingElement.className = "dxh-loading"; // TODO options.loadingClassName
            parent.appendChild(loadingElement);
            return loadingElement;
        }
        function create(targetElement, content, title, options) {
            var parent = findBestParentToNest(targetElement, options);

            var mainElement = document.createElement("DIV");
            mainElement.className = getMainElementClasses(options);
            parent.appendChild(mainElement);

            var calloutElement;
            if (options.showCallout) {
                calloutElement = document.createElement("DIV");
                calloutElement.className = options.classNames.calloutElementClassName;
                mainElement.appendChild(calloutElement);
            }

            if (title || options.showTitle === true) {
                var titleElement = document.createElement("DIV");
                titleElement.className = options.classNames.titleElementClassName;
                titleElement.innerHTML = title;
                mainElement.appendChild(titleElement);
            }

            var contentElement = document.createElement("DIV");
            contentElement.className = options.classNames.contentElementClassName;
            contentElement.innerHTML = content;
            mainElement.appendChild(contentElement);

            setSize(mainElement, options);

            return mainElement;
        }
        function getContentElement(mainElement, classNames) {
            return mainElement ? mainElement.getElementsByClassName(classNames.contentElementClassName)[0] : null;
        }
        function getTitleElement(mainElement, classNames) {
            return mainElement ? mainElement.getElementsByClassName(classNames.titleElementClassName)[0] : null;
        }
        function getCalloutElement(mainElement, classNames) {
            return mainElement ? mainElement.getElementsByClassName(classNames.calloutElementClassName)[0] : null;
        }

        function show(targetElement, hintElement, options) {
            hintElement.style.visibility = "hidden";
            hintElement.style.display = "block";

            togglePositionInCaseOfUndefinedHintSizes(targetElement, hintElement);
            updatePosition(targetElement, hintElement, options);

            hintElement.style.visibility = "";
        }
        function togglePositionInCaseOfUndefinedHintSizes(targetElement, hintElement) {
            var x = ASPx.GetAbsoluteX(targetElement);
            var y = ASPx.GetAbsoluteY(targetElement);
            ASPx.SetAbsoluteX(hintElement, x);
            ASPx.SetAbsoluteY(hintElement, y);
        }

        function updatePosition(targetElement, mainElement, options) {
            var maxSteps = 10;
            var hintChangesSizeDueMoving = false;
            do {
                var mainElementSize = { w: mainElement.offsetWidth, h: mainElement.offsetHeight };
                updatePositionStep(targetElement, mainElement, options);
                hintChangesSizeDueMoving = mainElementSize.w != mainElement.offsetWidth || mainElementSize.h != mainElement.offsetHeight;
                maxSteps --;
            } while (hintChangesSizeDueMoving && maxSteps > 0 );
        }
        function updatePositionStep(targetElement, mainElement, options) {
            var changes = ASPxClientHint.PositionHelper.set(targetElement, mainElement, options);
            ensureCalloutPosition(mainElement, options.position, changes.flipPosition);
            ensureCalloutShift(mainElement, options, changes.shift);
        }
        function setSize(mainElement, options) {
            mainElement.style.width = options.width;
            mainElement.style.height = options.height;
        }

        return {
            create: create,
            getContentElement: getContentElement,
            getTitleElement: getTitleElement,
            getCalloutElement: getCalloutElement,

            show: show,
            updatePosition: updatePosition,

            createLoadingPanel:createLoadingPanel,
        };
    })();

    /*# public delegate void ASPxClientHintShowingEventHandler(ASPxClientHintWindow sender, ASPxClientHintShowingEventArgs e);#*/
    /*# public class ASPxClientHintShowingEventArgs : ASPxClientEventArgs #*/
    var ASPxClientHintShowingEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
        /*# public ASPxClientHintShowingEventArgs(object targetElement, object hintElement, object contentElement, object titleElement, bool cancel) : base() {} #*/
        constructor: function (targetElement, hintElement, contentElement, titleElement, cancel) {
            this.constructor.prototype.constructor.call(this);
            /*# public object targetElement{ get{return null;} } #*/
            this.targetElement = targetElement;
            /*# public object hintElement{ get{return null;} } #*/
            this.hintElement = hintElement;
            /*# public object contentElement{ get{return null;} } #*/
            this.contentElement = contentElement;
            /*# public object titleElement{ get{return null;} } #*/
            this.titleElement = titleElement;
            /*# public bool cancel{ get{return false;} } #*/
            this.cancel = cancel;
        }
    });

    /*# public delegate void ASPxClientHintHidingEventHandler(ASPxClientHintWindow sender, ASPxClientHintHidingEventArgs e);#*/
    /*# public class ASPxClientHintHidingEventArgs : ASPxClientEventArgs #*/
    var ASPxClientHintHidingEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
        /*# public ASPxClientHintHidingEventArgs(object targetElement, object hintElement, object contentElement, object titleElement, bool cancel) : base() {} #*/
        constructor: function (targetElement, hintElement, contentElement, titleElement, cancel) {
            this.constructor.prototype.constructor.call(this);
            /*# public object targetElement{ get{return null;} } #*/
            this.targetElement = targetElement;
            /*# public object hintElement{ get{return null;} } #*/
            this.hintElement = hintElement;
            /*# public object contentElement{ get{return null;} } #*/
            this.contentElement = contentElement;
            /*# public object titleElement{ get{return null;} } #*/
            this.titleElement = titleElement;
            /*# public bool cancel{ get{return false;} } #*/
            this.cancel = cancel;
        }
    });


    /*# public class ASPxClientHintOptions: JavaScriptObject #*/
    /*# public ASPxClientHintOptions() : base(){} #*/
    ASPxClientHint.OptionsParser = (function () {
        var dxHintClassNames = {
            mainElementClassName: "dxhControl",
            sysClassName: "dxhSys",
            contentElementClassName: "dxh-content",
            calloutElementClassName: "dxh-callout",
            titleElementClassName: "dxh-title",
        };

        var defaults = {
            /*# public string triggerAction{ get{ return ""; } set{} } #*/
            triggerAction: ASPxClientHint.TriggerHelper.defaultTriggerAction,

            /*# public int appearAfter{ get{ return 0; } set{} } #*/
            /*# public int disappearAfter{ get{ return 0; } set{} } #*/
            appearAfter: 100,
            disappearAfter: 100,

            autoDisappearAfter: 0,

            /*# public bool showCallout{ get{ return true; } set{} } #*/
            showCallout: true,

            /*# public bool showTitle{ get{ return false; } set{} } #*/
            //showTitle: "default",

            /*# public string position{ get{ return ""; } set{} } #*/
            position: "top", // "top | bottom | left | right | auto"

            /*# public string className{ get{ return ""; } set{} } #*/
            className: "",
            classNames: dxHintClassNames,

            /*# public string contentAttribute{ get{ return ""; } set{} } #*/
            /*# public string titleAttribute{ get{ return ""; } set{} } #*/
            //contentAttribute: "",
            //titleAttribute: "",

            /*# public string content{ get{ return ""; } set{} } #*/
            /*# public string title{ get{ return ""; } set{} } #*/
            //content: "",
            //title: "",

            /*# public string container{ get{ return ""; } set{} } #*/
            //container: "",

            /*# public ASPxClientHintShowingEventHandler onShowing { get; set; } #*/
            //onShowing: function(sender, evtArgs ){ }

            /*# public ASPxClientHintHidingEventHandler onHiding { get; set; } #*/
            //onHiding: function(sender, evtArgs) { }

            /*# public string width{ get{ return ""; } set{} } #*/
            /*# public string height{ get{ return ""; } set{} } #*/
            //width: "",
            //height: "",

            /*# public int x{ get{ return 0; } set{} } #*/
            /*# public int y{ get{ return 0; } set{} } #*/
            //x: 0,
            //y: 0,

            /*# public bool allowFlip{ get{ return false; } set{} } #*/
            allowFlip: true,
            /*# public bool allowShift{ get{ return false; } set{} } #*/
            allowShift: true,

            /*# public JavaScriptObject animation{ get{ return null; } set{} } #*/
            animation: {
                show: {},
                hide: {}
            },

            /*# public int offset{ get{ return 0; } set{} } #*/
            offset: 4,

            autoProcessScriptsAndLinks: false,
            autoUpdatePosition: false,

            /*# public bool hideNativeTooltipForNestedTitleAttributes{ get{ return false; } set{} } #*/
            hideNativeTooltipForNestedTitleAttributes: false,
        };

        var defaultsByAPI = {
            triggerAction: "none",
        };
        var defaultsByAPIWithNoSelector = {
            showCallout: false
        };

        function ensureDefaults(options) {
            return ensureDefaultsCore(options, defaults);
        }
        function patchOptionsForShow(hasSelector, options) {
            options = cloneOptionsObject(options);

            if(options)
                delete options.triggerAction;

            options = ensureDefaultsCore(options, defaultsByAPI);
            if (hasSelector)
                options = ensureDefaultsCore(options, defaultsByAPIWithNoSelector);
            return options;
        }
        function ensureDefaultsCore(options, defaultOptions) {
            for (var defaultProperty in defaultOptions) {
                if (defaultOptions.hasOwnProperty(defaultProperty)) {
                    if (typeof options[defaultProperty] === "undefined")
                        options[defaultProperty] = defaultOptions[defaultProperty];
                }
            }

            return options;
        }

        function validate(options) {
            ASPxClientHint.TriggerHelper.validate(options.triggerAction);

            options.position = options.position.toLowerCase();
        }

        function parseUsersArgument(options) {
            if (typeof options === "undefined")
                options = { contentAttribute: "title" };
            else if (typeof options === "string")
                options = { contentAttribute: options };
            else if (typeof options === "function")
                options = { onShowing: options };
            return options;
        }
        function cloneOptionsObject(options) {
            if (!options) return options;
            if (typeof options === "function") return options;
            if (typeof options === "string") return options;

            var clone = {};
            for (var key in options) {
                if (Object.prototype.hasOwnProperty.call(options, key)) {
                    clone[key] = options[key];
                }
            }
            return clone;
        }

        function parse(options) {
            var optionsClone = cloneOptionsObject(options);

            optionsClone = parseUsersArgument(optionsClone);
            optionsClone = ensureDefaults(optionsClone);
            validate(optionsClone);

            return optionsClone;
        }

        var defultShowDuration = 200;
        var defultHideDuration = 100;
        function getShowAnimationEnabled(options) {
            return getShowAnimationEnabledCore(options) && getShowAnimationDuration(options) > 0;
        }
        function getShowAnimationEnabledCore(options) {
            if (options.animation === true) return true;
            if (options.animation === false) return false;
            if (options.animation) return !!options.animation.show;
        }
        function getHideAnimationEnabled(options) {
            return getHideAnimationEnabledCore(options) && getHideAnimationDuration(options) > 0;
        }
        function getHideAnimationEnabledCore(options) {
            if (options.animation === true) return true;
            if (options.animation === false) return false;
            if (options.animation && options.animation.hide === true) return true;
            if (options.animation) return !!options.animation.hide;
        }
        function getShowAnimationDuration(options) {
            if (!getShowAnimationEnabledCore(options)) return 0;

            return options.animation && options.animation.show && options.animation.show.duration >= 0 ?
                options.animation.show.duration :
                defultShowDuration;
        }
        function getHideAnimationDuration(options) {
            if (!getHideAnimationEnabledCore(options)) return 0;

            return options.animation && options.animation.hide && options.animation.hide.duration >= 0 ?
                options.animation.hide.duration :
                defultHideDuration;
        }

        return {
            dxHintClassNames:dxHintClassNames,

            parse: parse,
            patchOptionsForShow: patchOptionsForShow,

            getShowAnimationEnabled: getShowAnimationEnabled,
            getHideAnimationEnabled: getHideAnimationEnabled,
            getShowAnimationDuration: getShowAnimationDuration,
            getHideAnimationDuration: getHideAnimationDuration,

            // For testing purposes
            defaults: defaults,
            ensureDefaults: ensureDefaults
        };
    })();


    ASPxClientHint.events = (function () {

        function subscribe(targetSelector, eventName, handler) {
            var targetElements = document.querySelectorAll(targetSelector);
            for (var i = 0; i < targetElements.length; i++) {
                ASPx.Evt.AttachEventToElement(targetElements[i], eventName, handler);
            }
            return targetElements;
        }

        function unsubscribe(targetElements, eventName, handler) {
            for (var i = 0; i < targetElements.length; i++) {
                ASPx.Evt.DetachEventFromElement(targetElements[i], eventName, handler);
            }
        }

        return {
            subscribe: subscribe,
            unsubscribe: unsubscribe,
        };

    })();

    function PositionCalcContext(targetElement, hintElement, options) {
        this.targetElement = targetElement;
        this.hintElement = hintElement;
        this.options = options;
        this.position = options.position;

        this.calloutSize = { width: 0, height: 0 };
        var calloutElement = ASPxClientHint.RenderHelper.getCalloutElement(hintElement, options.classNames);
        if (calloutElement) {
            this.calloutSize.width = calloutElement.offsetWidth;
            this.calloutSize.height = calloutElement.offsetHeight;
        }

        this.horizontal = new SizeContent(targetElement, hintElement, options, this.calloutSize, true);
        this.vertical = new SizeContent(targetElement, hintElement, options, this.calloutSize, false);

        function SizeContent(targetElement, hintElement, options, calloutSize, isX) {
            this.location = 0;

            this.screen = { min: 0, max: 0 };
            this.screen.min = isX ? ASPx.GetDocumentScrollLeft() : ASPx.GetDocumentScrollTop();
            var viewPortWidth = ASPx.Browser.WebKitTouchUI ? window.innerWidth : ASPx.GetDocumentClientWidth();
            this.screen.max = this.screen.min + (isX ? viewPortWidth : ASPx.GetDocumentClientHeight());

            this.target = { min: 0, max: 0 };
            this.target.min = isX ? ASPx.GetAbsoluteX(targetElement) : ASPx.GetAbsoluteY(targetElement);
            this.target.max = this.target.min + (isX ? targetElement.offsetWidth : targetElement.offsetHeight);

            this.hintSize = isX ? hintElement.offsetWidth : hintElement.offsetHeight;
        }
    }

    var PositionHelper = (function () {
        function calcPosition(targetElement, hintElement, options) {
            var context = new PositionCalcContext(targetElement, hintElement, options);

            var positionOrientation = getPositionOrienation(context.position);

            if (options.allowFlip) {
                if (positionOrientation.horizontal)
                    context.position = ASPxClientHint.FlipPositionToClientScreenHelper.flipPositionIfRequired(context.horizontal, context.position);
                else if (positionOrientation.vertical)
                    context.position = ASPxClientHint.FlipPositionToClientScreenHelper.flipPositionIfRequired(context.vertical, context.position);
            }
            var offsets = getNotShiftedOffset(context);

            var minTargetMargin = 0;
            var shift = {
                x: 0,
                y: 0
            };
            if (options.allowShift) {
                shift.x = ASPxClientHint.ShiftPositionToClientScreenHelper.getShift(context.horizontal, positionOrientation, offsets.x, minTargetMargin, true);
                shift.y = ASPxClientHint.ShiftPositionToClientScreenHelper.getShift(context.vertical, positionOrientation, offsets.y, minTargetMargin, false);
            }

            return {
                location: {
                    x: offsets.x + shift.x,
                    y: offsets.y + shift.y
                },
                shift: shift,
                flipPosition: context.position
            };
        }
        function getPositionOrienation(position) {
            var vertical = position == "bottom" || position == "top";
            var horizontal = position == "right" || position == "left";
            return {
                vertical: vertical,
                horizontal: horizontal
            };
        }
        function getNotShiftedOffset(context) {
            var targetSize = {
                width: context.horizontal.target.max - context.horizontal.target.min,
                height: context.vertical.target.max - context.vertical.target.min,
            };
            var hintSize = {
                width: context.horizontal.hintSize,
                height: context.vertical.hintSize,
            };

            return getNotShiftedOffsetCore(context.position, targetSize, hintSize, context.calloutSize);
        }
        function getNotShiftedOffsetCore(position, targetSize, hintSize, calloutSize) {
            var offset = { x: 0, y: 0 };

            // Position
            if (position == "top")
                offset.y -= hintSize.height + calloutSize.height;
            else if (position == "bottom")
                offset.y += targetSize.height + calloutSize.height;
            else if (position == "left")
                offset.x -= hintSize.width + calloutSize.width;
            else if (position == "right")
                offset.x += targetSize.width + calloutSize.width;

            // Align center
            if (position == "top" || position == "bottom")
                offset.x += targetSize.width / 2 - hintSize.width / 2;
            if (position == "left" || position == "right")
                offset.y += targetSize.height / 2 - hintSize.height / 2;

            return offset;
        }
        function set(targetElement, windowElement, options) {
            var pos = calcPosition(targetElement, windowElement, options);

            var customOffsets = { x: 0, y: 0 };
            var positionOrientation = getPositionOrienation(pos.flipPosition);
            if (positionOrientation.horizontal)
                customOffsets.x = options.offset * pos.location.x / Math.abs(pos.location.x); // INFO IE does not support Math.sing()
            if (positionOrientation.vertical)
                customOffsets.y = options.offset * pos.location.y / Math.abs(pos.location.y);

            var x = typeof options["x"] !== "undefined" ? options.x : ASPx.GetAbsoluteX(targetElement) + pos.location.x + customOffsets.x;
            var y = typeof options["y"] !== "undefined" ? options.y : ASPx.GetAbsoluteY(targetElement) + pos.location.y + customOffsets.y;

            ASPx.SetAbsoluteX(windowElement, x);
            ASPx.SetAbsoluteY(windowElement, y);

            return {
                flipPosition: pos.flipPosition,
                shift: {
                    x: pos.shift.x,
                    y: pos.shift.y
                }
            };
        }

        return {
            set: set,

            getNotShiftedOffsetCore: getNotShiftedOffsetCore, // For testing purposes
        };
    })();

    var FlipPositionToClientScreenHelper = {
        flipPositionIfRequired: function (context, position) {
            return this.ensureFlipCore(context.screen, context.target, context.hintSize, position);
        },
        getFlipPosition: function (position) {
            if (position == "bottom")
                return "top";
            if (position == "top")
                return "bottom";
            if (position == "right")
                return "left";
            if (position == "left")
                return "right";
            return position;
        },
        ensureFlipCore: function (screen, target, hintSize, position) {
            var positionMax = position == "bottom" || position == "right";
            var positionMin = position == "top" || position == "left";

            var spaceToMin = (target.min - hintSize) - screen.min;
            if (target.min - hintSize > screen.max) spaceToMin = -1;
            var spaceToMax = screen.max - (target.max + hintSize);
            if (target.max + hintSize < screen.min) spaceToMax = -1;

            var enoughSpaceMin = spaceToMin >= 0;
            var enoughSpaceMax = spaceToMax >= 0;

            if (!enoughSpaceMin && !enoughSpaceMax)
                return position;

            var enoughSpaceToShowHintMinWithoutFlip = positionMin && enoughSpaceMin;
            if (enoughSpaceToShowHintMinWithoutFlip) {
                return position;
            }

            var enoughSpaceToShowHintMaxWithoutFlip = positionMax && enoughSpaceMax;
            if (enoughSpaceToShowHintMaxWithoutFlip) {
                return position;
            }

            var flipMinToMax = positionMin && !enoughSpaceMin && spaceToMin < spaceToMax;
            var flipMaxToMin = positionMax && !enoughSpaceMax && spaceToMax < spaceToMin;

            if (flipMinToMax) {
                return this.getFlipPosition(position);
            }

            if (flipMaxToMin) {
                return this.getFlipPosition(position);
            }

            return position;
        }
    };

    var ShiftPositionToClientScreenHelper = {
        getShift: function (context, positionOrientation, hintOffset, minTargetMargin, isX) {
            var hintShift = 0;

            var canShift = !(positionOrientation.horizontal && isX) &&
                !(positionOrientation.vertical && !isX);
            if (canShift)
                hintShift = this.getShiftCore(context.screen, context.target, context.hintSize, hintOffset, minTargetMargin);

            return hintShift;
        },

        getShiftCore: function (screen, target, hintSize, hintOffset, minTargetMargin) {
            var notShiftedPos = 0;
            var targetIsOutsideMin = target.max < screen.min + minTargetMargin;
            var targetIsOutsideMax = target.min > screen.max - minTargetMargin;
            if (targetIsOutsideMin || targetIsOutsideMax)
                return notShiftedPos;

            var hint = { min: target.min + hintOffset, max: target.min + hintOffset + hintSize };

            var targetPartiallyOutsideLeft = hint.min < screen.min && hint.max > screen.min;
            var targetPartiallyOutsideRight = hint.max > screen.max && hint.min < screen.max;

            if (targetPartiallyOutsideLeft && !targetPartiallyOutsideRight) {
                var newPos = screen.min;
                var shift = newPos - hint.min;
                return shift;
            }
            if (targetPartiallyOutsideRight && !targetPartiallyOutsideLeft) {
                var newPos = screen.max - hintSize;
                var shift = newPos - hint.min;
                return shift;
            }

            return notShiftedPos;
        }
    };

    var attributeHelper = {
        attributeNameToBackupTitle: "data-dxhint-title",
        getAttributeValue: function (targetElement, attributeName) {
            var value = targetElement.getAttribute(attributeName);

            if (attributeName === "title") {
                if (value)
                    return this.getRelocateTitleAttribute(targetElement);
                else if (value === "")
                    return targetElement.getAttribute(this.attributeNameToBackupTitle);
            }

            if (!value && attributeName === this.attributeNameToBackupTitle) {
                return this.getRelocateTitleAttribute(targetElement);
            }

            return value;
        },
        getRelocateTitleAttribute: function (targetElement) {
            var titleValue = targetElement.getAttribute("title");
            if (titleValue) {
                targetElement.setAttribute(this.attributeNameToBackupTitle, titleValue);
                targetElement.setAttribute("title", "");
            }

            return titleValue;
        }
    };

    ASPxClientHint.FlipPositionToClientScreenHelper = FlipPositionToClientScreenHelper;
    ASPxClientHint.ShiftPositionToClientScreenHelper = ShiftPositionToClientScreenHelper;

    ASPxClientHint.PositionHelper = PositionHelper;

    ASPxClientHint.AttributeHelper = attributeHelper;

    window.ASPxClientHint = ASPxClientHint;
})();

/// <reference path="_references.js"/>
/*# namespace DevExpress.Web.Scripts #*/

/*# public class ASPxClientTouchUIOptions : JavaScriptObject #*/
    /*# public bool showHorizontalScrollbar { get { return true; } } #*/    
    /*# public bool showVerticalScrollbar { get { return true; } } #*/    
    /*# public string vScrollClassName { get { return ""; } } #*/    
    /*# public string hScrollClassName { get { return ""; } } #*/    
(function() {
    var customScrollableElementsCollection = [];
    var SCROLLBAR_CLASSNAMES = {
        VERTICAL: "dxTouchVScrollHandle",
        HORIZONTAL: "dxTouchHScrollHandle",
        SHOWN_VERTICAL: "dxTouchScrollHandleVisible",
        SHOWN_HORIZONTAL: "dxTouchScrollHandleVisible",
        CUSTOMIZED_NATIVE: "dxTouchNativeScrollHandle"
    };

    ASPx.Evt.AttachEventToDocument("gesturestart", function() { 
        ASPx.TouchUIHelper.isGesture = true; 
    });
    ASPx.Evt.AttachEventToDocument("gestureend", function() { 
        ASPx.TouchUIHelper.isGesture = false; 
    });
    
    ASPx.TouchUIHelper.MakeScrollable = function(element, options) {
        return new ASPx.TouchUIHelper.ScrollExtender(element, options);
    };
    ASPx.TouchUIHelper.ScrollExtender = function(element, options) {
        this.parseOptions(options ? options : {});
        this.create(element);
    };
    ASPx.TouchUIHelper.preventScrollOnEvent = function(evt){
        evt.ASPxTouchUIScrollOff = true;
    };
    var isCustomScroll = function(elem) { return ASPx.Data.ArrayContains(customScrollableElementsCollection, elem); };
    var isNativeScroll = function(elem) {
        var style = window.getComputedStyle(elem);
        return ["overflow", "overflow-x", "overflow-y"].some(function(prop) {
            return ASPx.Data.ArrayContains(["scroll","auto"], style[prop]);
        });
    };
    var requirePreventCustomScroll = function(elem, scrollElement) {
        if(!scrollElement)
            return;
        while(elem && elem !== scrollElement && elem.tagName !== 'BODY') {
            if(isNativeScroll(elem) || isCustomScroll(elem))
                return true;
            elem = elem.parentNode;
        }
        return false;
    };
    ASPx.TouchUIHelper.RequirePreventCustomScroll = requirePreventCustomScroll;
    ASPx.TouchUIHelper.InitNativeScrolling = function(element, options) {
        if(options.showHorizontalScrollbar || options.showVerticalScrollbar){
            element.style["overflow"] = "scroll";
            element.style["overflow-x"] = options.showHorizontalScrollbar ? "scroll" : "hidden";
            element.style["overflow-y"] = options.showVerticalScrollbar ? "scroll" : "hidden";
            element.style["-webkit-overflow-scrolling"] = "touch";
            if(options.customizeNativeScrolling)
                ASPx.AddClassNameToElement(element, SCROLLBAR_CLASSNAMES.CUSTOMIZED_NATIVE);
        }
    };
    ASPx.TouchUIHelper.ScrollExtender.prototype = {
        ChangeElement: function(element){
            this.Destroy();
            this.create(element);
        },
        Destroy: function () {
            this.destroyScrollHandlers();
            this.detachEventHandlers();
            ASPx.Data.ArrayRemove(customScrollableElementsCollection, this.element);
        },
        
        acceptElement: function(element) {
            if(typeof(element) == "string")
                element = document.getElementById(element);
            this.element = element;
            this.touchEventHandlersElement = this.options.touchEventHandlersElement ? this.options.touchEventHandlersElement : this.element;

            if(ASPx.Browser.AndroidMobilePlatform){
                element.style["overflow-x"] = "hidden";
                element.style["overflow-y"] = "hidden";
            }
            return element;
        },
        create: function(element) {
            this.acceptElement(element);

            if(this.options.nativeScrolling) {
                ASPx.TouchUIHelper.InitNativeScrolling(this.element, this.options);
            } else {
                customScrollableElementsCollection.push(this.element);
                if(ASPx.Browser.IE) {
                    this.msGesture = new MSGesture();
                    this.msGesture.target = this.element;
                    this.pointerCount = 0;
                }
                this.createScrollHandlers();
                this.createEventHandlers();
                this.updateInitData();
                this.updateScrollHandles();
                this.attachEventHandlers();
            }
        },
        parseOptions: function(options) {
            this.options = {};
            this.options.showHorizontalScrollbar = options.showHorizontalScrollbar !== false;
            this.options.showVerticalScrollbar = options.showVerticalScrollbar !== false;
            this.options.acceleration = options.acceleration || 0.8;
            this.options.timeStep = options.timeStep || 50;
            this.options.minScrollbarSize = options.minScrollbarSize || 20;
            this.options.vScrollClassName = options.vScrollClassName || SCROLLBAR_CLASSNAMES.VERTICAL;
            this.options.hScrollClassName = options.hScrollClassName || SCROLLBAR_CLASSNAMES.HORIZONTAL;
            this.options.vScrollClassNameShown = [
                this.options.vScrollClassName, 
                options.vScrollClassNameShown || SCROLLBAR_CLASSNAMES.SHOWN_VERTICAL
            ].join(" ");
            this.options.hScrollClassNameShown = [
                this.options.hScrollClassName, 
                options.hScrollClassNameShown || SCROLLBAR_CLASSNAMES.SHOWN_HORIZONTAL
            ].join(" ");
            this.options.forceCustomScroll = options.forceCustomScroll === true;

            var nativeScrollPossible = !options.acceleration && !options.timeStep && !options.minScrollbarSize && !options.vScrollClassName && !options.hScrollClassName && !options.forceCustomScroll;
            if (nativeScrollPossible && ASPx.TouchUIHelper.IsNativeScrolling())
                this.options.nativeScrolling = true;
            if(ASPx.Browser.AndroidMobilePlatform && ASPx.Browser.WebKitFamily)
                this.options.customizeNativeScrolling = true;
            this.options.touchEventHandlersElement = options.touchEventHandlersElement;
            this.options.scrollPageIfCannotScrollDiv = options.scrollPageIfCannotScrollDiv === true;
            this.options.enableMultiTouchScrolling = options.enableMultiTouchScrolling !== false;
        },

        createEventHandlers: function() {
            var instance = this;
            this.onTouchStart = function(e) {
                if(ASPx.Browser.IE) {
                    instance.pointerCount++;
                    instance.msGesture.addPointer(e.pointerId);
                    if(instance.pointerCount != 1) return;
                }
                if(!instance.options.enableMultiTouchScrolling && ASPx.TouchUIHelper.IsMultiTouchEvent(e)) return;
                if(!ASPx.TouchUIHelper.isGesture){
                    if(!ASPx.TouchUIHelper.ScrollExtender.activeScrolling) {
                        if(requirePreventCustomScroll(ASPx.Evt.GetEventSource(e), instance.touchEventHandlersElement)) {
                            e.stopPropagation();
                            return;
                        }
                        ASPx.TouchUIHelper.ScrollExtender.activeScrolling = instance;
                        instance.startScroll(e);
                    }
                }
            };
            this.onTouchMove = function(e) {
                if(ASPx.Browser.IE && instance.pointerCount != 1) return;
                if(!instance.options.enableMultiTouchScrolling && ASPx.TouchUIHelper.IsMultiTouchEvent(e)) return;
                if(!ASPx.TouchUIHelper.isGesture && instance.ScrollingActive(e)) {
                    var scrolled = instance.scroll(e);
                    var alwaysPreventDefault = !instance.options.scrollPageIfCannotScrollDiv;
                    if((instance.scrollBarsShown && alwaysPreventDefault) || (!alwaysPreventDefault && scrolled))
                        e.preventDefault();
                }
            };
            this.onTouchEnd = function(e) {
                if(ASPx.Browser.IE) {
                    if(instance.pointerCount == 0) return;
                    instance.pointerCount--;
                }
                if(!instance.options.enableMultiTouchScrolling && ASPx.TouchUIHelper.IsMultiTouchEvent(e)) return;
                if(!ASPx.TouchUIHelper.isGesture) {
                    instance.scrollLeft = instance.element.scrollLeft;
                    instance.scrollTop = instance.element.scrollTop;
                    instance.stopScroll();
                    if(ASPx.TouchUIHelper.ScrollExtender.activeScrolling && ASPx.TouchUIHelper.ScrollExtender.activeScrolling.initTouchX == instance.initTouchX && ASPx.TouchUIHelper.ScrollExtender.activeScrolling.initTouchY == instance.initTouchY)
                        instance.MouseEventEmulationProtectHelper.onTouchEnd(instance.initTouchX, instance.initTouchY, e);
                    instance.ReleaseScrolling();
                }
            };
            this.onScroll = function(e) {
                if(ASPx.TouchUIHelper.isGesture && instance.ScrollingActive(e)) {
                    instance.showScrollBars();
                    instance.updateScrollHandles();
                }
            };
            this.onClick = function() {
                instance.MouseEventEmulationProtectHelper.onClick();
            };
        },
        createScrollHandlers: function() {
            if(this.options.showHorizontalScrollbar) {
                this.hScrollHandleElement = document.createElement("DIV");
                this.hScrollHandleElement.className = this.options.hScrollClassName;
                this.element.appendChild(this.hScrollHandleElement);
                this.hEndMargin = this.options.showVerticalScrollbar ? ASPx.PxToInt(ASPx.GetCurrentStyle(this.hScrollHandleElement).marginRight) : 0;
            }
            if(this.options.showVerticalScrollbar) {
                this.vScrollHandleElement = document.createElement("DIV");
                this.vScrollHandleElement.className = this.options.vScrollClassName;
                this.element.appendChild(this.vScrollHandleElement);
                this.vEndMargin = this.options.showHorizontalScrollbar ? ASPx.PxToInt(ASPx.GetCurrentStyle(this.vScrollHandleElement).marginBottom) : 0;
            }
        },
        destroyScrollHandlers: function() {
            if(this.hScrollHandleElement && this.hScrollHandleElement.parentNode)
                this.hScrollHandleElement.parentNode.removeChild(this.hScrollHandleElement);
                
            if(this.vScrollHandleElement && this.vScrollHandleElement.parentNode)
                this.vScrollHandleElement.parentNode.removeChild(this.vScrollHandleElement);

            this.hScrollHandleElement = null;
            this.vScrollHandleElement = null;
        },
        attachEventHandlers: function() {
            if(ASPx.Browser.WebKitTouchUI) {
                this.touchEventHandlersElement.addEventListener("touchstart", this.onTouchStart, false);
                this.touchEventHandlersElement.addEventListener("touchend"  , this.onTouchEnd  , false);
                this.touchEventHandlersElement.addEventListener("touchmove" , this.onTouchMove , false);
            } else if (ASPx.Browser.IE) {
                this.touchEventHandlersElement.addEventListener(ASPx.TouchUIHelper.pointerDownEventName  , this.onTouchStart, false);
                this.touchEventHandlersElement.addEventListener('MSGestureEnd'                           , this.onTouchEnd  , false);
                this.touchEventHandlersElement.addEventListener(ASPx.TouchUIHelper.pointerUpEventName    , this.onTouchEnd  , false);
                this.touchEventHandlersElement.addEventListener(ASPx.TouchUIHelper.pointerCancelEventName, this.onTouchEnd  , false);
                this.touchEventHandlersElement.addEventListener(ASPx.TouchUIHelper.pointerMoveEventName  , this.onTouchMove , false);
            }
            this.touchEventHandlersElement.addEventListener("scroll", this.onScroll, false);
            this.touchEventHandlersElement.addEventListener("click" , this.onClick , false);
        },
        detachEventHandlers: function() {
            if(ASPx.Browser.WebKitTouchUI) {
                this.touchEventHandlersElement.removeEventListener("touchstart", this.onTouchStart, false);
                this.touchEventHandlersElement.removeEventListener("touchend"  , this.onTouchEnd  , false);
                this.touchEventHandlersElement.removeEventListener("touchmove" , this.onTouchMove , false);
            } else if (ASPx.Browser.IE) {
                this.touchEventHandlersElement.removeEventListener(ASPx.TouchUIHelper.pointerDownEventName  , this.onTouchStart, false);
                this.touchEventHandlersElement.removeEventListener('MSGestureEnd'                           , this.onTouchEnd  , false);
                this.touchEventHandlersElement.removeEventListener(ASPx.TouchUIHelper.pointerUpEventName    , this.onTouchEnd  , false);
                this.touchEventHandlersElement.removeEventListener(ASPx.TouchUIHelper.pointerCancelEventName, this.onTouchEnd  , false);
                this.touchEventHandlersElement.removeEventListener(ASPx.TouchUIHelper.pointerMoveEventName  , this.onTouchMove , false);
            }
            this.touchEventHandlersElement.removeEventListener("scroll", this.onScroll, false);
            this.touchEventHandlersElement.removeEventListener("click" , this.onClick , false);
        },
        updateInitData: function() {
            window.clearTimeout(this.inertialStopTimerId);
            this.initScrollLeft = this.element.scrollLeft;
            this.initScrollTop = this.element.scrollTop;
            this.scrollLeft = this.initScrollLeft;
            this.scrollTop = this.initScrollTop;
            this.initElementX = ASPx.GetAbsoluteX(this.element);
            this.initElementY = ASPx.GetAbsoluteY(this.element);
            this.scrollTime = new Date();
            this.vx = 0;
            this.vy = 0;
            this.vxs = [];
            this.vys = [];
        },

        ScrollingActive: function(e){
            return (!e || !e.ASPxTouchUIScrollOff) && ASPx.TouchUIHelper.ScrollExtender.activeScrolling == this;
        },
        ReleaseScrolling: function(){
            if(this.ScrollingActive())
                ASPx.TouchUIHelper.ScrollExtender.activeScrolling = null;
        },
        startScroll: function(e) {
            this.initTouchX = ASPx.TouchUIHelper.getEventX(e);
            this.initTouchY = ASPx.TouchUIHelper.getEventY(e);
            this.lastTouchX = this.initTouchX;
            this.lastTouchY = this.initTouchY;

            this.updateInitData();
            this.updateScrollHandles();
            this.showScrollBars();
        },
        scroll: function(e) {
            var el = this.element;
            var opts = this.options;
            var currentTouchX = ASPx.TouchUIHelper.getEventX(e);
            var currentTouchY = ASPx.TouchUIHelper.getEventY(e);

            var newX = this.initScrollLeft + (this.initTouchX - currentTouchX);
            var newY = this.initScrollTop  + (this.initTouchY - currentTouchY);

            var dt = (new Date() - this.scrollTime);
            if(dt < 1) dt = 1;


            var dx = this.lastTouchX - currentTouchX;
            var dy = this.lastTouchY - currentTouchY;
            this.lastTouchX = currentTouchX;
            this.lastTouchY = currentTouchY;

            this.vx = dx / dt;
            this.vy = dy / dt;
            this.vxs.push(this.vx);
            this.vys.push(this.vy);

            var applyScrollX = opts.showHorizontalScrollbar;
            var applyScrollY = opts.showVerticalScrollbar;

            var stuck = false;
            if (opts.scrollPageIfCannotScrollDiv) {
        	    var sensitivity = 5;
    	        var dxSignificant = Math.abs(dx) > sensitivity;
	            var dySignificant = Math.abs(dy) > sensitivity;

				var xStuck = !applyScrollX;
            	var yStuck = !applyScrollY;

                xStuck = xStuck || (this.scrollLeft == 0 && dx < 0);
                xStuck = xStuck || (this.scrollLeft == el.scrollWidth - el.clientWidth && dx > 0);
                xStuck = xStuck && dxSignificant && Math.abs(dx) > Math.abs(dy);

                yStuck = yStuck || (this.scrollTop == 0 && dy < 0);
                yStuck = yStuck || (this.scrollTop == el.scrollHeight - el.clientHeight && dy > 0);
                yStuck = yStuck && dySignificant && Math.abs(dy) > Math.abs(dx);

				stuck = xStuck || yStuck;
                applyScrollX = !stuck;
                applyScrollY = !stuck;
            }

            if (applyScrollX) {
                this.scrollLeft = newX;
                el.scrollLeft = newX;
            }
                
            if (applyScrollY) {
                this.scrollTop = newY;
                el.scrollTop = newY;
            }

            if(stuck) {
                this.scrollLeft = el.scrollLeft;
                this.scrollTop = el.scrollTop;
            }

            this.updateScrollHandles();
            this.scrollTime = new Date();

			var scrolled = applyScrollX || applyScrollY;
            return scrolled;
        },
        stopScroll: function() {
            var instance = this;
            var element = this.element;
            var acceleration = this.options.acceleration;
            var timeStep = this.options.timeStep;

            if(this.vxs && this.vxs.length === 0) return;

            if(this.vxs){
                var countToSmooth = 3;
                var lenToSlice = Math.max(this.vxs.length - countToSmooth, 0);
                this.vxs = this.vxs.slice(lenToSlice);
                this.vys = this.vys.slice(lenToSlice);

                this.vx = Math.min.apply(null, this.vxs);
                if(this.vx < 0)
                    this.vx = Math.max.apply(null, this.vxs);
                this.vy = Math.min.apply(null, this.vys);
                if(this.vy < 0)
                    this.vy = Math.max.apply(null, this.vys);

                delete this.vxs;
				delete this.vys;
            }

            this.inertialStopTimerId = window.setTimeout(function() {

                instance.vx *= acceleration;
                instance.vy *= acceleration;
            
                if(Math.abs(instance.vx) < 0.1)
                    instance.vx = 0;
                if(Math.abs(instance.vy) < 0.1) 
                    instance.vy = 0;
            
                if(instance.vx == 0 && instance.vy == 0) {
                    instance.hideScrollBars();
                    return;
                }

                var dx = Math.ceil(instance.vx * timeStep);
                var dy = Math.ceil(instance.vy * timeStep);

                if(instance.options.showHorizontalScrollbar){
                    instance.scrollLeft += dx;
                    element.scrollLeft = instance.scrollLeft;
				}
                if(instance.options.showVerticalScrollbar){
                    instance.scrollTop += dy;
                    element.scrollTop = instance.scrollTop;
				}
            
                if(element.scrollLeft + element.clientWidth >= element.scrollWidth || element.scrollLeft <= 0)
                    instance.vx = 0;
            
                if(element.scrollTop + element.clientHeight>= element.scrollHeight || element.scrollTop <= 0)
                    instance.vy = 0;
            
                instance.updateScrollHandles();
                instance.stopScroll();
            }, timeStep);
        },
        updateScrollHandles: function() {
            if(this.hScrollHandleElement) {
                var scrollHandler = this.calcScrollHandles(this.element.scrollWidth, this.element.clientWidth,
                    this.options.minScrollbarSize, this.element.scrollLeft, this.hEndMargin);

                this.hScrollHandleElement.style.width = scrollHandler.size + "px";
                ASPx.SetAbsoluteX(this.hScrollHandleElement, this.initElementX + scrollHandler.pos);
                ASPx.SetAbsoluteY(this.hScrollHandleElement, this.initElementY + this.element.clientHeight - 
                    this.hScrollHandleElement.offsetHeight);
            }
            if(this.vScrollHandleElement) {
                var scrollHandler = this.calcScrollHandles(this.element.scrollHeight, this.element.clientHeight,
                    this.options.minScrollbarSize, this.element.scrollTop, this.vEndMargin);
                this.vScrollHandleElement.style.height = scrollHandler.size + "px";
                ASPx.SetAbsoluteX(this.vScrollHandleElement, this.initElementX + this.element.clientWidth - this.vScrollHandleElement.offsetWidth);
                ASPx.SetAbsoluteY(this.vScrollHandleElement, this.initElementY + scrollHandler.pos);
            }
        },
        calcScrollHandles: function(scrollSize, clientSize, scrollBarMinSize, scrollPos, endMargin) {
            var scrollBarSize = clientSize * clientSize / scrollSize;
            scrollBarSize = scrollBarSize > scrollBarMinSize ? scrollBarSize : scrollBarMinSize;
            var k = (scrollSize == clientSize) ? 0 :
                (clientSize - scrollBarSize - endMargin) / (scrollSize - clientSize);
            return {size:scrollBarSize, pos:scrollPos * k};
        },
        showScrollBars: function() {
            var needVScrollHandle = this.element.scrollHeight > this.element.clientHeight;
            var needHScrollHandle = this.element.scrollWidth > this.element.clientWidth;
            if(this.vScrollHandleElement && needVScrollHandle)
                this.vScrollHandleElement.className = this.options.vScrollClassNameShown;
            if(this.hScrollHandleElement && needHScrollHandle)
                this.hScrollHandleElement.className = this.options.hScrollClassNameShown;
            this.scrollBarsShown = needVScrollHandle || needHScrollHandle;
        },
        hideScrollBars: function() {
            if(this.vScrollHandleElement)
                this.vScrollHandleElement.className = this.options.vScrollClassName;
            if(this.hScrollHandleElement)
                this.hScrollHandleElement.className = this.options.hScrollClassName;
            this.scrollBarsShown = false;
        },
        MouseEventEmulationProtectHelper: {
            onTouchEnd: function(initTouchX, initTouchY, e) {
                var difX = initTouchX - ASPx.TouchUIHelper.getEventX(e);
                var difY = initTouchY - ASPx.TouchUIHelper.getEventY(e);
                if(Math.abs(difX) > ASPx.TouchUIHelper.clickSensetivity || Math.abs(difY) > ASPx.TouchUIHelper.clickSensetivity){
                    ASPx.TouchUIHelper.isMouseEventFromScrolling = true;
                    window.setTimeout(function(){ ASPx.TouchUIHelper.isMouseEventFromScrolling = false; }, 100);
                }
            },
            onClick: function(){
                if(ASPx.TouchUIHelper.isMouseEventFromScrolling){
                    window.setTimeout(function(){ ASPx.TouchUIHelper.isMouseEventFromScrolling = false; }, 0);
                }
            }
        }
    };
    ASPx.TouchUIHelper.FastTapHelper = (function() {
        var actions = [];
        var DISTANCE_LIMIT = 10;
        var startX;
        var startY;
        var preventCommonClickEvents = false;
        var invokeActions = function(actions) {
            for(var i = 0; i < actions.length; i++)
                actions[i]();
        };
        var onTouchStart = function(e) {
            if(preventCommonClickEvents)
                e.stopPropagation();
            if(actions.length > 1)
                return;
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
            if(ASPx.Browser.AndroidDefaultBrowser)
                e.currentTarget.addEventListener("click", onClick, false);
            else
                e.currentTarget.addEventListener("touchend", onTouchEnd, false);
        };
        if(ASPx.Browser.AndroidDefaultBrowser) {
            var onClick = function(e) {
                invokeActions(actions);
                actions = [];
                e.currentTarget.removeEventListener("click", onClick, false);
            };
        } else {
            var onTouchEnd = function(e) {
                if(preventCommonClickEvents) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                var stopX = e.changedTouches[0].clientX;
                var stopY = e.changedTouches[0].clientY;
                var distanceX = Math.abs(startX - stopX);
                var distanceY = Math.abs(startY - stopY);
                var allowClick = distanceX < DISTANCE_LIMIT && distanceY < DISTANCE_LIMIT;
                if(allowClick) {
                    var actionsToInvoke = actions;
                    setTimeout(function() { invokeActions(actionsToInvoke); }, 0);
                }
				actions = [];
                e.currentTarget.removeEventListener("touchend", onTouchEnd, false);
            };
        }
        return {
            HandleFastTap: function(e, tapAction, preventClickEvents) {
                if(e.touches.length > 1)
                    return;
                preventCommonClickEvents = preventClickEvents;
                actions.push(tapAction);
                onTouchStart(e);
            }
        };
    })();

    ASPx.TouchUIHelper.doubleTapEventName = "dxDoubleTap";
    ASPx.TouchUIHelper.allowDoubleTapProcessing = function(e) {
        var DOUBLE_TAP_DELAY = 600;
        var DISTANCE_LIMIT = 10;
        var currentTapTime = e.timeStamp;
        var currentX = e.changedTouches[0].clientX;
        var currentY = e.changedTouches[0].clientY;
        var lastTapTime = this["lastTap"] || currentTapTime;
        var lastX = this["lastX"] || currentX;
        var lastY = this["lastY"] || currentY;

        this["lastTap"] = currentTapTime;
        this["lastX"] = currentX;
        this["lastY"] = currentY;
        var delay = currentTapTime - lastTapTime;

        return delay && delay <= DOUBLE_TAP_DELAY && e.touches.length === 1 &&
            Math.abs(currentX - lastX) <= DISTANCE_LIMIT &&
            Math.abs(currentY - lastY) <= DISTANCE_LIMIT;
    };
    ASPx.TouchUIHelper.AttachDoubleTapEventToElement = function(element, action) {
        var onTouchEnd = function(e) {
            e.currentTarget.removeEventListener("touchend", onTouchEnd, false);
            e[ASPx.TouchUIHelper.doubleTapEventName] = true;
            var startActionAfterFastTap = function() {
                window.setTimeout(function(){ action(e); }, 0);
            };
            startActionAfterFastTap();
        };
        var onTouchStart = function(e) {
            if(ASPx.TouchUIHelper.allowDoubleTapProcessing(e)) {
                var preventZoom = function() { e.preventDefault(); };
                preventZoom();
                e.currentTarget.addEventListener("touchend", onTouchEnd, false);
            }
        };
        element.addEventListener("touchstart", onTouchStart, false);
    };

    ASPx.TouchUIHelper.HasCustomizedNativeScrollBarClass = function(element) {
        return element && ASPx.ElementHasCssClass(element, SCROLLBAR_CLASSNAMES.CUSTOMIZED_NATIVE);
    };
    ASPx.TouchUIHelper.IsMultiTouchEvent = function(e) {
        return e.touches && e.touches.length > 1;
    };
/*# public class ASPxClientTouchUI : JavaScriptObject #*/
    window.ASPxClientTouchUI = {};
    /*# public static ScrollExtender MakeScrollable(string id){ return null; } #*/
    /*# public static ScrollExtender MakeScrollable(object element){ return null; } #*/
    /*# public static ScrollExtender MakeScrollable(string id, ASPxClientTouchUIOptions options){ return null; } #*/
    /*# public static ScrollExtender MakeScrollable(object element, ASPxClientTouchUIOptions options){ return null; } #*/
    window.ASPxClientTouchUI.MakeScrollable = ASPx.TouchUIHelper.MakeScrollable;

    /*# public class ScrollExtender : JavaScriptObject #*/
    /*# public void ChangeElement(string id){ return; } #*/
    /*# public void ChangeElement(object element){ return; } #*/
    window.ASPxClientTouchUI.ScrollExtender = ASPx.TouchUIHelper.ScrollExtender;
})();
(function() {
/*# using DevExpress.Web.Scripts; #*/
/*# namespace DevExpress.Web.ASPxSpreadsheet.Scripts #*/

ASPx.SpreadsheetUploadControlUrlParametr = "DXSSUC";

/*# public delegate void ASPxClientSpreadsheetCustomCommandExecutedEventHandler(object source, ASPxClientSpreadsheetCustomCommandExecutedEventArgs e); #*/
/*# public class ASPxClientSpreadsheetCustomCommandExecutedEventArgs : ASPxClientEventArgs #*/
var ASPxClientSpreadsheetCustomCommandExecutedEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
    /*# public ASPxClientSpreadsheetCustomCommandExecutedEventArgs(string commandName, object parameter) : base() {} #*/
    constructor: function(commandName, parameter, item) {
        this.constructor.prototype.constructor.call(this);
        /*# public string commandName { get { return ""; } } #*/
        this.commandName = commandName;
        /*# public string parameter { get { return ""; } } #*/
        this.parameter = parameter;
        /*# [Obsolete("This property is now obsolete. Use the commandName property instead.")] #*/
        /*# public ASPxClientRibbonItem item { get { return null; } } #*/
        this.item = item;
    }
});

/*# public delegate void ASPxClientSpreadsheetDocumentChangedEventHandler(object source, ASPxClientSpreadsheetDocumentChangedEventArgs e); #*/
/*# public class ASPxClientSpreadsheetDocumentChangedEventArgs : ASPxClientEventArgs #*/
var ASPxClientSpreadsheetDocumentChangedEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
    /*# public ASPxClientSpreadsheetDocumentChangedEventArgs() : base() {} #*/
    constructor: function() {
        this.constructor.prototype.constructor.call(this);
    }
});

/*# public delegate void ASPxClientSpreadsheetSynchronizationEventHandler(object source, ASPxClientSpreadsheetSynchronizationEventArgs e); #*/
/*# public class ASPxClientSpreadsheetSynchronizationEventArgs : ASPxClientEventArgs #*/
var ASPxClientSpreadsheetSynchronizationEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
    /*# public ASPxClientSpreadsheetSynchronizationEventArgs() : base() {} #*/
    constructor: function() {
        this.constructor.prototype.constructor.call(this);
    }
});

/*# public delegate void ASPxClientSpreadsheetHyperlinkClickEventHandler(object source, ASPxClientSpreadsheetHyperlinkClickEventArgs e); #*/
/*# public class ASPxClientSpreadsheetHyperlinkClickEventArgs : ASPxClientEventArgs #*/
var ASPxClientSpreadsheetHyperlinkClickEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
    /*# public ASPxClientSpreadsheetHyperlinkClickEventArgs(Object htmlEvent, bool handled, ASPxClientOfficeDocumentLinkType hyperlinkType, string targetUri) : base() {} #*/
    constructor: function(htmlEvent, handled, targetUri, hyperlinkType) {
        this.constructor.prototype.constructor.call(this);
        /*# public bool handled { get { return false; } set {} } #*/
        this.handled = handled;
        /*# public Object htmlEvent { get { return null; } } #*/
        this.htmlEvent = htmlEvent;
        /*# public ASPxClientOfficeDocumentLinkType hyperlinkType { get { return null; } } #*/
        this.hyperlinkType = hyperlinkType;
        /*# public string targetUri { get { return ""; } } #*/
        this.targetUri = targetUri;
    }
});
    //

/*# public delegate void ASPxClientSpreadsheetPopupMenuShowingEventHandler(object source, ASPxClientSpreadsheetPopupMenuShowingEventArgs e); #*/
/*# public class ASPxClientSpreadsheetPopupMenuShowingEventArgs : ASPxClientCancelEventArgs #*/
var ASPxClientSpreadsheetPopupMenuShowingEventArgs = ASPx.CreateClass(ASPxClientCancelEventArgs, {
    /*# public ASPxClientSpreadsheetPopupMenuShowingEventArgs(object menuItems, object menuType) : base() {} #*/
    constructor: function(menuItems, menuType) {
        this.constructor.prototype.constructor.call(this);
        /*# public ASPxClientSpreadsheetPopupMenuItemCollection menuItems { get { return null; } } #*/
        this.menuItems = menuItems;
        /*# public ASPxClientSpreadsheetPopupMenuType menuType { get { return ASPxClientSpreadsheetPopupMenuType.Cell; } } #*/
        this.menuType = menuType;
    }
});

/*# public delegate void ASPxClientSpreadsheetViewModeChangedEventHandler(object source, ASPxClientSpreadsheetViewModeChangedEventArgs e); #*/
/*# public class ASPxClientSpreadsheetViewModeChangedEventArgs : ASPxClientEventArgs #*/
var ASPxClientSpreadsheetViewModeChangedEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
    /*# public ASPxClientSpreadsheetViewModeChangedEventArgs(object oldViewMode) : base() {} #*/
    constructor: function(oldViewMode) {
        this.constructor.prototype.constructor.call(this);
        /*# public ASPxClientSpreadsheetViewMode oldViewMode { get { return ASPxClientSpreadsheetViewMode.Editing; } } #*/
        this.oldViewMode = oldViewMode;
    }
});
var SpreadsheetCssClasses = {
    MainSheetDiv: "dxss-md",
    ScrollContainer: "dxss-sc",
    GridContainer: "dxss-grid",
    
    HeaderContainer: "hcc",
    HeaderRow: "dxss-rowHeader",
    HeaderColumn: "dxss-colHeader",
    HeaderCell: "dxss-htd",

    SingleCellTextBox: "dxss-sctb",
    ComplexCellTextBox: "dxss-cctb",
    BackgroundCellTextBox: "dxss-tbg",
    TextBoxContent: "dxss-tb",
    MultylineTextContainer: "dxss-mltc",
    DrawingBox: "dxss-db",
    CellSelectedBorderElement: "dxss-csb",
    CellDynamicSelectionElement: "dxss-cdse",
    CellActiveSelectedElement: "dxss-case",
    CellRangeSelectedElement: "dxss-crse",
    TopRangeBorderElement: "dxss-trbe",
    RightRangeBorderElement: "dxss-rrbe",
    BottomRangeBorderElement: "dxss-brbe",
    LeftRangeBorderElement: "dxss-lrbe",
    SelectionBorderElement: "dxss-sbe",
    TouchSelectionElement: "dxss-tse",
    TouchResizeElement: "dxss-tre",
    FillContainerElement: "dxss-ftc",
    ComplexBoxContainer: "dxss-mc",
    AutoFilterImage: "dxss-afi",
    DropDownButtonImage: "dxss-ddb",
    PopupMessage: "dxss-pm",
    DropDownPanel: "dxss-ddp",
    InvalidDataCircle: "dxss-idc",
    FillHandleElement: "dxss-fh",
    CopiedRange: "dxss-crs",
    CutRange: "dxss-crsb",

    DrawingBoxSelectedElement: "dxss-dbse",
    ChartElement: "dxss-chart",
    CellEditorElement: "dxss-cee",
    CellTextViewElement: "dxss-ctve", // TODO Text?

    VerticalResizeGrip: "dxss-vrg",
    HorizontalResizeGrip: "dxss-hrg",

    FormulaBarEditMode: "fbem",
    InplaceCellEditMode: "icbem",
    NoEditMode: "nem",

    GridLineHidden: "dxss-hideGridLines",
    HeadingsHidden: "dxss-hh",
    GridLineHorizontal: "dxss-h",
    GridLineVertical: "dxss-v",
    GridLineContainer: "dxss-gl",
    TileContainer: "dxss-tc",
    SupportFrameElement: "dxss-supportFrame",
    InputTargetFrameElement: "dxss-inputTarget",
    ResizeMovedContainer: "dxss-rmc",

    CommentBox: "dxss-cc",
    CommentEditorElement: "dxss-icee",
    CommentIndicator: "dxss-ci",
    CommentBoxTemporaryElement: "dxss-ccte",
    CommentBoxSelectionElement: "dxss-cbse",

    FloatingContainer: "dxss-fc",
    TopSpacer: "dxss-ts",
    BottomSpacer: "dxss-bs",
    LeftSpacer: "dxss-ls",
    RightSpacer: "dxss-rs",

    FloatingActionPanel: "dxss-fap",
    FloatingActionPanelButton: "dxss-fapb",
    FloatingActionApplyButton: "dxss-ab",
    FloatingActionCancelButton: "dxss-cb",
    FloatButtonImage: "dxss-fbi",
    FloatButtonStem: "dxss-fbs",
    FloatButtonKick: "dxss-fbk",

    SelectSheetButton: "dxss-ssb",
    SelectSheetButtonArrow: "dxss-ssbi",

    MaxElementZIndex: 12,
    getGridLine: function(isCol){ return isCol ? this.GridLineVertical : this.GridLineHorizontal; }
};

ASPx.SpreadsheetSessionGuidStateKey = "dxwsid";

/*# public class ASPxClientSpreadsheet : ASPxClientControl #*/
var ASPxClientSpreadsheet = ASPx.CreateClass(ASPxClientControl, {
    constructor: function (name) {
        this.constructor.prototype.constructor.call(this, name);

        this.sessionGuid = null;
        this.tileSize = { col: 0, row: 0 };
        this.defaultCellSize = { width: 0, height: 0 };
        this.visibleRangePadding = { col: 0, row: 0 };
        this.lastFilledCell = { col: 0, row: 0 };
        this.currentActiveCell = {col:-1, row:-1}; // TODO rename to this.currentActiveCellForSelection
        this.stateController = null;
        this.sheetLoaded = false;
        this.keyboardManager = null;
        this.ribbonManager = null;
        this.ribbonClientID = "";
        this.readOnly = false;
        this.viewMode = ASPxClientSpreadsheetViewMode.Editing;
        this.hasWorkFolder = true;
        this.handlerRequestCount = 0;
        this.endCallbackEventLockCount = 0;
        this.chartsInfo = {};
        this.fullScreenTempVars = {};
        this.isInFullScreenMode = false;
        this.forceUpdateDialogCollection = {};
        this.clientInstanceGuid = "00000000-0000-0000-0000-000000000000";
        this.currentClipboardBufferId = "00000000-0000-0000-0000-000000000000";
        this.gridLinesVisible = false;

        this.adjustmentDelatHeight = 200;
        this.adjustmentDelatWidth = 400;
        
        this.modified = false;
        this.updateWatcherHelper = null;

        this.showFormulaBar = true;
        this.cellTextViewElement = null;

        this.synchrinizeUnsavedChangesBeforeDialogCallback = true;

        this.sheetLocked = false;
        this.workbookLocked = false;

        this.modelBoxSelection = false;

        /*# public event ASPxClientBeginCallbackEventHandler BeginCallback{ add{} remove{}}#*/
        /*# public event ASPxClientEndCallbackEventHandler EndCallback{ add{} remove{}}#*/
        /*# public event ASPxClientCallbackErrorEventHandler CallbackError{ add{} remove{}}#*/
        /*# public event ASPxClientSpreadsheetSelectionChangedEventHandler SelectionChanged { add{} remove{} } #*/
        this.SelectionChanged = new ASPxClientEvent();

        /*# public event ASPxClientSpreadsheetCustomCommandExecutedEventHandler CustomCommandExecuted { add{} remove{} } #*/
        this.CustomCommandExecuted = new ASPxClientEvent();

        /*# public event ASPxClientSpreadsheetDocumentChangedEventHandler DocumentChanged { add{} remove{} } #*/
        this.DocumentChanged = new ASPxClientEvent();

        /*# public event ASPxClientSpreadsheetSynchronizationEventHandler BeginSynchronization { add{} remove{} } #*/
        this.BeginSynchronization = new ASPxClientEvent();

        /*# public event ASPxClientSpreadsheetSynchronizationEventHandler EndSynchronization { add{} remove{} } #*/
        this.EndSynchronization = new ASPxClientEvent();

        /*# public event ASPxClientSpreadsheetViewModeChangedEventHandler ViewModeChanged { add{} remove{} } #*/
        this.ViewModeChanged = new ASPxClientEvent();

        /*# public event ASPxClientSpreadsheetHyperlinkClickEventHandler HyperlinkClick { add{} remove{} } #*/
        this.HyperlinkClick = new ASPxClientEvent();

        /*# public event ASPxClientSpreadsheetPopupMenuShowingEventHandler PopupMenuShowing { add{} remove{} } #*/
        this.PopupMenuShowing = new ASPxClientEvent();

        /*# public event ASPxClientSpreadsheetCellBeginEditEventHandler CellBeginEdit { add{} remove{} } #*/
        this.CellBeginEdit = new ASPxClientEvent();

        /*# public event ASPxClientSpreadsheetCellEndEditEventHandler CellEndEdit { add{} remove{} } #*/
        this.CellEndEdit = new ASPxClientEvent();

        /*# public event ASPxClientSpreadsheetCellCancelEditEventHandler CellCancelEdit { add{} remove{} } #*/
        this.CellCancelEdit = new ASPxClientEvent();

        /*# public event ASPxClientCancelEventHandler ProtectionWarning { add{} remove{} } #*/
        this.ProtectionWarning = new ASPxClientEvent();
    },
    // Initialization
    InlineInitialize: function() {
        this.genarateClientInstanceGuid();
        ASPxClientControl.prototype.InlineInitialize.call(this);
        if(this.isInFullScreen()) {
            this.setFullScreenModeFlag(!this.isInFullScreen());
            window.setTimeout(function () {
                this.onUICommand(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FullScreen").id);
            }.aspxBind(this), 0);
            
        }
    },
    Initialize: function() {
        ASPxClientControl.prototype.Initialize.call(this);
        ASPx.AddClassNameToElement(this.GetMainElement(), ASPx.SpreadsheetCssClasses.NoEditMode);
        this.prepareChildControls();
    },
    AfterInitialize: function() {
        this.initializeUpdateWatcherHelper();
        this.initializeStateWatcherHelper();
        ASPxClientControl.prototype.AfterInitialize.call(this);
        this.InitializeControl();
    },
    InitializeControl: function() {
        this.InitializeChildControls();
        this.InitializeDocument();        
    },
    InitializeChildControls: function() {
        if(this.isSheetSelectorExist())
            this.getTabControl().onInit(this);
    },
    InitializeDocument: function() {
        this.asyncTracker = new ASPx.AsyncTracker();
        if(this.sessionIsOpened()) {
            this.loadCurrentSheet();
        }
    },
    AfterCreate: function() {
        this.createChildControls();
        ASPxClientControl.prototype.AfterCreate.call(this);
    },
    initializeUpdateWatcherHelper: function() {
        if(this.getConfirmUpdateText())
            this.updateWatcherHelper = new ASPxClientSpreadsheet.UpdateWatcherHelper(this);
    },
    initializeStateWatcherHelper: function() {
        if(!this.stateWatcherHelper) {
            this.stateWatcherHelper = new ASPxClientSpreadsheet.StateWatcherHelper(this);
            this.stateWatcherHelper.activate();
        }
    },
    sheetInitialize: function() {
        this.initializeHandlers();
        this.initializeShortcuts();
        this.initializeTargetInputController();
        this.initializeSettings();
        this.getPaneManager().createTouchUIScroller();
    },
    initializeHandlers: function() {
        this.getPaneManager().attachEventToMainElement();

        this.getPaneManager().attachEventsToPaneElements();

        if(this.showFormulaBar)
            this.getPaneManager().attachEventsToFormulaBarElements();
       
        this.attachEventsToRibbon();

        this.attachEventsToPopupMenu();

        this.attachEventsToTabControl();
    },

    prepareChildControls: function() {
        this.getPaneManager().prepareScrollDiv();
        this.applyViewModeToRibbon(this.GetViewMode());
    },
    createChildControls: function() {
        this.getRenderHelper().createChildControls();
    },
    
    attachEventsToRibbon: function () {
        var ribbon = this.GetRibbon();
        if (!ribbon) return;

        var ribbonManager = this.getRibbonManager();
        ribbonManager.SubscribeCommandExecuted(function (s, e) { this.onRibbonCommand(e.item.name, e.parameter, e.item); }.aspxBind(this), this);
        ribbonManager.SubscribeMinimizationStateChanged(function (s, e) { this.ribbonMinimizeStateChanged(e.ribbonState); }.aspxBind(this), this);
        ribbonManager.SubscribeDialogBoxLauncherClicked(function (s, e) { this.onRibbonCommand(e.group.name, null, null); }.aspxBind(this), this);
        ribbonManager.SubscribeKeyTipsClosedOnEscape(function (s, e) { this.onRibbonHideKeyTips(); }.aspxBind(this), this.owner);
        this.getInputController().attachRefocusHandlerToRibbon();
    },
    detachEventsFromRibbon: function () {
        var ribbon = this.GetRibbon();
        if (!ribbon) return;

        var ribbonManager = this.getRibbonManager();
        ribbonManager.UnsubscribeCommandExecutedByName(this.name);
        ribbonManager.UnsubscribeMinimizationStateChangedByName(this.name);
        ribbonManager.UnsubscribeDialogBoxLauncherClickedByName(this.name);
        ribbonManager.UnsubscribeKeyTipsClosedOnEscapeByName(this.name);
        this.getInputController().detachRefocusHandlerFromRibbon();

    },
    applyViewModeToRibbon: function(viewMode) {
        this.getRibbonManager().applyViewMode(viewMode);
    },

    // TODO relocate next group of functions to TabControl.js
    attachEventsToTabControl: function () {
        var tabControl = this.getTabControl();
        if(tabControl) {
            tabControl.SubscribeActiveTabChanged(function (s, e) { this.onSheetIndexChanged(e.tab.index); }.aspxBind(this), this); // TODO change index to name when collaboration mode
            tabControl.SubscribeTabClick(this.onTabControlTabClick.aspxBind(this));
            tabControl.SubscribeTabMouseDown(function (s, e) { this.getTouchUIHelper().handleTabEvent(e.htmlEvent); }.aspxBind(this));
            tabControl.SubscribeTabMouseUp(function (s, e) { this.getTouchUIHelper().handleTabEvent(e.htmlEvent); }.aspxBind(this));
            tabControl.SubscribeTabMouseMove(function (s, e) { this.getTouchUIHelper().handleTabEvent(e.htmlEvent); }.aspxBind(this));
        }
    },
    onTabControlTabClick: function(s, e) {
        var stateController = this.getStateController();
        if(!stateController.canChangeSheetToEnterFormula()) {
            var canFinishEditing = this.finishEditingWithEvent();
            if(canFinishEditing) {
                if(ASPx.Evt.IsRightButtonPressed(e.htmlEvent))
                    this.showTabSelectorContextMenu(e.htmlEvent);
                else if(e.htmlEvent.type === "dblclick")
                    this.showRenameSheetDialog();
            }

            e.cancel = !canFinishEditing;
        } else {
            this.getEditingHelper().startFormulaEditing();
        }
    },
    showTabSelectorContextMenu: function(e) {
        var documentModel = this.getDocumentModel(),
            visibleSheetsCount = documentModel.getVisibleSheets().length,
            hiddenSheetsCount = documentModel.getHiddenSheets().length;

        var context = {
            isTabSelectorMenu: true,
            MenuType: ASPxClientSpreadsheetPopupMenuType.SheetTab,
            ownerControl: this,
            canHideSheet: visibleSheetsCount > 1,
            canUnhideSheet: hiddenSheetsCount > 0,
            canRemoveSheet: visibleSheetsCount > 1,
            lockedWorkbook: !!this.isWorkbookLocked(),
            mouseX: ASPx.Evt.GetEventX(e),
            mouseY: ASPx.Evt.GetEventY(e)
        };

        this.getPopupMenuHelper().showPopupMenu(context);
    },
    showRenameSheetDialog: function() {
        var renameSheetCommandId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("RenameSheet").id,
            enabled = ASPxClientSpreadsheet.Commands.CommandHelper.GetCommandEnabled(this, renameSheetCommandId);
        if(enabled)
            this.onUICommand(renameSheetCommandId, {});
    },

    // PopupMenu
    attachEventsToPopupMenu: function() {
        var popupMenu = this.getPopupMenu();
        if(popupMenu)
            this.subscribeToMenuEvents(popupMenu);
        popupMenu = this.getAutoFilterPopupMenu();
        if(popupMenu)
            this.subscribeToMenuEvents(popupMenu);
    },
    subscribeToMenuEvents: function(popupMenu) {
        popupMenu.ItemClick.AddHandler(function(s, e) { this.onPopupMenuClick(s, e.item); }.aspxBind(this), this);
        popupMenu.CloseUp.AddHandler(function(s, e) { this.onPopupMenuCloseUp(s, e.item); }.aspxBind(this), this);
    },
    onPopupMenuClick: function(popupMenu, item) {
        popupMenu = popupMenu || this.getPopupMenu();
        var commandId = item.name,
            isDropDownItem = item.items && item.items.length > 0,
            params = popupMenu.getExtendedValue();
        if(!isDropDownItem) {
            var stateController = this.getStateController();
            if(stateController.canFinalizeEditing()) {
                if(params)
                    params = { fi: params };
                this.onMenuCommand(commandId, params);
            }
            popupMenu.clearClientCache();
        }
    },
    onPopupMenuCloseUp: function(popupMenu, item) {
        popupMenu = popupMenu || this.getPopupMenu();
        var inputController = this.getInputController(),
            isDropDownItem = item.items && item.items.length > 0 && !!item.parent;
        if(inputController)
            inputController.captureFocus();
        if(!isDropDownItem)
            popupMenu.clearClientCache();
    },

    detachEventsFromPopupMenu: function() {
        var popupMenu = this.getPopupMenu();
        if(popupMenu)
            this.unsubscribeFromMenuEvents(popupMenu);
        popupMenu = this.getAutoFilterPopupMenu();
        if(popupMenu)
            this.unsubscribeFromMenuEvents(popupMenu);
    },
    unsubscribeFromMenuEvents: function(popupMenu) {
        popupMenu.ItemClick.removeHandlerByControlName(this.name);
        popupMenu.CloseUp.removeHandlerByControlName(this.name);
    },


    initializeTargetInputController: function() {
        this.ensureKeyboardManager();
        this.ensureInputController();
    },
    ensureInputController: function() {
        this.getInputController();
    },
    initializeShortcuts: function() {
        var keyboardManager = this.getKeyboardManager();
        keyboardManager.InitializeShortcuts(ASPx.SpreadsheetKeyboardManager.Shortcuts);
    },
    initializeSettings: function() {
        this.getDocumentSettings();
    },

    genarateClientInstanceGuid: function() {
        this.clientInstanceGuid = ASPx.CreateGuid();
    },
    getClientInstanceGuid: function() {
        return this.clientInstanceGuid;
    },

    generateNewClipboardBufferId: function() {
        this.currentClipboardBufferId = ASPx.CreateGuid();
    },
    getCurrentClipboardBufferId: function(generateNewOne) {
        if(generateNewOne)
            this.generateNewClipboardBufferId();
        return this.currentClipboardBufferId;
    },

    /*# public void Focus() { } #*/
    Focus: function() {
        this.setFocus();
    },
    setFocus: function() {
        var inputController = this.getInputController();
        if(inputController) {
            inputController.captureFocus();
            this.activateControl();
        }
    },

    // Helpers
    getPaneManager: function() {
        if(!this.paneManager)
            this.paneManager = new ASPxClientSpreadsheet.PaneManager(this);
        return this.paneManager;
    },
    getRenderHelper: function() {
        if(!this.renderHelper)
            this.renderHelper = this.createRenderHelper();
        return this.renderHelper;
    },
    createRenderHelper: function() {
        return new ASPxClientSpreadsheet.RenderHelper(this);
    },
    getValidationHelper: function() {
        if(!this.validationHelper)
            this.validationHelper = new ASPxClientSpreadsheet.ValidationHelper(this);
        return this.validationHelper;
    },
    getGridResizingHelper: function() {
        if(!this.gridResizingHelper)
            this.gridResizingHelper = new ASPxClientSpreadsheet.GridResizingHelper(this);
        return this.gridResizingHelper;
    },
    getKeyboardManager: function(){
        if(!this.keyboardManager)
            this.keyboardManager = new ASPx.SpreadsheetKeyboardManager();
        return this.keyboardManager;
    },
    getInputController: function() {
        if(!this.inputController)
            this.inputController = new ASPxClientSpreadsheet.InputController(this, this.getRenderHelper().getInputTargetElement());
        return this.inputController;
    },
    getClipboardHelper: function() {
        if(!this.clipboardHelper)
            this.clipboardHelper = new ASPxClientSpreadsheet.ClipboardHelper(this);
        return this.clipboardHelper;
    },
    getRibbonManager: function() {
        if (!this.ribbonManager)
            this.ribbonManager= new ASPxClientSpreadsheet.RibbonManager(this);
        return this.ribbonManager;
    },
    getStateController: function() {
        if(!this.stateController)
            this.stateController = new ASPxClientSpreadsheet.StateController(this);
        return this.stateController;
    },
    getSelectionHelper: function() {
        if(!this.selectionHelper)
            this.selectionHelper = new ASPxClientSpreadsheet.SelectionHelper(this);
        return this.selectionHelper;
    },
    getDynamicSelectionHelper: function() {
        if(!this.dynamicSelectionHelper)
            this.dynamicSelectionHelper = new ASPxClientSpreadsheet.DynamicSelectionHelper(this);
        return this.dynamicSelectionHelper;
    },
    getTouchUIHelper: function() {
        if(!this.touchUIHelper)
            this.touchUIHelper = new ASPxClientSpreadsheet.TouchUIHelper(this);
        return this.touchUIHelper;
    },
    getTouchEditingHelper: function() {
        if(!this.touchEditingHelper)
            this.touchEditingHelper = new ASPxClientSpreadsheet.TouchEditingHelper(this);
        return this.touchEditingHelper;
    },
    getEditingHelper: function() {
        if(!this.editingHelper)
            this.editingHelper = new ASPxClientSpreadsheet.EditingHelper(this);
        return this.editingHelper;
    },
    getPopupMenuHelper: function() {
        if (!this.popupMenuHelper) {
            this.popupMenuHelper = this.createPopupMenuHelper();
            this.popupMenuHelper.initializeItems();
        }
        return this.popupMenuHelper;
    },
    getDialogManager: function() {
        if(!this.dialogManager)
            this.dialogManager = new ASPxClientSpreadsheet.DialogManager();
        return this.dialogManager;
    },
    createPopupMenuHelper: function() {
        return new ASPxClientSpreadsheet.PopupMenuHelper(this);
    },
    getFormulaIntelliSenseManager: function() {
        if(!this.formulaIntelliSenseManager)
            this.formulaIntelliSenseManager = new ASPxClientSpreadsheet.FormulaIntelliSenseManager(this);
        return this.formulaIntelliSenseManager;
    },
    getCommandManager: function() {
        if(!this.commandManager)
            this.commandManager = new ASPxClientSpreadsheet.CommandManager(this);
        return this.commandManager;
    },
    getDocumentModel: function() {
        if(!this.documentModel)
            this.documentModel = new ASPxClientSpreadsheet.DocumentModel();
        return this.documentModel;
    },
    getDocumentSettings: function() {
        if(!this.documentSettings)
            this.documentSettings = new ASPxClientSpreadsheet.Settings(this);
        return this.documentSettings;
    },
    getUpdateWatcherHelper: function() {
        return this.updateWatcherHelper;
    },

    // Control Updates
    beginUpdate: function() { },
    endUpdate: function() { },


    updateIntelliSenseElementsPosition: function() {
        var isFormulaBarEditing = this.isFormulaBarEditMode();
        var requiredElementNearIntelliSenseElements = isFormulaBarEditing ?
            this.getRenderHelper().getFormulaBarTextWrapperElement() : this.getEditingHelper().getInplaceEditor();
        this.getFormulaIntelliSenseManager().updateIntelliSenseElementsPosition(requiredElementNearIntelliSenseElements);
    },
    hideIntelliSenseElements: function() {
        this.getFormulaIntelliSenseManager().hideIntelliSenseElements();
    },
    attachTooltipsToEditor: function(inputController) {
        this.getFormulaIntelliSenseManager().attachToEditorElement(inputController);
    },
    isFunctionsListBoxDisplayed: function() {
        return this.getFormulaIntelliSenseManager().isFunctionsListBoxDisplayed();
    },
    displayCurrentFunctionArgumentsHint: function() {
        this.getFormulaIntelliSenseManager().displayCurrentFunctionArgumentsHint();
    },
    ensureKeyboardManager: function() {
        this.getKeyboardManager();
    },
    getCellTextViewElement: function() {
        if(!this.cellTextViewElement && this.showFormulaBar)
            this.cellTextViewElement = this.getEditingHelper().createCellTextViewElement();
        return this.cellTextViewElement;
    },
    isFormulaBarEditMode: function() {
        return this.getStateController().getEditMode() === ASPxClientSpreadsheet.StateController.Modes.FormulaBarEdit;
    },

    // TODO move to paneHelper
    getActiveCellModelPosition: function() {
        return this.getStateController().getActiveCellModelPosition();
    },

    /*# public ASPxClientRibbon GetRibbon() { return null; } #*/
    GetRibbon: function() {
        var ribbonID = this.ribbonClientID || this.getRenderHelper().getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.ribbonControl,
            ribbonControl = ASPx.GetControlCollection().Get(ribbonID);
        return ribbonControl && ASPx.IsValidElement(ribbonControl.GetMainElement()) ? ribbonControl : null;
    },
    getPopupMenu: function() {
        return ASPx.GetControlCollection().Get(this.getRenderHelper().getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.popupMenu);
    },
    getAutoFilterPopupMenu: function() {
        return ASPx.GetControlCollection().Get(this.getRenderHelper().getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.autoFilterPopupMenu);
    },
    // IDialog interface
    GetDialogPopupControl: function() {
        return ASPx.GetControlCollection().Get(this.getRenderHelper().getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.dialogPopupControl);
    },
    getTabControl: function() {
        var tabControlId = this.getRenderHelper().getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.tabControl,
            tabControl = ASPx.GetControlCollection().Get(tabControlId);
        return tabControl && ASPx.IsValidElement(tabControl.GetMainElement()) ? tabControl : null;
    },
    getFunctionsListBox: function() {
        return ASPx.GetControlCollection().Get(this.getRenderHelper().getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.functionsListBox);
    },
    getFormulaBarMenu: function() {
        return ASPx.GetControlCollection().Get(this.getRenderHelper().getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.formulaBarMenu);
    },
    getAutoFilterImagesClassName: function(imageName) {
        if(this.autoFilterImagesClassNames)
            return this.autoFilterImagesClassNames[imageName];
        return "";
    },
    needUseSvgImages: function() {
        return this.needUseSvg;
    },

    // Model params
    getVisibleRangePaddings: function () {
        return this.visibleRangePadding;
    },
    getTileSize: function() {
        return this.tileSize;
    },
    getDefaultCellSize: function() {
        return this.defaultCellSize;
    },
    getLastFilledCell: function() { 
        return this.lastFilledCell; 
    },
    
    CanEditDocument: function() {
        return !this.isReadOnly() && !this.getStateController().isNonModalDialogOpen();
    },
    isActiveCellLocked: function() {
        var cellLayoutInfo = this.getSelectionActiveCellLayoutInfoInternal();
        return this.isSheetLocked() && ASPxClientSpreadsheet.ProtectionHelper.isCellLocked(this, cellLayoutInfo.colModelIndex, cellLayoutInfo.rowModelIndex);
    },
    cellLocked_ByLayoutInfo: function(cellLayoutInfo, supressMessageBox) {
        var isCellLocked = this.isSheetLocked() && ASPxClientSpreadsheet.ProtectionHelper.isCellLocked(this, cellLayoutInfo.colModelIndex, cellLayoutInfo.rowModelIndex);
        if(isCellLocked) {
            if(!supressMessageBox)
                this.showProtectedSheetWarningMessage();
        } else {
            var pivotTableCollection = this.getDocumentModel().getPivotTables(),
                isPivotTableValueCell = pivotTableCollection.length > 0 &&  pivotTableCollection.isCellInPivotTableValueRange(new ASPxClientSpreadsheet.Range(cellLayoutInfo.colModelIndex, cellLayoutInfo.rowModelIndex));
            isCellLocked = isPivotTableValueCell;
            if(isPivotTableValueCell && !supressMessageBox)
                this.showPivotTableEditingWarningMessage();
        }
       
        return isCellLocked;
    },
    ribbonUpdateLocked: function() {
        var ribbonManager = this.getRibbonManager();

        ribbonManager.methodsQueue = [];
        this.lockRibbonUpdate = true;
    },
    ribbonUpdateRelease: function(){
        this.lockRibbonUpdate = false;

        var ribbonManager = this.getRibbonManager(),
            len = ribbonManager.methodsQueue ? ribbonManager.methodsQueue.length : 0;
                
        while(len--)
            this.ribbonStateUpdate(ribbonManager.methodsQueue[len]);

        ribbonManager.methodsQueue = [];
    },
    isRibbonUpdateLocked: function(){
        return this.lockRibbonUpdate;
    },
    addRibbonMethodsToQueue: function(methodName) {
        var ribbonManager = this.getRibbonManager();

        if(!ribbonManager.methodsQueue)
            ribbonManager.methodsQueue = [];

        if(!ASPx.Data.ArrayContains(ribbonManager.methodsQueue, methodName))
            ribbonManager.methodsQueue.unshift(methodName);
    },
    updateRestrictiveProperties: function(response) {
        this.ribbonUpdateLocked();

        this.setSheetLocked(response.pp);
        this.setWorkBookLocked(response.workbookLocked);
        this.setReadOnlyCore(response.readOnly || this.GetViewMode() === ASPxClientSpreadsheetViewMode.Reading);

        this.ribbonUpdateRelease();
    },
    setSheetLocked: function(protectionProperties) {
        var locked = !!(protectionProperties && protectionProperties.locked);

        if(this.sheetLocked !== locked) {
            this.sheetLocked = locked;
            this.onSheetLockedChanged();
        }
    },
    isSheetLocked: function() {
        return this.sheetLocked;
    },
    setWorkBookLocked: function(locked) {
        var workbookLocked = !!locked;

        if(this.workbookLocked !== workbookLocked) {
            this.workbookLocked = workbookLocked;
            this.onWorkbookLockedChanged();
        }
    },
    isWorkbookLocked: function() {
        return this.workbookLocked;
    },
    setReadOnlyCore: function(readOnly) {
        readOnly = !!readOnly;

        if(this.readOnly !== readOnly) {
            this.readOnly = readOnly;
            this.switchReadOnlyMode();
        }
    },
    isReadOnly: function() {
        return this.readOnly;
    },

    // Full Screen    
    isInFullScreen: function() {
        return this.isInFullScreenMode;
    },
    setFullScreenModeFlag: function(isInFullScreen) {
        this.isInFullScreenMode = isInFullScreen;
    },
    /*# public void SetFullscreenMode(bool fullscreen) { } #*/
    SetFullscreenMode: function(fullscreen) {
        if(this.isInFullScreen() === fullscreen)
            return;
        this.onUICommand(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FullScreen").id);
    },
    setFullScreenModeInternal: function() {
        this.setFullScreenModeFlag(!this.isInFullScreen());
        this.dsiplayControlDependingOnMode();
    },
    dsiplayControlDependingOnMode: function() {
        if(this.isInFullScreen())
            this.displayControlInFullScreenMode();
        else
            this.displayControlInPageMode();
    },
    displayControlInFullScreenMode: function () {
        this.changeNativeFullscreen(true);

        this.saveControlPosition();
        this.adjustControlInFullScreenMode();

        if(this.getRenderHelper().isLoadTilesRequired(this.fullScreenTempVars.scrollContainerLeftPosition, this.fullScreenTempVars.scrollContainerTopPosition))
            if(this.isSheetLoaded()) //T313945
                this.getPaneManager().loadTilesForNewVisibleRange(this.fullScreenTempVars.cachedScrollAnchor);
    },

    getFullscreenNativeChangedHandler: function() {
        if(!this.fullscreenNativeChangedHandler) {
            this.fullscreenNativeChangedHandler = function() {
                if(!ASPx.FullScreenUtils.inFullscreen()) {
                    this.unsubscribeFullscreenNativeChanged();

                    if(this.isInFullScreen()) {
                        try {
                            this.setFullScreenModeInternal();
                        } finally {
                        }
                    }
                }
            }.aspxBind(this);
        }
        return this.fullscreenNativeChangedHandler;
    },
    subscribeFullscreenNativeChanged: function() {
        ASPx.FullScreenUtils.subscribeChange(this.getFullscreenNativeChangedHandler());
    },
    unsubscribeFullscreenNativeChanged: function() {
        ASPx.FullScreenUtils.subscribeChange(this.getFullscreenNativeChangedHandler());
    },
    changeNativeFullscreen: function(setModeOn) {
        if(window.self === window.top) return;
        if(setModeOn === ASPx.FullScreenUtils.inFullscreen()) return;

        if(setModeOn)
            this.subscribeFullscreenNativeChanged();
        else
            this.unsubscribeFullscreenNativeChanged();

        ASPx.FullScreenUtils.setFullscreen(setModeOn);
    },
    onViewAreaChanged: function() {
        if(this.isSheetLoaded()) {
            var paneManager = this.getPaneManager();
            if(paneManager.isTileVisibleRangeChanged()) {
                if(paneManager.canLoadTilesFromCache())
                    paneManager.tryLoadTilesFromCache();
                else
                    paneManager.getScrollHelper().loadScrolledTiles();
            }
        }
    },
    saveControlPosition: function() {
        var mainElement = this.GetMainElement();
        var correctHeight = 0;
        if(this.isRibbonExternal()) {
            var ribbonManager = this.getRibbonManager();
            ribbonManager.setExternalRibbonPositionOnPageTop(this);
            correctHeight = ribbonManager.saveRibbonHeight;
        }

        this.fullScreenTempVars.savedBodyScrollTop = ASPx.GetDocumentScrollTop();
        this.fullScreenTempVars.savedBodyScrollLeft = ASPx.GetDocumentScrollLeft();

        ASPx.Attr.ChangeStyleAttribute(mainElement, "top", correctHeight + "px");
            
        ASPxClientUtils.AddClassNameToElement(mainElement, "dxss-fullscreen");

        this.hideBodyScroll();
            
        this.fullScreenTempVars.savedBodyMargin = document.body.style.margin;
        document.body.style.margin = 0;

        if(ASPx.IsPercentageSize(mainElement.style.width)) {
            this.fullScreenTempVars.savedCurrentWidth = mainElement.style.width;
        } else {
            this.fullScreenTempVars.savedCurrentWidth = this.GetWidth();
        }
        if(ASPx.IsPercentageSize(mainElement.style.height)) {
            this.fullScreenTempVars.savedCurrentHeight = mainElement.style.height;
        } else {
            this.fullScreenTempVars.savedCurrentHeight = this.GetHeight();
        }
        this.fullScreenTempVars.cachedScrollAnchor = this.getPaneManager().getScrollAnchorVisiblePosition();
        this.fullScreenTempVars.scrollContainerLeftPosition = this.getRenderHelper().getScrollContainer().scrollLeft;
        this.fullScreenTempVars.scrollContainerTopPosition = this.getRenderHelper().getScrollContainer().scrollTop;
    },    
    displayControlInPageMode: function () {
        this.changeNativeFullscreen(false);

        if(this.isRibbonExternal()) {
            var ribbonManager = this.getRibbonManager();
            ribbonManager.restoreExternalRibbonPositionOnPage(this);
        }
        var mainElement = this.GetMainElement();
        ASPx.Attr.RestoreStyleAttribute(mainElement, "top");
        this.restoreBodyScroll();

        ASPxClientUtils.RemoveClassNameFromElement(mainElement, "dxss-fullscreen");

        document.body.style.margin = this.fullScreenTempVars.savedBodyMargin;
            
        this.setHeightInternal(this.fullScreenTempVars.savedCurrentHeight, true);
        this.setWidthInternal(this.fullScreenTempVars.savedCurrentWidth, false);
            
        document.documentElement.scrollTop = this.fullScreenTempVars.savedBodyScrollTop;
        document.documentElement.scrollLeft = this.fullScreenTempVars.savedBodyScrollTop;
        this.adjustRootControls();
    },    
    hideBodyScroll: function() {
        ASPx.Attr.ChangeStyleAttribute(document.documentElement, "position", "static");
        ASPx.Attr.ChangeStyleAttribute(document.documentElement, "overflow", "hidden");
    },
    restoreBodyScroll: function() {
        if (!ASPx.Dialog.GetLastDialog(this)) {
            ASPx.Attr.RestoreStyleAttribute(document.documentElement, "overflow");
            ASPx.Attr.RestoreStyleAttribute(document.documentElement, "position");
        }
    },

    // View Mode
    performChangeViewModeCallback: function(mode) {
        if(this.GetViewMode() !== mode)
            this.sendInternalServiceCallback(ASPxClientSpreadsheet.CallbackPrefixes.ChangeViewModeCallbackPrefix, mode);
        else
            this.applyViewModeToRibbon(this.GetViewMode());
    },

    readingView: function() {
        this.performChangeViewModeCallback(ASPxClientSpreadsheetViewMode.Reading);
    },

    editingView: function() {
        this.performChangeViewModeCallback(ASPxClientSpreadsheetViewMode.Editing);
    },

    /*# public ASPxClientSpreadsheetViewMode GetViewMode(){ return ASPxClientSpreadsheetViewMode.Editing; } #*/
    GetViewMode: function() {
        return this.viewMode;
    },

    /*# public void SetViewMode(ASPxClientSpreadsheetViewMode mode){ } #*/
    SetViewMode: function(mode) {
        this.performChangeViewModeCallback(mode);
    },

    RaiseViewModeChanged: function(oldViewMode) {
        if(!this.ViewModeChanged.IsEmpty()) {
            var args = new ASPxClientSpreadsheetViewModeChangedEventArgs(oldViewMode);
            this.ViewModeChanged.FireEvent(this, args);
        }
    },

    ribbonMinimizeStateChanged: function(ribbonState) {
        //TODO move adjustRootControls to RenderProvider or PaneManager
        this.adjustRootControls(false);
        this.getPaneManager().changeScrollableArea(ribbonState);
    },
           
    // State
    UpdateStateObject: function() {
        var stateObject = { state: this.getCallbackArgsSerialized(), commands: this.getActualizationData() };
        stateObject[ASPx.SpreadsheetSessionGuidStateKey] = this.getSessionGuid();
        stateObject[ASPxClientSpreadsheet.StateKeys.ViewMode] = this.GetViewMode();
        this.UpdateStateObjectWithObject(stateObject);
    },
    getActualizationData: function() {
        if(this.synchronizeUnsavedChangesOnDialogCallback()) {
            var commandManager = this.getCommandManager();
            if(commandManager.thereAreUnsavedChanges())
                return commandManager.getNotActulizedData(true);
        }
        return "";
    },

    // Sessions
    sessionIsOpened: function() {
        return !!this.getSessionGuid();
    },
    getSessionGuid: function() {
        return this.sessionGuid;
    },
    setSessionGuid: function(sessionGuid) {
        this.sessionGuid = sessionGuid;
    },   
    
    // Callback
    clearOwnerControlCallback: function() {
        this.callbackOwner = null;
    },
    CreateNewDocumentCallback: function() {
        this.sendInternalServiceCallback(ASPxClientSpreadsheet.CallbackPrefixes.NewFileCallbackPrefix, "new");
    },
    SaveDocumentCallback: function() {
        this.sendInternalServiceCallback(ASPxClientSpreadsheet.CallbackPrefixes.SaveFileCallbackPrefix);
    },
    sendInternalServiceCallback: function(callbackCommandPrefix, callbackArgument, callbackOwnerControl, hideLoadingPanel) {
        this.hideLoadingPanel = hideLoadingPanel;
        if (callbackOwnerControl)
            this.callbackOwner = callbackOwnerControl;
        this.CreateCallback(this.FormatCallbackArg(callbackCommandPrefix, this.markCallbackAsInternalService(callbackArgument)));
    },
    FormatCallbackArg: function(prefix, arg) {
        if(prefix == null && arg == null)
            return "";
        if(prefix == null) prefix = "";
        if(arg == null) arg = "";

        if(arg != null && !ASPx.IsExists(arg.length) && ASPx.IsExists(arg.value))
            arg = arg.value;
        arg = arg.toString();
        return [prefix, '|', arg.length, ';', arg, ';'].join('');
    },
    isInternalServiceCallback: function(callbackArg) {
        return callbackArg.indexOf(ASPxClientSpreadsheet.CallbackPrefixes.InternalCallBackPostfix) > -1;
    },
    sendInternalServicePostback: function(eventArgs) {
        this.SendPostBack(eventArgs);
    },
    OnCallback: function(result) {
        if(this.callbackOwner != null)
            this.callbackOwner.OnCallback(result);
        else if(this.isDocumentLoadingCallback(result))
            this.onDocumentLoadingCallback(result);
        else if(this.isNewDocumentCallback(result))
            this.onNewDocumentCallback(result);
        else if(this.isInsertImageCallback(result))
            this.onInsertImageCallback(result);
        else if(this.isSaveDocumentCallback(result))
            this.onSaveDocumentCallback(result);
        else if(this.isChangeViewModeCallback(result))
            this.onChangeViewModeCallback(result);
    },
    isDocumentLoadingCallback: function(result) {
        return result && result.indexOf(ASPxClientSpreadsheet.CallbackPrefixes.DocumentUpdateCallbackPrefix) == 0;
    },
    /*getDocumentLoadingCallbackResult: function(result) {
        return result.slice(ASPxClientSpreadsheet.CallbackPrefixes.DocumentUpdateCallbackPrefix.length);
    },*/
    isNewDocumentCallback: function(callbackData) {
        return callbackData && this.isString(callbackData) && callbackData.indexOf(ASPxClientSpreadsheet.CallbackPrefixes.NewFileCallbackPrefix) === 0;
    },
    isOpenFileCallback: function(callbackData) {
        return callbackData && this.isString(callbackData) && callbackData.indexOf(ASPxClientSpreadsheet.CallbackPrefixes.OpenFileCallbackPrefix) === 0;
    },
    isInsertImageCallback: function(result) {
        return result && result.indexOf(ASPxClientSpreadsheet.CallbackPrefixes.SaveImageCallbackPrefix) === 0;
    },
    isSaveDocumentCallback: function(result) {
        return result && result.indexOf(ASPxClientSpreadsheet.CallbackPrefixes.SaveFileCallbackPrefix) === 0;
    },
    isChangeViewModeCallback: function(result) {
        return result && result.indexOf(ASPxClientSpreadsheet.CallbackPrefixes.ChangeViewModeCallbackPrefix) === 0;
    },
    getNewDocumentCallbackResult: function(result) {
        return result.slice(ASPxClientSpreadsheet.CallbackPrefixes.NewFileCallbackPrefix.length + 1);
    },
    getSaveDocumentCallbackResult: function(result) {
        return result.slice(ASPxClientSpreadsheet.CallbackPrefixes.SaveFileCallbackPrefix.length + 1);
    },
    onDocumentLoadingCallback: function(result) {
        var documentLoadCallbaclResult = result.slice(ASPxClientSpreadsheet.CallbackPrefixes.DocumentUpdateCallbackPrefix.length + 1);
        this.onResponseReceivedCore(documentLoadCallbaclResult);
    },
    onNewDocumentCallback: function(result) {
        var newDocumentCallbackResult = this.getNewDocumentCallbackResult(result);
        this.onResponseReceivedCore(newDocumentCallbackResult);
    },
    onSaveDocumentCallback: function(result) {
        var saveDocumentCallbackResult = this.getSaveDocumentCallbackResult(result);
        this.onResponseReceivedCore(saveDocumentCallbackResult);
        this.onAfterDocumentSaved(saveDocumentCallbackResult);
    },
    onInsertImageCallback: function(result) {
        var callbackResult = result.slice(ASPxClientSpreadsheet.CallbackPrefixes.SaveImageCallbackPrefix .length + 1);
        if(callbackResult.indexOf(ASPxClientSpreadsheet.CallbackPrefixes.SaveImageErrorCallbackPrefix) > -1)
            alert(callbackResult.substr(ASPxClientSpreadsheet.CallbackPrefixes.SaveImageErrorCallbackPrefix.length + 1));
        else {
            var callbackData = callbackResult.substr(ASPxClientSpreadsheet.CallbackPrefixes.SaveImageSuccessCallbackPrefix.length + 1);
            this.onResponseReceivedCore(callbackData);
        }
    },

    onAfterDocumentSaved: function(result) {
    },
    onChangeViewModeCallback: function(result) {
        var callbackResult = result.slice(ASPxClientSpreadsheet.CallbackPrefixes.ChangeViewModeCallbackPrefix.length + 1);
        if(callbackResult) {
            this.prepareForRenderUpdate();
            this.getRenderHelper().replaceControlContent(callbackResult);
        }
    },
    prepareForRenderUpdate: function() {
        this.getInputController().cancelFocusing();
        this.saveCurrentViewModeSettings();
        this.detachEventsFromRibbon();
        this.detachEventsFromPopupMenu();
        this.HideLoadingElements();
    },
    saveCurrentViewModeSettings: function() {
        ASPxClientSpreadsheet.CurrentViewModeSettings.Mode = this.GetViewMode();
        ASPxClientSpreadsheet.CurrentViewModeSettings.ModeChangedOnCallback = true;
    },
    markCallbackAsInternalService: function(arg) {
        return [arg, "|", ASPxClientSpreadsheet.CallbackPrefixes.InternalCallBackPostfix].join("");
    },   
    DoEndCallback: function() {
        ASPxClientControl.prototype.DoEndCallback.call(this);

        if(ASPxClientSpreadsheet.CurrentViewModeSettings.ModeChangedOnCallback)
            this.afterViewModeChangeResultReceived();

        if (this.callbackOwner != null && !this.isErrorOnCallback)
            this.callbackOwner.OnEndCallback();
        this.isErrorOnCallback = false;
    },
    afterViewModeChangeResultReceived: function() {
        this.dsiplayControlDependingOnMode();
        this.RaiseViewModeChanged(ASPxClientSpreadsheet.CurrentViewModeSettings.Mode);
        ASPxClientSpreadsheet.CurrentViewModeSettings.ModeChangedOnCallback = false;
    },
    isString: function(arg) {
        return typeof arg === "string" || arg instanceof String;
    },

    // Dialogs support
    isSingleCellOrEmptyRangeSelected: function() {
        var stateController = this.getStateController();
        var selection = stateController.getSelection();
        if (selection.range.singleCell)
            return true;

        for (var i = selection.range.leftColIndex; i <= selection.range.rightColIndex; i++)
            for (var k = selection.range.topRowIndex; k <= selection.range.bottomRowIndex; k++) {
                var rawValue = this.getCellValueByVisiblePosition_Internal(i, k);
                if (rawValue != null) {
                    if (ASPx.IsNumber(rawValue))
                        return false;
                }
            }

        return true;
    },
    notifyDialogOpening: function(allowToSynchronizeUnsavedChanges) {
        this.synchrinizeUnsavedChangesBeforeDialogCallback = allowToSynchronizeUnsavedChanges;
    },
    notifyDialogClosing: function() {
        this.synchrinizeUnsavedChangesBeforeDialogCallback = true;
    },
    synchronizeUnsavedChangesOnDialogCallback: function() {
        return this.synchrinizeUnsavedChangesBeforeDialogCallback;
    },
    isConfirmDialogShown: function() {
        return !this.synchrinizeUnsavedChangesBeforeDialogCallback;
    },
    notifyDialogResponseReceived: function(response) {
        var currentDialog = this.getCurrentDialog();
        if(currentDialog)
            currentDialog.notifyResponseReceived(response);
    },
    notifyDialogActiveCellSelectionChanged: function(selection) {
        var currentDialog = this.getCurrentDialog();
        if(currentDialog)
            currentDialog.onActiveCellChanged(selection);
    },
    showDialog: function(commandId) {
        var currentDialog = this.getCurrentDialog();
        if(commandId && !currentDialog) {
            this.onRibbonCommand(commandId);
            return true;
        }
        return false;
    },
    hideDialog: function() {
        var currentDialog = this.getCurrentDialog();
        if(currentDialog)
            currentDialog.HideDialog();
    },
    getCurrentDialog: function() {
        return ASPx.Dialog.GetCurrentDialog(this.name);
    },
    updateDialogState: function() {
        this.getStateWatcherHelper().onDialogClose();
    },

    getCellElementStyleByModelPosition: function(colModelIndex, rowModelIndex, attributesList) {
        var fullStyle = this.getCellFullStyle(colModelIndex, rowModelIndex);
        return this.getStyleSetByAttributes(fullStyle, attributesList);
    },
    getCellFullStyle: function(colModelIndex, rowModelIndex) {
        var cellElement = this.getRenderHelper().getCellElementByModelPosition(colModelIndex, rowModelIndex),
            style = {};
        if(cellElement) {
            var cellTextElement = this.getRenderHelper().getCellTextElementByModelPosition(colModelIndex, rowModelIndex),
                cellTextElementStyle = ASPx.GetCurrentStyle(cellTextElement),
                attributes = [];

            for(var attr in cellTextElementStyle)
                if(attr in cellTextElementStyle)
                    attributes.push(attr);
            style = this.getStyleSetByAttributes(cellTextElementStyle, attributes);

            var fillContainerElement = ASPx.GetNodeByClassName(cellElement, ASPx.SpreadsheetCssClasses.FillContainerElement),
                cellElementStyle = fillContainerElement ? ASPx.GetCurrentStyle(fillContainerElement) : ASPx.GetCurrentStyle(cellElement);

            if(cellElementStyle) {
                style.backgroundColor = ASPx.Color.ColorToHexadecimal(cellElementStyle.backgroundColor) || this.getDefaultCellStyle().backgroundColor;
                style.width = cellElementStyle.width;
                style.height = cellElementStyle.height;
            }

            var textBoxWrapperContainer = ASPx.GetNodeByClassName(cellElement, ASPx.SpreadsheetCssClasses.MultylineTextContainer);
            if(textBoxWrapperContainer)
                style.verticalAlign = textBoxWrapperContainer.style.verticalAlign;
        } else {
            style = this.getDefaultCellStyle();
            var cellLayoutInfo = this.getPaneManager().getCellLayoutInfo(colModelIndex, rowModelIndex);
            if(cellLayoutInfo && cellLayoutInfo.rect) {
                style.width = cellLayoutInfo.rect.width + "px";
                style.height = cellLayoutInfo.rect.height + "px";
            }
        }
        return style;
    },
    getStyleSetByAttributes: function(sourceStyle, attributes) {
        var style = {};
        for(var i = 0, len = attributes.length; i < len; i++) {
            var attr = attributes[i];
            style[attr] = sourceStyle[attr] || "";
        }
        return style;
    },
    getDefaultCellStyle: function() {
        return {
            fontFamily: "Calibri",
            fontSize: "15px",
            backgroundColor: "#FFFFFF",
            width: "64px",
            height: "20px",
            whiteSpace: "nowrap",
            verticalAlign: "bottom"
        };
    },

    onRibbonHideKeyTips: function() {
        this.getInputController().continueEditing();
    },
    // Send data to server
    onRibbonCommand: function(commandId, params, item) {
        var processed = this.onUICommand(commandId, params);
        var customCommand = !processed;
        if(customCommand)
            this.onRibbonCustomCommand(commandId, params, item);
        if(!ASPxClientSpreadsheet.ServerCommands.isChangeViewModeCommand(commandId))
            this.getInputController().continueEditing();
    },
    onMenuCommand: function(commandId, params) {
        this.onRibbonCommand(commandId, params);
    },
    onAutoFilterClick: function(element, columnType, hasFilter) {
        if(!ASPxClientSpreadsheet.ProtectionHelper.isAutoFilterAvailable(this))
            return;

        var colModelIndex = parseInt(element.getAttribute("c")),
            rowModelIndex = parseInt(element.getAttribute("r")),
            columnCaption = this.GetCellValue(colModelIndex, rowModelIndex);

        var columnTypeMask = {
            text: 1,
            number: 2,
            date: 4
        };

        //TODO: set checked state based on applied filter command id
        var context = {
            isFilterMenu: true,
            MenuType: ASPxClientSpreadsheetPopupMenuType.AutoFilter,
            isFilterApplied: !!hasFilter,
            ownerControl: this,
            isTextColumn:   !!(columnType & columnTypeMask.text),
            isNumberColumn: !!(columnType & columnTypeMask.number),
            isDateColumn:   !!(columnType & columnTypeMask.date),
            columnCaption: columnCaption
        };

        this.getPopupMenuHelper().showAutoFilterMenu(context, element);
    },
    onPivotTableAutoFilterClick: function(element, fieldIndex, filterButtonType) {
        if(!ASPxClientSpreadsheet.ProtectionHelper.isPivotTableAndPivotChartsEditingAvailable(this))
            return;

        this.getPopupMenuHelper().clearMultiFieldProperties();
        var FilterButtonType = {
            None: 0,
            LabelFilter: 1,
            PageFilter: 2,
            RowFilter: 4
        };
        if((filterButtonType & FilterButtonType.PageFilter) === FilterButtonType.PageFilter) {
            this.onUICommand(ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTablePageFieldsFilterItems.id, { fi: fieldIndex });
        } else {
            var context = {
                MenuType: ASPxClientSpreadsheetPopupMenuType.PivotTableAutoFilter
            };
            context.menuContext = {
                isPivotTableFilterMenu: true,
                isRowFilter: !!(filterButtonType & FilterButtonType.RowFilter),
                isColumnFilter: !(filterButtonType & FilterButtonType.RowFilter),
                isSingleColumnFilter: fieldIndex >= 0
            };
            
            if(!context.menuContext.isSingleColumnFilter) {
                this.getPopupMenuHelper().saveMultiFieldProperties(element, filterButtonType);
            }

            var activePivotTable = this.getActivePivotTable();
            fieldIndex = fieldIndex >= 0 ? fieldIndex : (context.menuContext.isRowFilter ? activePivotTable.getActiveFieldRowIndex() : activePivotTable.getActiveFieldColumnIndex());
            var targetField = activePivotTable.getField(fieldIndex, !context.menuContext.isRowFilter);
            if(targetField) {
                fieldType = targetField.Type;
                context.fieldIndex = fieldIndex;
                context.menuContext.isTextFilter = !!(fieldType & ASPxClientSpreadsheet.DocumentModel.ColumnType.Text) || !!(fieldType & ASPxClientSpreadsheet.DocumentModel.ColumnType.Number);
                context.menuContext.isDateFilter = !!(fieldType & ASPxClientSpreadsheet.DocumentModel.ColumnType.Date);
                context.sortType = targetField.SortType;
                context.isFilterApplied = targetField.FilterType !== ASPxClientSpreadsheet.DocumentModel.PivotField.FilterState.None;
                context.IsMeasureFilter = targetField.IsMeasureFilterApplied;
                context.IsLabelFilter = targetField.IsLabelFilterApplied;
                context.isText = !!(fieldType & ASPxClientSpreadsheet.DocumentModel.ColumnType.Text);
                context.isDate = !!(fieldType & ASPxClientSpreadsheet.DocumentModel.ColumnType.Date);
                context.isNumber = !!(fieldType & ASPxClientSpreadsheet.DocumentModel.ColumnType.Number);
                context.filterState = targetField.FilterState;
            }

            this.getPopupMenuHelper().showPivotTableAutoFilterMenu(context, element);
        }
    }, 
    onShortCutCommand: function(commandId) {
        if(ASPxClientSpreadsheet.Commands.CommandHelper.GetCommandEnabled(this, commandId))
            this.onUICommand(commandId, null);
    },
    onUICommand: function(commandId, params) {
        var processed = false,
            commandManager = this.getCommandManager(),
            force = !!params && params.force;
        if(!force && commandManager.processCommand(commandId, params)) {
            processed = true;
        } else {
            var dialog = this.getDialogManager().getDialog(commandId);
            if(dialog)
                processed = this.onDialogCommand(dialog, commandId, params);
            else
                processed = this.onServerCommand(commandId, params);
        }
        return processed;
    },
    onServerCommand: function(commandId, params) {
        var processed = false;

        var isFormula = ASPxClientSpreadsheet.ServerCommands.isFormulaCommand(commandId),
            isBorderLineStyle =  ASPxClientSpreadsheet.ServerCommands.isBorderLineStyleCommand(commandId),
            isSetPaperKind = ASPxClientSpreadsheet.ServerCommands.isSetPaperKindCommand(commandId),
            isCutOrCopyCommand = ASPxClientSpreadsheet.ServerCommands.getIsCutOrCopyCommand(commandId),
            isPasteCommand = ASPxClientSpreadsheet.ServerCommands.getIsPasteCommand(commandId),
            isPivotTableChangeFieldCommand = ASPxClientSpreadsheet.ServerCommands.isPivotTableChangeFieldCommand(commandId),
            isPivotTableAutoFilterCommand = ASPxClientSpreadsheet.ServerCommands.isPivotTableAutoFilterCommand(commandId);

        var command = ASPxClientSpreadsheet.ServerCommands.getCommandByID(commandId);
        if(command) { 
            if(isFormula || isBorderLineStyle || isSetPaperKind || isPivotTableChangeFieldCommand)
                params = commandId;
            else if(isCutOrCopyCommand) {
                this.generateNewClipboardBufferId();
                params = this.getClipboardHelper().CreateCopyCutServerCommandArgs(params);
            } else if(isPasteCommand)
                params = this.getClipboardHelper().CreatePasteServerCommandArgs();
            else if(isPivotTableAutoFilterCommand)
                params = ASPxClientSpreadsheet.ServerCommands.getPivotTableAutoFilterCommandParams(commandId, params);

            command(this, params);
            processed = true;
        }
        
        if(isCutOrCopyCommand) 
            this.getStateController().markCopiedRange(isCutOrCopyCommand);
        else if (isPasteCommand)
            this.getStateController().onBeforePasteEvent();
        else if(this.isCommandChangingDocument(commandId))
            this.getStateController().clearCopiedRange();

        if(ASPxClientSpreadsheet.ServerCommands.isSelectionChangingCommand(commandId)) 
            this.getStateController().cacheSelection();
        else
            this.getStateController().clearSelectionCache();
        return processed;
    },
    onDialogCommand: function(dialog, commandId, params) {
        dialog.Execute(this, commandId, params);
        return true;
    },
    onRibbonCustomCommand: function(commandName, parameter, item) {
        this.RaiseCustomCommandExecuted(commandName, parameter, item);
    },
    RaiseCustomCommandExecuted: function(commandName, parameter, item) {
        if(!this.CustomCommandExecuted.IsEmpty()){
            var args = new ASPxClientSpreadsheetCustomCommandExecutedEventArgs(commandName, parameter, item);
            this.CustomCommandExecuted.FireEvent(this, args);
        }
    },
    prepareUICommandRequest: function(requestParams, commandID, commandParams) {
        var commandManager = this.getCommandManager();
        if(commandManager.thereAreUnsavedChanges())
            requestParams = requestParams + "&" + commandManager.getNotActulizedData();
        this.processCommandRequest(requestParams, commandID, commandParams);
    },
    processCommandRequest: function(requestParams, commandID, commandParams) {        
        if(this.canCommandBeExecuted(commandID, commandParams)) {
            if(this.isCommandChangingDocument(commandID))
                this.RaiseDocumentChanged();

            this.showLoadingPanelIfNeeded(commandID);
            if(this.isFormDataParams(commandParams))
                this.sendFormDataRequest(requestParams, commandParams);
            else
                this.sendRequest(requestParams);
        }
    },
    isFormDataParams: function() {
        return false;
    },
    sendFormDataRequest: function() {
    },
    canCommandBeExecuted: function(commandID, commandParams) {
        var virtualCommandID = this.getVirtualCommandID(commandID),
            rejectReason = ASPxClientSpreadsheet.ProtectionHelper.isCommandAvailable(this, virtualCommandID, commandParams);
        if(rejectReason === ASPxClientSpreadsheet.ProtectionHelper.RejectReason.LockedSheet || rejectReason === ASPxClientSpreadsheet.ProtectionHelper.RejectReason.LockedCell)
            this.showProtectedSheetWarningMessage();

        var isCommandAvailable = (rejectReason === ASPxClientSpreadsheet.ProtectionHelper.RejectReason.None) && this.getDocumentSettings().isCommandEnabled(virtualCommandID);
        return isCommandAvailable;
    },
    getVirtualCommandID: function(commandID) {
        var virtualCommandID = commandID;
        switch(commandID) {
            case ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatClearAll").id:
                if(this.isSheetLocked()) {
                    var selection = this.getSelectionInternal();
                    if(selection.isDrawingBoxSelection())
                        virtualCommandID = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatRemoveDrawing").id;
                }
                break;
            default:
                virtualCommandID = commandID;
                break;
        }
        return virtualCommandID;
    },

    increaseHandlerRequestCount: function() {
        this.handlerRequestCount ++;
    },
    decreaseHandlerRequestCount: function() {
        this.handlerRequestCount --;
    },
    InHandlerRequestProcessing: function() {
        return this.handlerRequestCount > 0;
    },
    InCallback: function() {
        return this.InHandlerRequestProcessing() || ASPxClientControl.prototype.InCallback.call(this);
    },
    isControlBusy: function() {
        return !this.canApplyResponse() || this.InCallback();
    },
    canApplyResponse: function() {
        var stateController = this.getStateController();
        return !(stateController.isControlBusyToSynchronization() || this.isConfirmDialogShown());
    },
    sendRequest: function(requestQueryString) {
        var resourceUrl = this.getResourceUrl();
        var postdata = this.createPostData(requestQueryString);
        this.createXMLHttpRequest(resourceUrl, postdata, true);
    },
    createPostData: function(requestQueryString) {
        return requestQueryString + "&" + this.getCallbackArgsSerialized();
    },
    createXMLHttpRequest: function(resourceUrl, postdata, setContentType) {
        var xmlHttp = new XMLHttpRequest();
        var async = true;
        
        this.increaseHandlerRequestCount();
        this.RaiseBeginSynchronization();

        var asyncToken = this.asyncTracker.getLockToken();

        xmlHttp.open("POST", resourceUrl, async);
        if(setContentType)
            xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded; charset=utf-8"); // INFO to pass the postData
        xmlHttp.onreadystatechange = function() {
            if(xmlHttp.readyState === 4) {
                if(xmlHttp.status === 200) {
                    //var loginRedirect = ASPx.OfficeHandlerUtils.detectLoginRedirect(resourceUrl, xmlHttp);
                    //if(loginRedirect) {
                    //    this.stopCurrentRequestProcessing();
                    //    return;
                    //}

                    var response = xmlHttp.responseText;
                    this.onResponseReceived(response);

                } else if(xmlHttp.status === 404) {
                    this.stopCurrentRequestProcessing();
                } 

                this.asyncTracker.releaseToken(asyncToken);
            }
        }.aspxBind(this);
        xmlHttp.onerror = function () {
        };
        xmlHttp.send(postdata);
    },
    stopCurrentRequestProcessing: function() {
        this.decreaseHandlerRequestCount();
        this.throwSessionExpiredErrorMessage();
    },
    throwSessionExpiredErrorMessage: function() {
        alert(this.getSessionExpiredMessage());
    },
    getHandlerResourceUrl: function () {
        var url = ASPx.OfficeHandlerUtils.getHandlerResourceUrl();
        url += "DXS.ashx";
        return url;
    },
    getResourceUrl: function() {
        var url = this.getHandlerResourceUrl();
        url += "?" + ASPx.SpreadsheetSessionGuidStateKey + "=" + this.getSessionGuid();
        return url;
    },
    sendDownloadCopyRequest: function(requestQueryString, target) {
        var resourceUrl = this.getResourceUrl() + "&" + requestQueryString,
            copyFrameElement = this.getRenderHelper().getSupportFrameElement();
        if(!target || target === '' || target.indexOf("self") >= 0)
            copyFrameElement.document.location = resourceUrl;
        else
            window.open(resourceUrl, target);
    },
    sendPrintRequest: function(requestQueryString, target) {
        var resourceUrl = this.getResourceUrl() + "&" + requestQueryString;
        if(!ASPx.PDFPluginHelper.IsInstalled())
            window.open(resourceUrl, target);
        else
            this.openPrintDocument(resourceUrl, target);
    },
    openPrintDocument: function(documentUrl, target) {
        var printFrameElement = this.getRenderHelper().getSupportFrameElement();
        if(!target || target === '' || target.indexOf("self") >= 0)
            printFrameElement.document.location = documentUrl;
        else {
            var documentWindow = window.open("", target);
            if(documentWindow.document) {                
                var documentHtml = "<html><head>";
                documentHtml += "<title>Document print preview</title>";
                documentHtml += "</head ><body height='100%' width='100%'>";
                documentHtml += "<iframe src='" + documentUrl + "' height='100%' width='100%'></iframe>";
                documentHtml += "</body ></html >";

                documentWindow.document.open();
                documentWindow.document.write(documentHtml);
                documentWindow.document.close();
            }
        }
    },
    insertSpecificFunctionToActiveEditor: function(functionName) {
        var stateController = this.getStateController(),
            selection = stateController.getSelection(),
            paneManager = this.getPaneManager(),
            cellLayoutInfo = paneManager.getCellLayoutInfo(selection.activeCellColIndex, selection.activeCellRowIndex),
            isEditingCellVisible = (cellLayoutInfo != null) && paneManager.getScrollHelper().getIsEditingCellVisible(cellLayoutInfo.rect, cellLayoutInfo),
            serverRequestToScroll = false;
        if(!isEditingCellVisible) {
            serverRequestToScroll = !paneManager.canScrollToShowCell(selection.activeCellColIndex, selection.activeCellRowIndex);
            if(serverRequestToScroll)
                this.afterScrollingComplete = function() {
                    cellLayoutInfo = paneManager.getCellLayoutInfo(selection.activeCellColIndex, selection.activeCellRowIndex);
                    stateController.insertSpecificFunction(cellLayoutInfo, functionName);
                }.aspxBind(this);
            paneManager.scrollTo(selection.currentColIndex, selection.currentRowIndex, true);
        }
        if(isEditingCellVisible || !serverRequestToScroll)
            stateController.insertSpecificFunction(cellLayoutInfo, functionName);
    },
    loadCurrentSheet: function() {
        ASPxClientSpreadsheet.ServerCommands.LoadSheet(this);
    },
    loadCurrentServerSheet: function() {
        this.clearSheetIndex();
        this.loadCurrentSheet();
    },
    loadInvisibleTiles: function(loadRequestId) {
        ASPxClientSpreadsheet.ServerCommands.LoadInvisibleTiles(this, { RequestId: loadRequestId });
    },
    loadInvisibleTilesForFullScreen: function(loadRequestId) {
        ASPxClientSpreadsheet.ServerCommands.LoadInvisibleTilesForFullScreenMode(this, { FullScreenMode: true, RequestId: loadRequestId });
    },
    getCallbackArgsSerialized: function() {
        return this.getCallbackArgs().join("&") + this.getExtraCommandArgs();
    },
    getCallbackArgs: function() { 
        var args = [ ],
            mainElement = this.getRenderHelper().getWorkbookControl(),
            paneManager = this.getPaneManager();
        
        var scrollAnchor = this.getPaneManager().getScrollAnchorModelPosition(); 
        var hasModelIndicesScrollAnchor = scrollAnchor.col >= 0 && scrollAnchor.row >= 0;

        if(hasModelIndicesScrollAnchor) {
            args.push("scrollAnchor.col=" + scrollAnchor.col);
            args.push("scrollAnchor.row=" + scrollAnchor.row);
        } else {
            scrollAnchor = paneManager.getScrollHelper().getTopLeftCellByScrollPosition();
            if(scrollAnchor.IsValid() && (scrollAnchor.Column > 0 || scrollAnchor.Row > 0)) {
                args.push("scrollAnchor.col=" + scrollAnchor.Column);
                args.push("scrollAnchor.row=" + scrollAnchor.Row);
            } else {
                var scrollContainer = this.getRenderHelper().getScrollContainer();
                args.push("scrollTop=" + scrollContainer.scrollTop);
                args.push("scrollLeft=" + scrollContainer.scrollLeft);
            }
        }

        var sheetWidth = mainElement ? mainElement.offsetWidth : 0;
        if(sheetWidth > 0)
            args.push("width=" + sheetWidth);
        else  
            args.push("width=" + ASPx.GetDocumentMaxClientWidth());

        var sheetHeight = mainElement ? mainElement.offsetHeight : 0;
        if(sheetHeight > 0)
            args.push("height=" + sheetHeight);
        else 
            args.push("height=" + ASPx.GetDocumentMaxClientHeight());

        args.push("cachedTiles=" + paneManager.serializeCachedTiles());
        args.push("sheetIndex=" + this.getDocumentModel().getActiveSheetId());

        args = args.concat(this.serializeSelection());

        return args;
    },
    serializeSelection: function() {
        var args = [],
            selection = this.getStateController().getSelection(),
            paneManager = this.getPaneManager();

        if(selection && selection.isValuable()) {

            var visibleSelection = selection.clone();
            selection = selection.getConvertedToModelIndices(paneManager);
            selection.expandToAllSheetIfRequired(paneManager);

            if(selection.isAllSelected()) {
                args.push("activeCellColIndex=" + (selection.activeCellColIndex >= 0 ? selection.activeCellColIndex : visibleSelection.activeCellColIndex));
                args.push("activeCellRowIndex=" + (selection.activeCellRowIndex >= 0 ? selection.activeCellRowIndex : visibleSelection.activeCellRowIndex));
                args.push("allSelected=true");
            } else if(selection.isDrawingBoxSelection()) {
                args.push("drawingBoxIndex=" + selection.drawingBoxIndex);
            } else if(selection.isCommentBoxSelected()) {
                args.push("commentBoxIndex=" + selection.commentBoxIndex);
            } else {
                if(selection.entireColsSelected)
                    args.push("entireColsSelected=true");
                if(selection.entireRowsSelected)
                    args.push("entireRowsSelected=true");

                var leftColIndex = selection.range.leftColIndex >= 0 ? selection.range.leftColIndex : visibleSelection.range.leftColIndex,
                    topRowIndex = selection.range.topRowIndex >= 0 ? selection.range.topRowIndex : visibleSelection.range.topRowIndex;

                if(selection.entireColsSelected || selection.entireRowsSelected) {
                    var hasHiddenColumnsAtSheetStart = visibleSelection.range.leftColIndex === 0 && selection.range.leftColIndex !== 0,
                        hasHiddenRowsAtSheetStart = visibleSelection.range.topRowIndex === 0 && selection.range.topRowIndex !== 0;

                    if(!selection.increaseHeaderSelection) {
                        if(selection.entireColsSelected && hasHiddenColumnsAtSheetStart)
                            leftColIndex = 0;
                        if(selection.entireRowsSelected && hasHiddenRowsAtSheetStart)
                            topRowIndex = 0;
                    }
                }

                args.push("selectLeftColIndex=" + leftColIndex);
                args.push("selectTopRowIndex=" + topRowIndex);
                args.push("selectRightColIndex=" + (selection.range.rightColIndex >= 0 ? selection.range.rightColIndex : visibleSelection.range.rightColIndex));
                args.push("selectBottomRowIndex=" + (selection.range.bottomRowIndex >= 0 ? selection.range.bottomRowIndex : visibleSelection.range.bottomRowIndex));
                args.push("activeCellColIndex=" + (selection.activeCellColIndex >= 0 ? selection.activeCellColIndex : visibleSelection.activeCellColIndex));
                args.push("activeCellRowIndex=" + (selection.activeCellRowIndex >= 0 ? selection.activeCellRowIndex : visibleSelection.activeCellRowIndex));
                                
                if(selection.multiSelection) {
                    args.push("multiSelection=true");
                    args.push("ranges=" + ASPx.Json.ToJson(selection.ranges));
                }
            }
        }

        return args;
    },
    getExtraCommandArgs: function() {
        var currentDialog = this.getCurrentDialog();
        if(currentDialog !== null) {
            return currentDialog.getCommandArgs();
        }
        return "";
    },
    showLoadingPanelIfNeeded: function(commandID) {
        if (ASPxClientSpreadsheet.ServerCommands.isUIBlockingCommand(commandID))
            this.ShowLoadingPanel();
    },
    isCommandChangingDocument: function(commandID) {
        return ASPxClientSpreadsheet.ServerCommands.isCommandChangingDocument(commandID);
    },

    // Receive data from server
    onResponseReceived: function(jsonResponse) {
        this.applyResponse(jsonResponse);
    },
    applyResponse: function(jsonResponse) {
        this.onResponseReceivedCore(jsonResponse);
        this.decreaseHandlerRequestCount();
        this.RaiseEndSynchronization();
    },
    onResponseReceivedCore: function(jsonResponse) {
        var response = null;
        try {
            response = eval("(" + jsonResponse + ")");
        } catch(e) {
            response = null;
            if(!window.eval) //T334508
                return;
            this.throwSessionExpiredErrorMessage();
        }
        if(response)
            this.processResponse(response);
    },
    isSheetLoaded: function() {
        return this.sheetLoaded;
    },
    setSheetLoadedFlag: function(isSheetLoaded) {
        this.sheetLoaded = isSheetLoaded;
    },
    processResponse: function(response){
        if(response.CustomResultProcessingFunction)
            this.customProcessResponse(response);
        else
            this.defaultProcessResponse(response);
    },
    defaultProcessResponse: function(response) {
        this.processDocumentResponse(response);
        if(!this.isSheetLoaded()) {
            this.setSheetLoadedFlag(true);
            this.sheetInitialize();
        }
    },
    emptyProcessResponse: function(response) {
        this.getStateWatcherHelper().update(response);
    },
    customProcessResponse: function (response) {
        this[response.CustomResultProcessingFunction](response);
    },
    processDocumentResponse: function(response) {
        if(response.error) {
            // show alert or do something like calling this.ProcessCallbackError(errorObj, callbackId)). But we don't have the callbackId, so we can only pass -1.
            this.HideLoadingElements();
            return;
        }
        if(!!response.newSessionGuid)
            this.setSessionGuid(response.newSessionGuid);

        if(this.isNewSheetLoaded(response))
            this.getPaneManager().restoreInitialState();

        this.getDocumentModel().processDocumentStructure(response);

        this.getPaneManager().updateGridTileCache(response);
       
        this.prepareLayoutViewElements(response);

        this.setDefaultCellSize(response[ASPxClientSpreadsheet.ResponseStringKeys.CellSizes]);

        this.setLastFilledCell(response[ASPxClientSpreadsheet.ResponseStringKeys.LastFilledCell]);

        this.getValidationHelper().setCurrentlyValidatingCell(response.validationConfirm);

        this.getPaneManager().processDocumentResponse(response);
        
        this.getGridResizingHelper().update();

        this.updateChartsInfo(response.charts);

        // Ribbon update
        this.updateRestrictiveProperties(response);

        if(this.isSheetSelectorExist())
            this.getTabControl().processDocumentResponse(this.getDocumentModel(), !!response.tabControlInfo);

        this.getRibbonManager().processDocumentResponse(response);
        
        this.getStateController().processDocumentResponse(response[ASPxClientSpreadsheet.ResponseStringKeys.Selection], this.isNewSheetLoaded(response));

        this.getEditingHelper().processDocumentResponse();

        this.setModified(response);
       
        this.updateCellTextViewElementValue();

        //Hide
        this.HideLoadingElements();

        this.getValidationHelper().processDocumentResponse(response);
        
        if(response.lastMessage)
            this.showMessage(response.lastMessage, 0);

        if(response.removeSheetConfirm)
            this.removeSheetWithConfirmation(response.removeSheetConfirm);

        this.notifyDialogResponseReceived(response);

        this.onAfterDocumentResponseProcessed(response);

        this.getStateWatcherHelper().processResponse(response);
    },

    onAfterDocumentResponseProcessed: function(response) {
        var commandId = response[ASPxClientSpreadsheet.ResponseStringKeys.CommandId];
        if(commandId) {
            var commandConfig = ASPxClientSpreadsheet.ServerCommands.getCommandConfigByID(commandId);
            if(commandConfig) {
                var onAfterCommandExecuted = commandConfig.afterCommandExecutedMethod;
                if(onAfterCommandExecuted)
                    this.getCommandManager()[onAfterCommandExecuted]();
            }
        }
    },

    updateCellTextViewElementValue: function() {
        var cellTextViewElement = this.getCellTextViewElement();
        if(!ASPx.IsExists(cellTextViewElement))
            return;
        var cellModelPosition = this.getActiveCellModelPosition();

        if(cellModelPosition.colIndex >= 0 && cellModelPosition.rowIndex >= 0) {
            var activeCellText = this.getPaneManager().getCellEditingText(cellModelPosition.colIndex, cellModelPosition.rowIndex);
            this.setElementValue(this.getCellTextViewElement(), activeCellText);
        }
    },
    setElementsValue: function(value) {
        this.getInputController().setTextAsHtml(value);
        this.setCellTextViewElementValue(value);
    },
    setCellTextViewElementValue: function(value) {
        var cellTextViewElement = this.getCellTextViewElement();
        if(ASPx.IsExists(cellTextViewElement))
            this.setElementValue(cellTextViewElement, value);
    },
    setElementValue: function(element, value) {
        value = value === null ? "" : value;
        element.value = value;
    },
    getEventControlPoint: function(evt) {
        var x = ASPx.Evt.GetEventX(evt);
        var y = ASPx.Evt.GetEventY(evt);
        var mainElement = this.getRenderHelper().getWorkbookControl();
        var controlX = ASPx.GetAbsoluteX(mainElement);
        var controlY = ASPx.GetAbsoluteY(mainElement);

        return {
            x: x - controlX,
            y: y - controlY
        };
    },
    dispatchEvent: function(evt, paneType) {
        if(ASPx.Browser.TouchUI)
            paneType = this.getPaneManager().getPaneTypeByEvent(evt);
        var stateController = this.getStateController(),
            srcElement = ASPx.Evt.GetEventSource(evt);

        if(stateController.isCellRangeSelectionInProcess() || stateController.isSelectionMovementInProcess() || stateController.isFillDataInProcess())
            this.dispatchCellEventByPoint(evt, paneType);
        else if(stateController.isDrawingBoxDragingOrResizingInProcess())
            this.dispatchDrawingBoxEvent(evt, srcElement);
        else if(stateController.isCommentBoxDragingOrResizingInProcess())
            this.dispatchCommentEvent(evt, srcElement);
        else {
            if(this.isSelectSheetButton(srcElement)) {
                stateController.selectAll();
            } else if(this.isCommentSelected(srcElement)) {
                this.dispatchCommentEvent(evt, srcElement);
            } else if(this.isDrawingSelected(srcElement)) {
                this.dispatchDrawingBoxEvent(evt, srcElement);
            } else {                
                this.dispatchCellEventByPoint(evt, paneType);
            }
        }
    },
    isDrawingSelected: function(targetElement) {
        return ASPx.ElementHasCssClass(targetElement, SpreadsheetCssClasses.DrawingBox) || this.getIsDrawingBoxSelectionElement(targetElement);
    },
    isCommentSelected: function(targetElement) {
        return this.isCommentBoxElement(targetElement) || this.isCommentBoxSelectionElement(targetElement);
    },
    isSelectSheetButton: function(targetElement) {
        return ASPx.ElementHasCssClass(targetElement, SpreadsheetCssClasses.SelectSheetButton) || ASPx.ElementHasCssClass(targetElement, SpreadsheetCssClasses.SelectSheetButtonArrow);
    },
    setDefaultCellSize: function(defaultCellSize) {
        this.defaultCellSizeChangedOnResponse = false;
        if(defaultCellSize) 
            if(this.defaultCellSize.width !== defaultCellSize[ASPxClientSpreadsheet.DocumentModel.Sizes.Width] || this.defaultCellSize.height !== defaultCellSize[ASPxClientSpreadsheet.DocumentModel.Sizes.Height]) {
                this.defaultCellSize.width = defaultCellSize[ASPxClientSpreadsheet.DocumentModel.Sizes.Width];
                this.defaultCellSize.height = defaultCellSize[ASPxClientSpreadsheet.DocumentModel.Sizes.Height];
                this.defaultCellSizeChangedOnResponse = true;
            }
    },
    isDefaultCellSizeChangedOnResponse: function() {
        return this.defaultCellSizeChangedOnResponse;
    },
    setLastFilledCell: function(lastFilledCell) {
        if(lastFilledCell) {
            this.lastFilledCell.col = lastFilledCell[ASPxClientSpreadsheet.DocumentModel.CellStringKeys.Column];
            this.lastFilledCell.row = lastFilledCell[ASPxClientSpreadsheet.DocumentModel.CellStringKeys.Row];
        }
    },
    isNewSheetLoaded: function(response) {
        return response[ASPxClientSpreadsheet.ResponseStringKeys.NewSheetLoading] === 1;
    },

    // Active control
    activateControl: function() {
        ASPxClientSpreadsheet.activeSpreadsheetControl = this;
    },
    deactivateControl: function() {
        ASPxClientSpreadsheet.activeSpreadsheetControl = null;
    },

    //Comments
    isCommentBoxElement: function(targetElement) {
        return ASPx.ElementHasCssClass(targetElement, SpreadsheetCssClasses.CommentBox) ||
           ASPx.ElementHasCssClass(targetElement, SpreadsheetCssClasses.CommentEditorElement);
    },
    isCommentBoxSelectionElement: function(targetElement) {
        var cssName = "dxss-cbse";
        return ASPx.ElementHasCssClass(targetElement, cssName) || (!!targetElement.parentNode && ASPx.ElementHasCssClass(targetElement.parentNode, cssName));
    },
    getCommentBoxByIndex: function(index) {
        var tilesContainer = this.getRenderHelper().getGridTilesContainer(),
            commentBoxes = ASPx.GetNodesByClassName(tilesContainer, SpreadsheetCssClasses.CommentBox),
            len = commentBoxes ? commentBoxes.length : 0;
        while(len--) {
            if(this.getModelBoxIndex(commentBoxes[len]) === index)
                return commentBoxes[len];
        }
        return null;
    },

    // Drawing boxes
    getIsDrawingBoxSelectionElement: function (element) {
        return  ASPx.ElementHasCssClass(element, SpreadsheetCssClasses.DrawingBoxSelectedElement) ||
            (!!element.parentNode && ASPx.ElementHasCssClass(element.parentNode, SpreadsheetCssClasses.DrawingBoxSelectedElement));
    },
    getIsChartElement: function(element) {
        return ASPx.ElementContainsCssClass(element, SpreadsheetCssClasses.ChartElement);
    },
    getIsDrawingBoxElement: function(element) {
        return ASPx.ElementHasCssClass(element, ASPx.SpreadsheetCssClasses.DrawingBox);
    },
    getDrawingBoxByIndex: function(index) {
        var tilesContainer = this.getRenderHelper().getWorkbookControl();
        if(tilesContainer) {
            var drawingBoxes = tilesContainer.getElementsByTagName("IMG");
            for(var i = 0; i < drawingBoxes.length; i++) {
                if(this.getModelBoxIndex(drawingBoxes[i]) == index)
                    return drawingBoxes[i];
            }
        }
        return null;
    },
    getModelBoxIndex: function(drawingBoxElement) {
        return parseInt(ASPx.Attr.GetAttribute(drawingBoxElement, "data-dbi"));
    },
    modelBoxStartMovingOrResizing: function() {
        this.Focus();

        var workbook = this.getRenderHelper().getWorkbookControl(),
            editors = ASPx.GetNodesByClassName(workbook, SpreadsheetCssClasses.CommentEditorElement),
            len = editors ? editors.length : 0;
        while(len--) {
            var inplaceCommentEditor = editors[len];
            if(inplaceCommentEditor) {
                ASPx.Attr.SetAttribute(inplaceCommentEditor, "readonly", "readonly");
                ASPx.AddClassNameToElement(inplaceCommentEditor, "noselect");
            }
        }
    },
    modelBoxEndMovingOrResizing: function() {
        var workbook = this.getRenderHelper().getWorkbookControl(),
            editors = ASPx.GetNodesByClassName(workbook, SpreadsheetCssClasses.CommentEditorElement),
            len = editors ? editors.length : 0;
        while(len--) {
            var inplaceCommentEditor = editors[len];
            if(inplaceCommentEditor) {
                ASPx.Attr.RemoveAttribute(inplaceCommentEditor, "readonly");
                if(ASPx.ElementContainsCssClass(inplaceCommentEditor, "noselect"))
                    ASPx.RemoveClassNameFromElement(inplaceCommentEditor, "noselect");
            }
        }
    },

    // Events
    onKeyDown: function(evt, editMode) {
        this.onKeyboardEvent();

        var editingWasNotStarted = editMode == ASPxClientSpreadsheet.StateController.Modes.Ready;

        this.keyboardManager.onKeyDown(this, evt, editMode);
        
        if(editingWasNotStarted)
            return this.onKeyDownPreventBrowserBack(evt);
    },
    onMouseUp: function(evt) {
        var paneType = this.getPaneManager().getPaneTypeByEvent(evt);
        if(ASPx.Browser.MSTouchUI)
            this.getPaneManager().getScrollHelper().onMsTouchMouseUp();
        this.dispatchEvent(evt, paneType);
        this.dispatchRowHeaderEvent(evt);
        this.dispatchColHeaderEvent(evt);
    },
    onKeyDownPreventBrowserBack: function(evt) {
        var keyCode = ASPx.Evt.GetKeyCode(evt);
        if(keyCode === ASPx.Key.Backspace)
            return ASPx.Evt.PreventEvent(evt);
    },
    onKeyboardEvent: function() {
        this.lastKeyboardEventTime = new Date();
    },
    timeFromLastKeyboardEvent: function() {
        if(this.lastKeyboardEventTime)
            return new Date() - this.lastKeyboardEventTime;
        return Number.MAX_SAFE_INTEGER;
    },

    onEditingEventStopped: function() {
        this.lastEdtitingTime = new Date();
    },
    timeFromLastEditing: function() {
        if(this.lastEdtitingTime)
            return new Date() - this.lastEdtitingTime;
        return Number.MAX_SAFE_INTEGER;
    },

    onSheetIndexChanged: function(visibleIndex) {
        var sheetId = this.getDocumentModel().getSheetIdByVisibleIndex(visibleIndex);
        this.changeSheetIndex(sheetId);
    },
    changeSheetIndex: function(sheetId) {
        this.getDocumentModel().setActiveSheetId(sheetId);
        this.loadCurrentSheet();
    },
    dispatchCellEventByPoint: function(evt, paneType) {
        var srcElement = ASPx.Evt.GetEventSource(evt),
            cellLayoutInfo = null,
            eventFromCellTextViewElement = false;

        if(srcElement === this.getCellTextViewElement()) {
            var currentSelection = this.getStateController().getSelection();
            cellLayoutInfo = this.getPaneManager().getCellLayoutInfo(currentSelection.activeCellColIndex, currentSelection.activeCellRowIndex);
            eventFromCellTextViewElement = true;
        } else {
            var point = this.getEventControlPoint(evt);
            cellLayoutInfo = this.getPaneManager().getCellByCoord(point.x, point.y, paneType);
        }
        var stateController = this.getStateController();
        stateController.onCellEvent(evt, cellLayoutInfo, eventFromCellTextViewElement, paneType);
    },
    dispatchDrawingBoxEvent: function(evt, drawingBoxElement) {
        var drawingBoxIndex = this.getModelBoxIndex(drawingBoxElement);
        this.getStateController().onDrawingBoxEvent(evt, drawingBoxElement, drawingBoxIndex);
    },
    dispatchRowHeaderEvent: function(evt, paneType) {
        paneType = paneType ? paneType : ASPxClientSpreadsheet.PaneManager.PanesType.MainPane;
        this.getStateController().onHeaderEvent(evt, false, paneType);
    },
    dispatchColHeaderEvent: function(evt, paneType) {
        paneType = paneType ? paneType : ASPxClientSpreadsheet.PaneManager.PanesType.MainPane;
        this.getStateController().onHeaderEvent(evt, true, paneType);
    },
    dispatchCommentEvent: function(evt, commentSelectedElement) {
        if(this.isObjectSelectionAllowed()) {
            var commentBox = ASPx.ElementHasCssClass(commentSelectedElement, SpreadsheetCssClasses.CommentEditorElement) ? commentSelectedElement.parentNode : commentSelectedElement,
                index = this.getModelBoxIndex(commentBox);
            this.getStateController().onCommentBoxEvent(evt, commentBox, index);
        } else { //doesn't allow to select textarea
            return ASPx.Evt.PreventEventAndBubble(evt);
        }
    },
    isObjectSelectionAllowed: function() {
        var stateController = this.getStateController();
        return !stateController.isDynamicSelectionHelperAttachedToDialog() && ASPxClientSpreadsheet.ProtectionHelper.isObjectSelectionAvailable(this);
    },
    onVisibleTileRangeChanged: function() {
        // this.finishEditingSilently(); // T497229
    },
    // With client-side event
    applyEditingWithEvent: function() {
        return this.getStateController().applyEditingWithRaisingEvent();
    },
    finishEditingWithEvent: function() {
        var stateController = this.getStateController();
        if(this.getInputController().isEditingInProgress())
            return this.applyEditingWithEvent();
        else if(stateController.isCommentEditingInProgress())
            stateController.endCommentEditing();

        return true;
    },

    // Without client-side event 
    applyEditingSilently: function() {
        this.getStateController().applyEditingSilently();
    },
    finishEditingSilently: function() {
        var stateController = this.getStateController();
        if(this.getInputController().isEditingInProgress())
            this.applyEditingSilently();
        else if(stateController.isCommentEditingInProgress())
            stateController.endCommentEditing();
    },

    /*# public ASPxClientSpreadsheetEditMode GetEditMode() { return ASPxClientSpreadsheetEditMode.None; } #*/
    GetEditMode: function() {
        var stateController = this.getStateController();

        if(this.getInputController().isEditingInProgress())
            return ASPxClientSpreadsheetEditMode.Cell;
        else if(stateController.isCommentEditingInProgress())
            return ASPxClientSpreadsheetEditMode.Comment;

        return ASPxClientSpreadsheetEditMode.None;
    },
    IsEditingInProgress: function() {
        var stateController = this.getStateController();
        return this.getInputController().isEditingInProgress() || stateController.isCommentEditingInProgress();
    },
    /*# public void ApplyCellEdit() {} #*/
    ApplyCellEdit: function() {
        return this.finishEditingWithEvent();
    },
    /*# public void CancelCellEdit() {} #*/
    CancelCellEdit: function() {
        if(this.GetEditMode())
            this.getStateController().cancelEditing();
    },
    /*# public void SetCellEditorText(string text) {} #*/
    SetCellEditorText: function(text) {
        var editingMode = this.GetEditMode();
        if(editingMode === ASPxClientSpreadsheetEditMode.Cell) {
            var inputController = this.getInputController();
            inputController.setTextAsHtml(text);
        }
    },
    GetCellEditorText: function() {
        var editingMode = this.GetEditMode();
        if(editingMode === ASPxClientSpreadsheetEditMode.Cell) {
            var inputController = this.getInputController();
            return inputController.getEditorText();
        }
        return "";
    },
    AssignDXEditor: function(editor, beginEditEventArgs) {
        ASPxClientSpreadsheet.InplaceEditorHelper.AssignEditor(this, editor, beginEditEventArgs);
    },
    getActivePivotTable: function() {
        var pivotTables = this.getDocumentModel().getPivotTables(),
            activePivotTable = null;
        if(pivotTables.length > 0) {
            var selection = this.getSelectionInternal(),
                paneManager = this.getPaneManager(),
                modelRange = paneManager.convertVisibleRangeToModel(selection.getActiveCellRange());

                activePivotTable = pivotTables.getItemByRange(modelRange);
        }
        return activePivotTable;
    },
    pivotTableChangeActiveField: function(params) {
        var commandParams = params.split(ASPxClientSpreadsheet.ServerCommands.getCommandSeparator()),
            updateMethod = commandParams[1] === "r" ? "setActiveFieldRowIndex" : "setActiveFieldColumnIndex",
            fieldIndex = parseInt(commandParams[2]),
            activePivotTable = this.getActivePivotTable();
        if(activePivotTable)
            activePivotTable[updateMethod](fieldIndex);

        this.showUpPivotTableContextMenu();
    },
    showUpPivotTableContextMenu: function() {
        var popupMenuProperties = this.getPopupMenuHelper().getMultiFieldProperties();
        if(popupMenuProperties && popupMenuProperties.element && popupMenuProperties.filterType >= 0) {
            setTimeout(function() {
                this.onPivotTableAutoFilterClick(popupMenuProperties.element, -1, popupMenuProperties.filterType);
            }.aspxBind(this), 0);
        }
    },
    /*# public string GetActiveSheetName() { return string.Empty; } #*/
    GetActiveSheetName: function() {
        return this.getDocumentModel().getActiveSheetName();
    },
    RaiseCellBeginEdit: function(cellModelPosition) {
        if(!this.CellBeginEdit.IsEmpty()) {
            var cellValueInfo = this.getCellValueInfo(cellModelPosition.colIndex, cellModelPosition.rowIndex),
                args = new ASPxClientSpreadsheetCellBeginEditEventArgs(cellModelPosition.colIndex, cellModelPosition.rowIndex, cellValueInfo.formula, cellValueInfo.value, this.GetActiveSheetName());
            this.CellBeginEdit.FireEvent(this, args);
            return args.cancel;
        }
        return false;
    },
    RaiseCellEndEdit: function(cellModelPosition, editorValue) {
        if(!this.CellEndEdit.IsEmpty()) {
            var cellValueInfo = this.getCellValueInfo(cellModelPosition.colIndex, cellModelPosition.rowIndex),
                args = new ASPxClientSpreadsheetCellEndEditEventArgs(cellModelPosition.colIndex, cellModelPosition.rowIndex, cellValueInfo.formula, cellValueInfo.value, this.GetActiveSheetName(), editorValue);
            this.CellEndEdit.FireEvent(this, args);
            return args;
        }
        return null;
    },
    RaiseCellCancelEdit: function(cellModelPosition) {
        if(!this.CellCancelEdit.IsEmpty()) {
            var cellValueInfo = this.getCellValueInfo(cellModelPosition.colIndex, cellModelPosition.rowIndex),
                args = new ASPxClientSpreadsheetCellCancelEditEventArgs(cellModelPosition.colIndex, cellModelPosition.rowIndex, cellValueInfo.formula, cellValueInfo.value, this.GetActiveSheetName());
            this.CellCancelEdit.FireEvent(this, args);
        }
    },

    // Tab Control
    // Internal property setters
    clearSheetIndex: function() {
        this.getDocumentModel().setActiveSheetId(-1);
    },
    removeSheetWithConfirmation: function(confirmation) {
        if(window.confirm(confirmation))
            this.onServerCommand(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("RemoveSheet").id, { ForceRemove: true });
    },
                
    // Confirm message
    getConfirmUpdateText: function() {
        return this.confirmUpdate;
    },
    getModified: function() {
        return this.modified;
    },
    setModified: function(response) {
        this.modified = response[ASPxClientSpreadsheet.ResponseStringKeys.Modified] === 1;
    },
    setConfirmOnCallbackEnabled: function(enabled) {
        this.getUpdateWatcherHelper().SetConfirmOnCallbackEnabled(enabled);
    },
    setConfirmOnPostbackEnabled: function(enabled) {
        this.getUpdateWatcherHelper().SetConfirmOnPostbackEnabled(enabled);
    },
    documentUploadingStarted: function() {
        var updateWatcherHelper = this.getUpdateWatcherHelper();
        if(updateWatcherHelper)
            updateWatcherHelper.StartImageUploadCallback();
    },
    documentUploadingComplete: function() {
        var updateWatcherHelper = this.getUpdateWatcherHelper();
        if(updateWatcherHelper)
            updateWatcherHelper.EndImageUploadCallback();
    },

    // State Whatcher Helper
    getStateWatcherHelper: function() {
        return this.stateWatcherHelper;
    },
    // Chart support
    updateChartsInfo: function(chartsInfo) {
        this.chartsInfo = chartsInfo;
    },
    getChartsInfo: function() {
        return this.chartsInfo; 
    },
    getChartInfoById: function(chartId) {
        var chartsInfo = this.getChartsInfo();
        if(chartsInfo)
            for(var index = 0; index < chartsInfo.length; index++) {
                if(chartsInfo[index].Id == chartId)
                    return chartsInfo[index];
            }
        return null;
    },
    getChartAttributeById: function(chartId, attributeName) {
        var chartInfo = this.getChartInfoById(chartId);
        if (chartInfo)
            return chartInfo[attributeName];
        return "";
    },
    getChartAttribute: function(chartInfo, attributeName) {
        if (chartInfo)
            return chartInfo[attributeName];
        return "";
    },
    
    // Resizing Control
    BrowserWindowResizeSubscriber: function() {
        return this.isInFullScreenMode || ASPxClientControl.prototype.BrowserWindowResizeSubscriber.call(this);
    },
    OnBrowserWindowResize: function (e) {
        if(this.isInFullScreenMode)
            this.adjustControlInFullScreenMode();
        else 
            this.AdjustControl();
    },
    resizeColumn: function(index, width) {
        ASPxClientSpreadsheet.ServerCommands.ResizeColumn(this, { ColumnIndex: index, ColumnWidth: width });
    },
    resizeRow: function(index, height) {
        ASPxClientSpreadsheet.ServerCommands.ResizeRow(this, { RowIndex: index, RowHeight: height });
    },
    autoFitHeaderSize: function(isCol, index) {
        var commandId = isCol ? ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("AutoFitColumnWidth").id :
            ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("AutoFitRowHeight").id;
        this.onUICommand(commandId, { Index: index });
    },
    
    // Adjust Control
    IsAdjustmentRequired: function() {
        return ASPxClientControl.prototype.IsAdjustmentRequired.call(this) || this.getPaneManager().restoreScrollPositionRequired();
    },
    AdjustControlCore: function() {
        ASPxClientControl.prototype.AdjustControlCore.call(this);
        this.adjustRootControls(true);
    },
    adjustRootControls: function(updateScrollPosition) {
        this.onBeginControlAdjustment();
        this.onControlAdjustment(updateScrollPosition);
        this.onEndControlAdjustment();
    },
    onBeginControlAdjustment: function() {
        var renderHelper = this.getRenderHelper(),
            workbook = renderHelper.getWorkbookControl();

        this.sizeCache = {
            height: workbook.offsetHeight,
            width: workbook.offsetWidth
        };
    },
    onControlAdjustment: function(updateScrollPosition) {
        this.adjustRibbonControl(true);
        if(this.isFormulaBarEditMode())
            this.getEditingHelper().adjustIframeOverFormulaBar();
        if(this.getPaneManager().getFrozenPaneSettings().isFrozen)
            this.getRenderHelper().adjustFreezePanes();
        else
            this.getRenderHelper().adjustControl();

        if(updateScrollPosition)
            this.getPaneManager().updateScrollPosition();
    },
    onEndControlAdjustment: function() {
        var renderHelper = this.getRenderHelper(),
            workbook = renderHelper.getWorkbookControl(),
            height = workbook.offsetHeight,
            width = workbook.offsetWidth,
            deltaWidht = this.getResizeAdjustmentDelatWidth(),
            deltaHeight = this.getResizeAdjustmentDelatWidth();

        if(width - this.sizeCache.width > deltaWidht ||
            height - this.sizeCache.height > deltaHeight)
            this.onViewAreaChanged();

        this.sizeCache = {
            height: 0,
            width: 0
        };
    },
    getResizeAdjustmentDelatHeight: function() {
        return this.adjustmentDelatHeight;
    },
    getResizeAdjustmentDelatWidth: function() {
        return this.adjustmentDelatWidth;
    },
    adjustControlInFullScreenMode: function() {
        var correctHeight = 0;
        if(this.isRibbonExternal()) {
            var ribbonManager = this.getRibbonManager();
            correctHeight = ribbonManager.GetRibbonHeight();
        }
        this.setWidthInternal(ASPx.GetDocumentClientWidth(), true);
        this.setHeightInternal(ASPx.GetDocumentClientHeight() - correctHeight, true);
        this.adjustRootControls();
    },
    adjustRibbonControl: function(nestedCall) {
        var ribbonControl = this.GetRibbon();
        if(ribbonControl)
            ribbonControl.AdjustControl(nestedCall);
    },
    adjustTabControl: function() {
        var tabControl = this.getTabControl();
        if(tabControl)
            tabControl.AdjustControl();
    },
    
    // Sizes
    setWidthInternal: function(width, skipAdjustControl) {
        if(!ASPx.IsNumber(width) && ASPx.IsPercentageSize(width))
            this.setSizeInPercentage("width", width);
        else
            ASPxClientControl.prototype.SetWidth.call(this, width);
        
        if(!skipAdjustControl)
            this.AdjustControl();
        this.adjustRibbonControl(false);
        this.adjustTabControl();
    },
    setHeightInternal: function(height, skipAdjustControl) {
        if(!ASPx.IsNumber(height) && ASPx.IsPercentageSize(height))
            this.setSizeInPercentage("height", height);
        else
            ASPxClientControl.prototype.SetHeight.call(this, height);

        if(!skipAdjustControl)
            this.AdjustControl();
    },
    setSizeInPercentage: function(sizePropertyName, size){
        this.GetMainElement().style[sizePropertyName] = size;
        this.UpdateAdjustmentFlags();
    },
    SetWidth: function(width) {
        ASPxClientControl.prototype.SetWidth.call(this, width);
        this.adjustRibbonControl(false);
        this.adjustTabControl();
        this.AdjustControl();
    },
    SetHeight: function(height, skipAdjustControl) {
        ASPxClientControl.prototype.SetHeight.call(this, height);
        this.AdjustControl();
    },
    getTabControlHeight: function() {
        var tabControl = this.getTabControl(),
            height = ASPx.IsExists(tabControl) ? tabControl.GetHeight() : 0;

        return height;
    },
    setTabControlWidth: function(width) {
        var tabControl = this.getTabControl();
        if(ASPx.IsExists(tabControl))
            tabControl.SetWidth(width);
    },
    setRibbonWidth: function(width) {
        var ribbonControl = this.GetRibbon();
        if (ribbonControl)
            ribbonControl.SetWidth(width);
    },
    getInternalRibbonControlHeight: function() {
        if (!this.isRibbonExternal()) {
            var ribbonControl = this.GetRibbon();
            if (ribbonControl)
                return ribbonControl.GetHeight();
        }
        return 0;
    },
    getFormulaBarHeight: function() {
        var formulaBar = this.getRenderHelper().getFormulaBar();
        return  formulaBar ? formulaBar.offsetHeight : 0;
    },
    getMainElementHeightByServerValue: function() {
        var mainElement = this.GetMainElement();
        var height = this.GetHeight() - ASPx.GetTopBottomBordersAndPaddingsSummaryValue(mainElement);
        var innerControlsHeight = this.getInternalRibbonControlHeight() + this.getTabControlHeight() + this.getFormulaBarHeight();
        height = height - innerControlsHeight;
        if (height < 0)
            height =  innerControlsHeight;
        return height;
    },
    getActiveCellSize: function(isCol) {
        var currentSelection = this.getSelectionInternal(),
            cellIndex = isCol ? currentSelection.activeCellColIndex : currentSelection.activeCellRowIndex;
        return this.getPaneManager().getCellSize(cellIndex, isCol);
    },
   
    //Loading panel
    ShowLoadingPanel: function() {
        this.CreateLoadingPanelWithAbsolutePosition(this.GetMainElement(), this.GetLoadingPanelOffsetElement(this.getRenderHelper().getWorkbookControl()));
    },
    ShowLoadingDiv: function () {
        this.CreateLoadingDiv(this.getRenderHelper().getWorkbookControl().parentNode, this.getRenderHelper().getWorkbookControl());
    },

    // Messages
    showProtectedSheetWarningMessage: function() {
        var cancel = this.RaiseProtectionWarning();
        if(!cancel)
            this.showBuiltInMessage("Msg_CellOrChartIsReadonlyShort", 0);
    },
    RaiseProtectionWarning: function() {
        if(!this.ProtectionWarning.IsEmpty()) {
            var args = new ASPxClientCancelEventArgs();
            this.ProtectionWarning.FireEvent(this, args);

            return args.cancel;
        }
        return false;
    },
    showPivotTableEditingWarningMessage: function() {
        this.showBuiltInMessage("Msg_PivotTablePartCanNotBeChanged", 0);
    },
    showLocalizedMessageBox: function(XtraSpreadsheetStringId) {
        var localizedString = ASPxClientSpreadsheet.localizedStringHelper.getString(XtraSpreadsheetStringId);
        if(!localizedString)
            ASPxClientSpreadsheet.ServerCommands.GetLocalizedStringConstant(this, {XtraSpreadsheetStringId: XtraSpreadsheetStringId, CustomResultProcessingFunction: "showLocalizedMessageBoxFromServer"});
        else 
            alert(localizedString);
    },
    showLocalizedMessageBoxFromServer: function(response) {
        ASPxClientSpreadsheet.localizedStringHelper.setString(response.XtraSpreadsheetStringId, response.XtraSpreadsheetString);
        this.showLocalizedMessageBox(response.XtraSpreadsheetStringId);
    },

    showMessage: function(message, messageType, options) {
        var messageBox = this.getMessageBox();
        if(messageBox) {
            messageBox.setMessageOptions(message, messageType, options, false);
            messageBox.Execute(this);
        }
    },
    showBuiltInMessage: function(messageId, messageType, options) {
        var messageBox = this.getMessageBox();
        if(messageBox) {
            messageBox.setMessageOptions(messageId, messageType, options, true);
            messageBox.Execute(this);
        }
    },

    getMessageBox: function() {
        return this.getDialogManager().getMessageBox();
    },
    getSessionExpiredMessage: function() {
        return ASPxClientSpreadsheet.ASPxSpreadsheetDialogList.Message[8];
    },

    hasWorkDirectory: function() {
        return this.hasWorkFolder;
    },
       
    // PopupMenu support
    onGridContextMenu: function(e, showAtSelectedObject) {
        var popupMenuPosition = {};
        if(showAtSelectedObject)
            popupMenuPosition = this.getPaneManager().getPopupMenuPosition();
        else {
            popupMenuPosition.x = e.x;
            popupMenuPosition.y = e.y;
        }

        this.showPopupMenu(e, {
            x: popupMenuPosition.x,
            y: popupMenuPosition.y,
            ownerControl: this
        });
    },
    isEventInDocumentBoundaries: function(e) {
        var tileHelper = this.getPaneManager().getTileHelper(),
            endColPos = tileHelper.getEndOfDocumentAbsPos(true),
            endRowPos = tileHelper.getEndOfDocumentAbsPos(false);

        return (!endColPos || endColPos >= ASPx.Evt.GetEventX(e)) &&
            (!endRowPos || endRowPos >= ASPx.Evt.GetEventY(e));
    },
    showPopupMenu: function(e, context) {
        if(!this.isEventInDocumentBoundaries(e))
            return;
        var selection = this.getSelectionInternal(),
            drawingBoxElement = selection.drawingBoxElement,
            paneManager = this.getPaneManager();

        context.mouseX = context.x || ASPx.Evt.GetEventX(e);
        context.mouseY = context.y || ASPx.Evt.GetEventY(e);

        context.isRowHeader = context.isRowHeader || false;
        context.isColumnHeader = context.isColumnHeader || false;

        context.isDrawing = selection.drawingBoxIndex > -1;
        context.isChart = this.getIsChartElement(selection.drawingBoxElement);

        if(context.isChart)
            context.MenuType = ASPxClientSpreadsheetPopupMenuType.Chart;
        else if(context.isDrawing)
            context.MenuType = ASPxClientSpreadsheetPopupMenuType.Picture;

        if(!context.isDrawing)
            context.isLink = ASPx.IsExists(ASPx.GetNodeByTagName(this.getRenderHelper().getActiveCellElement(), "a", 0));
        else
            context.isLink = ASPx.IsExists(ASPx.Attr.GetAttribute(drawingBoxElement, "_loc"));

        if(drawingBoxElement) {
            var chartIndex = ASPx.Attr.GetAttribute(drawingBoxElement, "data-dbi");
            var chartInfo = this.getChartInfoById(chartIndex);

            context.hasTitle = this.getChartAttribute(chartInfo, "Title") !== "";
            context.hasHTitle = this.getChartAttribute(chartInfo, "HAxisTitle") !== "";
            context.hasVTitle = this.getChartAttribute(chartInfo, "VAxisTitle") !== "";
        }

        if(!context.isDrawing && !context.isChart && !context.isRowHeader && !context.isColumnHeader) {
            var position = this.getActiveCellModelPosition(),
                commentInfo = paneManager.getCommentInfo(position.colIndex, position.rowIndex);
            context.isComment = commentInfo ? true : false;
        }

        context.readOnly = this.isReadOnly();
        context.isArrangeEnabled = this.isArrangeCommandEnabled();

        context.isAllSelected = selection.isAllSelected();
        context.isColumnSelected = selection.isColumnsSelected();
        context.isRowSelected = selection.isRowsSelected();
        context.isPivotTable = false;
        context.isPivotTableFieldDialog = false;

        var pivotTables = this.getDocumentModel().getPivotTables();
        if(pivotTables.length > 0) {
            var activePivotTable = this.getActivePivotTable();
            context.isPivotTable = !!activePivotTable;
            if(context.isPivotTable) {
                var currentDialog = this.getCurrentDialog();
                context.MenuType = ASPxClientSpreadsheetPopupMenuType.PivotTable;
                if(currentDialog)
                    context.isPivotTableFieldDialog = currentDialog.commandId === ASPxClientSpreadsheet.ServerCommands.internalCommands.FieldListPanelPivotTable.id;
            }
        }
        this.getPopupMenuHelper().showPopupMenu(context);
    },
    RaisePopupMenuShowing: function(menuItems, menuType){
        if(!this.PopupMenuShowing.IsEmpty()) {
            var args = new ASPxClientSpreadsheetPopupMenuShowingEventArgs(menuItems, menuType);
            this.PopupMenuShowing.FireEvent(this, args);

            return args.cancel;
        }
        return false;
    },
    isArrangeCommandEnabled: function() {
        return ASPx.GetNodesByClassName(this.getRenderHelper().getWorkbookControl(), SpreadsheetCssClasses.DrawingBox).length > 1;
    },

    // Ribbon update support
    onRibbonFillItemsNeedToUpdate: function(selection) {
        this.getRibbonManager().onFillItemsChanged(selection.range.bottomRowIndex + selection.range.topRowIndex != 0, 
                                                        selection.range.leftColIndex + selection.range.rightColIndex != 0);
        this.updateFillGroup = selection.range.bottomRowIndex + selection.range.topRowIndex == 0 || selection.range.leftColIndex + selection.range.rightColIndex == 0;
    },
    onEditingStarting: function() {
        ASPx.RemoveClassNameFromElement(this.GetMainElement(), ASPx.SpreadsheetCssClasses.NoEditMode);
        if(this.isFormulaBarEditMode()) {
            ASPx.RemoveClassNameFromElement(this.GetMainElement(), ASPx.SpreadsheetCssClasses.InplaceCellEditMode);
            ASPx.AddClassNameToElement(this.GetMainElement(), ASPx.SpreadsheetCssClasses.FormulaBarEditMode);
        }
        else {
            ASPx.AddClassNameToElement(this.GetMainElement(), ASPx.SpreadsheetCssClasses.InplaceCellEditMode);
            ASPx.RemoveClassNameFromElement(this.GetMainElement(), ASPx.SpreadsheetCssClasses.FormulaBarEditMode);
        }
    },
    onEditingStarted: function() {
        if(this.showFormulaBar)
            this.changeFormulaBarMenuItemsEnabled(true);
        if(this.isSheetSelectorExist())
            this.getTabControl().onEditingStarted();
        this.ribbonStateUpdate("onEditingStarted");
    },
    onEditingStopped: function() {
        ASPx.AddClassNameToElement(this.GetMainElement(), ASPx.SpreadsheetCssClasses.NoEditMode);
        ASPx.RemoveClassNameFromElement(this.GetMainElement(), ASPx.SpreadsheetCssClasses.InplaceCellEditMode);
        ASPx.RemoveClassNameFromElement(this.GetMainElement(), ASPx.SpreadsheetCssClasses.FormulaBarEditMode);

        if(this.showFormulaBar)
            this.changeFormulaBarMenuItemsEnabled(false);
        if(this.isSheetSelectorExist())
            this.getTabControl().onEditingStopped();
        this.ribbonStateUpdate("onEditingStopped");
    },
    changeFormulaBarMenuItemsEnabled: function(enabled) {
        var formulaBarMenu = this.getFormulaBarMenu();
        for(var i = 0; i < formulaBarMenu.GetItemCount(); i++)
            formulaBarMenu.GetItem(i).SetEnabled(enabled);
    },

    switchReadOnlyMode: function() {
        this.ribbonStateUpdate("onItemsEnabledChanged");
    },
    onSheetLockedChanged: function() {
        this.ribbonStateUpdate("onItemsEnabledChanged");
    },
    onWorkbookLockedChanged: function() {
        this.ribbonStateUpdate("onItemsEnabledChanged");
    },
    ribbonStateUpdate: function(methodName) {
        if(!this.isRibbonUpdateLocked())
            this.getRibbonManager()[methodName]();
        else
            this.addRibbonMethodsToQueue(methodName);
    },
    isRibbonExternal: function() {
        return this.ribbonClientID != "";
    },
    isSheetSelectorExist: function() {
        return !!this.getTabControl();
    },
    
    // Selection
    setSelection: function(leftColIndex, topRowIndex, rightColIndex, bottomRowIndex) {
        this.getSelectionHelper().setSelectionCells(leftColIndex, topRowIndex, rightColIndex, bottomRowIndex);
    },
    onSelectionChanged: function() {
        var selection = this.getStateController().getSelection();

        this.updateViewElementsOnSelectionChanged(selection);

        if(this.isActiveCellChanged(selection.activeCellColIndex, selection.activeCellRowIndex))
            this.onActiveCellChanged(selection);

        if (this.updateFillGroup || (selection.range.bottomRowIndex + selection.range.topRowIndex == 0) || (selection.range.leftColIndex + selection.range.rightColIndex == 0))
            this.onRibbonFillItemsNeedToUpdate(selection);
        else
            this.updateFillGroup = false;

        this.updateRibbonStateForLockedCells();

        this.ribbonStateUpdate("onSelectionChanged");
    },
    updateViewElementsOnSelectionChanged: function(selection) {
        var selectedColIndex = -1,
            selectedRowIndex = -1;
        if(this.isCellSelection(selection)) {
            if(this.modelBoxSelection)
                this.ribbonStateUpdate("onModelBoxUnselecting");
            this.modelBoxSelection = false;

            this.getPaneManager().highlightHeaders(selection);
            selectedColIndex = selection.activeCellColIndex;
            selectedRowIndex = selection.activeCellRowIndex;
        } else {
            if(!this.modelBoxSelection)
                this.ribbonStateUpdate("onModelBoxSelecting");
            this.modelBoxSelection = true;
        }
        this.getValidationHelper().showValidationElements(selectedColIndex, selectedRowIndex);
    },
    updateRibbonStateForLockedCells: function() {
        var activeCellLocked = ASPxClientSpreadsheet.ProtectionHelper.isActiveCellLocked(this);
        if(this.activeCellLocked !== activeCellLocked) {
            this.ribbonStateUpdate("onCellLockedStateChanged");
            this.activeCellLocked = activeCellLocked;
        }
    },
    onActiveCellChanged: function(selection) {
        this.updateActiveCell(selection.activeCellColIndex, selection.activeCellRowIndex);
        this.updateCellTextViewElementValue();
        this.notifyDialogActiveCellSelectionChanged(selection);
        this.ribbonStateUpdate("onActiveCellChanged");
    },
    isCellSelection: function(selection) {
        if(!selection)
            selection = this.getStateController().getSelection();
        return !(selection.isCommentBoxSelected() || selection.isDrawingBoxSelection());
    },
    isActiveCellChanged: function(colIndex, rowIndex) {
        return this.currentActiveCell.col != colIndex || this.currentActiveCell.row != rowIndex;
    },
    updateActiveCell: function(colIndex, rowIndex) {
        this.currentActiveCell.col = colIndex;
        this.currentActiveCell.row = rowIndex;  
    },
    getSelectionActiveCellLayoutInfoInternal: function() {
        var selection = this.getSelectionInternal();
        return this.getPaneManager().getCellLayoutInfo(selection.activeCellColIndex, selection.activeCellRowIndex);
    },
    isActiveCellVisible: function() {
        var activeCellLayoutInfo = this.getSelectionActiveCellLayoutInfoInternal();
        if(activeCellLayoutInfo === undefined) return false;
        var visibility = this.getPaneManager().getScrollHelper().getElementVisibleInfo(activeCellLayoutInfo.rect, activeCellLayoutInfo);
        return !visibility.fullInvisible;
    },
    onCellselected: function(stateController) {
        this.selectedCellStateController = stateController;
    },
    onCellValueChangedWithNewSelection: function(cellPosition, newValue, sheetId) {
        this.cellUpdateCore(cellPosition, newValue, true, sheetId);
    },
    onCellValueChanged: function(cellPosition, newValue) {
        this.cellUpdateCore(cellPosition, newValue, false);
    },
    cellUpdateCore: function(cellPosition, newValue, reselectAfterCommand, sheetId){
        newValue = this.prepareCellValueForCore(newValue); // TODO Remove when core could take only "\n" separator

        this.onUICommand(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("UpdateCell").id,
            {
                colIndex: cellPosition.Column,
                rowIndex: cellPosition.Row, 
                NewValue: ASPx.Str.EncodeHtml(newValue),
                ReselectAfterCommand: reselectAfterCommand,
                formulaSheetOwner: sheetId
            }
        );
    },
    prepareCellValueForCore: function(value) {
        return value.replace(/\n/g, "\r\n");
    },
    getSelectionInternal: function(){
        var stateController = this.getStateController();
        return stateController.getSelection();
    },
    getModelExpandedSelectionInternal: function(){
        var internalSelection = this.getSelectionInternal(),
            paneManager = this.getPaneManager(),
            internalSelectionWithModelIndices = internalSelection.getConvertedToModelIndices(paneManager);

        internalSelectionWithModelIndices.expandToAllSheetIfRequired(paneManager);

        return internalSelectionWithModelIndices;
    },
    /*# public ASPxClientSpreadsheetSelection GetSelection(){ return null; } #*/
    GetSelection: function() {
        return this.getClientSelection();
    },
    getClientSelection: function(internalSelection) {
        internalSelection = internalSelection || this.getSelectionInternal();
        return this.convertInternalSelectionToClientSelection(internalSelection);
    },
    convertInternalSelectionToClientSelection: function(internalSelection) {
        var paneManager = this.getPaneManager();

        var internalSelectionWithModelIndices = internalSelection.getConvertedToModelIndices(paneManager);
        internalSelectionWithModelIndices.expandToAllSheetIfRequired(paneManager);

        return new ASPxClientSpreadsheet.ASPxClientSpreadsheetSelection(
            internalSelectionWithModelIndices.activeCellColIndex,
            internalSelectionWithModelIndices.activeCellRowIndex,

            internalSelectionWithModelIndices.range.leftColIndex,
            internalSelectionWithModelIndices.range.topRowIndex,
            internalSelectionWithModelIndices.range.rightColIndex,
            internalSelectionWithModelIndices.range.bottomRowIndex
        );
    },
    DoRaiseSelectionChanged: function(internalSelection) {
        var clientSelection = this.getClientSelection(internalSelection);
        this.RaiseSelectionChanged(clientSelection);
    },
    RaiseSelectionChanged: function(clientSelection) {
        if(!this.SelectionChanged.IsEmpty()){
            var args = new ASPxClientSpreadsheetSelectionChangedEventArgs(clientSelection);
            this.SelectionChanged.FireEvent(this, args);
        }
    },
    getCellValueByVisiblePosition_Internal: function(colVisibleIndex, rowVisibleIndex) {
        var paneManager = this.getPaneManager();
        var colModelIndex = paneManager.convertVisibleIndexToModelIndex(colVisibleIndex, true);
        var rowModelIndex = paneManager.convertVisibleIndexToModelIndex(rowVisibleIndex, false);
        return this.GetCellValue(colModelIndex, rowModelIndex);
    },
    prepareLayoutViewElements: function(response) {
        this.setGridLinesVisibility(!response.gridLinesHidden);
        this.setHeadingsVisibility(!response.hideHeaders);
    },
    setGridLinesVisibility: function(visible) {
        var mainSheetDiv = this.getRenderHelper().getWorkbookControl();
        if (mainSheetDiv) {
            var method = visible ? ASPx.RemoveClassNameFromElement : ASPx.AddClassNameToElement;
            method(mainSheetDiv, SpreadsheetCssClasses.GridLineHidden);
        }
        this.gridLinesVisible = visible;
    },
    getGridLinesVisibility: function() {
        return this.gridLinesVisible;
    },
    setHeadingsVisibility: function(visible) {
        var workbook = this.getRenderHelper().getWorkbookControl();
        if(workbook) {
            var method = visible ? ASPx.RemoveClassNameFromElement : ASPx.AddClassNameToElement;
            method(workbook, SpreadsheetCssClasses.HeadingsHidden);
        }
    },
    getGridLineSize: function() {
        return this.getGridLinesVisibility() ? 1 : 0; // TODO calculate actual value
    },

    // Scrolling and navigation
    changeSelectionAccordingToKeyboardAction: function(method) {
        var stateController = this.getStateController();
        var selectionHelper = this.getSelectionHelper();

        var selection = stateController.getSelection().clone();
        
        selectionHelper.calcActualCellSelection(selection);
        if(!selection.isDrawingBoxSelection()) {
            var changedSelection = ASPxClientSpreadsheet.SelectionKeyboardUtils[method](selection, selectionHelper),
                cellScrollVisible = this.getPaneManager().navigateTo(stateController, changedSelection, method);
            if(cellScrollVisible)
                stateController.setSelection(changedSelection);
        }
    },
    navigateToCell: function(colModelIndex, rowModelIndex, onNavigated) {
        var panelManager = this.getPaneManager();
        this.asyncTracker.track(function() {
                panelManager.navigateToCell(colModelIndex, rowModelIndex);
            },
            onNavigated
        );
    },
    navigateToBookmark: function(bookmark) {
        this.getPaneManager().navigateToBookmark(bookmark);
    },
    scrollToViaServer: function(colModelIndex, rowModelIndex, selectAfterScroll) {
        var tileHelper = this.getPaneManager().getTileHelper(),
            eodCol = tileHelper.getEndOfDocumentCellInfo(true),
            eodRow = tileHelper.getEndOfDocumentCellInfo(false),
            cellOutideDocBoundary = !!eodCol && colModelIndex > eodCol.modelIndex || !!eodRow && rowModelIndex > eodRow.modelIndex || rowModelIndex === -1 || colModelIndex === -1;

        if(!cellOutideDocBoundary)
            if(!this.isControllLockedToScrollingContentViaServer()) {
                this.lockScrollingContentRequests();
                ASPxClientSpreadsheet.ServerCommands.ScrollTo(this, { CellPositionColumn: colModelIndex, CellPositionRow: rowModelIndex, SelectAfterScroll: !!selectAfterScroll });
            }
    },
    OnScrollToCommandResultProcessing: function(scrollToCommandResult) {
        this.defaultProcessResponse(scrollToCommandResult);
        this.releaseScrollingContentRequests();
        if(this.afterScrollingComplete) {
            this.afterScrollingComplete();
            this.afterScrollingComplete = null;
        }
    },
    isControllLockedToScrollingContentViaServer: function() {
        return this.scrollToCellOnServer;
    },
    lockScrollingContentRequests: function() {
        this.scrollToCellOnServer = true;
    },
    releaseScrollingContentRequests: function() {
        this.scrollToCellOnServer = false;
    },
    onHyperLinkClicked: function(evt, element) {
        var handled = this.RaiseHyperlinkClick(evt, element);

        if(!handled) {
            var url = ASPx.Attr.GetAttribute(element, "_loc"),
                hyperlinkType = this.getLinkType(element);
            if(!ASPx.IsUrlContainsClientScript(url)) {                
                if(hyperlinkType === ASPxClientOfficeDocumentLinkType.Bookmark)
                    this.navigateToBookmark(url);
                else
                    ASPx.Url.Navigate(url, "_blank");
            }
        }
        return true;
    },
    RaiseHyperlinkClick: function(evt, element) {
        var handled = false;
            
        if(!this.HyperlinkClick.IsEmpty()){
            var url = ASPx.Attr.GetAttribute(element, "_loc"),
                hyperlinkType = this.getLinkType(element);

            var args = new ASPxClientSpreadsheetHyperlinkClickEventArgs(evt, handled, url, hyperlinkType);
            this.HyperlinkClick.FireEvent(this, args);
            handled = args.handled;
        }
        return handled;
    },
    getLinkType: function(element) {
        var url = ASPx.Attr.GetAttribute(element, "_loc"),
            isBookmark = ASPx.Attr.GetAttribute(element, "bm"),
            mail = /\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/,
            hyperlink = /((https?:|ftps?:)\/\/[^\s]+)/g,
            isLink = hyperlink.test(url),
            isEmail = mail.test(url);
        if(isBookmark)
            return ASPxClientOfficeDocumentLinkType.Bookmark;
        if(isEmail)
            return ASPxClientOfficeDocumentLinkType.EmailAddress;
        if(isLink)
            return ASPxClientOfficeDocumentLinkType.Hyperlink;
        return ASPxClientOfficeDocumentLinkType.Document;
    },

    // Find
    findAllFromDialog: function(dialogInstance, findWhat, matchCase, matchEntireCellContent, searchBy, lookIn) {
        this.findAllDialogInstance = dialogInstance;
        this.findAll(findWhat, matchCase, matchEntireCellContent, searchBy, lookIn);
    },
    findAll: function(findWhat, matchCase, matchEntireCellContent, searchBy, lookIn) {
        ASPxClientSpreadsheet.ServerCommands.FindAll(this, 
            {
                FindWhat:   findWhat,
                MatchCase:  !!matchCase,
                MatchEntireCellContent: !!matchEntireCellContent,
                SearchBy:   searchBy || "",
                LookIn:     lookIn || ""
            });
    },
    OnFindAllCommandResultProcessing: function(findAllCommandResponse) {
        if(findAllCommandResponse.FindAllResult) {
            if(this.findAllDialogInstance) {
                this.findAllDialogInstance.OnSearchResultsReceived(findAllCommandResponse.FindAllResult.findAllList, findAllCommandResponse.FindAllResult.findNextCellModelPosition);
                this.findAllDialogInstance = null;
            } //else
            //window.fakeOnFindAllCommandResultProcessing(findAllCommandResponse.FindAllResult);
        }
    },

    // Cell Format Dialog - Number format
    fetchFormatCellsViewModelFromDialog: function(dialogInstance) {
        this.formatCellsDialogInstance = dialogInstance;
        ASPxClientSpreadsheet.ServerCommands.FetchFormatCellsViewModel(this, {});
    },
    OnFormatCellsViewModelReceived: function(response) {
        if(response.formatCellsViewModel && this.formatCellsDialogInstance)
            this.formatCellsDialogInstance.OnViewModelReceived(response.formatCellsViewModel);
        if(!this.formatCellsDialogInstance || !this.formatCellsDialogInstance.hasPendingRequests)
            this.formatCellsDialogInstance = null;
    },
    getNumberFormatSample: function(dialogInstance, numberFormatParams) {
        this.formatCellsDialogInstance = dialogInstance;
        ASPxClientSpreadsheet.ServerCommands.FormatCells(this, numberFormatParams);
    },
    OnNumberFormatSampleReceived: function(response) {
        if(response.samples && this.formatCellsDialogInstance)
            this.formatCellsDialogInstance.OnNumberFormatSampleReceived(response.samples);
        this.formatCellsDialogInstance = null;
    },

    fetchAutoFilterViewModelFromDialog: function(dialogInstance) {
        this.autoFilterDialogInstance = dialogInstance;
        ASPxClientSpreadsheet.ServerCommands.FetchAutoFilterViewModel(this,
            {
                filterCommandId: dialogInstance.commandId
            });
    },
    OnAutoFilterViewModelReceived: function(response) {
        if(response.autoFilterViewModel && this.autoFilterDialogInstance)
            this.autoFilterDialogInstance.OnViewModelReceived(response.autoFilterViewModel);
        this.autoFilterDialogInstance = null;
    },

    fetchPageSetupViewModelFromDialog: function(dialogInstance) {
        this.pageSetupDialogInstance = dialogInstance;
        ASPxClientSpreadsheet.ServerCommands.FetchPageSetupViewModel(this, {});
    },
    OnPageSetupViewModelReceived: function(response) {
        if(response.pageSetupViewModel && this.pageSetupDialogInstance)
            this.pageSetupDialogInstance.OnViewModelReceived(response.pageSetupViewModel);
        this.pageSetupDialogInstance = null;
    },

    fetchHeaderFooterViewModelFromDialog: function(dialogInstance, headerFooterSettings) {
        this.headerFooterDialogInstance = dialogInstance;
        ASPxClientSpreadsheet.ServerCommands.FetchHeaderFooterViewModel(this, { HeaderFooterSettings: headerFooterSettings });
    },
    OnHeaderFooterViewModelReceived: function(response) {
        if(response.headerFooterViewModel && this.headerFooterDialogInstance)
            this.headerFooterDialogInstance.OnViewModelReceived(response.headerFooterViewModel);
        this.headerFooterDialogInstance = null;
    },

    fetchDataValidationViewModelFromDialog: function(dialogInstance) {
        this.dataValidationDialogInstance = dialogInstance;
        ASPxClientSpreadsheet.ServerCommands.FetchDataValidationViewModel(this, {});
    },
    OnDataValidationViewModelReceived: function(response) {
        if(response.ViewModel && this.dataValidationDialogInstance)
            this.dataValidationDialogInstance.GetDialogHelper().onViewModelReceived(response.ViewModel);
        this.dataValidationDialogInstance = null;
    },
    fetchListAllowedValues: function() {
        ASPxClientSpreadsheet.ServerCommands.FetchListAllowedValues(this, {});
    },
    fetchMessageForCell: function() {
        ASPxClientSpreadsheet.ServerCommands.FetchMessageForCell(this, {});
    },
    OnListAllowedValuesReceived: function(response) {
        this.getValidationHelper().onAllowedValuesReceived(response);
    },
    OnMessageForCellReceived: function(response) {
        this.getValidationHelper().onMessageForCellReceived(response);
    },
    
    onCellRangeCommand: function(commandName, targetModelRange) {
        var sourceModelRange = this.getSelectionInternal().getConvertedToModelIndices(this.getPaneManager()).range.clone();
        if(sourceModelRange.equals(targetModelRange)) return;
        var allowed = !this.rangeIsLocked(this.isSheetLocked(), sourceModelRange) && !this.rangeIsLocked(this.isSheetLocked(), targetModelRange);
        if(allowed) {
            var command = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName(commandName);
            var arg = { Target: ASPx.Json.ToJson([targetModelRange.leftColIndex, targetModelRange.topRowIndex, targetModelRange.rightColIndex, targetModelRange.bottomRowIndex]) };
            this.onServerCommand(command.id, arg);
        } else 
            this.showProtectedSheetWarningMessage();
    },
    OnMoveRange: function(targetModelRange) {
        this.onCellRangeCommand("MoveRange", targetModelRange);
    },
    OnMoveFillHandle: function(targetModelRange) {
        this.onCellRangeCommand("RangeResize", targetModelRange);
    },
    rangeIsLocked: function(sheetLocked, range) {
        if (!sheetLocked) return false;

        return range.any(function(i, j) {
            return ASPxClientSpreadsheet.ProtectionHelper.isCellLocked(this, i, j);
        }.aspxBind(this));
    },

    RaiseDocumentChanged: function() {
        if(!this.DocumentChanged.IsEmpty()){
            var args = new ASPxClientSpreadsheetDocumentChangedEventArgs();
            this.DocumentChanged.FireEvent(this, args);
        }
    },
    RaiseBeginSynchronization: function() {
        if(!this.BeginSynchronization.IsEmpty()){
            var args = new ASPxClientSpreadsheetSynchronizationEventArgs();
            this.BeginSynchronization.FireEvent(this, args);
        }
    },
    RaiseEndSynchronization: function() {
        if(!this.EndSynchronization.IsEmpty()){
            var args = new ASPxClientSpreadsheetSynchronizationEventArgs();
            this.EndSynchronization.FireEvent(this, args);
        }
    },
    //TODO to aZhuravlev public it ??
    DownloadCopy: function(fileFormat, target) {
        this.onUICommand(ASPxClientSpreadsheet.ServerCommands.internalCommands.DownLoadCopy.id, { FileFormat: fileFormat, Target: target });
    },
    /*# public void Print(string target) {} #*/
    Print: function(target) {
        this.onUICommand(ASPxClientSpreadsheet.ServerCommands.internalCommands.Print.id, { Target: target });
    },
    /*# public bool HasUnsavedChanges() { return false; } #*/
    HasUnsavedChanges: function() {
        return this.getModified();
    },
    /*# public object GetCellValue(int colModelIndex, int rowModelIndex) { return null; } #*/
    GetCellValue: function(colModelIndex, rowModelIndex){
        return this.getPaneManager().getCellValue(colModelIndex, rowModelIndex);
    },
    
    /*# public ASPxClientSpreadsheetRectangle GetCellBounds(int colModelIndex, int rowModelIndex) { return null; } #*/
    GetCellBounds: function (colModelIndex, rowModelIndex) {
        var cellLayoutInfo = this.getPaneManager().getCellLayoutInfo(colModelIndex, rowModelIndex);
        if(cellLayoutInfo) {
            var tilePositionX = ASPx.GetAbsoluteX(cellLayoutInfo.tileInfo.htmlElement),
                tilePositionY = ASPx.GetAbsoluteY(cellLayoutInfo.tileInfo.htmlElement);
            return new ASPxClientSpreadsheet.DocumentModel.Rectangle(tilePositionX + cellLayoutInfo.rect.x,
                tilePositionY + cellLayoutInfo.rect.y,
                cellLayoutInfo.rect.width + ASPxClientSpreadsheet.SelectionHelper.BorderCorrectionFactor,
                cellLayoutInfo.rect.height + ASPxClientSpreadsheet.SelectionHelper.BorderCorrectionFactor);
        }
        return null;
    },
    SetCellValue: function(colModelIndex, rowModelIndex, value) {
        this.cellUpdateCore({ Column: colModelIndex, Row: rowModelIndex }, value, false);
    },
    getCellTextValue: function(colModelIndex, rowModelIndex) {
        var value = this.GetCellValue(colModelIndex, rowModelIndex);
        return value ? value : "";
    },
    getCellValueInfo: function(colModelIndex, rowModelIndex) {
        var cellValue = this.getPaneManager().getCellEditingText(colModelIndex, rowModelIndex) || "",
            cellValueInfo = { value: "", formula: "" };

        if(cellValue.indexOf("=") === 0) {
            cellValueInfo.formula = cellValue;
            cellValueInfo.value = this.getCellTextValue(colModelIndex, rowModelIndex);
        } else {
            cellValueInfo.value = cellValue;
        }

        return cellValueInfo;
    },
    /*# public object GetCellComment(int colModelIndex, int rowModelIndex) { return null; } #*/
    GetCellComment: function(colModelIndex, rowModelIndex) {
        return this.getPaneManager().getCellComment(colModelIndex, rowModelIndex);
    },
    /*# public object GetActiveCellValue() { return null; } #*/
    GetActiveCellValue: function(){
        var paneManager = this.getPaneManager(),
            selectionInternal = this.getSelectionInternal(),
            internalSelectionWithModelIndices = selectionInternal.getConvertedToModelIndices(paneManager);

        return this.GetCellValue(internalSelectionWithModelIndices.activeCellColIndex, internalSelectionWithModelIndices.activeCellRowIndex);
    },
    /*# public void PerformCallback(string parameter) {} #*/
    /*# public void PerformCallback(string parameter, Action<string> onSuccess) {} #*/
    PerformCallback: function (parameter, onSuccess) {
        this.performCallbackCore(parameter, ASPxClientSpreadsheet.CallbackPrefixes.PerformCallbackPrefix, onSuccess);
    },
    /*# [Obsolete("Use the PerformCallback method instead.")]public void PerformDocumentCallback(string parameter) {} #*/
    PerformDocumentCallback: function(parameter) {
        this.PerformCallback(parameter);
    },
    performCallbackCore: function(parameter, argumentPrefix, handler) {
        this.finishEditingSilently();
        parameter = ASPx.IsExists(parameter) ? parameter.toString() : "";
        var formatArg = this.formatCallbackArg(argumentPrefix, parameter);
        this.CreateCallback(formatArg, null, handler);
    },
    CreateCallback: function(arg, command, handler) {
        if(!this.hideLoadingPanel)
            this.ShowLoadingElements();
        this.SpecifyCallbackWithWorkSessionID();
        ASPxClientControl.prototype.CreateCallback.call(this, arg, command, handler);
    },
    formatCallbackArg: function(prefix, arg) { // TODO REFACTOR with ASPxGridView, replace to Callback.js
        arg = arg.toString();
        return (ASPx.IsExists(arg) ? prefix + "|" + arg.length + ';' + arg + ';' : "");
    },
    SpecifyCallbackWithWorkSessionID: function() {
        ASPx.OfficeWorkSessionIDInputHelper.SetValue(this.getSessionGuid());
    },
    /*# public void ReconnectToExternalRibbon() { } #*/
    ReconnectToExternalRibbon: function() {
        if (this.isRibbonExternal()) {
            this.detachEventsFromRibbon();
            this.attachEventsToRibbon();
            this.applyViewModeToRibbon(this.GetViewMode());
            this.ribbonStateUpdate("onActiveCellChanged");
        }
    },
    OnDispose: function() {
        if(this.isRibbonExternal())
            this.detachEventsFromRibbon();
        this.getStateWatcherHelper().deactivate();
        ASPxClientControl.prototype.OnDispose.call(this);
    }
});

/*# public static new ASPxClientSpreadsheet Cast(object obj){ return null; } #*/
ASPxClientSpreadsheet.Cast = ASPxClientControl.Cast;

ASPxClientSpreadsheet.ChildControlIdPostfixes = {
    inputTargetElement: "_IT",
    ribbonControl: "SSRC",
    popupMenu: "SSPUM",
    autoFilterPopupMenu: "SSAFPM",
    dialogPopupControl: "SSDC",
    tabControl: "SSTC",
    workbookPostfix: "WBC",
    columnHeaderDivPostfix: "ColumnHeader",
    rowHeaderDivPostfix: "RowHeader",
    gridContainerDivPostfix: "Grid",
    scrollContainerDivPostfix: "ScrollContainer",
    scrollContentDivPostfix: "ScrollContent",
    supportFrame: "_DXSpreadsheetSupporter",
    formulaBar: "SSFB",
    formulaBarTextBox: "SSFBTB",
    formulaBarMenu: "SSFBM",
    functionsListBox: "SSFLB",
    frozenPanePostfix: "FP",
    bottomLeftPanePostfix: "BL",
    topRightPanePostfix: "TR",
    resizeGrip: "RG",
    floatingActionPanel: "FAP",
    selectSheetButton: "SSB"
};

ASPxClientSpreadsheet.CallbackPrefixes = {
    DocumentUpdateCallbackPrefix: "SSDU",

    PerformCallbackPrefix: "SSPC",
    DocumentCallbackPrefix: "SSDC",
    
    InternalCallBackPostfix: "%Spread%Sheet",
    FileManagerCallbackPrefix: "SSFM",

    OpenFileCallbackPrefix : "SSOF",
    SaveFileCallbackPrefix : "SSSF",
    NewFileCallbackPrefix  : "SSNF",

    SaveImageCallbackPrefix : "SSITS",
    SaveImageSuccessCallbackPrefix : "ISU",
    SaveImageErrorCallbackPrefix: "ISE",

    ChangeViewModeCallbackPrefix: "SSCVM"
};

ASPxClientSpreadsheet.Constants = {
    RibbonHeightInRows: 7,
    FormulaBarMenuEnterItemName: "Enter",
    FormulaBarMenuCancelItemName: "Cancel"
};

ASPxClientSpreadsheet.StateKeys = {
    ViewMode: "viewMode"
};

ASPxClientSpreadsheet.CurrentViewModeSettings = {
    Mode: 0,
    ModeChangedOnCallback: false
};

ASPxClientSpreadsheet.localizedStringHelper = (function(){
    var stringHash = {};
    return { 
        getString: function(stringID) {
            return stringHash[stringID];
        }, 
        setString: function(stringID, value) {
            stringHash[stringID] = value;
        }
    };
})();

ASPx.SSFormulaBarMenuItemClick = function(name, menuItemName) {
    var spreadsheet = ASPx.GetControlCollection().Get(name);

    if(menuItemName === ASPxClientSpreadsheet.Constants.FormulaBarMenuEnterItemName)
        spreadsheet.applyEditingWithEvent();
    if(menuItemName === ASPxClientSpreadsheet.Constants.FormulaBarMenuCancelItemName)
        spreadsheet.getStateController().onEscape();
};

ASPx.SSOnHyperLinkClicked = function(evt, element) {
    var spreadsheet = ASPxClientSpreadsheet.activeSpreadsheetControl;
    if(spreadsheet) 
        return spreadsheet.onHyperLinkClicked(evt, element);
    return true;
};

ASPx.Evt.AttachEventToDocument(ASPx.TouchUIHelper.touchMouseUpEventName, function(e) {
    if(ASPxClientSpreadsheet.activeSpreadsheetControl && ASPxClientSpreadsheet.activeSpreadsheetControl.isSheetLoaded())
        ASPxClientSpreadsheet.activeSpreadsheetControl.onMouseUp(e);

    if(ASPxClientSpreadsheet.activeResizingHelper != null) {
        ASPxClientSpreadsheet.activeResizingHelper.onMouseUp(e);
        return true;
    }
});

if(ASPx.Browser.TouchUI) {
    ASPx.Evt.AttachEventToElement(window, ASPx.Browser.MacOSMobilePlatform ? "orientationchange" : "resize", function(evt) {
        if(ASPxClientSpreadsheet.activeSpreadsheetControl)
            ASPxClientSpreadsheet.activeSpreadsheetControl.getTouchEditingHelper().updateFloatingActionPanelPosition();
    });
    ASPx.Evt.AttachEventToElement(window, "scroll", function(evt) {
        if(ASPxClientSpreadsheet.activeSpreadsheetControl) {
            ASPxClientSpreadsheet.activeSpreadsheetControl.getTouchEditingHelper().updateFloatingActionPanelPosition();
        }
    });
}

ASPx.SpreadsheetCssClasses = SpreadsheetCssClasses;

window.ASPxClientSpreadsheet = ASPxClientSpreadsheet;
window.ASPxClientSpreadsheetCustomCommandExecutedEventArgs = ASPxClientSpreadsheetCustomCommandExecutedEventArgs;

})();

(function() {
    /*# using DevExpress.Web.Scripts; #*/
    /*# namespace DevExpress.Web.ASPxSpreadsheet.Scripts #*/

    ASPxClientSpreadsheet.DocumentModel = (function() {
        var DocumentModel = function() {
            this.visibleSheets = [];
            this.hiddenSheets = [];
            this.activeSheetId = -1;
            this.hasSourceToSave = false;

            this.protectionProperties = new ASPxClientSpreadsheet.DocumentModel.ProtectionProperties();
            this.pivotTables = new ASPxClientSpreadsheet.DocumentModel.PivotTablesCollection();
        };
        DocumentModel.prototype = {
            processDocumentStructure: function(response) {
                var responseTabInfo = response.tabControlInfo;
                this.activeSheetId = response[ASPxClientSpreadsheet.ResponseStringKeys.ActiveSheetId];
                if(responseTabInfo) {                    
                    this.visibleSheets = responseTabInfo.visibleSheets;
                    this.hiddenSheets = responseTabInfo.hiddenSheets;
                }
                
                this.hasSourceToSave = response[ASPxClientSpreadsheet.ResponseStringKeys.HasSourceToSave] === 1;

                if(response.pp)
                    this.getProtectionProperties().processProtectionOptions(response.pp);

                this.getPivotTables().processModelResponse(response[ASPxClientSpreadsheet.ResponseStringKeys.PivotTable]);
            },

            getActiveSheetId: function() {
                return this.activeSheetId;
            },
            setActiveSheetId: function(sheetId) {
                this.activeSheetId = sheetId;
            },
            getActiveSheetName: function(formulaView) {
                var sheetName = this.getSheetNameById(this.getActiveSheetId());
                if(formulaView)
                    sheetName = sheetName.indexOf(' ') >= 0 ? "'" + sheetName + "'" : sheetName;
                return sheetName;
            },

            getSheetIdByVisibleIndex: function(index) {
                var visibleSheets = this.getVisibleSheets();
                if(visibleSheets) {
                    var tab = visibleSheets[index];
                    if(tab) {
                        return tab.Id;
                    }
                }
                return index;
            },
            getSheetNameById: function(sheetId) {
                var visibleSheets = this.getVisibleSheets(),
                    len = visibleSheets.length;

                while(len--) {
                    var tab = visibleSheets[len];
                    if(tab.Id === sheetId)
                        return tab.Name;
                }
                return "";
            },
            getSheetIdByName: function(sheetName) {
                var visibleSheets = this.getVisibleSheets(),
                    len = visibleSheets.length;

                while(len--) {
                    var tab = visibleSheets[len];
                    if(tab.Name === sheetName)
                        return tab.Id;
                }
                return -1;
            },

            getVisibleSheets: function() {
                return this.visibleSheets;
            },
            getHiddenSheets: function() {
                return this.hiddenSheets;
            },

            hasSource: function() {
                return this.hasSourceToSave;
            },
            // Helpers
            getProtectionProperties: function() {
                return this.protectionProperties;
            },
            getPivotTables: function() {
                return this.pivotTables;
            }
        };

        // Private functions

        return DocumentModel;
    })();

    ASPxClientSpreadsheet.DocumentModel.ProtectionProperties = (function() {
        var WorksheetProtectionPermissions = {
            SelectLockedCells: 1,
            SelectUnlockedCells: 2,
            Default: 3,
            FormatCells: 4,
            FormatColumns: 8,
            FormatRows: 16,
            InsertColumns: 32,
            InsertRows: 64,
            InsertHyperlinks: 128,
            DeleteColumns: 256,
            DeleteRows: 512,
            Sort: 1024,
            AutoFilters: 2048,
            PivotTables: 4096,
            Objects: 8192,
            Scenarios: 16384
        };

        var ProtectionProperties = function() {
            this.sheetLocked = false;
            this.options = null;
        };

        ProtectionProperties.prototype = {
            processProtectionOptions: function(protectionOptions) {
                this.clear();
                if(protectionOptions) {
                    this.sheetLocked = protectionOptions.locked;
                    this.options = protectionOptions.options;
                    this.InitializePermissions();
                }
            },
            InitializePermissions: function() {
                this.selectLockedCellsLocked = checkProperty(this.options, WorksheetProtectionPermissions.SelectLockedCells);
                this.selectUnlockedCellsLocked = checkProperty(this.options, WorksheetProtectionPermissions.SelectUnlockedCells);
                this.formatCellsLocked = checkProperty(this.options, WorksheetProtectionPermissions.FormatCells);
                this.formatColumnsLocked = checkProperty(this.options, WorksheetProtectionPermissions.FormatColumns);
                this.formatRowsLocked = checkProperty(this.options, WorksheetProtectionPermissions.FormatRows);
                this.insertColumnsLocked = checkProperty(this.options, WorksheetProtectionPermissions.InsertColumns);
                this.insertRowsLocked = checkProperty(this.options, WorksheetProtectionPermissions.InsertRows);
                this.insertHyperlinksLocked = checkProperty(this.options, WorksheetProtectionPermissions.InsertHyperlinks);
                this.deleteColumnsLocked = checkProperty(this.options, WorksheetProtectionPermissions.DeleteColumns);
                this.deleteRowsLocked = checkProperty(this.options, WorksheetProtectionPermissions.DeleteRows);
                this.sortLocked = checkProperty(this.options, WorksheetProtectionPermissions.Sort);
                this.autoFiltersLocked = checkProperty(this.options, WorksheetProtectionPermissions.AutoFilters);
                this.pivotTablesLocked = checkProperty(this.options, WorksheetProtectionPermissions.PivotTables);
                this.objectsLocked = checkProperty(this.options, WorksheetProtectionPermissions.Objects);
                this.scenariosLocked = checkProperty(this.options, WorksheetProtectionPermissions.Scenarios);
            },
            clear: function() {
                this.sheetLocked = false;
                this.options = null;
                this.selectLockedCellsLocked = false;
                this.selectUnlockedCellsLocked = false;
                this.formatCellsLocked = false;
                this.formatColumnsLocked = false;
                this.formatRowsLocked = false;
                this.insertColumnsLocked = false;
                this.insertRowsLocked = false;
                this.insertHyperlinksLocked = false;
                this.deleteColumnsLocked = false;
                this.deleteRowsLocked = false;
                this.sortLocked = false;
                this.autoFiltersLocked = false;
                this.pivotTablesLocked = false;
                this.objectsLocked = false;
                this.scenariosLocked = false;
            }
        };

        //Private methods
        function checkProperty(options, property) {
            return (options & property) === property;
        }

        return ProtectionProperties;
    })();

    ASPxClientSpreadsheet.DocumentModel.PivotTablesCollection = (function() {
        var pivotTables = [];

        var PivotTablesCollection = function() {
            clear();
        };

        PivotTablesCollection.prototype = {
            processModelResponse: function(pivotTablesInfo) {
                clear();
                if(pivotTablesInfo) {
                    var len = pivotTablesInfo.length;
                    while(len--) {
                        var pivotTableInfo = pivotTablesInfo[len],
                            name = pivotTableInfo[0],
                            ranges = pivotTableInfo[1],
                            valueRange = pivotTableInfo[2],
                            columnFields = pivotTableInfo[4],
                            rowFields = pivotTableInfo[3],
                            reference = pivotTableInfo[5],
                            location = pivotTableInfo[6],
                            properties = pivotTableInfo[7];

                        var pivotTable = new ASPxClientSpreadsheet.DocumentModel.PivotTable(name);
                        if(valueRange)
                            pivotTable.setValueRange(new ASPxClientSpreadsheet.Range(valueRange[0], valueRange[1], valueRange[2], valueRange[3]));
                        if(ranges && ranges.length > 0) {
                            var areasCount = ranges.length;
                            while(areasCount--) {
                                var range = ranges[areasCount];
                                pivotTable.addArea(new ASPxClientSpreadsheet.Range(range[0], range[1], range[2], range[3]));
                            }
                        }
                        pivotTable.setRowFields(rowFields);
                        pivotTable.setColumnFields(columnFields);
                        pivotTable.setReference(reference);
                        pivotTable.setLocation(location);
                        pivotTable.setProperties(properties);
                        pivotTables.push(pivotTable);
                    }
                }
            },
            getItemByName: function(name) {
                var len = pivotTables.length;
                while(len--)
                    if(pivotTables[len].name === name)
                        return pivotTables[len];
                return null;
            },
            getItem: function(index) {
                return pivotTables[index];
            },
            forEach: function(delegate) {
                var len = pivotTables.length;
                for(var i = 0; i < len; i++)
                    delegate(pivotTables[i], arguments[1], arguments[2], arguments[3]);
            },
            getItemByRange: function(modelRange) {
                var len = pivotTables.length;
                while(len--) {
                    var pivotTable = pivotTables[len],
                        areasCount = pivotTable.areasCount();
                    while(areasCount--) {
                        var area = pivotTable.getAreaByIndex(areasCount);
                        if(area.containsRange(modelRange))
                            return pivotTable;
                    }
                }
                return null;
            },

            isCellInPivotTableValueRange: function(modelRange) {
                var result = false,
                    len = pivotTables.length;
                while(len--) {
                    var pivotTable = pivotTables[len];
                    result = result || pivotTable.isCellInValueRange(modelRange);
                    if(result)
                        break;
                }
                return result;
            },
            get length() {
                return pivotTables.length;
            }
        };

        function clear() {
            pivotTables = [];
        }

        return PivotTablesCollection;
    })();

    ASPxClientSpreadsheet.DocumentModel.PivotTable = (function() {
        var PivotTable = function(name) {
            this.name = name;
            this.ranges = [];
            this.value = null;
            this.columns = [];
            this.rows = [];
            this.activeFieldColumnIndex = -1;
            this.activeFieldRowIndex = -1;
            this.reference = "";
            this.location = "";
            this.showHeaders = true;
            this.showRowHeaders = true;
            this.showColumnHeaders = true;
            this.showRowStripes = false;
            this.showColumnStripes = false;
        };
        PivotTable.prototype = {
            get Name() {
                return this.name;
            },
            get Location() {
                return this.location;
            },
            get Reference() {
                return this.reference;
            },
            get ShowHeaders() {
                return this.showHeaders;
            },
            get ShowRowHeaders() {
                return this.showRowHeaders;
            },
            get ShowColumnHeaders() {
                return this.showColumnHeaders;
            },
            get ShowRowStripes() {
                return this.showRowStripes;
            },
            get ShowColumnStripes() {
                return this.showColumnStripes;
            },

            setValueRange: function(range) {
                this.value = range;
            },
            addArea: function(range) {
                this.ranges.push(range);
            },
            areasCount: function() {
                return this.ranges.length;
            },
            getAreaByIndex: function(index) {
                return this.ranges[index];
            },
            equals: function(pivotTable) {
                return !!pivotTable && this.name === pivotTable.name && this.equalRanges(pivotTable);
            },
            equalsByName: function(pivotTable) {
                return !!pivotTable && this.name === pivotTable.name;
            },

            isCellInValueRange: function(modelRange) {
                return this.value && this.value.containsRange(modelRange);
            },
            containsRange: function(range) {
                return this.rangeLogicalOrCore(range, "containsRange");
            },
            intersectsRange: function(range) {
                return this.rangeLogicalOrCore(range, "intersectsRange");
            },

            equalRanges: function(pivotTable) {
                if(this.areasCount() !== pivotTable.areasCount())
                    return false;

                var result = true,
                    len = this.areasCount();
                while(len--) {
                    var area = this.getAreaByIndex(len);
                    result = result && area.equals(pivotTable.getAreaByIndex(len));
                    //optimization
                    if(!result)
                        return false;
                }
                return result;
            },

            rangeLogicalOrCore: function(range, operation) {
                var result = false,
                    len = this.areasCount();
                while(len--) {
                    var area = this.getAreaByIndex(len);
                    result = result || area[operation](range);
                    if(result)
                        return true;
                }
                return result;
            },

            setReference: function(reference) {
                this.reference = reference;
            },
            setLocation: function(location) {
                this.location = location;
            },
            setProperties: function(properties) {
                if(properties && properties.length === 5) {
                    this.showHeaders = properties[0] === 1;
                    this.showRowHeaders = properties[1] === 1;
                    this.showColumnHeaders = properties[2] === 1;
                    this.showRowStripes = properties[3] === 1;
                    this.showColumnStripes = properties[4] === 1;
                }
            },

            // Columns Filter
            setColumnFields: function(columnFields) {
                if(columnFields && columnFields.length > 0) {
                    processFields(this.columns, columnFields);
                    this.activeFieldColumnIndex = this.columns[0].Index;
                }
            },
            getColumnFields: function() {
                return this.columns;
            },
            setActiveFieldColumnIndex: function(index) {
                this.activeFieldColumnIndex = index;
            },
            getActiveFieldColumnIndex: function() {
                return this.activeFieldColumnIndex;
            },
            getActiveColumnName: function() {
                var len = this.columns.length;
                while(len--)
                    if(this.columns[len].Index === this.activeFieldColumnIndex)
                        return this.columns[len].Name;
                return "";
            },

            getField: function(index, isColumn) {
                var fieldList = null;
                if(typeof (isColumn) !== "undefined")
                    fieldList = isColumn ? this.getColumnFields() : this.getRowFields();
                else
                    fieldList = this.getColumnFields().concat(this.getRowFields());

                var len = fieldList.length;
                while(len--)
                    if(fieldList[len].Index === index)
                        return fieldList[len];

                return null;
            },

            // Rows Filter
            setRowFields: function(rowFields) {
                if(rowFields && rowFields.length > 0) {
                    processFields(this.rows, rowFields);
                    this.activeFieldRowIndex = this.rows[0].Index;
                }
            },
            getRowFields: function() {
                return this.rows;
            },
            setActiveFieldRowIndex: function(index) {
                this.activeFieldRowIndex = index;
            },
            getActiveFieldRowIndex: function() {
                return this.activeFieldRowIndex;
            },
            getActiveRowFieldName: function() {
                var len = this.rows.length;
                while(len--)
                    if(this.rows[len].Index === this.activeFieldRowIndex)
                        return this.rows[len].Name;
                return "";
            }
        };

        function processFields(fields, fieldCollection) {
            var len = fieldCollection.length;
            for(var i = 0; i < len; i++)
                fields.push(createField(fieldCollection[i]));
        }
        function createField(fieldInfo) {
            var field = new ASPxClientSpreadsheet.DocumentModel.PivotField(fieldInfo[0], fieldInfo[1], fieldInfo[2], fieldInfo[3], fieldInfo[4], fieldInfo[5]);
            return field;
        }

        return PivotTable;
    })();

    ASPxClientSpreadsheet.DocumentModel.Field = ASPx.CreateClass(null, {
        constructor: function(name, index) {
            this.name = name;
            this.index = index;
        },
        get Name() {
            return this.name;
        },
        get Index() {
            return this.index;
        }
    });

    ASPxClientSpreadsheet.DocumentModel.PivotField = ASPx.CreateClass(ASPxClientSpreadsheet.DocumentModel.Field, {
        constructor: function(name, index, type, sortType, filterType, filterState) {
            this.constructor.prototype.constructor.call(this, name, index);

            this.sortType = typeof (sortType) !== "undefined" ? sortType : ASPxClientSpreadsheet.DocumentModel.SortTypeField.Manual;
            this.filterType = typeof (filterType) !== "undefined" ? filterType : ASPxClientSpreadsheet.DocumentModel.PivotField.FilterState.None;
            this.type = typeof (type) !== "undefined" ? type : 0;
            this.filterState = typeof (filterState) !== "undefined" ? filterState : ASPxClientSpreadsheet.DocumentModel.PivotFilterType.Unknown;
        },

        get SortType() {
            return this.sortType;
        },
        get FilterType() {
            return this.filterType;
        },
        get Type() {
            return this.type;
        },
        get FilterState() {
            return this.filterState;
        },

        get IsMeasureFilterApplied() {
            return (this.filterType & ASPxClientSpreadsheet.DocumentModel.PivotField.FilterState.ValueFilter) === ASPxClientSpreadsheet.DocumentModel.PivotField.FilterState.ValueFilter;
        },
        get IsLabelFilterApplied() {
            return (this.filterType & ASPxClientSpreadsheet.DocumentModel.PivotField.FilterState.LabelFilter) === ASPxClientSpreadsheet.DocumentModel.PivotField.FilterState.LabelFilter;
        },

        get IsSortingAscending() {
            return this.sortTyp === ASPxClientSpreadsheet.DocumentModel.SortTypeField.Ascending;
        },
        get isSortingDescending() {
            return this.sortTyp === ASPxClientSpreadsheet.DocumentModel.SortTypeField.Descending;
        },

        setType: function(type) {
            this.type = type;
        },
        setSortType: function(sortType) {
            this.sortType = sortType;
        },
        setFilterType: function(filterType) {
            this.filterType = filterType;
        }
    });

    ASPxClientSpreadsheet.DocumentModel.CellStyle = (function() {
        function CellStyle(cellStyle) {
            this.cellStyle = cellStyle || {};
            this.Font = new ASPxClientSpreadsheet.DocumentModel.CellStyle.Font(this.cellStyle);
            this.Aligment = new ASPxClientSpreadsheet.DocumentModel.CellStyle.Aligment(this.cellStyle);
        }

        CellStyle.prototype = {
            getDisplay: function() {
                return this.cellStyle.D || ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Display;
            },
            getPadding: function() {
                return this.cellStyle.P || ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Padding.GetCssValue();
            },
            getTextBoxDefaultSize: function(tileHelper) {
                var cellContainerSize = this.getCellContainerDefaultSize(tileHelper);
                return {
                    width: cellContainerSize.width - 2 * ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Padding.DefaultTopBottomPadding,
                    height: cellContainerSize.height
                };
            },
            getCellContainerDefaultSize: function(tileHelper) {
                return {
                    width: tileHelper.getDefaultCellSize().width,
                    height: tileHelper.getDefaultCellSize().height
                };
            }
        };
        return CellStyle;
    })();

    ASPxClientSpreadsheet.DocumentModel.CellStyle.Font = (function() {
        function Font(cellStyle) {
            this.cellStyle = cellStyle || {};
        }
        Font.prototype = {
            getName: function() {
                return this.cellStyle.FN || ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Font.Name;
            },
            getSize: function() {
                return this.cellStyle.FS || ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Font.Size;
            },
            getColor: function() {
                return this.cellStyle.FC || ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Font.Color;
            },
            isBold: function() {
                return this.cellStyle.B === 1;
            },
            isItalic: function() {
                return this.cellStyle.I === 1;
            },
            isStrikethrough: function() {
                return this.cellStyle.S === 1;
            },
            isUnderline: function() {
                return this.cellStyle.U === 1;
            },
            isTextDecorated: function() {
                return this.isStrikethrough() || this.isUnderline();
            }
        };
        return Font;
    })();

    ASPxClientSpreadsheet.DocumentModel.CellStyle.Aligment = (function() {
        function Aligment(cellStyle) {
            this.cellStyle = cellStyle || {};
        }
        Aligment.prototype = {
            getHorizontal: function(isDigital) {
                return this.cellStyle.TA || ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Aligment.GetHorizontalAligment(isDigital);
            },
            getVertiacal: function() {
                return this.cellStyle.VA || ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Aligment.Vertical;
            },
            isTextWrapped: function() {
                return this.cellStyle.W === 1;
            },
            getTextWrapCss: function() {
                return " " + ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Css.WrapText;
            },
            getDefaultCellStyle: function(isDigital) {
                if(isDigital)
                    return " " + ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Css.DigitalCell;
                return " " + ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Css.TextCell;
            }
        };
        return Aligment;
    })();

    ASPxClientSpreadsheet.DocumentModel.CellStyle.Default = {
        Font: {
            Name: "Calibri",
            Size: 11,
            Color: "#000000",
            Bold: false,
            Italic: false,
            Strikethrough: false,
            Underline: false,
            MaxSize: 409
        },
        Aligment: {
            Horizontal: {
                Text: "left",
                Number: "right"
            },
            Vertical: "bottom",
            GetHorizontalAligment: function(isDigital) {
                if(isDigital)
                    return "right";
                return "left";
            },
            TextWrap: false,
            LeftPadding: 2,
            TopPadding: 0
        },
        Fill: {
            Color: ""
        },
        Padding: {
            Top: 0,
            Right: 0,
            Bottom: 0,
            Left: 2,
            DefaultTopBottomPadding: 2,
            GetCssValue: function() { return "0px 0px 0px 2px"; }
        },
        Display: "table-cell",
        Css: {
            DigitalCell: "dxss-ddcs",
            TextCell: "dxss-dcs",
            WrapText: "dxss-wrap"
        },
        Border: {
            Color: "#000000",
            IsVertical: 1,
            LineStyle: 0
        }
    };

    ASPxClientSpreadsheet.DocumentModel.CellPosition = (function() {
        function CellPosition(columnIndex, rowIndex) {
            this.Column = columnIndex;
            this.Row = rowIndex;
        }
        CellPosition.prototype = {
            IsValid: function() {
                return (this.Column >= 0) && (this.Column <= ASPxClientSpreadsheet.Range.MAX_COL_INDEX) &&
                    (this.Row >= 0) && (this.Row <= ASPxClientSpreadsheet.Range.MAX_ROW_INDEX);
            }
        };
        return CellPosition;
    })();

    /*# public enum ASPxClientSpreadsheetPopupMenuType #*/
    ASPxClientSpreadsheetPopupMenuType = {
        /*# ColumnHeading = 0, #*/
        ColumnHeading: 0,
        /*# RowHeading = 1, #*/
        RowHeading: 1,
        SelectAllButton: 2,         //currently not used
        /*# SheetTab = 3, #*/
        SheetTab: 3,
        /*# Picture = 4, #*/
        Picture: 4,
        /*# Chart = 5, #*/
        Chart: 5,
        DrawingObjects: 6,          //currently not used (note: when multyselect chart and picture)
        /*# Cell = 7, #*/
        Cell: 7,
        /*# AutoFilter = 8, #*/
        AutoFilter: 8,
        /*# PivotTable = 9, #*/
        PivotTable: 9,
        /*# PivotTableAutoFilter = 10 #*/
        PivotTableAutoFilter: 10
    };

    /*# public enum ASPxClientSpreadsheetEditMode #*/
    ASPxClientSpreadsheetEditMode = {
        /*# None = 0, #*/
        None: 0,
        /*# Cell = 1, #*/
        Cell: 1,
        /*# Comment = 2, #*/
        Comment: 2
    };

    /*# public enum ASPxClientSpreadsheetViewMode #*/
    ASPxClientSpreadsheetViewMode = {
        /*# Editing = 0, #*/
        Editing: 0,
        /*# Reading = 1, #*/
        Reading: 1
    };

    /*# public class ASPxClientSpreadsheetRectangle : JavaScriptObject #*/
    ASPxClientSpreadsheet.DocumentModel.Rectangle = (function () {
        function Rectangle(x, y, width, height) {
            /*# public int x { get { return 0; } set { } } #*/
            this.x = x;
            /*# public int y    { get { return 0; } set { } } #*/
            this.y = y;
            /*# public int width  { get { return 0; } set { } } #*/
            this.width = width;
            /*# public int height      { get { return 0; } set { } } #*/
            this.height = height;
            /*# public int left { get { return 0; } } #*/
            /*# public int top { get { return 0; } } #*/
            /*# public int bottom { get { return 0; } } #*/
            /*# public int right { get { return 0; } } #*/
        }

        Rectangle.prototype = {
            get left() {
                return this.x;
            },
            get top() {
                return this.y;
            },
            get bottom() {
                return this.height + this.y;
            },
            get right() {
                return this.width + this.x;
            }
        };

        return Rectangle;
    })();
})();
(function() {
    ASPxClientSpreadsheet.RenderHelper = ASPx.CreateClass(null, {
        constructor: function(ownerControl) {
            this.ownerControl = ownerControl;
            this.columnHeaderTile = [];
            this.rowHeaderTile = [];
            this.gridTileContainer = [];
        },
        getOwnerControl: function() {
            return this.ownerControl;
        },
        getPaneManager: function() {
            return this.getOwnerControl().getPaneManager();
        },
        getChildControlsPrefix: function(withOutSeparator) {
            return this.getOwnerControl().name + (withOutSeparator ? "" : "_");
        },

        // Model params
        getVisibleRangePaddings: function() {
            return this.getOwnerControl().getVisibleRangePaddings();
        },
        getTileSize: function() {
            return this.getOwnerControl().getTileSize();
        },
        getDefaultCellSize: function() {
            return this.getOwnerControl().getDefaultCellSize();
        },
        adjustFreezePanes: function() {
            var columnHeader = this.getColumnHeader(),
                rowHeader = this.getRowHeader(),
                gridContainer = this.getGridContainer(),
                scrollContainer = this.getScrollContainer(),
                selectSheetButton = this.getSelectSheetButton(),
                frozenParams = this.getPaneManager().getFrozenPaneSettings();

            var paneType = ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane,
                gridContainer_BL = this.getGridContainer(paneType),
                columnHeader_BL = this.getColumnHeader(paneType);

            paneType = ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane;
            var gridContainer_TR = this.getGridContainer(paneType),
                rowHeader_TR = this.getRowHeader(paneType);

            paneType = ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane;
            var gridContainer_FP = this.getGridContainer(paneType);

            var frozenColumn = !!gridContainer_BL,
                frozenRow = !!gridContainer_TR;

            var gridLeft = ASPx.PxToInt(gridContainer.style.left);
            var gridTop = ASPx.PxToInt(gridContainer.style.top);

            var columnHeaderLeft = ASPx.PxToInt(columnHeader.style.left);
            var rowHeaderTop = ASPx.PxToInt(rowHeader.style.top);

            var headerOffset = this.getPaneManager().getHeaderOffsetSize();

            var offsetWidth = headerOffset.width;
            var offsetHeight = headerOffset.height;

            var headerSizeChanged = columnHeaderLeft !== offsetWidth || rowHeaderTop !== offsetHeight || gridLeft !== offsetWidth || gridTop !== offsetHeight;
            var scrollContainerChanged = scrollContainer.offsetHeight != scrollContainer.parentNode.offsetHeight || scrollContainer.offsetWidth != scrollContainer.parentNode.offsetWidth;
            if(headerSizeChanged || scrollContainerChanged) {
                var workbook = this.getWorkbookControl();
                if(workbook.style.height != "") {
                    var actualHeight = this.getOwnerControl().getMainElementHeightByServerValue();
                    if(actualHeight > 0)
                        workbook.style.height = actualHeight + "px";
                }

                var scrollSize = ASPx.GetVerticalScrollBarWidth(),
                    width = workbook.offsetWidth,
                    height = workbook.offsetHeight,
                    leftRightBorderPaddingsSize = ASPx.GetLeftRightBordersAndPaddingsSummaryValue(workbook),
                    residualWidth = width - offsetWidth - scrollSize,
                    residualHeight = height - offsetHeight - scrollSize;

                var fpWidth = -1,
                    fpHeight = -1;
                if(frozenColumn) {
                    fpWidth = frozenParams.width > residualWidth ? residualWidth : frozenParams.width;
                    residualWidth -= fpWidth + leftRightBorderPaddingsSize;

                    ASPx.SetStyles(columnHeader_BL, {
                        left: this.correctSizeValue(offsetWidth) - 1,
                        top: 0,
                        width: this.correctSizeValue(fpWidth),
                        height: this.correctSizeValue(offsetHeight - 1)
                    });
                    ASPx.SetStyles(gridContainer_BL, {
                        left: this.correctSizeValue(offsetWidth),
                        top: this.correctSizeValue(offsetHeight) + frozenParams.height,
                        width: this.correctSizeValue(fpWidth),
                        height: this.correctSizeValue(height - offsetHeight - scrollSize - frozenParams.height)
                    });
                    this.setupHeaderVisibility(columnHeader_BL, offsetHeight <= 1);
                }

                if(frozenRow) {
                    fpHeight = frozenParams.height > residualHeight ? residualHeight : frozenParams.height;
                    residualHeight -= fpHeight;

                    ASPx.SetStyles(gridContainer_TR, {
                        left: this.correctSizeValue(offsetWidth) + frozenParams.width,
                        top: this.correctSizeValue(offsetHeight),
                        width: this.correctSizeValue(width - offsetWidth - scrollSize - leftRightBorderPaddingsSize - frozenParams.width),
                        height: this.correctSizeValue(fpHeight)
                    });
                    ASPx.SetStyles(rowHeader_TR, {
                        left: 0,
                        top: this.correctSizeValue(offsetHeight) - 1,
                        width: this.correctSizeValue(offsetWidth - 1),
                        height: this.correctSizeValue(fpHeight)
                    });

                    this.setupHeaderVisibility(rowHeader_TR, offsetWidth <= 1);
                }

                if(frozenColumn && frozenRow) {
                    ASPx.SetStyles(gridContainer_FP, {
                        left: this.correctSizeValue(offsetWidth),
                        top: this.correctSizeValue(offsetHeight),
                        width: this.correctSizeValue(fpWidth),
                        height: this.correctSizeValue(fpHeight)
                    });
                }

                ASPx.SetStyles(columnHeader, {
                    left: this.correctSizeValue(offsetWidth + frozenParams.width) - 1,
                    top: 0,
                    width: this.correctSizeValue(residualWidth),
                    height: this.correctSizeValue(offsetHeight - 1)
                });

                ASPx.SetStyles(rowHeader, {
                    left: 0,
                    top: this.correctSizeValue(offsetHeight + frozenParams.height) - 1,
                    width: this.correctSizeValue(offsetWidth - 1),
                    height: this.correctSizeValue(residualHeight)
                });

                ASPx.SetStyles(gridContainer, {
                    left: this.correctSizeValue(offsetWidth + frozenParams.width),
                    top: this.correctSizeValue(offsetHeight + frozenParams.height),
                    width: this.correctSizeValue(residualWidth),
                    height: this.correctSizeValue(residualHeight)
                });

                ASPx.SetStyles(scrollContainer, {
                    width: this.correctSizeValue(width - offsetWidth - leftRightBorderPaddingsSize) + this.correctSizeValue(offsetWidth),
                    height: this.correctSizeValue(height - offsetHeight - ASPx.GetTopBottomBordersAndPaddingsSummaryValue(workbook)) + this.correctSizeValue(offsetHeight)
                });

                ASPx.SetStyles(selectSheetButton, {
                    width: this.correctSizeValue(offsetWidth - 1),
                    height: this.correctSizeValue(offsetHeight - 1)
                });

                this.setupHeaderVisibility(columnHeader, offsetHeight <= 1);
                this.setupHeaderVisibility(rowHeader, offsetWidth <= 1);

                this.showFreezeBorders(frozenParams);
            }
        },
        adjustControl: function() {
            var columnHeader = this.getColumnHeader(),
                rowHeader = this.getRowHeader(),
                gridContainer = this.getGridContainer(),
                scrollContainer = this.getScrollContainer(),
                selectSheetButton = this.getSelectSheetButton();

            var gridLeft = ASPx.PxToInt(gridContainer.style.left);
            var gridTop = ASPx.PxToInt(gridContainer.style.top);
            var columnHeaderLeft = ASPx.PxToInt(columnHeader.style.left);
            var rowHeaderTop = ASPx.PxToInt(rowHeader.style.top);

            var headerOffset = this.getPaneManager().getHeaderOffsetSize();

            var offsetWidth = headerOffset.width;
            var offsetHeight = headerOffset.height;

            var headerSizeChanged = columnHeaderLeft !== offsetWidth || rowHeaderTop !== offsetHeight || gridLeft !== offsetWidth || gridTop !== offsetHeight;
            var scrollContainerChanged = scrollContainer.offsetHeight != scrollContainer.parentNode.offsetHeight || scrollContainer.offsetWidth != scrollContainer.parentNode.offsetWidth;
            if(headerSizeChanged || scrollContainerChanged) {
                var mainElement = this.getWorkbookControl();
                if(mainElement.style.height != "") {
                    var actualHeight = this.getOwnerControl().getMainElementHeightByServerValue();
                    if(actualHeight > 0)
                        mainElement.style.height = actualHeight + "px";
                }

                var scrollSize = ASPx.GetVerticalScrollBarWidth();
                var width = mainElement.offsetWidth;
                var height = mainElement.offsetHeight;

                ASPx.SetStyles(columnHeader, {
                    left: this.correctSizeValue(offsetWidth) - 1,
                    top: 0,
                    width: this.correctSizeValue(width - offsetWidth - scrollSize - ASPx.GetLeftRightBordersAndPaddingsSummaryValue(mainElement)),
                    height: this.correctSizeValue(offsetHeight - 1)
                });
                ASPx.SetStyles(rowHeader, {
                    left: 0,
                    top: this.correctSizeValue(offsetHeight) - 1,
                    width: this.correctSizeValue(offsetWidth - 1),
                    height: this.correctSizeValue(height - offsetHeight - scrollSize)
                });
                ASPx.SetStyles(gridContainer, {
                    left: this.correctSizeValue(offsetWidth),
                    top: this.correctSizeValue(offsetHeight),
                    width: this.correctSizeValue(width - offsetWidth - scrollSize - ASPx.GetLeftRightBordersAndPaddingsSummaryValue(mainElement)),
                    height: this.correctSizeValue(height - offsetHeight - scrollSize)
                });
                ASPx.SetStyles(scrollContainer, {
                    width: this.correctSizeValue(width - offsetWidth - ASPx.GetLeftRightBordersAndPaddingsSummaryValue(mainElement)) + this.correctSizeValue(offsetWidth),
                    height: this.correctSizeValue(height - offsetHeight - ASPx.GetTopBottomBordersAndPaddingsSummaryValue(mainElement)) + this.correctSizeValue(offsetHeight)
                });
                ASPx.SetStyles(selectSheetButton, {
                    width: this.correctSizeValue(offsetWidth - 1),
                    height: this.correctSizeValue(offsetHeight - 1)
                });

                this.setupHeaderVisibility(columnHeader, offsetHeight <= 1);
                this.setupHeaderVisibility(rowHeader, offsetWidth <= 1);
            }
        },

        setupHeaderVisibility: function(headerContainer, isHidden) {
            var method = isHidden ? "AddClassNameToElement" : "RemoveClassNameFromElement";
            ASPx[method](headerContainer, "dxss-hidden");
        },

        correctSizeValue: function(value) {
            return value > 0 ? value : 0;
        },

        // Freeze Borders Elements
        hideFreezeBorders: function() {
            ASPx.SetElementDisplay(this.getHorizontalFreezeBorder(), false);
            ASPx.SetElementDisplay(this.getVerticalFreezeBorder(), false);
        },
        showFreezeBorders: function(settings) {
            var mode = settings.mode,
                width = settings.width,
                height = settings.height,
                hbe = this.getHorizontalFreezeBorder(),
                vbe = this.getVerticalFreezeBorder(),
                sizes = this.getPaneManager().getVisibleAreaSize(),
                headerOffsetSize = this.getPaneManager().getHeaderOffsetSize();

            if(mode === 0 || mode === 2) {
                hbe.style.width = sizes.width + "px";
                hbe.style.left = "0px";
                hbe.style.top = height + headerOffsetSize.height - 1 + "px";
                hbe.style.height = "1px";
                ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(hbe, this.getWorkbookControl());
                ASPx.SetElementDisplay(hbe, true);
            }
            if(mode === 1 || mode === 2) {
                vbe.style.height = sizes.height + "px";
                vbe.style.left = width + headerOffsetSize.width - 1 + "px";
                vbe.style.top = "0px";
                vbe.style.width = "1px";
                ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(vbe, this.getWorkbookControl());
                ASPx.SetElementDisplay(vbe, true);
            }
        },
        getVerticalFreezeBorder: function() {
            if(!this.verticalFreezeBorder)
                this.verticalFreezeBorder = this.createFreezeBorderElement(true);
            return this.verticalFreezeBorder;
        },
        getHorizontalFreezeBorder: function() {
            if(!this.horizontalFreezeBorder)
                this.horizontalFreezeBorder = this.createFreezeBorderElement(false);
            return this.horizontalFreezeBorder;
        },
        createFreezeBorderElement: function(isVertical) {
            var element = document.createElement("DIV");
            element.className = isVertical ? "dxss-vfbe" : "dxss-hfbe";
            return element;
        },

        // Child controls
        GetMainElement: function() {
            return this.getOwnerControl().GetMainElement();
        },
        getWorkbookControl: function() {
            return this.getOwnerControl().GetChildElement(ASPxClientSpreadsheet.ChildControlIdPostfixes.workbookPostfix);
        },
        getColumnHeader: function(paneType) {
            return ASPx.GetElementById(this.getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.columnHeaderDivPostfix + this.getPanePostfixByType(paneType));
        },
        getRowHeader: function(paneType) {
            return ASPx.GetElementById(this.getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.rowHeaderDivPostfix + this.getPanePostfixByType(paneType));
        },
        getGridContainer: function(paneType) {
            return ASPx.GetElementById(this.getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.gridContainerDivPostfix + this.getPanePostfixByType(paneType));
        },
        getScrollContainer: function() {
            return ASPx.GetElementById(this.getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.scrollContainerDivPostfix);
        },
        getScrollContent: function() {
            return ASPx.GetElementById(this.getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.scrollContentDivPostfix);
        },
        getSelectSheetButton: function() {
            return ASPx.GetElementById(this.getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.selectSheetButton);
        },
        getColumnHeaderTilesContainer: function(paneType) {
            if(!this.columnHeaderTile[paneType])
                this.columnHeaderTile[paneType] = ASPx.GetNodeByClassName(this.getColumnHeader(paneType), ASPx.SpreadsheetCssClasses.TileContainer);
            return this.columnHeaderTile[paneType];
        },
        getHeaderTileElementByCellIndex: function(cellIndex, tileIndex, isCol) {
            var paneType = this.getPaneManager().getHeaderPaneTypeByCellIndex(cellIndex, isCol);
            return this.getHeaderTileElement(tileIndex, isCol, paneType);
        },
        resetColumnHeaderTileContainer: function(paneType) {
            this.columnHeaderTile[paneType] = null;
        },
        getRowHeaderTilesContainer: function(paneType) {
            if(!this.rowHeaderTile[paneType])
                this.rowHeaderTile[paneType] = ASPx.GetNodeByClassName(this.getRowHeader(paneType), ASPx.SpreadsheetCssClasses.TileContainer);
            return this.rowHeaderTile[paneType];
        },
        resetRowHeaderTilesContainer: function(paneType) {
            this.rowHeaderTile[paneType] = null;
        },
        getGridTilesContainer: function(paneType) {
            if(!this.gridTileContainer[paneType])
                this.gridTileContainer[paneType] = ASPx.GetNodeByClassName(this.getGridContainer(paneType), ASPx.SpreadsheetCssClasses.TileContainer);
            return this.gridTileContainer[paneType];
        },
        resetGridTilesContainer: function(paneType) {
            this.gridTileContainer[paneType] = null;
        },

        // Formula bar
        getFormulaBar: function() {
            return ASPx.GetElementById(this.getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.formulaBar);
        },
        getFormulaBarTextWrapperElement: function() {
            return ASPx.GetChildByClassName(this.getFormulaBar(), "dxss-fbw");
        },
        getFormulaBarTextBoxElement: function() {
            return ASPx.GetElementById(this.getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.formulaBarTextBox);
        },
        getFormulaBarEditorPlaceholder: function() {
            var formulaBarTextBoxElement = this.getFormulaBarTextBoxElement();
            return ASPx.IsExists(formulaBarTextBoxElement) ? ASPx.GetNodeByTagName(formulaBarTextBoxElement, "INPUT") : null;
            // TODO - probably it is better to find input by class name
        },


        createDataCell: function(colModelIndex, rowModelIndex, cellValue, cellStyle) {
            var paneManager = this.getPaneManager(),
                pane = paneManager.getPaneByCell({ col: colModelIndex, row: rowModelIndex }),
                colVisibleIndex = pane.convertModelIndexToVisibleIndex(colModelIndex, true),
                rowVisibleIndex = pane.convertModelIndexToVisibleIndex(rowModelIndex, false),
                range = paneManager.getSelectionHelper().ExpandRangeToMergedCellSize(new ASPxClientSpreadsheet.Range(colVisibleIndex, rowVisibleIndex));

            var topLeftCellLayoutInfo = paneManager.getCellLayoutInfo(range.leftColIndex, range.topRowIndex),
                bottomRightCellLayoutInfo = paneManager.getCellLayoutInfo(range.rightColIndex, range.bottomRowIndex);

            if(!topLeftCellLayoutInfo || !bottomRightCellLayoutInfo)
                return;

            var tileInfo = topLeftCellLayoutInfo.tileInfo,
                parentContainer = tileInfo.htmlElement,
                rect = ASPxClientSpreadsheet.CellHelper.getCellRangeRect(topLeftCellLayoutInfo, bottomRightCellLayoutInfo, tileInfo);

            var cellObject = this.createCellRepresentationObject(colModelIndex, rowModelIndex, rect, cellValue, cellStyle),
                cellElementHtml = paneManager.getRenderProvider().createCellElement(pane.getTileHelper(), cellObject);

            if(cellElementHtml) {
                parentContainer.insertAdjacentHTML("beforeend", cellElementHtml);
                var validationHelper = this.getOwnerControl().getValidationHelper(),
                    valueNeedConfirmation = validationHelper.isCellHaveValidation(colModelIndex, rowModelIndex) || (cellValue && cellValue.trim().indexOf("=") === 0);

                if(!valueNeedConfirmation)
                    this.updateTileInfo(tileInfo, cellObject);
            }

            return this.getCellElementByModelPosition(colModelIndex, rowModelIndex);
        },
        getCellLayoutPosition: function(tileHelper, colModelIndex, rowModelIndex) {
            var paneManager = this.getPaneManager(),
                colVisibleIndex = paneManager.convertModelIndexToVisibleIndex(colModelIndex, true),
                rowVisibleIndex = paneManager.convertModelIndexToVisibleIndex(rowModelIndex, false);
            if(colVisibleIndex < 0 || rowVisibleIndex < 0)
                return null;

            var range = paneManager.getSelectionHelper().ExpandRangeToMergedCellSize(new ASPxClientSpreadsheet.Range(colVisibleIndex, rowVisibleIndex));

            var topLeftCellLayoutInfo = tileHelper.getCellLayoutInfo(range.leftColIndex, range.topRowIndex);
            if(!topLeftCellLayoutInfo)
                topLeftCellLayoutInfo = paneManager.getCellLayoutInfo(range.leftColIndex, range.topRowIndex);

            var bottomRightCellLayoutInfo = tileHelper.getCellLayoutInfo(range.rightColIndex, range.bottomRowIndex);
            if(!bottomRightCellLayoutInfo)
                bottomRightCellLayoutInfo = paneManager.getCellLayoutInfo(range.rightColIndex, range.bottomRowIndex);

            if(!topLeftCellLayoutInfo || !bottomRightCellLayoutInfo)
                return null;

            var tileInfo = topLeftCellLayoutInfo.tileInfo,
                rect = ASPxClientSpreadsheet.CellHelper.getCellRangeRect(topLeftCellLayoutInfo, bottomRightCellLayoutInfo, tileInfo);

            return rect;
        },
        createCellRepresentationObject: function(colModelIndex, rowModelIndex, cellRect, cellValue, cellStyle) {
            var cellObject = {};

            cellObject.P = [rowModelIndex, colModelIndex];
            cellObject.S = [cellRect.width, cellRect.height];
            cellObject.C = [cellRect.y, cellRect.x];
            cellObject.BC = null;
            cellObject.SW = null;
            cellObject.CE = {};
            cellObject.CE.S = [cellRect.width - 4, cellRect.height];
            this.setCellValueToObject(cellObject, cellValue);
            this.setCellStyleToObject(cellObject, cellStyle);

            return cellObject;
        },
        setCellValueToObject: function(cellRepresentationObject, value) {
            cellRepresentationObject.CE.T = ASPx.IsExists(value) ? value : "";
            cellRepresentationObject.CE.D = ASPx.IsNumber(value) ? 1 : 0;
        },
        setCellStyleToObject: function(cellRepresentationObject, styleRepresentationObject) {
            if(styleRepresentationObject)
                cellRepresentationObject.CE.ST = styleRepresentationObject;
        },
        updateTileInfo: function(tileInfo, cellRepresentationObject) {
            if(!tileInfo.json.C)
                tileInfo.json.C = [];

            var cellInfoPosition = ASPx.Data.ArrayIndexOf(tileInfo.json.C, cellRepresentationObject, this.cellRecordComparer);
            if(cellInfoPosition < 0)
                tileInfo.json.C.push(cellRepresentationObject);
        },
        cellRecordComparer: function(record1, record2) {
            return record1.P[0] === record2.P[0] && record1.P[1] === record2.P[1];
        },

        getCellElementByModelPosition: function(colModelIndex, rowModelIndex) {
            var documentContainer = this.getWorkbookControl(),
                paneType = this.getPaneManager().getPaneTypeByCell({ col: colModelIndex, row: rowModelIndex });
            return documentContainer ? ASPx.GetChildById(documentContainer, this.getChildControlsPrefix(true) + this.getPanePostfixByType(paneType) + '_ctb.' + colModelIndex + '.' + rowModelIndex) : null;
        },
        getCellElementByVisiblePosition: function(colVisibleIndex, rowVisibleIndex) {
            var cellModelPosition = this.getPaneManager().convertVisiblePositionToModelPosition(colVisibleIndex, rowVisibleIndex);
            return this.getCellElementByModelPosition(cellModelPosition.colIndex, cellModelPosition.rowIndex);
        },
        getCellTextElement: function(colVisibleIndex, rowVisibleIndex) {
            var cellContainer = this.getCellElementByVisiblePosition(colVisibleIndex, rowVisibleIndex);
            return cellContainer ? ASPx.GetNodeByClassName(cellContainer, ASPx.SpreadsheetCssClasses.TextBoxContent) : null;
        },
        getCellTextElementByModelPosition: function(colModelIndex, rowModelIndex) {
            var cellContainer = this.getCellElementByModelPosition(colModelIndex, rowModelIndex);
            return cellContainer ? ASPx.GetNodeByClassName(cellContainer, ASPx.SpreadsheetCssClasses.TextBoxContent) : null;
        },
        getActiveCellElement: function() {
            var cellModelPosition = this.getOwnerControl().getActiveCellModelPosition();
            return this.getCellElementByModelPosition(cellModelPosition.colIndex, cellModelPosition.rowIndex);
        },
        getIsTouchSelectionElement: function(element) {
            return ASPx.ElementHasCssClass(element, ASPx.SpreadsheetCssClasses.TouchSelectionElement);
        },
        getIsSelectionBorderElement: function(element) {
            return ASPx.ElementHasCssClass(element, ASPx.SpreadsheetCssClasses.SelectionBorderElement) ||
                ASPx.ElementHasCssClass(element, ASPx.SpreadsheetCssClasses.TopRangeBorderElement) ||
                ASPx.ElementHasCssClass(element, ASPx.SpreadsheetCssClasses.RightRangeBorderElement) ||
                ASPx.ElementHasCssClass(element, ASPx.SpreadsheetCssClasses.BottomRangeBorderElement) ||
                ASPx.ElementHasCssClass(element, ASPx.SpreadsheetCssClasses.LeftRangeBorderElement);
        },
        getIsDropDownButtonElement: function(element) {
            return ASPx.ElementHasCssClass(element, ASPx.SpreadsheetCssClasses.DropDownButtonImage);
        },
        isLoadTilesRequired: function(cachedScrollLeft, cachedScrollTop) {
            var scrollDiv = this.getScrollContainer();
            if(cachedScrollTop > scrollDiv.scrollHeight - ASPx.GetDocumentClientHeight() || cachedScrollLeft > scrollDiv.scrollWidth - ASPx.GetDocumentClientWidth())
                return true;
            return !this.getPaneManager().tryLoadTilesFromCache();
        },
        getGridOffsetSize: function(paneType) {  // TODO use cached value from spreadsheet control
            var grid = this.getGridContainer(paneType);
            return { width: ASPx.PxToInt(grid.style.width), height: ASPx.PxToInt(grid.style.height) };
        },

        getHeaderTileElementId: function(index, isColumn, paneType) { return this.getChildControlsPrefix(true) + this.getPanePostfixByType(paneType) + "_h" + (isColumn ? "c" : "r") + index; },
        getHeaderTileElement: function(index, isColumn, paneType) { return ASPx.GetElementById(this.getHeaderTileElementId(index, isColumn, paneType)); },

        getGridTileElementId: function(rowIndex, colIndex, paneType) { return this.getChildControlsPrefix(true) + this.getPanePostfixByType(paneType) + "_r" + rowIndex + "c" + colIndex; },
        getGridTileElement: function(rowIndex, colIndex, paneType) { return ASPx.GetElementById(this.getGridTileElementId(rowIndex, colIndex, paneType)); },

        getGridTileRowElementId: function(rowIndex, paneType) { return this.getChildControlsPrefix(true) + this.getPanePostfixByType(paneType) + "_r" + rowIndex; },
        getGridTileRowElement: function(rowIndex, paneType) { return ASPx.GetElementById(this.getGridTileRowElementId(rowIndex, paneType)); },

        getCellContainerElementId: function(rowIndex, colIndex, paneType) { return this.getChildControlsPrefix(true) + this.getPanePostfixByType(paneType) + '_ctb.' + colIndex + '.' + rowIndex; },
        getCellElementId: function(rowIndex, colIndex, paneType) { return this.getChildControlsPrefix(true) + this.getPanePostfixByType(paneType) + '_tb.' + colIndex + '.' + rowIndex; },
        getBorderElementId: function(position, startIndex, endIndex, paneType, isVertical) {
            return this.getChildControlsPrefix(true) + this.getPanePostfixByType(paneType) + "_gb" + (isVertical ? "ve." : "he.") + position + "." + startIndex + "." + endIndex;
        },
        getComplexBoxElementId: function(rowIndex, colIndex, paneType) { return this.getChildControlsPrefix(true) + this.getPanePostfixByType(paneType) + '_mcb.' + colIndex + '.' + rowIndex; },
        getCommentElementId: function(rowIndex, colIndex, paneType) { return this.getChildControlsPrefix(true) + this.getPanePostfixByType(paneType) + '_cb.' + colIndex + '.' + rowIndex; },
        getConnectionLineElementId: function(rowIndex, colIndex, paneType) { return this.getChildControlsPrefix(true) + this.getPanePostfixByType(paneType) + '_cbcl.' + colIndex + '.' + rowIndex; },

        getHeaderCellElementIndex: function(headerCellElement, isCol) {
            var cellContainer = ASPx.GetParentByClassName(headerCellElement, ASPx.SpreadsheetCssClasses.HeaderContainer);
            var tileIndex = parseInt(cellContainer.getAttribute(ASPxClientSpreadsheet.TileHelper.DataAttributes.HeaderContainerTileIndex));

            var cellIndex = parseInt(headerCellElement.getAttribute(ASPxClientSpreadsheet.TileHelper.DataAttributes.HeaderCellIndex));
            var tileSize = isCol ? this.getTileSize().col : this.getTileSize().row;
            return tileIndex * tileSize + cellIndex;
        },

        prepareControlHierarchy: function(paneType) {
            if(paneType === ASPxClientSpreadsheet.PaneManager.PanesType.MainPane)
                return;

            if(!this.getGridContainer(paneType))
                this.createPane(this.getPanePostfixByType(paneType), paneType);
        },
        createPane: function(postfix, paneType) {
            var columnHeader = this.getColumnHeader(),
                rowHeader = this.getRowHeader(),
                gridContainer = this.getGridContainer(),
                workbook = this.getWorkbookControl();

            if(paneType === ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane) {
                var clonedColumnHeader = columnHeader.cloneNode(true);
                clonedColumnHeader.id = clonedColumnHeader.id + postfix;
                clonedColumnHeader.style.borderRight = "none";
                this.removeChilds(clonedColumnHeader);
                workbook.insertBefore(clonedColumnHeader, columnHeader);
            }

            if(paneType === ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane) {
                var clonedRowHeader = rowHeader.cloneNode(true);
                clonedRowHeader.id = clonedRowHeader.id + postfix;
                clonedRowHeader.style.borderBottom = "none";
                this.removeChilds(clonedRowHeader);
                workbook.insertBefore(clonedRowHeader, columnHeader);
            }

            var clonedGridContainer = gridContainer.cloneNode(true);
            clonedGridContainer.id = clonedGridContainer.id + postfix;
            this.prepareStyles(clonedGridContainer, paneType);
            this.removeChilds(clonedGridContainer);
            workbook.insertBefore(clonedGridContainer, columnHeader);
        },
        removeChilds: function(parentContainer) {
            var tileContainer = ASPx.GetNodeByClassName(parentContainer, ASPx.SpreadsheetCssClasses.TileContainer);
            if(tileContainer)
                while(tileContainer.firstChild)
                    tileContainer.removeChild(tileContainer.firstChild);
        },
        prepareStyles: function(container, paneType) {
            if(paneType === ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane || paneType === ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane)
                container.style.borderRight = "none";
            if(paneType === ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane || paneType === ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane)
                container.style.borderBottom = "none";
        },
        getPanePostfixByType: function(paneType) {
            var panePostfix = "";
            switch(paneType) {
                case ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane:
                    panePostfix = "_" + ASPxClientSpreadsheet.ChildControlIdPostfixes.topRightPanePostfix;
                    break;
                case ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane:
                    panePostfix = "_" + ASPxClientSpreadsheet.ChildControlIdPostfixes.bottomLeftPanePostfix;
                    break;
                case ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane:
                    panePostfix = "_" + ASPxClientSpreadsheet.ChildControlIdPostfixes.frozenPanePostfix;
                    break;
            }
            return panePostfix;
        },

        createChildControls: function() {
            var columnHeaderContainer = this.getColumnHeader();
            if(!columnHeaderContainer)
                columnHeaderContainer = this.createColumnHeaderContainer();

            var rowHeaderContainer = this.getRowHeader();
            if(!rowHeaderContainer)
                rowHeaderContainer = this.createRowHeaderContainer();

            var gridContainer = this.getGridContainer();
            if(!gridContainer)
                gridContainer = this.createGridContainer();

            var scrollContainer = this.getScrollContainer();
            if(!scrollContainer)
                scrollContainer = this.createScrollContainer();

            var selectSheetButton = this.getSelectSheetButton();
            if(!selectSheetButton)
                selectSheetButton = this.createSelectSheetButton();
        },
        createScrollContainer: function() {
            var parentContainer = this.getWorkbookControl(),
                scrollContainer = document.createElement("div"),
                scrollContent = document.createElement("div");

            scrollContainer.id = this.getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.scrollContainerDivPostfix;
            scrollContainer.className = ASPx.SpreadsheetCssClasses.ScrollContainer;

            scrollContent.id = this.getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.scrollContentDivPostfix;

            scrollContainer.appendChild(scrollContent);
            parentContainer.appendChild(scrollContainer);
            return scrollContainer;
        },
        createGridContainer: function() {
            var parentContainer = this.getWorkbookControl(),
                gridContainer = document.createElement("div");

            gridContainer.id = this.getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.gridContainerDivPostfix;
            gridContainer.className = ASPx.SpreadsheetCssClasses.GridContainer;

            gridContainer.appendChild(this.createSpacer("top"));
            gridContainer.appendChild(this.createFloatingContainer());
            gridContainer.appendChild(this.createSpacer("bottom"));

            parentContainer.appendChild(gridContainer);
            return gridContainer;
        },
        createColumnHeaderContainer: function() {
            var parentContainer = this.getWorkbookControl(),
                columnContainer = document.createElement("div");

            columnContainer.id = this.getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.columnHeaderDivPostfix;
            columnContainer.className = ASPx.SpreadsheetCssClasses.HeaderColumn;

            columnContainer.appendChild(this.createFloatingContainer());

            parentContainer.appendChild(columnContainer);
            return columnContainer;
        },
        createRowHeaderContainer: function() {
            var parentContainer = this.getWorkbookControl(),
                rowContainer = document.createElement("div");

            rowContainer.id = this.getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.rowHeaderDivPostfix;
            rowContainer.className = ASPx.SpreadsheetCssClasses.HeaderRow;

            rowContainer.appendChild(this.createSpacer("top"));
            rowContainer.appendChild(this.createTileContainer());
            rowContainer.appendChild(this.createSpacer("bottom"));

            parentContainer.appendChild(rowContainer);
            return rowContainer;
        },
        createFloatingContainer: function() {
            var floatingContainer = document.createElement("div");

            floatingContainer.className = ASPx.SpreadsheetCssClasses.FloatingContainer;

            floatingContainer.appendChild(this.createSpacer("left"));
            floatingContainer.appendChild(this.createTileContainer());
            floatingContainer.appendChild(this.createSpacer("right"));

            var clearSpacer = document.createElement("b");
            clearSpacer.className = "dx-clear";
            floatingContainer.appendChild(clearSpacer);

            return floatingContainer;
        },
        createTileContainer: function() {
            var tileContainer = document.createElement("div");
            tileContainer.className = ASPx.SpreadsheetCssClasses.TileContainer;
            return tileContainer;
        },
        createSpacer: function(type) {
            var spacer = document.createElement("div");
            switch(type) {
                case "bottom":
                    spacer.className = ASPx.SpreadsheetCssClasses.BottomSpacer;
                    break;
                case "left":
                    spacer.className = ASPx.SpreadsheetCssClasses.LeftSpacer;
                    break;
                case "right":
                    spacer.className = ASPx.SpreadsheetCssClasses.RightSpacer;
                    break;
                default:
                    spacer.className = ASPx.SpreadsheetCssClasses.TopSpacer;
                    break;
            }
            return spacer;
        },
        createSelectSheetButton: function() {
            var parentContainer = this.getWorkbookControl(),
                selectSheetButton = document.createElement("div"),
                selectSheetImage = document.createElement("div");

            selectSheetButton.id = this.getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.selectSheetButton;
            selectSheetButton.className = ASPx.SpreadsheetCssClasses.SelectSheetButton;

            selectSheetImage.className = ASPx.SpreadsheetCssClasses.SelectSheetButtonArrow;

            selectSheetButton.appendChild(selectSheetImage);
            parentContainer.appendChild(selectSheetButton);
            return selectSheetButton;
        },

        replaceControlContent: function(content) {
            var mainElement = this.GetMainElement();
            var parentContainer = mainElement.parentNode;
            var oldScripts = mainElement.nextSibling;

            var templateDiv = document.createElement("DIV");
            templateDiv.innerHTML = content;

            this.replaceDOMElement(templateDiv, this.getOwnerControl().GetLoadingPanelElement(), parentContainer);
            this.replaceDOMElement(templateDiv, this.getOwnerControl().GetLoadingDiv(), parentContainer);
            this.replaceDOMElement(templateDiv, mainElement, parentContainer);

            this.replaceControlScript(mainElement, parentContainer, templateDiv, oldScripts);
        },
        replaceControlScript: function(mainElement, parentContainer, templateDiv, oldScripts) {
            var newNode = this.getSuitableReplacementElement(templateDiv, "SCRIPT");
            if(newNode)
                parentContainer.replaceChild(newNode, oldScripts);
        },
        replaceDOMElement: function(newContent, existingNode, parentContainer) {
            var childNodes = ASPx.GetChildNodesByTagName(newContent, existingNode.tagName);
            var replacementNode = null;
            for(var i = 0; i < childNodes.length; i++)
                if(childNodes[i].id == existingNode.id)
                    replacementNode = childNodes[i];
            if(replacementNode)
                parentContainer.replaceChild(replacementNode, existingNode);
        },
        getSuitableReplacementElement: function(elementsSet, tagName) {
            var elements = ASPx.GetChildNodesByTagName(elementsSet, tagName);
            if(elements.length > 0)
                return elements[0];
            return null;
        },

        getInputTargetElement: function() {
            if(ASPx.Browser.Firefox) {
                this.removeIFrameElement(ASPxClientSpreadsheet.ChildControlIdPostfixes.inputTargetElement);
                this.inputTargetElement = null;
            }

            if(!this.inputTargetElement)
                this.inputTargetElement = this.createInputTargetFrameElement();

            return this.inputTargetElement;
        },
        createInputTargetFrameElement: function() {
            var frameElement = document.createElement("iframe");
            frameElement.id = this.getOwnerControl().name + ASPxClientSpreadsheet.ChildControlIdPostfixes.inputTargetElement;
            frameElement.className = ASPx.SpreadsheetCssClasses.InputTargetFrameElement;
            frameElement.src = "javascript:false;";
            if(ASPx.Browser.WebKitFamily) frameElement.scrolling = "no";

            frameElement.name = this.getOwnerControl().name + ASPxClientSpreadsheet.ChildControlIdPostfixes.inputTargetElement;
            this.getOwnerControl().GetMainElement().appendChild(frameElement);
            return this.getOwnerControl().GetChildElement(ASPxClientSpreadsheet.ChildControlIdPostfixes.inputTargetElement);
        },

        getSupportFrameElement: function() {
            if(ASPx.Browser.Firefox || (ASPx.Browser.IE && ASPx.Browser.Version === 10)) {
                this.removeIFrameElement(ASPxClientSpreadsheet.ChildControlIdPostfixes.supportFrame);
                this.supportFrameElement = null;
            }

            if(!this.supportFrameElement)
                this.supportFrameElement = this.createSupportFrameElement();

            return this.supportFrameElement;
        },
        getSupportFrameDomElementId: function() {
            return this.getOwnerControl().name + ASPxClientSpreadsheet.ChildControlIdPostfixes.supportFrame;
        },
        createSupportFrameElement: function() {
            var supportFrame = document.createElement("iframe");
            var frameSize = ASPx.Browser.Safari ? "1px" : "0px";
            supportFrame.style.width = frameSize;
            supportFrame.style.height = frameSize;
            supportFrame.name = this.getSupportFrameDomElementId();
            supportFrame.id = this.getSupportFrameDomElementId();
            supportFrame.className = ASPx.SpreadsheetCssClasses.SupportFrameElement;
            this.getOwnerControl().GetMainElement().appendChild(supportFrame);
            return window.frames[supportFrame.name];
        },

        removeIFrameElement: function(iframeName) {
            var frameElement = this.getOwnerControl().GetChildElement(iframeName);
            if(frameElement)
                this.getOwnerControl().GetMainElement().removeChild(frameElement);

            try {
                delete window.frames[this.getOwnerControl().name + iframeName];
            } catch(e) { }
        },

        needUseSvgImages: function() {
            return this.getOwnerControl().needUseSvgImages();
        },
        createSvgElement: function(imageName) {
            if(!imageName) {
                imageName = "";
            }
            var result = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            var useElement = document.createElementNS("http://www.w3.org/2000/svg", "use");
            useElement.setAttributeNS('http://www.w3.org/1999/xlink', 'href', "#" + imageName);
            result.appendChild(useElement);
            return result;
        }
    });

    ASPxClientSpreadsheet.RenderHelper.PlacementHelper = (function() {
        var PlacementHelper = {};

        PlacementHelper.appendChild = function(child, parent) {
            if(child.parentNode != parent) {
                if(child.parentNode)
                    child.parentNode.removeChild(child);
                parent.appendChild(child);
            }
        };

        PlacementHelper.setElementRect = function(element, rect) {
            // INFO never use _aspxSetAbsolutePosition here!
            element.style.left = rect.x + "px";
            element.style.top = rect.y + "px";
            element.style.width = rect.width + "px";
            element.style.height = rect.height + "px";
        };

        PlacementHelper.setElementRectWithElementOffset = function(element, rect, elementOffset) {
            element.style.width = rect.width + "px";
            element.style.height = rect.height + "px";

            this.setElementPosWithElementOffset(element, rect, elementOffset);
        };

        PlacementHelper.setElementPosWithElementOffset = function(element, rect, elementOffset) {
            var xOffset = (elementOffset) ? ASPxClientUtils.GetAbsoluteX(elementOffset) : 0;
            var yOffset = (elementOffset) ? ASPxClientUtils.GetAbsoluteY(elementOffset) : 0;

            if(ASPx.Browser.IE && ASPx.Browser.Version >= 10) {
                xOffset = Math.round(xOffset);
                yOffset = Math.round(yOffset);
            }

            ASPxClientUtils.SetAbsoluteX(element, rect.x + xOffset);
            ASPxClientUtils.SetAbsoluteY(element, rect.y + yOffset);
        };

        PlacementHelper.correctForClientRect = function(spreadsheet, rect) {
            var gridLineSize = spreadsheet.getGridLineSize(); // TODO calculate it

            rect.x += gridLineSize;
            rect.y += gridLineSize;
            rect.width -= gridLineSize;
            rect.height -= gridLineSize;

            return rect;
        };

        PlacementHelper.getIncrementalRangeArray = function(source) {
            if(!source) return [];
            var result = [],
                inc = 0;

            result.push(inc);
            for(var i = 0; i < source.length; i++) {
                inc += source[i];
                result.push(inc);
            }
            return result;
        };

        PlacementHelper.getChildElementById = function(container, id) {
            if(container.querySelector)
                return container.querySelector("[id='" + id + "']");
            return ASPx.GetChildById(container, id);
        };

        return PlacementHelper;
    })();
})();

(function() {
    ASPxClientSpreadsheet.PaneManager = ASPx.CreateClass(null, {

        constructor: function(spreadsheetControl) {
            this.spreadsheetControl = spreadsheetControl;
            this.renderHelper = this.spreadsheetControl.getRenderHelper();
            this.activePanes = {};
            this.headerOffsetHeight = 0;
            this.headerOffsetWidths = [];
            this.frozenPaneSettings = { isFrozen: false, width: 0, height: 0 };
            this.loadTilesRequestId = 1;
        },
        getHeaderOffsetSize: function() {
            var rowIndex = (this.getLastVisibleHeaderRowTileIndex() + 1) * this.getTileSize().row,
                textLength = rowIndex.toString().length;
            var width = this.headerOffsetWidths.length >= textLength ? this.headerOffsetWidths[textLength - 1] : this.headerOffsetWidths[this.headerOffsetWidths.length - 1];
            return {
                width: width,
                height: this.headerOffsetHeight
            };
        },
        setHeaderOffsetSizes: function(response) {
            var headerOffsetSize = response[ASPxClientSpreadsheet.ResponseStringKeys.HeaderOffset];
            if(headerOffsetSize) {
                this.headerOffsetHeight = headerOffsetSize[ASPxClientSpreadsheet.DocumentModel.Sizes.Height];
                this.headerOffsetWidths = headerOffsetSize[ASPxClientSpreadsheet.DocumentModel.Sizes.Width];
            }
        },
        getLastVisibleHeaderRowTileIndex: function() {
            var maxVisibleIndex = 0;
            for(var paneType in this.activePanes)
                if(this.activePanes.hasOwnProperty(paneType) && this.activePanes[paneType])
                    maxVisibleIndex = Math.max(this.activePanes[paneType].getLastVisibleHeaderRowTileIndex(), maxVisibleIndex);
            return maxVisibleIndex;
        },

        updateGridTileCache: function(response) {
            if(response[ASPxClientSpreadsheet.ResponseStringKeys.ClearClientCache] === 1) {
                for(var paneType in this.activePanes)
                    if(this.activePanes.hasOwnProperty(paneType) && this.activePanes[paneType]) {
                        var pane = this.activePanes[paneType],
                            serverVisibleRange = response.visibleRange[paneType];
                        pane.updateGridTileCache(serverVisibleRange);
                    }
            }
        },
        processDocumentResponse: function(response) {
            this.preparePaneManager(response);
            this.getScrollHelper().processDocumentResponse(response);
            this.renderPivotTablesAutoFilterImages(response[ASPxClientSpreadsheet.ResponseStringKeys.PivotTableAutofilters]);
            this.renderAutoFilterImages(response.autoFilters);
        },
        preparePaneManager: function(response) {
            this.getRenderHelper().hideFreezeBorders();

            this.setHeaderOffsetSizes(response);
            this.applyFrozenPaneSettings(response);
            this.calculatePaneCellVisibleRange();

            this.updateVisibleRanges(response.visibleRange);

            this.adjustVisiblePanes();
            this.saveLoadRequestId(response.ri);

            for(var paneType in response.newTiles) {
                if(response.newTiles.hasOwnProperty(paneType) && response.newTiles[paneType]) {
                    var pane = this.getPaneByType(paneType),
                        newTiles = response.newTiles[paneType],
                        visibleRange = response.visibleRange[paneType],
                        outdatedTiles = response[ASPxClientSpreadsheet.ResponseStringKeys.ExpiredTiles];
                    pane.processDocumentResponse(newTiles, visibleRange, outdatedTiles);
                }
            }
        },
        renderAutoFilterImages: function(autoFiltersConfig) {
            var tileHelper = this.getTileHelper();
            tileHelper.processAutoFilters(autoFiltersConfig, this);
        },
        renderPivotTablesAutoFilterImages: function(autoFiltersConfig) {
            var tileHelper = this.getTileHelper();
            tileHelper.processPivotTableAutoFilters(autoFiltersConfig, this);
        },
        applyFrozenPaneSettings: function(response) {
            var frozenModeChanged = !this.frozePaneSettingsAreEqual(this.getFrozenPaneSettings(), response.fp);
            if(frozenModeChanged || this.getOwnerControl().isNewSheetLoaded(response)) {
                this.setFrozenPaneSettings(response.fp);
                this.actualizeDOMElements(response.newTiles, response.visibleRange);
                this.getScrollHelper().onFrozenPaneSettingsChanged();
            }
        },
        getFrozenPaneSettings: function() {
            return this.frozenPaneSettings;
        },
        setFrozenPaneSettings: function(settings) {
            if(settings) {
                this.frozenPaneSettings = settings;
                this.frozenPaneSettings.isFrozen = !!settings.frozenCell;
            } else this.frozenPaneSettings = { isFrozen: false, width: 0, height: 0 };
        },
        frozePaneSettingsAreEqual: function(oldSettings, newSettings) {
            var changed = newSettings && !oldSettings || !newSettings && oldSettings;
            if(!changed && oldSettings && newSettings)
                changed = !(oldSettings.mode === newSettings.mode &&
                    oldSettings.topLeftCell.col === newSettings.topLeftCell.col &&
                    oldSettings.topLeftCell.row === newSettings.topLeftCell.row &&
                    oldSettings.frozenCell.col === newSettings.frozenCell.col &&
                    oldSettings.frozenCell.row === newSettings.frozenCell.row &&
                    oldSettings.width === newSettings.width &&
                    oldSettings.height === newSettings.height);
            return !changed;
        },
        isControlFrozen: function() {
            var freezeSettings = this.getFrozenPaneSettings();
            return freezeSettings.isFrozen;
        },
        getActivePanes: function() {
            return this.activePanes;
        },
        actualizeDOMElements: function(newTiles) {
            var panes = [ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane, ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane, ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane],
                len = panes.length,
                paneType;
            for(var i = 0; i < len, paneType = panes[i]; i++) {
                if(newTiles[paneType]) {
                    var pane = this.getPaneByType(paneType);
                    if(!pane) {
                        pane = this.createPaneByType(paneType);
                        this.attachEventsToPaneElements(paneType);
                    }
                } else {
                    this.activePanes[paneType] = null;
                    this.removePaneByType(paneType);
                }
            }
        },
        updateVisibleRanges: function(visibleRanges) {
            for(var paneType in visibleRanges) {
                if(visibleRanges.hasOwnProperty(paneType) && visibleRanges[paneType]) {
                    var pane = this.getPaneByType(paneType),
                        visibleRange = visibleRanges[paneType];
                    pane.setLastVisibleHeaderRowTileIndex(visibleRange.bottom);
                }
            }
        },
        // TODO to zhuravlev: refactor 
        calculatePaneCellVisibleRange: function() {
            var settings = this.getFrozenPaneSettings(),
                mode = settings.mode,
                mainPane = this.getPaneByType(),
                topRightPane,
                bottomLeftPane;

            switch(mode) {
                case 0:
                    topRightPane = this.getPaneByType(ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane);
                    topRightPane.setPaneCellVisibleRange(new ASPxClientSpreadsheet.Range(0, 0, ASPxClientSpreadsheet.Range.MAX_COL_INDEX, settings.frozenCell.row - 1));
                    mainPane.setPaneCellVisibleRange(new ASPxClientSpreadsheet.Range(0, settings.frozenCell.row, ASPxClientSpreadsheet.Range.MAX_COL_INDEX, ASPxClientSpreadsheet.Range.MAX_ROW_INDEX));
                    break;
                case 1:
                    bottomLeftPane = this.getPaneByType(ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane);
                    bottomLeftPane.setPaneCellVisibleRange(new ASPxClientSpreadsheet.Range(0, 0, settings.frozenCell.col - 1, ASPxClientSpreadsheet.Range.MAX_ROW_INDEX));
                    mainPane.setPaneCellVisibleRange(new ASPxClientSpreadsheet.Range(settings.frozenCell.col, 0, ASPxClientSpreadsheet.Range.MAX_COL_INDEX, ASPxClientSpreadsheet.Range.MAX_ROW_INDEX));
                    break;
                case 2:
                    topRightPane = this.getPaneByType(ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane);
                    bottomLeftPane = this.getPaneByType(ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane);
                    var frozenPane = this.getPaneByType(ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane);

                    frozenPane.setPaneCellVisibleRange(new ASPxClientSpreadsheet.Range(0, 0, settings.frozenCell.col - 1, settings.frozenCell.row - 1));
                    topRightPane.setPaneCellVisibleRange(new ASPxClientSpreadsheet.Range(settings.frozenCell.col, 0, ASPxClientSpreadsheet.Range.MAX_COL_INDEX, settings.frozenCell.row - 1));
                    bottomLeftPane.setPaneCellVisibleRange(new ASPxClientSpreadsheet.Range(0, settings.frozenCell.row, settings.frozenCell.col - 1, ASPxClientSpreadsheet.Range.MAX_ROW_INDEX));
                    mainPane.setPaneCellVisibleRange(new ASPxClientSpreadsheet.Range(settings.frozenCell.col, settings.frozenCell.row, ASPxClientSpreadsheet.Range.MAX_COL_INDEX, ASPxClientSpreadsheet.Range.MAX_ROW_INDEX));
                    break;
                default:
                    mainPane.setPaneCellVisibleRange(new ASPxClientSpreadsheet.Range(0, 0, ASPxClientSpreadsheet.Range.MAX_COL_INDEX, ASPxClientSpreadsheet.Range.MAX_ROW_INDEX));
                    break;
            }
        },

        // Working with pane infrastructure
        getPaneByType: function(paneType) {
            paneType = paneType ? paneType : ASPxClientSpreadsheet.PaneManager.PanesType.MainPane;
            var pane = this.activePanes[paneType];
            if(!pane && paneType === ASPxClientSpreadsheet.PaneManager.PanesType.MainPane)
                pane = this.createPaneByType(paneType);

            return pane;
        },
        getPaneByCell: function(cellModelPosition) {
            for(var paneType in this.activePanes)
                if(this.activePanes.hasOwnProperty(paneType) && this.activePanes[paneType]) {
                    var pane = this.activePanes[paneType];
                    if(pane.isCellInPaneVisibleRange(cellModelPosition))
                        return pane;
                }
            return null;
        },
        getPaneByCellVisiblePosition: function(cellVisiblePostition) {
            var colModelIndex = this.convertVisibleIndexToModelIndex(cellVisiblePostition.col, true),
                rowModelIndex = this.convertVisibleIndexToModelIndex(cellVisiblePostition.row);
            return this.getPaneByCell({ col: colModelIndex, row: rowModelIndex });
        },
        getPaneTypeByCell: function(cellModelPosition) {
            if(this.getFrozenPaneSettings().isFrozen) {
                var pane = this.getPaneByCell(cellModelPosition);
                return pane ? pane.getPaneType() : null;
            }
            return ASPxClientSpreadsheet.PaneManager.PanesType.MainPane;
        },
        getPaneTypeByEvent: function(evt) {
            var point = this.getOwnerControl().getEventControlPoint(evt);
            return this.getPaneTypeByControlPoint(point);
        },
        getPaneTypeByControlPoint: function(point) {
            var settings = this.getFrozenPaneSettings();
            if(!settings.isFrozen)
                return ASPxClientSpreadsheet.PaneManager.PanesType.MainPane;

            headerOffsetSize = this.getHeaderOffsetSize();
            if(point.x > settings.width + headerOffsetSize.width)
                return point.y > settings.height + headerOffsetSize.height ?
                    ASPxClientSpreadsheet.PaneManager.PanesType.MainPane : ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane;
            return point.y > settings.height + headerOffsetSize.height ? ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane : ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane;
        },
        getHeaderPaneTypeByControlPoint: function(point, isCol) {
            var paneType = this.getPaneTypeByControlPoint(point);
            return this.getHeaderActualPaneType(paneType, isCol);
        },
        getHeaderPaneTypeByCellIndex: function(cellIndex, isCol) {
            var paneType = this.getPaneTypeByCell(isCol ? { col: cellIndex, row: 0 } : { col: 0, row: cellIndex });
            return this.getHeaderActualPaneType(paneType, isCol);
        },
        getHeaderActualPaneType: function(paneType, isCol) {
            if(paneType === ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane)
                paneType = isCol ? ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane : ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane;
            else
                paneType = ASPxClientSpreadsheet.PaneManager.PanesType.MainPane;
            return paneType;
        },
        createPaneByType: function(paneType) {
            var renderHelper = this.getRenderHelper(),
                pane = new ASPxClientSpreadsheet.PaneView(this, renderHelper, paneType);
            this.activePanes[paneType] = pane;

            renderHelper.prepareControlHierarchy(paneType);

            return pane;
        },
        removePaneByType: function(paneType) {
            var workbook = this.getRenderHelper().getWorkbookControl(),
                gridContainer = this.getRenderHelper().getGridContainer(paneType),
                columnContainer = this.getRenderHelper().getColumnHeader(paneType),
                rowContainer = this.getRenderHelper().getRowHeader(paneType);
            if(gridContainer) {
                workbook.removeChild(gridContainer);
                this.getRenderHelper().resetGridTilesContainer(paneType);
            }
            if(columnContainer) {
                workbook.removeChild(columnContainer);
                this.getRenderHelper().resetColumnHeaderTileContainer(paneType);
            }
            if(rowContainer) {
                workbook.removeChild(rowContainer);
                this.getRenderHelper().resetRowHeaderTilesContainer(paneType);
            }
        },

        // Helpers
        getOwnerControl: function() {
            return this.spreadsheetControl;
        },
        getRenderHelper: function() {
            return this.renderHelper;
        },
        // Get TileHelper for main pain
        getTileHelper: function() {
            return this.getPaneByType().getTileHelper();
        },
        getStateController: function() {
            return this.getOwnerControl().getStateController();
        },
        getSelectionHelper: function() {
            return this.getOwnerControl().getSelectionHelper();
        },
        getGridResizingHelper: function() {
            return this.getOwnerControl().getGridResizingHelper();
        },
        //getRenderHelper
        getRenderProvider: function() {
            if(!this.renderProvider)
                this.renderProvider = new ASPxClientSpreadsheet.RenderProvider(this.getOwnerControl());
            return this.renderProvider;
        },

        onVisibleTileRangeChanged: function() {
            this.getOwnerControl().onVisibleTileRangeChanged();
        },

        adjustVisiblePanes: function() {
            this.getOwnerControl().adjustRootControls();
        },
        getScrollHelper: function() {
            if(!this.scrollHelper)
                this.scrollHelper = new ASPxClientSpreadsheet.ScrollHelper(this);
            return this.scrollHelper;
        },
        loadInvisibleTiles: function(loadRequestId) {
            this.getOwnerControl().loadInvisibleTiles(loadRequestId);
        },
        loadInvisibleTilesForFullScreen: function(loadRequestId) {
            this.getOwnerControl().loadInvisibleTilesForFullScreen(loadRequestId);
        },
        loadTilesForNewVisibleRange: function(scrollAnchorPosition) {
            var visibleRange = this.getTileHelper().calculateNewVisibleRange(scrollAnchorPosition);
            if(visibleRange) {
                var loadRequestId = this.getLoadRequestId();

                this.getScrollHelper().setScrollAnchor(scrollAnchorPosition);
                this.getTileHelper().addVisibleRangeToWiatingForLoad(visibleRange, loadRequestId);
                this.loadInvisibleTilesForFullScreen(loadRequestId);

                this.increaseLoadRequestId();
            }
        },
        changeScrollableArea: function(ribbonState) {
            if(ribbonState === ASPxClientRibbonState.Minimized) {
                this.getScrollHelper().changeScrollableAreaOnRibbonMinimizeStateChanged(false, ASPxClientSpreadsheet.Constants.RibbonHeightInRows);
                this.getGridResizingHelper().updateHeaderRanges();
            } else {
                this.getScrollHelper().changeScrollableAreaOnRibbonMinimizeStateChanged(false, -ASPxClientSpreadsheet.Constants.RibbonHeightInRows);
            }
        },
        getLoadRequestId: function() {
            return this.loadTilesRequestId;
        },
        increaseLoadRequestId: function() {
            this.loadTilesRequestId++;
        },
        saveLoadRequestId: function(serverRequestId) {
            this.cuserverRequestId = serverRequestId;
        },
        getCurrentServerRequestId: function() {
            return this.cuserverRequestId;
        },
        getCellElementByModelPosition: function(columnModelIndex, rowModelIndex) {
            return this.getRenderHelper().getCellElementByModelPosition(columnModelIndex, rowModelIndex);
        },
        restoreInitialState: function() {
            this.loadTilesRequestId = 1;
            this.executeMethodForEachPane("removeAllTiles");
        },
        prepareScrollDiv: function() {
            //TODO may be initialize in PaneManager
            this.getScrollHelper().setScrollDivStyle();
        },

        // ForEach Panes API
        executeMethodForEachPane: function() {
            var methodName = arguments[0];
            if(!methodName)
                return;
            for(var paneType in this.activePanes) {
                if(this.activePanes.hasOwnProperty(paneType) && this.activePanes[paneType]) {
                    this.activePanes[paneType][methodName](arguments[1], arguments[2], arguments[3], arguments[4], arguments[5]);
                }
            }
        },
        getObjectValueSearchInEachPane: function() {
            var methodName = arguments[0];
            if(!methodName)
                return;
            for(var paneType in this.activePanes) {
                if(this.activePanes.hasOwnProperty(paneType) && this.activePanes[paneType]) {
                    var objectValue = this.activePanes[paneType][methodName](arguments[1], arguments[2], arguments[3], arguments[4], arguments[5]);
                    if(objectValue)
                        return objectValue;
                }
            }
            return null;
        },
        //TODO to zhuravlev - try to refactor
        getNumericValueSearchInEachPane: function() {
            var methodName = arguments[0];
            if(!methodName)
                return;
            for(var paneType in this.activePanes) {
                if(this.activePanes.hasOwnProperty(paneType) && this.activePanes[paneType]) {
                    var numericValue = this.activePanes[paneType][methodName](arguments[1], arguments[2], arguments[3]);
                    if(numericValue !== null && numericValue >= 0)
                        return numericValue;
                }
            }
            return -1;
        },

        getCellLayoutInfo: function(colVisibleIndex, rowVisibleIndex) {
            var colModelIndex = this.convertVisibleIndexToModelIndex(colVisibleIndex, true),
                rowModelIndex = this.convertVisibleIndexToModelIndex(rowVisibleIndex, false);

            var pane = this.getPaneByCell({ col: colModelIndex, row: rowModelIndex });
            if(pane)
                return pane.getCellLayoutInfo(colVisibleIndex, rowVisibleIndex);
            return this.getObjectValueSearchInEachPane("getCellLayoutInfo", colVisibleIndex, rowVisibleIndex);
        },

        getCellByCoord: function(xPosition, yPosition, paneType) {
            var activePane = this.getPaneByType(paneType);
            if(activePane)
                return activePane.getCellByCoord(xPosition, yPosition);
            return this.getObjectValueSearchInEachPane("getCellByCoord", xPosition, yPosition);
        },
        convertVisibleIndexToModelIndex: function(visibleIndex, isCol) {
            return this.getNumericValueSearchInEachPane("convertVisibleIndexToModelIndex", visibleIndex, isCol);
        },
        convertVisiblePositionToModelPosition: function(colVisibleIndex, rowVisibleIndex) {
            var colIndex = this.convertVisibleIndexToModelIndex(colVisibleIndex, true),
                rowIndex = this.convertVisibleIndexToModelIndex(rowVisibleIndex, false);
            return {
                colIndex: colIndex,
                rowIndex: rowIndex
            };
        },
        convertModelIndicesRangeToVisibleIndices: function(modelTopLeftIndex, modelBottomRightIndex, isCol) {
            if(modelTopLeftIndex < 0 || modelBottomRightIndex < 0)
                return { visibleTopLeftIndex: modelTopLeftIndex, visibleBottomRightIndex: modelBottomRightIndex };

            var bestSearchValue = null;
            for(var paneType in this.activePanes) {
                if(this.activePanes.hasOwnProperty(paneType) && this.activePanes[paneType]) {
                    var visibleRange = this.activePanes[paneType].convertModelIndicesRangeToVisibleIndices(modelTopLeftIndex, modelBottomRightIndex, isCol);
                    if(visibleRange.rangeExist.topLeft && visibleRange.rangeExist.topLeft)
                        return visibleRange;
                    else if(visibleRange.rangeExist.topLeft || visibleRange.rangeExist.topLeft)
                        bestSearchValue = visibleRange;
                    else if(bestSearchValue == null && paneType == ASPxClientSpreadsheet.PaneManager.PanesType.MainPane)
                        bestSearchValue = visibleRange;
                }
            }
            return bestSearchValue;
        },
        convertModelIndexToVisibleIndex: function(modelIndex, isCol) {
            return this.getNumericValueSearchInEachPane("convertModelIndexToVisibleIndex", modelIndex, isCol);
        },
        highlightHeaders: function(selection) {
            if(selection.visible)
                this.executeMethodForEachPane("highlightHeaders", selection);
            else
                this.executeMethodForEachPane("clearHeaderSelection");
        },
        getCellEditingText: function(colModelIndex, rowModelIndex) {
            return this.getObjectValueSearchInEachPane("getCellEditingText", colModelIndex, rowModelIndex);
        },
        getCellValue: function(colModelIndex, rowModelIndex) {
            return this.getObjectValueSearchInEachPane("getCellValue", colModelIndex, rowModelIndex);
        },
        getCellComment: function(colModelIndex, rowModelIndex) {
            return this.getObjectValueSearchInEachPane("getCellComment", colModelIndex, rowModelIndex);
        },
        getCommentInfo: function(colModelIndex, rowModelIndex) {
            return this.getObjectValueSearchInEachPane("getCommentInfo", colModelIndex, rowModelIndex);
        },
        getCommentViewOptions: function(commentId) {
            return this.getObjectValueSearchInEachPane("getCommentViewOptions", commentId);
        },
        getHeaderInfo: function(index, isCol) {
            return this.getObjectValueSearchInEachPane("getHeaderInfo", index, isCol);
        },
        // Model params
        getVisibleRangePaddings: function() {
            return this.getOwnerControl().getVisibleRangePaddings();
        },
        getTileSize: function() {
            return this.getOwnerControl().getTileSize();
        },
        getTileSizes: function(index, isCol) {
            return this.getObjectValueSearchInEachPane("getTileSizes", index, isCol);
        },
        getCellSize: function(uniqueCellIndex, isCol) {
            var tileSize = isCol ? this.getTileSize().col : this.getTileSize().row,
                tileIndex = Math.floor(uniqueCellIndex / tileSize),
                cellIndexInTile = uniqueCellIndex - tileIndex * tileSize;
            return this.getTileSizes(tileIndex, isCol)[cellIndexInTile];
        },
        getTileTotalSize: function(index, isCol) {
            return this.getNumericValueSearchInEachPane("getTileTotalSize", index, isCol);
        },
        getGridTileInfo: function(rowIndex, colIndex) {
            return this.getObjectValueSearchInEachPane("getGridTileInfo", rowIndex, colIndex);
        },
        getActiveCellParentTileInfo: function(selection) {
            return this.getObjectValueSearchInEachPane("getActiveCellParentTileInfo", selection);
        },
        getDefaultCellSize: function() {
            return this.getOwnerControl().getDefaultCellSize();
        },
        getLastFilledCell: function() {
            return this.getOwnerControl().getLastFilledCell();
        },
        isSheetLoaded: function() {
            return this.getOwnerControl().isSheetLoaded();
        },

        isMergerCellContainsInCroppedRange: function(cellVisiblePosition) {
            return this.getObjectValueSearchInEachPane("isMergerCellContainsInCroppedRange", cellVisiblePosition);
        },
        getCellLayoutInfo_ByModelIndices: function(colModelIndex, rowModelIndex) {
            var pane = this.getPaneByCell({ col: colModelIndex, row: rowModelIndex });
            if(pane)
                return pane.getCellLayoutInfo_ByModelIndices(colModelIndex, rowModelIndex);
            return this.getObjectValueSearchInEachPane("getCellLayoutInfo_ByModelIndices", colModelIndex, rowModelIndex);
        },
        // TODO remove duplicates
        serializeCachedTiles: function() {
            var cachedTiles = [];
            for(var paneType in this.activePanes) {
                if(!this.activePanes.hasOwnProperty(paneType)) continue;
                var paneCachedTiles = null;
                if(this.activePanes.hasOwnProperty(paneType) && this.activePanes[paneType])
                    paneCachedTiles = this.activePanes[paneType].getCachedTiles();
                if(paneCachedTiles && paneCachedTiles.length > 0)
                    cachedTiles = cachedTiles.concat(paneCachedTiles);
            }
            return this.getUniqueCachedTiles(cachedTiles);
        },
        getUniqueCachedTiles: function(cachedTiles) {
            var uniqueTileKeys = {},
                unrepeatableTileKeys = [];
            var operateFunction = function(tile) {
                var tileKey = tile.rowIndex + "|" + tile.colIndex;
                if(!uniqueTileKeys[tileKey]) {
                    unrepeatableTileKeys.push(tileKey);
                    uniqueTileKeys[tileKey] = true;
                }
            };
            ASPx.Data.ForEach(cachedTiles, operateFunction);
            return unrepeatableTileKeys.join(";");
        },
        getCellsGridAbsolutePosition: function() {
            var mode = this.getFrozenPaneSettings().mode,
                mainPaneContainer = this.getRenderHelper().getGridContainer(ASPxClientSpreadsheet.PaneManager.PanesType.MainPane),
                mainPaneSize = this.getRenderHelper().getGridOffsetSize(ASPxClientSpreadsheet.PaneManager.PanesType.MainPane),
                mainPaneX = ASPx.GetAbsolutePositionX(mainPaneContainer),
                mainPaneY = ASPx.GetAbsolutePositionY(mainPaneContainer),
                leftPaneContainer,
                topPaneContainer;

            switch(mode) {
                case 0:
                    topPaneContainer = this.getRenderHelper().getGridContainer(ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane);
                    break;
                case 1:
                    leftPaneContainer = this.getRenderHelper().getGridContainer(ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane);
                    break;
                case 2:
                    leftPaneContainer = this.getRenderHelper().getGridContainer(ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane);
                    topPaneContainer = this.getRenderHelper().getGridContainer(ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane);
                    break;
            }

            var left = leftPaneContainer ? ASPx.GetAbsolutePositionX(leftPaneContainer) : mainPaneX,
                top = topPaneContainer ? ASPx.GetAbsolutePositionY(topPaneContainer) : mainPaneY,
                right = mainPaneX + mainPaneSize.width,
                bottom = mainPaneY + mainPaneSize.height;

            return {
                left: left,
                top: top,
                right: right,
                bottom: bottom
            };
        },

        getPopupMenuPosition: function() {
            var selection = this.getOwnerControl().getSelectionInternal();
            var drawingBoxElement = selection.drawingBoxElement;
            var cellLayoutInfo = this.getCellLayoutInfo(selection.activeCellColIndex, selection.activeCellRowIndex);
            if(drawingBoxElement) {
                xPos = ASPx.GetAbsolutePositionX(drawingBoxElement) + drawingBoxElement.clientWidth;
                yPos = ASPx.GetAbsolutePositionY(drawingBoxElement) + drawingBoxElement.clientHeight;
            }
            else {
                var rect = cellLayoutInfo.rect,
                    tileX = ASPx.GetAbsolutePositionX(cellLayoutInfo.tileInfo.htmlElement),
                    tileY = ASPx.GetAbsolutePositionY(cellLayoutInfo.tileInfo.htmlElement);

                xPos = tileX + rect.x + rect.width;
                yPos = tileY + rect.y + rect.height;
            }
            return {
                x: this.correctPopupMenuPosition(xPos, true),
                y: this.correctPopupMenuPosition(yPos, false)
            };
        },

        correctPopupMenuPosition: function(coord, isX) {
            var gridPosition = this.getCellsGridAbsolutePosition(),
                lowerBound = gridPosition.top,
                upperBound = gridPosition.bottom;

            if(isX) {
                lowerBound = gridPosition.left;
                upperBound = gridPosition.right;
            }

            if(coord < lowerBound)
                coord = lowerBound;
            else if(coord > upperBound)
                coord = upperBound;

            return coord;
        },

        // Scrolling and Navigation
        canScrollToShowCell: function(colVisibleIndex, rowVisibleIndex) {
            return this.getObjectValueSearchInEachPane("canScrollToShowCell", colVisibleIndex, rowVisibleIndex);
        },
        gerForwardCell: function(selection, method) {
            var scrollAnchor = this.getPaneTopLeftCellVisiblePosition(),
                colIndex = selection.activeCellColIndex,
                rowIndex = selection.activeCellRowIndex;
            if(selection && selection.activeCellRange)
                method = this.correctNavigateMethod(selection, method);

            switch(method) {
                case "expandDown":
                    colIndex = scrollAnchor.col;
                    rowIndex = selection.range.bottomRowIndex;
                    break;
                case "expandRight":
                    colIndex = selection.range.rightColIndex;
                    rowIndex = scrollAnchor.row;
                    break;
                case "expandUp":

                    colIndex = scrollAnchor.col;
                    rowIndex = selection.range.topRowIndex;
                    break;
                case "expandLeft":
                    colIndex = selection.range.leftColIndex;
                    rowIndex = scrollAnchor.row;
                    break;
            }
            return { col: colIndex, row: rowIndex };
        },
        correctNavigateMethod: function(selection, method) {
            var activeCellLoscatedOnTheLeftOrRightBorder = selection.range.leftColIndex == selection.activeCellRange.leftColIndex || selection.range.rightColIndex == selection.activeCellRange.rightColIndex,
                activeCellLocatedOnTheTopOrBottomBorder = selection.range.topRowIndex == selection.activeCellRange.topRowIndex || selection.range.bottomRowIndex == selection.activeCellRange.bottomRowIndex;
            switch(method) {
                case "expandDown":
                    if(activeCellLocatedOnTheTopOrBottomBorder && selection.activeCellRange.topRowIndex !== selection.range.topRowIndex)
                        method = "expandUp";
                    break;
                case "expandRight":
                    if(activeCellLoscatedOnTheLeftOrRightBorder && selection.activeCellRange.leftColIndex !== selection.range.leftColIndex)
                        method = "expandLeft";
                    break;
                case "expandUp":
                    if(activeCellLocatedOnTheTopOrBottomBorder && selection.activeCellRange.bottomRowIndex !== selection.range.bottomRowIndex)
                        method = "expandDown";
                    break;
                case "expandLeft":
                    if(activeCellLoscatedOnTheLeftOrRightBorder && selection.activeCellRange.rightColIndex !== selection.range.rightColIndex)
                        method = "expandRight";
                    break;
            }
            return method;
        },
        navigateTo: function(stateController, selection, method) {
            var forwardCell = this.gerForwardCell(selection, method),
                colVisibleIndex = forwardCell.col,
                rowVisibleIndex = forwardCell.row,
                colModelIndex = this.convertVisibleIndexToModelIndex(forwardCell.col, true),
                rowModelIndex = this.convertVisibleIndexToModelIndex(forwardCell.row);

            var onBeforeScrollingViaServer = function() { stateController.setSelectionSilently(selection); };

            return this.navigateToCellCore(colModelIndex, rowModelIndex, colVisibleIndex, rowVisibleIndex, onBeforeScrollingViaServer);
        },
        navigateToCell: function(colModelIndex, rowModelIndex) {
            var colVisibleIndex = this.convertModelIndexToVisibleIndex(colModelIndex, true),
                rowVisibleIndex = this.convertModelIndexToVisibleIndex(rowModelIndex, false);
            return this.navigateToCellCore(colModelIndex, rowModelIndex, colVisibleIndex, rowVisibleIndex, function() { });
        },
        navigateToCellCore: function(colModelIndex, rowModelIndex, colVisibleIndex, rowVisibleIndex, onBeforeScrollingViaServer) {
            var cellScrollVisible = false,

                activePane = this.getPaneByCell({ col: colModelIndex, row: rowModelIndex }),
                mainPane = this.getPaneByType(),
                forwardCellAboardDocBoundary = colModelIndex > ASPxClientSpreadsheet.Range.MAX_COL_INDEX || rowModelIndex > ASPxClientSpreadsheet.Range.MAX_ROW_INDEX;
            if(forwardCellAboardDocBoundary)
                return false;
            if(!activePane)
                return;
            var visibleCellRange = this.getDisplayedCellVisibleRange(activePane);
            if(visibleCellRange.isCellInRange(colVisibleIndex, rowVisibleIndex)) {
                cellScrollVisible = true;
            } else {
                var topLeftModelCellPosition = this.convertVisiblePositionToModelPosition(visibleCellRange.leftColIndex, visibleCellRange.topRowIndex),
                    bottomRightModelCellPosition = this.convertVisiblePositionToModelPosition(visibleCellRange.rightColIndex, visibleCellRange.bottomRowIndex),
                    modelCellRange = new ASPxClientSpreadsheet.Range(topLeftModelCellPosition.colIndex, topLeftModelCellPosition.rowIndex,
                        bottomRightModelCellPosition.colIndex, bottomRightModelCellPosition.rowIndex),
                    shiftedScrollAnchorModelPosition = this.getScrollAnchorToMakeCellVisible(activePane, modelCellRange, colModelIndex, rowModelIndex),
                    shiftedScrollAnchorVisiblePosition = { col: this.convertModelIndexToVisibleIndex(shiftedScrollAnchorModelPosition.col, true), row: this.convertModelIndexToVisibleIndex(shiftedScrollAnchorModelPosition.row) };

                var canScrollToNewAnchor = mainPane.canScrollToShowCell(shiftedScrollAnchorVisiblePosition.col, shiftedScrollAnchorVisiblePosition.row);
                var canShowNewSelectedCell = activePane.canScrollToShowCell(colVisibleIndex, rowVisibleIndex);

                if(canScrollToNewAnchor && canShowNewSelectedCell) {
                    var scrollHelper = this.getScrollHelper();

                    scrollHelper.applyScrollAnchor(shiftedScrollAnchorVisiblePosition);
                    scrollHelper.increaseScrollableAreaProportionally();
                    cellScrollVisible = true;
                } else {
                    onBeforeScrollingViaServer();
                    this.getOwnerControl().scrollToViaServer(shiftedScrollAnchorModelPosition.col, shiftedScrollAnchorModelPosition.row, false);
                }
            }
            return cellScrollVisible;
        },
        scrollTo: function(colModelIndex, rowModelIndex, selectAfterScroll) {
            var scrollHelper = this.getScrollHelper(),
                activePane = this.getPaneByCell({ col: colModelIndex, row: rowModelIndex }),
                colVisibleIndex = this.convertModelIndexToVisibleIndex(colModelIndex, true),
                rowVisibleIndex = this.convertModelIndexToVisibleIndex(rowModelIndex, false),
                visibleCellRange = this.getDisplayedCellVisibleRange(activePane),
                cellIsScrollVisible = false;

            if(visibleCellRange.isCellInRange(colVisibleIndex, rowVisibleIndex))
                cellIsScrollVisible = true;
            else if(this.canScrollToShowCell(colVisibleIndex, rowVisibleIndex)) {
                scrollHelper.applyScrollAnchor({ col: colVisibleIndex, row: rowVisibleIndex });
                cellIsScrollVisible = true;
            } else {
                this.getOwnerControl().scrollToViaServer(colModelIndex, rowModelIndex, selectAfterScroll);
            }

            if(cellIsScrollVisible && selectAfterScroll) {
                var range = new ASPxClientSpreadsheet.Range(colVisibleIndex, rowVisibleIndex, colVisibleIndex, rowVisibleIndex);
                var selection = new ASPxClientSpreadsheet.Selection(range);
                this.getStateController().setSelection(selection);
            }
        },
        navigateToBookmark: function(bookmark) {
            var re = /(.+)!([a-zA-Z]+\d+):?([a-zA-Z]+\d+)?/gi;
            if(bookmark.match(re)) {
                var bookmarkRange = re.exec(bookmark),
                    sheetName = bookmarkRange[1].replace(/\'/gi, ""),
                    isTargetSheet = this.getOwnerControl().getDocumentModel().getActiveSheetName() === sheetName,
                    topLeftCellName = bookmarkRange[2],
                    bottomRightCellName = bookmarkRange.length > 3 ? bookmarkRange[3] : null;

                var range = ASPx.SpreadsheetFormulaParser.getCellRangeByCellRepresentation(topLeftCellName, bottomRightCellName);
                if(range) {
                    if(isTargetSheet && this.isTargetCellInVisibleRange(range.leftColIndex, range.topRowIndex)) {
                        this.changeCurrentSelection(range);
                    } else if(isTargetSheet && this.isTargetCellInScrollableRange(range.leftColIndex, range.topRowIndex)) {
                        this.changeScrollPosition(range.leftColIndex, range.topRowIndex);
                        this.changeCurrentSelection(range);
                    } else {
                        var commandParams = { Name: "", SheetName: sheetName, lc: range.leftColIndex, tr: range.topRowIndex, rc: range.rightColIndex, br: range.bottomRowIndex };
                        ASPxClientSpreadsheet.ServerCommands.NavigateToBookmark(this.getOwnerControl(), commandParams);
                    }
                }
            } else {
                var sheetName = "";
                if(bookmark.indexOf("!") >= 0) {
                    var bookmarkRange = bookmark.split("!");

                    sheetName = bookmarkRange[0].replace(/\'/gi, "");
                    bookmark = bookmarkRange[1];
                }
                ASPxClientSpreadsheet.ServerCommands.NavigateToBookmark(this.getOwnerControl(), { Name: bookmark, SheetName: sheetName, lc: 0, tr: 0, rc: 0, br: 0 });
            }
        },
        isTargetCellInVisibleRange: function(colModelIndex, rowModelIndex) {
            var activePane = this.getPaneByCell({ col: colModelIndex, row: rowModelIndex }),
                colVisibleIndex = this.convertModelIndexToVisibleIndex(colModelIndex, true),
                rowVisibleIndex = this.convertModelIndexToVisibleIndex(rowModelIndex, false),
                visibleCellRange = this.getDisplayedCellVisibleRange(activePane);

            return visibleCellRange.isCellInRange(colVisibleIndex, rowVisibleIndex);
        },
        isTargetCellInScrollableRange: function(colModelIndex, rowModelIndex) {
            var colVisibleIndex = this.convertModelIndexToVisibleIndex(colModelIndex, true),
                rowVisibleIndex = this.convertModelIndexToVisibleIndex(rowModelIndex, false);

            return this.canScrollToShowCell(colVisibleIndex, rowVisibleIndex);
        },
        changeCurrentSelection: function(modalRange) {
            var leftColIndex = -1,
                rightColIndex = -1,
                topRowIndex = -1,
                bottomRowIndex = -1;
            if(modalRange.singleCell) {
                leftColIndex = rightColIndex = this.convertModelIndexToVisibleIndex(modalRange.leftColIndex, true);
                topRowIndex = bottomRowIndex = this.convertModelIndexToVisibleIndex(modalRange.topRowIndex, false);
            } else {
                leftColIndex = this.convertModelIndexToVisibleIndex(modalRange.leftColIndex, true);
                rightColIndex = modalRange.leftColIndex !== modalRange.rightColIndex ? this.convertModelIndexToVisibleIndex(modalRange.rightColIndex, true) : leftColIndex;

                topRowIndex = this.convertModelIndexToVisibleIndex(modalRange.topRowIndex, false);
                bottomRowIndex = modalRange.topRowIndex !== modalRange.bottomRowIndex ? this.convertModelIndexToVisibleIndex(modalRange.bottomRowIndex, false) : topRowIndex;
            }
            var visibleRange = new ASPxClientSpreadsheet.Range(leftColIndex, topRowIndex, rightColIndex, bottomRowIndex),
                selection = new ASPxClientSpreadsheet.Selection(visibleRange);
            this.getStateController().setSelection(selection);
        },
        changeScrollPosition: function(colModelIndex, rowModelIndex) {
            var colVisibleIndex = this.convertModelIndexToVisibleIndex(colModelIndex, true),
                rowVisibleIndex = this.convertModelIndexToVisibleIndex(rowModelIndex, false);

            this.getScrollHelper().applyScrollAnchor({ col: colVisibleIndex, row: rowVisibleIndex });
        },
        //TODO to Zhuravlev: try to optimize convertion
        getDisplayedCellVisibleRange: function(activePane) {
            var gridContainer = activePane.getGridContainer(),
                scrollHelper = this.getScrollHelper(),
                scrollContainer = this.getRenderHelper().getScrollContainer(),
                scrollLeft = 0,
                scrollTop = 0,
                width = gridContainer.offsetWidth,
                height = gridContainer.offsetHeight,
                settings = this.getFrozenPaneSettings();

            switch(activePane.getPaneType()) {
                case ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane:
                    scrollTop = scrollHelper.getScrollAreaHeightSizeByIndex(this.convertModelIndexToVisibleIndex(settings.topLeftCell.row, false));
                    scrollLeft = scrollHelper.getScrollAreaWidthSizeByIndex(this.convertModelIndexToVisibleIndex(settings.topLeftCell.col, true));
                    break;
                case ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane:
                    scrollTop = scrollHelper.getScrollAreaHeightSizeByIndex(this.convertModelIndexToVisibleIndex(settings.topLeftCell.row, false));
                    scrollLeft = scrollContainer.scrollLeft + scrollHelper.getMinimumScrollLeftPosition();
                    break;
                case ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane:
                    scrollTop = scrollContainer.scrollTop + scrollHelper.getMinimumScrollTopPosition();
                    scrollLeft = scrollHelper.getScrollAreaWidthSizeByIndex(this.convertModelIndexToVisibleIndex(settings.topLeftCell.col, true));
                    break;
                default: //ASPxClientSpreadsheet.PaneManager.PanesType.MainPane
                    scrollTop = scrollContainer.scrollTop + scrollHelper.getMinimumScrollTopPosition();
                    scrollLeft = scrollContainer.scrollLeft + scrollHelper.getMinimumScrollLeftPosition();
                    break;
            }
            return this.getVisibleCellRangeByScrollSize(scrollLeft, scrollTop, width, height);
        },
        getScrollAnchorToMakeCellVisible: function(activePane, visibleCellRange, colModelIndex, rowModelIndex) {
            var scrollAnchor = this.getScrollHelper().getScrollAnchorModelPosition();
            switch(activePane.getPaneType()) {
                case ASPxClientSpreadsheet.PaneManager.PanesType.MainPane:
                    if(colModelIndex < visibleCellRange.leftColIndex)
                        scrollAnchor.col = colModelIndex;
                    if(colModelIndex > visibleCellRange.rightColIndex)
                        scrollAnchor.col += colModelIndex - visibleCellRange.rightColIndex;
                    if(rowModelIndex < visibleCellRange.topRowIndex)
                        scrollAnchor.row = rowModelIndex;
                    if(rowModelIndex > visibleCellRange.bottomRowIndex)
                        scrollAnchor.row += rowModelIndex - visibleCellRange.bottomRowIndex;
                    break;
                case ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane:
                    if(colModelIndex < visibleCellRange.leftColIndex)
                        scrollAnchor.col = colModelIndex;
                    if(colModelIndex > visibleCellRange.rightColIndex)
                        scrollAnchor.col += colModelIndex - visibleCellRange.rightColIndex;
                    break;
                case ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane:
                    if(rowModelIndex < visibleCellRange.topRowIndex)
                        scrollAnchor.row = rowModelIndex;
                    if(rowModelIndex > visibleCellRange.bottomRowIndex)
                        scrollAnchor.row += rowModelIndex - visibleCellRange.bottomRowIndex;
                    break;
            }
            if(this.getPaneByCell(scrollAnchor))
                return scrollAnchor;

            return this.getScrollHelper().getScrollAnchorModelPosition();
        },
        getVisibleCellRangeByScrollSize: function(scrollLeft, scrollTop, width, height) {
            var scrollHelper = this.getScrollHelper(),
                tileHelper = this.getTileHelper(),
                visibleRange = tileHelper.getVisibleRange(),
                leftColIndex = scrollHelper.getColCountByWidth(scrollLeft),
                topRowIndex = scrollHelper.getRowCountByHeight(scrollTop),
                rightColIndex = scrollHelper.getColCountByWidth(scrollLeft + width) - 1,
                bottomRowIndex = scrollHelper.getRowCountByHeight(scrollTop + height) - 1;

            if(tileHelper.endOfDocumentReachedByRange(true, visibleRange))
                rightColIndex = Math.min(rightColIndex, tileHelper.getEndOfDocumentCellInfo(true).visibleIndex);
            if(tileHelper.endOfDocumentReachedByRange(false, visibleRange))
                bottomRowIndex = Math.min(bottomRowIndex, tileHelper.getEndOfDocumentCellInfo(false).visibleIndex);
            return new ASPxClientSpreadsheet.Range(leftColIndex, topRowIndex, rightColIndex, bottomRowIndex);
        },

        getTopLeftCellVisiblePosition: function() {
            var settings = this.getFrozenPaneSettings();
            if(settings.isFrozen)
                return { col: this.convertModelIndexToVisibleIndex(settings.topLeftCell.col, true), row: this.convertModelIndexToVisibleIndex(settings.topLeftCell.row, false) };
            return this.getScrollAnchorVisiblePosition();
        },

        // Load cached tiles
        isTileVisibleRangeChanged: function() {
            var scrollHelper = this.getScrollHelper(),
                tileHelper = this.getTileHelper(),
                tileVisibleRange = scrollHelper.getVisibleTileRange(),
                scrollAnchor = scrollHelper.getScrollAnchorVisiblePosition(),
                newTileVisibleRange = tileHelper.calculateCurrentVisibleRange(scrollAnchor);

            var changed = newTileVisibleRange !== null && (tileVisibleRange.top !== newTileVisibleRange.top ||
                tileVisibleRange.right !== newTileVisibleRange.right ||
                tileVisibleRange.bottom !== newTileVisibleRange.bottom ||
                tileVisibleRange.left !== newTileVisibleRange.left);

            return changed;
        },
        canLoadTilesFromCache: function() {
            return this.getTileHelper().canLoadTilesFromCache();
        },
        tryLoadTilesFromCache: function() {
            var tileHelper = this.getTileHelper(),
                loadingTilesResult = tileHelper.tryLoadTilesFromCache(),
                settings = this.getFrozenPaneSettings();

            if(loadingTilesResult && settings.isFrozen) {
                var visibleRange = tileHelper.getVisibleRange(),
                    mode = settings.mode,
                    newVisibleRange;
                if(mode !== 1) {
                    var topRightPane = this.getPaneByType(ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane),
                        topRightVisibleRange = topRightPane.getVisibleRange();
                    if(this.isRangeChangedInOneDirection(visibleRange, topRightVisibleRange, true)) {
                        newVisibleRange = { left: visibleRange.left, right: visibleRange.right, top: topRightVisibleRange.top, bottom: topRightVisibleRange.bottom };
                        topRightPane.loadTilesSoftly(newVisibleRange);
                    }
                }
                if(mode !== 0) {
                    var bottomLeftPane = this.getPaneByType(ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane),
                        bottomLeftVisibleRange = bottomLeftPane.getVisibleRange();
                    if(this.isRangeChangedInOneDirection(visibleRange, bottomLeftVisibleRange, false)) {
                        newVisibleRange = { left: bottomLeftVisibleRange.left, right: bottomLeftVisibleRange.right, top: visibleRange.top, bottom: visibleRange.bottom };
                        bottomLeftPane.loadTilesSoftly(newVisibleRange);
                    }
                }
            }
            return loadingTilesResult;
        },
        isRangeChangedInOneDirection: function(visibleRange, paneVisibleRange, isCol) {
            if(isCol)
                return visibleRange.left !== paneVisibleRange.left || visibleRange.right !== paneVisibleRange.right;

            return visibleRange.top !== paneVisibleRange.top || visibleRange.bottom !== paneVisibleRange.bottom;
        },

        getWorkbookVisibleCellRange: function() {
            var settings = this.getFrozenPaneSettings(),
                mode = settings.mode,
                visibleRange = this.getCellVisibleRange();

            switch(mode) {
                case 0: var topRightVisibleRange = this.getCellVisibleRange(ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane);
                    return { top: topRightVisibleRange.top, bottom: visibleRange.bottom, right: visibleRange.right, left: visibleRange.left };
                case 1:
                    var bottomLeftVisibleRange = this.getCellVisibleRange(ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane);
                    return { top: visibleRange.top, bottom: visibleRange.bottom, right: visibleRange.right, left: bottomLeftVisibleRange.left };
                case 2:
                    var frozenVisibleRange = this.getCellVisibleRange(ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane);
                    return { top: frozenVisibleRange.top, bottom: visibleRange.bottom, right: visibleRange.right, left: frozenVisibleRange.left };

                default:
                    return visibleRange;
            }
        },
        putSelectionCellIndexToVisibleDocumentRange: function(index, isCol) {
            var cellVisibleRange = this.getWorkbookVisibleCellRange();
            if(isCol) {
                if(index < cellVisibleRange.left)
                    index = cellVisibleRange.left;

                if(index > cellVisibleRange.right)
                    index = cellVisibleRange.right;
            } else {
                if(index < cellVisibleRange.top)
                    index = cellVisibleRange.top;

                if(index > cellVisibleRange.bottom)
                    index = cellVisibleRange.bottom;
            }
            return index;
        },

        getVisibleModelCellRange: function(paneType) {
            var pane = this.getPaneByType(paneType);
            return pane ? pane.getVisibleModelCellRange() : null;
        },
        getCellVisibleRange: function(paneType) {
            var pane = this.getPaneByType(paneType);
            return pane ? pane.getCellVisibleRange() : null;
        },
        putCellColIndexInVisibleRange: function(colIndex, paneType) {
            var pane = this.getPaneByType(paneType);
            return pane ? pane.putCellColIndexInVisibleRange(colIndex) : colIndex;
        },
        putCellRowIndexInVisibleRange: function(rowIndex, paneType) {
            var pane = this.getPaneByType(paneType);
            return pane ? pane.putCellRowIndexInVisibleRange(rowIndex) : rowIndex;
        },
        getMergedCellRangesIntersectsRange: function(range) {
            range.correct();
            var pane;
            if(this.rangeLocatedInSinglePane(range)) {
                pane = this.getPaneByCell({ col: range.leftColIndex, row: range.topRowIndex });
                return pane.getMergedCellRangesIntersectsRange(range);
            }

            var complexboxes = [];
            for(var paneType in this.activePanes) {
                if(this.activePanes.hasOwnProperty(paneType) && this.activePanes[paneType]) {
                    pane = this.activePanes[paneType];
                    complexboxes = complexboxes.concat(pane.getMergedCellRangesIntersectsRange(range));
                }
            }
            return complexboxes;
        },
        rangeLocatedInSinglePane: function(range) {
            return range.isSingleCell() || this.getPaneTypeByCell({ col: range.leftColIndex, row: range.topRowIndex }) === this.getPaneTypeByCell({ col: range.rightColIndex, row: range.bottomRowIndex });
        },
        getVisibleVisibleCellRange: function(paneType) {
            var pane = this.getPaneByType(paneType);
            return pane ? pane.getVisibleVisibleCellRange() : { top: 0, right: 0, bottom: 0, left: 0 };
        },
        calculateHeaderViewBounds: function() {
            var viewBounds = {};
            for(var paneType in this.activePanes) {
                if(this.activePanes.hasOwnProperty(paneType) && this.activePanes[paneType]) {
                    var pane = this.activePanes[paneType],
                        topLeftCell = this.getPaneTopLeftCellVisiblePosition(paneType);

                    viewBounds[paneType] = pane.calculateViewBoundRange(topLeftCell, this.getRenderHelper().getGridOffsetSize(paneType));
                }
            }
            return viewBounds;
        },
        getVisibleAreaSize: function() {
            var gridOffsetSize = this.getRenderHelper().getGridOffsetSize(),
                headerOffsetSize = this.getHeaderOffsetSize(),
                width = gridOffsetSize.width + headerOffsetSize.width,
                height = gridOffsetSize.height + headerOffsetSize.height,
                pane = this.getPaneByType(ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane);
            if(pane)
                width += this.getRenderHelper().getGridOffsetSize(pane.getPaneType()).width;
            pane = this.getPaneByType(ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane);
            if(pane)
                height += this.getRenderHelper().getGridOffsetSize(pane.getPaneType()).height;
            return { width: width, height: height };
        },

        getScrollAnchorModelPosition: function() {
            return this.getScrollHelper().getScrollAnchorModelPosition();
        },
        getScrollAnchorVisiblePosition: function() {
            return this.getScrollHelper().getScrollAnchorVisiblePosition();
        },
        restoreScrollPositionRequired: function() {
            return this.getScrollHelper().restoreScrollPositionRequired();
        },
        updateScrollPosition: function() {
            this.getScrollHelper().updateScrollPosition();
        },
        createTouchUIScroller: function() {
            this.getScrollHelper().createTouchUIScroller();
        },
        getParentTileInfo: function(selection) {
            return this.getObjectValueSearchInEachPane("getParentTileInfo", selection);
        },
        convertModelRangeToVisible: function(range) {
            var bestSearchValue = null;
            for(var paneType in this.activePanes) {
                if(this.activePanes.hasOwnProperty(paneType) && this.activePanes[paneType]) {
                    var visibleRange = this.activePanes[paneType].convertModelRangeToVisible(range);
                    if(visibleRange.isVisible)
                        return visibleRange;
                    else if(bestSearchValue == null && paneType == ASPxClientSpreadsheet.PaneManager.PanesType.MainPane)
                        bestSearchValue = visibleRange;
                }
            }
            return bestSearchValue;
        },
        convertVisibleRangeToModel: function(range, rangeCorrection) {
            var convertedRange = range.clone(),
                topLeftCellModelPosition = this.convertVisiblePositionToModelPosition(convertedRange.leftColIndex, convertedRange.topRowIndex),
                bottomRightCellModelPosition = this.convertVisiblePositionToModelPosition(convertedRange.rightColIndex, convertedRange.bottomRowIndex);

            if(rangeCorrection) {
                topLeftCellModelPosition.colIndex = topLeftCellModelPosition.colIndex < 0 ? convertedRange.leftColIndex : topLeftCellModelPosition.colIndex;
                topLeftCellModelPosition.rowIndex = topLeftCellModelPosition.rowIndex < 0 ? convertedRange.topRowIndex : topLeftCellModelPosition.rowIndex;
                bottomRightCellModelPosition.colIndex = bottomRightCellModelPosition.colIndex < 0 ? convertedRange.rightColIndex : bottomRightCellModelPosition.colIndex;
                bottomRightCellModelPosition.rowIndex = bottomRightCellModelPosition.rowIndex < 0 ? convertedRange.bottomRowIndex : bottomRightCellModelPosition.rowIndex;
            }

            return new ASPxClientSpreadsheet.Range(topLeftCellModelPosition.colIndex, topLeftCellModelPosition.rowIndex,
                bottomRightCellModelPosition.colIndex, bottomRightCellModelPosition.rowIndex);
        },
        // TODO rework it if selected 1+ panes
        isSelectionVisible: function(selection) {
            return this.getObjectValueSearchInEachPane("isSelectionVisibleInPane", selection);
        },
        setScrollPositionOnHoldenPanes: function(scrolledCellColumnInfo, scrolledCellRowInfo, minimumScrollLeftPosition, minimumScrollTopPosition) {
            var paneType = ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane,
                gridContainer_BL = this.getRenderHelper().getGridContainer(paneType);
            if(gridContainer_BL) {
                gridContainer_BL.scrollLeft = minimumScrollLeftPosition;
                if(scrolledCellRowInfo)
                    gridContainer_BL.scrollTop = scrolledCellRowInfo.gridScrollValue;
                this.getRenderHelper().getColumnHeader(paneType).scrollLeft = minimumScrollLeftPosition;
            }
            paneType = ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane;
            var gridContainer_TR = this.getRenderHelper().getGridContainer(paneType);
            if(gridContainer_TR) {
                if(scrolledCellColumnInfo)
                    gridContainer_TR.scrollLeft = scrolledCellColumnInfo.gridScrollValue;
                gridContainer_TR.scrollTop = minimumScrollTopPosition;
                this.getRenderHelper().getRowHeader(paneType).scrollTop = minimumScrollTopPosition;
            }
            paneType = ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane;
            var gridContainer_FP = this.getRenderHelper().getGridContainer(paneType);
            if(gridContainer_FP) {
                gridContainer_FP.scrollLeft = minimumScrollLeftPosition;
                gridContainer_FP.scrollTop = minimumScrollTopPosition;
            }
        },

        getHeaderOffsetSizeForMousePointer: function(paneType) {
            var headerOffsetSize = this.getHeaderOffsetSize(),
                frozenParams = this.getFrozenPaneSettings();

            switch(paneType) {
                case ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane:
                    return headerOffsetSize;
                case ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane:
                    return {
                        width: headerOffsetSize.width,
                        height: headerOffsetSize.height + frozenParams.height
                    };
                case ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane:
                    return {
                        width: headerOffsetSize.width + frozenParams.width,
                        height: headerOffsetSize.height
                    };
                default:
                    return {
                        width: headerOffsetSize.width + frozenParams.width,
                        height: headerOffsetSize.height + frozenParams.height
                    };
            }
        },
        // Attach Events
        attachEventsToPaneElements: function(paneType) {
            this.attachEventsToGridContainer(paneType);
            this.attachEventsToHeaders(paneType);
            this.attachContextMenuEvents(paneType);
        },

        attachEventToMainElement: function() {
            this.initializeHandlersCore(this.getRenderHelper().GetMainElement(), [ASPx.TouchUIHelper.touchMouseDownEventName], "activateControl");
            this.initializeHandlersCore(this.getRenderHelper().getSelectSheetButton(), [ASPx.TouchUIHelper.touchMouseDownEventName], "dispatchEvent");
        },
        attachEventsToGridContainer: function(paneType) {
            paneType = paneType ? paneType : ASPxClientSpreadsheet.PaneManager.PanesType.MainPane;
            var gridContainer = this.getRenderHelper().getGridContainer(paneType);
            if(gridContainer) {
                var gridContainerEvents;
                if(ASPx.Browser.WebKitTouchUI) {
                    gridContainerEvents = ["touchstart", "touchend", "touchmove"];
                } else if(ASPx.Browser.MSTouchUI) {
                    var spreadsheet = this.getOwnerControl();
                    gridContainerEvents = ["dblclick", "contextmenu", ASPx.TouchUIHelper.touchMouseDownEventName, ASPx.TouchUIHelper.touchMouseMoveEventName];
                    gridContainer.dxMsTouchGesture = ASPx.TouchUIHelper.msTouchCreateGesturesWrapper(gridContainer, spreadsheet.dispatchEvent.aspxBind(spreadsheet));
                } else
                    gridContainerEvents = ["click", "dblclick", "mousedown", "mouseup", "mousemove"];
                this.initializeHandlersCore(gridContainer, gridContainerEvents, "dispatchEvent", paneType);
            }
        },
        attachEventsToHeaders: function(paneType) {
            paneType = paneType ? paneType : ASPxClientSpreadsheet.PaneManager.PanesType.MainPane;
            var rowHeader = this.getRenderHelper().getRowHeader(paneType),
                colHeader = this.getRenderHelper().getColumnHeader(paneType),
                headerEvents;
            if(ASPx.Browser.WebKitTouchUI)
                headerEvents = ["touchstart"];
            else if(ASPx.Browser.MSTouchUI) //TODO to zhuravlev - try union
                headerEvents = ["click", "dblclick", "contextmenu", ASPx.TouchUIHelper.touchMouseMoveEventName, ASPx.TouchUIHelper.touchMouseDownEventName, ASPx.TouchUIHelper.touchMouseUpEventName];
            else
                headerEvents = ["click", "mousedown", "mouseup", "mousemove", "dblclick"];

            if(rowHeader)
                this.initializeHandlersCore(rowHeader, headerEvents, "dispatchRowHeaderEvent", paneType);
            if(colHeader)
                this.initializeHandlersCore(colHeader, headerEvents, "dispatchColHeaderEvent", paneType);
        },
        attachEventsToFormulaBarElements: function() {
            this.initializeHandlersCore(this.getOwnerControl().getCellTextViewElement(), ["click", "keyup"], "dispatchEvent");
            ASPx.Evt.AttachEventToElement(this.getOwnerControl().getCellTextViewElement(), ASPx.TouchUIHelper.touchMouseDownEventName, function(evt) {
                if(ASPx.Evt.IsRightButtonPressed(evt) || ASPx.Browser.MSTouchUI || ASPx.Browser.WebKitTouchUI)
                    this.spreadsheetControl.getStateController().startEditingCurrentCellInFormulaBar();
            }.aspxBind(this));
            var formulaBarMenu = this.getOwnerControl().getFormulaBarMenu();
            var formulaBarMenuElement = formulaBarMenu.GetMainElement();
            ASPx.Evt.AttachEventToElement(formulaBarMenuElement, "mousedown", ASPx.Evt.PreventEventAndBubble);
            ASPx.Evt.AttachEventToElement(formulaBarMenuElement, "mouseup", ASPx.Evt.PreventEventAndBubble);
        },

        initializeHandlersCore: function(element, eventNames, methodName, paneType) {
            var handler = function(evt) { this[methodName](evt, paneType); }.aspxBind(this.getOwnerControl());
            for(var i = 0; i < eventNames.length; i++)
                ASPx.Evt.AttachEventToElement(element, eventNames[i], handler);
            if(!ASPx.Browser.WebKitFamily)
                ASPx.Evt.PreventElementDragAndSelect(element);
        },

        attachContextMenuEvents: function(paneType) {
            paneType = paneType ? paneType : ASPxClientSpreadsheet.PaneManager.PanesType.MainPane;
            var columnHeader = this.getRenderHelper().getColumnHeader(paneType),
                rowHeader = this.getRenderHelper().getRowHeader(paneType),
                grid = this.getRenderHelper().getGridContainer(paneType);

            if(columnHeader) ASPx.Evt.AttachEventToElement(columnHeader, "contextmenu", this.onColumnHeaderContextMenu.aspxBind(this), true);
            if(rowHeader) ASPx.Evt.AttachEventToElement(rowHeader, "contextmenu", this.onRowHeaderContextMenu.aspxBind(this), true);
            if(!ASPx.Browser.WebKitTouchUI)
                ASPx.Evt.AttachEventToElement(grid, "contextmenu", this.onGridContextMenu.aspxBind(this), true);
        },
        onColumnHeaderContextMenu: function(e) {
            this.onContextMenuCore(e, {
                isColumnHeader: true,
                MenuType: ASPxClientSpreadsheetPopupMenuType.ColumnHeading,
                ownerControl: this.getOwnerControl()
            });
        },
        onRowHeaderContextMenu: function(e) {
            this.onContextMenuCore(e, {
                isRowHeader: true,
                MenuType: ASPxClientSpreadsheetPopupMenuType.RowHeading,
                ownerControl: this.getOwnerControl()
            });
        },
        onGridContextMenu: function(e) {
            this.onContextMenuCore(e, {
                MenuType: ASPxClientSpreadsheetPopupMenuType.Cell,
                ownerControl: this.getOwnerControl()
            });
        },
        onContextMenuCore: function(e, context) {
            var srcElement = ASPx.Evt.GetEventSource(e),
                owner = this.getOwnerControl();

            ASPx.Evt.PreventEventAndBubble(e);
            if(!owner.isCommentSelected(srcElement)) {
                this.getOwnerControl().showPopupMenu(e, context);
            }
        },

        getPaneTopLeftCellVisiblePosition: function(paneType) {
            var settings = this.getFrozenPaneSettings(),
                topLeftCell = settings.topLeftCell,
                scrolledCell = this.getScrollHelper().getScrollAnchorVisiblePosition();

            switch(paneType) {
                case ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane:
                    return { col: this.convertModelIndexToVisibleIndex(topLeftCell.col, true), row: this.convertModelIndexToVisibleIndex(topLeftCell.row, false) };

                case ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane:
                    return { col: this.convertModelIndexToVisibleIndex(topLeftCell.col, true), row: scrolledCell.row };

                case ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane:
                    return { col: scrolledCell.col, row: this.convertModelIndexToVisibleIndex(topLeftCell.row, false) };

                default:
                    return scrolledCell;
            }
        },
        getPaneTopLeftCellLayoutInfo: function(paneType) {
            var topLeftCell = this.getPaneTopLeftCellVisiblePosition(paneType);
            if(topLeftCell)
                return this.getPaneByType(paneType).getCellLayoutInfo(topLeftCell.col, topLeftCell.row);
            return null;
        },
        getCellParentTileInfo: function(cell, paneType) {
            var pane = this.getPaneByType(paneType);
            if(pane)
                return pane.getCellParentTileInfo(cell);
            return this.getPaneByType().getCellParentTileInfo(cell);
        },
        moveActiveElementToActiveCell: function(selection) {
            var activeCellColIndex = selection.activeCellColIndex,
                activeCellRowIndex = selection.activeCellRowIndex,
                cellLayoutInfo = this.getCellLayoutInfo(activeCellColIndex, activeCellRowIndex);
            if(cellLayoutInfo && cellLayoutInfo.tileInfo) {
                var element = this.getOwnerControl().getInputController().getInplaceEditor(),
                    rect = cellLayoutInfo.rect;
                rect.x += Math.round(rect.width / 2);
                rect.y += Math.round(rect.height / 2);
                ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementPosWithElementOffset(element, cellLayoutInfo.rect, cellLayoutInfo.tileInfo.htmlElement);
            }
        },
        // Drawing selection elements
        drawSelection: function(selection, keepOldSelection) {
            if(!keepOldSelection)
                this.hideSelection();
            this.correctSelection(selection);

            if(selection.range.isSingleCell() || selection.range.startPaneType === selection.range.endPaneType) {
                this.drawSelectionInSinglePane(selection, keepOldSelection);
            } else {
                this.drawSelectionInMultyPanes(selection, keepOldSelection);
            }
            if(this.getStateController().canShowTouchSelectionElements())
                this.hideTouchSelectionElements(true);
        },
        correctSelection: function(selection) {
            var settings = this.getFrozenPaneSettings(),
                cellModelPosition;
            if(!selection.range.startPaneType) {
                var startPaneType = ASPxClientSpreadsheet.PaneManager.PanesType.MainPane;
                if(settings.isFrozen) {
                    cellModelPosition = this.convertVisiblePositionToModelPosition(selection.range.leftColIndex, selection.range.topRowIndex);
                    startPaneType = this.getPaneTypeByCell({ col: cellModelPosition.colIndex, row: cellModelPosition.rowIndex });
                }
                selection.range.setStartPaneType(startPaneType);
            }
            
            if(!selection.range.endPaneType) {
                var endPaneType = ASPxClientSpreadsheet.PaneManager.PanesType.MainPane;
                if(settings.isFrozen) {
                    cellModelPosition = this.convertVisiblePositionToModelPosition(selection.range.rightColIndex, selection.range.bottomRowIndex);
                    endPaneType = this.getPaneTypeByCell({ col: cellModelPosition.colIndex, row: cellModelPosition.rowIndex });
                }
                selection.range.setEndPaneType(endPaneType);
            }
        },
        drawSelectionInSinglePane: function(selection, keepOldSelection) {
            var activePane = this.getPaneByType(selection.range.startPaneType);
            if(activePane)
                activePane.drawSelection(selection, keepOldSelection);
        },
        drawSelectionInMultyPanes: function(selection, keepOldSelection) {
            selection.correctPaneSelection();

            if(selection.range.diagonalSelection) {
                for(var paneType in this.activePanes) {
                    if(this.activePanes.hasOwnProperty(paneType) && this.activePanes[paneType]) {
                        var pane = this.activePanes[paneType],
                            paneSelection = this.getDiagonalSelectionByPaneType(pane, selection);
                        if(paneSelection.isActiveCellInRange)
                            pane.drawSelection(paneSelection, keepOldSelection);
                        else 
                            pane.drawPartSelection(paneSelection, this.getVisibleBordersForDiagonalSelection(paneType));
                    }
                }
            } else {
                var startPane = this.getPaneByType(selection.range.startPaneType),
                    endPane = this.getPaneByType(selection.range.endPaneType),
                    isHorizontalCrossing = this.isHorizontalCrossing(selection.range.startPaneType, selection.range.endPaneType),
                    startCrossSelection = this.getCrossSelection(startPane, selection, true, isHorizontalCrossing),
                    endCrossSelection = this.getCrossSelection(endPane, selection, false, isHorizontalCrossing);
                
                if(startCrossSelection.isActiveCellInRange)
                    startPane.drawSelection(startCrossSelection, keepOldSelection);
                else
                    startPane.drawPartSelection(startCrossSelection, this.getVisibleBordersForCrossSelection(true, isHorizontalCrossing));

                if(endCrossSelection.isActiveCellInRange)
                    endPane.drawSelection(endCrossSelection, keepOldSelection);
                else
                    endPane.drawPartSelection(endCrossSelection, this.getVisibleBordersForCrossSelection(false, isHorizontalCrossing));
                
            }
        },
        getDiagonalSelectionByPaneType: function(pane, sheetSelection) {
            var selection = sheetSelection.clone(),
                visibleRange = pane.getCellVisibleRange(),
                range = null;

            switch(pane.getPaneType()) {
                case ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane:
                    range = new ASPxClientSpreadsheet.Range(selection.range.leftColIndex, selection.range.topRowIndex, visibleRange.right, visibleRange.bottom);
                    selection.isActiveCellInRange = pane.isCellInPaneVisibleRange({ col: sheetSelection.activeCellRange.leftColIndex, row: sheetSelection.activeCellRange.topRowIndex });
                    break;
                case ASPxClientSpreadsheet.PaneManager.PanesType.MainPane:
                    range = new ASPxClientSpreadsheet.Range(visibleRange.left, visibleRange.top, selection.range.rightColIndex, selection.range.bottomRowIndex);
                    selection.isActiveCellInRange = pane.isCellInPaneVisibleRange({ col: sheetSelection.activeCellRange.rightColIndex, row: sheetSelection.activeCellRange.bottomRowIndex });
                    break;
                case ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane:
                    range = new ASPxClientSpreadsheet.Range(selection.range.leftColIndex, visibleRange.top, visibleRange.right, selection.range.bottomRowIndex);
                    selection.isActiveCellInRange = pane.isCellInPaneVisibleRange({ col: sheetSelection.activeCellRange.leftColIndex, row: sheetSelection.activeCellRange.bottomRowIndex });
                    break;
                case ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane:
                    range = new ASPxClientSpreadsheet.Range(visibleRange.left, selection.range.topRowIndex, selection.range.rightColIndex, visibleRange.bottom);
                    selection.isActiveCellInRange = pane.isCellInPaneVisibleRange({ col: sheetSelection.activeCellRange.rightColIndex, row: sheetSelection.activeCellRange.topRowIndex });
                    break;
            }
            selection.setRange(range);
            return selection;
        },
        getCrossSelection: function(pane, sheetSelection, startPane, isHorizontalCrossing) {
            var selection = sheetSelection.clone(),
                visibleRange = pane.getCellVisibleRange(),
                range = null;

            if(isHorizontalCrossing)
                range = startPane ? new ASPxClientSpreadsheet.Range(selection.range.leftColIndex, selection.range.topRowIndex, visibleRange.right, selection.range.bottomRowIndex) :
                        new ASPxClientSpreadsheet.Range(visibleRange.left, selection.range.topRowIndex, selection.range.rightColIndex, selection.range.bottomRowIndex);
            else
                range = startPane ? new ASPxClientSpreadsheet.Range(selection.range.leftColIndex, selection.range.topRowIndex, selection.range.rightColIndex, visibleRange.bottom) :
                        new ASPxClientSpreadsheet.Range(selection.range.leftColIndex, visibleRange.top, selection.range.rightColIndex, selection.range.bottomRowIndex);
            selection.setRange(range);
            selection.isActiveCellInRange = pane.isCellInPaneVisibleRange({ col: sheetSelection.activeCellRange.leftColIndex, row: sheetSelection.activeCellRange.topRowIndex }) ||
                                            pane.isCellInPaneVisibleRange({ col: sheetSelection.activeCellRange.rightColIndex, row: sheetSelection.activeCellRange.bottomRowIndex });
            return selection;
        },
        isHorizontalCrossing: function(startPaneType, endPaneType) {
            return (startPaneType === ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane && endPaneType == ASPxClientSpreadsheet.PaneManager.PanesType.MainPane) ||
                (startPaneType === ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane && endPaneType == ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane);
        },
        
        getVisibleBordersForDiagonalSelection: function(paneType) {
            switch(paneType) {
                case ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane:
                    return { left: true, top: true };
                case ASPxClientSpreadsheet.PaneManager.PanesType.MainPane:
                    return { right: true, bottom: true };
                case ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane:
                    return { left: true, bottom: true };
                case ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane:
                    return { right: true, top: true };
            }
        },
        getVisibleBordersForCrossSelection: function(showOnTopSide, isHorizontalCrossing) {
            return {
                left: showOnTopSide || !isHorizontalCrossing,
                right: !showOnTopSide || !isHorizontalCrossing,
                top: showOnTopSide || isHorizontalCrossing,
                bottom: !showOnTopSide || isHorizontalCrossing
            };
        },

        // Model box selection
        drawModelBoxSelection: function(modelBox, isCommentBox) {
            for(var paneType in this.activePanes)
                if(this.activePanes.hasOwnProperty(paneType) && this.activePanes[paneType]) {
                    var pane = this.activePanes[paneType];
                    pane.drawModelBoxSelection(modelBox, isCommentBox);
                }  
        },
        hideModelBoxSelection: function() {
            for(var paneType in this.activePanes)
                if(this.activePanes.hasOwnProperty(paneType) && this.activePanes[paneType]) {
                    var pane = this.activePanes[paneType];
                    pane.hideModelBoxSelection();
                }
        },
        hideSelection: function() {
            this.executeMethodForEachPane("hideSelection");
        },
        hideTouchSelectionElements: function(display) {
            this.executeMethodForEachPane("hideTouchSelectionElements", false);
            if(display) {
                var selection = this.getStateController().getSelection(),
                    range = selection.range,
                    leftTopPane = this.getPaneByCell({ col: range.leftColIndex, row: range.topRowIndex }),
                    rightBottomPane = this.getPaneByCell({ col: range.rightColIndex, row: range.bottomRowIndex });
                leftTopPane.hideTouchSelectionElements(true);
                rightBottomPane.hideTouchSelectionElements(true);
                if(selection.entireColsSelected || selection.entireRowsSelected) {
                    var rightTopPane = this.getPaneByCell({ col: range.rightColIndex, row: range.topRowIndex }),
                        leftBottomPane = this.getPaneByCell({ col: range.leftColIndex, row: range.bottomRowIndex });
                    rightTopPane.hideTouchSelectionElements(true);
                    leftBottomPane.hideTouchSelectionElements(true);
                }
            }
        },
        moveDataValidationElementsOnScroll: function() {
            this.getOwnerControl().getValidationHelper().onScroll();
        },
        moveEditingElementOnScroll: function() {
            this.getOwnerControl().getEditingHelper().onScroll();
        },
        moveActiveCommentElementOnScroll: function() {
            this.getOwnerControl().getStateController().onScroll();
        },
        moveTouchSelectionElementsOnScroll: function(selection) {
            this.executeMethodForEachPane("moveTouchSelectionElementsOnScroll", selection);
        },
        isRightBottomTouchSelectionElement: function(element, paneType) {
            var activePane = this.getPaneByType(paneType);
            return activePane.isRightBottomTouchSelectionElement(element);
        }
    });

    ASPxClientSpreadsheet.PaneManager.PanesType = {
        MainPane: "MainPane",
        TopRightPane: "TopRightPane",
        BottomLeftPane: "BottomLeftPane",
        FrozenPane: "FrozenPane"
    };
})();
(function() {
    ASPxClientSpreadsheet.ScrollHelper = ASPx.CreateClass(null, {
        constructor: function(paneManager) {
            this.paneManager = paneManager;
            this.tileSize = this.paneManager.getTileSize();
            this.scrollAnchor = { col: -1, row: -1 };

            this.spacer = 50000 + 1; // header border

            this.lastVisibleCell = { col: 0, row: 0 };

            this.loadTilesTimerID = -1;
            this.loadTilesTimeout = 50;

            this.savedScrollLeft = -1;
            this.savedScrollTop = -1;
            this.contentScrollPosition = { left: -1, top: -1 };
            this.lastScrollingCell = { col: -1, row: -1 };
            this.scrollAnchorLayoutInfo = null;
            this.minimumScrollTopPosition = 0;
            this.minimumScrollLeftPosition = 0;

            this.widthBetweenFrozenCellAndScrollAnchor = 0;
            this.heightBetweenFrozenCellAndScrollAnchor = 0;

            this.deviceScrollBarWidth = this.detectDeviceScollBarWidth();
        },
        getDefaultCellSize: function() { return this.paneManager.getDefaultCellSize(); },
        getRenderHelper: function() { return this.paneManager.getRenderHelper(); },
        getScrollDiv: function() { return this.getRenderHelper().getScrollContainer(); },
        getScrollContent: function() { return this.getRenderHelper().getScrollContent(); },
        getGridContainer: function(paneType) { return this.getRenderHelper().getGridContainer(paneType); },
        getColumnHeader: function() { return this.getRenderHelper().getColumnHeader(); },
        getRowHeader: function() { return this.getRenderHelper().getRowHeader(); },
        getTileHelper: function() { return this.paneManager.getTileHelper(); },
        getVisibleTileRange: function() { return this.getTileHelper().getVisibleRange(); },
        getSpacer: function() {
            return this.spacer;
        },

        setScrollDivStyle: function() {
            var scrollDiv = this.getScrollDiv();
            if(ASPx.Browser.Firefox)
                ASPx.Attr.SetAttribute(scrollDiv, "autocomplete", "off");
        },

        getScrollAnchorVisiblePosition: function() { return this.scrollAnchor; },
        getScrollAnchorModelPosition: function() {
            var scrollAnchorVisiblePosition = this.getScrollAnchorVisiblePosition();
            return {
                col: this.paneManager.convertVisibleIndexToModelIndex(scrollAnchorVisiblePosition.col, true),
                row: this.paneManager.convertVisibleIndexToModelIndex(scrollAnchorVisiblePosition.row, false)
            };
        },
        setScrollAnchor: function(anchor, force) {
            if(anchor && (force || (this.scrollAnchor.col !== anchor.col || this.scrollAnchor.row !== anchor.row))) {
                this.scrollAnchor = anchor;
                this.onScrollAnchorChanged();
            }
        },
        getScrollAnchorLayoutInfo: function() {
            return this.scrollAnchorLayoutInfo;
        },
        updateScrollAnchorLayoutInfo: function() {
            var anchor = this.getScrollAnchorVisiblePosition();
            this.scrollAnchorLayoutInfo = this.paneManager.getCellLayoutInfo(anchor.col, anchor.row);
        },
        getUpdatedScrollAnchorLayoutInfoIfRequired: function() {
            var cellLayoutInfo = this.getScrollAnchorLayoutInfo();
            var scrollAnchor = this.getScrollAnchorVisiblePosition();
            if(cellLayoutInfo === null || cellLayoutInfo.colIndex !== scrollAnchor.col || cellLayoutInfo.rowIndex !== scrollAnchor.row) {
                this.updateScrollAnchorLayoutInfo();
                return this.getScrollAnchorLayoutInfo();
            }
            return cellLayoutInfo;
        },

        getLastVisibleCell: function() {
            var lastFilledCell = this.paneManager.getLastFilledCell();
            return {
                col: Math.max(this.lastVisibleCell.col, lastFilledCell.col),
                row: Math.max(this.lastVisibleCell.row, lastFilledCell.row)
            };
        },
        getIsEditingCellVisible: function(rect, cellLayoutInfo) {
            var editorVisibleInfo = this.getElementVisibleInfo(rect, cellLayoutInfo);
            if(!editorVisibleInfo.fullInvisible) {
                if(editorVisibleInfo.verticalPartiallyVisible || editorVisibleInfo.horizontalPartiallyVisible)
                    this.correctScrollPostitionsWhenEditingStarted(rect, editorVisibleInfo.horizontalPartiallyVisible, editorVisibleInfo.verticalPartiallyVisible);
            }
            return !editorVisibleInfo.fullInvisible;
        },

        createTouchUIScroller: function() {
            if(ASPx.Browser.WebKitTouchUI)
                this.touchUIScroller = new ASPx.TouchUIHelper.ScrollExtender(this.getScrollDiv(),
                    { forceCustomScroll: true, touchEventHandlersElement: this.getGridContainer(), acceleration: 0, enableMultiTouchScrolling: false });
            if(ASPx.Browser.MSTouchUI) {
                var grid = this.getGridContainer();
                var scrollElement = this.getScrollDiv();
                this.onMsTouchMouseDown = function(e) {
                    if(this.needToPreventScrollOnEvent(e))
                        return;
                    this.initMSScrollLeft = scrollElement.scrollLeft;
                    this.initMSScrollTop = scrollElement.scrollTop;
                    this.initMSPageX = e.pageX;
                    this.initMSPageY = e.pageY;
                    ASPx.Evt.AttachEventToElement(grid, ASPx.TouchUIHelper.touchMouseMoveEventName, this.onMsTouchMouseMove);
                }.aspxBind(this);
                this.onMsTouchMouseMove = function(e) {
                    if(this.needToPreventScrollOnEvent(e))
                        return;
                    var newX = this.initMSScrollLeft + (this.initMSPageX - e.pageX);
                    var newY = this.initMSScrollTop + (this.initMSPageY - e.pageY);
                    scrollElement.scrollLeft = newX;
                    scrollElement.scrollTop = newY;
                }.aspxBind(this);
                ASPx.Evt.AttachEventToElement(grid, ASPx.TouchUIHelper.touchMouseDownEventName, this.onMsTouchMouseDown);
                this.onMsTouchMouseUp = function() {
                    ASPx.Evt.DetachEventFromElement(grid, ASPx.TouchUIHelper.touchMouseMoveEventName, this.onMsTouchMouseMove);
                }.aspxBind(this);
            }
        },
        needToPreventScrollOnEvent: function(evt) {
            return this.paneManager.getRenderHelper().getIsTouchSelectionElement(ASPx.Evt.GetEventSource(evt)) ||
                this.paneManager.getStateController().isDrawingBoxDragingOrResizingInProcess() ||
                this.paneManager.getStateController().isCommentBoxDragingOrResizingInProcess();
        },

        //TODO to zhuravlev - think about recalculate optimization
        getMinimumScrollTopPosition: function() {
            var settings = this.paneManager.getFrozenPaneSettings(),
                frozenCell = settings.frozenCell;

            this.heightBetweenFrozenCellAndScrollAnchor = frozenCell ? this.getScrollAreaHeightSizeByIndex(this.paneManager.convertModelIndexToVisibleIndex(frozenCell.row, false)) : 0;
            return this.heightBetweenFrozenCellAndScrollAnchor;
        },
        getMinimumScrollLeftPosition: function() {
            var settings = this.paneManager.getFrozenPaneSettings(),
                frozenCell = settings.frozenCell;

            this.widthBetweenFrozenCellAndScrollAnchor = frozenCell ? this.getScrollAreaWidthSizeByIndex(this.paneManager.convertModelIndexToVisibleIndex(frozenCell.col, true)) : 0;
            return this.widthBetweenFrozenCellAndScrollAnchor;
        },
        detectDeviceScollBarWidth: function() {
            var scrollDiv = document.createElement("div");
            scrollDiv.style.cssText = 'width: 100px; height: 100px; overflow: scroll !important; position: absolute; top: -9999px';
            document.body.appendChild(scrollDiv);
            var scrollWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;
            document.body.removeChild(scrollDiv);
            return scrollWidth;
        },
        getDeviceScrollBarWidth: function() {
            return this.deviceScrollBarWidth;
        },

        onScrollAnchorChanged: function() {
            var scrollAnchor = this.getScrollAnchorVisiblePosition(),
                scrollDiv = this.getScrollDiv();

            scrollDiv.scrollLeft = this.getScrollAreaWidthSizeByIndex(scrollAnchor.col) - this.getMinimumScrollLeftPosition();
            scrollDiv.scrollTop = this.getScrollAreaHeightSizeByIndex(scrollAnchor.row) - this.getMinimumScrollTopPosition();
        },

        updateScrollPosition: function() {
            this.ensureScrollPosition(true);
        },

        //use only when get data from server
        processDocumentResponse: function(response) {
            var serverScrollAnchor = response[ASPxClientSpreadsheet.ResponseStringKeys.ScrollAnchor],
                scrollAnchorInVisibleRange = null,
                force = response[ASPxClientSpreadsheet.ResponseStringKeys.ClearClientCache] === 1;

            if(serverScrollAnchor) {
                scrollAnchorInVisibleRange = {
                    col: this.paneManager.convertModelIndexToVisibleIndex(serverScrollAnchor[ASPxClientSpreadsheet.DocumentModel.CellStringKeys.Column], true),
                    row: this.paneManager.convertModelIndexToVisibleIndex(serverScrollAnchor[ASPxClientSpreadsheet.DocumentModel.CellStringKeys.Row], false)
                };
            } else { //scroll anchor visible position was changed - in freeze panes mode
                var settings = this.paneManager.getFrozenPaneSettings();
                if(settings.isFrozen) {
                    var scrollAnchorVisiblePosition = this.getScrollAnchorVisiblePosition(),
                        scrollAnchorModelPosition = this.getScrollAnchorModelPosition(),
                        updatedScrollAnchorCol = this.paneManager.convertModelIndexToVisibleIndex(scrollAnchorModelPosition.col, true),
                        updatedScrollAnchorRow = this.paneManager.convertModelIndexToVisibleIndex(scrollAnchorModelPosition.row, false);
                    if(scrollAnchorVisiblePosition.row !== updatedScrollAnchorRow || scrollAnchorVisiblePosition.col !== updatedScrollAnchorCol) {
                        scrollAnchorInVisibleRange = {
                            col: updatedScrollAnchorCol,
                            row: updatedScrollAnchorRow
                        };
                    }
                }
            }
            this.applyScrollAnchor(scrollAnchorInVisibleRange, force);
        },
        applyScrollAnchor: function(scrollAnchor, force) {
            this.assignHandlers();
            this.updateScrollSize(true);

            this.captureScrollPositionForKeyBoardNavigation();

            this.setScrollAnchor(scrollAnchor, force);
            this.updateScrollPosition();

            this.releaseScrollPositionForKeyBoardNavigation();
        },
        assignHandlers: function() {
            var scrollDiv = this.getScrollDiv();
            if(!scrollDiv.dxScrollHandlerAssigned) {
                ASPx.Evt.AttachEventToElement(scrollDiv, "scroll", function(e) { this.onScroll(e); }.aspxBind(this));
                ASPx.Evt.AttachEventToElement(scrollDiv, "mousedown", function(e) { this.onMouseDown(e); }.aspxBind(this));
                scrollDiv.dxScrollHandlerAssigned = true;
            }
            var mainDiv = this.paneManager.getRenderHelper().getWorkbookControl();
            if(ASPx.IsExists(mainDiv) && !mainDiv.dxWheelHandlerAssigned) {
                ASPx.Evt.AttachEventToElement(mainDiv, ASPx.Evt.GetMouseWheelEventName(), function(e) { this.onMouseWheel(e); }.aspxBind(this));
                mainDiv.dxWheelHandlerAssigned = true;
            }

            if(ASPx.Browser.IE)
                ASPx.Evt.AttachEventToElement(this.getGridContainer(), "scroll", function(e) { this.onGridScrollIE(e); }.aspxBind(this));
        },

        onGridScrollIE: function(e) {
            if(this.restoreScrollPositionRequired()) {
                var div = this.getScrollDiv(),
                    col = this.getColCountByWidth(div.scrollLeft + this.getMinimumScrollLeftPosition()),
                    row = this.getRowCountByHeight(div.scrollTop + this.getMinimumScrollTopPosition());

                var scrollInfo = this.getScrollInfo(this.getTileHelper(), col, true);
                this.getGridContainer().scrollLeft = scrollInfo.gridScrollValue;

                scrollInfo = this.getScrollInfo(this.getTileHelper(), row, false);
                this.getGridContainer().scrollTop = scrollInfo.gridScrollValue;
            }
        },

        onScroll: function(e) {
            if(!this.paneManager.isSheetLoaded()) return; // WORKAROUND for IE9-
            this.ensureScrollPosition();
            if(ASPx.Browser.TouchUI) {
                this.increaseScrollableAreaProportionally();
                var selection = this.paneManager.getStateController().getSelection();
                if(selection.entireColsSelected || selection.entireRowsSelected) {
                    this.paneManager.moveTouchSelectionElementsOnScroll(selection);
                    this.paneManager.getGridResizingHelper().onScroll();
                }
            }
            this.paneManager.moveDataValidationElementsOnScroll();
            this.paneManager.moveEditingElementOnScroll();
            this.paneManager.moveActiveCommentElementOnScroll();
        },
        onMouseWheel: function(e) {
            if(!e.ctrlKey) {
                if(ASPx.Evt.IsWheelEventWithDirection(e))
                    this.setScrollDependingOnDirection(e);
                else
                    this.setScroll(ASPx.Evt.GetWheelDelta(e), this.getDefaultCellSize().height, false);
                return ASPx.Evt.PreventEvent(e);
            }
        },
        setScrollDependingOnDirection: function(e) {
            var deltaX = ASPx.Evt.GetWheelDeltaX(e);
            var deltaY = ASPx.Evt.GetWheelDeltaY(e);
            if(Math.abs(deltaY) >= Math.abs(deltaX))
                this.setScroll(deltaY, this.getDefaultCellSize().height, false);
            else
                this.setScroll(deltaX, this.getDefaultCellSize().width, true);
        },
        setScroll: function(wheelDelta, defaultCellSize, isHorz) {
            var deltaDivider = ASPx.Browser.NetscapeFamily ? 3 : 30;
            var div = this.getScrollDiv();
            var absDelta = Math.ceil(Math.abs(wheelDelta / deltaDivider));
            var delta = wheelDelta > 0 ? absDelta : -absDelta;
            var scrollDelta = -1 * delta * ASPxClientSpreadsheet.ScrollHelper.Constants.ScrollTopRowStep * defaultCellSize;

            this.increaseScrollableAreaIfNeeded(isHorz);
            if (isHorz)
                div.scrollLeft += scrollDelta;
            else
                div.scrollTop += scrollDelta;
        },
        onMouseDown: function(e) {
            var x = ASPx.Evt.GetEventX(e);
            var y = ASPx.Evt.GetEventY(e);

            var scrollDiv = this.getScrollDiv();
            var scrollDivX = ASPx.GetAbsoluteX(scrollDiv);
            var scrollDivY = ASPx.GetAbsoluteY(scrollDiv);
            var scrollDivWidth = ASPx.PxToInt(scrollDiv.style.width);
            var scrollDivHeight = ASPx.PxToInt(scrollDiv.style.height);

            var scrollSize = ASPx.GetVerticalScrollBarWidth();

            var xOffset = scrollDivWidth - x + scrollDivX;
            var yOffset = scrollDivHeight - y + scrollDivY;
            var isBottomButton = xOffset <= scrollSize && yOffset <= 2 * scrollSize && yOffset >= scrollSize;
            var isRightButton = yOffset <= scrollSize && xOffset <= 2 * scrollSize && xOffset >= scrollSize;
            
            if(isRightButton)
                this.increaseScrollableAreaIfNeeded(true);
            if(isBottomButton)
                this.increaseScrollableAreaIfNeeded(false);
        },
        increaseScrollableAreaProportionally: function() {
            this.increaseScrollableAreaIfNeeded(true);
            this.increaseScrollableAreaIfNeeded(false);
        },
        increaseScrollableAreaIfNeeded: function(isHorz) {
            var hasNoMoreScrollSpace = isHorz ? this.getHorzScrollRightSpace() <= 0 : this.getVertScrollBottomSpace() <= 0;
            if(hasNoMoreScrollSpace) {
                var lastVisibleCell = this.getLastVisibleCell();
                if(this.hasAnyCellsForward(isHorz))
                    this.changeScrollableArea(isHorz, lastVisibleCell);
            }
        },
        hasAnyCellsForward: function(isHorz) {
            var tileHelper = this.getTileHelper();
            return !tileHelper.endOfDocumentReachedByRange(isHorz, tileHelper.getVisibleRange());
        },
        changeScrollableAreaOnRibbonMinimizeStateChanged: function(isHorz, colOrRowSize) {
            var hasNoMoreScrollSpace = isHorz ? this.getHorzScrollRightSpace() <= 0 : this.getVertScrollBottomSpace() <= 0;
            if(hasNoMoreScrollSpace && this.hasAnyCellsForward(isHorz)) {
                var lastVisibleCell = this.getLastVisibleCell();

                if(isHorz)
                    lastVisibleCell.col += colOrRowSize;
                else
                    lastVisibleCell.row += colOrRowSize;
                this.lastVisibleCell = lastVisibleCell;

                this.updateScrollSize();
            }
        },
        changeScrollableArea: function(isHorz, lastVisibleCell) {
            if(isHorz)
                lastVisibleCell.col += this.tileSize.col;
            else
                lastVisibleCell.row += this.tileSize.row;
            this.lastVisibleCell = lastVisibleCell;
            this.updateScrollSize();
        },
        getTopLeftCellByScrollPosition: function() {
            var div = this.getScrollDiv(),
                left = Math.round(div.scrollLeft + this.getMinimumScrollLeftPosition()),
                top = Math.round(div.scrollTop + this.getMinimumScrollTopPosition());

            return new ASPxClientSpreadsheet.DocumentModel.CellPosition(this.getColCountByWidth(left), this.getRowCountByHeight(top));
        },
        captureScrollPositionForKeyBoardNavigation: function() {
            this.cachedScrollAnchor = this.getScrollAnchorVisiblePosition();
        },
        releaseScrollPositionForKeyBoardNavigation: function() {
            this.cachedScrollAnchor = null;
        },
        getHorizontalScrollDirection: function(scrollAnchor, colIndex, forceChanged) {
            if(this.cachedScrollAnchor && forceChanged && scrollAnchor.col === colIndex)
                return this.cachedScrollAnchor.col > scrollAnchor.col;
            return colIndex < scrollAnchor.col;
        },
        getVerticalScrollDirection: function(scrollAnchor, rowIndex, forceChanged) {
            if(this.cachedScrollAnchor && forceChanged && scrollAnchor.row === rowIndex)
                return this.cachedScrollAnchor.row > scrollAnchor.row;
            return rowIndex < scrollAnchor.row;
        },
        ensureScrollPosition: function(forceChanged) {
            var div = this.getScrollDiv();
            var left = Math.ceil(div.scrollLeft + this.getMinimumScrollLeftPosition());
            var top = Math.ceil(div.scrollTop + this.getMinimumScrollTopPosition());

            if(this.restoreScrollPositionRequired()) {
                div.scrollLeft = left = this.contentScrollPosition.left;
                div.scrollTop = top = this.contentScrollPosition.top;
            }
            if(this.needToRestoreScrollPositionOnAdjust) {
                div.scrollLeft = this.contentScrollPosition.left;
                left = this.contentScrollPosition.left + this.getMinimumScrollLeftPosition();
                div.scrollTop = this.contentScrollPosition.top;
                top = this.contentScrollPosition.top + this.getMinimumScrollTopPosition();
            }
            var col = this.getColCountByWidth(left);
            var row = this.getRowCountByHeight(top);
            var scrollAnchor = this.getScrollAnchorVisiblePosition();
            var colChanged = col !== scrollAnchor.col || forceChanged;
            var rowChanged = row !== scrollAnchor.row || forceChanged;

            var scrollToLeft = this.getHorizontalScrollDirection(scrollAnchor, col, forceChanged);
            var scrollToTop = this.getVerticalScrollDirection(scrollAnchor, row, forceChanged);

            if(!colChanged && !rowChanged)
                return;
            this.setScrollAnchor({ col: col, row: row });
            this.ensureScrolledTiles(col, row, scrollToLeft, scrollToTop);
            var scrolledCellColumnInfo = null;

            if(colChanged) {
                scrolledCellColumnInfo = this.getScrollInfo(this.getTileHelper(), col, true);
                this.getGridContainer().scrollLeft = scrolledCellColumnInfo.gridScrollValue;
                this.getColumnHeader().scrollLeft = scrolledCellColumnInfo.headerScrollValue;
                this.saveScrollLeftPosition(this.getGridContainer().scrollLeft);
            }

            var scrolledCellRowInfo = null;
            if(rowChanged) {
                scrolledCellRowInfo = this.getScrollInfo(this.getTileHelper(), row, false);
                this.getGridContainer().scrollTop = scrolledCellRowInfo.gridScrollValue;
                this.getRowHeader().scrollTop = scrolledCellRowInfo.headerScrollValue;
                this.saveScrollTopPosition(this.getGridContainer().scrollTop);
            }

            var settings = this.paneManager.getFrozenPaneSettings();
            if(settings && settings.topLeftCell) {
                this.updateScrollPositionsOnHoldenPanes(settings);
                this.paneManager.setScrollPositionOnHoldenPanes(scrolledCellColumnInfo, scrolledCellRowInfo, this.minimumScrollLeftPosition, this.minimumScrollTopPosition);
            }

            this.saveContentScrollPosition(div);
        },
        onFrozenPaneSettingsChanged: function() {
            this.updateScrollAfterMainPane = true;
        },
        updateScrollPositionsOnHoldenPanes: function(settings) {
            if(this.updateScrollAfterMainPane || this.topLeftCellPositionChanged(settings)) {
                this.updateScrollAfterMainPane = false;
                if(settings && settings.topLeftCell) {
                    var topLeftCell = settings.topLeftCell,
                        mode = settings.mode,
                        pane = this.paneManager.getPaneByCell(topLeftCell),
                        tileHelper = pane.getTileHelper(),
                        col = this.paneManager.convertModelIndexToVisibleIndex(topLeftCell.col, true),
                        row = this.paneManager.convertModelIndexToVisibleIndex(topLeftCell.row, false),
                        scrollColumnInfo = this.getScrollInfo(tileHelper, col, true),
                        scrollRowInfo = this.getScrollInfo(tileHelper, row, false);

                    this.topLeftCellVisiblePosition = { col: col, row: row };
                    this.minimumScrollTopPosition = mode !== 1 ? scrollRowInfo.gridScrollValue : 0;
                    this.minimumScrollLeftPosition = mode !== 0 ? scrollColumnInfo.gridScrollValue : 0;
                } else {
                    this.minimumScrollTopPosition = 0;
                    this.minimumScrollLeftPosition = 0;
                }
            }
        },
        topLeftCellPositionChanged: function(settings) {
            var currentTopLeftCell = this.topLeftCellVisiblePosition,
                newTopLeftCellVisiblePosition = {
                    col: this.paneManager.convertModelIndexToVisibleIndex(settings.topLeftCell.col, true),
                    row: this.paneManager.convertModelIndexToVisibleIndex(settings.topLeftCell.row, false)
                };
            return currentTopLeftCell && (currentTopLeftCell.col !== newTopLeftCellVisiblePosition.col || currentTopLeftCell.row !== newTopLeftCellVisiblePosition.row);
        },

        getScrollContentAreaWidthSize: function() {
            var lastVisibleCell = this.getLastVisibleCell();
            var colIndex = lastVisibleCell.col;
            var tileIndex = Math.floor(colIndex / this.tileSize.col);

            var size = 0;
            var counterIndex = 0;
            for(counterIndex; counterIndex < tileIndex; counterIndex++) {
                var headerInfo = this.paneManager.getHeaderInfo(counterIndex, true);
                if(headerInfo)
                    size += headerInfo.totalWidth;
                else break;
            }

            var headerWidth = this.paneManager.getHeaderInfo(counterIndex, true);
            var lastColInRange = 0;
            if(headerWidth) {
                lastColInRange = colIndex - counterIndex * this.tileSize.col;
                lastColInRange = lastColInRange + ASPxClientSpreadsheet.ScrollHelper.Constants.AdditionalColToView > headerWidth.incrementalWidths.length - 1 ?
                            headerWidth.incrementalWidths.length - 1 : lastColInRange + ASPxClientSpreadsheet.ScrollHelper.Constants.AdditionalColToView;
                size += headerWidth.incrementalWidths[lastColInRange];
            }
            if((lastColInRange + counterIndex * this.tileSize.col) != colIndex) {
                colIndex -= (lastColInRange + counterIndex * this.tileSize.col - ASPxClientSpreadsheet.ScrollHelper.Constants.AdditionalColToView);
                if(colIndex > 0)
                    size += this.getDefaultCellSize().width * (colIndex + 1);
            }
            var controlVisibleWidth = this.getControlVisibleWidth();
            if(controlVisibleWidth < size) {
                size = size + controlVisibleWidth - this.getDefaultCellSize().width;
            }
            return size;
        },
        getScrollContentAreaHeightSize: function() {
            var lastVisibleCell = this.getLastVisibleCell();
            var rowIndex = lastVisibleCell.row;
            var tileIndex = Math.floor(rowIndex / this.tileSize.row);

            var size = 0;
            var counterIndex = 0;
            for(counterIndex; counterIndex < tileIndex; counterIndex++) {
                var headerInfo = this.paneManager.getHeaderInfo(counterIndex, false);
                if(headerInfo)
                    size += headerInfo.totalHeight;
                else break;
            }

            var headerWidth = this.paneManager.getHeaderInfo(counterIndex, false);
            var lastRowInRange = 0;
            if(headerWidth) {
                lastRowInRange = rowIndex - counterIndex * this.tileSize.row;
                lastRowInRange = lastRowInRange + ASPxClientSpreadsheet.ScrollHelper.Constants.AdditionalRowToView >= headerWidth.incrementalHeights.length - 1 ?
                            headerWidth.incrementalHeights.length - 1 : lastRowInRange + ASPxClientSpreadsheet.ScrollHelper.Constants.AdditionalRowToView;
                size += headerWidth.incrementalHeights[lastRowInRange];
            }
            if((lastRowInRange + counterIndex * this.tileSize.row) != rowIndex) {
                rowIndex = rowIndex - (lastRowInRange + counterIndex * this.tileSize.row - ASPxClientSpreadsheet.ScrollHelper.Constants.AdditionalRowToView);
                if(rowIndex > 0)
                    size += this.getDefaultCellSize().height * (rowIndex + 1);
            }
            var controlVisibleHeight = this.getControlVisibleHeight();
            if(controlVisibleHeight < size) {
                size = size + controlVisibleHeight - this.getDefaultCellSize().height;
            }
            return size;
        },

        getControlVisibleWidth: function() {
            var settings = this.paneManager.getFrozenPaneSettings(),
                visibleAreaWidth = this.getGridContainer().offsetWidth;

            if(settings.isFrozen) {
                blPaneContainer = this.getGridContainer(ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane);
                if(blPaneContainer)
                    visibleAreaWidth += blPaneContainer.offsetWidth;
            }
            return visibleAreaWidth;
        },
        getControlVisibleHeight: function() {
            var settings = this.paneManager.getFrozenPaneSettings(),
                visibleAreaHeight = this.getGridContainer().offsetHeight;
            if(settings.isFrozen) {
                trPaneContainer = this.getGridContainer(ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane);
                if(trPaneContainer)
                    visibleAreaHeight += trPaneContainer.offsetHeight;
            }
            return visibleAreaHeight;
        },

        getScrollAreaWidthSizeByIndex: function(colIndex) {
            var tileIndex = Math.floor(colIndex / this.tileSize.col);

            var size = 0;
            var counterIndex = 0;
            for(counterIndex; counterIndex < tileIndex; counterIndex++) {
                var headerInfo = this.paneManager.getHeaderInfo(counterIndex, true);
                if(headerInfo)
                    size += headerInfo.totalWidth;
                else break;
            }

            var headerWidth = this.paneManager.getHeaderInfo(counterIndex, true);
            var lastColInRange = 0;
            if(headerWidth) {
                lastColInRange = colIndex - counterIndex * this.tileSize.col;
                lastColInRange = lastColInRange > headerWidth.incrementalWidths.length ? headerWidth.incrementalWidths.length - 1 : lastColInRange;
                size += headerWidth.incrementalWidths[lastColInRange];
            }
            if((lastColInRange + counterIndex * this.tileSize.col) != colIndex) {
                colIndex -= (lastColInRange + counterIndex * this.tileSize.col);
                if(colIndex > 0)
                    size += this.getDefaultCellSize().width * colIndex;
            }
            return size;
        },
        getScrollAreaHeightSizeByIndex: function(rowIndex) {
            var tileIndex = Math.floor(rowIndex / this.tileSize.row);

            var size = 0;
            var counterIndex = 0;
            for(counterIndex; counterIndex < tileIndex; counterIndex++) {
                var headerInfo = this.paneManager.getHeaderInfo(counterIndex, false);
                if(headerInfo)
                    size += headerInfo.totalHeight;
                else break;
            }

            var headerWidth = this.paneManager.getHeaderInfo(counterIndex, false);
            var lastRowInRange = 0;
            if(headerWidth) {
                lastRowInRange = rowIndex - counterIndex * this.tileSize.row;
                lastRowInRange = lastRowInRange > headerWidth.incrementalHeights.length ? headerWidth.incrementalHeights.length - 1 : lastRowInRange;
                size += headerWidth.incrementalHeights[lastRowInRange];
            }
            if((lastRowInRange + counterIndex * this.tileSize.row) != rowIndex) {
                rowIndex = rowIndex - (lastRowInRange + counterIndex * this.tileSize.row);
                if(rowIndex > 0)
                    size += this.getDefaultCellSize().height * rowIndex;
            }
            return size;
        },

        getColCountByWidth: function(width) {
            var summarySize = 0,
                counterIndex = 0,
                colIndex = 0;
            while(summarySize < width) {
                var headerInfo = this.paneManager.getHeaderInfo(counterIndex, true);
                if(headerInfo) {
                    if(width < headerInfo.totalWidth) { //col in this tile
                        for(var i = 0; i < headerInfo.widths.length; i++) {
                            summarySize += headerInfo.widths[i];
                            if(width < summarySize) {
                                colIndex += i;
                                break;
                            }
                        }
                    } else {
                        counterIndex++;
                        width -= headerInfo.totalWidth;
                        colIndex += this.tileSize.col;
                    }
                } else break;
            }
            if(width - summarySize > 0)
                colIndex += Math.floor(width / this.getDefaultCellSize().width);
            return colIndex;
        },
        getRowCountByHeight: function(height) {
            var summarySize = 0,
                counterIndex = 0,
                colIndex = 0;
            while(summarySize < height) {
                var headerInfo = this.paneManager.getHeaderInfo(counterIndex, false);
                if(headerInfo) {
                    if(height < headerInfo.totalHeight) { //col in this tile
                        for(var i = 0; i < headerInfo.heights.length; i++) {
                            summarySize += headerInfo.heights[i];
                            if(height < summarySize) {
                                colIndex += i;
                                break;
                            }
                        }
                    } else {
                        counterIndex++;
                        height -= headerInfo.totalHeight;
                        colIndex += this.tileSize.row;
                    }
                } else break;
            }
            if(height - summarySize > 0)
                colIndex += Math.floor(height / this.getDefaultCellSize().height);
            return colIndex;
        },

        restoreScrollPositionRequired: function() {
            return ASPx.Browser.IE && ((this.savedScrollTop !== this.spacer && this.savedScrollTop >= 0 && this.savedScrollTop !== this.getVerticalScrollPosition()) ||
                    (this.savedScrollLeft !== this.spacer && this.savedScrollLeft >= 0 && this.savedScrollLeft !== this.getHorizontalScrollPosition()));
        },
        saveScrollLeftPosition: function(value) {
            this.savedScrollLeft = value;
        },
        saveScrollTopPosition: function(value) {
            this.savedScrollTop = value;
        },
        saveContentScrollPosition: function(divElement) {
            this.contentScrollPosition.top = divElement.scrollTop;
            this.contentScrollPosition.left = divElement.scrollLeft;
        },
        getVerticalScrollPosition: function() {
            var gridContainer = this.getGridContainer();
            if(gridContainer)
                return gridContainer.scrollTop;
            return 0;
        },
        getHorizontalScrollPosition: function() {
            var gridContainer = this.getGridContainer();
            if(gridContainer)
                return gridContainer.scrollLeft;
            return 0;
        },

        updateScrollSize: function(recalculate) {
            var contentDiv = this.getScrollContent();
            var scrollDiv = this.getScrollDiv();

            var minWidth = scrollDiv.offsetWidth + this.getDefaultCellSize().width;
            var minHeight = scrollDiv.offsetHeight + this.getDefaultCellSize().height;

            var lastVisibleCell = this.getLastVisibleCell();
            if(this.getLastScrollingCell().col == lastVisibleCell.col && this.getLastScrollingCell().row == lastVisibleCell.row && !recalculate)
                return;

            var calcWidth = this.getScrollContentAreaWidthSize() - this.getMinimumScrollLeftPosition();
            var calcHeight = this.getScrollContentAreaHeightSize() - this.getMinimumScrollTopPosition();

            this.setLastScrollingCell(this.getLastVisibleCell());

            var maxWidth = Math.max(minWidth, calcWidth),
                maxHeight = Math.max(minHeight, calcHeight);

            ASPx.SetStyles(contentDiv, {
                width: maxWidth + "px",
                height: maxHeight + "px"
            });
            if(ASPx.Browser.IE)
                this.extendScrollableAreaForIE(maxWidth, maxHeight);
        },
        extendScrollableAreaForIE: function(maxWidth, maxHeight) {
            this.increaseScrollableAreaSize(maxWidth, true);
            this.increaseScrollableAreaSize(maxHeight, false);
        },
        increaseScrollableAreaSize: function(size, isCol) {
            var maxElementSize = 1100000,
                maxIEElementSize = 1533917;
            if(size > maxElementSize) {
                var scrollDiv = this.getScrollDiv(),
                    cssClassName = isCol ? "dxss-hea" : "dxss-vea",
                    styleKey = isCol ? "width" : "height";

                this.removeExtendedElements(ASPx.GetNodesByClassName(scrollDiv, cssClassName));
                size -= maxIEElementSize;
                while(size > 0) {
                    var extendedElement = document.createElement("div");
                    var elementSize = size >= maxElementSize ? maxElementSize : size;

                    extendedElement.style[styleKey] = elementSize + "px";
                    extendedElement.className = cssClassName;
                    size -= elementSize;
                    scrollDiv.appendChild(extendedElement);
                }
            }
        },
        removeExtendedElements: function(elements) {
            if(elements.length > 0) {
                var scrollDiv = this.getScrollDiv();
                for(var index = 0; index < elements.length; index++)
                    scrollDiv.removeChild(elements[index]);
            }
        },

        setLastScrollingCell: function(cell) {
            this.lastScrollingCell = cell;
        },
        getLastScrollingCell: function() {
            return this.lastScrollingCell;
        },
        ensureScrolledTiles: function(col, row, scrollToLeft, scrollToTop) {
            var tileHelper = this.getTileHelper();
            var gridScrollBounds = tileHelper.getScrollBounds();
            if(this.isColFitToScrollBounds(col, scrollToLeft, gridScrollBounds) && this.isRowFitToScrollBounds(row, scrollToTop, gridScrollBounds))
                return;
            if(this.paneManager.tryLoadTilesFromCache()) {
                this.paneManager.getStateController().updateSelectionRender();
                this.paneManager.getStateController().ensureCopiedRange();
                tileHelper.updateAutoFilterImages();
                return;
            }
            var headerScrollBounds = tileHelper.getHeaderScrollBounds();
            if(!this.isColFitToScrollBounds(col, scrollToLeft, headerScrollBounds) && this.hasAnyCellsForward(true) 
                || !this.isRowFitToScrollBounds(row, scrollToTop, headerScrollBounds) && this.hasAnyCellsForward(false))
                tileHelper.loadHeaderTiles(); //TODO only scrolledTile can be there
            if(scrollToLeft || scrollToTop || this.hasAnyCellsForward(true) || this.hasAnyCellsForward(false))
                this.loadScrolledTiles();
        },

        loadScrolledTiles: function() {
            this.loadTilesTimerID = ASPx.Timer.ClearTimer(this.loadTilesTimerID);
            this.loadTilesTimerID = window.setTimeout(function() {
                this.getTileHelper().loadTilesAccordingToScrollAnchor();
            }.aspxBind(this), this.loadTilesTimeout);
        },
        getScrollInfo: function(tileHelper, index, isCol) {
            var gridVisibleRange = tileHelper.getVisibleRange(),
                headerVisibleRange = tileHelper.getHeaderVisibleRange(),
                gridScrollValue,
                headerScrollValue;

            gridScrollValue = headerScrollValue = this.calculateScrollPos(tileHelper, index, gridVisibleRange, isCol);
            if(!this.areRangesEqualByOneDirection(gridVisibleRange, headerVisibleRange, isCol))
                headerScrollValue = this.calculateScrollPos(tileHelper, index, headerVisibleRange, isCol);

            return { gridScrollValue: gridScrollValue, headerScrollValue: headerScrollValue };
        },
        calculateScrollPos: function(tileHelper, index, visibleRange, isCol) {
            var cellRange = this.getCellRange(visibleRange, isCol);

            var outsideLeft = cellRange.start - index > 0;
            var startCellIndex = outsideLeft ? index : cellRange.start;
            var endCellIndex = outsideLeft ? cellRange.start : index;
            var cellSize = this.getTileHelper().calculateCellSize(startCellIndex, endCellIndex - 1, isCol);

            return this.spacer + (outsideLeft ? -1 : 1) * cellSize;
        },
        areRangesEqualByOneDirection: function(r1, r2, isCol) { // TODO rename -> areRangesEqualByOneDirection
            if(isCol && (r1.left !== r2.left || r1.right !== r2.right))
                return false;
            if(!isCol && (r1.top !== r2.top || r1.bottom !== r2.bottom))
                return false;
            return true;
        },
        getCellRange: function(tileRange, isCol) {
            var left = isCol ? tileRange.left : tileRange.top;
            var right = isCol ? tileRange.right : tileRange.bottom;
            var tileSize = isCol ? this.tileSize.col : this.tileSize.row;
            return { start: left * tileSize, end: (right + 1) * tileSize - 1 };
        },

        isColFitToScrollBounds: function(col, scrollToLeft, scrollBounds) {
            return scrollToLeft && col >= scrollBounds.left || !scrollToLeft && col <= scrollBounds.right;
        },
        isRowFitToScrollBounds: function(row, scrollToTop, scrollBounds) {
            return scrollToTop && row >= scrollBounds.top || !scrollToTop && row <= scrollBounds.bottom;
        },

        getHorzScrollRightSpace: function() {
            var scrollDiv = this.getScrollDiv();
            return scrollDiv.scrollWidth - scrollDiv.clientWidth - scrollDiv.scrollLeft;
        },
        getVertScrollBottomSpace: function() {
            var scrollDiv = this.getScrollDiv();
            return scrollDiv.scrollHeight - scrollDiv.clientHeight - scrollDiv.scrollTop;
        },
        correctScrollPostitionsWhenEditingStarted: function(elementSizeRect, horizontalScrollCorrectRequired, verticalScrollCorrectRequired) {
            var colCount = 0,
                rowCount = 0;
            if(horizontalScrollCorrectRequired) {
                colCount = this.getCorrectionCellCount(elementSizeRect.width, true);
            }
            if(verticalScrollCorrectRequired) {
                rowCount = this.getCorrectionCellCount(elementSizeRect.height, false);
            }
            if(colCount > 0 || rowCount > 0) {
                if(colCount > 0)
                    this.increaseScrollableAreaIfNeeded(true);
                if(rowCount > 0)
                    this.increaseScrollableAreaIfNeeded(false);
                var firstVisibleCell = this.getScrollAnchorVisiblePosition();
                var anchor = { row: firstVisibleCell.row + rowCount, col: firstVisibleCell.col + colCount };
                this.applyScrollAnchor(anchor);
            }
        },
        getCorrectionCellCount: function(elementSize, isCol) {
            var firstVisibleCell = this.getScrollAnchorVisiblePosition();
            var currentSelection = this.paneManager.getStateController().getSelection();
            var cellCount = 0,
                totalSize = 0;

            var beginCellIndex = isCol ? firstVisibleCell.col : firstVisibleCell.row;
            var endCellIndex = isCol ? currentSelection.activeCellColIndex : currentSelection.activeCellRowIndex;

            for(var cellIndex = beginCellIndex; cellIndex < endCellIndex; cellIndex++) {
                var sizeSize = this.paneManager.getCellSize(cellIndex, isCol);
                totalSize += sizeSize;
                cellCount++;
                if(totalSize >= elementSize)
                    break;
            }
            return cellCount;
        },

        //TODO to zhuravlev: union with correctScrollPostitionsWhenEditingStarted
        correctScrollPostitions: function(elementSizeRect, hScrollOptions, vScrollOptions) {
            var colCount = 0,
                rowCount = 0,
                horizontalScrollCorrectRequired = hScrollOptions.required,
                verticalScrollCorrectRequired = vScrollOptions.required;

            if(horizontalScrollCorrectRequired)
                colCount = this.getCellCountBySize(elementSizeRect.width, true, hScrollOptions.direction);
            if(verticalScrollCorrectRequired)
                rowCount = this.getCellCountBySize(elementSizeRect.height, false, vScrollOptions.direction);

            if(colCount !== 0 || rowCount !== 0) {
                if(colCount !== 0)
                    this.increaseScrollableAreaIfNeeded(true);
                if(rowCount !== 0)
                    this.increaseScrollableAreaIfNeeded(false);

                var firstVisibleCell = this.getScrollAnchorVisiblePosition(),
                    rowIndex = firstVisibleCell.row + rowCount,
                    colIndex = firstVisibleCell.col + colCount;

                rowIndex = rowIndex < 0 ? 0 : rowIndex;
                rowIndex = rowIndex > ASPxClientSpreadsheet.Range.MAX_ROW_INDEX ? ASPxClientSpreadsheet.Range.MAX_ROW_INDEX : rowIndex;

                colIndex = colIndex < 0 ? 0 : colIndex;
                colIndex = colIndex > ASPxClientSpreadsheet.Range.MAX_ROW_INDEX ? ASPxClientSpreadsheet.Range.MAX_COL_INDEX : colIndex;

                this.applyScrollAnchor({ row: rowIndex, col: colIndex });
            }
        },
        getCellCountBySize: function(elementSize, isCol, direction) {
            var firstVisibleCell = this.getScrollAnchorVisiblePosition(),
                cellCount = 0,
                totalSize = 0,
                maxCellIndex = ASPxClientSpreadsheet.Range.getMaxCellIndex(isCol);

            var cellIndex = isCol ? firstVisibleCell.col : firstVisibleCell.row,
                directionIncrement = (direction === "right" || direction === "bottom") ? 1 : -1;
            
            if(directionIncrement < 0)
                cellIndex += directionIncrement;

            while((totalSize < elementSize) && (cellIndex >= 0) && (maxCellIndex >= cellIndex)) {
                var sizeSize = this.paneManager.getCellSize(cellIndex, isCol);
                totalSize += sizeSize;
                cellCount += directionIncrement;
                cellIndex += directionIncrement;
            }

            return cellCount;
        },

        getElementVisibleInfo: function(elementRect, cellLayoutInfo) {
            var tileInfo = cellLayoutInfo.tileInfo,
                gridContainer = this.getRenderHelper().getGridContainer(cellLayoutInfo.paneType),
                anchorCellLayoutInfo = this.paneManager.getPaneTopLeftCellLayoutInfo(cellLayoutInfo.paneType);

            var result = { verticalPartiallyVisible: false, horizontalPartiallyVisible: false, fullInvisible: anchorCellLayoutInfo == null };
            if(result.fullInvisible) return result;
           
            var elementCorrectWidth = elementRect.x,
                elementCorrectHeight = elementRect.y;
            if(anchorCellLayoutInfo.tileInfo !== tileInfo) {
                if(anchorCellLayoutInfo.tileInfo.colIndex != tileInfo.colIndex)
                    elementCorrectWidth += this.getAdditionalCorrectSize(anchorCellLayoutInfo.tileInfo, tileInfo, true);
                if(anchorCellLayoutInfo.tileInfo.rowIndex != tileInfo.rowIndex)
                    elementCorrectHeight += this.getAdditionalCorrectSize(anchorCellLayoutInfo.tileInfo, tileInfo, false);
            }

            result.horizontalPartiallyVisible = elementCorrectWidth - anchorCellLayoutInfo.rect.x + elementRect.width > gridContainer.clientWidth;
            result.verticalPartiallyVisible = elementCorrectHeight - anchorCellLayoutInfo.rect.y + elementRect.height > gridContainer.clientHeight;
            result.fullInvisible = anchorCellLayoutInfo.rect.y > elementCorrectHeight || anchorCellLayoutInfo.rect.y + gridContainer.clientHeight < elementCorrectHeight ||
                                   anchorCellLayoutInfo.rect.x > elementCorrectWidth || anchorCellLayoutInfo.rect.x + gridContainer.clientWidth < elementCorrectWidth;

            return result;
        },
        getAdditionalCorrectSize: function(anchorTileInfo, cellTileInfo, isCol) {
            var startCellIndex = isCol ? anchorTileInfo.colIndex : anchorTileInfo.rowIndex,
                endCellIndex = isCol ? cellTileInfo.colIndex : cellTileInfo.rowIndex,
                correctSize = 0,
                cellIndex;
            
            if(startCellIndex < endCellIndex)
                for(cellIndex = startCellIndex; cellIndex < endCellIndex; cellIndex++)
                    correctSize += this.paneManager.getTileTotalSize(cellIndex, isCol);
            else
                for(cellIndex = endCellIndex; cellIndex < startCellIndex; cellIndex++)
                    correctSize -= this.paneManager.getTileTotalSize(cellIndex, isCol);
            return correctSize;
        }
    });

    ASPxClientSpreadsheet.ScrollHelper.Constants = {
        ScrollTopRowStep: 1,
        ScrollLeftRowStep: 1,
        AdditionalRowToView: 3,
        AdditionalColToView: 2
    };
})();
(function() {

    ASPxClientSpreadsheet.CommandBase = ASPx.CreateClass(null, {
        constructor: function(control, commandId) {
            this.control = control;
            this.conmmandId = commandId;
            this.commandResult = ASPxClientSpreadsheet.ClientCommands.DefaultCommandResult;
        },

        getState: function() {
            var stateController = this.control.getStateController();
            return stateController.getSelection();
        },

        execute: function(commandManager, parameters) {
            var state = this.getState();
            if(this.canExecute(state, parameters)) {
                this.control.beginUpdate();

                commandManager.beginCommandExecuting();
                this.executeCore(state, parameters);
                commandManager.endCommandExecuted(this, this.getCommandServerInfo(state, parameters), this.getCommandMode(state, parameters), parameters);

                this.control.endUpdate();
            }
            return this.getCommandResult();
        },
        canExecute: function(state, parameters) {
            return this.control.canCommandBeExecuted(this.conmmandId, parameters);
        },
        isEnabled: function() {
            return !this.control.isReadOnly();
        },
        canExecuteOnLockedSheet: function() {
            return !this.isSheetLocked();
        },
        canExecuteOnLockedWorkbook: function() {
            return true;
        },
        canExecuteOnLockedCell: function() {
            return !this.control.isActiveCellLocked();
        },
        executeCore: function(state, parameters) {
            throw new Error("The method is not implemented.");
        },
        getCommandServerInfo: function(state, parameters) {
            var serverInfo = [];
            serverInfo.push("CommandID=" + this.getCommandId());
            serverInfo.push("sheetIndex=" + this.control.getDocumentModel().getActiveSheetId());
            serverInfo = serverInfo.concat(this.getCommandServerInfoBase(state, parameters));
            return serverInfo.join("|");
        },
        getCommandServerInfoBase: function(state, parameters) {
            var selection = this.control.serializeSelection() || [];
            return selection;
        },
        getCommandId: function() {
            return this.conmmandId;
        },
        getCommandResult: function() {
            return this.commandResult;
        },
        getCommandMode: function(state, parameters) {
            return ASPxClientSpreadsheet.CommandManager.CommandMode.BatchEditingCommand;
        },

        // Helpers
        getPaneManager: function() {
            return this.control.getPaneManager();
        },
        getRenderProvider: function() {
            return this.getPaneManager().getRenderProvider();
        },
        isSheetLocked: function() {
            return this.control.isSheetLocked();
        },
        isWorkbookLocked: function() {
            return this.control.isWorkbookLocked();
        },

        getCellElementByModelPostiton: function(colModelIndex, rowModelIndex) {
            return this.control.getRenderHelper().getCellTextElementByModelPosition(colModelIndex, rowModelIndex);
        },
        getCellElementByVisiblePosition: function(colVisibleIndex, rowVisibleIndex) {
            return this.control.getRenderHelper().getCellTextElement(colVisibleIndex, rowVisibleIndex);
        },
        getCellValue: function(colVisibleIndex, rowVisibleIndex) {
            return this.control.getCellValueByVisiblePosition_Internal(colVisibleIndex, rowVisibleIndex);
        }
    });

    ASPxClientSpreadsheet.Commands = {};

    ASPxClientSpreadsheet.Commands.UpdateCell = ASPx.CreateClass(ASPxClientSpreadsheet.CommandBase, {
        executeCore: function(state, parameters) {
            if(this.canDrawCell(parameters)) {
                var colModelIndex = parameters.colIndex,
                    rowModelIndex = parameters.rowIndex,
                    cellTextElement = this.getCellElementByModelPostiton(colModelIndex, rowModelIndex),
                    cellValue = parameters.NewValue.replace(/\r\n/g, "<BR>");

                if(cellTextElement) {
                    var hyperlink = this.getCellHyperLink(cellTextElement);
                    if(hyperlink)
                        cellTextElement = hyperlink;
                    cellTextElement.innerHTML = cellValue;
                } else
                    this.control.getRenderHelper().createDataCell(colModelIndex, rowModelIndex, cellValue);
                if(this.control.getCommandManager().batchTileCacheUpdating)
                    this.updateTileCache(colModelIndex, rowModelIndex, cellValue);
            }
        },
        getCommandServerInfoBase: function(state, parameters) {
            var serverInfo = [];
            serverInfo.push("NewValue=" + encodeURIComponent(parameters.NewValue));
            serverInfo.push("colIndex=" + parameters.colIndex);
            serverInfo.push("rowIndex=" + parameters.rowIndex);
            if(!!parameters.ConfirmResult)
                serverInfo.push("ConfirmResult=" + parameters.ConfirmResult);
            if(!!parameters.ReselectAfterCommand)
                serverInfo.push("ReselectAfterCommand=" + parameters.ReselectAfterCommand);
            if(!!parameters.formulaSheetOwner && parameters.formulaSheetOwner >= 0)
                serverInfo.push("formulaSheetOwner=" + parameters.formulaSheetOwner);

            return serverInfo;
        },
        getCommandRange: function(state, parameters) {
            return new ASPxClientSpreadsheet.Range(parameters.colIndex, parameters.rowIndex, parameters.colIndex, parameters.rowIndex);
        },

        canExecuteOnLockedSheet: function() {
            return true;
        },
        canExecuteOnLockedCell: function(state, parameters) {
            return !(this.isSheetLocked() && ASPxClientSpreadsheet.ProtectionHelper.isCellLocked(this.control, parameters.colIndex, parameters.rowIndex));
        },

        getCommandResult: function() {
            return true;
        },
        getCommandMode: function(state, parameters) {
            var colModelIndex = parameters.colIndex,
                rowModelIndex = parameters.rowIndex,
                cellValue = parameters.NewValue;
            // TODO to zhuravlev add check for protection
            var disableBatchProcessing = !this.isBatchProcessingEnabled(colModelIndex, rowModelIndex, cellValue);
            return disableBatchProcessing ? ASPxClientSpreadsheet.CommandManager.CommandMode.DetachedCommand : ASPxClientSpreadsheet.CommandManager.CommandMode.BatchEditingCommand;
        },
        isBatchProcessingEnabled: function(colModelIndex, rowModelIndex, cellValue) {
            var validationHelper = this.getValidationHelper();
            return !(validationHelper.isCellHaveValidation(colModelIndex, rowModelIndex) || (cellValue && cellValue.trim().indexOf("=") === 0));
        },

        updateTileCache: function(colModelIndex, rowModelIndex, cellValue) {
            if(!this.isBatchProcessingEnabled(colModelIndex, rowModelIndex, cellValue))
                return;

            var paneManager = this.getPaneManager(),
                pane = paneManager.getPaneByCell({ col: colModelIndex, row: rowModelIndex });

            if(pane) {
                var tileHelper = pane.getTileHelper(),
                    colVisibleIndex = tileHelper.convertModelIndexToVisibleIndex(colModelIndex, true),
                    rowVisibleIndex = tileHelper.convertModelIndexToVisibleIndex(rowModelIndex, false);
                
                var tilePosition = ASPxClientSpreadsheet.CellHelper.getCellTilePosition(this.control.getRenderHelper(), colVisibleIndex, rowVisibleIndex),
                    tileInfo = tileHelper.getGridTileInfo(tilePosition.row, tilePosition.col);

                if(tileInfo) {
                    var cells = tileInfo.json.C,
                        len = cells.length;
                    while(len--) {
                        var cell = cells[len];
                        if(cell && (cell.P[1] === colModelIndex && cell.P[0] === rowModelIndex)) {
                            cell.CE = cell.CE || {};
                            cell.CE.T = cellValue;
                            break;
                        }
                    }

                    tileInfo.json.CSC = -1;
                }
            }
        },

        // Helpers
        getValidationHelper: function() {
            return this.control.getValidationHelper();
        },
        getCellHyperLink: function(element) {
            if(element)
                return ASPx.GetNodeByTagName(element, "a", 0);
            return null;
        },

        canDrawCell: function(parameters) {
            return !(parameters && parameters.formulaSheetOwner && parameters.formulaSheetOwner >= 0 && this.control.getDocumentModel().getActiveSheetId() !== parameters.formulaSheetOwner);
        }
    });

    ASPxClientSpreadsheet.Commands.FormatClearContents = ASPx.CreateClass(ASPxClientSpreadsheet.CommandBase, {
        executeCore: function(state, parameters) {
            if(this.control.isSheetLocked()) {
                var paneManager = this.control.getPaneManager(),
                    topLeftModelCellPosition = paneManager.convertVisiblePositionToModelPosition(state.range.leftColIndex, state.range.topRowIndex),
                    bottomRightModelCellPosition = paneManager.convertVisiblePositionToModelPosition(state.range.rightColIndex, state.range.bottomRowIndex),
                    modelRange = new ASPxClientSpreadsheet.Range(topLeftModelCellPosition.colIndex, topLeftModelCellPosition.rowIndex, bottomRightModelCellPosition.colIndex, bottomRightModelCellPosition.rowIndex);
                if(ASPxClientSpreadsheet.ProtectionHelper.rangeContainLockedCell(this.control, modelRange))
                    return false;
            }
            for(var i = state.range.leftColIndex; i <= state.range.rightColIndex; i++)
                for(var k = state.range.topRowIndex; k <= state.range.bottomRowIndex; k++) {
                    var colVisibleIndex = i,
                        rowVisibleIndex = k,
                        cellElement = this.getCellElementByVisiblePosition(colVisibleIndex, rowVisibleIndex);
                    if(cellElement) {
                        cellElement.innerHTML = "";
                    }
                }
        },
        canExecuteOnLockedSheet: function() {
            return true;
        }
    });

    ASPxClientSpreadsheet.Commands.BatchProcessing = (function() {
        function BatchProcessing(control, commandId) {
            this.control = control;
            this.commandId = commandId;
        }
        BatchProcessing.prototype.execute = function(commands) {
            var queryString = this.getQueryString(commands);
            queryString.unshift(ASPxClientSpreadsheet.ClientCommands.getCommandIdParamName() + "=" + this.getCommandId());
            this.control.processCommandRequest(queryString.join("&"), this.getCommandId());
        };
        BatchProcessing.prototype.getQueryString = function(commands) {
            var result = [],
                len = commands.length;
            while(len--) {
                result.unshift(commands[len].args);
            }
            var queryString = [];
            queryString.push("Commands=" + encodeURIComponent(ASPx.Json.ToJson(result)));
            return queryString;
        };
        BatchProcessing.prototype.getSupportedQueryString = function(commands, withoutCommand) {
            var queryString = this.getQueryString(commands);
            if(!withoutCommand)
                queryString.unshift(ASPxClientSpreadsheet.ClientCommands.getSupportedCommandIdParamName() + "=" + this.getCommandId());
            return queryString.join("&");
        };

        BatchProcessing.prototype.getCommandId = function() {
            return this.commandId;
        };

        return BatchProcessing;
    })();

    ASPxClientSpreadsheet.Commands.CommandHelper = (function() {
        var ownerControl,
            protectionHelper,
            documentSettings;

        function CommandHelper(owner) {
            ownerControl = owner;
            protectionHelper = ASPxClientSpreadsheet.ProtectionHelper;
            documentSettings = ownerControl.getDocumentSettings();
        }

        CommandHelper.prototype = {
            GetEnabled: function(commandName) {
                return getEnabledByProtection(commandName) && getEnabledBySettings(commandName);
            },
            GetVisible: function(commandName) {                
                return getVisibleBySettings(commandName);
            }
        };

        function getOwner() {
            return ownerControl;
        }

        function getProtectionHelper() {
            return protectionHelper;
        }

        function getDocumentSettings() {
            return documentSettings;
        }

        function getEnabledByProtection(commandName) {
            var rejectReason = getProtectionHelper().isCommandAvailable(getOwner(), commandName);
            return rejectReason === ASPxClientSpreadsheet.ProtectionHelper.RejectReason.None;
        }

        function getEnabledBySettings(commandName) {
            return getDocumentSettings().isCommandEnabled(commandName);
        }

        function getVisibleBySettings(commandName) {
            return getDocumentSettings().isCommandVisible(commandName);
        }
       
        return CommandHelper;
    })();

    ASPxClientSpreadsheet.Commands.CommandHelper.GetCommandEnabled = function(spreadsheetControl, commandName) {
        var commandHelper = new ASPxClientSpreadsheet.Commands.CommandHelper(spreadsheetControl);
        return commandHelper.GetEnabled(commandName);
    }; 

    ASPxClientSpreadsheet.Commands.CommandHelper.GetCommandVisible = function(spreadsheetControl, commandName) {
        var commandHelper = new ASPxClientSpreadsheet.Commands.CommandHelper(spreadsheetControl);
        return commandHelper.GetVisible(commandName);
    }; 

})();
ASPxClientSpreadsheet.ServerCommands = (function() {
    var CommandIDs = {
        //web server commands
        LoadSheet                                       : { id: "w0", enabled: { editMode: true, readonlyMode: true, lockedSheet: true }, UIBlocking: true },
        LoadInvisibleTiles                              : { id: "w1", enabled: { editMode: true, readonlyMode: true, lockedSheet: true }, UIBlocking: true },
        UpdateCell                                      : { id: "w2", enabled: { editMode: true, lockedSheet: true }, disabled: { lockedCell: true } },
        FormatFontName                                  : { id: "w3", customPermission: { property: "formatCellsLocked" } },
        FormatFontSize                                  : { id: "w4", customPermission: { property: "formatCellsLocked" } },
        ResizeColumn                                    : { id: "w5", UIBlocking: true, customPermission: { property: "formatColumnsLocked" } },
        ResizeRow                                       : { id: "w6", UIBlocking: true, customPermission: { property: "formatRowsLocked" } },
        FormatFontColor                                 : { id: "w7", customPermission: { property: "formatCellsLocked" } },
        FormatFillColor                                 : { id: "w8", customPermission: { property: "formatCellsLocked" } },
        FormatBorderLineColor                           : { id: "w9", customPermission: { property: "formatCellsLocked" } },
        FormatBorderLineStyle                           : { id: "w10", customPermission: { property: "formatCellsLocked" } },
        InsertHyperlink                                 : { id: "w11", menuVisible: { isLink: false, isRowHeader: false, isColumnHeader: false, isColumnSelected: false, isRowSelected: false, isAllSelected: false, isPivotTable: false }, disabled: { lockedCell: true }, customPermission: { property: "insertHyperlinksLocked" } },
        FileNew                                         : { id: "w12", spreadsheetExecuteMethod: "CreateNewDocumentCallback", enabled: { lockedSheet: true } },
        FileSave                                        : { id: "w13", enabled: { editMode: true, lockedSheet: true } },
        InsertPicture                                   : { id: "w14", customPermission: { property: "objectsLocked" } },
        RenameSheet                                     : { id: "w15", enabled: { lockedSheet: true }, disabled: { lockedWorkbook: true }, menuVisible: { isTabSelectorMenu: true }, menuEnabled: { lockedWorkbook: false } },
        EditHyperlink                                   : { id: "w16", menuVisible: { isLink: true, isColumnSelected: false, isRowSelected: false, isAllSelected: false, isPivotTable: false }, disabled: { lockedCell: true }, customPermission: { property: "insertHyperlinksLocked" } },
        ShapeMoveAndResize                              : { id: "w17", customPermission: { property: "objectsLocked" } },
        FileOpen                                        : { id: "w18", enabled: { readonlyMode: true, lockedSheet: true }, UIBlocking: true },
        FileSaveAs                                      : { id: "w19", enabled: { editMode: true, readonlyMode: true, lockedSheet: true }, UIBlocking: true },
        UnhideRows                                      : { id: "w20", menuVisible: { isRowHeader: true }, customPermission: { property: "formatRowsLocked" } },
        UnhideColumns                                   : { id: "w21", menuVisible: { isColumnHeader: true }, customPermission: { property: "formatColumnsLocked" } },
        FormatRowHeight                                 : { id: "w22", menuVisible: { isRowHeader: true }, UIBlocking: true, customPermission: { property: "formatRowsLocked" } },
        FormatColumnWidth                               : { id: "w23", menuVisible: { isColumnHeader: true }, customPermission: { property: "formatColumnsLocked" }, UIBlocking: true },
        FormatDefaultColumnWidth                        : { id: "w24", customPermission: { property: "formatColumnsLocked" }, UIBlocking: true },
        UnhideSheet                                     : { id: "w25", enabled: { lockedSheet: true }, disabled: { lockedWorkbook: true }, menuVisible: { isTabSelectorMenu: true }, menuEnabled: { lockedWorkbook: false, canUnhideSheet: true } },
        ChartChangeType                                 : { id: "w26", isChartCommand: true, menuVisible: { isChart: true }, customPermission: { property: "objectsLocked" } },
        ChartSelectData                                 : { id: "w27", isChartCommand: true, menuVisible: { isChart: true }, customPermission: { property: "objectsLocked" } },
        GetLocalizedStringConstant                      : { id: "w28", enabled: { lockedSheet: true } },
        ModifyChartLayout                               : { id: "w29", isChartCommand: true, menuVisible: { isChart: true }, customPermission: { property: "objectsLocked" } },
        ChartChangeTitle                                : { id: "w30", isChartCommand: true, menuVisible: { isChart: true, hasTitle: true }, customPermission: { property: "objectsLocked" } },
        ChartChangeHorizontalAxisTitle                  : { id: "w31", isChartCommand: true, menuVisible: { isChart: true, hasHTitle: true }, customPermission: { property: "objectsLocked" } },
        ChartChangeVerticalAxisTitle                    : { id: "w32", isChartCommand: true, menuVisible: { isChart: true, hasVTitle: true }, customPermission: { property: "objectsLocked" } },
        ModifyChartStyle                                : { id: "w33", isChartCommand: true, menuVisible: { isChart: true }, customPermission: { property: "objectsLocked" } },
        DownLoadCopy                                    : { id: "w34", enabled: { editMode: true, readonlyMode: true, lockedSheet: true }, UIBlocking: true  },
        Print                                           : { id: "w35", enabled: { readonlyMode: true, lockedSheet: true } },
        FindAll                                         : { id: "w36", enabled: { readonlyMode: true, lockedSheet: true } },
        ScrollTo                                        : { id: "w37", enabled: { readonlyMode: true, lockedSheet: true }, UIBlocking: true },
        SetPaperKind                                    : { id: "w38", enabled: { lockedSheet: true } },
        GetPictureContent                               : { id: "w40" },
        InsertTable                                     : { id: "w41", enabled: { canInsertTable: true }, isTableCommand: true },
        FetchAutoFilterViewModel                        : { id: "w42", customPermission: { property: "autoFiltersLocked" } },
        ApplyAutoFilter                                 : { id: "w43", customPermission: { property: "autoFiltersLocked" } },
        FetchDataValidationViewModel                    : { id: "w44" },
        ApplyDataValidation                             : { id: "w45" },
        FetchListAllowedValues                          : { id: "w46", enabled: { lockedSheet: true } },
        MoveOrCopySheet                                 : { id: "w47", menuVisible: { isTabSelectorMenu: true }, menuEnabled: { lockedWorkbook: false } },
        FetchMessageForCell                             : { id: "w48", enabled: { readonlyMode: true, lockedSheet: true } },
        TableToolsRenameTable                           : { id: "w49", isTableCommand: true },
        ModifyTableStyle                                : { id: "w50", isTableCommand: true },
        FormatAsTable                                   : { id: "w51", enabled: { canFormatAsTable: true }, isTableCommand: true },
        InsertTableWithStyle                            : { id: "w52" },
        RemoveSheet                                     : { id: "w53", enabled: { lockedSheet: true }, disabled: { lockedWorkbook: true }, menuVisible: { isTabSelectorMenu: true }, menuEnabled: { lockedWorkbook: false, canRemoveSheet: true } },
        FetchPageSetupViewModel                         : { id: "w54", enabled: { lockedSheet: true } },
        ApplyPageSetupSettings                          : { id: "w55", enabled: { lockedSheet: true } },
        MoveRange                                       : { id: "w56", enabled: { lockedSheet: true } },
        FreezePanes                                     : { id: "w57", enabled: { lockedSheet: true } },
        FreezeRow                                       : { id: "w58", enabled: { lockedSheet: true } },
        FreezeColumn                                    : { id: "w59", enabled: { lockedSheet: true } },
        AutoFitColumnWidth                              : { id: "w60", customPermission: { property: "formatColumnsLocked" } },
        ShowCustomHeaderFooterDialog                    : { id: "w61", enabled: { lockedSheet: true } },
        FetchHeaderFooterViewModel                      : { id: "w62", enabled: { lockedSheet: true } },
        ApplyHeaderFooterViewModel                      : { id: "w63", enabled: { lockedSheet: true } },
        RangeResize                                     : { id: "w64", enabled: { lockedSheet: true } },
        BatchProcessing                                 : { id: "w65", enabled: { lockedSheet: true } },
        FormatCells                                     : { id: "w66", customPermission: { property: "formatCellsLocked" }, menuVisible: { isDrawing: false } },
        FetchFormatCellsViewModel                       : { id: "w67", customPermission: { property: "formatCellsLocked" } },
        CommentEdit                                     : { id: "w68", customPermission: { property: "objectsLocked" } },
        CommentMoveAndResize                            : { id: "w69", customPermission: { property: "objectsLocked" } },
        CommentInsert                                   : { id: "w70", menuVisible: { isComment: false, isColumnSelected: false, isRowSelected: false, isAllSelected: false, isPivotTable: false }, customPermission: { property: "objectsLocked" } },
        //CustomCallback = "w71"

        Paste                                           : { id: "w39", enabled : {editMode: true, lockedSheet: true}, disabled: { lockedCell: true }, menuVisible : { isChart: false, isDrawing: false, isPivotTable: false }, UIBlocking: true },
        CopySelection                                   : { id: "w72", enabled : {editMode: true, readonlyMode: true, lockedSheet: true}, menuVisible : { isChart: false, isDrawing: false }},
        CutSelection                                    : { id: "w73", enabled : {editMode: true, lockedSheet: true}, disabled: { lockedCell: true}, menuVisible : { isChart: false, isDrawing: false, isPivotTable: false }},

        NavigateToBookmark                              : { id: "w74", enabled: { readonlyMode: true, lockedSheet: true }, UIBlocking: true },

        ReadingView                                     : { id: "w75", spreadsheetExecuteMethod: "readingView", enabled: { readonlyMode: true, lockedSheet: true } },
        EditingView                                     : { id: "w76", spreadsheetExecuteMethod: "editingView", enabled: { readonlyMode: true, lockedSheet: true } },
        AutoFitRowHeight                                : { id: "w77", customPermission: { property: "formatRowsLocked" } },

        // Pivot table support
        InsertPivotTable                                : { id: "w78"/*3800*/ },
        FieldListPanelPivotTable                        : { id: "w79", menuVisible: { isPivotTable: true, isPivotTableFieldDialog: false }, customPermission: { property: "pivotTablesLocked" } },
        MoveFieldPivotTable                             : { id: "w80", customPermission: { property: "pivotTablesLocked" } },
        HideFieldListPanelPivotTable                    : { id: "w81", customPermission: { property: "pivotTablesLocked" }, spreadsheetExecuteMethod: "hideDialog", ribbonManagerUpdateMethod: "updatePivotTableFieldList", menuVisible: { isPivotTable: true, isPivotTableFieldDialog: true }  },
        FetchPivotTableAutoFilterViewModel              : { id: "w82", customPermission: { property: "pivotTablesLocked" } },
        ApplyPivotTableDateAutoFilter                   : { id: "w83", customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFieldFiltering                    : { id: "w84", customPermission: { property: "pivotTablesLocked" } },
        ApplyPivotTableSimpleValueAutoFilter            : { id: "w85", customPermission: { property: "pivotTablesLocked" } },
        ApplyPivotTableTop10AutoFilter                  : { id: "w86", customPermission: { property: "pivotTablesLocked" } },
        ApplyPivotTableLabelAutoFilter                  : { id: "w87", customPermission: { property: "pivotTablesLocked" } },
        ApplyPivotTableItemAutoFilter                   : { id: "w88", customPermission: { property: "pivotTablesLocked" } },
        ChageDataSourcePivotTableWebCommand             : { id: "w89" },
        MovePivotTableWebCommand                        : { id: "w90" },

        //virtual commands
        LoadInvisibleTilesForFullScreenMode             : { id: "v1", enabled: { editMode: true, readonlyMode: true, lockedSheet: true }, UIBlocking: true },
        FormatRemoveDrawing                             : { id: "v2", enabled: { lockedSheet: true }, customPermission: { property: "objectsLocked" } },
        InsertFunction                                  : { id: "v3", enabled: { editMode: true, lockedSheet: true }, disabled: { lockedCell: true } },
        //client commands
        FullScreen                                      : { id: "c1", spreadsheetExecuteMethod: "setFullScreenModeInternal", ribbonManagerUpdateMethod: "onFullScreenCommandExecuted", enabled: { readonlyMode: true, lockedSheet: true } },
        PivotTableChangeActiveRowField                  : { id: "c2", spreadsheetExecuteMethod: "pivotTableChangeActiveField" },

        //Server commands
        FileUndo                                        : { id: 8, enabled : {lockedSheet: true}}, 
        FileRedo                                        : { id: 9, enabled : {lockedSheet: true}}, 
        FormatFontBold                                  : { id: 100, customPermission: { property: "formatCellsLocked" } },
        FormatFontItalic                                : { id: 101, customPermission: { property: "formatCellsLocked" } },
        FormatFontUnderline                             : { id: 102, customPermission: { property: "formatCellsLocked" } },
        FormatFontStrikeout                             : { id: 103, customPermission: { property: "formatCellsLocked" } },
        FormatIncreaseFontSize                          : { id: 106, customPermission: { property: "formatCellsLocked" } },
        FormatDecreaseFontSize                          : { id: 107, customPermission: { property: "formatCellsLocked" } },
        FormatAlignmentLeft                             : { id: 110, customPermission: { property: "formatCellsLocked" } },
        FormatAlignmentCenter                           : { id: 111, customPermission: { property: "formatCellsLocked" } },
        FormatAlignmentRight                            : { id: 112, customPermission: { property: "formatCellsLocked" } },
        FormatAlignmentTop                              : { id: 113, customPermission: { property: "formatCellsLocked" } },
        FormatAlignmentMiddle                           : { id: 114, customPermission: { property: "formatCellsLocked" } },
        FormatAlignmentBottom                           : { id: 115, customPermission: { property: "formatCellsLocked" } },
        FormatWrapText                                  : { id: 116, customPermission: { property: "formatCellsLocked" } },
        FormatIncreaseIndent                            : { id: 117, customPermission: { property: "formatCellsLocked" } },
        FormatDecreaseIndent                            : { id: 118, customPermission: { property: "formatCellsLocked" } },
        FormatThickBorder                               : { id: 121, customPermission: { property: "formatCellsLocked" } }, //in right bottom corner 1 pixel don't showing
        FormatOutsideBorders                            : { id: 122, customPermission: { property: "formatCellsLocked" } },
        FormatLeftBorder                                : { id: 123, customPermission: { property: "formatCellsLocked" } },
        FormatRightBorder                               : { id: 124, customPermission: { property: "formatCellsLocked" } },
        FormatTopBorder                                 : { id: 125, customPermission: { property: "formatCellsLocked" } },
        FormatBottomBorder                              : { id: 126, customPermission: { property: "formatCellsLocked" } },
        FormatBottomDoubleBorder                        : { id: 127, customPermission: { property: "formatCellsLocked" } }, // TODO, atm (at this moment) medium bottom line
        FormatBottomThickBorder                         : { id: 128, customPermission: { property: "formatCellsLocked" } },
        FormatTopAndBottomBorder                        : { id: 129, customPermission: { property: "formatCellsLocked" } },
        FormatTopAndThickBottomBorder                   : { id: 130, customPermission: { property: "formatCellsLocked" } },
        FormatTopAndDoubleBottomBorder                  : { id: 131, customPermission: { property: "formatCellsLocked" } }, // TODO, atm medium bottom and thin top lines
        FormatAllBorders                                : { id: 132, customPermission: { property: "formatCellsLocked" } },
        FormatNoBorders                                 : { id: 133, customPermission: { property: "formatCellsLocked" } },
        FormatBordersCommandGroup                       : { id: 134, customPermission: { property: "formatCellsLocked" } },
        FormatNumber                                    : { id: 150, customPermission: { property: "formatCellsLocked" } },
        FormatNumberPercent                             : { id: 153, customPermission: { property: "formatCellsLocked" } },
        FormatNumberPercentage                          : { id: 154, customPermission: { property: "formatCellsLocked" } },
        FormatNumberScientific                          : { id: 155, customPermission: { property: "formatCellsLocked" } },
        FormatNumberAccounting                          : { id: 157, customPermission: { property: "formatCellsLocked" } },
        FormatNumberPredefined4                         : { id: 164, customPermission: { property: "formatCellsLocked" } },
        FormatNumberPredefined8                         : { id: 165, customPermission: { property: "formatCellsLocked" } },
        FormatNumberPredefined15                        : { id: 166, customPermission: { property: "formatCellsLocked" } },
        FormatNumberPredefined18                        : { id: 167, customPermission: { property: "formatCellsLocked" } },
        FormatNumberAccountingUS                        : { id: 168, customPermission: { property: "formatCellsLocked" } },
        FormatNumberAccountingUK                        : { id: 169, customPermission: { property: "formatCellsLocked" } },
        FormatNumberAccountingPRC                       : { id: 170, customPermission: { property: "formatCellsLocked" } },
        FormatNumberAccountingEuro                      : { id: 171, customPermission: { property: "formatCellsLocked" } },
        FormatNumberAccountingSwiss                     : { id: 172, customPermission: { property: "formatCellsLocked" } },
        FormatNumberAccountingCommandGroup              : { id: 173, customPermission: { property: "formatCellsLocked" } },
        FormatNumberIncreaseDecimal                     : { id: 174, customPermission: { property: "formatCellsLocked" } },
        FormatNumberDecreaseDecimal                     : { id: 175, customPermission: { property: "formatCellsLocked" } },
        FormatClearCommandGroup                         : { id: 200, enabled: { lockedSheet: true }, disabled: { lockedCell: true } },
        FormatClearAll                                  : { id: 201, enabled: { lockedSheet: true }, disabled: { lockedCell: true } },
        FormatClearFormats                              : { id: 202, enabled: { lockedSheet: true }, disabled: { lockedCell: true } },
        FormatClearContents                             : { id: 203, enabled: { lockedSheet: true }, menuVisible: { isDrawing: false, isPivotTable: false }, disabled: { lockedCell: true } },
        FormatClearContentsContextMenuItem              : { id: 204, enabled: { lockedSheet: true }, disabled: { lockedCell: true } },
        FormatClearComments                             : { id: 205, enabled: { lockedSheet: true }, customPermission: { property: "objectsLocked" } },
        FormatClearHyperlinks                           : { id: 206, enabled: { lockedSheet: true } },
        FormatRemoveHyperlinks                          : { id: 207, disabled: { lockedCell: true }, customPermission: { property: "insertHyperlinksLocked" } },
        EditingAutoSumCommandGroup                      : { id: 208},
        EditingMergeAndCenterCells                      : { id: 209},
        EditingMergeCellsAcross                         : { id: 210},
        EditingMergeCells                               : { id: 211},
        EditingUnmergeCells                             : { id: 212},
        EditingMergeCellsCommandGroup                   : { id: 213},
        EditingFillDown                                 : { id: 214, enabled: { lockedSheet: true }, disabled: { lockedCell: true } },
        EditingFillUp                                   : { id: 215, enabled: { lockedSheet: true }, disabled: { lockedCell: true } },
        EditingFillLeft                                 : { id: 216, enabled: { lockedSheet: true }, disabled: { lockedCell: true } },
        EditingFillRight                                : { id: 217, enabled: { lockedSheet: true }, disabled: { lockedCell: true } },
        EditingFillCommandGroup                         : { id: 218, enabled: { lockedSheet: true }, disabled: { lockedCell: true } },
        EditingSortAndFilterCommandGroup                : { id: 219},
        EditingFindAndSelectCommandGroup                : { id: 220},
        FunctionsInsertSpecificFunction                 : { id: 400, enabled: { editMode: true, lockedSheet: true } },
        FunctionsFinancialCommandGroup                  : { id: 401, enabled: { editMode: true, lockedSheet: true } },
        FunctionsLogicalCommandGroup                    : { id: 402, enabled: { editMode: true, lockedSheet: true } },
        FunctionsTextCommandGroup                       : { id: 403, enabled: { editMode: true, lockedSheet: true } },
        FunctionsDateAndTimeCommandGroup                : { id: 404, enabled: { editMode: true, lockedSheet: true } },
        FunctionsLookupAndReferenceCommandGroup         : { id: 405, enabled: { editMode: true, lockedSheet: true } },
        FunctionsMathAndTrigonometryCommandGroup        : { id: 406, enabled: { editMode: true, lockedSheet: true } },
        FunctionsMoreCommandGroup                       : { id: 407, enabled: { editMode: true, lockedSheet: true } },
        FunctionsStatisticalCommandGroup                : { id: 408, enabled: { editMode: true, lockedSheet: true } },
        FunctionsEngineeringCommandGroup                : { id: 409, enabled: { editMode: true, lockedSheet: true } },
        FunctionsCubeCommandGroup                       : { id: 410, enabled: { editMode: true, lockedSheet: true } },
        FunctionsInformationCommandGroup                : { id: 411, enabled: { editMode: true, lockedSheet: true } },
        FunctionsCompatibilityCommandGroup              : { id: 412, enabled: { editMode: true, lockedSheet: true } },
        FunctionsAutoSumCommandGroup                    : { id: 413, enabled: { editMode: true} },
        FunctionsInsertSum                              : { id: 414, enabled : {editMode: true}},
        FunctionsInsertAverage                          : { id: 415, enabled : {editMode: true}},
        FunctionsInsertCountNumbers                     : { id: 416, enabled : {editMode: true}},
        FunctionsInsertMax                              : { id: 417, enabled : {editMode: true}},
        FunctionsInsertMin                              : { id: 418, enabled : {editMode: true}},
        FormulasCalculateNow                            : { id: 422},
        FormulasCalculateSheet                          : { id: 423},
        FormulasCalculationOptionsCommandGroup          : { id: 424},
        FormulasCalculationModeAutomatic                : { id: 425},
        FormulasCalculationModeManual                   : { id: 426},
        ViewShowGridlines                               : { id: 603, enabled: { readonlyMode: true, lockedSheet: true } },
        ViewShowHeadings                                : { id: 604, enabled: { readonlyMode: true, lockedSheet: true } },
        ViewFreezePanesCommandGroup                     : { id: 605, enabled: { lockedSheet: true } },
        ViewUnfreezePanes                               : { id: 607, enabled: { lockedSheet: true } },
        PageSetupMarginsNormal                          : { id: 650, enabled: { lockedSheet: true } },
        PageSetupMarginsNarrow                          : { id: 651, enabled: { lockedSheet: true } },
        PageSetupMarginsWide                            : { id: 652, enabled: { lockedSheet: true } },
        PageSetupMarginsCommandGroup                    : { id: 653, enabled: { lockedSheet: true } },
        PageSetupOrientationPortrait                    : { id: 654, enabled: { lockedSheet: true } },
        PageSetupOrientationLandscape                   : { id: 655, enabled: { lockedSheet: true } },
        PageSetupOrientationCommandGroup                : { id: 656, enabled: { lockedSheet: true } },
        PageSetupPaperKindCommandGroup                  : { id: 658, enabled: { lockedSheet: true } },
        PageSetupPrintGridlines                         : { id: 663, enabled : {readonlyMode: true, lockedSheet: true}},
        PageSetupPrintHeadings                          : { id: 664, enabled : {readonlyMode: true, lockedSheet: true}},

        InsertCellsCommandGroup                         : { id: 700, enabled: { lockedSheet: true } },
        InsertSheet                                     : { id: 701, enabled : {lockedSheet: true}, disabled: {lockedWorkbook: true}, menuVisible : { isTabSelectorMenu: true }, menuEnabled: { lockedWorkbook: false }},
        InsertSheetContextMenuItem                      : { id: 702 },
        InsertSheetRows                                 : { id: 703, customPermission: { property: "insertRowsLocked" } },
        InsertSheetRowsContextMenuItem                  : { id: 704, menuVisible: { isRowHeader: true }, customPermission: { property: "insertRowsLocked" } },
        InsertSheetColumns                              : { id: 705, customPermission: { property: "insertColumnsLocked" } },
        InsertSheetColumnsContextMenuItem               : { id: 706, menuVisible: { isColumnHeader: true }, customPermission: { property: "insertColumnsLocked" } },

        RemoveHyperlinkContextMenuItem                  : { id: 715, menuVisible: { isLink: true, isColumnSelected: false, isRowSelected: false, isAllSelected: false, isPivotTable: false }, disabled: { lockedCell: true }, customPermission: { property: "insertHyperlinksLocked" } }, //try to change this command

        RemoveSheetContextMenuItem                      : { id: 1001 },
        RemoveSheetRows                                 : { id: 1002, customPermission: { property: "deleteRowsLocked" } },
        RemoveSheetRowsContextMenuItem                  : { id: 1003, menuVisible: { isRowHeader: true }, customPermission: { property: "deleteRowsLocked" } },
        RemoveSheetColumns                              : { id: 1004, customPermission: { property: "deleteColumnsLocked" } },
        RemoveSheetColumnsContextMenuItem               : { id: 1005, menuVisible: { isColumnHeader: true }, customPermission: { property: "deleteColumnsLocked" } },
        RemoveCellsCommandGroup                         : { id: 1006, enabled : {lockedSheet: true}},

        FormatCommandGroup                              : { id: 1200, enabled : {lockedSheet: true}},
        FormatAutoFitRowHeight                          : { id: 1201, customPermission: { property: "formatRowsLocked" } },
        FormatAutoFitColumnWidth                        : { id: 1202, customPermission: { property: "formatColumnsLocked" } },
        HideRows                                        : { id: 1203, menuVisible: { isRowHeader: true }, customPermission: { property: "formatRowsLocked" } },
        HideColumns                                     : { id: 1205, menuVisible: { isColumnHeader: true }, customPermission: { property: "formatColumnsLocked" } },
        HideSheet                                       : { id: 1207, enabled : {lockedSheet: true}, disabled: {lockedWorkbook: true}, menuVisible : { isTabSelectorMenu: true }, menuEnabled: { lockedWorkbook: false, canHideSheet: true }},
        HideAndUnhideCommandGroup                       : { id: 1217, enabled : {lockedSheet: true}},
        DataSortAscending                               : { id: 1450, enabled: { canSort: true }, disabled: { readonlyMode: true }, menuVisible: { isFilterMenu: true }, isTableCommand: true, customPermission: { property: "sortLocked" } },
        DataSortDescending                              : { id: 1451, enabled: { canSort: true }, disabled: { readonlyMode: true }, menuVisible: { isFilterMenu: true }, isTableCommand: true, customPermission: { property: "sortLocked" } },

        DataFilterEquals                                : { id: 1452, customPermission: { property: "autoFiltersLocked" } },
        DataFilterDoesNotEqual                          : { id: 1453, customPermission: { property: "autoFiltersLocked" } },
        DataFilterGreaterThan                           : { id: 1454, customPermission: { property: "autoFiltersLocked" } },
        DataFilterGreaterThanOrEqualTo                  : { id: 1455, customPermission: { property: "autoFiltersLocked" } },
        DataFilterLessThan                              : { id: 1456, customPermission: { property: "autoFiltersLocked" } },
        DataFilterLessThanOrEqualTo                     : { id: 1457, customPermission: { property: "autoFiltersLocked" } },
        DataFilterBetween                               : { id: 1458, customPermission: { property: "autoFiltersLocked" } },
        DataFilterTop10                                 : { id: 1459, customPermission: { property: "autoFiltersLocked" } },
        DataFilterAboveAverage                          : { id: 1460, customPermission: { property: "autoFiltersLocked" } },
        DataFilterBelowAverage                          : { id: 1461, customPermission: { property: "autoFiltersLocked" } },
        DataFilterBeginsWith                            : { id: 1462, customPermission: { property: "autoFiltersLocked" } },
        DataFilterEndsWith                              : { id: 1463, customPermission: { property: "autoFiltersLocked" } },
        DataFilterContains                              : { id: 1464, customPermission: { property: "autoFiltersLocked" } },
        DataFilterDoesNotContain                        : { id: 1465, customPermission: { property: "autoFiltersLocked" } },
        DataFilterCustom                                : { id: 1466, customPermission: { property: "autoFiltersLocked" } },
        DataFilterClear                                 : { id: 1467, enabled: { isFilterApplied: true }, isTableCommand: true, customPermission: { property: "autoFiltersLocked" } },
        DataFilterColumnClear                           : { id: 1468, menuVisible: { isFilterMenu: true }, menuEnabled: { isFilterApplied: true }, customPermission: { property: "autoFiltersLocked" } },
        DataFilterReApply                               : { id: 1469, enabled: { isFilterApplied: true }, isTableCommand: true, customPermission: { property: "autoFiltersLocked" } },
        DataFilterToggle                                : { id: 1470, enabled: { canToggleFilter: true }, checked: { isFilterEnabled: true }, isTableCommand: true, customPermission: { property: "autoFiltersLocked" } },

        DataFilterSimple                                : { id: 1471, menuVisible: { isFilterMenu: true }, customPermission: { property: "autoFiltersLocked" } },

        DataFilterNumberFiltersCommandGroup             : { id: 1473, menuVisible : { isFilterMenu: true, isNumberColumn: true }, customPermission: { property: "autoFiltersLocked" }},
        DataFilterTextFiltersCommandGroup               : { id: 1474, menuVisible : { isFilterMenu: true, isTextColumn: true }, customPermission: { property: "autoFiltersLocked" }},
        DataFilterDateFiltersCommandGroup               : { id: 1475, menuVisible : { isFilterMenu: true, isDateColumn: true }, customPermission: { property: "autoFiltersLocked" }},
        DataFilterAllDatesInPeriodCommandGroup          : { id: 1476, customPermission: { property: "autoFiltersLocked" } },

        DataFilterSortAscending                         : { id: 1477, enabled: { canSort: true }, disabled: { readonlyMode: true }, menuVisible: { isFilterMenu: true }, isTableCommand: true, customPermission: { property: "sortLocked" } },
        DataFilterSortDescending                        : { id: 1478, enabled: { canSort: true }, disabled: { readonlyMode: true }, menuVisible: { isFilterMenu: true }, isTableCommand: true, customPermission: { property: "sortLocked" } },

        DataFilterToday                                 : { id: 1600, customPermission: { property: "autoFiltersLocked" }},
        DataFilterYesterday                             : { id: 1601, customPermission: { property: "autoFiltersLocked" }},
        DataFilterTomorrow                              : { id: 1602, customPermission: { property: "autoFiltersLocked" }},
        DataFilterThisWeek                              : { id: 1603, customPermission: { property: "autoFiltersLocked" }},
        DataFilterLastWeek                              : { id: 1604, customPermission: { property: "autoFiltersLocked" }},
        DataFilterNextWeek                              : { id: 1605, customPermission: { property: "autoFiltersLocked" }},
        DataFilterThisMonth                             : { id: 1606, customPermission: { property: "autoFiltersLocked" }},
        DataFilterLastMonth                             : { id: 1607, customPermission: { property: "autoFiltersLocked" }},
        DataFilterNextMonth                             : { id: 1608, customPermission: { property: "autoFiltersLocked" }},
        DataFilterThisQuarter                           : { id: 1609, customPermission: { property: "autoFiltersLocked" }},
        DataFilterLastQuarter                           : { id: 1610, customPermission: { property: "autoFiltersLocked" }},
        DataFilterNextQuarter                           : { id: 1611, customPermission: { property: "autoFiltersLocked" }},
        DataFilterThisYear                              : { id: 1612, customPermission: { property: "autoFiltersLocked" }},
        DataFilterLastYear                              : { id: 1613, customPermission: { property: "autoFiltersLocked" }},
        DataFilterNextYear                              : { id: 1614, customPermission: { property: "autoFiltersLocked" }},
        DataFilterYearToDa                              : { id: 1615, customPermission: { property: "autoFiltersLocked" }},
        DataFilterQuarter1                              : { id: 1616, customPermission: { property: "autoFiltersLocked" }},
        DataFilterQuarter2                              : { id: 1617, customPermission: { property: "autoFiltersLocked" }},
        DataFilterQuarter3                              : { id: 1618, customPermission: { property: "autoFiltersLocked" }},
        DataFilterQuarter4                              : { id: 1619, customPermission: { property: "autoFiltersLocked" }},
        DataFilterMonthJanuary                          : { id: 1620, customPermission: { property: "autoFiltersLocked" }},
        DataFilterMonthFebruary                         : { id: 1621, customPermission: { property: "autoFiltersLocked" }},
        DataFilterMonthMarch                            : { id: 1622, customPermission: { property: "autoFiltersLocked" }},
        DataFilterMonthApril                            : { id: 1623, customPermission: { property: "autoFiltersLocked" }},
        DataFilterMonthMay                              : { id: 1624, customPermission: { property: "autoFiltersLocked" }},
        DataFilterMonthJune                             : { id: 1625, customPermission: { property: "autoFiltersLocked" }},
        DataFilterMonthJuly                             : { id: 1626, customPermission: { property: "autoFiltersLocked" }},
        DataFilterMonthAugust                           : { id: 1627, customPermission: { property: "autoFiltersLocked" }},
        DataFilterMonthSeptember                        : { id: 1628, customPermission: { property: "autoFiltersLocked" }},
        DataFilterMonthOctober                          : { id: 1630, customPermission: { property: "autoFiltersLocked" }},
        DataFilterMonthNovember                         : { id: 1631, customPermission: { property: "autoFiltersLocked" }},
        DataFilterMonthDecember                         : { id: 1632, customPermission: { property: "autoFiltersLocked" }},
                                                            
        DataFilterDateEquals                            : { id: 1633, customPermission: { property: "autoFiltersLocked" }},
        DataFilterDateBefore                            : { id: 1634, customPermission: { property: "autoFiltersLocked" }},
        DataFilterDateAfter                             : { id: 1635, customPermission: { property: "autoFiltersLocked" }},
        DataFilterDateBetween                           : { id: 1636, customPermission: { property: "autoFiltersLocked" }},
        DataFilterDateCustom                            : { id: 1637, customPermission: { property: "autoFiltersLocked" }},

        DataToolsCircleInvalidData                      : { id: 1702},
        DataToolsClearValidationCircles                 : { id: 1703},

        InsertChartColumnCommandGroup                   : { id: 2170, customPermission: { property: "objectsLocked" } },
        InsertChartBarCommandGroup                      : { id: 2171, customPermission: { property: "objectsLocked" } },
        InsertChartColumn2DCommandGroup                 : { id: 2172, customPermission: { property: "objectsLocked" } },
        InsertChartColumn3DCommandGroup                 : { id: 2173, customPermission: { property: "objectsLocked" } },
        InsertChartCylinderCommandGroup                 : { id: 2174, customPermission: { property: "objectsLocked" } },
        InsertChartConeCommandGroup                     : { id: 2175, customPermission: { property: "objectsLocked" } },
        InsertChartPyramidCommandGroup                  : { id: 2176, customPermission: { property: "objectsLocked" } },
        InsertChartBar2DCommandGroup                    : { id: 2177, customPermission: { property: "objectsLocked" } },
        InsertChartBar3DCommandGroup                    : { id: 2178, customPermission: { property: "objectsLocked" } },
        InsertChartHorizontalCylinderCommandGroup       : { id: 2179, customPermission: { property: "objectsLocked" } },
        InsertChartHorizontalConeCommandGroup           : { id: 2180, customPermission: { property: "objectsLocked" } },
        InsertChartHorizontalPyramidCommandGroup        : { id: 2181, customPermission: { property: "objectsLocked" } },
        InsertChartPieCommandGroup                      : { id: 2182, customPermission: { property: "objectsLocked" } },
        InsertChartPie2DCommandGroup                    : { id: 2183, customPermission: { property: "objectsLocked" } },
        InsertChartPie3DCommandGroup                    : { id: 2184, customPermission: { property: "objectsLocked" } },
        InsertChartLineCommandGroup                     : { id: 2185, customPermission: { property: "objectsLocked" } },
        InsertChartLine2DCommandGroup                   : { id: 2186, customPermission: { property: "objectsLocked" } },
        InsertChartLine3DCommandGroup                   : { id: 2187, customPermission: { property: "objectsLocked" } },
        InsertChartAreaCommandGroup                     : { id: 2188, customPermission: { property: "objectsLocked" } },
        InsertChartArea2DCommandGroup                   : { id: 2189, customPermission: { property: "objectsLocked" } },
        InsertChartArea3DCommandGroup                   : { id: 2190, customPermission: { property: "objectsLocked" } },
        InsertChartScatterCommandGroup                  : { id: 2191, customPermission: { property: "objectsLocked" } },
        InsertChartBubbleCommandGroup                   : { id: 2192, customPermission: { property: "objectsLocked" } },
        InsertChartDoughnut2DCommandGroup               : { id: 2193, customPermission: { property: "objectsLocked" } },
        InsertChartOtherCommandGroup                    : { id: 2194, customPermission: { property: "objectsLocked" } },
        InsertChartStockCommandGroup                    : { id: 2195, customPermission: { property: "objectsLocked" } },
        InsertChartRadarCommandGroup                    : { id: 2196, customPermission: { property: "objectsLocked" } },
        InsertChartColumnClustered2D                    : { id: 2200, customPermission: { property: "objectsLocked" } },
        InsertChartColumnStacked2D                      : { id: 2201, customPermission: { property: "objectsLocked" } },
        InsertChartColumnPercentStacked2D               : { id: 2202, customPermission: { property: "objectsLocked" } },
        InsertChartColumnClustered3D                    : { id: 2203, customPermission: { property: "objectsLocked" } },
        InsertChartColumnStacked3D                      : { id: 2204, customPermission: { property: "objectsLocked" } },
        InsertChartColumnPercentStacked3D               : { id: 2205, customPermission: { property: "objectsLocked" } },
        InsertChartCylinderClustered                    : { id: 2206, customPermission: { property: "objectsLocked" } },
        InsertChartCylinderStacked                      : { id: 2207, customPermission: { property: "objectsLocked" } },
        InsertChartCylinderPercentStacked               : { id: 2208, customPermission: { property: "objectsLocked" } },
        InsertChartConeClustered                        : { id: 2209, customPermission: { property: "objectsLocked" } },
        InsertChartConeStacked                          : { id: 2210, customPermission: { property: "objectsLocked" } },
        InsertChartConePercentStacked                   : { id: 2211, customPermission: { property: "objectsLocked" } },
        InsertChartPyramidClustered                     : { id: 2212, customPermission: { property: "objectsLocked" } },
        InsertChartPyramidStacked                       : { id: 2213, customPermission: { property: "objectsLocked" } },
        InsertChartPyramidPercentStacked                : { id: 2214, customPermission: { property: "objectsLocked" } },
        InsertChartBarClustered2D                       : { id: 2215, customPermission: { property: "objectsLocked" } },
        InsertChartBarStacked2D                         : { id: 2216, customPermission: { property: "objectsLocked" } },
        InsertChartBarPercentStacked2D                  : { id: 2217, customPermission: { property: "objectsLocked" } },
        InsertChartBarClustered3D                       : { id: 2218, customPermission: { property: "objectsLocked" } },
        InsertChartBarStacked3D                         : { id: 2219, customPermission: { property: "objectsLocked" } },
        InsertChartBarPercentStacked3D                  : { id: 2220, customPermission: { property: "objectsLocked" } },
        InsertChartHorizontalCylinderClustered          : { id: 2221, customPermission: { property: "objectsLocked" } },
        InsertChartHorizontalCylinderStacked            : { id: 2222, customPermission: { property: "objectsLocked" } },
        InsertChartHorizontalCylinderPercentStacked     : { id: 2223, customPermission: { property: "objectsLocked" } },
        InsertChartHorizontalConeClustered              : { id: 2224, customPermission: { property: "objectsLocked" } },
        InsertChartHorizontalConeStacked                : { id: 2225, customPermission: { property: "objectsLocked" } },
        InsertChartHorizontalConePercentStacked         : { id: 2226, customPermission: { property: "objectsLocked" } },
        InsertChartHorizontalPyramidClustered           : { id: 2227, customPermission: { property: "objectsLocked" } },
        InsertChartHorizontalPyramidStacked             : { id: 2228, customPermission: { property: "objectsLocked" } },
        InsertChartHorizontalPyramidPercentStacked      : { id: 2229, customPermission: { property: "objectsLocked" } },
        InsertChartColumn3D                             : { id: 2230, customPermission: { property: "objectsLocked" } },
        InsertChartCylinder                             : { id: 2231, customPermission: { property: "objectsLocked" } },
        InsertChartCone                                 : { id: 2232, customPermission: { property: "objectsLocked" } },
        InsertChartPyramid                              : { id: 2233, customPermission: { property: "objectsLocked" } },
        InsertChartPie2D                                : { id: 2234, customPermission: { property: "objectsLocked" } },
        InsertChartPie3D                                : { id: 2235, customPermission: { property: "objectsLocked" } },
        InsertChartPieExploded2D                        : { id: 2236, customPermission: { property: "objectsLocked" } },
        InsertChartPieExploded3D                        : { id: 2237, customPermission: { property: "objectsLocked" } },
        InsertChartLine                                 : { id: 2238, customPermission: { property: "objectsLocked" } },
        InsertChartStackedLine                          : { id: 2239, customPermission: { property: "objectsLocked" } },
        InsertChartPercentStackedLine                   : { id: 2240, customPermission: { property: "objectsLocked" } },
        InsertChartLineWithMarkers                      : { id: 2241, customPermission: { property: "objectsLocked" } },
        InsertChartStackedLineWithMarkers               : { id: 2242, customPermission: { property: "objectsLocked" } },
        InsertChartPercentStackedLineWithMarkers        : { id: 2243, customPermission: { property: "objectsLocked" } },
        InsertChartLine3D                               : { id: 2244, customPermission: { property: "objectsLocked" } },
        InsertChartArea                                 : { id: 2245, customPermission: { property: "objectsLocked" } },
        InsertChartStackedArea                          : { id: 2246, customPermission: { property: "objectsLocked" } },
        InsertChartPercentStackedArea                   : { id: 2247, customPermission: { property: "objectsLocked" } },
        InsertChartArea3D                               : { id: 2248, customPermission: { property: "objectsLocked" } },
        InsertChartStackedArea3D                        : { id: 2249, customPermission: { property: "objectsLocked" } },
        InsertChartPercentStackedArea3D                 : { id: 2250, customPermission: { property: "objectsLocked" } },
        InsertChartScatterMarkers                       : { id: 2251, customPermission: { property: "objectsLocked" } },
        InsertChartScatterLines                         : { id: 2252, customPermission: { property: "objectsLocked" } },
        InsertChartScatterSmoothLines                   : { id: 2253, customPermission: { property: "objectsLocked" } },
        InsertChartScatterLinesAndMarkers               : { id: 2254, customPermission: { property: "objectsLocked" } },
        InsertChartScatterSmoothLinesAndMarkers         : { id: 2255, customPermission: { property: "objectsLocked" } },
        InsertChartBubble                               : { id: 2256, customPermission: { property: "objectsLocked" } },
        InsertChartBubble3D                             : { id: 2257, customPermission: { property: "objectsLocked" } },
        InsertChartDoughnut2D                           : { id: 2258, customPermission: { property: "objectsLocked" } },
        InsertChartDoughnutExploded2D                   : { id: 2259, customPermission: { property: "objectsLocked" } },
        InsertChartRadar                                : { id: 2260, customPermission: { property: "objectsLocked" } },
        InsertChartRadarWithMarkers                     : { id: 2261, customPermission: { property: "objectsLocked" } },
        InsertChartRadarFilled                          : { id: 2262, customPermission: { property: "objectsLocked" } },
        InsertChartStockHighLowClose                    : { id: 2263, customPermission: { property: "objectsLocked" } },
        InsertChartStockOpenHighLowClose                : { id: 2264, customPermission: { property: "objectsLocked" } },
        InsertChartStockVolumeHighLowClose              : { id: 2265, customPermission: { property: "objectsLocked" } },
        InsertChartStockVolumeOpenHighLowClose          : { id: 2266, customPermission: { property: "objectsLocked" } },
        ChartSwitchRowColumn                            : { id: 2379, isChartCommand: true, menuVisible: { isChart: true }, customPermission: { property: "objectsLocked" } },
        TableToolsToggleHeaderRow                       : { id: 2400, checked : { showHeaderRow    : true }, isTableCommand: true, isContextCommand: true },
        TableToolsToggleTotalRow                        : { id: 2401, checked : { showTotalRow     : true }, isTableCommand: true, isContextCommand: true },
        TableToolsToggleBandedColumns                   : { id: 2402, checked : { showBandedColumns: true }, isTableCommand: true, isContextCommand: true },
        TableToolsToggleBandedRows                      : { id: 2403, checked : { showBandedRows   : true }, isTableCommand: true, isContextCommand: true },
        TableToolsToggleFirstColumn                     : { id: 2404, checked : { showFirstColumn  : true }, isTableCommand: true, isContextCommand: true },
        TableToolsToggleLastColumn                      : { id: 2405, checked : { showLastColumn   : true }, isTableCommand: true, isContextCommand: true },
        TableToolsConvertToRange                        : { id: 2408, isTableCommand: true },

        ArrangeBringForwardCommandGroup                 : { id: 2600, menuVisible: { isDrawing: true }, menuEnabled: { isArrangeEnabled: true }, enabled: { isArrangeEnabled: true }, isPictureCommand: true, isChartCommand: true, customPermission: { property: "objectsLocked" } },
        ArrangeBringForward                             : { id: 2602, menuVisible: { isDrawing: true }, menuEnabled: { isArrangeEnabled: true }, enabled: { isArrangeEnabled: true }, isPictureCommand: true, isChartCommand: true, customPermission: { property: "objectsLocked" } },
        ArrangeBringToFront                             : { id: 2603, menuVisible: { isDrawing: true }, menuEnabled: { isArrangeEnabled: true }, enabled: { isArrangeEnabled: true }, isPictureCommand: true, isChartCommand: true, customPermission: { property: "objectsLocked" } },
        ArrangeSendBackwardCommandGroup                 : { id: 2604, menuVisible: { isDrawing: true }, menuEnabled: { isArrangeEnabled: true }, enabled: { isArrangeEnabled: true }, isPictureCommand: true, isChartCommand: true, customPermission: { property: "objectsLocked" } },
        ArrangeSendBackward                             : { id: 2606, menuVisible: { isDrawing: true }, menuEnabled: { isArrangeEnabled: true }, enabled: { isArrangeEnabled: true }, isPictureCommand: true, isChartCommand: true, customPermission: { property: "objectsLocked" } },
        ArrangeSendToBack                               : { id: 2607, menuVisible: { isDrawing: true }, menuEnabled: { isArrangeEnabled: true }, enabled: { isArrangeEnabled: true }, isPictureCommand: true, isChartCommand: true, customPermission: { property: "objectsLocked" } },

        ChartTitleCommandGroup                          : { id: 2341, isChartCommand: true, menuVisible: { isChart: true }, customPermission: { property: "objectsLocked" } },
        ChartTitleNone                                  : { id: 2342, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartTitleCenteredOverlay                       : { id: 2343, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartTitleAbove                                 : { id: 2344, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartAxisTitlesCommandGroup                     : { id: 2332, isChartCommand: true, menuVisible: { isChart: true }, customPermission: { property: "objectsLocked" } },
        ChartPrimaryHorizontalAxisTitleCommandGroup     : { id: 2333, isChartCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryVerticalAxisTitleCommandGroup       : { id: 2334, isChartCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryHorizontalAxisTitleNone             : { id: 2335, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryHorizontalAxisTitleBelow            : { id: 2336, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryVerticalAxisTitleNone               : { id: 2337, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryVerticalAxisTitleRotated            : { id: 2338, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryVerticalAxisTitleVertical           : { id: 2339, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryVerticalAxisTitleHorizontal         : { id: 2340, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartLegendCommandGroup                         : { id: 2345, isChartCommand: true, menuVisible: { isChart: true }, customPermission: { property: "objectsLocked" } },
        ChartLegendNone                                 : { id: 2346, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartLegendAtRight                              : { id: 2347, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartLegendAtTop                                : { id: 2348, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartLegendAtLeft                               : { id: 2349, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartLegendAtBottom                             : { id: 2350, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartLegendOverlayAtRight                       : { id: 2351, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartLegendOverlayAtLeft                        : { id: 2352, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartDataLabelsCommandGroup                     : { id: 2353, isChartCommand: true, menuVisible: { isChart: true }, customPermission: { property: "objectsLocked" } },
        ChartDataLabelsNone                             : { id: 2354, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartDataLabelsDefault                          : { id: 2355, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartDataLabelsCenter                           : { id: 2356, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartDataLabelsInsideEnd                        : { id: 2357, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartDataLabelsInsideBase                       : { id: 2358, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartDataLabelsOutsideEnd                       : { id: 2359, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartDataLabelsBestFit                          : { id: 2360, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartDataLabelsLeft                             : { id: 2361, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartDataLabelsRight                            : { id: 2362, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartDataLabelsAbove                            : { id: 2363, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartDataLabelsBelow                            : { id: 2364, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartGridlinesCommandGroup                      : { id: 2321, isChartCommand: true, menuVisible: { isChart: true }, customPermission: { property: "objectsLocked" } },
        ChartPrimaryHorizontalGridlinesCommandGroup     : { id: 2322, isChartCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryVerticalGridlinesCommandGroup       : { id: 2323, isChartCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryHorizontalGridlinesNone             : { id: 2324, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryHorizontalGridlinesMajor            : { id: 2325, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryHorizontalGridlinesMinor            : { id: 2326, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryHorizontalGridlinesMajorAndMinor    : { id: 2327, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryVerticalGridlinesNone               : { id: 2328, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryVerticalGridlinesMajor              : { id: 2329, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryVerticalGridlinesMinor              : { id: 2330, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryVerticalGridlinesMajorAndMinor      : { id: 2331, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartAxesCommandGroup                           : { id: 2300, isChartCommand: true, menuVisible: { isChart: true }, customPermission: { property: "objectsLocked" } },
        ChartPrimaryHorizontalAxisCommandGroup          : { id: 2301, isChartCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryVerticalAxisCommandGroup            : { id: 2302, isChartCommand: true, customPermission: { property: "objectsLocked" } },
        ChartHidePrimaryHorizontalAxis                  : { id: 2303, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryHorizontalAxisLeftToRight           : { id: 2304, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryHorizontalAxisRightToLeft           : { id: 2305, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryHorizontalAxisHideLabels            : { id: 2306, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryHorizontalAxisDefault               : { id: 2307, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryHorizontalAxisScaleLogarithm        : { id: 2308, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryHorizontalAxisScaleThousands        : { id: 2309, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryHorizontalAxisScaleMillions         : { id: 2310, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryHorizontalAxisScaleBillions         : { id: 2311, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartHidePrimaryVerticalAxis                    : { id: 2312, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryVerticalAxisLeftToRight             : { id: 2313, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryVerticalAxisRightToLeft             : { id: 2314, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryVerticalAxisHideLabels              : { id: 2315, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryVerticalAxisDefault                 : { id: 2316, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryVerticalAxisScaleLogarithm          : { id: 2317, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryVerticalAxisScaleThousands          : { id: 2318, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryVerticalAxisScaleMillions           : { id: 2319, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },
        ChartPrimaryVerticalAxisScaleBillions           : { id: 2320, isChartCommand: true, isContextCommand: true, customPermission: { property: "objectsLocked" } },

        PageSetup                                       : { id: 3700, enabled: { lockedSheet: true } },
        PageSetupMargins                                : { id: 3701, enabled: { lockedSheet: true } },
        PageSetupHeaderFooter                           : { id: 3702, enabled: { lockedSheet: true } },
        PageSetupSheet                                  : { id: 3703, enabled: { lockedSheet: true } },
        PageSetupCustomMargins                          : { id: 3704, enabled: { lockedSheet: true } },
        PageSetupMorePaperSizes                         : { id: 3705, enabled: { lockedSheet: true } },
                                                          
        ReviewInsertComment                             : { id: 3500, menuVisible: { isComment: false, isColumnSelected: false, isRowSelected: false, isAllSelected: false }, customPermission: { property: "objectsLocked" } },
        ReviewEditComment                               : { id: 3502, menuVisible: { isComment: true, isColumnSelected: false, isRowSelected: false, isAllSelected: false }, customPermission: { property: "objectsLocked" } },
        ReviewDeleteComment                             : { id: 3504, menuVisible: { isComment: true, isColumnSelected: false, isRowSelected: false, isAllSelected: false }, customPermission: { property: "objectsLocked" }, afterCommandExecutedMethod: "updateUI" },
        ReviewDeleteCommentContextMenuItem              : { id: 3505, menuVisible: { isComment: true, isColumnSelected: false, isRowSelected: false, isAllSelected: false }, customPermission: { property: "objectsLocked" }, afterCommandExecutedMethod: "updateUI" },
        ReviewShowHideComment                           : { id: 3506, menuVisible: { isComment: true, isColumnSelected: false, isRowSelected: false, isAllSelected: false }, customPermission: { property: "objectsLocked" } },
        ReviewShowAllComment                            : { id: 3508, menuVisible: { isComment: true, isColumnSelected: false, isRowSelected: false, isAllSelected: false }, customPermission: { property: "objectsLocked" } },

        
        OptionsPivotTable                               : { id: 3801 },
        OptionsPivotTableContextMenuItem                : { id: 3802 },
        MovePivotTable                                  : { id: 3803 },
        ChangeDataSourcePivotTable                      : { id: 3804 },
        SelectFieldTypePivotTable                       : { id: 3805 },
        FieldSettingsPivotTable                         : { id: 3806 },
        FieldSettingsPivotTableContextMenuItem          : { id: 3807 },

        DataFieldSettingsPivotTable                     : { id: 3808 },
        DataFieldSettingsPivotTableContextMenuItem      : { id: 3809 },

        //FieldListPanelPivotTable                        : { id: 3810 }, //Show Pivot table Field List
        PivotTableActionsClearGroup                     : { id: 3811, customPermission: { property: "pivotTablesLocked" } },
        ClearAllPivotTable                              : { id: 3812, customPermission: { property: "pivotTablesLocked" } },
        ClearFiltersPivotTable                          : { id: 3813, customPermission: { property: "pivotTablesLocked" } },
        PivotTableActionsSelectGroup                    : { id: 3814 },
        SelectValuesPivotTable                          : { id: 3815 },
        SelectLabelsPivotTable                          : { id: 3816 },
        SelectEntirePivotTable                          : { id: 3817 },
        PivotTableDataRefreshGroup                      : { id: 3818, customPermission: { property: "pivotTablesLocked" } },
        RefreshPivotTable                               : { id: 3819, menuVisible: { isPivotTable: true } },
        RefreshAllPivotTable                            : { id: 3820, customPermission: { property: "pivotTablesLocked" } },
        ShowPivotTableFieldHeaders                      : { id: 3821, customPermission: { property: "pivotTablesLocked" } },
        ShowPivotTableExpandCollapseButtons             : { id: 3822 },
        PivotTableLayoutSubtotalsGroup                  : { id: 3823 },
        PivotTableLayoutGrandTotalsGroup                : { id: 3824 },
        PivotTableLayoutReportLayoutGroup               : { id: 3825 },
        PivotTableLayoutBlankRowsGroup                  : { id: 3826 },
        PivotTableDoNotShowSubtotals                    : { id: 3827 },
        PivotTableShowAllSubtotalsAtBottom              : { id: 3828 },
        PivotTableShowAllSubtotalsAtTop                 : { id: 3829 },
        PivotTableGrandTotalsOffRowsColumns             : { id: 3830 },
        PivotTableGrandTotalsOnRowsColumns              : { id: 3831 },
        PivotTableGrandTotalsOnRowsOnly                 : { id: 3832 },
        PivotTableGrandTotalsOnColumnsOnly              : { id: 3833 },
        PivotTableShowCompactForm                       : { id: 3834 },
        PivotTableShowOutlineForm                       : { id: 3835 },
        PivotTableShowTabularForm                       : { id: 3836 },
        PivotTableRepeatAllItemLabels                   : { id: 3837 },
        PivotTableDoNotRepeatItemLabels                 : { id: 3838 },
        PivotTableInsertBlankLineEachItem               : { id: 3839 },
        PivotTableRemoveBlankLineEachItem               : { id: 3840 },
        PivotTableToggleRowHeaders                      : { id: 3841 },
        PivotTableToggleColumnHeaders                   : { id: 3842 },
        PivotTableToggleBandedRows                      : { id: 3843 },
        PivotTableToggleBandedColumns                   : { id: 3844 },
        ModifyPivotTableStyles                          : { id: 3845 },
        PivotTableExpandField                           : { id: 3846 },
        PivotTableCollapseField                         : { id: 3847 },

        PivotTablePageFieldsFilterItems                 : { id: 3850, customPermission: { property: "pivotTablesLocked" } },
        PivotTableRowFieldsFilterItems                  : { id: 3851, menuVisible: { isPivotTableFilterMenu: true, isRowFilter: true }, customPermission: { property: "pivotTablesLocked" } },
        PivotTableColumnFieldsFilterItems               : { id: 3852, menuVisible: { isPivotTableFilterMenu: true, isColumnFilter: true }, customPermission: { property: "pivotTablesLocked" } },

        FieldListPanelPivotTableContextMenuItem         : { id: 3855 },

        PivotTableExpandCollapseFieldCommandGroup       : { id: 3860 },
        PivotTableExpandFieldContextMenuItem            : { id: 3861 },
        PivotTableCollapseFieldContextMenuItem          : { id: 3862 },

        PivotTableFieldSortCommandGroup                 : { id: 3868 },
        PivotTableFieldsFiltersCommandGroup             : { id: 3869, menuVisible: { isPivotTableFilterMenu: true, isSingleColumnFilter: false }, customPermission: { property: "pivotTablesLocked" } },
        PivotTableLabelFiltersCommandGroup              : { id: 3870, menuVisible: { isPivotTableFilterMenu: true, isTextFilter: true }, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFiltersCommandGroup               : { id: 3871, menuVisible: { isPivotTableFilterMenu: true, isDateFilter: true }, customPermission: { property: "pivotTablesLocked" } },
        PivotTableValueFiltersCommandGroup              : { id: 3872, menuVisible: { isPivotTableFilterMenu: true }, customPermission: { property: "pivotTablesLocked" } },
        PivotTableFilterAllDatesInPeriodCommandGroup    : { id: 3873, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterToday                       : { id: 3874, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterYesterday                   : { id: 3875, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterTomorrow                    : { id: 3876, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterThisWeek                    : { id: 3877, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterNextWeek                    : { id: 3878, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterLastWeek                    : { id: 3879, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterThisMonth                   : { id: 3880, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterNextMonth                   : { id: 3881, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterLastMonth                   : { id: 3882, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterThisQuarter                 : { id: 3883, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterNextQuarter                 : { id: 3884, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterLastQuarter                 : { id: 3885, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterThisYear                    : { id: 3886, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterNextYear                    : { id: 3887, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterLastYear                    : { id: 3888, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterYearToDate                  : { id: 3889, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterFirstQuarter                : { id: 3890, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterSecondQuarter               : { id: 3891, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterThirdQuarter                : { id: 3892, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterFourthQuarter               : { id: 3893, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterJanuary                     : { id: 3894, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterFebruary                    : { id: 3895, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterMarch                       : { id: 3896, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterApril                       : { id: 3897, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterMay                         : { id: 3898, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterJune                        : { id: 3899, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterJuly                        : { id: 3900, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterAugust                      : { id: 3901, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterSeptember                   : { id: 3902, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterOctober                     : { id: 3903, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterNovember                    : { id: 3904, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterDecember                    : { id: 3905, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterEquals                      : { id: 3906, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterBefore                      : { id: 3907, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterAfter                       : { id: 3908, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterBetween                     : { id: 3909, customPermission: { property: "pivotTablesLocked" } },
        PivotTableDateFilterCustom                      : { id: 3910, customPermission: { property: "pivotTablesLocked" } },

        PivotTableLabelFilterEquals                     : { id: 3911, customPermission: { property: "pivotTablesLocked" } },
        PivotTableLabelFilterDoesNotEqual               : { id: 3912, customPermission: { property: "pivotTablesLocked" } },
        PivotTableLabelFilterBeginsWith                 : { id: 3913, customPermission: { property: "pivotTablesLocked" } },
        PivotTableLabelFilterDoesNotBeginWith           : { id: 3914, customPermission: { property: "pivotTablesLocked" } },
        PivotTableLabelFilterEndsWith                   : { id: 3915, customPermission: { property: "pivotTablesLocked" } },
        PivotTableLabelFilterDoesNotEndWith             : { id: 3916, customPermission: { property: "pivotTablesLocked" } },
        PivotTableLabelFilterContains                   : { id: 3917, customPermission: { property: "pivotTablesLocked" } },
        PivotTableLabelFilterDoesNotContain             : { id: 3918, customPermission: { property: "pivotTablesLocked" } },
        PivotTableLabelFilterGreaterThan                : { id: 3919, customPermission: { property: "pivotTablesLocked" } },
        PivotTableLabelFilterGreaterThanOrEqual         : { id: 3920, customPermission: { property: "pivotTablesLocked" } },
        PivotTableLabelFilterLessThan                   : { id: 3921, customPermission: { property: "pivotTablesLocked" } },
        PivotTableLabelFilterLessThanOrEqual            : { id: 3922, customPermission: { property: "pivotTablesLocked" } },
        PivotTableLabelFilterBetween                    : { id: 3923, customPermission: { property: "pivotTablesLocked" } },
        PivotTableLabelFilterNotBetween                 : { id: 3924, customPermission: { property: "pivotTablesLocked" } },

        PivotTableValueFilterEquals                     : { id: 3925, customPermission: { property: "pivotTablesLocked" } },
        PivotTableValueFilterDoesNotEqual               : { id: 3926, customPermission: { property: "pivotTablesLocked" } },
        PivotTableValueFilterGreaterThan                : { id: 3927, customPermission: { property: "pivotTablesLocked" } },
        PivotTableValueFilterGreaterThanOrEqual         : { id: 3928, customPermission: { property: "pivotTablesLocked" } },
        PivotTableValueFilterLessThan                   : { id: 3929, customPermission: { property: "pivotTablesLocked" } },
        PivotTableValueFilterLessThanOrEqual            : { id: 3930, customPermission: { property: "pivotTablesLocked" } },
        PivotTableValueFilterBetween                    : { id: 3931, customPermission: { property: "pivotTablesLocked" } },
        PivotTableValueFilterNotBetween                 : { id: 3932, customPermission: { property: "pivotTablesLocked" } },
        PivotTableValueFilterTop10                      : { id: 3933, customPermission: { property: "pivotTablesLocked" } },

        PivotTableClearFieldFilters                     : { id: 3934, menuVisible: { isPivotTableFilterMenu: true }, customPermission: { property: "pivotTablesLocked" } },
        PivotTableClearFieldLabelFilter                 : { id: 3935, menuVisible: { isPivotTableFilterMenu: true }, customPermission: { property: "pivotTablesLocked" } },
        PivotTableClearFieldValueFilter                 : { id: 3936, menuVisible: { isPivotTableFilterMenu: true }, customPermission: { property: "pivotTablesLocked" } },
        PivotTableFieldSortAscending                    : { id: 3937, menuVisible: { isPivotTableFilterMenu: true }, customPermission: { property: "pivotTablesLocked" } },
        PivotTableFieldSortDescending                   : { id: 3938, menuVisible: { isPivotTableFilterMenu: true }, customPermission: { property: "pivotTablesLocked" } },
        RemovePivotFieldCommand                         : { id: 3939 },
        RemoveGrandTotalPivotTable                      : { id: 3940 },

        PivotTableSummarizeValuesByCommandGroup         : { id: 3941 },
        PivotTableSummarizeValuesBySum                  : { id: 3942 },
        PivotTableSummarizeValuesByCount                : { id: 3943 },
        PivotTableSummarizeValuesByMin                  : { id: 3944 },
        PivotTableSummarizeValuesByMax                  : { id: 3945 },
        PivotTableSummarizeValuesByAverage              : { id: 3946 },
        PivotTableSummarizeValuesByProduct              : { id: 3947 },
        PivotTableSummarizeValuesByMoreOptions          : { id: 3948 },

        SubtotalPivotField                              : { id: 3949 },

        MovePivotFieldReferenceCommandGroup             : { id: 3950 },
        MovePivotFieldReferenceUp                       : { id: 3951 },
        MovePivotFieldReferenceDown                     : { id: 3952 },
        MovePivotFieldReferenceToBeginning              : { id: 3953 },
        MovePivotFieldReferenceToEnd                    : { id: 3954 },
        MovePivotFieldReferenceToDifferentAxis          : { id: 3955 },
        MovePivotFieldItemUp                            : { id: 3956 },
        MovePivotFieldItemDown                          : { id: 3957 },
        MovePivotFieldItemToBeginning                   : { id: 3958 },
        MovePivotFieldItemToEnd                         : { id: 3959 },

        PivotTableShowValuesAsCommandGroup              : { id: 3960 },
        PivotTableShowValuesAsNormal                    : { id: 3961 },
        PivotTableShowValuesAsPercentOfTotal            : { id: 3962 },
        PivotTableShowValuesAsPercentOfColumn           : { id: 3963 },
        PivotTableShowValuesAsPercentOfParentColumn     : { id: 3964 },
        PivotTableShowValuesAsPercentOfRow              : { id: 3965 },
        PivotTableShowValuesAsPercentOfParentRow        : { id: 3966 },
        PivotTableShowValuesAsIndex                     : { id: 3967 },
        PivotTableShowValuesAsMoreOptions               : { id: 3968 },
        PivotTableShowValuesAsPercentOfParent           : { id: 3969 },
        PivotTableShowValuesAsRunningTotal              : { id: 3970 },
        PivotTableShowValuesAsPercentOfRunningTotal     : { id: 3971 },
        PivotTableShowValuesAsRankAscending             : { id: 3972 },
        PivotTableShowValuesAsRankDescending            : { id: 3973 },
        PivotTableShowValuesAsPercent                   : { id: 3974 },
        PivotTableShowValuesAsDifference                : { id: 3975 },
        PivotTableShowValuesAsPercentDifference         : { id: 3976 },

        PivotTableCalculationFieldsItemsSetsGroup       : { id: 3977 },
        PivotTableCalculatedField                       : { id: 3978 },
        PivotTableCalculatedItem                        : { id: 3979 },
        PivotTableCalculatedItemSolveOrder              : { id: 3980 },
        PivotTableListFormulas                          : { id: 3981 },

        PivotTableGroupSelection                        : { id: 3982 },
        PivotTableUngroup                               : { id: 3983 },
        PivotTableGroupField                            : { id: 3984 },
        PivotTableGroupSelectionContextMenuItem         : { id: 3985 },
        PivotTableUngroupContextMenuItem                : { id: 3986 },

        PivotTableSortOptions                           : { id: 3990 }
    };

    var commandSeparator = ";#";

    // Server-side function
    function createCommand(CommandID, commandParamNames) {
        return function(spreadsheet, commandParams) {
            executeCommandBase(spreadsheet, CommandID, commandParamNames, commandParams);
        };
    }
    // Server-side custom processing command
    function createCustomProcessedCommand(CommandID, commandParamNames) {
        var customResultProcessingFunctionName = commandParamNames.CustomResultProcessingFunction;
        return function(spreadsheet, commandParams) {
            if(!commandParams.CustomResultProcessingFunction)
                commandParams.CustomResultProcessingFunction = customResultProcessingFunctionName;
            executeCommandBase(spreadsheet, CommandID, commandParamNames, commandParams);
        };
    }
    // Client-side command
    function createClientCommand(clientCommand) {
        return function(spreadsheet, params) {
            var ribbonUpdateMethod = spreadsheet.getRibbonManager()[clientCommand.ribbonManagerUpdateMethod],
                ribbonControl = spreadsheet.GetRibbon();

            if(ribbonControl && ribbonUpdateMethod)
                ribbonUpdateMethod(clientCommand.id);

            spreadsheet[clientCommand.spreadsheetExecuteMethod](params);
        };
    }
    // Client- and server- side function
    function createHybridCommand(hybridCommand, commandParamNames) {
        return function(spreadsheet, commandParams) {
            var ribbonUpdateMethod = spreadsheet.getRibbonManager()[hybridCommand.ribbonManagerUpdateMethod],
                ribbonControl = spreadsheet.GetRibbon();

            if(ribbonControl && ribbonUpdateMethod)
                ribbonUpdateMethod(hybridCommand.id);

            spreadsheet[hybridCommand.spreadsheetExecuteMethod](commandParams);

            executeCommandBase(spreadsheet, hybridCommand.id, commandParamNames, commandParams);
        };
    }
    // Execute server-side command via handler
    function executeCommandBase(spreadsheet, CommandID, commandParamNames, commandParams) {
        var requestParams = getRequestParams(CommandID, commandParamNames, commandParams);
        spreadsheet.prepareUICommandRequest(requestParams, CommandID, commandParams);
    }
    // Prepare command params
    function getRequestParams(CommandID, commandParamNames, commandParams) {
        var requestParams = "CommandID=" + CommandID;
        if(typeof commandParams == 'string' || commandParams instanceof String) {
            var keys = ASPx.GetObjectKeys(commandParamNames);
            requestParams += "&" + keys[0] + "=" + commandParams;
        } else if(commandParamNames) {
            for(var paramName in commandParamNames) {
                if(commandParamNames.hasOwnProperty(paramName)) {
                    var paramValue = commandParams ? commandParams[paramName] : "";
                    requestParams += "&" + paramName + "=" + encodeURIComponent(paramValue);
                }
            }
        }
        return requestParams;
    }

    // Custom server-side commands
    function createSaveCommand(CommandID, commandParamNames) {
        return function(spreadsheet, commandParams) {
            if(spreadsheet.getDocumentModel().hasSource())
                spreadsheet.SaveDocumentCallback();
            else
                spreadsheet.onUICommand(CommandIDs.FileSaveAs.id, null);
        };
    }
    function createFontSizeCommand(CommandID, commandParamNames) {
        return function(spreadsheet, commandParams) {
            var fontSizeValue = new RegExp('^[0-9]+$').test(commandParams) ? parseInt(commandParams) : null;
            if (ASPx.IsNumber(commandParams))
                commandParams = commandParams.toString();
            if(fontSizeValue !== null && fontSizeValue > 0 && fontSizeValue <= ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Font.MaxSize)
                executeCommandBase(spreadsheet, CommandID, commandParamNames, commandParams);
            else {
                spreadsheet.getRibbonManager().refreshFontSize();
                spreadsheet.showBuiltInMessage("InvalidFontSize", 0);
            }
        };
    }
    function createFontNameCommand(CommandID, commandParamNames) {
        return function(spreadsheet, commandParams) {
            if(commandParams)
                executeCommandBase(spreadsheet, CommandID, commandParamNames, commandParams);
            else
                spreadsheet.getRibbonManager().refreshFontName();
        };
    }
    function createBorderCommand(CommandID, commandParamNames) {
        return function(spreadsheet, commandParams) {
            if(commandParams.indexOf(commandSeparator))
                commandParams = commandParams.split(commandSeparator)[1];
            executeCommandBase(spreadsheet, CommandID, commandParamNames, commandParams);
        };
    }
    function createSetPaperKindCommand(CommandID, commandParamNames) {
        return function(spreadsheet, commandParams) {
            if(commandParams.indexOf(commandSeparator))
                commandParams = commandParams.split(commandSeparator)[1];
            executeCommandBase(spreadsheet, CommandID, commandParamNames, commandParams);
        };
    }
    function createAutoSumCommand(CommandID, commandParamNames) {
        return function(spreadsheet, commandParams) {
            if(spreadsheet.isSingleCellOrEmptyRangeSelected())
                spreadsheet.insertSpecificFunctionToActiveEditor(getFunctionNameById(CommandID));
            else executeCommandBase(spreadsheet, CommandID, commandParamNames, commandParams);
        };
    }
    function createFormulaCommand(CommandID, commandParamNames) {
        return function(spreadsheet, commandParams) {
            var commandName = commandParams.split(commandSeparator)[1];
            spreadsheet.insertSpecificFunctionToActiveEditor(commandName);
        };
    }
    function createExportCommand(CommandID, commandParamNames) {
        return function(spreadsheet, commandParams) {
            var requestParams = getRequestParams(CommandID, commandParamNames, commandParams),
                target = commandParams && commandParams.hasOwnProperty("Target") ? commandParams.Target : "_self";
            spreadsheet.sendDownloadCopyRequest(requestParams, target);
        };
    }
    function createPrintCommand(CommandID, commandParamNames) {
        return function(spreadsheet, commandParams) {
            var requestParams = getRequestParams(CommandID),
                target = commandParams && commandParams.hasOwnProperty("Target") ? commandParams.Target : "_self";

            spreadsheet.sendPrintRequest(requestParams, target);
        };
    }
    function createRenameSheetCommand(CommandID, commandParamNames) {
        return function(spreadsheet, commandParams) {
            executeCommandBase(spreadsheet, CommandID, commandParamNames, commandParams || commandParamNames);
        };
    }
    
    function getFunctionNameById (commandId) {
        if (CommandIDs.FunctionsInsertSum.id == commandId) return "SUM";
        if (CommandIDs.FunctionsInsertAverage.id == commandId) return "AVERAGE";   
        if (CommandIDs.FunctionsInsertCountNumbers.id == commandId) return "COUNT";
        if (CommandIDs.FunctionsInsertMax.id == commandId) return "MAX";      
        if (CommandIDs.FunctionsInsertMin.id == commandId) return "MIN";
    }

    var commands = {
        LoadInvisibleTiles                          : createCommand(CommandIDs.LoadInvisibleTiles.id,               { RequestId: undefined }),
        UpdateCell                                  : createCommand(CommandIDs.UpdateCell.id,                       { colIndex: undefined, rowIndex: undefined, NewValue: undefined, ReselectAfterCommand: undefined, ConfirmResult: "None", formulaSheetOwner: -1}),
        FormatFontName                              : createFontNameCommand(CommandIDs.FormatFontName.id,           { FontName: undefined }),
        FormatFontSize                              : createFontSizeCommand(CommandIDs.FormatFontSize.id,           { FontSize: undefined }),
        ResizeColumn                                : createCommand(CommandIDs.ResizeColumn.id,                     { ColumnIndex: undefined, ColumnWidth: undefined}),
        ResizeRow                                   : createCommand(CommandIDs.ResizeRow.id,                        { RowIndex: undefined, RowHeight: undefined}),
        FormatFontColor                             : createCommand(CommandIDs.FormatFontColor.id,                  { FormatFontColor: undefined}),
        FormatFillColor                             : createCommand(CommandIDs.FormatFillColor.id,                  { FormatFillColor: undefined}),
        FormatBorderLineColor                       : createCommand(CommandIDs.FormatBorderLineColor.id,            { FormatBorderLineColor: undefined}),
        FormatBorderLineStyle                       : createBorderCommand(CommandIDs.FormatBorderLineStyle.id,      { FormatBorderLineStyle: undefined}),
        InsertHyperlink                             : createCommand(CommandIDs.InsertHyperlink.id,                  { HyperLinkDisplayText: undefined, HyperLinkScreenTip: undefined, HyperLinkUrlAddress: undefined, IsDrawing: undefined }),
        InsertPicture                               : createCommand(CommandIDs.InsertPicture.id,                    { PicturePath:undefined}),
        RenameSheet                                 : createCommand(CommandIDs.RenameSheet.id,                      { NewName:undefined}),
        EditHyperlink                               : createCommand(CommandIDs.InsertHyperlink.id,                  { HyperLinkDisplayText: undefined, HyperLinkScreenTip: undefined, HyperLinkUrlAddress: undefined, IsDrawing: undefined }),
        ShapeMoveAndResize                          : createCommand(CommandIDs.ShapeMoveAndResize.id,               { shapeOffsetX:undefined, shapeOffsetY:undefined, shapeWidth:undefined, shapeHeight:undefined}),
        CommentMoveAndResize                        : createCommand(CommandIDs.CommentMoveAndResize.id,             { offsetTop: undefined, offsetLeft: undefined, boxWidth: undefined, boxHeight: undefined, Value: undefined }),
        
        FileOpen                                    : createCommand(CommandIDs.FileOpen.id, { FilePath: undefined }),
        FileSaveAs                                  : createCommand(CommandIDs.FileSaveAs.id,                       { FilePath:undefined}),
        FileSave                                    : createSaveCommand(CommandIDs.FileSave.id),
        FileNew                                     : createClientCommand(CommandIDs.FileNew),
        FunctionsInsertSum                          : createAutoSumCommand(CommandIDs.FunctionsInsertSum.id),
        FunctionsInsertAverage                      : createAutoSumCommand(CommandIDs.FunctionsInsertAverage.id),
        FunctionsInsertCountNumbers                 : createAutoSumCommand(CommandIDs.FunctionsInsertCountNumbers.id),
        FunctionsInsertMax                          : createAutoSumCommand(CommandIDs.FunctionsInsertMax.id),
        FunctionsInsertMin                          : createAutoSumCommand(CommandIDs.FunctionsInsertMin.id),
        FunctionsInsertSpecificFunction             : createFormulaCommand(CommandIDs.FunctionsInsertSpecificFunction.id),
        FormatRowHeight                             : createCommand(CommandIDs.FormatRowHeight.id,                  { RowHeight: undefined}),       
        FormatColumnWidth                           : createCommand(CommandIDs.FormatColumnWidth.id,                { ColumnWidth: undefined}),      
        FormatDefaultColumnWidth                    : createCommand(CommandIDs.FormatDefaultColumnWidth.id,         { DefaultColumnWidth: undefined}),
        UnhideSheet                                 : createCommand(CommandIDs.UnhideSheet.id,                      { SheetName: undefined}),
        ChartChangeType                             : createCommand(CommandIDs.ChartChangeType.id,                  { ChartType: undefined}),
        ChartSelectData                             : createCommand(CommandIDs.ChartSelectData.id,                  { SelectionRange: undefined, ActiveSheetIndex: undefined}),
        GetLocalizedStringConstant                  : createCommand(CommandIDs.GetLocalizedStringConstant.id,       { XtraSpreadsheetStringId: undefined, CustomResultProcessingFunction: undefined}),
        ModifyChartLayout                           : createCommand(CommandIDs.ModifyChartLayout.id,                { ChartLayoutPreset: undefined}),
        ChartChangeTitle                            : createCommand(CommandIDs.ChartChangeTitle.id,                 { ChartTitle: undefined}),
        ChartChangeHorizontalAxisTitle              : createCommand(CommandIDs.ChartChangeHorizontalAxisTitle.id,   { ChartHorizontalAxisTitle: undefined}),
        ChartChangeVerticalAxisTitle                : createCommand(CommandIDs.ChartChangeVerticalAxisTitle.id,     { ChartVerticalAxisTitle: undefined}),
        ModifyChartStyle                            : createCommand(CommandIDs.ModifyChartStyle.id,                 { ChartPresetStyle: undefined}),
        DownLoadCopy                                : createExportCommand(CommandIDs.DownLoadCopy.id,               { FileFormat: undefined, Target: undefined }),
        Print                                       : createPrintCommand(CommandIDs.Print.id,                       { Target: undefined }),
        SetPaperKind                                : createSetPaperKindCommand(CommandIDs.SetPaperKind.id,         { PaperKind: undefined}),
        AutoFitColumnWidth                          : createCommand(CommandIDs.AutoFitColumnWidth.id,               { Index: undefined }),
        AutoFitRowHeight                            : createCommand(CommandIDs.AutoFitRowHeight.id,                 { Index: undefined }),
        Paste                                       : createCommand(CommandIDs.Paste.id,                            { PasteValue: undefined, BufferId: undefined, HasClientClipboardData: undefined}),
        CopySelection                               : createCommand(CommandIDs.CopySelection.id,                    { BufferId: undefined}),
        CutSelection                                : createCommand(CommandIDs.CutSelection.id,                     { BufferId: undefined}),
        //client
        FullScreen                                  : createClientCommand(CommandIDs.FullScreen),
        PivotTableChangeActiveRowField              : createClientCommand(CommandIDs.PivotTableChangeActiveRowField),
        PivotTableChangeActiveColumnField           : createClientCommand(CommandIDs.PivotTableChangeActiveColumnField),
        //virtual
        LoadInvisibleTilesForFullScreenMode         : createCommand(CommandIDs.LoadInvisibleTiles.id, { FullScreenMode: undefined, RequestId: undefined }),
		FindAll                                     : createCustomProcessedCommand(CommandIDs.FindAll.id,           
            {
                    FindWhat: undefined, 
                    MatchCase: undefined, 
                    MatchEntireCellContent: undefined, 
                    SearchBy:   undefined, 
                    LookIn:     undefined, 
                    CustomResultProcessingFunction: "OnFindAllCommandResultProcessing"
            }),
		ScrollTo                                    : createCustomProcessedCommand(CommandIDs.ScrollTo.id,
            {
                CellPositionColumn: undefined,
                CellPositionRow: undefined,
                SelectAfterScroll: undefined,
                CustomResultProcessingFunction: "OnScrollToCommandResultProcessing"
            }),

        InsertTable                                 : createCommand(CommandIDs.InsertTable.id,                      {SelectedRange: undefined, HasHeaders: undefined }),
        InsertTableWithStyle                        : createCommand(CommandIDs.InsertTableWithStyle.id,             {SelectedRange: undefined, HasHeaders: undefined, TableStyle: undefined }),
        FetchAutoFilterViewModel                    : createCustomProcessedCommand(CommandIDs.FetchAutoFilterViewModel.id,
            {
                filterCommandId: undefined,
                CustomResultProcessingFunction: "OnAutoFilterViewModelReceived"
            }),

        ApplyAutoFilter                             : createCommand(CommandIDs.ApplyAutoFilter.id,
            {
                filterCommandId: undefined,
                ViewModel: undefined
            }),

        FetchDataValidationViewModel                : createCustomProcessedCommand(CommandIDs.FetchDataValidationViewModel.id,
            {
                CustomResultProcessingFunction: "OnDataValidationViewModelReceived"
            }),
        ApplyDataValidation                         : createCommand(CommandIDs.ApplyDataValidation.id,              { ViewModel: undefined }),
        FetchListAllowedValues                      : createCustomProcessedCommand(CommandIDs.FetchListAllowedValues.id,     
            {
                CustomResultProcessingFunction: "OnListAllowedValuesReceived"
            }),
        DataToolsCircleInvalidData                  : createCommand(CommandIDs.DataToolsCircleInvalidData.id),
        DataToolsClearValidationCircles             : createCommand(CommandIDs.DataToolsClearValidationCircles.id),
        MoveOrCopySheet                             : createCommand(CommandIDs.MoveOrCopySheet.id,                  {BeforeVisibleSheetIndex: undefined, CreateCopy: undefined}),
        FetchMessageForCell                         : createCustomProcessedCommand(CommandIDs.FetchMessageForCell.id,     
            {
                CustomResultProcessingFunction: "OnMessageForCellReceived"
            }),
        TableToolsRenameTable                       : createCommand(CommandIDs.TableToolsRenameTable.id,            { TableName: undefined }),
        ModifyTableStyle                            : createCommand(CommandIDs.ModifyTableStyle.id,                 { StyleName: undefined }),
        FormatAsTable                               : createCommand(CommandIDs.FormatAsTable.id,                    { StyleName: undefined }),
        RemoveSheet                                 : createRenameSheetCommand(CommandIDs.RemoveSheet.id,           { ForceRemove: false }),
        PageSetup                                   : createCommand(CommandIDs.PageSetup.id,                        { ViewModel: undefined }),
        FetchPageSetupViewModel                     : createCustomProcessedCommand(CommandIDs.FetchPageSetupViewModel.id,
            {
                CustomResultProcessingFunction: "OnPageSetupViewModelReceived"
            }),
        ApplyPageSetupSettings                      : createCommand(CommandIDs.ApplyPageSetupSettings.id,           { pageSetupViewModel: undefined }),

        MoveRange                                   : createCommand(CommandIDs.MoveRange.id,                        { Target: undefined }),
        FetchHeaderFooterViewModel                  : createCustomProcessedCommand(CommandIDs.FetchHeaderFooterViewModel.id,
            {
                CustomResultProcessingFunction: "OnHeaderFooterViewModelReceived",
                HeaderFooterSettings: undefined
            }),
        ApplyHeaderFooterViewModel                  : createCommand(CommandIDs.ApplyHeaderFooterViewModel.id,
            {
                headerFooterViewModel: undefined,
                HeaderFooterSettings: undefined
            }),
        RangeResize                                 : createCommand(CommandIDs.RangeResize.id, { Target: undefined }),
        FormatCells                                 : createCustomProcessedCommand(CommandIDs.FormatCells.id, {
            CellFormat: undefined,
            Params: undefined,
            ApplyFormat: undefined,
            CustomResultProcessingFunction: "OnNumberFormatSampleReceived"
        }),
        FetchFormatCellsViewModel                   : createCustomProcessedCommand(CommandIDs.FetchFormatCellsViewModel.id,
            {
                CustomResultProcessingFunction: "OnFormatCellsViewModelReceived"
            }),
        CommentEdit                                 : createCommand(CommandIDs.CommentEdit.id, { Value: undefined, Index: undefined }),
        NavigateToBookmark                          : createCustomProcessedCommand(CommandIDs.NavigateToBookmark.id,
            {
                Name: undefined,
                SheetName: undefined,
                
                lc: undefined,
                tr: undefined,
                rc: undefined,
                br: undefined
            }),
        ReadingView                                 : createClientCommand(CommandIDs.ReadingView),
        EditingView                                 : createClientCommand(CommandIDs.EditingView),
        InsertPivotTable                            : createCommand(CommandIDs.InsertPivotTable.id, { Range: undefined, NewSheet: undefined, Location: undefined }),
        ChageDataSourcePivotTableWebCommand         : createCommand(CommandIDs.ChageDataSourcePivotTableWebCommand.id, { Range: undefined, NewSheet: undefined, Location: undefined }),
        MovePivotTableWebCommand                    : createCommand(CommandIDs.MovePivotTableWebCommand.id, { Range: undefined, NewSheet: undefined, Location: undefined }),
        FieldListPanelPivotTable                    : createCommand(CommandIDs.FieldListPanelPivotTable.id, { cache: undefined }),
        MoveFieldPivotTable                         : createCommand(CommandIDs.MoveFieldPivotTable.id, { i: undefined, f: undefined, si: undefined, t: undefined, di: undefined, du: false, cache: undefined }),
        HideFieldListPanelPivotTable                : createHybridCommand(CommandIDs.HideFieldListPanelPivotTable),
        FetchPivotTableAutoFilterViewModel          : createCustomProcessedCommand(CommandIDs.FetchPivotTableAutoFilterViewModel.id, { bci: undefined, fi: undefined, CustomResultProcessingFunction: "notifyDialogResponseReceived" }),
        ApplyPivotTableDateAutoFilter               : createCommand(CommandIDs.ApplyPivotTableDateAutoFilter.id, { bci: undefined, fi: undefined, vm: undefined }),
        PivotTableDateFieldFiltering                : createCommand(CommandIDs.PivotTableDateFieldFiltering.id, { bci: undefined, fi: undefined }),
        ApplyPivotTableSimpleValueAutoFilter        : createCommand(CommandIDs.ApplyPivotTableSimpleValueAutoFilter.id, { bci: undefined, fi: undefined, vm: undefined }),
        ApplyPivotTableTop10AutoFilter              : createCommand(CommandIDs.ApplyPivotTableTop10AutoFilter.id, { bci: undefined, fi: undefined, vm: undefined }),
        ApplyPivotTableLabelAutoFilter              : createCommand(CommandIDs.ApplyPivotTableLabelAutoFilter.id, { bci: undefined, fi: undefined, vm: undefined }),
        ApplyPivotTableItemAutoFilter               : createCommand(CommandIDs.ApplyPivotTableItemAutoFilter.id, { bci: undefined, fi: undefined, vm: undefined }),
    };

    // TODO remove IIFE?
    (function ensureCommands(commands, commandIDs){
        for (var commandID in CommandIDs) {
            if(commandIDs.hasOwnProperty(commandID) && !commands[commandID])
                commands[commandID] = createCommand(CommandIDs[commandID].id);
        }
    })(commands, CommandIDs);

    var commandsByID;
    function getCommandsByID() {
        if(!commandsByID) {
            commandsByID = {};
            for(var commandID in CommandIDs) {
                if(CommandIDs.hasOwnProperty(commandID))
                    commandsByID[CommandIDs[commandID].id] = commandID;
            }
        }
        return commandsByID;
    }

    function createDefaultServerCommandIfCan(commandName) {
        if(CommandIDs[commandName]) {
            var command = createCommand(CommandIDs[commandName]);
            commands[commandName] = command;
            return command;
        }
    }

    commands.getCommandSeparator = function() {
        return commandSeparator;
    };

    commands.getCommandByID = function(commandID) {
        if(commands.isFormulaCommand(commandID))
            commandID = CommandIDs.FunctionsInsertSpecificFunction.id;
        else if(commands.isBorderLineStyleCommand(commandID))
            commandID = CommandIDs.FormatBorderLineStyle.id;
        else if(commands.isSetPaperKindCommand(commandID))
            commandID = CommandIDs.SetPaperKind.id;
        else if(commands.isPivotTableChangeFieldCommand(commandID))
            commandID = CommandIDs.PivotTableChangeActiveRowField.id;
        if(commands.isPivotTableAutoFilterCommand(commandID))
            commandID = CommandIDs.PivotTableDateFieldFiltering.id;

        var commandName = getCommandsByID()[commandID];
        return this.getCommandByName(commandName);
    };

    commands.getCommandConfigByID = function(commandID) {
        var commandName = getCommandsByID()[commandID];
        return CommandIDs[commandName];
    };

    commands.isPivotTableAutoFilterCommand = function(commandID) {        
        return (commandID >= 3934 && commandID <= 3938) || //Clear filter and sorting
                (commandID > 3872 && commandID < 3906); //DateTime
    };

    commands.isPivotTableChangeFieldCommand = function(commandID) {
        if(commandID.indexOf && commandID.indexOf(commandSeparator) > 0)
            commandID = commandID.split(commandSeparator)[0];
        return commandID == CommandIDs.PivotTableChangeActiveRowField.id;
    };

    commands.isFormulaCommand = function(commandID) {
        if(commandID.indexOf && commandID.indexOf(commandSeparator) > 0)
            commandID = commandID.split(commandSeparator)[0]; 
        return commandID == CommandIDs.FunctionsInsertSpecificFunction.id;
    };

    commands.isCellUpdateCommand = function(commandID) {
		return commandID == CommandIDs.UpdateCell.id;
    };

    commands.isBorderLineStyleCommand = function(commandID) {
        if(commandID.indexOf && commandID.indexOf(commandSeparator) > 0)
            commandID = commandID.split(commandSeparator)[0]; 
        return commandID == CommandIDs.FormatBorderLineStyle.id;
    };

    commands.isSetPaperKindCommand = function(commandID) {
        if(commandID.indexOf && commandID.indexOf(commandSeparator) > 0)
            commandID = commandID.split(commandSeparator)[0]; 
        return commandID == CommandIDs.SetPaperKind.id;
    };

    commands.isChangeViewModeCommand = function(commandID) {
        if(commandID.indexOf && commandID.indexOf(commandSeparator) > 0)
            commandID = commandID.split(commandSeparator)[0];
        return commandID == CommandIDs.EditingView.id || commandID == CommandIDs.ReadingView.id;
    };

    commands.getParentCommandId = function(commandID) {
        if(commandID.indexOf && commandID.indexOf(commandSeparator) > 0) {
            if(this.isSetPaperKindCommand(commandID))
                return CommandIDs.SetPaperKind.id;
            if(this.isBorderLineStyleCommand(commandID))
                return CommandIDs.FormatBorderLineStyle.id;
            if(this.isFormulaCommand(commandID))
                return CommandIDs.FunctionsInsertSpecificFunction.id;
        }
        return commandID;
    };

    commands.getPivotTableAutoFilterCommandParams = function(command, params) {
        return {
            bci: command,
            fi: params.fi
        };
    };

    commands.getIsCopyCommand = function(commandID) {
        return commandID == CommandIDs.CopySelection.id;
    };
    commands.getIsCutCommand = function(commandID) {
        return commandID == CommandIDs.CutSelection.id;
    };
    commands.getIsCutOrCopyCommand = function(commandID) {
        return this.getIsCopyCommand(commandID) || this.getIsCutCommand(commandID);
    };
    commands.getIsPasteCommand = function(commandID) {
        return commandID == CommandIDs.Paste.id;
    };

    commands.getCommandIDByName = function(commandName){
        return CommandIDs[commandName];
    };

    commands.getCommandByName = function(commandName){
        var command = commands[commandName];
        if(command)
            return command;
        command = createDefaultServerCommandIfCan(commandName);
        return command;
    };

    commands.isUIBlockingCommand = function(commandId) {
        var uiBlockingCommands = this.getUIBlockingCommandsIDs();
        return !!uiBlockingCommands[commandId];
    };

    commands.isCommandChangingDocument = function(commandId) {
        var commandDoesntChangeDocument = this.getWorkbookNotChangingCommandsIDs()[commandId];
        return !commandDoesntChangeDocument;
    };

    commands.isCommandDisableInReadOnlyMode = function(commandId) {
        var readOnlyEnabledCommands = this.getReadOnlyModeEnabledCommandsIDs();
        return !readOnlyEnabledCommands[commandId];
    };
    commands.isCommandDisabledForLockedSheet = function(commandId) {
        var sheetLockedEnabledCommandIDs = this.getLockedSheetEnabledCommandsIDs();
        return !sheetLockedEnabledCommandIDs[commandId];
    };
    commands.isCommandDisabledForLockedCell = function(commandId) {
        var cellLockedEnabledCommandIDs = this.getLockedCellEnabledCommandsIDs();
        return !cellLockedEnabledCommandIDs[commandId];
    };
    commands.isCommandDisabledForLockedWorkbook = function(commandId) {
        var workbookLockedEnabledCommandIDs = this.getLockedWorkbookEnabledCommandsIDs();
        return !workbookLockedEnabledCommandIDs[commandId];
    };
    commands.isSelectionChangingCommand = function(commandId) {
        return commandId == CommandIDs.HideColumns.id || commandId == CommandIDs.HideRows.id || commandId == CommandIDs.UnhideColumns.id || commandId == CommandIDs.UnhideRows.id;
    };
    commands.isCustomPermissionCommand = function(commandId) {
        return !!this.getCustomPermissionCommandsIDs()[commandId];
    };
    commands.isCommandInternal = function(commandId) {
        return !!this.getCommandByID(commandId);
    };
 

    var editModeDisabledCommandsIDs,
        uiBlockingCommandsIDs,
        readOnlyModeEnabledCommandsIDs,
        sheetLockedEnabledCommandIDs,
        cellLockedEnabledCommandIDs,
        workbookLockedEnabledCommandIDs,
        workbookNotChangingCommandsIDs,
        tableCommandsIDs,
        pictureCommandIDs,
        chartCommandIDs,
        customPermissionCommandIDs;

    commands.getEditModeDisabledCommandsIDs = function() {
        if(!editModeDisabledCommandsIDs)
            fillCommandsArrays();
        return editModeDisabledCommandsIDs;
    };

    commands.getUIBlockingCommandsIDs = function() {
        if(!uiBlockingCommandsIDs)
            fillCommandsArrays();
        return uiBlockingCommandsIDs;
    };

    commands.getReadOnlyModeEnabledCommandsIDs = function() {
        if(!readOnlyModeEnabledCommandsIDs)
           fillCommandsArrays();  
        return readOnlyModeEnabledCommandsIDs;
    };
    commands.getLockedSheetEnabledCommandsIDs = function() {
        if(!sheetLockedEnabledCommandIDs)
           fillCommandsArrays();  
        return sheetLockedEnabledCommandIDs;
    };
    commands.getLockedCellEnabledCommandsIDs = function() {
        if(!cellLockedEnabledCommandIDs)
           fillCommandsArrays();  
        return cellLockedEnabledCommandIDs;
    };
    commands.getLockedWorkbookEnabledCommandsIDs = function() {
        if(!workbookLockedEnabledCommandIDs)
           fillCommandsArrays();  
        return workbookLockedEnabledCommandIDs;
    };

    commands.getWorkbookNotChangingCommandsIDs = function() {
        if(!workbookNotChangingCommandsIDs) {
            workbookNotChangingCommandsIDs = {};
            var ids = [CommandIDs.LoadSheet.id,
            CommandIDs.LoadInvisibleTiles.id,
            CommandIDs.FileSave.id,
            CommandIDs.FileSaveAs.id,
            CommandIDs.FileOpen.id,
            CommandIDs.GetLocalizedStringConstant.id,
            CommandIDs.DownLoadCopy.id,
            CommandIDs.Print.id,
            CommandIDs.FindAll.id,
            CommandIDs.ScrollTo.id,
            CommandIDs.NavigateToBookmark.id,
            CommandIDs.GetPictureContent.id,
            CommandIDs.LoadInvisibleTilesForFullScreenMode.id,
            CommandIDs.FullScreen.id,
            CommandIDs.CopySelection.id,
            CommandIDs.FetchAutoFilterViewModel.id,
            CommandIDs.FetchDataValidationViewModel.id,
            CommandIDs.FetchListAllowedValues.id,
            CommandIDs.DataToolsCircleInvalidData.id,
            CommandIDs.DataToolsClearValidationCircles.id,
            CommandIDs.FetchMessageForCell.id];
            for(var i in ids)
                if(ids.hasOwnProperty(i))
                    workbookNotChangingCommandsIDs[ids[i]] = true;
        }
        return workbookNotChangingCommandsIDs;
    };

    commands.getTableCommandsIDs = function() {
        if(!tableCommandsIDs)
            fillCommandsArrays();
        return tableCommandsIDs;
    };

    commands.getPictureCommandsIDs = function() {
        if(!pictureCommandIDs)
            fillCommandsArrays();
        return pictureCommandIDs;
    };

    commands.getChartCommandsIDs = function() {
        if(!chartCommandIDs)
            fillCommandsArrays();
        return chartCommandIDs;
    };

    commands.getCustomPermissionCommandsIDs = function() {
        if(!customPermissionCommandIDs)
            fillCommandsArrays();
        return customPermissionCommandIDs;
    };

    commands.internalCommands = CommandIDs;

    commands.isPivotFieldSortCommand = function(commandID) {
        if(commandID && commandID.indexOf)
            commandID = parseInt(commandID);
        return CommandIDs.PivotTableFieldSortAscending.id === commandID ||
            CommandIDs.PivotTableFieldSortDescending.id === commandID;
    };
    commands.isPivotFieldValueFilterCommand = function(commandID) {
        if(commandID && commandID.indexOf)
            commandID = parseInt(commandID);
        return commandID === CommandIDs.PivotTableValueFiltersCommandGroup.id;
    };
    commands.isPivotFieldDateFilterCommand = function(commandID) {
        if(commandID && commandID.indexOf)
            commandID = parseInt(commandID);
        return commandID === CommandIDs.PivotTableDateFiltersCommandGroup.id;
    };
    commands.isPivotFieldLabelFilterCommand = function(commandID) {
        if(commandID && commandID.indexOf)
            commandID = parseInt(commandID);
        return commandID === CommandIDs.PivotTableLabelFiltersCommandGroup.id;
    };
    function fillCommandsArrays() {
        uiBlockingCommandsIDs = {};
        readOnlyModeEnabledCommandsIDs = {};
        editModeDisabledCommandsIDs = {};
        sheetLockedEnabledCommandIDs = {};
        cellLockedEnabledCommandIDs = {};
        workbookLockedEnabledCommandIDs = {};
        tableCommandsIDs = {};
        pictureCommandIDs = {};
        chartCommandIDs = {};
        customPermissionCommandIDs = {};

        for(var commandID in CommandIDs) {
            if(!CommandIDs.hasOwnProperty(commandID)) continue;
            var command = CommandIDs[commandID];
            if(command.enabled && command.enabled.readonlyMode) 
                readOnlyModeEnabledCommandsIDs[command.id] = commandID;
            if(command.enabled && command.enabled.lockedSheet) 
                sheetLockedEnabledCommandIDs[command.id] = commandID;
            if(!command.disabled || !command.disabled.lockedCell) 
                cellLockedEnabledCommandIDs[command.id] = commandID;
            if(!command.disabled || !command.disabled.lockedWorkbook) 
                workbookLockedEnabledCommandIDs[command.id] = commandID;
            if(command.UIBlocking) 
                uiBlockingCommandsIDs[command.id] = commandID;
            if(!command.enabled || !command.enabled.editMode) 
                editModeDisabledCommandsIDs[command.id] = commandID;
            if(command.isTableCommand)
                tableCommandsIDs[command.id] = commandID;
            if(command.isPictureCommand)
                pictureCommandIDs[command.id] = commandID;
            if(command.isChartCommand)
                chartCommandIDs[command.id] = commandID;
            if(command.customPermission)
                customPermissionCommandIDs[command.id] = commandID;
        }
    }

    ASPxClientSpreadsheet.CommandsCreator = {
        createCommand: createCommand,
        createCustomProcessedCommand: createCustomProcessedCommand,
        CommandIDs: CommandIDs
    };

    return commands;
})();
(function() {

    ASPxClientSpreadsheet.CommandManager = (function() {
        var commandStack = [];

        function CommandManager(control) {
            this.control = control;
            this.commands = {};
            this.createCommnds();
            this.intervalId = -1;
            this.considerIntervalBetweenEdits = true;
            this.considerIntervalBetweenKeyboardEvents = false;
            this.batchTileCacheUpdating = true;

            this.enableBatch = !ASPx.Browser.TouchUI;
        }

        CommandManager.prototype = {
            isBatchEditingEnabled: function() {
                return this.enableBatch;
            },
            createCommnds: function() {
                this.createCommnd(ASPxClientSpreadsheet.ClientCommands.UpdateCell, ASPxClientSpreadsheet.Commands.UpdateCell);

                this.createCommnd(ASPxClientSpreadsheet.ClientCommands.FormatClearContents, ASPxClientSpreadsheet.Commands.FormatClearContents);

                this.createCommnd(ASPxClientSpreadsheet.ClientCommands.FormatFontBold, ASPxClientSpreadsheet.Commands.FormatFontBold);
                this.createCommnd(ASPxClientSpreadsheet.ClientCommands.FormatFontItalic, ASPxClientSpreadsheet.Commands.FormatFontItalic);
                this.createCommnd(ASPxClientSpreadsheet.ClientCommands.FormatFontUnderline, ASPxClientSpreadsheet.Commands.FormatFontUnderline);
                this.createCommnd(ASPxClientSpreadsheet.ClientCommands.FormatFontStrikeout, ASPxClientSpreadsheet.Commands.FormatFontStrikeout);

                this.createCommnd(ASPxClientSpreadsheet.ClientCommands.FormatAlignmentLeft, ASPxClientSpreadsheet.Commands.FormatAlignmentLeft);
                this.createCommnd(ASPxClientSpreadsheet.ClientCommands.FormatAlignmentCenter, ASPxClientSpreadsheet.Commands.FormatAlignmentCenter);
                this.createCommnd(ASPxClientSpreadsheet.ClientCommands.FormatAlignmentRight, ASPxClientSpreadsheet.Commands.FormatAlignmentRight);

                this.createCommnd(ASPxClientSpreadsheet.ClientCommands.FormatAlignmentTop, ASPxClientSpreadsheet.Commands.FormatAlignmentTop);
                this.createCommnd(ASPxClientSpreadsheet.ClientCommands.FormatAlignmentMiddle, ASPxClientSpreadsheet.Commands.FormatAlignmentMiddle);
                this.createCommnd(ASPxClientSpreadsheet.ClientCommands.FormatAlignmentBottom, ASPxClientSpreadsheet.Commands.FormatAlignmentBottom);

                this.createCommnd(ASPxClientSpreadsheet.ClientCommands.BatchProcessing, ASPxClientSpreadsheet.Commands.BatchProcessing);
            },
            createCommnd: function(key, commandType) {
                this.commands[key] = new commandType(this.control, key);
            },

            processCommand: function(key, parameters) {
                if(this.isBatchEditingEnabled()) {
                    var command = this.getCommand(key);
                    if(command)
                        return this.executeCommnd(command, parameters);
                }
                return false;
            },

            getCommand: function(key) {
                return this.commands[key];
            },
            executeCommnd: function(command, parameter) {
                return command.execute(this, parameter);
            },
            beginCommandExecuting: function() { },
            endCommandExecuted: function(command, commndInfo, commandMode, parameters) {
                if(command.getCommandResult()) {
                    var commandObject = { args: commndInfo, mode: commandMode, commandId: command.conmmandId, commandParams: parameters };
                    appendCommandToStack(commandObject);

                    this.startSynchronizationWatcher();
                }
            },
            startSynchronizationWatcher: function() {
                if(!this.thereAreUnsavedChanges()) {
                    if(!this.control.InCallback())
                        this.synchronizeClientData();

                    this.intervalId = window.setInterval(this.queryProcessing.aspxBind(this), ASPxClientSpreadsheet.ClientCommands.SynchronizationTimerInterval);
                }
            },

            needToConsiderIntervalBetweenEdits: function() {
                return this.considerIntervalBetweenEdits;
            },
            needToConsiderIntervalBetweenKeyboardEvents: function() {
                return this.considerIntervalBetweenKeyboardEvents;
            },
            canSynchronizeChanges: function() {
                return !(this.control.isControlBusy() ||
                    (this.needToConsiderIntervalBetweenEdits() && (this.control.timeFromLastEditing() < ASPxClientSpreadsheet.ClientCommands.MinIntervalBetweenEdits)) ||
                    (this.needToConsiderIntervalBetweenKeyboardEvents() && (this.control.timeFromLastKeyboardEvent() < ASPxClientSpreadsheet.ClientCommands.MinIntervalBetweenKeyboardEvents)));
            },

            queryProcessing: function() {
                if(this.canSynchronizeChanges()) {
                    this.synchronizeClientData();
                }
            },
            synchronizeClientData: function() {
                this.beginSynchronization();
                this.endSynchronization();
            },
            beginSynchronization: function() {
                var unsynchronizedDate = getContinuousCommands();
                if(unsynchronizedDate.length === 1 && unsynchronizedDate[0].mode === ASPxClientSpreadsheet.CommandManager.CommandMode.DetachedCommand) {
                    var command = unsynchronizedDate[0];
                    this.control.processCommandRequest(command.args.replace(/\|/g, "&"), command.commandId, command.commandParams);
                } else {
                    if(unsynchronizedDate.length > 0) {
                        var batchProcessingCommand = this.getCommand(ASPxClientSpreadsheet.ClientCommands.BatchProcessing);
                        batchProcessingCommand.execute(unsynchronizedDate);
                    }
                }
            },
            endSynchronization: function() {
                if(isSynchronizationCompleted()) {
                    window.clearInterval(this.intervalId);
                    this.intervalId = -1;
                    clearCommandStack();
                }
            },
            thereAreUnsavedChanges: function() {
                return this.intervalId !== -1 && (!isSynchronizationCompleted() || this.hasActiveValidations());
            },
            hasActiveValidations: function() {
                return this.control.getValidationHelper().getCurrentlyValidatingCell() != null;
            },
            getNotActulizedData: function(withoutCommand) {
                var batchProcessingCommand = this.getCommand(ASPxClientSpreadsheet.ClientCommands.BatchProcessing),
                    queryString = batchProcessingCommand.getSupportedQueryString(commandStack, withoutCommand);
                clearCommandStack();
                this.endSynchronization();
                return queryString;
            },

            updateUI: function() {
                this.control.ribbonStateUpdate("onActiveCellChanged");
            }
        };

        function clearCommandStack() {
            commandStack = [];
        }

        function appendCommandToStack(command) {
            commandStack.push(command);
        }

        function getContinuousCommands() {
            var continuousCommands = [];
            while(commandStack.length > 0) {
                if(commandStack[0].mode === ASPxClientSpreadsheet.CommandManager.CommandMode.BatchEditingCommand)
                    continuousCommands.push(commandStack.shift());
                else if(commandStack[0].mode === ASPxClientSpreadsheet.CommandManager.CommandMode.DetachedCommand) {
                    if(continuousCommands.length === 0)
                        return [commandStack.shift()];
                    else break;
                }
            }

            return continuousCommands;
        }

        function isSynchronizationCompleted() {
            return commandStack.length === 0;
        }

        return CommandManager;
    })();

    ASPxClientSpreadsheet.ClientCommands = (function() {
        var COMMAND_ID_PARAM_NAME = "CommandID";
        var SUPPORTED_COMMAND_ID_PARAM_NAME = "SupportedID";

        var Command = {};

        Command.getCommandIdParamName = function() {
            return COMMAND_ID_PARAM_NAME;
        };

        Command.getSupportedCommandIdParamName = function() {
            return SUPPORTED_COMMAND_ID_PARAM_NAME;
        };

        Command.DefaultCommandResult = true;

        Command.SynchronizationTimerInterval = 500;
        Command.MinIntervalBetweenEdits = 250;
        Command.MinIntervalBetweenKeyboardEvents = 100;

        Command.UpdateCell = "w2";
        Command.w2 = Command.UpdateCell;

        Command.FormatClearContents = "203";
        Command["203"] = Command.FormatClearContents;

        Command.FormatFontBold = "100";
        Command["100"] = Command.FormatFontBold;

        Command.FormatFontItalic = "101";
        Command["101"] = Command.FormatFontItalic;

        Command.FormatFontUnderline = "102";
        Command["102"] = Command.FormatFontUnderline;

        Command.FormatFontStrikeout = "103";
        Command["103"] = Command.FormatFontStrikeout;

        Command.FormatAlignmentLeft = "110";
        Command["110"] = Command.FormatAlignmentLeft;

        Command.FormatAlignmentCenter = "111";
        Command["111"] = Command.FormatAlignmentCenter;

        Command.FormatAlignmentRight = "112";
        Command["112"] = Command.FormatAlignmentRight;

        Command.FormatAlignmentTop = "113";
        Command["113"] = Command.FormatAlignmentTop;

        Command.FormatAlignmentMiddle = "114";
        Command["114"] = Command.FormatAlignmentMiddle;

        Command.FormatAlignmentBottom = "115";
        Command["115"] = Command.FormatAlignmentBottom;

        Command.BatchProcessing = "w65";
        Command.w65 = Command.BatchProcessing;

        return Command;
    })();

    ASPxClientSpreadsheet.CommandManager.CommandMode = {
        BatchEditingCommand: 0,
        DetachedCommand: 1,
        WaitingSynchronization: 2
    };
})();
(function() {

    var DefaultFontProperties = {
        NumberDefaultTextAlign: "right",
        StringDefaultTextAlign: "left",
        DefaultVerticvalAlign: "bottom",

        getDefaultTextAlign: function(isNumber) {
            return isNumber ? this.NumberDefaultTextAlign : this.StringDefaultTextAlign;
        }
    };

    ASPxClientSpreadsheet.Commands.FormatFontBold = ASPx.CreateClass(ASPxClientSpreadsheet.CommandBase, {
        executeCore: function(state, parameters) {
            var colVisibleIndex = state.activeCellColIndex,
                rowVisibleIndex = state.activeCellRowIndex,
                cellElement = this.getCellElementByVisiblePosition(colVisibleIndex, rowVisibleIndex);
            if(cellElement) {
                var isBold = cellElement.style.fontWeight !== "";
                ASPx.SetStyles(cellElement, { fontWeight: isBold ? "" : "bold" });
            }
        }
    });

    ASPxClientSpreadsheet.Commands.FormatFontItalic = ASPx.CreateClass(ASPxClientSpreadsheet.CommandBase, {
        executeCore: function(state, parameters) {
            var colVisibleIndex = state.activeCellColIndex,
                rowVisibleIndex = state.activeCellRowIndex,
                cellElement = this.getCellElementByVisiblePosition(colVisibleIndex, rowVisibleIndex);
            if(cellElement) {
                var isItalic = cellElement.style.fontStyle === "italic";
                ASPx.SetStyles(cellElement, { fontStyle: isItalic ? "" : "italic" });
            }
        }
    });

    ASPxClientSpreadsheet.Commands.FormatFontUnderline = ASPx.CreateClass(ASPxClientSpreadsheet.CommandBase, {
        executeCore: function(state, parameters) {
            var colVisibleIndex = state.activeCellColIndex,
                rowVisibleIndex = state.activeCellRowIndex,
                cellElement = this.getCellElementByVisiblePosition(colVisibleIndex, rowVisibleIndex);
            if(cellElement) {
                var isUnderlined = cellElement.style.textDecoration.indexOf("underline") !== -1;
                if(isUnderlined)
                    cellElement.style.textDecoration = cellElement.style.textDecoration.replace("underline", "");
                else
                    cellElement.style.textDecoration += " underline";
            }
        }
    });

    ASPxClientSpreadsheet.Commands.FormatFontStrikeout = ASPx.CreateClass(ASPxClientSpreadsheet.CommandBase, {
        executeCore: function(state, parameters) {
            var colVisibleIndex = state.activeCellColIndex,
                rowVisibleIndex = state.activeCellRowIndex,
                cellElement = this.getCellElementByVisiblePosition(colVisibleIndex, rowVisibleIndex);
            if(cellElement) {
                var isStrikethrough = cellElement.style.textDecoration.indexOf("line-through") !== -1;
                if(isStrikethrough)
                    cellElement.style.textDecoration = cellElement.style.textDecoration.replace("line-through", "");
                else
                    cellElement.style.textDecoration += " line-through";
            }
        }
    });

    //Text Align
    ASPxClientSpreadsheet.Commands.FormatAlignmentLeft = ASPx.CreateClass(ASPxClientSpreadsheet.CommandBase, {
        executeCore: function(state, parameters) {
            var colVisibleIndex = state.activeCellColIndex,
                rowVisibleIndex = state.activeCellRowIndex,
                cellElement = this.getCellElementByVisiblePosition(colVisibleIndex, rowVisibleIndex);                

            if(cellElement) {
                var style = ASPx.GetCurrentStyle(cellElement),
                    cellValue = this.getCellValue(colVisibleIndex, rowVisibleIndex),
                    defaultTextAlign = DefaultFontProperties.getDefaultTextAlign(ASPx.IsNumber(cellValue)),
                    isLeft = style.textAlign === "left";
                ASPx.SetStyles(cellElement, { textAlign: isLeft ? defaultTextAlign : "left" });
            }
        }
    });

    ASPxClientSpreadsheet.Commands.FormatAlignmentCenter = ASPx.CreateClass(ASPxClientSpreadsheet.CommandBase, {
        executeCore: function(state, parameters) {
            var colVisibleIndex = state.activeCellColIndex,
                rowVisibleIndex = state.activeCellRowIndex,
                cellElement = this.getCellElementByVisiblePosition(colVisibleIndex, rowVisibleIndex);

            if(cellElement) {
                var style = ASPx.GetCurrentStyle(cellElement),
                    cellValue = this.getCellValue(colVisibleIndex, rowVisibleIndex),
                    defaultTextAlign = DefaultFontProperties.getDefaultTextAlign(ASPx.IsNumber(cellValue)),
                    isCenter = style.textAlign === "center";

                ASPx.SetStyles(cellElement, { textAlign: isCenter ? defaultTextAlign : "center" });
            }
        }
    });

    ASPxClientSpreadsheet.Commands.FormatAlignmentRight = ASPx.CreateClass(ASPxClientSpreadsheet.CommandBase, {
        executeCore: function(state, parameters) {
            var colVisibleIndex = state.activeCellColIndex,
                rowVisibleIndex = state.activeCellRowIndex,
                cellElement = this.getCellElementByVisiblePosition(colVisibleIndex, rowVisibleIndex);
                
            if(cellElement) {
                var style = ASPx.GetCurrentStyle(cellElement),
                    cellValue = this.getCellValue(colVisibleIndex, rowVisibleIndex),
                    defaultTextAlign = DefaultFontProperties.getDefaultTextAlign(ASPx.IsNumber(cellValue)),
                    isRight = style.textAlign === "right";

                ASPx.SetStyles(cellElement, { textAlign: isRight ? defaultTextAlign : "right" });
            }
        }
    });

    // Vertical Align
    ASPxClientSpreadsheet.Commands.FormatAlignmentTop = ASPx.CreateClass(ASPxClientSpreadsheet.CommandBase, {
        executeCore: function(state, parameters) {
            var colVisibleIndex = state.activeCellColIndex,
                rowVisibleIndex = state.activeCellRowIndex,
                cellElement = this.getCellElementByVisiblePosition(colVisibleIndex, rowVisibleIndex);
                

            if(cellElement) {
                var style = ASPx.GetCurrentStyle(cellElement),
                    isTop = style.verticalAlign === "top";
                ASPx.SetStyles(cellElement, { verticalAlign: isTop ? DefaultFontProperties : "top" });
            }
        }
    });

    ASPxClientSpreadsheet.Commands.FormatAlignmentMiddle = ASPx.CreateClass(ASPxClientSpreadsheet.CommandBase, {
        executeCore: function(state, parameters) {
            var colVisibleIndex = state.activeCellColIndex,
                rowVisibleIndex = state.activeCellRowIndex,
                cellElement = this.getCellElementByVisiblePosition(colVisibleIndex, rowVisibleIndex);

            if(cellElement) {
                var style = ASPx.GetCurrentStyle(cellElement),
                    isMiddle = style.verticalAlign === "middle";
                ASPx.SetStyles(cellElement, { verticalAlign: isMiddle ? DefaultFontProperties : "middle" });
            }
        }
    });

    ASPxClientSpreadsheet.Commands.FormatAlignmentBottom = ASPx.CreateClass(ASPxClientSpreadsheet.CommandBase, {
        executeCore: function(state, parameters) {
            var colVisibleIndex = state.activeCellColIndex,
                rowVisibleIndex = state.activeCellRowIndex,
                cellElement = this.getCellElementByVisiblePosition(colVisibleIndex, rowVisibleIndex);

            if(cellElement) {
                var style = ASPx.GetCurrentStyle(cellElement),
                    isBottom = style.verticalAlign === "bottom";
                ASPx.SetStyles(cellElement, { verticalAlign: isBottom ? DefaultFontProperties : "bottom" });
            }
        }
    });
})();
(function() {
    ASPxClientSpreadsheet.ProtectionHelper = (function() {
        var ProtectionHelper = {};

        ProtectionHelper.isCommandEnabled = function(control, commandId) {
            if(ASPxClientSpreadsheet.ServerCommands.isCustomPermissionCommand(commandId)) {
                var commandConfig = ASPxClientSpreadsheet.ServerCommands.getCommandConfigByID(commandId);
                return !control.getDocumentModel().getProtectionProperties()[commandConfig.customPermission.property];
            }
            return false;
        };

        ProtectionHelper.isCellLocked = function(control, colModelIndex, rowModelIndex) {
            var paneManager = control.getPaneManager(),
                activePane = paneManager.getPaneByCell({ col: colModelIndex, row: rowModelIndex }),
                tileHelper = activePane.getTileHelper(),
                tileInfo = tileHelper.getCellTileInfo_ByModelIndex(colModelIndex, rowModelIndex);
            if(!tileInfo)
                return false;

            var unlockedCells = tileInfo.cellEditable,
                allCellsAreLocked = !unlockedCells || unlockedCells.length === 0;

            if(allCellsAreLocked)
                return true;

            var cellModelPosition = [colModelIndex, rowModelIndex],
                comparer = function(el1, el2) { return el1[0] == el2[0] && el1[1] == el2[1]; },
                cellUnlocked = ASPx.Data.ArrayIndexOf(unlockedCells, cellModelPosition, comparer) > -1;

            return !cellUnlocked;
        };

        ProtectionHelper.rangeContainLockedCell = function(control, modelRange) {
            for(var i = modelRange.leftColIndex; i <= modelRange.rightColIndex; i++)
                for(var k = modelRange.topRowIndex; k <= modelRange.bottomRowIndex; k++)
                    if(this.isCellLocked(control, i, k))
                        return true;
            return false;
        };

        ProtectionHelper.isActiveCellLocked = function(control, selection) {
            selection = selection ? selection : control.getSelectionInternal();
            var paneManager = control.getPaneManager(),
                colModelIndex = paneManager.convertVisibleIndexToModelIndex(selection.activeCellColIndex, true),
                rowModelIndex = paneManager.convertVisibleIndexToModelIndex(selection.activeCellRowIndex, false);
            return this.isCellLocked(control, colModelIndex, rowModelIndex);
        };

        ProtectionHelper.isCommandAvailable = function(control, commandId, args) {
            if(this.isCommandDisableInReadOnlyMode(control, commandId))
                return this.RejectReason.ReadOnly;

            if(this.isCommandDisableInLockedWorkbookMode(control, commandId))
                return this.RejectReason.LockedWorkbook;

            if(this.isCommandDisableInLockedSheetMode(control, commandId))
                return this.RejectReason.LockedSheet;

            if(this.isCommandDisableInLockedCellsMode(control, commandId, args))
                return this.RejectReason.LockedCell;

            return this.RejectReason.None;
        };

        ProtectionHelper.isCommandDisableInReadOnlyMode = function(control, commandId) {
            return control.isReadOnly() && ASPxClientSpreadsheet.ServerCommands.isCommandDisableInReadOnlyMode(commandId);
        };

        ProtectionHelper.isCommandDisableInLockedWorkbookMode = function(control, commandId) {
            return control.isWorkbookLocked() && ASPxClientSpreadsheet.ServerCommands.isCommandDisabledForLockedWorkbook(commandId);
        };

        ProtectionHelper.isCommandDisableInLockedSheetMode = function(control, commandId) {
            return control.isSheetLocked() && ASPxClientSpreadsheet.ServerCommands.isCommandDisabledForLockedSheet(commandId) &&
                !ASPxClientSpreadsheet.ServerCommands.isCustomPermissionCommand(commandId);
        };

        ProtectionHelper.isCommandDisableInLockedCellsMode = function(control, commandId, args) {
            if(control.isSheetLocked())
                if(ASPxClientSpreadsheet.ServerCommands.isCustomPermissionCommand(commandId)) {
                    if(ASPxClientSpreadsheet.ServerCommands.isCommandDisabledForLockedCell(commandId))
                        return this.isSheetCellLocked(control, commandId, args) || !this.isCommandEnabled(control, commandId);
                    else
                        return !this.isCommandEnabled(control, commandId);
                } else {
                    return ASPxClientSpreadsheet.ServerCommands.isCommandDisabledForLockedCell(commandId) && this.isSheetCellLocked(control, commandId, args);
                }
            return false;
        };

        ProtectionHelper.isResizingAvailable = function(control, isCol) {
            if(control.isReadOnly())
                return false;

            var commandId = isCol ? ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("ResizeColumn").id :
                ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("ResizeRow").id,
                enabled = true;

            if(control.isSheetLocked())
                enabled = this.isCommandEnabled(control, commandId);

            return enabled && control.getDocumentSettings().isCommandEnabled(commandId);
        };

        ProtectionHelper.isObjectSelectionAvailable = function(control) {
            if(control.isReadOnly())
                return false;
            if(control.isSheetLocked()) {
                var commandId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("ShapeMoveAndResize").id;
                return this.isCommandEnabled(control, commandId);
            }
            return true;
        };

        ProtectionHelper.isPivotTableAndPivotChartsEditingAvailable = function(control) {
            if(control.isReadOnly())
                return false;
            if(control.isSheetLocked()) {
                var commandId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FieldListPanelPivotTable").id;
                return this.isCommandEnabled(control, commandId);
            }
            return true;
        };

        ProtectionHelper.isAutoFilterAvailable = function(control) {
            if(control.isReadOnly())
                return false;
            if(control.isSheetLocked()) {
                var commandId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FetchAutoFilterViewModel").id;
                return this.isCommandEnabled(control, commandId);
            }
            return true;
        };
        ProtectionHelper.canSelectCell = function(control, cellLayoutInfo) {
            //if(control.isSheetLocked()) {
            //    var isCellLocked = this.isCellLocked(control, cellLayoutInfo.colModelIndex, cellLayoutInfo.rowModelIndex);
            //    if(isCellLocked)
            //        return !control.getDocumentModel().getProtectionProperties()["selectLockedCellsLocked"];
            //    return !control.getDocumentModel().getProtectionProperties()["selectUnlockedCellsLocked"];
            //}
            return true;
        };

        // private
        ProtectionHelper.isSheetCellLocked = function(control, commandID, args) {
            var isCellUpdateCommand = ASPxClientSpreadsheet.ServerCommands.isCellUpdateCommand(commandID),
                selection = control.getSelectionInternal(),
                paneManager = control.getPaneManager(),
                colModelIndex = paneManager.convertVisibleIndexToModelIndex(selection.activeCellColIndex, true),
                rowModelIndex = paneManager.convertVisibleIndexToModelIndex(selection.activeCellRowIndex, false),
                formulaSheetOwnerId = args && args.formulaSheetOwner ? args.formulaSheetOwner : -1;

            if(isCellUpdateCommand) {
                colModelIndex = args.colIndex;
                rowModelIndex = args.rowIndex;
            }
            if(colModelIndex < 0 || rowModelIndex < 0)
                return true;
            // can't check permissons on client side
            if(formulaSheetOwnerId >= 0 && formulaSheetOwnerId !== control.getDocumentModel().getActiveSheetId())
                return false;
            return this.isCellLocked(control, colModelIndex, rowModelIndex);
        };

        ProtectionHelper.RejectReason = {
            None: 0,
            ReadOnly: 1,
            LockedWorkbook: 2,
            LockedSheet: 4,
            LockedCell: 8,
            CustomLock: 16
        };

        return ProtectionHelper;
    })();
})();

/*# using DevExpress.Web.Scripts; #*/
/*# namespace DevExpress.Web.ASPxSpreadsheet.Scripts #*/

(function() {

    ASPxClientSpreadsheet.Settings = (function() {
        var commandSettings,
            settings;

        function Settings(owner) {
            initialize();
            applySettings(owner.co);
        }

        Settings.prototype = {
            isCommandVisible: function(commandName) {
                if(commandSettings.hasOwnProperty(commandName)) {
                    var settingsCommandId = commandSettings[commandName];
                    if(settingsCommandId && settingsCommandId.length) {
                        var len = settingsCommandId.length,
                            visible = true;
                        while(len--)
                            visible = visible && isCommandVisible(settingsCommandId[len]);

                        return visible;
                    }
                    return isCommandVisible(settingsCommandId);
                }
                return true;
            },
            isCommandEnabled: function(commandName) {
                if(commandSettings.hasOwnProperty(commandName)) {
                    var settingsCommandId = commandSettings[commandName];                        
                    if(settingsCommandId && settingsCommandId.length) {
                        var len = settingsCommandId.length,
                            enabled = true;
                        while(len--)
                            enabled = enabled && isCommandAllowed(settingsCommandId[len]);

                        return enabled;
                    }
                    return isCommandAllowed(settingsCommandId);
                }
                return true;
            },
            forEach: function(delegate) {
                for(var command in commandSettings) {
                    if(commandSettings.hasOwnProperty(command)) {
                        delegate(command, this.isCommandVisible(command), this.isCommandEnabled(command));
                    }
                }
            }
        };

        function initialize() {
            initializeCommands();
            initializeSettings();
        }

        function initializeCommands() {
            commandSettings = {};
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.FileNew.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.CreateNew;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.FileSave.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.Save;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.FileSaveAs.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.SaveAs;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.Print.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.Print;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.FileOpen.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.Open;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.CopySelection.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.Copy;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.CutSelection.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.Cut;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.Paste.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.Paste;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.ReadingView.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.SwitchViewModes;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.EditingView.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.SwitchViewModes;

            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.InsertSheet.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.WorksheetInsert;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.InsertSheetContextMenuItem.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.WorksheetInsert;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.RemoveSheet.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.WorksheetDelete;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.RemoveSheetContextMenuItem.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.WorksheetDelete;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.RenameSheet.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.WorksheetRename;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.HideSheet.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.WorksheetHide;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.UnhideSheet.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.WorksheetUnhide;

            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.InsertSheetRows.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.RowInsert;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.InsertSheetRowsContextMenuItem.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.RowInsert;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.RemoveSheetRows.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.RowDelete;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.RemoveSheetRowsContextMenuItem.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.RowDelete;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.ResizeRow.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.RowResize;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.FormatRowHeight.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.RowResize;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.FormatAutoFitRowHeight.id] = [
                ASPxClientSpreadsheet.Settings.OptionsProperty.RowAutoFit,
                ASPxClientSpreadsheet.Settings.OptionsProperty.RowResize];
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.AutoFitRowHeight.id] = [
                ASPxClientSpreadsheet.Settings.OptionsProperty.RowAutoFit,
                ASPxClientSpreadsheet.Settings.OptionsProperty.RowResize];
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.HideRows.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.RowHide;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.UnhideRows.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.RowUnhide;

            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.InsertSheetColumns.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.ColumnInsert;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.InsertSheetColumnsContextMenuItem.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.ColumnInsert;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.RemoveSheetColumns.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.ColumnDelete;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.RemoveSheetColumnsContextMenuItem.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.ColumnDelete;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.ResizeColumn.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.ColumnResize;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.FormatColumnWidth.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.ColumnResize;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.FormatDefaultColumnWidth.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.ColumnResize;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.FormatAutoFitColumnWidth.id] = [
                ASPxClientSpreadsheet.Settings.OptionsProperty.ColumnAutoFit,
                ASPxClientSpreadsheet.Settings.OptionsProperty.ColumnResize];
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.AutoFitColumnWidth.id] = [
                ASPxClientSpreadsheet.Settings.OptionsProperty.ColumnAutoFit,
                ASPxClientSpreadsheet.Settings.OptionsProperty.ColumnResize];
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.HideColumns.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.ColumnHide;
            commandSettings[ASPxClientSpreadsheet.ServerCommands.internalCommands.UnhideColumns.id] = ASPxClientSpreadsheet.Settings.OptionsProperty.ColumnUnhide;
        }

        function initializeSettings() {
            settings = {};
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.Print] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.Copy] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.CreateNew] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.Cut] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.Open] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.Paste] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.Save] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.SaveAs] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.SwitchViewModes] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;

            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.WorksheetInsert] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.WorksheetDelete] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.WorksheetRename] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.WorksheetHide] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.WorksheetUnhide] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;

            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.RowInsert] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.RowDelete] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.RowResize] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.RowAutoFit] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.RowHide] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.RowUnhide] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;

            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.ColumnInsert] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.ColumnDelete] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.ColumnResize] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.ColumnAutoFit] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.ColumnHide] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
            settings[ASPxClientSpreadsheet.Settings.OptionsProperty.ColumnUnhide] = ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
        }

        function applySettings(options) {
            if(options)
                for(var optionProperty in options) {
                    if(settings.hasOwnProperty(optionProperty)) {
                        var optionValue = options[optionProperty];
                        settings[optionProperty] = optionValue;
                    }
                }
        }

        function isCommandAllowed(behaviorCommandId) {
            var commandCapability = settings[behaviorCommandId];

            return commandCapability === ASPxClientSpreadsheet.Settings.DocumentCapability.Enabled ||
                commandCapability === ASPxClientSpreadsheet.Settings.DocumentCapability.Default;
        }

        function isCommandVisible(behaviorCommandId) {
            var commandCapability = settings[behaviorCommandId];

            return commandCapability !== ASPxClientSpreadsheet.Settings.DocumentCapability.Hidden;
        }

        return Settings;
    })();

    //JSONOptionsProperty
    ASPxClientSpreadsheet.Settings.OptionsProperty = {
        Copy: 0,
        Cut: 1,
        Paste: 2,
        Print: 3,
        CreateNew: 4,
        Open: 5,
        Save: 6,
        SaveAs: 7,
        SwitchViewModes: 8,

        WorksheetInsert: 9,
        WorksheetDelete: 10,
        WorksheetRename: 11,
        WorksheetHide: 12,
        WorksheetUnhide: 13,
        //WorksheetMove: 14,
        //WorksheetCopy: 15,
        //WorksheetTabColor: 16,

        RowInsert: 17,
        RowDelete: 18,
        RowResize: 19,
        RowAutoFit: 20,
        RowHide: 21,
        RowUnhide: 22,

        ColumnInsert: 23,
        ColumnDelete: 24,
        ColumnResize: 25,
        ColumnAutoFit: 26,
        ColumnHide: 27,
        ColumnUnhide: 28
    };

    ASPxClientSpreadsheet.Settings.DocumentCapability = {
        Default: 0,
        Disabled: 1,
        Enabled: 2,
        Hidden: 3
    };

})();

(function() {
    /*# using DevExpress.Web.Scripts; #*/
    /*# namespace DevExpress.Web.ASPxSpreadsheet.Scripts #*/

    ASPxClientSpreadsheet.PopupMenuHelper = ASPx.CreateClass(null, {
        constructor: function(spreadsheetControl) {
            this.spreadsheetControl = spreadsheetControl;
            this.menuItems = ASPxClientSpreadsheet.PopupMenuItems;
            this.popupMenuEnabled = true;

            this.setPopupMenuEnabled = function(enabled) {
                this.popupMenuEnabled = enabled;
            };

            this.getPopupMenuEnabled = function() {
                return this.popupMenuEnabled;
            };

            this.initializeItemsCore = function(items, imagesCategoryName) {
                for(var i = 0; i < items.length; i++) {
                    this.initializeItem(items[i], imagesCategoryName);
                }
            };

            this.initializeItem = function(item, imagesCategoryName) {
                item.text = this.getLocalizedString(item.textID);
                item.isSvg = this.needUseSvgImages();
                if(item.imageName)
                    item.imageClassName = this.prepareImageClassName(item.imageName, imagesCategoryName, item.isSvg);

                if(item.items)
                    this.initializeItemsCore(item.items, imagesCategoryName);
            };

            this.getLocalizedString = function(stringId) {
                return ASPxClientSpreadsheet.Localization[stringId];
            };

            this.prepareImageClassName = function(imageName, imagesCategoryName, isSvg) {
                return "dxSpreadsheet_" + imagesCategoryName + "_" + imageName + (isSvg ? "New" : "");
            };

            this.getPopupMenu = function() {
                return this.spreadsheetControl.getPopupMenu();
            };

            this.getAutoFilterPopupMenu = function() {
                return this.spreadsheetControl.getAutoFilterPopupMenu();
            };

            this.isItemVisible = function(item, context) {
                var commandName = item.name,
                    visible = this.isItemSatisfyingCriteria(item, context, "menuVisible");
                return visible && this.spreadsheetControl.getDocumentSettings().isCommandVisible(commandName);

            };

            this.isItemEnabled = function(item, context) {
                var enabled = this.isItemSatisfyingCriteria(item, context, "menuEnabled");
                if(enabled && ASPxClientSpreadsheet.ServerCommands.isCommandInternal(item.name))
                    return this.isCommandAvailable(item.name);
                return enabled;
            };

            this.isCommandAvailable = function(commandName) {
                var rejectReason = ASPxClientSpreadsheet.ProtectionHelper.isCommandAvailable(spreadsheetControl, commandName),
                    isAvailable = rejectReason === ASPxClientSpreadsheet.ProtectionHelper.RejectReason.None;
                return isAvailable && this.spreadsheetControl.getDocumentSettings().isCommandEnabled(commandName);
            };

            this.isItemSatisfyingCriteria = function(item, context, criteriaName) {
                var command = ASPxClientSpreadsheet.ServerCommands.getCommandConfigByID(item.name);

                if(command && command[criteriaName]) {
                    for(var contextVarName in command[criteriaName]) {
                        if(context[contextVarName] !== command[criteriaName][contextVarName])
                            return false;
                    }
                }

                return true;
            };

            this.populateItems = function(items, context) {
                var resultItems = [];
                for(var i = 0; i < items.length; i++) {
                    var item = items[i];
                    if(this.isItemVisible(item, context)) {
                        if(item.items)
                            item.items = this.populateItems(item.items, context);

                        resultItems.push(item);
                    }
                }

                return resultItems;
            };

            this.prepareMenuItems = function(items) {
                for(var i = 0; i < items.length; i++) {
                    var item = items[i];
                    item.clientEnabled = item.enabled;

                    if(item.items && item.items.length > 0)
                        this.prepareMenuItems(item.items);
                }
            };

            this.preparePopupMenu = function(popupMenu, items, context, spreadsheetControl, menuType) {
                var menuItemCollection = new ASPxClientSpreadsheetPopupMenuItemCollection(null, this.populateItems(items, context));
                this.applyEnabledState(menuItemCollection, context);

                menuType = typeof (menuType) !== "undefined" ? menuType : context.MenuType;
                var cancel = this.spreadsheetControl.RaisePopupMenuShowing(menuItemCollection, menuType);
                popupMenu.ClearItems();

                if(!cancel) {
                    this.prepareMenuItems(menuItemCollection);
                    popupMenu.CreateItems(menuItemCollection);
                }
            };

            this.applyEnabledState = function(menuItemCollection, context) {
                var count = menuItemCollection.GetCount();
                while(count--) {
                    var item = menuItemCollection[count];
                    item.enabled = this.isItemEnabled(item, context);
                }
            };

            this.prepareClearFilterColumnItem = function(popupMenu, context) {
                var clearFilterCommandId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("DataFilterColumnClear").id,
                    clearFilterMenuItem = popupMenu.GetItemByName(clearFilterCommandId);
                if(clearFilterMenuItem) {
                    var clearFilterColumnText = this.prepareClearFilterText(clearFilterMenuItem.GetText(), context.columnCaption);
                    clearFilterMenuItem.SetText(clearFilterColumnText);
                    clearFilterMenuItem.SetEnabled(context.isFilterApplied);
                }
            };

            this.prepareClearFilterText = function(textTemplate, columnCaption) {
                return textTemplate.replace("{0}", columnCaption);
            };

            this.generateFieldList = function(items, context) {
                if(context.menuContext.isSingleColumnFilter)
                    return;
                var fieldsFilterItem = this.getPivotTableFieldsFilter(items);
                if(fieldsFilterItem) {
                    var pivotTable = this.spreadsheetControl.getActivePivotTable();
                    if(pivotTable) {
                        var fields = context.menuContext.isRowFilter ? pivotTable.getRowFields() : pivotTable.getColumnFields(),
                            commandName = ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableChangeActiveRowField.id,
                            commandPostfix = context.menuContext.isRowFilter ? "r" : "c",
                            activeFieldIndex = context.menuContext.isRowFilter ? pivotTable.getActiveFieldRowIndex() : pivotTable.getActiveFieldColumnIndex();
                        len = fields.length;
                        if(len > 1) {
                            fieldsFilterItem.items = [];
                            for(var i = 0; i < len; i++) {
                                var subItem = {};
                                subItem.text = fields[i].Name;
                                subItem.groupName = "group1";
                                subItem.name = commandName + ASPxClientSpreadsheet.ServerCommands.getCommandSeparator() + commandPostfix + ASPxClientSpreadsheet.ServerCommands.getCommandSeparator() + fields[i].Index;
                                subItem.checked = fields[i].Index === activeFieldIndex;
                                fieldsFilterItem.items.push(subItem);
                            }
                        }
                        fieldsFilterItem.visible = len > 1;
                    }
                }
            };

            this.preparePivotTableItemsConfig = function(items, context) {
                var len = items.length;
                while(len--) {
                    this.preparePivotTableMenuItem(items[len], context);
                }
            };

            this.preparePivotTableMenuItem = function(item, context) {
                var commandName = item.name,
                    commandHelper = ASPxClientSpreadsheet.ServerCommands;
                if(commandHelper.isPivotFieldSortCommand(commandName))
                    this.preparePivotTableSortCommands(item, context);
                else if(commandHelper.isPivotFieldValueFilterCommand(commandName) ||
                    commandHelper.isPivotFieldDateFilterCommand(commandName) ||
                    commandHelper.isPivotFieldLabelFilterCommand(commandName))
                    this.preparePivotFieldFilterCommands(item, context);
            };

            this.preparePivotTableSortCommands = function(item, context) {
                var commandName = parseInt(item.name);
                switch(commandName) {
                    case ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableFieldSortAscending.id:
                        if(context.isDate)
                            item.textID = "MenuCmd_PivotSortAscendingOnlyDates";
                        else if(context.isNumber)
                            item.textID = "MenuCmd_PivotSortAscendingOnlyNumbers";
                        else if(context.isText)
                            item.textID = "MenuCmd_PivotSortAscending";
                        item.checked = context.sortType === ASPxClientSpreadsheet.DocumentModel.SortTypeField.Ascending;
                        break;
                    case ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableFieldSortDescending.id:
                        if(context.isDate)
                            item.textID = "MenuCmd_PivotSortDescendingOnlyDates";
                        else if(context.isNumber)
                            item.textID = "MenuCmd_PivotSortDescendingOnlyNumbers";
                        else if(context.isText)
                            item.textID = "MenuCmd_PivotSortDescending";
                        item.checked = context.sortType === ASPxClientSpreadsheet.DocumentModel.SortTypeField.Descending;
                        break;
                }
                item.text = this.getLocalizedString(item.textID);                
            };

            this.preparePivotFieldFilterCommands = function(item, context) {
                var subItems = item.items,
                    len = subItems.length;

                while(len--) {
                    var filterItem = subItems[len];
                    if(filterItem.filterType > 0) {
                        if(filterItem.filterType === context.filterState)
                            filterItem.checked = true;
                        else if(parseInt(filterItem.name) === ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableValueFilterTop10.id) {
                            filterItem.checked = (context.filterState === ASPxClientSpreadsheet.DocumentModel.PivotFilterType.Count) ||
                                (context.filterState === ASPxClientSpreadsheet.DocumentModel.PivotFilterType.Sum) ||
                                (context.filterState === ASPxClientSpreadsheet.DocumentModel.PivotFilterType.Percent);
                        } else if(parseInt(filterItem.name) === ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterCustom.id) {
                            filterItem.checked = (context.filterState === ASPxClientSpreadsheet.DocumentModel.PivotFilterType.DateNotEqual) ||
                                (context.filterState === ASPxClientSpreadsheet.DocumentModel.PivotFilterType.DateOlderThanOrEqual) ||
                                (context.filterState === ASPxClientSpreadsheet.DocumentModel.PivotFilterType.DateNewerThanOrEqual) ||
                                (context.filterState === ASPxClientSpreadsheet.DocumentModel.PivotFilterType.DateNotBetween);
                        } else
                            filterItem.checked = false;                       
                    }
                    if(filterItem.items && filterItem.items.length > 0) 
                        this.preparePivotFieldFilterCommands(filterItem, context);
                }
            };

            this.getPivotTableFieldsFilter = function(items) {
                var fieldListCommandId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("PivotTableFieldsFiltersCommandGroup").id,
                    len = items.length;
                while(len--) {
                    if(fieldListCommandId == items[len].name)
                        return items[len];
                }
                return null;
            };

            this.preparePivotTableClearFilterColumnItem = function(popupMenu, context) {
                var clearFilterCommandId = ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableClearFieldFilters.id,
                    clearFilterMenuItem = popupMenu.GetItemByName(clearFilterCommandId);
                if(clearFilterMenuItem) {
                    var pivotTable = this.spreadsheetControl.getActivePivotTable(),
                        activeFieldName = "";
                    if(context.menuContext.isSingleColumnFilter) {
                        var targetField = pivotTable.getField(context.fieldIndex, !context.menuContext.isRowFilter);
                        activeFieldName = targetField.Name;
                    } else {
                        activeFieldName = context.menuContext.isRowFilter ? pivotTable.getActiveRowFieldName() : pivotTable.getActiveColumnName();
                    }

                    var clearFilterColumnText = clearFilterMenuItem.GetText().replace("{0}", "'" + activeFieldName + "'");

                    clearFilterMenuItem.SetText(clearFilterColumnText);
                    clearFilterMenuItem.SetEnabled(context.isFilterApplied);
                }
                var clearLabelFilterCommandId = ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableClearFieldLabelFilter.id,
                    clearLabelFilterMenuItem = popupMenu.GetItemByName(clearLabelFilterCommandId);
                if(clearLabelFilterMenuItem)
                    clearLabelFilterMenuItem.SetEnabled(context.IsLabelFilter);

                var clearValueFilterCommandId = ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableClearFieldValueFilter.id,
                    clearValueFilterMenuItem = popupMenu.GetItemByName(clearValueFilterCommandId);
                if(clearValueFilterMenuItem)
                    clearValueFilterMenuItem.SetEnabled(context.IsMeasureFilter);
            };

            this.showAutoFilterMenu = function(context, autoFilterImage) {
                var popupMenu = this.getAutoFilterPopupMenu();

                this.preparePopupMenu(popupMenu, this.menuItems, context, this.spreadsheetControl);
                this.prepareClearFilterColumnItem(popupMenu, context);

                popupMenu.ShowAtElement(autoFilterImage);
            };

            this.showPivotTableAutoFilterMenu = function(context, autoFilterImage) {
                var popupMenu = this.getAutoFilterPopupMenu();
                popupMenu.setExtendedValue(context.fieldIndex);

                this.preparePivotTableItemsConfig(this.menuItems, context);
                this.generateFieldList(this.menuItems, context);
                this.preparePopupMenu(popupMenu, this.menuItems, context.menuContext, this.spreadsheetControl, context.MenuType);
                this.preparePivotTableClearFilterColumnItem(popupMenu, context);

                popupMenu.ShowAtElement(autoFilterImage);
            };

            this.showPopupMenu = function(context) {
                if(!this.getPopupMenuEnabled())
                    return;
                this.preparePopupMenu(this.getPopupMenu(), this.menuItems, context, this.spreadsheetControl);

                this.getPopupMenu().ShowAtPos(context.mouseX, context.mouseY);
            };

            this.clearMultiFieldProperties = function() {
                this.popupMenuElement = null;
                this.popupMenuFilterButtonType = -1;
            };

            this.saveMultiFieldProperties = function(element, filterType) {
                this.popupMenuElement = element;
                this.popupMenuFilterButtonType = filterType;
            };

            this.getMultiFieldProperties = function() {
                return {
                    element: this.popupMenuElement,
                    filterType: this.popupMenuFilterButtonType
                };
            };
            this.initializeItems = function() {
                this.initializeItemsCore(this.menuItems, this.spreadsheetControl.imagesCategoryName);
            };
            this.needUseSvgImages = function() {
                return this.spreadsheetControl.getRenderHelper().needUseSvgImages();
            };
        }
    });

    /*# public class ASPxClientSpreadsheetPopupMenuItem : JavaScriptObject #*/
    ASPxClientSpreadsheetPopupMenuItem = ASPx.CreateClass(ASPx.OfficePopupMenuItem, {
        /*# public ASPxClientSpreadsheetPopupMenuItem parent { get { return null; } } #*/
        /*# public string name { get; set; } #*/
        /*# public string text { get; set; } #*/
        /*# public bool enabled { get; set; } #*/
        /*# public string imageClassName { get; set; } #*/
        /*# public string navigateUrl { get; set; } #*/
        /*# public string imageUrl { get; set; } #*/
        /*# public bool beginGroup { get; set; } #*/
        /*# public string tooltip { get; set; } #*/
        /*# public string target { get; set; } #*/
        /*# public ASPxClientSpreadsheetPopupMenuItemCollection GetSubItems(){ return null; } #*/
        /*# public ASPxClientSpreadsheetPopupMenuItem GetItem(int index){ return null; } #*/
        /*# public ASPxClientSpreadsheetPopupMenuItem GetItemByName(string name){ return null; } #*/
        /*# public int GetItemCount(){ return -1; } #*/
    });

    /*# public class ASPxClientSpreadsheetPopupMenuItemCollection : JavaScriptObject #*/
    ASPxClientSpreadsheetPopupMenuItemCollection = ASPx.CreateClass(ASPx.OfficePopupMenuItemCollection, {
        /*# public void Add(ASPxClientSpreadsheetPopupMenuItem item){ } #*/
        /*# public void Remove(int index){ } #*/
        /*# public void RemoveByName(string name){ } #*/
        /*# public void Insert(int index, ASPxClientSpreadsheetPopupMenuItem item){ } #*/
        /*# public int GetCount(){ return -1; } #*/
        /*# public ASPxClientSpreadsheetPopupMenuItem GetByName(string name){ return null; } #*/
        /*# public ASPxClientSpreadsheetPopupMenuItem Get(int index){ return null; } #*/
        /*# public void Clear(){ } #*/
    });
})();

(function() {
    ASPxClientSpreadsheet.Range = (function() {
        var Range = function(leftColIndex, topRowIndex, rightColIndex, bottomRowIndex) {
            this.set(leftColIndex, topRowIndex, rightColIndex, bottomRowIndex);
        };
        Range.prototype = {
            set: function(leftColIndex, topRowIndex, rightColIndex, bottomRowIndex) {
                if(typeof(rightColIndex) == "undefined") {
                    this.leftColIndex = this.rightColIndex = leftColIndex;
                    this.topRowIndex = this.bottomRowIndex = topRowIndex;
                    this.singleCell = true;
                } else {
                    if(leftColIndex < rightColIndex) {
                        this.leftColIndex = leftColIndex;
                        this.rightColIndex = rightColIndex;
                    } else {
                        this.leftColIndex = rightColIndex;
                        this.rightColIndex = leftColIndex;
                    }

                    if(topRowIndex < bottomRowIndex) {
                        this.topRowIndex = topRowIndex;
                        this.bottomRowIndex = bottomRowIndex;
                    } else {
                        this.topRowIndex = bottomRowIndex;
                        this.bottomRowIndex = topRowIndex;
                    }
                    this.updateIsSingleCell();
                }
            },
            clone: function() {
                var clone = new ASPxClientSpreadsheet.Range(this.leftColIndex, this.topRowIndex, this.rightColIndex, this.bottomRowIndex);

                clone.isHighlighted = this.isHighlighted;
                clone.textPosition = this.textPosition;
                clone.startPaneType = this.startPaneType;
                clone.endPaneType = this.endPaneType;

                return clone;
            },
            equals: function(range) {
                return this.leftColIndex === range.leftColIndex &&
                    this.topRowIndex === range.topRowIndex &&
                    this.rightColIndex === range.rightColIndex &&
                    this.bottomRowIndex === range.bottomRowIndex;
            },
            updateIsSingleCell: function() {
                this.singleCell = this.leftColIndex == this.rightColIndex && this.topRowIndex == this.bottomRowIndex;
            },
            isSingleCell: function() {
                return this.singleCell;
            },
            isCellInRange: function(colIndex, rowIndex) {
                return this.isCellInRangeCore(colIndex, true) &&
                    this.isCellInRangeCore(rowIndex, false);
            },
            isCellInRangeCore: function(cellIndex, isCol) {
                if(isCol)
                    return this.leftColIndex <= cellIndex && cellIndex <= this.rightColIndex;
                return this.topRowIndex <= cellIndex && cellIndex <= this.bottomRowIndex;
            },
            containsRange: function(range) {
                return range.leftColIndex >= this.leftColIndex && range.rightColIndex <= this.rightColIndex &&
                        range.topRowIndex >= this.topRowIndex  && range.bottomRowIndex <= this.bottomRowIndex;
            },
            intersectsRange: function(range) {
                return range.topRowIndex <= this.bottomRowIndex && range.bottomRowIndex >= this.topRowIndex &&
                       range.leftColIndex <= this.rightColIndex && range.rightColIndex >= this.leftColIndex;
            },
            convertToVisibleIndices: function(paneManager) {
                var modelColRange = paneManager.convertModelIndicesRangeToVisibleIndices(
                    this.leftColIndex,
                    this.rightColIndex,
                    true);

                var modelRowRange = paneManager.convertModelIndicesRangeToVisibleIndices(
                    this.topRowIndex,
                    this.bottomRowIndex,
                    false);

                this.leftColIndex = modelColRange.visibleTopLeftIndex;
                this.rightColIndex = modelColRange.visibleBottomRightIndex;
                this.topRowIndex = modelRowRange.visibleTopLeftIndex;
                this.bottomRowIndex = modelRowRange.visibleBottomRightIndex;
            },
            convertToVisibleIndicesExactly: function(paneManager) {
                this.leftColIndex = paneManager.convertModelIndexToVisibleIndex(this.leftColIndex, true);
                this.rightColIndex = paneManager.convertModelIndexToVisibleIndex(this.rightColIndex, true);
                this.topRowIndex = paneManager.convertModelIndexToVisibleIndex(this.topRowIndex, false);
                this.bottomRowIndex = paneManager.convertModelIndexToVisibleIndex(this.bottomRowIndex, false);
            },
            getConvertedCore: function(converter) {
                var convertedRange = this.clone();

                convertedRange.leftColIndex = converter(convertedRange.leftColIndex, true);
                convertedRange.topRowIndex = converter(convertedRange.topRowIndex, false);

                if(convertedRange.isSingleCell()) {
                    convertedRange.rightColIndex = convertedRange.leftColIndex;
                    convertedRange.bottomRowIndex = convertedRange.topRowIndex;
                } else {
                    convertedRange.rightColIndex = converter(convertedRange.rightColIndex, true);
                    convertedRange.bottomRowIndex = converter(convertedRange.bottomRowIndex, false);
                }

                return convertedRange;
            },
            correct: function() {
                if(this.leftColIndex < 0)
                    this.leftColIndex = 0;
                if(this.topRowIndex < 0)
                    this.topRowIndex = 0;
                if(this.rightColIndex < 0)
                    this.rightColIndex = 0;
                if(this.bottomRowIndex < 0)
                    this.bottomRowIndex = 0;
            },
            correctPanes: function() {
                if((this.endPaneType === ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane) ||
                    (this.endPaneType === ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane && this.startPaneType !== ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane) ||
                    (this.endPaneType === ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane && this.startPaneType === ASPxClientSpreadsheet.PaneManager.PanesType.MainPane)) {
                    var buffer = this.endPaneType;
                    this.endPaneType = this.startPaneType;
                    this.startPaneType = buffer;
                }
                if((this.endPaneType === ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane && this.startPaneType === ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane) ||
                    (this.endPaneType === ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane && this.startPaneType === ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane)) {
                    this.endPaneType = ASPxClientSpreadsheet.PaneManager.PanesType.MainPane;
                    this.startPaneType = ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane;
                }
                if(this.endPaneType === ASPxClientSpreadsheet.PaneManager.PanesType.MainPane && this.startPaneType === ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane)
                    this.diagonalSelection = true;
            },
            setStartPaneType: function(startPaneType) {
                this.startPaneType = startPaneType;
            },
            setEndPaneType: function(endPaneType) {
                this.endPaneType = endPaneType;
            },

            any: function(predicate) {
                for (var i = this.leftColIndex; i <= this.rightColIndex; i++)
                    for (var j = this.topRowIndex; j <= this.bottomRowIndex; j++)
                        if(predicate(i, j)) return true;
                return false;
            },
            // Requires visible indices
            isEntireRangeHidden: function() {
                return this.leftColIndex < 0 && this.rightColIndex < 0 || this.topRowIndex < 0 && this.bottomRowIndex < 0;
            }
        };
        return Range;
    })();

    //experimental value obtained from MSExcel!
    ASPxClientSpreadsheet.Range.MAX_ROW_COUNT = 1048576;
    ASPxClientSpreadsheet.Range.MAX_COL_COUNT = 16384;
    ASPxClientSpreadsheet.Range.MIN_ROW_INDEX = 0;
    ASPxClientSpreadsheet.Range.MIN_COL_INDEX = 0;
    ASPxClientSpreadsheet.Range.MAX_ROW_INDEX = ASPxClientSpreadsheet.Range.MAX_ROW_COUNT - 1;
    ASPxClientSpreadsheet.Range.MAX_COL_INDEX = ASPxClientSpreadsheet.Range.MAX_COL_COUNT - 1;

    ASPxClientSpreadsheet.Range.Default = new ASPxClientSpreadsheet.Range(-1, -1);
    ASPxClientSpreadsheet.Range.Maximum = new ASPxClientSpreadsheet.Range(0, 0, 256, 65536); // TODO Why it was made so?
    //ASPxClientSpreadsheet.Range.Maximum = new ASPxClientSpreadsheet.Range(0, 0, ASPxClientSpreadsheet.Range.MAX_COL_COUNT, ASPxClientSpreadsheet.Range.MAX_ROW_COUNT);

    ASPxClientSpreadsheet.Range.UNION_OPERATOR = ",";

    ASPxClientSpreadsheet.Range.getMaxCellsCount = function(isCol) {
        return isCol ? ASPxClientSpreadsheet.Range.MAX_COL_COUNT : ASPxClientSpreadsheet.Range.MAX_ROW_COUNT;
    };
    ASPxClientSpreadsheet.Range.getMaxCellIndex = function(isCol) {
        return ASPxClientSpreadsheet.Range.getMaxCellsCount(isCol) - 1;
    };
    ASPxClientSpreadsheet.Range.isAllowableIndex = function(isCol, index) {
        return index <= ASPxClientSpreadsheet.Range.getMaxCellIndex(isCol);
    };

    ASPxClientSpreadsheet.Selection = (function() {
        var Selection = function(range, activeCellColIndex, activeCellRowIndex) {
            this.allSelected = false;
            this.visible = true;
            this.entireRowsSelected = false;
            this.entireColsSelected = false;

            this.currentColIndex = activeCellColIndex;
            this.currentRowIndex = activeCellRowIndex;

            this.setRange(range, activeCellColIndex, activeCellRowIndex);
        };

        function setActiveCellRangeCore(selection, activeCellRange) {
            selection.allSelected = false;
            selection.activeCellRange = activeCellRange || ASPxClientSpreadsheet.Range.Default.clone();
        }

        function setActiveCore(selection, colIndex, rowIndex) {
            selection.allSelected = false;
            selection.activeCellColIndex = colIndex;
            selection.activeCellRowIndex = rowIndex;
        }

        Selection.prototype = {
            selectDrawingBox: function(drawingBoxElement, drawingBoxIndex) {
                this.drawingBoxIndex = drawingBoxIndex;
                this.drawingBoxElement = drawingBoxElement;
            },
            isDrawingBoxSelection: function() {
                return this.drawingBoxIndex >= 0;
            },
            isAllSelected: function() {
                return this.allSelected;
            },
            isRowsSelected: function() {
                return this.entireRowsSelected;
            },
            isColumnsSelected: function() {
                return this.entireColsSelected;
            },
            isCellSelected: function(colIndex, rowIndex) {
                var isActiveCell = this.activeCellColIndex == colIndex && this.activeCellRowIndex == rowIndex;
                var isInRange = this.range && this.range.isCellInRange(colIndex, rowIndex);
                return this.isAllSelected() || isActiveCell || isInRange;
            },
            setRange: function(range, activeCellColIndex, activeCellRowIndex) {
                if(range) {
                    this.range = range;
                    this.activeCellColIndex = typeof (activeCellColIndex) != "undefined" ? activeCellColIndex : range.leftColIndex;
                    this.activeCellRowIndex = typeof (activeCellRowIndex) != "undefined" ? activeCellRowIndex : range.topRowIndex;

                    this.currentColIndex = typeof (currentColIndex) != "undefined" ? currentColIndex : this.activeCellColIndex;
                    this.currentRowIndex = typeof (currentRowIndex) != "undefined" ? currentRowIndex : this.activeCellRowIndex;
                } else
                    this.range = ASPxClientSpreadsheet.Range.Default.clone();
            },
            getActiveCellRange: function() {
                return this.activeCellRange ? this.activeCellRange : new ASPxClientSpreadsheet.Range(this.activeCellColIndex, this.activeCellRowIndex,
                    this.activeCellColIndex, this.activeCellRowIndex);
            },
            setActiveCellRange: function(activeCellRange) {
                this.allSelected = false;
                setActiveCellRangeCore(this, activeCellRange);
                setActiveCore(this, activeCellRange.leftColIndex, activeCellRange.topRowIndex);
            },
            setActiveCell: function(colIndex, rowIndex) {
                this.allSelected = false;
                setActiveCellRangeCore(this, null);
                setActiveCore(this, colIndex, rowIndex);
            },
            activeCellExists: function() {
                return this.activeCellColIndex > -1 && this.activeCellRowIndex > -1;
            },
            clone: function() {
                var clone = new ASPxClientSpreadsheet.Selection(this.range.clone(), this.activeCellColIndex, this.activeCellRowIndex);
                clone.allSelected = this.allSelected;
                clone.visible = this.visible;
                clone.entireColsSelected = this.entireColsSelected;
                clone.entireRowsSelected = this.entireRowsSelected;
                clone.increaseHeaderSelection = this.increaseHeaderSelection;
                if(this.activeCellRange)
                    clone.activeCellRange = this.activeCellRange.clone();
                clone.drawingBoxElement = this.drawingBoxElement;
                clone.drawingBoxIndex = this.drawingBoxIndex;
                clone.multiSelection = this.multiSelection;
                if(this.multiSelection)
                    clone.ranges = this.ranges.slice(0);

                clone.currentColIndex = this.currentColIndex;
                clone.currentRowIndex = this.currentRowIndex;

                clone.commentBoxIndex = this.commentBoxIndex;
                clone.commentBoxElement = this.commentBoxElement;

                return clone;
            },
            equals: function(selection) {
                return this.activeCellColIndex == selection.activeCellColIndex &&
                    this.activeCellRowIndex == selection.activeCellRowIndex &&
                    this.range.equals(selection.range);
            },
            identical: function(selection) {
                return this.equals(selection) && this.drawingBoxIndex === selection.drawingBoxIndex && this.commentBoxIndex === selection.commentBoxIndex;
            },
            isSingleCell: function() {
                return this.range.isSingleCell();
            },
            selectAll: function() {
                this.reset(true);
                this.allSelected = true;
            },
            reset: function(keepActiveCellRange) {
                this.allSelected = false;
                this.entireColsSelected = false;
                this.entireRowsSelected = false;
                this.increaseHeaderSelection = false;
                
                this.setRange(null);
                if(!keepActiveCellRange) {                    
                    this.setActiveCell(-1, -1);
                    setActiveCellRangeCore(this, null);
                    setActiveCore(this, null, null);
                }
                this.currentColIndex = -1;
                this.currentRowIndex = -1;

                this.drawingBoxElement = null;
                this.drawingBoxIndex = -1;

                this.commentBoxIndex = -1;
                this.commentBoxElement = null;
            },
            isActiveCellMerged: function() {
                return this.activeCellRange && !this.activeCellRange.isSingleCell();
            },

            selectEntireColumns: function(leftColumnIndex, rightColumnIndex, activeCellColIndex, activeCellRowIndex) {
                this.reset();
                this.setRange(new ASPxClientSpreadsheet.Range(
                    leftColumnIndex,
                    ASPxClientSpreadsheet.Range.Maximum.topRowIndex,
                    rightColumnIndex,
                    ASPxClientSpreadsheet.Range.Maximum.bottomRowIndex), activeCellColIndex, activeCellRowIndex);
                this.entireColsSelected = true;
                this.increaseHeaderSelection = rightColumnIndex - leftColumnIndex > 0;
            },
            selectEntireRows: function(topRowIndex, bottomRowIndex, activeCellColIndex, activeCellRowIndex) {
                this.reset();
                this.setRange(new ASPxClientSpreadsheet.Range(
                    ASPxClientSpreadsheet.Range.Maximum.leftColIndex,
                    topRowIndex,
                    ASPxClientSpreadsheet.Range.Maximum.rightColIndex,
                    bottomRowIndex), activeCellColIndex, activeCellRowIndex);
                this.entireRowsSelected = true;
                this.increaseHeaderSelection = bottomRowIndex - topRowIndex > 0;
            },

            getConvertedToModelIndices: function(paneManager) {
                return this.getConvertedCore(function(visibleIndex, isCol) {
                    return paneManager.convertVisibleIndexToModelIndex(visibleIndex, isCol);
                });
            },
            getConvertedToVisibleIndices: function(paneManager, exactConversion) {
                var convertedSelection = this.clone();

                //NOTE: (T223707) indeces can be negative if
                //not all range (some tiles in range) has on client side
                var modelColIndex = paneManager.convertModelIndexToVisibleIndex(convertedSelection.activeCellColIndex, true),
                    modelRowIndex = paneManager.convertModelIndexToVisibleIndex(convertedSelection.activeCellRowIndex, false);

                if(!exactConversion) {
                    convertedSelection.activeCellColIndex = modelColIndex >= 0 ? modelColIndex : convertedSelection.activeCellColIndex;
                    convertedSelection.activeCellRowIndex = modelRowIndex >= 0 ? modelRowIndex : convertedSelection.activeCellRowIndex;
                    convertedSelection.range.convertToVisibleIndices(paneManager);
                }
                else {
                    convertedSelection.activeCellColIndex = modelColIndex;
                    convertedSelection.activeCellRowIndex = modelRowIndex;
                    convertedSelection.range.convertToVisibleIndicesExactly(paneManager);
                }

                convertedSelection.visible = !convertedSelection.range.isEntireRangeHidden();

                return convertedSelection;
            },
            getConvertedCore: function(converter) {
                var convertedSelection = this.clone();

                convertedSelection.activeCellColIndex = converter(convertedSelection.activeCellColIndex, true);
                convertedSelection.activeCellRowIndex = converter(convertedSelection.activeCellRowIndex, false);

                convertedSelection.range = convertedSelection.range.getConvertedCore(converter);

                return convertedSelection;
            },
            expandToAllSheetIfRequired: function(paneManager) {
                var isAllSelected = this.isAllSelected();
                if(isAllSelected || this.entireColsSelected || this.entireRowsSelected) {
                    var tileHelper = paneManager.getTileHelper(),
                        maxColumnCellInfo = tileHelper.getEndOfDocumentCellInfo(true),
                        maxRowCellInfo = tileHelper.getEndOfDocumentCellInfo(false);

                    if(this.entireColsSelected || isAllSelected) {
                        var maxRowIndex = maxRowCellInfo ? Math.min(maxRowCellInfo.modelIndex, ASPxClientSpreadsheet.Range.MAX_ROW_INDEX) : ASPxClientSpreadsheet.Range.MAX_ROW_INDEX;
                        this.range.topRowIndex = ASPxClientSpreadsheet.Range.MIN_ROW_INDEX;
                        this.range.bottomRowIndex = maxRowIndex;
                    }
                    if(this.entireRowsSelected || isAllSelected) {
                        var maxColIndex = maxColumnCellInfo ? Math.min(maxColumnCellInfo.modelIndex, ASPxClientSpreadsheet.Range.MAX_COL_INDEX) : ASPxClientSpreadsheet.Range.MAX_COL_INDEX;
                        this.range.leftColIndex = ASPxClientSpreadsheet.Range.MIN_COL_INDEX;
                        this.range.rightColIndex = maxColIndex;
                    }
                }
            },
            isValuable: function() {
                return this != ASPxClientSpreadsheet.Selection.Default;
            },
            correct: function() {
                if(this.activeCellColIndex < 0)
                    this.activeCellColIndex = 0;
                if(this.activeCellRowIndex < 0)
                    this.activeCellRowIndex = 0;
                if(this.range)
                    this.range.correct();
            },
            correctPaneSelection: function() {
                this.correct();
                if(this.range)
                    this.range.correctPanes();
            },
            resetVisible: function() {
                this.visible = true;
            },
            selectCommentBox: function(commentBoxElement, commentBoxIndex) {
                this.commentBoxIndex = commentBoxIndex;
                this.commentBoxElement = commentBoxElement;
            },
            isCommentBoxSelected: function() {
                return this.commentBoxIndex >= 0;
            }
        };
        return Selection;
    })();

    ASPxClientSpreadsheet.Selection.Default = new ASPxClientSpreadsheet.Selection(ASPxClientSpreadsheet.Range.Default.clone(), 0, 0);

    ASPxClientSpreadsheet.Selection.createFromDrawingBoxIndex = function(selection, drawingBoxElement, drawingBoxIndex) {
        var selection = new ASPxClientSpreadsheet.Selection(selection.range, selection.activeCellColIndex, selection.activeCellRowIndex);
        selection.selectDrawingBox(drawingBoxElement, drawingBoxIndex);
        return selection;
    };

    ASPxClientSpreadsheet.Selection.createCommentSelection = function(selection, commentBoxElement, commentBoxIndex) {
        var selection = new ASPxClientSpreadsheet.Selection(selection.range, selection.activeCellColIndex, selection.activeCellRowIndex);
        selection.selectCommentBox(commentBoxElement, commentBoxIndex);
        return selection;
    };

    ASPxClientSpreadsheet.SelectionKeyboardUtils = {
        createSingleCellSelection: function(selectionHelper, colIndex, rowIndex) {
            colIndex = this.verifyCellPosition(selectionHelper, true, colIndex);
            rowIndex = this.verifyCellPosition(selectionHelper, false, rowIndex);
            var range = new ASPxClientSpreadsheet.Range(colIndex, rowIndex);

            return new ASPxClientSpreadsheet.Selection(range, colIndex, rowIndex);
        },
        verifyCellPosition: function(selectionHelper, isCol, position) {
            if(position < 0)
                position = 0;
            if(selectionHelper.cellIsOutsideDocumentBounds(isCol, position))
                position--;
            return position;
        },
        moveRight: function(selection, selectionHelper) {
            selectionHelper.calcActualActiveCellRange(selection);
            return this.createSingleCellSelection(selectionHelper, selection.activeCellRange.rightColIndex + 1, selection.activeCellRowIndex);
        },
        moveLeft: function(selection, selectionHelper) {
            return this.createSingleCellSelection(selectionHelper, selection.activeCellColIndex - 1, selection.activeCellRowIndex);
        },
        moveUp: function(selection, selectionHelper) {
            return this.createSingleCellSelection(selectionHelper, selection.activeCellColIndex, selection.activeCellRowIndex - 1);
        },
        moveDown: function(selection, selectionHelper) {
            selectionHelper.calcActualActiveCellRange(selection);
            return this.createSingleCellSelection(selectionHelper, selection.activeCellColIndex, selection.activeCellRange.bottomRowIndex + 1);
        },

        shrinkCore: function(selection, selectionHelper, methodName, horizontalShrink) {
            var originSelection = selection.clone();
            var range;
            var collapsed;

            do {
                selection = this[methodName](selection);
                if(selection.equals(originSelection)) break;

                collapsed = horizontalShrink ? selection.range.leftColIndex == selection.range.rightColIndex :
                    selection.range.topRowIndex == selection.range.bottomRowIndex;
                range = selectionHelper.ExpandRangeToMergedCellSize(selection.range);
            } while(range.equals(originSelection.range) && !collapsed);

            selection.range = range;
            return selection;
        },

        // KB SHIFT+LEFT
        expandLeft: function(selection, selectionHelper) {
            if(selection.activeCellColIndex != selection.range.leftColIndex || selection.range.leftColIndex == selection.range.rightColIndex)
                return this.extendLeft(selection, selectionHelper);
            else
                return this.shrinkRight(selection, selectionHelper);
        },
        extendLeft: function(selection, selectionHelper) {
            var leftColIndex = this.verifyCellPosition(selectionHelper, true, selection.range.leftColIndex - 1);
            // TODO range = ExpandRangeToMergedCellSize(range);
            selection.range.set(leftColIndex, selection.range.topRowIndex, selection.range.rightColIndex, selection.range.bottomRowIndex);
            return selection;
        },
        shrinkRight: function(selection, selectionHelper) {
            return this.shrinkCore(selection, selectionHelper, "shrinkRightCore", true);
        },
        shrinkRightCore: function(selection) {
            var rightColIndex = selection.range.rightColIndex - 1;
            if(rightColIndex >= selection.range.leftColIndex)
                selection.range.set(selection.range.leftColIndex, selection.range.topRowIndex, rightColIndex, selection.range.bottomRowIndex);
            return selection;
        },

        // KB SHIFT+RIGHT
        expandRight: function(selection, selectionHelper) {
            if(selection.activeCellColIndex != selection.range.rightColIndex || selection.range.leftColIndex == selection.range.rightColIndex)
                return this.extendRight(selection, selectionHelper);
            else
                return this.shrinkLeft(selection, selectionHelper);
        },
        extendRight: function(selection, selectionHelper) {
            var rightColIndex = this.verifyCellPosition(selectionHelper, true, selection.range.rightColIndex + 1);
            // TODO range = ExpandRangeToMergedCellSize(range);
            selection.range.set(selection.range.leftColIndex, selection.range.topRowIndex, rightColIndex, selection.range.bottomRowIndex);
            return selection;
        },
        shrinkLeft: function(selection, selectionHelper) {
            return this.shrinkCore(selection, selectionHelper, "shrinkLeftCore", true);
        },
        shrinkLeftCore: function(selection, selectionHelper) {
            var leftColIndex = selection.range.leftColIndex + 1;
            if(leftColIndex <= selection.range.rightColIndex)
                selection.range.set(leftColIndex, selection.range.topRowIndex, selection.range.rightColIndex, selection.range.bottomRowIndex);
            return selection;
        },

        // KB SHIFT+UP
        expandUp: function(selection, selectionHelper) {
            if(selection.activeCellRowIndex != selection.range.topRowIndex || selection.range.topRowIndex == selection.range.bottomRowIndex)
                return this.extendUp(selection, selectionHelper);
            else
                return this.shrinkDown(selection, selectionHelper);
        },
        extendUp: function(selection, selectionHelper) {
            var topRowIndex = this.verifyCellPosition(selectionHelper, false, selection.range.topRowIndex - 1);
            // TODO range = ExpandRangeToMergedCellSize(range);
            selection.range.set(selection.range.leftColIndex, topRowIndex, selection.range.rightColIndex, selection.range.bottomRowIndex);
            return selection;
        },
        shrinkDown: function(selection, selectionHelper) {
            return this.shrinkCore(selection, selectionHelper, "shrinkDownCore", false);
        },
        shrinkDownCore: function(selection, selectionHelper) {
            var bottomRowIndex = selection.range.bottomRowIndex - 1;
            if(bottomRowIndex >= selection.range.topRowIndex)
                selection.range.set(selection.range.leftColIndex, selection.range.topRowIndex, selection.range.rightColIndex, bottomRowIndex);
            return selection;
        },

        // KB SHIFT+DOWN
        expandDown: function(selection, selectionHelper) {
            if(selection.activeCellRowIndex != selection.range.bottomRowIndex || selection.range.topRowIndex == selection.range.bottomRowIndex)
                return this.extendDown(selection, selectionHelper);
            else
                return this.shrinkUp(selection, selectionHelper);
        },
        extendDown: function(selection, selectionHelper) {
            var bottomRowIndex = this.verifyCellPosition(selectionHelper, false, selection.range.bottomRowIndex + 1);
            // TODO range = ExpandRangeToMergedCellSize(range);
            selection.range.set(selection.range.leftColIndex, selection.range.topRowIndex, selection.range.rightColIndex, bottomRowIndex);
            return selection;
        },
        shrinkUp: function(selection, selectionHelper) {
            return this.shrinkCore(selection, selectionHelper, "shrinkUpCore", false);
        },
        shrinkUpCore: function(selection, selectionHelper) {
            var topRowIndex = selection.range.topRowIndex + 1;
            if(topRowIndex <= selection.range.bottomRowIndex)
                selection.range.set(selection.range.leftColIndex, topRowIndex, selection.range.rightColIndex, selection.range.bottomRowIndex);
            return selection;
        },

        // SHIFT_TAB
        moveActiveCellLeft: function(selection, selectionHelper) {
            if(this.isSingleCellSelected(selection))
                return this.moveLeft(selection, selectionHelper);

            if(selection.activeCellRange.leftColIndex > selection.range.leftColIndex) {
                if(selection.activeCellRange.leftColIndex < selection.currentColIndex)
                    selection.currentColIndex = selection.activeCellRange.leftColIndex;
                if(selection.entireColsSelected || selection.entireRowsSelected) {
                    this.moveActiveCellInColOrRowSelectionMode(selection, selectionHelper, selection.activeCellRange.leftColIndex, selection.activeCellRange.topRowIndex, new Array(-1, 0), ASPxClientSpreadsheet.SelectionKeyboardUtils.Actions.MoveActiveCellLeft);
                } else {
                    selection.currentColIndex = selection.currentColIndex - 1;
                    selection.setActiveCell(selection.currentColIndex, selection.currentRowIndex);
                }
                return selection;
            }
            if(selection.activeCellRange.topRowIndex > selection.range.topRowIndex) {
                selection.currentColIndex = selection.range.rightColIndex;
                if(selection.entireColsSelected || selection.entireRowsSelected) {
                    this.moveActiveCellInColOrRowSelectionMode(selection, selectionHelper, selection.range.rightColIndex, selection.activeCellRange.topRowIndex, new Array(0, -1), ASPxClientSpreadsheet.SelectionKeyboardUtils.Actions.MoveActiveCellLeft);
                } else {
                    selection.currentRowIndex = selection.currentRowIndex - 1;
                    selection.currentColIndex = selection.range.rightColIndex;
                    selection.setActiveCell(selection.currentColIndex, selection.currentRowIndex);
                }
                return selection;
            }
           
            selection.currentRowIndex = selection.range.bottomRowIndex;
            selection.currentColIndex = selection.range.rightColIndex;           
            selection.setActiveCell(selection.currentColIndex, selection.currentRowIndex);
            return selection;
        },
        // TAB
        moveActiveCellRight: function(selection, selectionHelper) {
            if(this.isSingleCellSelected(selection))
                return this.moveRight(selection, selectionHelper);

            if(selection.activeCellRange.rightColIndex < selection.range.rightColIndex) {
                if(selection.activeCellRange.rightColIndex > selection.currentColIndex)
                    selection.currentColIndex = selection.activeCellRange.rightColIndex;
                if(selection.entireColsSelected || selection.entireRowsSelected) {
                    this.moveActiveCellInColOrRowSelectionMode(selection, selectionHelper, selection.activeCellRange.rightColIndex, selection.activeCellRange.topRowIndex, new Array(1, 0), ASPxClientSpreadsheet.SelectionKeyboardUtils.Actions.MoveActiveCellRight);
                } else {
                    selection.currentColIndex = selection.currentColIndex + 1;
                    selection.setActiveCell(selection.currentColIndex, selection.currentRowIndex);
                }
                return selection;
            }
            if(selection.activeCellRange.bottomRowIndex < selection.range.bottomRowIndex) {
                selection.currentColIndex = selection.range.leftColIndex;
                if(selection.entireColsSelected || selection.entireRowsSelected) {
                    this.moveActiveCellInColOrRowSelectionMode(selection, selectionHelper, selection.range.leftColIndex, selection.activeCellRange.topRowIndex, new Array(0, 1), ASPxClientSpreadsheet.SelectionKeyboardUtils.Actions.MoveActiveCellRight);
                } else {
                    selection.currentRowIndex = selection.currentRowIndex + 1;
                    selection.setActiveCell(selection.currentColIndex, selection.currentRowIndex);
                }
                return selection;
            }

            selection.currentColIndex = selection.range.leftColIndex;
            selection.currentRowIndex = selection.range.topRowIndex;
            selection.setActiveCell(selection.currentColIndex, selection.currentRowIndex);
            return selection;
        },
        // SHIFT+ENTER
        moveActiveCellUp: function(selection, selectionHelper) {
            if(this.isSingleCellSelected(selection))
                return this.moveUp(selection, selectionHelper);

            if(selection.activeCellRange.topRowIndex > selection.range.topRowIndex) {
                if(selection.currentRowIndex > selection.activeCellRange.topRowIndex)
                    selection.currentRowIndex = selection.activeCellRange.topRowIndex;
                if(selection.entireColsSelected || selection.entireRowsSelected) {
                    this.moveActiveCellInColOrRowSelectionMode(selection, selectionHelper, selection.activeCellRange.leftColIndex, selection.activeCellRange.topRowIndex, new Array(0, -1), ASPxClientSpreadsheet.SelectionKeyboardUtils.Actions.MoveActiveCellUp);
                } else {
                    selection.currentRowIndex = selection.currentRowIndex - 1;
                    selection.setActiveCell(selection.currentColIndex, selection.currentRowIndex);
                }
                return selection;
            }
            if(selection.activeCellRange.leftColIndex > selection.range.leftColIndex) {
                selection.currentRowIndex = selection.range.bottomRowIndex;
                if(selection.entireColsSelected || selection.entireRowsSelected) {
                    this.moveActiveCellInColOrRowSelectionMode(selection, selectionHelper, selection.activeCellRange.leftColIndex, selection.range.bottomRowIndex, new Array(-1, 0), ASPxClientSpreadsheet.SelectionKeyboardUtils.Actions.MoveActiveCellUp);
                } else {
                    selection.currentColIndex = selection.currentColIndex - 1;
                    selection.setActiveCell(selection.currentColIndex, selection.currentRowIndex);
                }
                return selection;
            }

            
            selection.currentRowIndex = selection.range.bottomRowIndex;
            selection.currentColIndex = selection.range.rightColIndex;
            selection.setActiveCell(selection.currentColIndex, selection.currentRowIndex);
            return selection;
        },
        // ENTER
        moveActiveCellDown: function(selection, selectionHelper) {
            if(this.isSingleCellSelected(selection))
                return this.moveDown(selection, selectionHelper);

            if(selection.activeCellRange.bottomRowIndex < selection.range.bottomRowIndex) {
                if(selection.currentRowIndex < selection.activeCellRange.bottomRowIndex)
                    selection.currentRowIndex = selection.activeCellRange.bottomRowIndex;
                if(selection.entireColsSelected || selection.entireRowsSelected) {
                    this.moveActiveCellInColOrRowSelectionMode(selection, selectionHelper, selection.activeCellRange.leftColIndex, selection.activeCellRange.bottomRowIndex, new Array(0, 1), ASPxClientSpreadsheet.SelectionKeyboardUtils.Actions.MoveActiveCellDown);
                } else {
                    selection.currentRowIndex = selection.currentRowIndex + 1;
                    selection.setActiveCell(selection.currentColIndex, selection.currentRowIndex);
                }
                return selection;
            }
            if(selection.activeCellRange.rightColIndex < selection.range.rightColIndex) {
                selection.currentRowIndex = selection.range.topRowIndex;
                if(selection.entireColsSelected || selection.entireRowsSelected) {
                    this.moveActiveCellInColOrRowSelectionMode(selection, selectionHelper, selection.activeCellRange.rightColIndex, selection.range.topRowIndex, new Array(1, 0), ASPxClientSpreadsheet.SelectionKeyboardUtils.Actions.MoveActiveCellDown);
                } else {
                    selection.currentColIndex = selection.currentColIndex + 1;
                    selection.setActiveCell(selection.currentColIndex, selection.currentRowIndex);
                }
                return selection;
            }

            selection.currentColIndex = selection.range.leftColIndex;
            selection.currentRowIndex = selection.range.topRowIndex;
            selection.setActiveCell(selection.currentColIndex, selection.currentRowIndex);
            return selection;
        },
        // Healpers
        isSingleCellSelected: function(selection) {
            return selection.isSingleCell() || this.isMergedCellSelected(selection);
        },
        isMergedCellSelected: function(selection) {
            return !selection.activeCellRange.singleCell &&
                selection.range.topRowIndex === selection.activeCellRange.topRowIndex && selection.range.bottomRowIndex === selection.activeCellRange.bottomRowIndex &&
                selection.range.leftColIndex === selection.activeCellRange.leftColIndex && selection.range.rightColIndex === selection.activeCellRange.rightColIndex;
        },

        moveActiveCellInColOrRowSelectionMode: function(selection, selectionHelper, activeCellColIndex, activeCellRowIndex, positionMultiplier, method) {
            var cellFullyInSelectionRange = false;
            var activeCellRange;

            while(!cellFullyInSelectionRange) {
                activeCellColIndex = activeCellColIndex + positionMultiplier[0];
                activeCellRowIndex = activeCellRowIndex + positionMultiplier[1];

                selection.currentColIndex = selection.currentColIndex + positionMultiplier[0];
                selection.currentRowIndex = selection.currentRowIndex + positionMultiplier[1];

                activeCellRange = this.createActiveCellRange(selectionHelper, selection.currentColIndex, selection.currentRowIndex);

                if(!activeCellRange.singleCell)
                    cellFullyInSelectionRange = selection.range.topRowIndex <= activeCellRange.topRowIndex && selection.range.bottomRowIndex >= activeCellRange.bottomRowIndex &&
                                            selection.range.leftColIndex <= activeCellRange.leftColIndex && selection.range.rightColIndex >= activeCellRange.rightColIndex;
                else cellFullyInSelectionRange = activeCellRange.singleCell;

                if(!cellFullyInSelectionRange && this.isCellOnEndOfRange(selection, activeCellRange, method)) {
                    selection.activeCellRange = activeCellRange;
                    return this[method].call(this, selection, selectionHelper);
                }
            }
            selection.setActiveCellRange(activeCellRange);
        },
        createActiveCellRange: function(selectionHelper, activeCellColIndex, activeCellRowIndex) {
            var activeCellRange = new ASPxClientSpreadsheet.Range(activeCellColIndex, activeCellRowIndex, activeCellColIndex, activeCellRowIndex);
            activeCellRange = selectionHelper.ExpandRangeToMergedCellSize(activeCellRange);
            return activeCellRange;
        },
        isCellOnEndOfRange: function(selection, activeCellRange, method) {
            var initialCellPosition = this.checkCellPosition(selection, selection.activeCellRange);
            var cellPosition = this.checkCellPosition(selection, activeCellRange);

            if(method === ASPxClientSpreadsheet.SelectionKeyboardUtils.Actions.MoveActiveCellRight)
                return cellPosition.right || initialCellPosition.right;
            else if(method === ASPxClientSpreadsheet.SelectionKeyboardUtils.Actions.MoveActiveCellLeft)
                return cellPosition.left || initialCellPosition.left;
            else if(method === ASPxClientSpreadsheet.SelectionKeyboardUtils.Actions.MoveActiveCellUp || method === ASPxClientSpreadsheet.SelectionKeyboardUtils.Actions.MoveActiveCellDown)
                return cellPosition.top || initialCellPosition.top || cellPosition.bottom || initialCellPosition.bottom;

            return false;
        },
        checkCellPosition: function(selection, activeCellRange) {
            var cellPosition = { top: false, bottom: false, left: false, right: false };
            cellPosition.right = selection.range.rightColIndex <= activeCellRange.rightColIndex;
            cellPosition.left = selection.range.leftColIndex >= activeCellRange.leftColIndex;
            cellPosition.top = selection.range.topRowIndex >= activeCellRange.topRowIndex;
            cellPosition.bottom = selection.range.bottomRowIndex <= activeCellRange.bottomRowIndex;
            return cellPosition;
        }
    };

    ASPxClientSpreadsheet.SelectionKeyboardUtils.Actions = {
        MoveActiveCellDown: "moveActiveCellDown",
        MoveActiveCellUp: "moveActiveCellUp",
        MoveActiveCellRight: "moveActiveCellRight",
        MoveActiveCellLeft: "moveActiveCellLeft"
    };

    ASPxClientSpreadsheet.SelectionHelper = function(spreadsheetControl) {
        var spreadsheet = spreadsheetControl;
        this.getPaneTypeByCell = function(cell) {
            return spreadsheet.getPaneManager().getPaneTypeByCell(cell);
        };
        this.setSelectionCells = function(leftColIndex, topRowIndex, rightColIndex, bottomRowIndex) {
            var range = new ASPxClientSpreadsheet.Range(leftColIndex, topRowIndex, rightColIndex, bottomRowIndex);
            this.setSelectionRangeInternal(range);
        }.aspxBind(this);
        this.setSelectionRangeInternal = function(range) {
            var selection = new ASPxClientSpreadsheet.Selection(range);
            this.processSelection(selection);
        };
        this.setSelection = function(selection, keepOldSelection) {
            if(!isSelectionVisible(selection)) return;

            selection = selection.clone();
            this.processSelection(selection, keepOldSelection);
        }.aspxBind(this);
        this.setSelectionSilently = function(selection) {
            selection = selection.clone();
            calcActualCellSelectionInternal(selection);
        };

        function isSelectionVisible(selection) {
            return spreadsheet.getPaneManager().isSelectionVisible(selection);
        }

        this.processSelection = function(selection, keepOldSelection) {
            this.setSelectionInternal(selection, keepOldSelection);
            this.notifyOwnerControl();
        };
        this.setSelectionInternal = function(selection, keepOldSelection) {
            if(selection.isDrawingBoxSelection())
                setDrawingSelection(selection);
            else if(selection.isCommentBoxSelected())
                setCommentSelection(selection);
            else if(selection.isAllSelected())
                this.setSheetSelection(selection);
            else
                this.setCellSelection(selection, keepOldSelection);
        };
        this.notifyOwnerControl = function() {
            spreadsheet.onSelectionChanged();
        };

        // Drawing box selection
        function setDrawingSelection(selection) {
            hideModelBoxSelection();
            showDrawingBoxSelection(selection);
        }
        function showDrawingBoxSelection(selection) {
            var paneManager = spreadsheet.getPaneManager();

            selection = ensureDrawingBoxSelection(selection);
            if(selection.drawingBoxElement)
                paneManager.drawModelBoxSelection(selection.drawingBoxElement, false);
        }
        function ensureDrawingBoxSelection(selection) {
            var stateController = spreadsheet.getStateController(),
                drawingBoxElement = selection.drawingBoxElement,
                parentTileElement = drawingBoxElement ? drawingBoxElement.parentNode : null;

            if(!parentTileElement) {
                drawingBoxElement = spreadsheet.getDrawingBoxByIndex(selection.drawingBoxIndex);
                selection = ASPxClientSpreadsheet.Selection.createFromDrawingBoxIndex(selection, drawingBoxElement, selection.drawingBoxIndex);
                stateController.updateSelection(selection);
            }
            return selection;
        }

        // Comment box selection
        function setCommentSelection(selection) {
            hideModelBoxSelection();
            showCommentBoxSelection(selection);
        }
        function showCommentBoxSelection(selection) {
            var paneManager = spreadsheet.getPaneManager(),
                stateController = spreadsheet.getStateController();

            selection = ensureCommentBoxSelection(selection);
            paneManager.drawModelBoxSelection(selection.commentBoxElement, true);
            stateController.startCommentEditing(selection.commentBoxElement);
        }
        function ensureCommentBoxSelection(selection) {
            var stateController = spreadsheet.getStateController(),
                commentBoxElement = selection.commentBoxElement,
                parentTileElement = commentBoxElement.parentNode;

            if(!parentTileElement) {
                stateController.closeCommentEditing();
                commentBoxElement = spreadsheet.getCommentBoxByIndex(selection.commentBoxIndex);
                selection = ASPxClientSpreadsheet.Selection.createCommentSelection(selection, commentBoxElement, selection.commentBoxIndex);                
                stateController.updateSelection(selection);
            }
            return selection;
        }

        this.setSheetSelection = function(selection) {
            selection.setRange(ASPxClientSpreadsheet.Range.Maximum.clone()); // TODO move to selection
            this.setSelectionBase(selection);
        };
        this.setCellSelection = function(selection, keepOldSelection) {
            calcActualCellSelectionInternal(selection);
            this.setSelectionBase(selection, keepOldSelection);
        };
        this.setSelectionBase = function(selection, keepOldSelection) {
            this.correctSelectionToVisibleRange(selection);
            if(selection.visible)
                spreadsheet.getPaneManager().drawSelection(selection, keepOldSelection);
            else
                spreadsheet.getPaneManager().hideSelection();
        };
        this.renderSelection = function(selection) {
            selection = selection.clone();
            this.setSelectionInternal(selection);
        };

        function expandEntireRowsAndColumns(selection) {
            var cellVisibleRange = spreadsheet.getPaneManager().getWorkbookVisibleCellRange();
            if(selection.entireColsSelected) {
                selection.range.topRowIndex = cellVisibleRange.top;
                selection.range.bottomRowIndex = cellVisibleRange.bottom;
            }

            if(selection.entireRowsSelected) {
                selection.range.leftColIndex = cellVisibleRange.left;
                selection.range.rightColIndex = cellVisibleRange.right;
            }
        }

        this.correctSelectionToVisibleRange = function(selection) {
            var paneManager = spreadsheet.getPaneManager();

            selection.activeCellColIndex = paneManager.putSelectionCellIndexToVisibleDocumentRange(selection.activeCellColIndex, true);
            selection.activeCellRowIndex = paneManager.putSelectionCellIndexToVisibleDocumentRange(selection.activeCellRowIndex, false);

            selection.range.leftColIndex = paneManager.putSelectionCellIndexToVisibleDocumentRange(selection.range.leftColIndex, true);
            selection.range.topRowIndex = paneManager.putSelectionCellIndexToVisibleDocumentRange(selection.range.topRowIndex, false);
            selection.range.rightColIndex = paneManager.putSelectionCellIndexToVisibleDocumentRange(selection.range.rightColIndex, true);
            selection.range.bottomRowIndex = paneManager.putSelectionCellIndexToVisibleDocumentRange(selection.range.bottomRowIndex, false);

            selection.activeCellRange.leftColIndex = paneManager.putSelectionCellIndexToVisibleDocumentRange(selection.activeCellRange.leftColIndex, true);
            selection.activeCellRange.topRowIndex = paneManager.putSelectionCellIndexToVisibleDocumentRange(selection.activeCellRange.topRowIndex, false);
            selection.activeCellRange.rightColIndex = paneManager.putSelectionCellIndexToVisibleDocumentRange(selection.activeCellRange.rightColIndex, true);
            selection.activeCellRange.bottomRowIndex = paneManager.putSelectionCellIndexToVisibleDocumentRange(selection.activeCellRange.bottomRowIndex, false);
        };

        this.correctRangeToVisiblePosition = function(range) {
            var result = range.clone(),
                paneManager = spreadsheet.getPaneManager();

            result.leftColIndex = paneManager.putCellColIndexInVisibleRange(range.leftColIndex);
            result.topRowIndex = paneManager.putCellRowIndexInVisibleRange(range.topRowIndex);
            result.rightColIndex = paneManager.putCellColIndexInVisibleRange(range.rightColIndex);
            result.bottomRowIndex = paneManager.putCellRowIndexInVisibleRange(range.bottomRowIndex);

            return result;
        };

        this.calcActualCellSelection = function(selection) {
            calcActualCellSelectionInternal(selection);
        }.aspxBind(this);
        function saveNotActualizableData(selection) {
            var notActualizableData = {
                allSelected: selection.allSelected
            };
            return notActualizableData;
        }
        function restoreNotActualizableData(selection, notActualizableData) {
            selection.allSelected = notActualizableData.allSelected;
        }
        function calcActualCellSelectionInternal(selection) {
            var notActualizableData = saveNotActualizableData(selection);

            expandEntireRowsAndColumns(selection);
            if(!selection.entireColsSelected && !selection.entireRowsSelected)
                calcActualRange(selection);
            calcActualActiveCellRangeInternal(selection);

            restoreNotActualizableData(selection, notActualizableData);
        }

        function calcActualRange(selection) {
            selection.range = ExpandRangeToMergedCellSizeInternal(selection.range);
        }

        this.calcActualActiveCellRange = function(selection) {
            calcActualActiveCellRangeInternal(selection);
        }.aspxBind(this);
        function calcActualActiveCellRangeInternal(selection) {
            var activeCellRange = new ASPxClientSpreadsheet.Range(selection.activeCellColIndex, selection.activeCellRowIndex, selection.activeCellColIndex, selection.activeCellRowIndex);
            activeCellRange = ExpandActiveCellToMergedRange(activeCellRange);
            selection.setActiveCellRange(activeCellRange);
        }

        this.ExpandRangeToMergedCellSize = function(rangeDesired) {
            return ExpandRangeToMergedCellSizeInternal(rangeDesired);
        }.aspxBind(this);
        function ExpandRangeToMergedCellSizeInternal(rangeDesired) {
            var range = rangeDesired.clone();
            var paneManager = spreadsheet.getPaneManager();

            var changed = true;
            while(changed) {
                changed = false;

                var complexBoxes = paneManager.getMergedCellRangesIntersectsRange(range);

                for(var i = 0; i < complexBoxes.length; i++) {
                    var complexBox = complexBoxes[i];
                    if(range.leftColIndex > complexBox.leftColIndex && complexBox.leftColIndex >= 0) {
                        range.leftColIndex = complexBox.leftColIndex;
                        changed = true;
                    }
                    if(range.topRowIndex > complexBox.topRowIndex && complexBox.topRowIndex >= 0) {
                        range.topRowIndex = complexBox.topRowIndex;
                        changed = true;
                    }

                    if(range.rightColIndex < complexBox.rightColIndex && complexBox.rightColIndex >= 0) {
                        range.rightColIndex = complexBox.rightColIndex;
                        changed = true;
                    }
                    if(range.bottomRowIndex < complexBox.bottomRowIndex && complexBox.bottomRowIndex >= 0) {
                        range.bottomRowIndex = complexBox.bottomRowIndex;
                        changed = true;
                    }
                }
                if(changed)
                    range.singleCell = false;
            }

            return range;
        }
        function ExpandActiveCellToMergedRange(rangeDesired) {
            var range = rangeDesired.clone(),
                paneManager = spreadsheet.getPaneManager(),
                complexBoxes = paneManager.getMergedCellRangesIntersectsRange(range);

                for(var i = 0; i < complexBoxes.length; i++) {
                    var complexBox = complexBoxes[i];
                    if(range.leftColIndex >= complexBox.leftColIndex && range.rightColIndex <= complexBox.rightColIndex &&
                        range.topRowIndex >= complexBox.topRowIndex && range.bottomRowIndex <= complexBox.bottomRowIndex) {
                        
                        range.leftColIndex = complexBox.leftColIndex;
                        range.topRowIndex = complexBox.topRowIndex;
                        range.rightColIndex = complexBox.rightColIndex;
                        range.bottomRowIndex = complexBox.bottomRowIndex;

                        range.singleCell = false;
                    }
                }
            return range;
        }
        
        this.findNoneMergedCell = function(isCol, startIndex) {
            var topLeftCell = spreadsheet.getPaneManager().getTopLeftCellVisiblePosition(),
                cellSearchIndex = isCol ? topLeftCell.row : topLeftCell.col,
                isMergedCell = true,
                activeCellRange = isCol ? new ASPxClientSpreadsheet.Range(startIndex, cellSearchIndex, startIndex, cellSearchIndex) :
                                        new ASPxClientSpreadsheet.Range(cellSearchIndex, startIndex, cellSearchIndex, startIndex);
            while(isMergedCell) {
                var newActiveCellRange = ExpandRangeToMergedCellSizeInternal(activeCellRange);
                if(activeCellRange.bottomRowIndex == newActiveCellRange.bottomRowIndex && activeCellRange.leftColIndex == newActiveCellRange.leftColIndex &&
                    activeCellRange.rightColIndex == newActiveCellRange.rightColIndex && activeCellRange.topRowIndex == newActiveCellRange.topRowIndex) {
                    return newActiveCellRange;
                } else {
                    cellSearchIndex++;
                    activeCellRange = isCol ? new ASPxClientSpreadsheet.Range(startIndex, cellSearchIndex, startIndex, cellSearchIndex) : new ASPxClientSpreadsheet.Range(cellSearchIndex, startIndex, cellSearchIndex, startIndex);
                }
            }
        };

        this.cellIsOutsideDocumentBounds = function(isCol, index) {
            var tileHelper = spreadsheet.getPaneManager().getTileHelper();
            var endOfDocumentCellInfo = tileHelper.getEndOfDocumentCellInfo(isCol);
            if(!endOfDocumentCellInfo)
                return false;
            return index > endOfDocumentCellInfo.visibleIndex;
        };

        function hideModelBoxSelection() {
            var paneManager = spreadsheet.getPaneManager();
            paneManager.hideModelBoxSelection();
        }

       /* this.parseFormula = function(inputElement, cursorPosition) {
            var that = this;

            spreadsheet.stateController.resetActiveSelection();
            if(inputElement.value) {
                ASPx.Data.ForEach(ASPx.SpreadsheetFormulaParser.parse(inputElement.value, spreadsheet.getDocumentModel().getActiveSheetName(), cursorPosition), function(selection) {
                    if(selection.range.isHighlighted) {
                        spreadsheet.stateController.setActiveSelection(selection);
                    }
                    that.setSelection(selection, true);
                });
                spreadsheet.stateController.setCursorPosition(cursorPosition);
            }
        }.aspxBind(this);*/
    };
    ASPxClientSpreadsheet.SelectionHelper.BorderCorrectionFactor = 2;
})();

(function() {
    var markerParameters = (ASPx.Browser.TouchUI) ?
        {
            width: 17,
            height: 17,
            horizontalPositionAdjustment: 7,
            verticalPositionAdjustment: 7
        } :
        {
            width: 3,
            height: 3,
            horizontalPositionAdjustment: 3,
            verticalPositionAdjustment: 3
        };

    ASPxClientSpreadsheet.RenderedSelectionBase = ASPx.CreateClass(null, {
        constructor: function(selection, paneManager) {
            this.selection = selection;
            this.useModelIndex = false;
            this.paneManager = paneManager;
            this.selectionParts = {};
        },
        getElementClassName: function() {
            return "";
        },
        ensureSelectionIsConvertedToModelIndex: function() {
            if(this.useModelIndex) return;
            if(!this.selection.entireColsSelected) {
                this.selection.range.topRowIndex = this.paneManager.convertVisibleIndexToModelIndex(this.selection.range.topRowIndex);
                this.selection.range.bottomRowIndex = this.paneManager.convertVisibleIndexToModelIndex(this.selection.range.bottomRowIndex);
            }
            if(!this.selection.entireRowsSelected) {
                this.selection.range.leftColIndex = this.paneManager.convertVisibleIndexToModelIndex(this.selection.range.leftColIndex, true);
                this.selection.range.rightColIndex = this.paneManager.convertVisibleIndexToModelIndex(this.selection.range.rightColIndex, true);
            }
            this.useModelIndex = true;
        },
        ensureRangeIsConvertedToVisibleIndex: function(maxVisibleRange) {
            var convertedRange = this.selection.range.clone();
            if(convertedRange.topRowIndex >= maxVisibleRange.top && convertedRange.topRowIndex <= maxVisibleRange.bottom)
                convertedRange.topRowIndex = this.paneManager.convertModelIndexToVisibleIndex(this.selection.range.topRowIndex);
            if(convertedRange.bottomRowIndex >= maxVisibleRange.top && convertedRange.bottomRowIndex <= maxVisibleRange.bottom)
                convertedRange.bottomRowIndex = this.paneManager.convertModelIndexToVisibleIndex(this.selection.range.bottomRowIndex);
            if(convertedRange.leftColIndex >= maxVisibleRange.left && convertedRange.leftColIndex <= maxVisibleRange.right)
                convertedRange.leftColIndex = this.paneManager.convertModelIndexToVisibleIndex(this.selection.range.leftColIndex, true);
            if(convertedRange.rightColIndex >= maxVisibleRange.left && convertedRange.rightColIndex <= maxVisibleRange.right)
                convertedRange.rightColIndex = this.paneManager.convertModelIndexToVisibleIndex(this.selection.range.rightColIndex, true);
            return convertedRange;
        },
        createSelection: function(range) {
            this.selection = new ASPxClientSpreadsheet.Selection(range, range.leftColIndex, range.topRowIndex);
            this.selection.setActiveCell(range.leftColIndex, range.topRowIndex);
        },
        render: function() {
            this.prepareSelection();
            if(this.selection.range.startPaneType == this.selection.range.endPaneType)
                this.drawSelectionOnSinglePane();
            else
                this.drawSelectionOnMultiplePanes();
        },
        drawSelectionOnSinglePane: function() {
            var activePane = this.paneManager.getPaneByType(this.selection.range.startPaneType);
            if(activePane)
                this.drawPartSelectionOnPane(activePane);
        },
        drawSelectionOnMultiplePanes: function() {
            if(this.selection.entireColsSelected || this.selection.entireRowsSelected)
                this.correctFullRowOrColSelection(this.selection);
            this.selection.correctPaneSelection();

            if(this.selection.range.diagonalSelection) {
                for(var paneType in this.paneManager.activePanes) {
                    if(this.paneManager.activePanes[paneType]) {
                        var pane = this.paneManager.activePanes[paneType];
                        this.drawPartSelectionOnPane(pane);
                    }
                }
            }
            else {
                var startPane = this.paneManager.getPaneByType(this.selection.range.startPaneType),
                    endPane = this.paneManager.getPaneByType(this.selection.range.endPaneType);

                this.drawPartSelectionOnPane(startPane);
                this.drawPartSelectionOnPane(endPane);
            }
        },
        prepareSelection: function() {
            this.ensureSelectionIsConvertedToModelIndex();
            this.paneManager.correctSelection(this.selection);
            this.setRangePanes();
        },
        setRangePanes: function() {
            var pane = this.paneManager.getPaneByCell({ col: this.selection.range.leftColIndex, row: this.selection.range.topRowIndex });
            if(pane != null)
                this.selection.range.startPaneType = pane.paneType;
            pane = this.paneManager.getPaneByCell({ col: this.selection.range.rightColIndex, row: this.selection.range.bottomRowIndex });
            if(pane != null)
                this.selection.range.endPaneType = pane.paneType;
        },
        correctFullRowOrColSelection: function() {
            var bottomLeftCell = { col: this.selection.range.leftColIndex, row: this.selection.range.bottomRowIndex };
            var topRightCell = { col: this.selection.range.rightColIndex, row: this.selection.range.topRowIndex };
            var edgeCell = this.selection.entireRowsSelected ? bottomLeftCell : topRightCell;

            var edgeCellPaneType = this.paneManager.getPaneByCell(edgeCell).paneType;

            this.correctFullRowOrColSelectionPanes(edgeCellPaneType, this.selection.entireRowsSelected);
        },
        correctFullRowOrColSelectionPanes: function(lastCellPaneType, isRowSelection) {
            var rangeEndPaneType = ASPxClientSpreadsheet.PaneManager.PanesType.MainPane;
            if(this.selection.range.startPaneType == lastCellPaneType && this.selection.range.startPaneType == ASPxClientSpreadsheet.PaneManager.PanesType.FrozenPane) {
                if(!isRowSelection)
                    rangeEndPaneType = ASPxClientSpreadsheet.PaneManager.PanesType.BottomLeftPane;
                else
                    rangeEndPaneType = ASPxClientSpreadsheet.PaneManager.PanesType.TopRightPane;
            }
            if(this.selection.range.endPaneType && !this.selection.range.startPaneType)
                this.selection.range.setStartPaneType(rangeEndPaneType);
            else if(this.selection.range.endPaneType && !this.selection.range.startPaneType)
                this.selection.range.setEndPaneType(rangeEndPaneType);
        },
        drawPartSelectionOnPane: function(pane) {
            var layoutInfo = this.getLayoutInfo(pane);
            if(layoutInfo.topLeft == null || layoutInfo.bottomRight == null)
                return;
            var rect = this.getSelectionRect(layoutInfo.topLeft, layoutInfo.bottomRight);
            this.insertAndArrangeElement(this.getSelectionAreaElement(pane), pane, layoutInfo, rect);
        },
        getLayoutInfo: function(pane) {
            var maxVisibleRange = this.paneManager.getVisibleModelCellRange(pane.paneType);
            var convertedRange = this.ensureRangeIsConvertedToVisibleIndex(maxVisibleRange);
            if(this.isEntireRangeHidden(convertedRange, maxVisibleRange))
                return { topLeft: null, bottomRight: null };

            var topLeftCellLayoutInfo = pane.getCellLayoutInfo(pane.putCellColIndexInVisibleRange(convertedRange.leftColIndex), pane.putCellRowIndexInVisibleRange(convertedRange.topRowIndex));
            var bottomRightCellLayoutInfo = pane.getCellLayoutInfo(pane.putCellColIndexInVisibleRange(convertedRange.rightColIndex), pane.putCellRowIndexInVisibleRange(convertedRange.bottomRowIndex));
            return { topLeft: topLeftCellLayoutInfo, bottomRight: bottomRightCellLayoutInfo };
        },
        isEntireRangeHidden: function(range, maxVisibleRange) {
            return range.rightColIndex < maxVisibleRange.left ||
                range.leftColIndex > maxVisibleRange.right ||
                range.bottomRowIndex < maxVisibleRange.top ||
                range.topRowIndex > maxVisibleRange.bottom;
        },
        insertAndArrangeElement: function(element, pane, layoutInfo, rect) {
            var parentTileInfo = pane.getCellParentTileInfo({ col: layoutInfo.topLeft.colIndex, row: layoutInfo.topLeft.rowIndex });
            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(element, parentTileInfo.htmlElement);
            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRect(element, rect);
            ASPx.SetElementDisplay(element, true);
        },
        getSelectionRect: function(leftTop, rightBottom) {
            var rect = ASPxClientSpreadsheet.CellHelper.getCellRangeRect(leftTop, rightBottom, leftTop.tileInfo);
            this.correctSelectionRect(rect);
            return rect;
        },
        correctSelectionRect: function(rect) {
            rect.width += 1;
            rect.height += 1;
        },
        getSelectionAreaElement: function(pane) {
            var paneType = pane.paneType;
            if(!this.selectionParts[paneType]) {
                this.selectionParts[paneType] = this.createDiv(this.getElementClassName(), null);
            }
            else {
                this.selectionParts[paneType].className = this.getElementClassName();
                ASPx.SetElementDisplay(this.selectionParts[paneType], true);
            }

            return this.selectionParts[paneType];
        },
        createDiv: function(cssClass, parentElement) {
            var element = document.createElement("DIV");
            element.className = cssClass;
            if(parentElement)
                parentElement.appendChild(element);
            return element;
        },
        clear: function() {
            for(var paneType in this.paneManager.activePanes) {
                if(this.selectionParts[paneType] && this.selectionParts[paneType].parentNode)
                    this.selectionParts[paneType].parentNode.removeChild(this.selectionParts[paneType]);
            }
        }
    });

    ASPxClientSpreadsheet.CopiedRangeSelection = ASPx.CreateClass(ASPxClientSpreadsheet.RenderedSelectionBase, {
        constructor: function(paneManager) {
            this.constructor.prototype.constructor.call(this, ASPxClientSpreadsheet.Selection.Default, paneManager);
            this.commandId = true;
        },
        getElementClassName: function() {
            var cssClass = ASPx.SpreadsheetCssClasses.CopiedRange;
            if(!this.commandId)
                cssClass += " " + ASPx.SpreadsheetCssClasses.CutRange;
            return cssClass;
        },
        setParameters: function(selection, commandId) {
            this.useModelIndex = false;
            this.selection = selection.clone();
            this.commandId = commandId;
        },
        intersectsRange: function(range) {
            var convertedRange = range.clone();
            var intersects = false;
            for(var paneType in this.paneManager.activePanes) {
                if(this.paneManager.activePanes[paneType]) {
                    var pane = this.paneManager.activePanes[paneType];
                    var maxVisibleRange = this.paneManager.getVisibleModelCellRange(pane.paneType);
                    var convertedCopiedRange = this.ensureRangeIsConvertedToVisibleIndex(maxVisibleRange);
                    intersects = intersects || convertedCopiedRange.intersectsRange(convertedRange);
                }
            }
            return intersects;
        }
    });

    ASPxClientSpreadsheet.FillHandleSelection = ASPx.CreateClass(ASPxClientSpreadsheet.RenderedSelectionBase, {
        constructor: function(paneManager) {
            this.constructor.prototype.constructor.call(this, ASPxClientSpreadsheet.Selection.Default, paneManager);
        },
        getElementClassName: function() {
            return ASPx.SpreadsheetCssClasses.SelectionBorderElement;
        },
        setParameters: function(selection, cell) {
            this.useModelIndex = false;
            var range = this.getFillHandleRange(selection, cell);
            this.createSelection(range);
        },
        getFillHandleRange: function(selection, cell) {
            var horizontalFill = false,
                leftColIndex,
                topRowIndex,
                rightColIndex,
                bottomRowIndex;

            if(this.isInnerSelection(selection, cell)) {
                horizontalFill = selection.range.rightColIndex - cell.colIndex >= selection.range.bottomRowIndex - cell.rowIndex;

                leftColIndex = selection.range.leftColIndex;
                topRowIndex = selection.range.topRowIndex;
                rightColIndex = horizontalFill ? cell.colIndex : selection.range.rightColIndex;
                bottomRowIndex = horizontalFill ? selection.range.bottomRowIndex : cell.rowIndex;
            } else {
                var horzOffset = this.cellInSelectionHorizontal(selection, cell) ? 0 : Math.min(Math.abs(selection.range.leftColIndex - cell.colIndex), Math.abs(selection.range.leftColIndex - cell.colIndex)),
                    vertOffset = this.cellInSelectionVertical(selection, cell) ? 0 : Math.min(Math.abs(selection.range.topRowIndex - cell.rowIndex), Math.abs(selection.range.bottomRowIndex - cell.rowIndex));
                horizontalFill = horzOffset >= vertOffset;

                topRowIndex = horizontalFill ? selection.range.topRowIndex : Math.min(selection.range.topRowIndex, cell.rowIndex);
                bottomRowIndex = horizontalFill ? selection.range.bottomRowIndex : Math.max(selection.range.bottomRowIndex, cell.rowIndex);
                leftColIndex = horizontalFill ? Math.min(selection.range.leftColIndex, cell.colIndex) : selection.range.leftColIndex;
                rightColIndex = horizontalFill ? Math.max(selection.range.rightColIndex, cell.colIndex) : selection.range.rightColIndex;
            }

            return new ASPxClientSpreadsheet.Range(leftColIndex, topRowIndex, rightColIndex, bottomRowIndex);
        },
        cellInSelectionHorizontal: function(selection, cell) {
            return selection.range.leftColIndex <= cell.colIndex && cell.colIndex <= selection.range.rightColIndex;
        },
        cellInSelectionVertical: function(selection, cell) {
            return selection.range.topRowIndex <= cell.rowIndex && cell.rowIndex <= selection.range.bottomRowIndex;
        },
        isInnerSelection: function(selection, cell) {
            return this.cellInSelectionHorizontal(selection, cell) && this.cellInSelectionVertical(selection, cell);
        },
        isFillHandleElement: function(element) {
            return ASPx.ElementHasCssClass(element, ASPx.SpreadsheetCssClasses.FillHandleElement);
        },
        getCurrentRange: function() {
            this.ensureSelectionIsConvertedToModelIndex();
            return this.selection.range;
        }
    });

    ASPxClientSpreadsheet.MovingSelection = ASPx.CreateClass(ASPxClientSpreadsheet.RenderedSelectionBase, {
        constructor: function(paneManager) {
            this.constructor.prototype.constructor.call(this, ASPxClientSpreadsheet.Selection.Default, paneManager);
        },
        getElementClassName: function() {
            return ASPx.SpreadsheetCssClasses.SelectionBorderElement;
        },
        setParameters: function(selection, cellLayoutInfo) {
            if(!this.parametersIsValid(selection, cellLayoutInfo)) return;
            this.useModelIndex = false;
            if(!this.selectionMovementReferenceCell) {
                this.getSelectionMovementReferenceCell(selection, cellLayoutInfo);
            }
            var range = this.getMovedRange(selection, cellLayoutInfo);
            if(selection.entireColsSelected || selection.entireRowsSelected || this.rangeIsValid(range))
                this.createSelection(range);
        },
        rangeIsValid: function(range) {
            var tileHelper = this.paneManager.getTileHelper(),
                endOfDocumentCol = tileHelper.getEndOfDocumentCellInfo(true),
                endOfDocumentRow = tileHelper.getEndOfDocumentCellInfo(false);

            return (!endOfDocumentCol || range.rightColIndex <= endOfDocumentCol.modelIndex) &&
                (!endOfDocumentRow || range.bottomRowIndex <= endOfDocumentRow.modelIndex);
        },
        parametersIsValid: function(selection, cellLayoutInfo) {
            var range = this.getMovedRange(selection, cellLayoutInfo),
                tileHelper = this.paneManager.getTileHelper(),
                endOfDocumentCol = tileHelper.getEndOfDocumentCellInfo(true),
                endOfDocumentRow = tileHelper.getEndOfDocumentCellInfo(false);

            return selection.entireColsSelected || selection.entireRowsSelected ||
                (!endOfDocumentCol || range.rightColIndex <= endOfDocumentCol.visibleIndex) &&
                (!endOfDocumentRow || range.bottomRowIndex <= endOfDocumentRow.visibleIndex);
        },
        getCurrentRange: function() {
            return this.selection.range;
        },
        clear: function() {
            this.selectionMovementReferenceCell = null;
            ASPxClientSpreadsheet.RenderedSelectionBase.prototype.clear.call(this);
        },
        move: function() {
            this.hideElements();
            this.render();
        },
        hideElements: function() {
            for(var paneType in this.paneManager.activePanes) {
                if(this.selectionParts[paneType] && this.selectionParts[paneType].parentNode)
                    ASPx.SetElementDisplay(this.selectionParts[paneType], false);
            }
        },
        getSelectionMovementReferenceCell: function(selection, cellLayoutInfo) {
            if(!this.selectionMovementReferenceCell)
                this.selectionMovementReferenceCell = {
                    rowIndex: this.getNearestNeighborCellIndexInsideSelection(selection, cellLayoutInfo.rowIndex, false),
                    colIndex: this.getNearestNeighborCellIndexInsideSelection(selection, cellLayoutInfo.colIndex, true)
                };
            return this.selectionMovementReferenceCell;
        },
        getMovedRange: function(selection, cellLayoutInfo) {
            var referenceCell = this.getSelectionMovementReferenceCell(selection, cellLayoutInfo),
                horzOffset = selection.entireRowsSelected ? 0 : cellLayoutInfo.colIndex - referenceCell.colIndex,
                vertOffset = selection.entireColsSelected ? 0 : cellLayoutInfo.rowIndex - referenceCell.rowIndex,
                leftColIndex = selection.range.leftColIndex + horzOffset,
                topRowIndex = selection.range.topRowIndex + vertOffset;

            leftColIndex = Math.max(0, leftColIndex);
            topRowIndex = Math.max(0, topRowIndex);

            var rightColIndex = leftColIndex + selection.range.rightColIndex - selection.range.leftColIndex,
                bottomRowIndex = topRowIndex + selection.range.bottomRowIndex - selection.range.topRowIndex;
            return new ASPxClientSpreadsheet.Range(leftColIndex, topRowIndex, rightColIndex, bottomRowIndex);
        },
        getNearestNeighborCellIndexInsideSelection: function(selection, cellIndex, isCol) {
            var index = cellIndex;
            if(!selection.range.isCellInRangeCore(cellIndex, isCol))
                index = selection.range.isCellInRangeCore(cellIndex + 1, isCol) ? cellIndex + 1 : cellIndex - 1;
            return index;
        }
    });

    ASPxClientSpreadsheet.DynamicSelection = ASPx.CreateClass(ASPxClientSpreadsheet.RenderedSelectionBase, {
        constructor: function(spreadsheet, dynamicColorIndex, mouseDownHandler) {
            this.resizeMarkers = [];
            this.dynamicColorIndex = dynamicColorIndex;
            this.constructor.prototype.constructor.call(this, ASPxClientSpreadsheet.Selection.Default, spreadsheet.getPaneManager());
            this.mouseDownHandler = mouseDownHandler;
            this.useModelIndex = true;
            this.spreadsheet = spreadsheet;
        },
        getElementClassName: function() {
            return ASPx.SpreadsheetCssClasses.CellDynamicSelectionElement + " color" + this.dynamicColorIndex + (this.selection.range.isHighlighted ? " highlighted" : "");
        },
        setSelection: function(selection) {
            this.selection = selection;
            this.selection.setActiveCell(selection.range.leftColIndex, selection.range.topRowIndex);
        },
        setHighlighted: function(highlighted) {
            this.selection.range.isHighlighted = highlighted;
        },
        drawPartSelectionOnPane: function(pane) {
            ASPxClientSpreadsheet.RenderedSelectionBase.prototype.drawPartSelectionOnPane.call(this, pane);
            this.drawResizingMarkers(pane);
        },
        drawResizingMarkers: function(pane) {
            var locations = ["nw", "ne", "sw", "se"];

            ASPx.Data.ForEach(locations, function(location) {
                var markerElement = this.renderResizeMarker(pane, location);
                if(markerElement) {
                    ASPx.Evt.AttachEventToElement(markerElement, ASPx.TouchUIHelper.touchMouseDownEventName, function() {
                        this.mouseDownHandler(this);
                    }.aspxBind(this), true);
                    ASPx.Evt.AttachEventToElement(markerElement, ASPx.TouchUIHelper.touchMouseMoveEventName, function(evt) {
                        ASPx.Evt.PreventEventAndBubble(evt);
                        this.spreadsheet.dispatchEvent(evt, pane.paneType);
                    }.aspxBind(this), true);
                    this.resizeMarkers.push(markerElement);
                }
            }.aspxBind(this));
        },
        renderResizeMarker: function(pane, location) {
            if(!this.selectionParts[pane.paneType])
                return null;
            var markerElement = this.createDiv(ASPx.SpreadsheetCssClasses.CellDynamicSelectionElement + " color" + this.dynamicColorIndex + " marker " + location, null);
            this.setResizeMarkerRect(pane, markerElement, location);

            return markerElement;
        },
        setResizeMarkerRect: function(pane, markerElement, location) {
            var layoutInfo = this.getLayoutInfo(pane);
            var rect = this.getSelectionRect(layoutInfo.topLeft, layoutInfo.bottomRight);

            var markerRect = {
                x: rect.x,
                y: rect.y,
                width: markerParameters.width,
                height: markerParameters.height
            };
            switch(location) {
                case "nw":
                    markerRect.x -= markerParameters.width - markerParameters.horizontalPositionAdjustment;
                    markerRect.y -= markerParameters.height - markerParameters.verticalPositionAdjustment;
                    break;
                case "ne":
                    markerRect.x += rect.width - markerParameters.horizontalPositionAdjustment;
                    markerRect.y -= markerParameters.height - markerParameters.verticalPositionAdjustment;
                    break;
                case "sw":
                    markerRect.x -= markerParameters.width - markerParameters.horizontalPositionAdjustment;
                    markerRect.y += rect.height - markerParameters.verticalPositionAdjustment;
                    break;
                case "se":
                    markerRect.x += rect.width - markerParameters.horizontalPositionAdjustment;
                    markerRect.y += rect.height - markerParameters.verticalPositionAdjustment;
                    break;
            }
            this.insertAndArrangeElement(markerElement, pane, layoutInfo, markerRect);
        },
        correctSelectionRect: function(rect) {
            var borderCorrectionFactor = Math.floor(ASPxClientSpreadsheet.SelectionHelper.BorderCorrectionFactor / 2);
            rect.x -= borderCorrectionFactor;
            rect.y -= borderCorrectionFactor;
            rect.width -= borderCorrectionFactor;
            rect.height -= borderCorrectionFactor;
        },
        dispose: function() {
            this.clear();
            ASPx.Data.ForEach(this.resizeMarkers, function(marker) {
                ASPx.RemoveElement(marker);
            });
        }
    });
})();
(function(undefined) {
    ASPxClientSpreadsheet.DrawingBoxSelectionStateHelper = function(spreadsheetControl, selectionState) {
        this.drawingBoxElement = null;
        this.drawingBoxIndex = -1;
        this.resizingHelper = null;

        this.captureElement = function(evt, drawingBoxElement, drawingBoxIndex) {
            this.drawingBoxElement = drawingBoxElement;
            this.drawingBoxIndex = drawingBoxIndex;
        };
        this.onMouseDown = function(evt, element) {
            if(ASPx.Browser.WebKitTouchUI)
                evt.stopPropagation();

            if(spreadsheetControl.getIsDrawingBoxElement(element)) {
                ASPx.Evt.PreventElementDrag(element);
                var paneType = spreadsheetControl.getPaneManager().getPaneTypeByEvent(evt),
                       pane = spreadsheetControl.getPaneManager().getPaneByType(paneType);
                element = pane.getDrawingHelper().getModelBoxSelectionElement(false);
            }

            this.resizingHelper = new ASPxClientSpreadsheet.ResizingHelper(this, evt, element);
        };
        this.onMouseMove = function(evt) {
            if(this.resizingHelper)
                this.resizingHelper.onMouseMove(evt);
        };
        this.onMouseUp = function(evt, drawingBoxElement) {
            if(this.resizingHelper) {
                this.resizingHelper.onMouseUp(evt);
                var hasChanges = this.resizingHelper.hasChanges();
                var shapeDiff = this.resizingHelper.getChanges();
                this.resizingHelper = null;

                if(hasChanges) {
                    ASPxClientSpreadsheet.ServerCommands.ShapeMoveAndResize(spreadsheetControl,
                        {   shapeOffsetX: shapeDiff.offsetX,
                            shapeOffsetY: shapeDiff.offsetY,
                            shapeWidth: shapeDiff.width,
                            shapeHeight: shapeDiff.height
                        }
                    );
                }
            }
        };
        this.onEscape = function() {
            if(this.resizingHelper) {
                this.resizingHelper.onEscape();
                this.resizingHelper = null;
            }
        };

        /*region ResiznigHelperStateImplementation*/
        this.getOwnerControl = function() {
            return spreadsheetControl;
        };
        this.isMovingStarted = function(targetElement) {
            return ASPx.ElementHasCssClass(targetElement, ASPx.SpreadsheetCssClasses.DrawingBoxSelectedElement);
        };
        this.isResizingStarted = function(targetElement) {
            return ASPx.ElementHasCssClass(targetElement.parentNode, ASPx.SpreadsheetCssClasses.DrawingBoxSelectedElement);
        };
        this.isResizingProportional = function(evt) {
            var drawingBoxElement = spreadsheetControl.getSelectionInternal().drawingBoxElement,
                isChart = spreadsheetControl.getIsChartElement(drawingBoxElement);
            return !isChart || evt.shiftKey;
        };
        /*endregion*/
    };

    ASPxClientSpreadsheet.EntireRowAllColSelectionStateHelper = function(spreadsheetControl, selectionState) {
        var currentSelectionState = selectionState;

        var startIndex = -1,
            selectionMethod = "",
            curIsCol,
            activeCellRange = null;


        function setSelectionMethod(isCol) {
            selectionMethod = isCol ? "selectEntireColumns" : "selectEntireRows";
        }

        this.changeStartParams = function(toRightOrBottom) {
            var selection = currentSelectionState.getSelection();
            selection.resetVisible();
            if(selection.entireColsSelected) {
                startIndex = toRightOrBottom ? selection.range.leftColIndex : selection.range.rightColIndex;
                curIsCol = true;
            }
            else if(selection.entireRowsSelected) {
                startIndex = toRightOrBottom ? selection.range.topRowIndex : selection.range.bottomRowIndex;
                curIsCol = false;
            }
            setSelectionMethod(curIsCol);
        };
        this.onMouseDown = function(cellIndex, isCol) {
            startIndex = cellIndex;
            setSelectionMethod(isCol);
            curIsCol = isCol;

            var selection = currentSelectionState.getSelection(),
                selectionHelper = spreadsheetControl.getSelectionHelper();
            selection.resetVisible();
            activeCellRange = selectionHelper.findNoneMergedCell(isCol, cellIndex);
                           
            selection[selectionMethod](startIndex, cellIndex, activeCellRange.leftColIndex, activeCellRange.topRowIndex);

            currentSelectionState.activate();
        };
        this.onMouseMove = function(cellIndex, isCol, onBorder) {
            if(curIsCol != isCol || startIndex == -1) return;

            var selection = currentSelectionState.getSelection();
            selection.resetVisible();
            if(!activeCellRange)
                findActiveCellRange(isCol, startIndex);
            moveActiveCellToRangeTouch(startIndex, cellIndex, isCol);

            if(onBorder) {
                var endOfDocumentCellInfo = spreadsheetControl.getPaneManager().getTileHelper().getEndOfDocumentCellInfo(isCol);
                cellIndex = endOfDocumentCellInfo && endOfDocumentCellInfo.visibleIndex === cellIndex ? ASPxClientSpreadsheet.Range.getMaxCellIndex(isCol) : cellIndex;
            }
            selection[selectionMethod](startIndex, cellIndex, activeCellRange.leftColIndex, activeCellRange.topRowIndex);
            currentSelectionState.activate();
        };
        function findActiveCellRange(isCol, startIndex) {
            var selectionHelper = spreadsheetControl.getSelectionHelper();
            activeCellRange = selectionHelper.findNoneMergedCell(isCol, startIndex);
        }
        function moveActiveCellToRangeTouch(startIndex, cellIndex, isCol) {
            if(ASPx.Browser.TouchUI) {
                var minIndex = Math.min(startIndex, cellIndex);
                var maxIndex = Math.max(startIndex, cellIndex);
                if(isCol && activeCellRange.leftColIndex < minIndex || !isCol && activeCellRange.topRowIndex < minIndex)
                    findActiveCellRange(isCol, minIndex);
                else if(isCol && activeCellRange.leftColIndex > maxIndex || !isCol && activeCellRange.topRowIndex > maxIndex)
                    findActiveCellRange(isCol, maxIndex);
            }
        }
        this.onMouseUp = function(isCol) {
            startIndex = -1;
            selectionMethod = "";
            activeCellRange = null;
        };        
    };

    ASPxClientSpreadsheet.StateController = function(spreadsheetControl) {
        var paneManager = spreadsheetControl.getPaneManager();

        var states = {
            selected: new ASPxClientSpreadsheet.SelectionState(spreadsheetControl),
            editing: new ASPxClientSpreadsheet.EditingState(spreadsheetControl),
            rangeEditing: new ASPxClientSpreadsheet.RangeEditState(spreadsheetControl),
            copiedRange: new ASPxClientSpreadsheet.CopiedRangeState(spreadsheetControl),
            fillHandle: new ASPxClientSpreadsheet.FillHandleState(spreadsheetControl),
            movingSelection: new ASPxClientSpreadsheet.MovingSelectionState(spreadsheetControl),
            comment: new ASPxClientSpreadsheet.CommentState(spreadsheetControl),
            mouseMoving: new ASPxClientSpreadsheet.MouseMovingState(spreadsheetControl)
        };

        var drawingBoxSelectionStateHelper = new ASPxClientSpreadsheet.DrawingBoxSelectionStateHelper(spreadsheetControl, states.selected),
            entireRowAllColSelectionStateHelper = new ASPxClientSpreadsheet.EntireRowAllColSelectionStateHelper(spreadsheetControl, states.selected);

        var capturedEntityTypes = {
            Nothing:    0,
            Cell:       1,
            DrawingBox: 2,
            RowOrCol:   3,
            SelectionBorder: 4,
            FillHandle: 5,
            Comment: 6
        };        

        var capturedEntity = capturedEntityTypes.Nothing;

        function captureCell() {
            capturedEntity = capturedEntityTypes.Cell;
        }
        function captureDrawingBox() {
            capturedEntity = capturedEntityTypes.DrawingBox;
        }
        function captureRowOrCol() {
            capturedEntity = capturedEntityTypes.RowOrCol;
        }
        function captureSelectionBorder() {
            capturedEntity = capturedEntityTypes.SelectionBorder;
        }
        function captureFillHandle() {
            capturedEntity = capturedEntityTypes.FillHandle;
        }
        function releaseCapturedEntity() {
            capturedEntity = capturedEntityTypes.Nothing;
        }
        function captureComment() {
            capturedEntity = capturedEntityTypes.Comment;
        }
        function isCellCaptured() {
            return capturedEntity == capturedEntityTypes.Cell;
        }
        function isDrawingBoxCaptured() {
            return capturedEntity == capturedEntityTypes.DrawingBox;
        }
        function isRowOrColCaptured() {
            return capturedEntity == capturedEntityTypes.RowOrCol;
        }
        function isSelectionBorderCaptured() {
            return capturedEntity == capturedEntityTypes.SelectionBorder;
        }
        function isFillHandleCaptured() {
            return capturedEntity == capturedEntityTypes.FillHandle;
        }
        function isCommentCaptured() {
            return capturedEntity == capturedEntityTypes.Comment;
        }

        function cellSelectionStart(states, cellLayoutInfo) {
            if(states.editing.canFinalizeEditing()) {
                captureCell();
                selectCell(states, cellLayoutInfo);
            }
        }

        function selectCell(states, cellLayoutInfo) {
            states.selected.finalize();
            states.selected.bindToCell({ col: cellLayoutInfo.colIndex, row: cellLayoutInfo.rowIndex });
            var selectionChanged = states.selected.isSelectionChanged();
            states.selected.activate();
            states.editing.finalize();
            states.comment.finalize();
            return selectionChanged;
        }

        this.cellFastTap = function(cellLayoutInfo) {
            if(states.editing.canFinalizeEditing()) {
                return selectCell(states, cellLayoutInfo);
            }
        };

        function cellSelectionContinue(states, cellLayoutInfo) {
            if(states.selected.bindToLastCell( { col: cellLayoutInfo.colIndex, row: cellLayoutInfo.rowIndex }))
                states.selected.activate();
        }

        function canStartEditing(cellLayoutInfo) {
            return states.editing.canStartEditing(cellLayoutInfo);
        }

        function otherCellIsCurrentlyValidating(cellLayoutInfo) {
            var currentlyValidatingCell = spreadsheetControl.getValidationHelper().getCurrentlyValidatingCell();
            if(currentlyValidatingCell == null)
                return false;

            return currentlyValidatingCell.col != cellLayoutInfo.colModelIndex || currentlyValidatingCell.row != cellLayoutInfo.rowModelIndex;
        }

        var isDialogOpened = false;

        this.notifyNonModalDialogOpen = function() {
            isDialogOpened = true;
        };

        this.notifyNonModalDialogClose = function() {
            isDialogOpened = false;
        };

        this.isNonModalDialogOpen = function() {
            return isDialogOpened;
        };

        function canRangeEdit(evt) {
            if(isDialogOpened || ASPx.ElementHasCssClass(evt.target, "marker")) {
                return true;
            }

            var isEnterOrEditMode = spreadsheetControl.stateController.getEditMode() !== ASPxClientSpreadsheet.StateController.Modes.Ready;

            if(isEnterOrEditMode)
                return isCaretOnOperator() || isCaretOnRange();

            return false;
        }

        function isCaretOnOperator() {
            var inputController = spreadsheetControl.getInputController(),
                editorContent = inputController.getOnlyText();

            if(!(editorContent && editorContent[0] === "="))
                return false;

            var trimmedContent = ASPx.Str.Trim(editorContent),
                caretPosition = inputController.getCaretPosition(),
                currentSymbol = trimmedContent[(caretPosition || trimmedContent.length) - 1],
                operators = ["+", "-", "*", "/", "(", "^", "=", ","];

            return ASPx.Data.ArrayContains(operators, currentSymbol);
        }
        function isCaretOnRange() {
            var dynamicSelectionHelper = spreadsheetControl.getDynamicSelectionHelper(),
                selection = dynamicSelectionHelper.getHighlightSelection();

            return !!selection;
        }

        this.canChangeSheetToEnterFormula = function() {
            return this.isEditingInProgress() && isCaretOnOperator();
        };

        this.isDynamicSelectionHelperAttachedToDialog = function() {
            var dynamicSelectionHelper = spreadsheetControl.getDynamicSelectionHelper();
            return dynamicSelectionHelper.isAttachedToDialog();
        };

        

        this.isDrawingBoxLinkClick = function(evt, drawingBoxElement) {
            return evt.type == ASPx.TouchUIHelper.touchMouseDownEventName && !states.selected.getSelection().isDrawingBoxSelection()
                && ASPx.Attr.GetAttribute(drawingBoxElement, "_loc") && ASPx.Evt.IsLeftButtonPressed(evt);
        };

        this.onDrawingBoxEvent = function(evt, drawingBoxElement, drawingBoxIndex) {
            if(this.isDrawingBoxLinkClick(evt, drawingBoxElement))
                return spreadsheetControl.onHyperLinkClicked(evt, drawingBoxElement);

            if(spreadsheetControl.isObjectSelectionAllowed())
                this.onDrawingBoxEventInternal(evt, drawingBoxElement, drawingBoxIndex);
        };
        
        this.onDrawingBoxEventInternal = function(evt, drawingBoxElement, drawingBoxIndex) {
            if(evt.type == ASPx.TouchUIHelper.touchMouseDownEventName) {
                if(states.editing.canFinalizeEditing()) {
                    captureDrawingBox();
                    if(drawingBoxIndex > -1) {
                        states.selected.finalize();
                        states.selected.selectDrawingBoxIndex(drawingBoxElement, drawingBoxIndex);

                        drawingBoxSelectionStateHelper.captureElement(evt, drawingBoxElement, drawingBoxIndex);
                        states.selected.activate();
                        states.editing.finalize();
                        states.comment.finalize();

                        drawingBoxSelectionStateHelper.onMouseDown(evt, drawingBoxElement);
                    } else {
                        drawingBoxSelectionStateHelper.onMouseDown(evt, drawingBoxElement);
                    }
                }
            } else if(evt.type == ASPx.TouchUIHelper.touchMouseMoveEventName) {
                if(isDrawingBoxCaptured())
                    drawingBoxSelectionStateHelper.onMouseMove(evt, drawingBoxElement);
            } else if(evt.type == ASPx.TouchUIHelper.touchMouseUpEventName) {
                if(isDrawingBoxCaptured())
                    drawingBoxSelectionStateHelper.onMouseUp(evt, drawingBoxElement);
                releaseCapturedEntity();
            }

            states.mouseMoving.finalize();
            spreadsheetControl.getTouchUIHelper().handleDrawingBoxEvent(evt);
        };
        this.onCommentBoxEvent = function(evt, commentBox, commentBoxIndex) {
            if(evt.type == ASPx.TouchUIHelper.touchMouseDownEventName) {
                if(states.editing.canFinalizeEditing()) {
                    captureComment();

                    if(commentBoxIndex >= 0) {
                        states.selected.finalize();
                        states.selected.selectCommentBox(commentBox, commentBoxIndex);
                        states.selected.activate();
                        states.editing.finalize();
                    }
                    states.comment.onMouseDown(evt, commentBox, commentBoxIndex);
                } else {
                    spreadsheetControl.getInputController().captureFocus();
                }
            } else if(evt.type == ASPx.TouchUIHelper.touchMouseMoveEventName) {
                if(isCommentCaptured())
                    states.comment.onMouseMove(evt, commentBoxIndex);
            } else if(evt.type == ASPx.TouchUIHelper.touchMouseUpEventName) {
                if(isCommentCaptured())
                    states.comment.onMouseUp(evt);
                releaseCapturedEntity();
            }

            states.mouseMoving.finalize();
            spreadsheetControl.getTouchUIHelper().handleCommentBoxEvent(evt);
        };
        
        this.onCellEvent = function(evt, cellLayoutInfo, eventFromCellTextViewElement, paneType) {
            if(!cellLayoutInfo || (!cellLayoutInfo.valid && evt.type !== ASPx.TouchUIHelper.touchMouseUpEventName))
                return;

            var srcElement = ASPx.Evt.GetEventSource(evt);

            if(ASPx.Browser.MSTouchUI && spreadsheetControl.getRenderHelper().getGridContainer().MSGestureTapStopPropagation) {
                spreadsheetControl.getRenderHelper().getGridContainer().MSGestureTapStopPropagation = false;
                return;
            }
            var isDblClick = dblClickEvent(evt, srcElement);
            if(isDblClick) {
                if(ASPx.Browser.WebKitTouchUI) {
                    var preventZoom = function() { evt.preventDefault(); };
                    preventZoom();
                }
                if(!otherCellIsCurrentlyValidating(cellLayoutInfo))
                    startCellEditing(cellLayoutInfo);
            } else if(evt.type == ASPx.TouchUIHelper.touchMouseDownEventName) {
                onCellMouseDown(evt, cellLayoutInfo, srcElement, paneType);
            } else if(evt.type == "MSGestureTap" && !spreadsheetControl.getRenderHelper().getIsTouchSelectionElement(srcElement) || evt.type === "contextmenu") {
                spreadsheetControl.getTouchUIHelper().onCellFastTap(cellLayoutInfo);
            } else if(evt.type == ASPx.TouchUIHelper.touchMouseMoveEventName && ASPx.Evt.IsLeftButtonPressed(evt)) {
                onCellLeftButtonMouseMove(evt, cellLayoutInfo, srcElement);
            } else  if(evt.type == ASPx.TouchUIHelper.touchMouseUpEventName) {
                onCellMouseUp(evt, srcElement, cellLayoutInfo);
            } else if(evt.type == ASPx.TouchUIHelper.touchMouseMoveEventName) {
                onCellMouseMove(cellLayoutInfo, paneType);
            } else {
                var isFormulaBarStartEditing = eventFromCellTextViewElement
                    && (evt.type == "click" || evt.type == "keyup");
                if(isFormulaBarStartEditing)
                    startCellEditing(cellLayoutInfo, true);
            }
            if(evt.type !== ASPx.TouchUIHelper.touchMouseMoveEventName)
                states.mouseMoving.finalize(cellLayoutInfo);
            if(!isDblClick)
                spreadsheetControl.getTouchUIHelper().handleCellEvent(evt, cellLayoutInfo);
        };
        function onCellMouseMove(cellLayoutInfo, paneType) {
            states.mouseMoving.activate(cellLayoutInfo, paneType);            
        }
        function dblClickEvent(evt, srcElement) {
            return (evt.type == "dblclick" || ASPx.Browser.WebKitTouchUI && evt.type == "touchstart" && ASPx.TouchUIHelper.allowDoubleTapProcessing(evt)) &&
                !spreadsheetControl.getRenderHelper().getIsDropDownButtonElement(srcElement) &&
                !ASPx.GetIsParent(spreadsheetControl.getValidationHelper().getDropDownPanel(), srcElement) &&
                !spreadsheetControl.getRenderHelper().getIsSelectionBorderElement(srcElement);
        }

        function onSelectionBorderMouseDown() {
            captureSelectionBorder();
            states.copiedRange.finalize();
        }
        function onSelectionBorderMouseMove(selection, cellLayoutInfo) {
            states.movingSelection.setParameters(selection, cellLayoutInfo);
            states.movingSelection.activate();
            states.movingSelection.move();
        }
        function onSelectionBorderMouseUp() {
            if(!states.movingSelection.isActivated()) return;
            var targetRange = states.movingSelection.getCurrentRange();
            spreadsheetControl.OnMoveRange(targetRange);
            states.movingSelection.finalize();
        }
        function onFillHandleMouseDown() {
            captureFillHandle();
            states.fillHandle.activate();
        }
        function onFillHandleMouseUp(cellLayoutInfo) {
            states.fillHandle.setParameters(getSelectionInternal(), cellLayoutInfo);
            spreadsheetControl.OnMoveFillHandle(states.fillHandle.getCurrentRange());
            states.fillHandle.finalize();
        }
        function onCellMouseDown(evt, cellLayoutInfo, srcElement, paneType) {
            if(states.fillHandle.isFillHandleElement(srcElement)) {
                onFillHandleMouseDown();
            } else if(canRangeEdit(evt)) {
                var rangeEditMode = (evt.ctrlKey) ? ASPxClientSpreadsheet.DynamicSelectionHelper.DynamicSelectionKeys.CtrlKey : 0;
                rangeEditMode = (evt.shiftKey) ? rangeEditMode | ASPxClientSpreadsheet.DynamicSelectionHelper.DynamicSelectionKeys.ShiftKey : rangeEditMode;
                states.rangeEditing.activate(cellLayoutInfo, rangeEditMode);
            } else if(spreadsheetControl.getRenderHelper().getIsSelectionBorderElement(srcElement) && ASPx.Evt.IsLeftButtonPressed(evt) && evt.type !== "touchstart") {
                onSelectionBorderMouseDown();
            } else if(evt.shiftKey && ASPx.Evt.IsLeftButtonPressed(evt)) {
                cellSelectionContinue(states, cellLayoutInfo);
            } else if(ASPx.Evt.IsLeftButtonPressed(evt) || !states.selected.isCellSelected(cellLayoutInfo.colIndex, cellLayoutInfo.rowIndex)) {
                if(ASPx.Browser.TouchUI) {
                    if(evt.touches && evt.touches.length > 1) {
                        return;
                    }
                    if(spreadsheetControl.getRenderHelper().getIsTouchSelectionElement(srcElement)) {
                        ASPx.Evt.PreventEventAndBubble(evt);
                        if(getSelectionInternal().entireColsSelected || getSelectionInternal().entireRowsSelected) {
                            captureRowOrCol();
                            entireRowAllColSelectionStateHelper.changeStartParams(spreadsheetControl.getPaneManager().isRightBottomTouchSelectionElement(srcElement, paneType));
                        } else {
                            captureCell();
                            states.selected.rebindFirstCellDiagonally(spreadsheetControl.getPaneManager().isRightBottomTouchSelectionElement(srcElement, paneType));
                        }
                        if(ASPx.Browser.TouchUI)
                            spreadsheetControl.getPaneManager().hideTouchSelectionElements(false);
                    } else if(ASPx.Browser.WebKitTouchUI) {
                        ASPx.TouchUIHelper.FastTapHelper.HandleFastTap(evt, function() {
                            spreadsheetControl.getTouchUIHelper().onCellFastTap(cellLayoutInfo);
                        }, false);
                    }
                } else {
                    if(ASPxClientSpreadsheet.ProtectionHelper.canSelectCell(spreadsheetControl, cellLayoutInfo)) {
                        cellSelectionStart(states, cellLayoutInfo);
                        return false;
                    }
                }
            }
        }
        function onCellMouseUp(evt, srcElement, cellLayoutInfo) {
            if(ASPx.GetIsParent(spreadsheetControl.getValidationHelper().getDropDownPanel(), srcElement)) {
                spreadsheetControl.getValidationHelper().onDropDownPanelMouseUp(srcElement);
            } else if(spreadsheetControl.getRenderHelper().getIsDropDownButtonElement(srcElement)) {
                spreadsheetControl.getValidationHelper().onDropDownButtonMouseUp();
            } else if(isFillHandleCaptured()) {
                onFillHandleMouseUp(cellLayoutInfo);
            } 
            else if(isSelectionBorderCaptured()) {
                onSelectionBorderMouseUp();
            }
            if(states.rangeEditing.isActivated())
                states.rangeEditing.finalize();
            
            releaseCapturedEntity();
        }
        function onCellLeftButtonMouseMove(evt, cellLayoutInfo, srcElement) {
            if(ASPx.Browser.TouchUI) {
                if(spreadsheetControl.getRenderHelper().getIsTouchSelectionElement(srcElement))
                    ASPx.Evt.PreventEventAndBubble(evt);
                if(isRowOrColCaptured()) {
                    var selection = getSelectionInternal();
                    if(selection.entireColsSelected) {
                        entireRowAllColSelectionStateHelper.onMouseMove(cellLayoutInfo.colIndex, true);
                        showTouchResizeElement(selection.range.rightColIndex, true);
                    }
                    if(selection.entireRowsSelected) {
                        entireRowAllColSelectionStateHelper.onMouseMove(cellLayoutInfo.rowIndex, false);
                        showTouchResizeElement(selection.range.bottomRowIndex, false);
                    }
                }
            }
            if(states.rangeEditing.isActivated()) {
                states.rangeEditing.continueSelection(cellLayoutInfo);
            } else if(isCellCaptured()) {
                if(ASPxClientSpreadsheet.ProtectionHelper.canSelectCell(spreadsheetControl, cellLayoutInfo))
                    cellSelectionContinue(states, cellLayoutInfo);
            } else if(isSelectionBorderCaptured()) {
                onSelectionBorderMouseMove(getSelectionInternal(), cellLayoutInfo);
			} else if(isFillHandleCaptured()) {
			    states.fillHandle.setParameters(getSelectionInternal(), cellLayoutInfo);
			    states.fillHandle.refresh();
            }
        }
        
        this.onHeaderEvent = function(evt, isCol, paneType) {
            var gridResizeHelper = spreadsheetControl.getGridResizingHelper(),
                isResizeEnabled = ASPxClientSpreadsheet.ProtectionHelper.isResizingAvailable(spreadsheetControl, isCol) &&
                    this.getEditMode() === ASPxClientSpreadsheet.StateController.Modes.Ready,
                canStartResizing = isResizeEnabled && gridResizeHelper.canStartResizing(evt, isCol, paneType),
                canStartResizingOnMouseMove = isResizeEnabled && gridResizeHelper.isHeaderCaptured();

            if(evt.type === ASPx.TouchUIHelper.touchMouseMoveEventName)
                gridResizeHelper.updateCursor(canStartResizing, isCol, paneType);

            if(evt.type === "dblclick" && canStartResizing)
                onHeaderAutoFit(gridResizeHelper, evt, isCol, paneType);
            else if(gridResizeHelper.isResizing()) {
                onHeaderResizing(gridResizeHelper, evt, isCol, paneType);
            } else if(canStartResizing || canStartResizingOnMouseMove) {
                onHeaderResizingStartStop(gridResizeHelper, evt, isCol, paneType, canStartResizing);
            } else
                onHeaderSelectionEvent(evt, isCol);

            states.mouseMoving.finalize();
            spreadsheetControl.getTouchUIHelper().handleHeaderEvent(evt, isCol);
        };
        function onHeaderAutoFit(gridResizeHelper, evt, isCol, paneType) {
            gridResizeHelper.onDoubleClick(evt, isCol, paneType);
        }
        function onHeaderResizing(gridResizeHelper, evt, isCol, paneType) {
            if(evt.type === ASPx.TouchUIHelper.touchMouseMoveEventName)
                gridResizeHelper.onMouseMove(evt, isCol, paneType);
            else if(evt.type === ASPx.TouchUIHelper.touchMouseUpEventName)
                gridResizeHelper.onMouseUp(evt, isCol, paneType);
        }
        function onHeaderResizingStartStop(gridResizeHelper, evt, isCol, paneType, canStartResizing) {
            if(evt.type === ASPx.TouchUIHelper.touchMouseUpEventName)
                gridResizeHelper.onMouseUp(evt, isCol, paneType);
            else if(canStartResizing && evt.type === ASPx.TouchUIHelper.touchMouseDownEventName)
                gridResizeHelper.onMouseDown(evt, isCol, paneType);
            else if(gridResizeHelper.canStartResizingOnMouseMove(evt, isCol, paneType) && evt.type === ASPx.TouchUIHelper.touchMouseMoveEventName) {
                gridResizeHelper.onMouseMove(evt, isCol, paneType);
            }
        }

        function onHeaderSelectionEvent(evt, isCol) {
            var headerCellElement = ASPx.Evt.GetEventSource(evt);

            if(evt.type == "mouseup" && !ASPx.Browser.MSTouchUI)
                entireRowAllColSelectionStateHelper.onMouseUp(isCol);

            if(!ASPx.ElementHasCssClass(headerCellElement, ASPx.SpreadsheetCssClasses.HeaderCell))  return;
            var cellIndex = spreadsheetControl.getRenderHelper().getHeaderCellElementIndex(headerCellElement, isCol);

            if(evt.type == "mousedown" && !ASPx.Browser.MSTouchUI) {
                onHeaderSelectionMouseDown(evt, cellIndex, isCol);
            } else if(evt.type == "touchstart") {
                ASPx.TouchUIHelper.FastTapHelper.HandleFastTap(evt, function() {
                    onHeaderSelectionFastTap(evt, cellIndex, isCol);
                }, false);
            } else if(ASPx.Browser.MSTouchUI && (evt.type == "click" || evt.type == "contextmenu")) {
                onHeaderSelectionFastTap(evt, cellIndex, isCol);
            } else if(evt.type == "mousemove" && !ASPx.Browser.MSTouchUI) {
                entireRowAllColSelectionStateHelper.onMouseMove(cellIndex, isCol, isMouseMoveNearBorder(evt, isCol));
            }
        }
        function isMouseMoveNearBorder(evt, isCol) {
            var offset = isCol ? evt.offsetX : evt.offsetY,
                style = evt.target.style,
                targetSize = ASPx.PxToInt(isCol ? style.width : style.height);

            return targetSize - offset <= 5;
        }
        function onHeaderSelectionMouseDown(evt, cellIndex, isCol) {
            if(states.editing.canFinalizeEditing()) {
                var leftMouseButton = ASPx.Evt.IsLeftButtonPressed(evt);
                var selection = getSelectionInternal();

                var cellInSelectedRange = selection.range.isCellInRangeCore(cellIndex, isCol);
                var columnIsAlreadySelected = isCol && selection.entireColsSelected && cellInSelectedRange;
                var rowIsAlreadySelected = !isCol && selection.entireRowsSelected && cellInSelectedRange;

                var changeSelection = leftMouseButton || !(columnIsAlreadySelected || rowIsAlreadySelected);

                if(changeSelection) {
                    states.selected.finalize();
                    states.editing.finalize();
                    states.comment.finalize();
                    entireRowAllColSelectionStateHelper.onMouseDown(cellIndex, isCol);
                }
            }
        }
        function onHeaderSelectionFastTap(evt, cellIndex, isCol) {
            onHeaderSelectionMouseDown(evt, cellIndex, isCol);
            showTouchResizeElement(cellIndex, isCol);
            hideTouchSelectionElements(true);
        }
        function showTouchResizeElement(cellIndex, isCol) {
            var gridResizeHelper = spreadsheetControl.getGridResizingHelper();
            gridResizeHelper.showTouchResizeElement(cellIndex, isCol);
        }
        function hideTouchSelectionElements(display) {
            spreadsheetControl.getPaneManager().hideTouchSelectionElements(display);
        }
        
        this.getSelection = function() {
            return getSelectionInternal();
        };
        function getSelectionInternal() {
            return states.selected.getSelection();
        }
        this.getActiveCellModelPosition = function() {
            var selection = getSelectionInternal(),
                cellModelPosition = paneManager.convertVisiblePositionToModelPosition(selection.activeCellColIndex, selection.activeCellRowIndex),
                croppedRange = paneManager.isMergerCellContainsInCroppedRange({ colIndex: selection.activeCellColIndex, rowIndex: selection.activeCellRowIndex });
            if(croppedRange)
                cellModelPosition = croppedRange.topLeftModelCellPostition;
            return cellModelPosition;
        };
        
        this.setSelection = function(selection) {
            if(states.editing.canFinalizeEditing()) {
                states.selected.finalize();
                states.selected.setSelection(selection);
                states.selected.activate();
                states.editing.finalize();
                states.comment.finalize();
                this.ensureTouchSelectionElements();
            }
        };

        this.tryToStopEditing = function() {
            var selection = getSelectionInternal();
            this.setSelection(selection);
        };

        this.canShowTouchSelectionElements = function() {
            return ASPx.Browser.TouchUI && !isDrawingBoxCaptured() && !isCommentCaptured() && !this.isEditingInProgress();
        };

        this.ensureTouchSelectionElements = function() {
            spreadsheetControl.getPaneManager().hideTouchSelectionElements(this.canShowTouchSelectionElements());
        };

        this.setSelectionSilently = function(selection) {
            if(states.editing.canFinalizeEditing()) {
                states.selected.setSelection(selection);
                states.selected.activateSilently();
                states.editing.finalize();
                states.comment.finalize();
            }
        };
        this.updateSelection = function(selection) {
            states.selected.updateSelection(selection);
        };
        
        this.updateSelectionRender = function() {
            states.selected.activate();
        };

        this.cacheSelection = function(){
            states.selected.cacheSelection();
        };
        this.clearSelectionCache = function() {
            states.selected.clearSelectionCache();
        };
        
        this.markCopiedRange = function(commandId) {
            states.copiedRange.finalize();

            var selection = states.selected.getSelection();
            if(!selection.commentBoxElement && !selection.drawingBoxElement) {
                states.copiedRange.setParameters(selection, commandId);
                states.copiedRange.activate();
            }
        };

        this.ensureCopiedRange = function() {
            states.copiedRange.ensureCopiedRange();
        };

        this.clearCopiedRange = function() {
            states.copiedRange.finalize();
        };

        this.onBeforePasteEvent = function() {
            states.copiedRange.processPasteEvent();
            if(states.copiedRange.isCut())
                states.copiedRange.finalize();
        };
        this.getEditMode = function() {
            return states.editing.getEditMode();
        };
        
        this.setEditMode = function(editMode) {
            var cellLayoutInfo = spreadsheetControl.getSelectionActiveCellLayoutInfoInternal();
            if(!canStartEditing(cellLayoutInfo)) return;

            if(editMode === ASPxClientSpreadsheet.StateController.Modes.Enter) {
                startCellEntering(cellLayoutInfo);
            } else if(editMode === ASPxClientSpreadsheet.StateController.Modes.Edit) {
                startCellEditing(cellLayoutInfo);
            } else if(editMode === ASPxClientSpreadsheet.StateController.Modes.RangeEdit) {
                startRangeResizingInternal();
            }
        };
        function startCellEntering(cellLayoutInfo) {
            states.selected.bindToCell( {col: cellLayoutInfo.colIndex, row: cellLayoutInfo.rowIndex} );
            states.selected.activate();
            states.editing.bindToCellLayoutInfo(cellLayoutInfo);
            states.editing.activate(ASPxClientSpreadsheet.StateController.Modes.Enter);
            states.copiedRange.finalize();
        }
        function startCellEditing(cellLayoutInfo, isFormulaBarEditing) {
            if(spreadsheetControl.getStateController().isEditingInProgress() && !states.editing.canFinalizeEditing())
                return;

            var canStartEditing = states.editing.canStartEditing(cellLayoutInfo),
                value = getCellValue(cellLayoutInfo.colIndex, cellLayoutInfo.rowIndex),
                editMode = isFormulaBarEditing ? ASPxClientSpreadsheet.StateController.Modes.FormulaBarEdit :
                value !== null ? ASPxClientSpreadsheet.StateController.Modes.Edit : ASPxClientSpreadsheet.StateController.Modes.Enter;

            if(isFormulaBarEditing && !canStartEditing)
                spreadsheetControl.cellTextViewElement.blur();
            if(ASPx.Browser.TouchUI && alreadyEditing(cellLayoutInfo) || !canStartEditing)
                return;
            if(!isFormulaBarEditing)
                states.selected.bindToCell( {col: cellLayoutInfo.colIndex, row: cellLayoutInfo.rowIndex} );
            states.selected.activate();
            states.editing.bindToCellLayoutInfo(cellLayoutInfo);			
			states.editing.activate(editMode);
            states.copiedRange.finalize();
            spreadsheetControl.getStateController().ensureTouchSelectionElements();
        }
        function getCellValue(visibleColIndex, visibleRowIndex) {
            var selectionHelper = spreadsheetControl.getSelectionHelper(),
                paneManager = spreadsheetControl.getPaneManager(),
                cellRange = new ASPxClientSpreadsheet.Range(visibleColIndex, visibleRowIndex, visibleColIndex, visibleRowIndex),
                editingRange = selectionHelper.ExpandRangeToMergedCellSize(cellRange),
                cellModelPosition = paneManager.convertVisiblePositionToModelPosition(editingRange.leftColIndex, editingRange.topRowIndex);

            var croppedRange = paneManager.isMergerCellContainsInCroppedRange({ colIndex: editingRange.leftColIndex, rowIndex: editingRange.topRowIndex });
            if(croppedRange)
                cellModelPosition = croppedRange.topLeftModelCellPostition;

            return spreadsheetControl.GetCellValue(cellModelPosition.colIndex, cellModelPosition.rowIndex);
        }

        this.startEditingCurrentCellInFormulaBar = function() {
            var selectedCellLayoutInfo = spreadsheetControl.getSelectionActiveCellLayoutInfoInternal();
            startCellEditing(selectedCellLayoutInfo, true);
        };
        function startRangeResizingInternal() {
            states.rangeEditing.activate();
        }
        function alreadyEditing(cellLayoutInfo) {
            return states.editing.cellLayoutInfo &&
                states.editing.cellLayoutInfo.colIndex == cellLayoutInfo.colIndex &&
                states.editing.cellLayoutInfo.rowIndex == cellLayoutInfo.rowIndex;
        }
        
        this.cancelEditing = function() {
            states.editing.cancel();
            states.selected.activate();
        };
        this.cancelEditingSilently = function() {
            states.editing.cancelSilently();
            states.selected.activate();
        };
        this.onEscape = function() {
            if(this.getEditMode() === ASPxClientSpreadsheet.StateController.Modes.Ready) {
                drawingBoxSelectionStateHelper.onEscape();
                states.comment.onEscape();
            } else {
                spreadsheetControl.getValidationHelper().setCurrentlyValidatingCell(null);
                this.cancelEditing();
            }
            spreadsheetControl.updateCellTextViewElementValue();
            this.clearCopiedRange();
        };
        this.selectAll = function() {
            if(this.getEditMode() !== ASPxClientSpreadsheet.StateController.Modes.Ready) return;
            // if(selection.isDrawingBoxSelection()) // TODO select all DrawingBoxes ()
            var selection = this.getSelection().clone();
            selection.selectAll();
            this.setSelection(selection);
        };
        
        this.applyEditingSilently = function() {
            states.editing.apply();
        };

        this.applyEditingWithRaisingEvent = function() {
            // Raise Event for Cell End Edit
            var canFinalizeEditing = states.editing.canFinalizeEditing();
            if(canFinalizeEditing)
                states.editing.apply();

            return canFinalizeEditing;
        };

        this.onCellEditorChanged = function() {
            states.rangeEditing.onCellEditorChanged();
            states.editing.onCellEditorChanged();
        };
        
        this.insertSpecificFunction = function(cellLayoutInfo, name) {
            if(ASPxClientSpreadsheet.Commands.CommandHelper.GetCommandEnabled(spreadsheetControl, ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("InsertFunction").id)) {
                states.editing.bindToCellLayoutInfo(cellLayoutInfo);
                states.editing.insertBuiltInFunction(name);
            }
        };
        ASPxClientSpreadsheet.DocumentModel.SelectionKeys = {
            ActiveColumnIndex: 0,
            ActiveRowIndex: 1,

            LeftColumnIndex: 2,
            TopRowIndex: 3,
            RightColumnIndex: 4,
            BottomRowIndex: 5,

            AllSelected: 6,

            EntireColumnsSelected: 7,
            EntireLeftColumnIndex: 8,
            EntireRightColumnIndex: 9,

            EntireRowsSelected: 10,
            EntireTopRowIndex: 11,
            EntireBottomRowIndex: 12,

            CommentBoxSelected: 13,
            CommentBoxIndex: 14,

            DrawingBoxIndexSelected: 15,
            DrawingBoxIndex: 16
        };
        this.processDocumentResponse = function(responseSelection, isNewSheetLoaded) {
            var selection, activeCellRange;
            if(responseSelection) {
                if(responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.AllSelected] === 1) {
                    selection = new ASPxClientSpreadsheet.Selection();
                    selection.selectAll();
                } else if(responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.DrawingBoxIndexSelected] === 1) {
                    var drawingBoxIndex = responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.DrawingBoxIndex],
                        drawingBoxElement = spreadsheetControl.getDrawingBoxByIndex(drawingBoxIndex),
                        range = new ASPxClientSpreadsheet.Range(responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.LeftColumnIndex],
                            responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.TopRowIndex],
                            responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.RightColumnIndex],
                            responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.BottomRowIndex]);
                    selection = new ASPxClientSpreadsheet.Selection(range, responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.ActiveColumnIndex],
                        responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.ActiveRowIndex]);

                    selection = ASPxClientSpreadsheet.Selection.createFromDrawingBoxIndex(selection, drawingBoxElement, drawingBoxIndex);
                } else if(responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.EntireColumnsSelected] === 1) {
                    selection = new ASPxClientSpreadsheet.Selection();
                    activeCellRange = new ASPxClientSpreadsheet.Range(responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.ActiveColumnIndex],
                        responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.ActiveRowIndex],
                        responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.ActiveColumnIndex],
                        responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.ActiveRowIndex]);
                    selection.selectEntireColumns(responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.EntireLeftColumnIndex],
                        responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.EntireRightColumnIndex], activeCellRange.leftColIndex, activeCellRange.topRowIndex);
                    if(ASPx.Browser.TouchUI)
                        showTouchResizeElement(responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.EntireRightColumnIndex], true);
                } else if(responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.EntireRowsSelected] === 1) {
                    selection = new ASPxClientSpreadsheet.Selection();
                    activeCellRange = new ASPxClientSpreadsheet.Range(responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.ActiveColumnIndex],
                        responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.ActiveRowIndex],
                        responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.ActiveColumnIndex],
                        responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.ActiveRowIndex]);
                    selection.selectEntireRows(responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.EntireTopRowIndex],
                        responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.EntireBottomRowIndex], activeCellRange.leftColIndex, activeCellRange.topRowIndex);
                    if(ASPx.Browser.TouchUI)
                        showTouchResizeElement(responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.EntireBottomRowIndex], false);
                } else {
                    var range = new ASPxClientSpreadsheet.Range(responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.LeftColumnIndex],
                        responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.TopRowIndex],
                        responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.RightColumnIndex],
                        responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.BottomRowIndex]);
                    selection = new ASPxClientSpreadsheet.Selection(range, responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.ActiveColumnIndex],
                        responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.ActiveRowIndex]);
                }

                if(responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.CommentBoxSelected] === 1) {
                    var commentBoxIndex = responseSelection[ASPxClientSpreadsheet.DocumentModel.SelectionKeys.CommentBoxIndex],
                        commentBoxElement = spreadsheetControl.getCommentBoxByIndex(commentBoxIndex);
                    selection = ASPxClientSpreadsheet.Selection.createCommentSelection(selection, commentBoxElement, commentBoxIndex);
                }
            }
            states.selected.ensureSelectionRender(selection);
            if(!isNewSheetLoaded) {
                var needToClearCopiedRange = states.copiedRange.isActivated()
                    && states.copiedRange.isPasteCommandProcessing()
                    && states.copiedRange.intersectsRange(states.selected.getSelection().range);
                if(needToClearCopiedRange) {
                    this.clearCopiedRange();
                    states.copiedRange.onAfterPasteEventProcessed();
                }
                else
                    this.ensureCopiedRange();
                if(ASPx.Browser.TouchUI)
                    spreadsheetControl.getGridResizingHelper().updateTouchResizeElementPos();
            }
        };
        
        this.isEditingInProgress = function(){
            return ASPxClientSpreadsheet.StateController.IsEditingMode(this.getEditMode()) || this.getEditMode() === ASPxClientSpreadsheet.StateController.Modes.Enter;
        };

        this.isCellRangeSelectionInProcess = function() {
            return isCellCaptured();
        };

        this.isCellRangeEditingInProgress = function() {
            return states.rangeEditing.isActivated();
        };
        
        this.isDrawingBoxDragingOrResizingInProcess = function() {
            return isDrawingBoxCaptured();
        };
        this.isCommentBoxDragingOrResizingInProcess = function() {
            return isCommentCaptured();
        };

        this.isSelectionMovementInProcess = function() {
            return isSelectionBorderCaptured();
        };

        this.isFillDataInProcess = function() {
            return isFillHandleCaptured();
        };
        
        this.finializeProcessing = function() {
            releaseCapturedEntity();
        };

        this.isControlBusyToSynchronization = function() {
            return this.isEditingInProgress() || this.isDrawingBoxDragingOrResizingInProcess() || this.isCellRangeEditingInProgress() ||
                this.isSelectionMovementInProcess() || this.isFillDataInProcess() || this.isCommentBoxDragingOrResizingInProcess();
        };
        this.canFinalizeEditing = function() {
            return states.editing.canFinalizeEditing();
        };

        this.startCommentEditing = function(commentBox) {
            states.comment.activate(commentBox);
        };
        this.endCommentEditing = function() {
            var selection = states.selected.getSelection();
            selection = ASPxClientSpreadsheet.Selection.createCommentSelection(selection, null, -1);
            this.setSelectionSilently(selection);
        };
        this.closeCommentEditing = function() {
            states.comment.closeEditing();
        };

        this.onScroll = function() {
            states.comment.onScroll();
        };
        this.isCommentEditingInProgress = function() {
            return states.comment.isActive();
        };
        this.continueEditing = function(cellLayoutInfo) {
            if(states.editing.canFinalizeEditing()) 
                startCellEditing(cellLayoutInfo);
        };
    };

    ASPxClientSpreadsheet.StateController.IsEditingMode = function(editMode) {
        return editMode === ASPxClientSpreadsheet.StateController.Modes.Edit
            || editMode === ASPxClientSpreadsheet.StateController.Modes.FormulaBarEdit;
    };

    ASPxClientSpreadsheet.TouchUIHelper = function(spreadsheetControl) {
        var longTapInterval = (ASPx.Browser.MacOSMobilePlatform) ? 400 : 650;

        this.handleCellEvent = function(evt, cellLayoutInfo) {
            handleEvent(evt, { cellLayoutInfo: cellLayoutInfo });
        };
        this.handleDrawingBoxEvent = function(evt) {
            handleEvent(evt, {});
            hideTouchResizeElement();
        };
        this.handleCommentBoxEvent = function(evt) {
            hideTouchResizeElement();
        };
        this.handleHeaderEvent = function(evt, isCol) {
            handleEvent(evt, { isColumnHeader: isCol });
        };
        this.handleTabEvent = function(evt) {
            handleEvent(evt, { isTabControl: true });
        };
        function handleEvent(evt, context) {
            if(!ASPx.Browser.WebKitTouchUI) return;
            if(ASPx.TouchUIHelper.IsMultiTouchEvent(evt))
                stopHandlingLongTap();
            if(evt.type === ASPx.TouchUIHelper.touchMouseDownEventName)
                handleLongTap(evt, context);
            else if(evt.type === ASPx.TouchUIHelper.touchMouseMoveEventName || evt.type === ASPx.TouchUIHelper.touchMouseUpEventName)
                stopHandlingLongTap();
        }
        function handleLongTap(evt, context) {
            this.longTapTimer = setTimeout(function() {
                if(context.cellLayoutInfo)
                    selectCell(context.cellLayoutInfo);
                if(typeof (context.isColumnHeader) !== "undefined") {
                    var gridResizeHelper = spreadsheetControl.getGridResizingHelper();
                    if(!gridResizeHelper.isResizing())
                        spreadsheetControl.showPopupMenu(evt, { isRowHeader: !context.isColumnHeader, isColumnHeader: context.isColumnHeader, ownerControl: spreadsheetControl });
                }
                else if(context.isTabControl)
                    spreadsheetControl.showTabSelectorContextMenu(evt);
                else
                    spreadsheetControl.onGridContextMenu(evt, context.cellLayoutInfo);
                this.longTapTriggered = true;
            }, longTapInterval);
        }
        function stopHandlingLongTap() {
            clearInterval(this.longTapTimer);
        }
        function handleFastTap(cellLayoutInfo) {
            var stateController = spreadsheetControl.getStateController();
            var isCurrentlyEditing = stateController.isEditingInProgress();
            var selectionChanged = selectCell(cellLayoutInfo);
            var touchEditingHelper = spreadsheetControl.getTouchEditingHelper();
            if(touchEditingHelper.isTouchMobileDevice() && (isCurrentlyEditing || !selectionChanged) && !this.longTapTriggered)
                stateController.continueEditing(cellLayoutInfo);
            if(this.longTapTriggered)
                this.longTapTriggered = false;
        }
        function selectCell(cellLayoutInfo) {
            var selectionChanged = spreadsheetControl.getStateController().cellFastTap(cellLayoutInfo);
            if(ASPx.Browser.TouchUI && selectionChanged) {
                var gridResizeHelper = spreadsheetControl.getGridResizingHelper();
                gridResizeHelper.hideTouchResizeElement();
                spreadsheetControl.getPaneManager().hideTouchSelectionElements(true);
            }
            return selectionChanged;
        }
        function hideTouchResizeElement() {
            if(ASPx.Browser.TouchUI) {
                var gridResizeHelper = spreadsheetControl.getGridResizingHelper();
                gridResizeHelper.hideTouchResizeElement();
            }
        }
        this.onCellFastTap = function(cellLayoutInfo) {
            handleFastTap(cellLayoutInfo);
        };
    };

    ASPxClientSpreadsheet.StateController.Modes = {
        Ready: 0,
        Enter: 1,
        Edit: 2,
        RangeEdit: 3,
        FormulaBarEdit: 4
    };
})();

(function() {
    ASPxClientSpreadsheet.SelectionState = function(spreadsheetControl) {
        var selectionHelper = spreadsheetControl.getSelectionHelper();
        var paneManager = spreadsheetControl.getPaneManager();
        var currentSelection = ASPxClientSpreadsheet.Selection.Default;
        var cachedSelection = null;
        var savedSelection = null;

        var firstCell = { col: -1, row: -1 };

        function setFirstCell(col, row) {
            firstCell.col = col;
            firstCell.row = row;
        }

        var lastCell = { col: -1, row: -1 };

        function setLastCell(col, row) {
            lastCell.col = col;
            lastCell.row = row;
        }

        function moveActiveCellToLeftTop(selection) {
            selection.activeCellColIndex = Math.min(firstCell.col, lastCell.col);
            selection.activeCellRowIndex = Math.min(firstCell.row, lastCell.row);
        }

        this.bindToCell = function(cell) {
            setFirstCell(cell.col, cell.row);
            setLastCell(-1, -1);
            var range = new ASPxClientSpreadsheet.Range(cell.col, cell.row);
            var selection = new ASPxClientSpreadsheet.Selection(range);

            this.setSelection(selection);
        };
        this.bindToLastCell = function(cell) {
            if(firstCell) {
                if(lastCell.col == cell.col && lastCell.row == cell.row)
                    return false;
                setLastCell(cell.col, cell.row);
                if(ASPx.Browser.TouchUI)
                    moveActiveCellToLeftTop(currentSelection);
                currentSelection.range.set(firstCell.col, firstCell.row, lastCell.col, lastCell.row);
            }
            return true;
        };
        this.rebindFirstCellDiagonally = function(rightBottomSelection) {
            if(firstCell && lastCell.col != -1 && lastCell.row != -1) {
                var col = rightBottomSelection ? Math.min(firstCell.col, lastCell.col) : Math.max(firstCell.col, lastCell.col);
                var row = rightBottomSelection ? Math.min(firstCell.row, lastCell.row) : Math.max(firstCell.row, lastCell.row);
                setFirstCell(col, row);
            }
        };

        this.selectDrawingBoxIndex = function(drawingBoxElement, drawingBoxIndex) {
            var selection = ASPxClientSpreadsheet.Selection.createFromDrawingBoxIndex(this.getSelection(), drawingBoxElement, drawingBoxIndex);
            this.setSelection(selection);
        };

        this.selectCommentBox = function(commentBoxElement, commentBoxIndex) {
            var selection = ASPxClientSpreadsheet.Selection.createCommentSelection(this.getSelection(), commentBoxElement, commentBoxIndex);
            selection.selectCommentBox(commentBoxElement, commentBoxIndex);
            this.setSelection(selection);
        };

        /*region State Interfate implementation*/
        this.activate = function() {
            selectionHelper.calcActualCellSelection(currentSelection);
            selectionHelper.setSelection(currentSelection);
            if(this.isSelectionChanged()) {
                if(spreadsheetControl.GetEditMode() === ASPxClientSpreadsheetEditMode.None)
                    paneManager.moveActiveElementToActiveCell(currentSelection);
                spreadsheetControl.DoRaiseSelectionChanged(currentSelection);
            }
            this.clearSavedSelection();
        };
        this.finalize = function() {
            paneManager.hideModelBoxSelection();
        };
        /*endregion*/
        this.isSelectionChanged = function() {
            var selection = this.getSelection(),
                oldSelection = this.getSavedSelection();

            return !(oldSelection && selection.identical(oldSelection));
        };
        this.ensureSelectionRender = function(selection) {
            var replacementSelection = (selection) ? selection : cachedSelection;
            if(!replacementSelection) {
                selectionHelper.renderSelection(currentSelection);
                selectionHelper.notifyOwnerControl();
            }
            else {
                replacementSelection = replacementSelection.getConvertedToVisibleIndices(paneManager, (cachedSelection !== null));
                this.setSelection(replacementSelection);
                this.activate();
                this.clearSelectionCache();
            }
        };
        this.activateSilently = function() {
            selectionHelper.calcActualCellSelection(currentSelection);
            selectionHelper.setSelectionSilently(currentSelection);
        };
        this.getSelection = function() {
            return currentSelection;
        };
        this.setSelection = function(selection) {
            this.saveSelection();
            currentSelection = validateSelection(selection);
            if(firstCell.col === -1 || firstCell.row === -1)
                setFirstCell(selection.activeCellColIndex, selection.activeCellRowIndex);

        };
        // NOTE: use only when you need to update cached HTML elements
        this.updateSelection = function(selection) {
            currentSelection = validateSelection(selection);
        };
        this.cacheSelection = function() {
            var selection = this.getSelection();
            selection = selection.getConvertedToModelIndices(paneManager);
            cachedSelection = selection.clone();
        };
        this.clearSelectionCache = function() {
            cachedSelection = null;
        };

        this.saveSelection = function() {
            var selection = this.getSelection();
            savedSelection = selection.clone();
        };
        this.clearSavedSelection = function() {
            savedSelection = null;
        };
        this.getSavedSelection = function() {
            return savedSelection;
        };

        this.isCellSelected = function(colIndex, rowIndex) {
            return currentSelection.isCellSelected(colIndex, rowIndex);
        };
        function validateSelection(selection) {
            selection.correct();
            return selection;
        }
    };

    ASPxClientSpreadsheet.EditingState = function(spreadsheetControl) {
        var editMode = ASPxClientSpreadsheet.StateController.Modes.Ready;
        var cellLayoutInfo = null;

        this.bindToCellLayoutInfo = function(newCellLayoutInfo) {
            cellLayoutInfo = newCellLayoutInfo;
        };
        this.canStartEditing = function(newCellLayoutInfo) {
            var curCellLayoutInfo = newCellLayoutInfo || cellLayoutInfo;
            if(!curCellLayoutInfo)
                return false;

            return spreadsheetControl.CanEditDocument() && !spreadsheetControl.cellLocked_ByLayoutInfo(curCellLayoutInfo);
        };

        /*region State Interfate implementation*/
        this.activate = function(newEditMode) {
            if(this.canStartEditing()) {
                editMode = newEditMode;
                this.startEditing(newEditMode);
            }
            spreadsheetControl.getDynamicSelectionHelper().attach();
        };
        this.finalize = function() {
            this.apply();
        };
        /*endregion*/
        this.startEditing = function(newEditMode) { // TODO can make it private?
            if(this.canStartEditing()) {
                editMode = newEditMode;
                spreadsheetControl.getEditingHelper().startEditing(cellLayoutInfo, newEditMode);
            }
        };
        this.apply = function() {
            if(bound())
                spreadsheetControl.getEditingHelper().apply(cellLayoutInfo);
            onAfterEditingStoped();
            spreadsheetControl.getDynamicSelectionHelper().detach();
        };
        this.cancel = function() {
            if(!cellLayoutInfo)
                return;
            spreadsheetControl.getValidationHelper().cancelValidation(cellLayoutInfo.colIndex, cellLayoutInfo.rowIndex);
            spreadsheetControl.getEditingHelper().cancelEditing();
            onAfterEditingStoped();
            spreadsheetControl.getDynamicSelectionHelper().detach();
        };
        this.cancelSilently = function() {
            spreadsheetControl.getValidationHelper().cancelValidation(cellLayoutInfo.colIndex, cellLayoutInfo.rowIndex);
            onAfterEditingStoped();
            spreadsheetControl.getDynamicSelectionHelper().detach();
        };
        
        this.getEditMode = function() {
            return editMode;
        };

        this.canFinalizeEditing = function() {
            var inputController = spreadsheetControl.getInputController();
            if(bound() && inputController && inputController.isEditingInProgress())
                return spreadsheetControl.getEditingHelper().raiseCellEndEditEvent(cellLayoutInfo);
            return true;
        };

        this.insertBuiltInFunction = function(functionName) {
            var inputController = spreadsheetControl.getInputController();

            functionName += '()';
            if(inputController.isEditingInProgress()) {
                var globalCaretPosition = inputController.getCaretPosition(),
                    selectionParams = inputController.getNodeByCaretPosition(globalCaretPosition),
                    targetNode = selectionParams.targetNode,
                    caretPosition = selectionParams.caretPosition,
                    nodeValue = targetNode.nodeValue || targetNode.textContent;

                if(nodeValue)
                    nodeValue = [nodeValue.slice(0, caretPosition), functionName, nodeValue.slice(caretPosition)].join('');
                else {
                    nodeValue = "=" + functionName;
                    caretPosition++;
                }

                var newNode = document.createTextNode(nodeValue);
                if(targetNode === inputController.getContentContainer())
                    inputController.getContentContainer().appendChild(newNode);
                else
                    inputController.getContentContainer().replaceChild(newNode, targetNode);

                spreadsheetControl.getEditingHelper().updateInplaceEditingCellElementSize();

                inputController.captureFocus();
                inputController.setCaretPositionToNode(newNode, caretPosition + functionName.length - 1);
            } else {
                var innerText = "=" + functionName;
                this.activate(ASPxClientSpreadsheet.StateController.Modes.Enter);
                inputController.setTextAsHtml(innerText);

                spreadsheetControl.getEditingHelper().updateInplaceEditingCellElementSize();
                inputController.captureFocus();
                if(ASPx.Browser.IE || ASPx.Browser.Edge)
                    window.setTimeout(function() { inputController.setCaretPosition(innerText.length - 1); }, 0);
                else
                    inputController.setCaretPosition(innerText.length - 1);
            }
            inputController.onEditorElementValueChange();
        };

        this.onCellEditorChanged = function() {
            spreadsheetControl.getEditingHelper().onCellEditorChanged();
        };

        function onAfterEditingStoped() {
            editMode = ASPxClientSpreadsheet.StateController.Modes.Ready;
            unbound();
        }

        function bound() {
            return !!cellLayoutInfo;
        }

        function unbound() {
            cellLayoutInfo = null;
        }
    };

    ASPxClientSpreadsheet.RangeEditState = function(spreadsheetControl) {
        var activated = false,
            paneManager = spreadsheetControl.getPaneManager();

        function getDynamicSelectionHelper() {
            return spreadsheetControl.getDynamicSelectionHelper();
        }

        /*region State Interfate implementation*/
        this.activate = function(cellLayoutInfo, rangeEditMode) {
            activated = true;
            cellLayoutInfo.colIndex = paneManager.convertVisibleIndexToModelIndex(cellLayoutInfo.colIndex, true);
            cellLayoutInfo.rowIndex = paneManager.convertVisibleIndexToModelIndex(cellLayoutInfo.rowIndex, false);
            getDynamicSelectionHelper().activate(cellLayoutInfo, rangeEditMode);
        };
        // TODO: activate - deactivate, initialize - finalize.
        this.finalize = function() {
            activated = false;
            getDynamicSelectionHelper().deactivate();
        };
        /*endregion*/

        this.continueSelection = function(cellLayoutInfo) {
            if(activated) {
                cellLayoutInfo.colIndex = paneManager.convertVisibleIndexToModelIndex(cellLayoutInfo.colIndex, true);
                cellLayoutInfo.rowIndex = paneManager.convertVisibleIndexToModelIndex(cellLayoutInfo.rowIndex, false);
                getDynamicSelectionHelper().updateActiveSelection(cellLayoutInfo);
            }
        };

        this.onCellEditorChanged = function() {
            getDynamicSelectionHelper().refresh();
        };

        this.isActivated = function() {
            return activated;
        };
    };

    ASPxClientSpreadsheet.CopiedRangeState = function(spreadsheetControl) {
        var paneManager = spreadsheetControl.getPaneManager();
        var active = false;
        var pasteEventProcessing = false;
        var currentCopiedRange = new ASPxClientSpreadsheet.CopiedRangeSelection(paneManager);

        /*region State Interfate implementation*/
        this.activate = function() {
            active = true;
            currentCopiedRange.render();
        };
        this.finalize = function() {
            active = false;
            pasteEventProcessing = false;
            currentCopiedRange.clear();
        };
        /*endregion*/

        this.setParameters = function(selection, commandId) {
            currentCopiedRange.setParameters(selection, commandId);
        };
        this.ensureCopiedRange = function() {
            if(active)
                currentCopiedRange.render();
        };

        this.isCut = function() {
            return !currentCopiedRange.commandId;
        };

        this.intersectsRange = function(range) {
            return currentCopiedRange.intersectsRange(range);
        };
        this.isActivated = function() {
            return active;
        };
        this.isPasteCommandProcessing = function() {
            return pasteEventProcessing;
        };
        this.processPasteEvent = function() {
            pasteEventProcessing = true;
        };
        this.onAfterPasteEventProcessed = function() {
            pasteEventProcessing = false;
        };
    };

    ASPxClientSpreadsheet.FillHandleState = function(spreadsheetControl) {
        var paneManager = spreadsheetControl.getPaneManager();
        var active = false;
        var fillHandle = new ASPxClientSpreadsheet.FillHandleSelection(paneManager);

        /*region State Interfate implementation*/
        this.activate = function() {
            active = true;
            fillHandle.render();
            disableModelBoxSelecion();
        };
        this.finalize = function() {
            active = false;
            fillHandle.clear();
            enableModelBoxSelection();
        };
        /*endregion*/

        this.refresh = function() {
            fillHandle.clear();
            fillHandle.render();
        };
        this.setParameters = function(selection, cellLayoutInfo) {
            fillHandle.setParameters(selection, cellLayoutInfo);
        };
        this.isFillHandleElement = function(element) {
            return fillHandle.isFillHandleElement(element);
        };
        this.isActivated = function() {
            return active;
        };
        this.getCurrentRange = function() {
            return fillHandle.getCurrentRange();
        };

        function disableModelBoxSelecion() {
            spreadsheetControl.modelBoxStartMovingOrResizing();
        }
        function enableModelBoxSelection() {
            spreadsheetControl.modelBoxEndMovingOrResizing();
        }
    };

    ASPxClientSpreadsheet.MovingSelectionState = function(spreadsheetControl) {
        var paneManager = spreadsheetControl.getPaneManager();
        var active = false;
        var movingSelection = new ASPxClientSpreadsheet.MovingSelection(paneManager);

        /*region State Interfate implementation*/
        this.activate = function() {
            active = true;
        };
        this.finalize = function() {
            active = false;
            movingSelection.clear();
        };
        /*endregion*/
        this.setParameters = function(selection, cellLayoutInfo) {
            movingSelection.setParameters(selection, cellLayoutInfo);
        };
        this.move = function() {
            movingSelection.move();
        };
        this.getCurrentRange = function() {
            return movingSelection.getCurrentRange();
        };
        this.isActivated = function() {
            return active;
        };
    };

    ASPxClientSpreadsheet.CommentState = function(spreadsheetControl) {
        var active = false;
        var activeCommentBox = null;
        var activeCommentIndex = -1;
        var activateCommentBoxEditor = null;
        var resizeRequestSent = false;
        var lockScrollEvent = false;

        this.isActive = function() {
            return isEditingInProgress();
        };
        /*region State Interfate implementation*/
        this.activate = function(commentBox) {
            var commentIndex = this.getOwnerControl().getModelBoxIndex(commentBox);
            if(isEditingInProgress()) {
                if(!isSameCommentInProgress(commentIndex)) {
                    this.finalize();
                    this.activateEditor(commentBox, commentIndex);
                } else {
                    if(isInResizeRequest()) {
                        if(multyPaneMode() && isSameCommentElement(commentBox)) {
                            this.reconnectToCommentBox(commentBox);
                        } else {
                            adjustScrollPosition(commentBox, commentIndex);
                            onWorkbookScrolled(commentBox);
                        }
                    }
                }
            } else
                this.activateEditor(commentBox, commentIndex);
        };
        this.finalize = function() {
            this.apply();
            releaseComment();
        };
        /*endregion*/

        this.onMouseDown = function(evt, element) {
            if(isResizingOrMovingEnabled(evt)) {
                if(ASPx.Browser.WebKitTouchUI)
                    evt.stopPropagation();

                if(this.getOwnerControl().isCommentBoxElement(element)) {
                    var paneType = spreadsheetControl.getPaneManager().getPaneTypeByEvent(evt),
                        pane = spreadsheetControl.getPaneManager().getPaneByType(paneType);
                    element = pane.getDrawingHelper().getModelBoxSelectionElement(true);
                }

                this.resizingHelper = new ASPxClientSpreadsheet.ResizingHelper(this, evt, element);

                startDraggingOrResizing();
            }
        };
        this.onMouseMove = function(evt) {
            if(this.resizingHelper) {
                this.resizingHelper.onMouseMove(evt);
            }
        };
        this.onMouseUp = function(evt) {
            if(this.resizingHelper) {
                this.resizingHelper.onMouseUp(evt);
                var hasChanges = this.resizingHelper.hasChanges(),
                    boxDiff = this.resizingHelper.getChanges();
                this.resizingHelper = null;

                stopDraggingOrResizing(boxDiff);

                if(hasChanges) {
                    var commandArgs = {
                        offsetTop: boxDiff.offsetX,
                        offsetLeft: boxDiff.offsetY,
                        boxWidth: boxDiff.width,
                        boxHeight: boxDiff.height
                    };

                    var commentValue = getCurrentCommentValue(),
                        oldValue = this.getCommentByBox(activeCommentBox);

                    if(commentValue !== oldValue)
                        commandArgs.Value = commentValue;

                    startResizeRequest();
                    ASPxClientSpreadsheet.ServerCommands.CommentMoveAndResize(this.getOwnerControl(), commandArgs);
                }
            }
        };
        this.onEscape = function() {
            if(this.resizingHelper) {
                this.resizingHelper.onEscape();
                this.resizingHelper = null;
            }
        };
        this.isResizingProportional = function(evt) {
            return evt.shiftKey;
        };

        this.activateEditor = function(commentBox, commentIndex) {
            captureComment(commentBox, commentIndex);

            adjustScrollPosition(commentBox, commentIndex);
            highlightCommentSelection(commentBox, commentIndex);

            beginEditing(commentBox);
            focus(commentBox);
        };
        this.apply = function() {
            if(!isEditingInProgress()) return;
            ensureCommentBox();

            var commentValue = getCurrentCommentValue(),
                oldValue = this.getCommentByBox(activeCommentBox);

            removeSelectionHighlight(activeCommentBox);
            endEditing(activeCommentBox);
            ASPx.Selection.Clear();

            if(oldValue !== commentValue) {
                spreadsheetControl.onUICommand(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("CommentEdit").id,
                    {
                        Value: commentValue,
                        Index: activeCommentIndex
                    }
                );
            }
            this.getOwnerControl().getInputController().captureFocus();

        };
        this.getCommentByBox = function(commentBox) {
            var rowIndex = parseInt(ASPx.Attr.GetAttribute(commentBox, "r")),
                colIndex = parseInt(ASPx.Attr.GetAttribute(commentBox, "c"));

            return spreadsheetControl.GetCellComment(colIndex, rowIndex);
        };

        this.closeEditing = function() {
            if(isEditingInProgress()) {
                removeSelectionHighlight(activeCommentBox);
                endEditing(activeCommentBox);
                ASPx.Selection.Clear();
            }
            this.getOwnerControl().getInputController().captureFocus();
            releaseComment();
        };

        this.reconnectToCommentBox = function(commentBox) {
            this.closeEditing();
            this.activate(commentBox);
        };

        // Resiznig helper state implementation
        this.getOwnerControl = function() {
            return spreadsheetControl;
        };
        this.isMovingStarted = function(targetElement) {
            return ASPx.ElementHasCssClass(targetElement, "dxss-cbse");
        };
        this.isResizingStarted = function(targetElement) {
            return ASPx.ElementHasCssClass(targetElement.parentNode, "dxss-cbse");
        };

        this.onScroll = function() {
            if(isOnScrollEventLocked()) {
                endProgrammaticallyWorkbookScrolling();
                return;
            }
            if(isEditingInProgress()) {
                if(multyPaneMode()) {
                    onWorkbookScrolled(activeCommentBox);
                }
                if(isCommentBoxPartialVisible()) {
                    this.finalize();
                    restoreSelection();
                }
            }
        };

        // Comment edtiting strategy
        function beginEditing(commentBox) {
            if(multyPaneMode()) {
                placeElementToWorkbook(commentBox);
            }
        }
        function endEditing(commentBox) {
            if(multyPaneMode()) {
                var inplaceCommentEditor = getInplaceCommentEditor(commentBox),
                    container = inplaceCommentEditor.parentNode;

                ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(inplaceCommentEditor, commentBox);
                if(ASPx.ElementContainsCssClass(container, ASPx.SpreadsheetCssClasses.CommentBoxTemporaryElement))
                    ASPx.RemoveElement(container);

                ASPx.Attr.RemoveAttribute(inplaceCommentEditor.style, "top");
                ASPx.Attr.RemoveAttribute(inplaceCommentEditor.style, "left");
                ASPx.Attr.RemoveAttribute(inplaceCommentEditor.style, "width");
                ASPx.Attr.RemoveAttribute(inplaceCommentEditor.style, "height");
            }
        }
        function placeElementToWorkbook(commentBox) {
            var inplaceEditor = getInplaceCommentEditor(commentBox),
                offsetElement = commentBox.parentNode,
                workbook = spreadsheetControl.getRenderHelper().getWorkbookControl(),
                offsetSize = ASPx.GetLeftRightBordersAndPaddingsSummaryValue(commentBox) / 2,
                offsetX = ASPx.PxToInt(commentBox.style.left) + offsetSize,
                offsetY = ASPx.PxToInt(commentBox.style.top) + offsetSize,
                width = inplaceEditor.offsetWidth,
                height = inplaceEditor.offsetHeight,
                rect = { x: offsetX, y: offsetY, width: width, height: height };

            var container = createEditorBox();
            container.appendChild(inplaceEditor);

            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(container, workbook);
            ASPx.SetElementDisplay(container, true);
            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRectWithElementOffset(container, rect, offsetElement);
        }
        function onWorkbookScrolled(commentBox) {
            var inplaceEditor = getInplaceCommentEditor(commentBox),
                offsetElement = commentBox.parentNode,
                offsetSize = ASPx.GetLeftRightBordersAndPaddingsSummaryValue(commentBox) / 2,
                offsetX = ASPx.PxToInt(commentBox.style.left) + offsetSize,
                offsetY = ASPx.PxToInt(commentBox.style.top) + offsetSize,
                width = inplaceEditor.offsetWidth,
                height = inplaceEditor.offsetHeight,
                rect = { x: offsetX, y: offsetY, width: width, height: height };

            var container = inplaceEditor.parentNode;
            if(ASPx.ElementContainsCssClass(container, ASPx.SpreadsheetCssClasses.CommentBoxTemporaryElement))
                ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRectWithElementOffset(container, rect, offsetElement);

            focus(commentBox);
        }

        // End-user events
        function startDraggingOrResizing() {
            if(multyPaneMode() && activateCommentBoxEditor) {
                activateCommentBoxEditor.style.pointerEvents = "none";
                if(activateCommentBoxEditor.parentNode && ASPx.ElementContainsCssClass(activateCommentBoxEditor.parentNode, ASPx.SpreadsheetCssClasses.CommentBoxTemporaryElement))
                    activateCommentBoxEditor.parentNode.style.pointerEvents = "none";
            }
        }
        function stopDraggingOrResizing(boxDiff) {
            if(multyPaneMode() && activateCommentBoxEditor) {
                ensureCommentBox();

                var minBoxSize = 2,
                    borderSize = ASPx.GetLeftRightBordersAndPaddingsSummaryValue(activeCommentBox),
                    conainer = activateCommentBoxEditor.parentNode,
                    top = ASPx.PxToInt(conainer.style.top) + boxDiff.offsetY,
                    left = ASPx.PxToInt(conainer.style.left) + boxDiff.offsetX,
                    width = boxDiff.width - borderSize > minBoxSize ? boxDiff.width - borderSize : minBoxSize,
                    height = boxDiff.height - borderSize > minBoxSize ? boxDiff.height - borderSize : minBoxSize;

                ASPx.SetStyles(conainer, { left: left, top: top, width: width, height: height });

                ASPx.Attr.RemoveAttribute(activateCommentBoxEditor.style, "pointer-events");
                if(activateCommentBoxEditor.parentNode && ASPx.ElementContainsCssClass(activateCommentBoxEditor.parentNode, ASPx.SpreadsheetCssClasses.CommentBoxTemporaryElement))
                    ASPx.Attr.RemoveAttribute(activateCommentBoxEditor.parentNode.style, "pointer-events");
            }
        }

        // Scroll positions
        function adjustScrollPosition(commentBox, commentIndex) {
            endResizeRequest();

            var scrollHelper = spreadsheetControl.getPaneManager().getScrollHelper(),
                paneManager = spreadsheetControl.getPaneManager(),
                commentViewOptions = paneManager.getCommentViewOptions(commentIndex);

            if(commentViewOptions) {
                var scrollAnchorCellLayoutInfo = paneManager.getPaneTopLeftCellLayoutInfo(commentViewOptions.paneType),
                    gridContainer = spreadsheetControl.getRenderHelper().getGridContainer(commentViewOptions.paneType),
                    commentBoxRect = { x: commentBox.offsetLeft, y: commentBox.offsetTop, width: commentBox.offsetWidth, height: commentBox.offsetHeight };

                if(scrollAnchorCellLayoutInfo.tileInfo.colIndex !== commentViewOptions.tileInfo.colIndex)
                    commentBoxRect.x += scrollHelper.getAdditionalCorrectSize(scrollAnchorCellLayoutInfo.tileInfo, commentViewOptions.tileInfo, true);
                if(scrollAnchorCellLayoutInfo.tileInfo.rowIndex !== commentViewOptions.tileInfo.rowIndex)
                    commentBoxRect.y += scrollHelper.getAdditionalCorrectSize(scrollAnchorCellLayoutInfo.tileInfo, commentViewOptions.tileInfo, false);

                var horizontalScrollDirection = commentBoxRect.x >= scrollAnchorCellLayoutInfo.rect.x ? "right" : "left",
                    verticalScrollDirection = commentBoxRect.y >= scrollAnchorCellLayoutInfo.rect.y ? "bottom" : "top";

                var xCorrection = 0,
                    yCorrection = 0;

                if(horizontalScrollDirection === "right")
                    xCorrection = commentBoxRect.x - scrollAnchorCellLayoutInfo.rect.x + commentBoxRect.width - gridContainer.clientWidth;
                else
                    xCorrection = scrollAnchorCellLayoutInfo.rect.x - commentBoxRect.x;

                if(verticalScrollDirection === "bottom")
                    yCorrection = commentBoxRect.y - scrollAnchorCellLayoutInfo.rect.y + commentBoxRect.height - gridContainer.clientHeight;
                else
                    yCorrection = scrollAnchorCellLayoutInfo.rect.y - commentBoxRect.y;

                if(xCorrection > 0 || yCorrection > 0) {
                    var hScrollOptions = { required: xCorrection > 0, direction: horizontalScrollDirection },
                        vScrollOptions = { required: yCorrection > 0, direction: verticalScrollDirection };

                    startProgrammaticallyWorkbookScrolling();
                    scrollHelper.correctScrollPostitions({ width: xCorrection, height: yCorrection }, hScrollOptions, vScrollOptions);
                }
            }
        }
        function isCommentBoxPartialVisible() {
            var scrollHelper = spreadsheetControl.getPaneManager().getScrollHelper(),
                paneManager = spreadsheetControl.getPaneManager(),
                commentViewOptions = paneManager.getCommentViewOptions(activeCommentIndex);

            if(commentViewOptions) {
                var scrollAnchorCellLayoutInfo = paneManager.getPaneTopLeftCellLayoutInfo(commentViewOptions.paneType),
                    gridContainer = spreadsheetControl.getRenderHelper().getGridContainer(commentViewOptions.paneType),
                    commentBoxRect = { x: activeCommentBox.offsetLeft, y: activeCommentBox.offsetTop, width: activeCommentBox.offsetWidth, height: activeCommentBox.offsetHeight };

                if(scrollAnchorCellLayoutInfo.tileInfo.colIndex !== commentViewOptions.tileInfo.colIndex)
                    commentBoxRect.x += scrollHelper.getAdditionalCorrectSize(scrollAnchorCellLayoutInfo.tileInfo, commentViewOptions.tileInfo, true);
                if(scrollAnchorCellLayoutInfo.tileInfo.rowIndex !== commentViewOptions.tileInfo.rowIndex)
                    commentBoxRect.y += scrollHelper.getAdditionalCorrectSize(scrollAnchorCellLayoutInfo.tileInfo, commentViewOptions.tileInfo, false);

                var horizontalScrollDirection = commentBoxRect.x >= scrollAnchorCellLayoutInfo.rect.x ? "right" : "left",
                    verticalScrollDirection = commentBoxRect.y >= scrollAnchorCellLayoutInfo.rect.y ? "bottom" : "top";

                var xCorrection = 0,
                    yCorrection = 0;

                if(horizontalScrollDirection === "right")
                    xCorrection = commentBoxRect.x - scrollAnchorCellLayoutInfo.rect.x + commentBoxRect.width - gridContainer.clientWidth;
                else
                    xCorrection = scrollAnchorCellLayoutInfo.rect.x - commentBoxRect.x;

                if(verticalScrollDirection === "bottom")
                    yCorrection = commentBoxRect.y - scrollAnchorCellLayoutInfo.rect.y + commentBoxRect.height - gridContainer.clientHeight;
                else
                    yCorrection = scrollAnchorCellLayoutInfo.rect.y - commentBoxRect.y;

                return xCorrection > 0 || yCorrection > 0;
            }
            return false;
        }
        // Private members
        function highlightCommentSelection(commentBox) {
            var rowIndex = parseInt(ASPx.Attr.GetAttribute(commentBox, "r")),
                colIndex = parseInt(ASPx.Attr.GetAttribute(commentBox, "c"));

            if(multyPaneMode()) {
                var activePanes = spreadsheetControl.getPaneManager().getActivePanes();
                for(var paneType in activePanes)
                    if(activePanes.hasOwnProperty(paneType) && activePanes[paneType]) {
                        var parentContainer = spreadsheetControl.getRenderHelper().getGridContainer(paneType),
                            commentBoxElementId = spreadsheetControl.getRenderHelper().getCommentElementId(rowIndex, colIndex, paneType),
                            connectionLineElementId = spreadsheetControl.getRenderHelper().getConnectionLineElementId(rowIndex, colIndex, paneType),
                            commentBoxElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(parentContainer, commentBoxElementId),
                            connectionLineElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(parentContainer, connectionLineElementId);
                        if(commentBoxElement && !ASPx.ElementContainsCssClass(commentBoxElement, "highlighted"))
                            ASPx.AddClassNameToElement(commentBoxElement, "highlighted");
                        if(connectionLineElement && !ASPx.ElementContainsCssClass(connectionLineElement, "highlighted"))
                            ASPx.AddClassNameToElement(connectionLineElement, "highlighted");
                    }
            } else {
                var paneType = spreadsheetControl.getPaneManager().getPaneTypeByCell({ col: colIndex, row: rowIndex }),
                    connectionLineElementId = spreadsheetControl.getRenderHelper().getConnectionLineElementId(rowIndex, colIndex, paneType),
                    connectionLineElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(commentBox.parentNode, connectionLineElementId);
                if(!ASPx.ElementContainsCssClass(commentBox, "highlighted"))
                    ASPx.AddClassNameToElement(commentBox, "highlighted");
                if(connectionLineElement && !ASPx.ElementContainsCssClass(connectionLineElement, "highlighted"))
                    ASPx.AddClassNameToElement(connectionLineElement, "highlighted");
            }
        }
        function removeSelectionHighlight(commentBox) {
            var rowIndex = parseInt(ASPx.Attr.GetAttribute(commentBox, "r")),
                colIndex = parseInt(ASPx.Attr.GetAttribute(commentBox, "c"));

            var activePanes = spreadsheetControl.getPaneManager().getActivePanes();
            for(var paneType in activePanes)
                if(activePanes.hasOwnProperty(paneType) && activePanes[paneType]) {
                    var parentContainer = spreadsheetControl.getRenderHelper().getGridContainer(paneType),
                        commentBoxElementId = spreadsheetControl.getRenderHelper().getCommentElementId(rowIndex, colIndex, paneType),
                        connectionLineElementId = spreadsheetControl.getRenderHelper().getConnectionLineElementId(rowIndex, colIndex, paneType),
                        commentBoxElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(parentContainer, commentBoxElementId),
                        connectionLineElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(parentContainer, connectionLineElementId);

                    if(commentBoxElement && ASPx.ElementContainsCssClass(commentBoxElement, "highlighted"))
                        ASPx.RemoveClassNameFromElement(commentBoxElement, "highlighted");
                    if(connectionLineElement && ASPx.ElementContainsCssClass(connectionLineElement, "highlighted"))
                        ASPx.RemoveClassNameFromElement(connectionLineElement, "highlighted");
                }
        }
        function getInplaceCommentEditor(commentBox) {
            var commentBoxEditor = commentBox.childNodes[0];
            if(!commentBoxEditor)
                commentBoxEditor = activateCommentBoxEditor;
            return commentBoxEditor;
        }
        function isEditingInProgress() {
            return active;
        }
        function captureComment(commentBox, index) {
            activeCommentBox = commentBox;
            activeCommentIndex = index;
            activateCommentBoxEditor = getInplaceCommentEditor(activeCommentBox);
            active = true;
        }
        function releaseComment() {
            activeCommentBox = null;
            activeCommentIndex = -1;
            activateCommentBoxEditor = null;
            active = false;
        }
        function isSameCommentInProgress(commentIndex) {
            return commentIndex === activeCommentIndex;
        }
        function isSameCommentElement(commentBox) {
            return activeCommentBox && commentBox.id !== activeCommentBox.id;
        }
        function isResizingOrMovingEnabled(evt) {
            var eventSource = ASPx.Evt.GetEventSource(evt);
            return !(eventSource && ASPx.ElementHasCssClass(eventSource, ASPx.SpreadsheetCssClasses.CommentEditorElement));
        }
        function multyPaneMode() {
            var paneManager = spreadsheetControl.getPaneManager();
            return paneManager.isControlFrozen();
        }
        function ensureCommentBox() {
            var commentBoxExist = activeCommentBox && activeCommentBox.parentNode;
            if(!commentBoxExist) {
                activeCommentBox = spreadsheetControl.getCommentBoxByIndex(activeCommentIndex);
                captureComment(activeCommentBox, activeCommentIndex);
            }
        }
        function restoreSelection() {
            var stateController = spreadsheetControl.getStateController(),
                selection = stateController.getSelection().clone();

            selection = ASPxClientSpreadsheet.Selection.createFromDrawingBoxIndex(selection, null, -1);
            stateController.setSelection(selection);
        }
        function createEditorBox() {
            var container = document.createElement("DIV");
            container.className = ASPx.SpreadsheetCssClasses.CommentBoxTemporaryElement;

            return container;
        }
        function focus(commentBox) {
            var commentEditingElement = getInplaceCommentEditor(commentBox);
            if(commentEditingElement) {
                ASPx.SetFocus(commentEditingElement);
                ASPx.Selection.SetCaretPosition(commentEditingElement);
            }
        }
        // Scroll event
        function startProgrammaticallyWorkbookScrolling() {
            lockScrollEvent = true;
        }
        function endProgrammaticallyWorkbookScrolling() {
            lockScrollEvent = false;
        }
        function isOnScrollEventLocked() {
            return lockScrollEvent;
        }
        // Resize request
        function startResizeRequest() {
            resizeRequestSent = true;
        }
        function endResizeRequest() {
            resizeRequestSent = false;
        }
        function isInResizeRequest() {
            return resizeRequestSent;
        }

        function getCurrentCommentValue() {
            //ensureCommentBox();
            var commentEditor = getInplaceCommentEditor(activeCommentBox);
            return commentEditor.value.replace(/\n/g, '\r\n');
        }
    };

    ASPxClientSpreadsheet.MouseMovingState = function(spreadsheetControl) {
        var captureCommentCell = null,
            lastFocusedCell = null,
            timerList = {};

        /*region State Interfate implementation*/
        this.activate = function(cellLayoutInfo, paneType) {
            this.onCommentCellMouseMove(cellLayoutInfo, paneType);
        };
        this.finalize = function(cellLayoutInfo) {
            if(isCommentCellCaptured()) {
                if(!cellLayoutInfo || !isSameCommentCellCaptured(cellLayoutInfo.colModelIndex, cellLayoutInfo.rowModelIndex))
                    releaseCommentCell();
            } else
                clearShowingTimer();
        };
        /*endregion*/

        this.getCommentShowingDelay = function() {
            return 800;
        };
        this.onCommentCellMouseMove = function(cellLayoutInfo, paneType) {
            var paneManager = spreadsheetControl.getPaneManager(),
                range = paneManager.getSelectionHelper().ExpandRangeToMergedCellSize(new ASPxClientSpreadsheet.Range(cellLayoutInfo.colModelIndex, cellLayoutInfo.rowModelIndex)),
                colModelIndex = range.leftColIndex,
                rowModelIndex = range.topRowIndex,
                commentInfo = paneManager.getCommentInfo(colModelIndex, rowModelIndex);

            lastFocusedCell = { col: colModelIndex, row: rowModelIndex, paneType: paneType };

            if(isCommentCellCaptured()) {
                if(!isSameCommentCellCaptured(colModelIndex, rowModelIndex))
                    releaseCommentCell();
            } else if(commentInfo && !commentInfo.V) {
                var key = colModelIndex + "|" + rowModelIndex + paneType;
                if(!timerList[key]) {
                    timerList[key] = true;
                    window.setTimeout(function() { this.showCommenBoxtWithDelay(colModelIndex, rowModelIndex, commentInfo, paneType); }.aspxBind(this), this.getCommentShowingDelay());
                }
            }
        };
        this.showCommenBoxtWithDelay = function(colModelIndex, rowModelIndex, commentInfo, paneType) {
            var key = colModelIndex + "|" + rowModelIndex + paneType;
            timerList[key] = null;
            if(cellsAreEqual(lastFocusedCell, { col: colModelIndex, row: rowModelIndex })) {
                showCommentBox(colModelIndex, rowModelIndex, commentInfo, paneType);
            }
        };

        // Helpers
        function showCommentBox(colModelIndex, rowModelIndex, commentInfo, paneType) {
            changeCommentBoxDisplayOnMouseMove(colModelIndex, rowModelIndex, "");
            captureOnCommentCell(paneType, colModelIndex, rowModelIndex);
        }
        function changeCommentBoxDisplayOnMouseMove(columnIndex, rowIndex, display) {
            var activePanes = spreadsheetControl.getPaneManager().getActivePanes();
            for(var paneType in activePanes)
                if(activePanes.hasOwnProperty(paneType) && activePanes[paneType]) {
                    var parentContainer = spreadsheetControl.getRenderHelper().getGridTilesContainer(paneType),
                        connectionLineElementId = spreadsheetControl.getRenderHelper().getConnectionLineElementId(rowIndex, columnIndex, paneType),
                        connectionLineElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(parentContainer, connectionLineElementId),
                        commentElementId = spreadsheetControl.getRenderHelper().getCommentElementId(rowIndex, columnIndex, paneType),
                        commentElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(parentContainer, commentElementId);
                    if(connectionLineElement || commentElement) {
                        ASPx.SetStyles(commentElement, { display: display });
                        ASPx.SetStyles(connectionLineElement, { display: display });
                    }
                }
        }
        function captureOnCommentCell(paneType, columnIndex, rowIndex) {
            captureCommentCell = { col: columnIndex, row: rowIndex, paneType: paneType };
        }
        function releaseCommentCell() {
            var rowIndex = captureCommentCell.row,
                columnIndex = captureCommentCell.col;
            changeCommentBoxDisplayOnMouseMove(columnIndex, rowIndex, "none");
            captureCommentCell = null;
            clearShowingTimer();
        }
        function isCommentCellCaptured() {
            return !!captureCommentCell;
        }
        function isSameCommentCellCaptured(colIndex, rowIndex) {
            return cellsAreEqual(captureCommentCell, { col: colIndex, row: rowIndex });
        }
        function cellsAreEqual(cell1, cell2) {
            return cell1 && cell2 && cell1.col === cell2.col && cell1.row === cell2.row;
        }
        function clearShowingTimer() {
            lastFocusedCell = null;
        }
    };
})();

(function() {
    ASPxClientSpreadsheet.ResponseStringKeys = {
        ActiveSheetId: 0,
        BorderStyle: 1,
        PaperKind: 2,
        PageMargins: 3,
        PageOrientation: 4,
        Calculation: 5,
        Modified: 6,
        HasSourceToSave: 7,
        NewSheetLoading: 8,
        ClearClientCache: 9,
        RibbonUpdate: 10,
        History: 11,
        CellSizes: 12,
        LastFilledCell: 13,
        ExpiredTiles: 14,
        ScrollAnchor: 15,
        HeaderOffset: 16,
        PrintOptions: 17,
        Selection: 18,
        PivotTable: 19,
        ShowDialog: 20,
        PivotTableFields: 21,
        PivotTableAutofilters: 22,
        CommandId: 23
    };

    ASPxClientSpreadsheet.DocumentModel.BorderLineStyle = {
        None: 0,
        Thin: 1,
        Medium: 2,
        Dashed: 3,
        Dotted: 4,
        Thick: 5,
        Double: 6,
        Hair: 7,
        MediumDashed: 8,
        DashDot: 9,
        MediumDashDot: 10,
        DashDotDot: 11,
        MediumDashDotDot: 12,
        SlantDashDot: 13
    };

    ASPxClientSpreadsheet.DocumentModel.PaperKind = {
        Custom: 0,
        Letter: 1,
        LetterSmall: 2,
        Tabloid: 3,
        Ledger: 4,
        Legal: 5,
        Statement: 6,
        Executive: 7,
        A3: 8,
        A4: 9,
        A4Small: 10,
        A5: 11,
        B5: 13,
        B4: 12,
        Folio: 14,
        Quarto: 15,
        Standard10x14: 16,
        Standard11x17: 17,
        Note: 18
    };

    ASPxClientSpreadsheet.DocumentModel.CalculationMode = {
        AutomaticExceptTables: 0,
        Manual: 1,
        Automatic: 2
    };

    ASPxClientSpreadsheet.DocumentModel.PageOrientation = {
        Default: 0,
        Portrait: 1,
        Landscape: 2
    };

    ASPxClientSpreadsheet.DocumentModel.PageMargin = {
        Normal: 0,
        Wide: 1,
        Narrow: 2,
        Custom: 3
    };

    ASPxClientSpreadsheet.DocumentModel.History = {
        Undo: 0,
        Redo: 1
    };

    ASPxClientSpreadsheet.DocumentModel.Sizes = {
        Width: 0,
        Height: 1
    };

    ASPxClientSpreadsheet.DocumentModel.CellStringKeys = {
        Column: 0,
        Row: 1
    };

    ASPxClientSpreadsheet.DocumentModel.PrintOptions = {
        GridLines: 0,
        Headings: 1
    };

    ASPxClientSpreadsheet.DocumentModel.SelectionKeys = {
        ActiveColumnIndex: 0,
        ActiveRowIndex: 1,

        LeftColumnIndex: 2,
        TopRowIndex: 3,
        RightColumnIndex: 4,
        BottomRowIndex: 5,

        AllSelected: 6,

        EntireColumnsSelected: 7,
        EntireLeftColumnIndex: 8,
        EntireRightColumnIndex: 9,

        EntireRowsSelected: 10,
        EntireTopRowIndex: 11,
        EntireBottomRowIndex: 12,

        CommentBoxSelected: 13,
        CommentBoxIndex: 14,

        DrawingBoxIndexSelected: 15,
        DrawingBoxIndex: 16
    };

    ASPxClientSpreadsheet.DocumentModel.PivotFilterType = {
        Unknown: 0,
        Count: 1,
        Percent: 2,
        Sum: 3,
        CaptionEqual: 4,
        CaptionNotEqual: 5,
        CaptionBeginsWith: 6,
        CaptionNotBeginsWith: 7,
        CaptionEndsWith: 8,
        CaptionNotEndsWith: 9,
        CaptionContains: 10,
        CaptionNotContains: 11,
        CaptionGreaterThan: 12,
        CaptionGreaterThanOrEqual: 13,
        CaptionLessThan: 14,
        CaptionLessThanOrEqual: 15,
        CaptionBetween: 16,
        CaptionNotBetween: 17,
        ValueEqual: 18,
        ValueNotEqual: 19,
        ValueGreaterThan: 20,
        ValueGreaterThanOrEqual: 21,
        ValueLessThan: 22,
        ValueLessThanOrEqual: 23,
        ValueBetween: 24,
        ValueNotBetween: 25,
        DateEqual: 26,
        DateOlderThan: 27,
        DateNewerThan: 28,
        DateBetween: 29,
        Tomorrow: 30,
        Today: 31,
        Yesterday: 32,
        NextWeek: 33,
        ThisWeek: 34,
        LastWeek: 35,
        NextMonth: 36,
        ThisMonth: 37,
        LastMonth: 38,
        NextQuarter: 39,
        ThisQuarter: 40,
        LastQuarter: 41,
        NextYear: 42,
        ThisYear: 43,
        LastYear: 44,
        YearToDate: 45,
        FirstQuarter: 46,
        SecondQuarter: 47,
        ThirdQuarter: 48,
        FourthQuarter: 49,
        January: 50,
        February: 51,
        March: 52,
        April: 53,
        May: 54,
        June: 55,
        July: 56,
        August: 57,
        September: 58,
        October: 59,
        November: 60,
        December: 61,
        DateNotEqual: 62,
        DateOlderThanOrEqual: 63,
        DateNewerThanOrEqual: 64,
        DateNotBetween: 65
    };

    ASPxClientSpreadsheet.DocumentModel.PivotField.FilterState = {
        None: 0,
        LabelFilter: 1,
        ValueFilter: 2
    };

    ASPxClientSpreadsheet.DocumentModel.SortTypeField = {
        Ascending: 0,
        Descending: 1,
        Manual: 2
    };

    ASPxClientSpreadsheet.DocumentModel.ColumnType = {
        Text: 1,
        Number: 2,
        Date: 4
    };

    ASPxClientSpreadsheet.InplaceEditorHelper = (function() {
        var InplaceEditorHelper = {},
            activeCell = null,
            activeEditor = null,
            activeSpreadsheet = null;

        var selectionChangedEvent = function(s, e) { onSpreadsheetSelectionChanged(s, e); },
            valueChangedEvent = function(s, e) { editorValueChanged(s, e); },
            keyDownEvent = function(s, e) { onCustomEditorKeyDown(s, e); },
            keyUpEvent = function(s, e) { onCustomEditorKeyUp(s, e); },
            gotFocusEvent = function(s, e) { onCustomEditorGotFocus(s, e); };


        InplaceEditorHelper.AssignEditor = function(spreadsheet, customEditor, eventArgs) {
            captureCell(eventArgs);
            captureParams(spreadsheet, customEditor);

            var activeCellRect = activeSpreadsheet.GetCellBounds(eventArgs.columnIndex, eventArgs.rowIndex);
            showInplaceEditor(eventArgs.value, activeCellRect);
        };

        // Events
        function subscribeEvents() {
            activeSpreadsheet.SelectionChanged.AddHandler(selectionChangedEvent);
            activeEditor.ValueChanged.AddHandler(valueChangedEvent);
            activeEditor.KeyDown.AddHandler(keyDownEvent);
            activeEditor.KeyUp.AddHandler(keyUpEvent);
            activeEditor.GotFocus.AddHandler(gotFocusEvent);
        }
        function unsubscribeEvents() {
            activeSpreadsheet.SelectionChanged.RemoveHandler(selectionChangedEvent);
            activeEditor.ValueChanged.RemoveHandler(valueChangedEvent);
            activeEditor.KeyDown.RemoveHandler(keyDownEvent);
            activeEditor.KeyUp.RemoveHandler(keyUpEvent);
            activeEditor.GotFocus.RemoveHandler(gotFocusEvent);
        }

        function editorValueChanged(s, args) {
            applyEditing(s);            
        }
        function onCustomEditorKeyDown(s, args) {
            if(ASPx.Key.Esc == args.htmlEvent.keyCode) {
                stopEditing();
            }
        }
        function onCustomEditorKeyUp(s, args) {
            if(activeEditor && ASPx.Key.Enter == args.htmlEvent.keyCode)
                applyEditing(s);
        }
        function onSpreadsheetSelectionChanged(spreadsheet, args) {
            if(activeCell) {
                var selection = args.selection;
                if(activeCell.columnIndex !== selection.activeCellColumnIndex || activeCell.rowIndex !== selection.activeCellRowIndex) {
                    stopEditing();
                }
            }
        }
        function onCustomEditorGotFocus(s, e) {
            var inplaceEditorValue = activeSpreadsheet.GetCellEditorText(),
                inputElement = s.GetInputElement();

            adjustEditor(s);

            if(inputElement) {                
                inputElement.value = inplaceEditorValue;
                window.setTimeout(function() {
                    ASPx.Selection.SetCaretPosition(inputElement);
                }, 0);
            }
        }
        function getEditorValue(editor) {
            return editor.GetText ? editor.GetText() : editor.GetValue();
        }

        // Editing
        function applyEditing(editor) {
            var value = getEditorValue(editor);
            editor.SetVisible(false);
            commitValue(value);
        }
        function commitValue(value) {
            activeSpreadsheet.SetCellEditorText(value);
            activeSpreadsheet.ApplyCellEdit();
            activeSpreadsheet.Focus();
            releaseCell();
            releaseParams();
        }
        function stopEditing() {
            releaseCell();

            activeEditor.SetVisible(false);
            activeSpreadsheet.Focus();
            activeSpreadsheet.CancelCellEdit();

            releaseParams();
        }

        // Helpers
        function showInplaceEditor(value, cellRect) {
            var editorMainElement = activeEditor.GetMainElement();
            activeEditor.SetText(value);
            changeElementPostiton(editorMainElement, cellRect);
            activeEditor.SetVisible(true);
            focusInplaceEditor();
        }
        function focusInplaceEditor() {
            setTimeout(function() {
                activeEditor.Focus();
            }, 100);
        }
        function changeElementPostiton(customEditor, rect) {
            var borderWidth = 2,
                width = rect.width - borderWidth,
                height = rect.height - borderWidth;

            ASPx.SetStyles(customEditor, { width: width, height: height, position: "absolute", zIndex: 12001 });
            ASPxClientUtils.SetAbsoluteX(customEditor, rect.left);
            ASPxClientUtils.SetAbsoluteY(customEditor, rect.top);
        }
        function adjustEditor(s) {
            var activeCellRect = activeSpreadsheet.GetCellBounds(activeCell.columnIndex, activeCell.rowIndex);
            changeElementPostiton(s.GetMainElement(), activeCellRect);
        }

        function captureParams(spreadsheet, customEditor, args) {
            activeEditor = customEditor;
            activeSpreadsheet = spreadsheet;

            subscribeEvents();
        }
        function releaseParams() {
            unsubscribeEvents();

            activeEditor = null;
            activeSpreadsheet = null;
        }

        function captureCell(args) {
            activeCell = { columnIndex: args.columnIndex, rowIndex: args.rowIndex };
        }
        function releaseCell() {
            activeCell = null;
        }

        return InplaceEditorHelper;
    })();
})();
(function() {
    ASPxClientSpreadsheet.ValidationHelper = ASPx.CreateClass(null, {
        constructor: function(spreadsheet) {
            this.spreadsheet = spreadsheet;
            this.resetArrays();
        },
        resetArrays: function() {
            this.listValidations = [];
            this.validations = [];
            this.inputMessages = [];
            this.messagesCache = [];
        },
        processDocumentResponse: function(response) {
            var validation = response.validation,
                resetValidation = response[ASPxClientSpreadsheet.ResponseStringKeys.ClearClientCache] === 1 || response[ASPxClientSpreadsheet.ResponseStringKeys.NewSheetLoading] === 1;
            if(resetValidation)
                this.resetArrays();

            this.clearValidationCircles();
            if(validation) {
                this.addListValidations(validation.listValidations);
                this.addInputMessages(validation.inputMessages);
                this.addValidations(validation.validations);
                if(validation.invalidDataCircles)
                    this.showInvalidDataCircles(validation.invalidDataCircles);
            }
            if(response.validationConfirm)
                this.showValidationConfirm(response.validationConfirm);

            if(this.cellPosition)
                this.showValidationElementsByModelPosition(this.cellPosition.col, this.cellPosition.row);
        },
        addListValidations: function(listValidations) {
            this.addNewItemsToLTRBArray(this.listValidations, listValidations);
        },
        addValidations: function(validations) {
            this.addNewItemsToLTRBArray(this.validations, validations);
        },
        addInputMessages: function(inputMessages) {
            this.addNewItemsToLTRBArray(this.inputMessages, inputMessages);
        },
        removeValidations: function(range) {
            for(var i = range.leftColIndex; i <= range.rightColIndex; i++) {
                for(var j = range.topRowIndex; j <= range.bottomRowIndex; j++) {
                    this.removeItemFromLTRBByCell(this.listValidations, i, j);
                    this.removeItemFromLTRBByCell(this.validations, i, j);
                    this.removeItemFromLTRBByCell(this.inputMessages, i, j);
                }
            }
        },

        isCellHaveValidation: function(modelCol, modelRow) {
            return this.getCellIndexInLTRBArray(this.validations, modelCol, modelRow) > -1;
        },
        isCellElementContainsFormula: function(modelCol, modelRow) {
            var cellElement = this.spreadsheet.getRenderHelper().getCellTextElementByModelPosition(modelCol, modelRow);
            return cellElement && cellElement.innerHTML.indexOf("=") === 0;
        },

        setCurrentlyValidatingCell: function(validationConfirm) {
            this.currentlyValidatingCell = (validationConfirm) ? validationConfirm.cell : null;
        },
        getCurrentlyValidatingCell: function() {
            return this.currentlyValidatingCell;
        },
        clearValidationCircles: function() {
            var workbook = this.spreadsheet.getRenderHelper().getWorkbookControl(),
                circles = ASPx.GetNodesByClassName(workbook, ASPx.SpreadsheetCssClasses.InvalidDataCircle);
            
            for(var i = 0; i < circles.length; i++) {
                var circle = circles[i];
                circle.parentNode.removeChild(circle);
            }
        },
        showInvalidDataCircles: function(circles) {
            var colIndex = 0, rowIndex = 1;
            for(var i = 0; i < circles.length; i++)
                this.showCircle(circles[i][colIndex], circles[i][rowIndex]);
        },
        showCircle: function(col, row) {
            var cellLayoutInfo = this.getCellLayoutInfo_ByModelIndices(col, row);
            if(!cellLayoutInfo || !cellLayoutInfo.tileInfo) return;
            var rect = this.getCircleRect(cellLayoutInfo);
            var circle = this.createCircle();
            ASPx.SetStyles(circle, {
                left: rect.left,
                top: rect.top,
                width: rect.width,
                height: rect.height
            });
            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(circle, cellLayoutInfo.tileInfo.htmlElement);
        },
        createCircle: function() {
            var circle = document.createElement("DIV");
            circle.className = ASPx.SpreadsheetCssClasses.InvalidDataCircle;
            return circle;
        },
        getCircleRect: function(cellLayoutInfo) {
            return {
                left: cellLayoutInfo.rect.x - 5,
                top: cellLayoutInfo.rect.y - 2,
                width: cellLayoutInfo.rect.width + 10,
                height: cellLayoutInfo.rect.height + 4
            };
        },

        showValidationElements: function(col, row) {
            var modelCol = this.getPaneManager().convertVisibleIndexToModelIndex(col, true),
                modelRow = this.getPaneManager().convertVisibleIndexToModelIndex(row, false);
            this.showValidationElementsByModelPosition(modelCol, modelRow);
        },
        showValidationElementsByModelPosition: function(modelCol, modelRow) {
            this.showDropDownButton(modelCol, modelRow);
            this.tryToShowPopupMessage(modelCol, modelRow);
            this.setCellPosition(modelCol, modelRow);
        },
        setCellPosition: function(col, row) {
            this.cellPosition = { col: col, row: row };
        },

        cancelValidation: function(modelCol, modelRow) {
            if(this.isCellHaveValidation(modelCol, modelRow)) {
                var value = this.spreadsheet.GetCellValue(modelCol, modelRow),
                    cellElement = this.spreadsheet.getRenderHelper().getCellTextElementByModelPosition(modelCol, modelRow);

                if(cellElement) {
                    cellElement.innerHTML = value === null ? "" : value;
                    this.spreadsheet.setCellTextViewElementValue(value);
                }
            } else if(this.isCellElementContainsFormula(modelCol, modelRow)) {
                var cellContainerElement = this.spreadsheet.getRenderHelper().getCellElementByModelPosition(modelCol, modelRow);
                if(cellContainerElement) {
                    ASPx.RemoveElement(cellContainerElement);
                }
            }
        },

        showDropDownButton: function(col, row) {
            var dropDownButton = this.getDropDownButton();
            ASPx.SetElementDisplay(this.getDropDownPanel(), false);
            if(this.allowDropDownForCell(col, row)) {
                var cellLayoutInfo = this.getCellLayoutInfo_ByModelIndices(col, row);
                var dropDownButtonHeight = 17, borderCorrection = 1;

                this.placeElementToWorkbook(dropDownButton, cellLayoutInfo.rect.x + cellLayoutInfo.rect.width + borderCorrection, cellLayoutInfo.rect.y + cellLayoutInfo.rect.height - dropDownButtonHeight - borderCorrection, cellLayoutInfo.tileInfo.htmlElement);

                if(this.isCellOutOfGridVisibleRange(cellLayoutInfo))
                    ASPx.SetElementDisplay(dropDownButton, false);
            } else
                ASPx.SetElementDisplay(dropDownButton, false);
        },
        isCellOutOfGridVisibleRange: function(cellLayoutInfo) {
            var activePane = this.getPaneManager().getPaneByType(cellLayoutInfo.paneType),
                visibleCellRange = this.getPaneManager().getDisplayedCellVisibleRange(activePane);
            return !visibleCellRange.isCellInRange(cellLayoutInfo.colIndex, cellLayoutInfo.rowIndex);
        },

        tryToShowPopupMessage: function(col, row) {
            if(this.allowPopupForCell(col, row))
                this.showPopupMessage(col, row);
            else
                ASPx.SetElementDisplay(this.getPopupMessageElement(), false);
        },
        showPopupMessage: function(col, row) {
            var message = this.getCellMessage(col, row);
            if(!message) return;
            var popup = this.getPopupMessageElement();
            this.setPopupMessageTitle(message.title);
            this.setPopupMessageText(message.text);
            
            var cellLayoutInfo = this.getCellLayoutInfo_ByModelIndices(col, row);
            var verticalOffset = 5;

            this.placeElementToWorkbook(popup, cellLayoutInfo.rect.x + cellLayoutInfo.rect.width / 2, cellLayoutInfo.rect.y + cellLayoutInfo.rect.height + verticalOffset, cellLayoutInfo.tileInfo.htmlElement);
            if(this.isCellOutOfGridVisibleRange(cellLayoutInfo))
                ASPx.SetElementDisplay(popup, false);
        },

        showValidationConfirm: function(validationConfirm) {
            var dialog = this.spreadsheet.getDialogManager().getValidationConfirm();
            dialog.spreadsheet = this.spreadsheet;
            dialog.GetDialogHelper().setValidationConfirm(validationConfirm);
            dialog.Execute(this.spreadsheet);
        },

        showDropDownPanel: function(col, row, values) {
            var panel = this.getDropDownPanel(),
                button = this.getDropDownButton(),
                buttonWidth = button.getBoundingClientRect().width,
                borderCorrection = 1,
                cellLayoutInfo = this.getCellLayoutInfo_ByModelIndices(col, row);
            panel.innerHTML = "";
            panel.appendChild(this.createValuesTable(values));
            
            this.placeElementToWorkbook(panel, cellLayoutInfo.rect.x, cellLayoutInfo.rect.y + cellLayoutInfo.rect.height, cellLayoutInfo.tileInfo.htmlElement);
            ASPx.SetStyles(panel, {
                minWidth: cellLayoutInfo.rect.width + buttonWidth - borderCorrection
            });
        },
        placeElementToWorkbook: function(element, x, y, offsetElement) {
            var workbook = this.spreadsheet.getRenderHelper().getWorkbookControl(),
                rect = { x: x, y: y };
            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(element, workbook);
            ASPx.SetElementDisplay(element, true);
            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRectWithElementOffset(element, rect, offsetElement);
        },
        toggleDropDownPanel: function() {
            var canFinishEditing = this.spreadsheet.finishEditingWithEvent();
            if(canFinishEditing) {
                var panel = this.getDropDownPanel();
                if(ASPx.GetElementDisplay(panel))
                    ASPx.SetElementDisplay(panel, false);
                else
                    this.spreadsheet.fetchListAllowedValues();
            }
        },

        allowDropDownForCell: function(col, row) {
            return this.getCellIndexInLTRBArray(this.listValidations, col, row) > -1;
        },
        allowPopupForCell: function(col, row) {
            return this.getCellIndexInLTRBArray(this.inputMessages, col, row) > -1;
        },
        getCellIndexInLTRBArray: function(array, col, row) {
            var ltrb = {
                left: 0,
                top: 1,
                right: 2,
                bottom: 3
            };
            for(var i = 0; i < array.length; i++) {
                var validation = array[i];
                if(validation[ltrb.left] <= col && validation[ltrb.right] >= col &&
                    validation[ltrb.top] <= row && validation[ltrb.bottom] >= row)
                    return i;
            }
            return -1;
        },
        removeItemFromLTRBByCell: function(array, col, row) {
            var index = this.getCellIndexInLTRBArray(array, col, row);
            if(index > -1)
                array.splice(index, 1);
        },
        addNewItemsToLTRBArray: function(array, items) {
            if(!items) return;
            for(var i = 0; i < items.length; i++) {
                var item = items[i];
                if(this.getItemIndexInLTRBArray(array, item) < 0)
                    array.push(item);
            }
        },
        getItemIndexInLTRBArray: function(array, item) {
            for(var i = 0; i < array.length; i++) {
                if(array[i].toString() === item.toString())
                    return i;
            }
            return -1;
        },

        getPaneManager: function() {
            return this.spreadsheet.getPaneManager();
        },
        getCellLayoutInfo_ByModelIndices: function(col, row) {
            return this.getPaneManager().getCellLayoutInfo_ByModelIndices(col, row);
        },

        setPopupMessageText: function(text) {
            var childDivs = this.getPopupMessageElement().getElementsByTagName("DIV");
            childDivs[1].innerHTML = text;
        },
        setPopupMessageTitle: function(title) {
            var childDivs = this.getPopupMessageElement().getElementsByTagName("DIV");
            childDivs[0].innerHTML = title;
        },
        getCellMessage: function(col, row) {
            var index = this.getCellIndexInLTRBArray(this.inputMessages, col, row);
            if(this.messagesCache[index])
                return this.messagesCache[index];
            else
                this.spreadsheet.fetchMessageForCell();
            return null;
        },
        setCellMessage: function(col, row, title, text) {
            var index = this.getCellIndexInLTRBArray(this.inputMessages, col, row);
            this.messagesCache[index] = { title: title, text: text };
        },

        getDropDownButton: function() {
            if(!this.spreadsheet.dropDownButtonElement)
                this.spreadsheet.dropDownButtonElement = this.createDropDownButton();
            return this.spreadsheet.dropDownButtonElement;
        },
        getPopupMessageElement: function() {
            if(!this.spreadsheet.popupMessage)
                this.spreadsheet.popupMessage = this.createPopupMessage();
            return this.spreadsheet.popupMessage;
        },
        getDropDownPanel: function() {
            if(!this.spreadsheet.dropDownPanelElement)
                this.spreadsheet.dropDownPanelElement = this.createDropDownPanel();
            return this.spreadsheet.dropDownPanelElement;
        },

        createDropDownButton: function() {
            var autoFilterConfig = new ASPxClientSpreadsheet.AutoFilterConfig([0, 0, 0, "DropDown", false], this.spreadsheet.getPaneManager());
            var imageElement = autoFilterConfig.getImageElement();
            autoFilterConfig.assignSpriteProperties(imageElement, ASPx.SpreadsheetCssClasses.DropDownButtonImage);
            return imageElement;
        },
        createPopupMessage: function() {
            var popup = document.createElement("DIV"),
                title = document.createElement("DIV"),
                text = document.createElement("DIV");
            popup.className = ASPx.SpreadsheetCssClasses.PopupMessage;
            popup.appendChild(title);
            popup.appendChild(text);
            return popup;
        },
        createDropDownPanel: function() {
            var div = document.createElement("DIV");
            div.className = ASPx.SpreadsheetCssClasses.DropDownPanel;
            ASPx.SetElementDisplay(div, false);
            return div;
        },
        createValuesTable: function(values) {
            var table = document.createElement("TABLE");
            var tbody = document.createElement("TBODY");
            table.appendChild(tbody);
            for(var i = 0; i < values.length; i++) {
                var tr = document.createElement("TR"),
                    td = document.createElement("TD");
                var text = values[i];
                tbody.appendChild(tr);
                tr.appendChild(td);
                td.innerHTML = ASPx.Str.EncodeHtml(text);
            }
            return table;
        },

        onScroll: function() {
            var selection = this.getPaneManager().getStateController().getSelection();
            this.showValidationElements(selection.activeCellColIndex, selection.activeCellRowIndex);
        },
        onDropDownButtonMouseUp: function() {
            this.toggleDropDownPanel();
        },
        onDropDownPanelMouseUp: function(srcElement) {
            if(srcElement.tagName === "TD") {
                var value = ASPx.Str.DecodeHtml(srcElement.innerHTML),
                    canFinishEditing = this.spreadsheet.getEditingHelper().raiseCellEndEditEvent({ rowModelIndex: this.cellPosition.col, colModelIndex: this.cellPosition.row }, value);
                if(canFinishEditing)
                    this.spreadsheet.onCellValueChangedWithNewSelection({ Column: this.cellPosition.col, Row: this.cellPosition.row }, value);
            }
        },
        onAllowedValuesReceived: function(response) {
            this.showDropDownPanel(this.cellPosition.col, this.cellPosition.row, response.allowedValues);
        },
        onMessageForCellReceived: function(response) {
            this.setCellMessage(this.cellPosition.col, this.cellPosition.row, response.title, response.text);
            this.showPopupMessage(this.cellPosition.col, this.cellPosition.row);
        }
    });
})();
(function() {
    ASPxClientSpreadsheet.PaneView = ASPx.CreateClass(null, {
        constructor: function(paneManager, renderHelper, paneType) {
            this.paneManager = paneManager;
            this.renderHelper = renderHelper;
            this.paneType = paneType;
        },
        getPaneManager: function() {
            return this.paneManager;
        },
        getRenderHelper: function() {
            return this.renderHelper;
        },
        getRenderProvider: function() {
            return this.getPaneManager().getRenderProvider();
        },

        // PaneType interface
        getPaneType: function() {
            return this.paneType;
        },
        getTileHelper: function() {
            if(!this.tileHelper)
                this.tileHelper = new ASPxClientSpreadsheet.TileHelper(this);
            return this.tileHelper;
        },

        // DOM worker 
        getRowHeaderContainer: function() {
            return this.getRenderHelper().getRowHeaderContainer(this.getPaneType());
        },
        getGridContainer: function() {
            return this.getRenderHelper().getGridContainer(this.getPaneType());
        },
        getColumnHeaderContainer: function() {
            return this.getRenderHelper().getColumnHeaderContainer(this.getPaneType());
        },
        getColumnHeaderTilesContainer: function() {
            return this.getRenderHelper().getColumnHeaderTilesContainer(this.getPaneType());
        },
        getColumnHeader: function() {
            return this.getRenderHelper().getColumnHeader(this.getPaneType());
        },
        getRowHeader: function() {
            return this.getRenderHelper().getRowHeader(this.getPaneType());
        },
        getRowHeaderTilesContainer: function() {
            return this.getRenderHelper().getRowHeaderTilesContainer(this.getPaneType());
        },
        getGridTilesContainer: function() {
            return this.getRenderHelper().getGridTilesContainer(this.getPaneType());
        },
        getWorkbookControl: function() {
            return this.getRenderHelper().getWorkbookControl();
        },

        processDocumentResponse: function(newTiles, visibleRange, outdatedTiles) {
            this.getTileHelper().processDocumentResponse(newTiles, visibleRange, outdatedTiles);
        },

        adjustRootControls: function() {
            this.getPaneManager().adjustVisiblePanes();
        },
        getVisibleRangePaddings: function() {
            return this.getRenderHelper().getVisibleRangePaddings();
        },
        getVisibleRange: function() {
            return this.getTileHelper().getVisibleRange();
        },
        getTileSize: function(isCol) {
            return this.getRenderHelper().getTileSize(isCol);
        },
        getTileSizes: function(index, isCol) {
            return this.getTileHelper().getTileSizes(index, isCol);
        },
        getTileTotalSize: function(index, isCol) {
            return this.getTileHelper().getTileTotalSize(index, isCol);
        },
        getTileIncrementalRanges: function(index, isCol) {
            return this.getTileHelper().getTileIncrementalRanges(index, isCol);
        },
        calculateViewBoundRange: function(cell, viewBounds, useOnlyCachedTiles, horzFarAlign, vertFarAlign) {
            return this.getTileHelper().calculateViewBoundRange(cell, viewBounds, useOnlyCachedTiles, horzFarAlign, vertFarAlign);
        },
        getGridTileInfo: function(rowIndex, colIndex) {
            return this.getTileHelper().getGridTileInfo(rowIndex, colIndex);
        },
        getDefaultCellSize: function() {
            return this.getRenderHelper().getDefaultCellSize();
        },
        getChildControlsPrefix: function() {
            return this.getRenderHelper().getChildControlsPrefix();
        },
        onVisibleTileRangeChanged: function() {
            this.getPaneManager().onVisibleTileRangeChanged();
        },
        getScrollHelper: function() {
            return this.getPaneManager().getScrollHelper();
        },
        loadInvisibleTiles: function(loadRequestId) {
            return this.getPaneManager().loadInvisibleTiles(loadRequestId);
        },
        loadInvisibleTilesForFullScreen: function(loadRequestId) {
            this.getPaneManager().loadInvisibleTilesForFullScreen(loadRequestId);
        },
        getLoadRequestId: function() {
            return this.getPaneManager().getLoadRequestId();
        },
        increaseLoadRequestId: function() {
            this.getPaneManager().increaseLoadRequestId();
        },
        getCurrentServerRequestId: function() {
            return this.getPaneManager().getCurrentServerRequestId();
        },
        getCellElementByModelPosition: function(columnModelIndex, rowModelIndex) {
            return this.getPaneManager().getCellElementByModelPosition(columnModelIndex, rowModelIndex);
        },
        updateGridTileCache: function(serverVisibleRange) {
            this.getTileHelper().updateGridTileCache(serverVisibleRange);
        },
        removeAllTiles: function() {
            this.getTileHelper().removeAllTiles();
        },
        getCellLayoutInfo: function(modelColumnIndex, modelRowIndex) {
            return this.getTileHelper().getCellLayoutInfo(modelColumnIndex, modelRowIndex);
        },
        getHeaderInfo: function(index, isCol) {
            return this.getTileHelper().getHeaderInfo(index, isCol);
        },
        getCellByCoord: function(xPosition, yPosition) {
            return this.getTileHelper().getCellByCoord(xPosition, yPosition);
        },
        getHeaderOffsetSize: function() {
            return this.getPaneManager().getHeaderOffsetSize();
        },
        getHeaderOffsetSizeForMousePointer: function() {
            return this.getPaneManager().getHeaderOffsetSizeForMousePointer(this.getPaneType());
        },
        convertVisibleIndexToModelIndex: function(visibleIndex, isCol) {
            return this.getTileHelper().convertVisibleIndexToModelIndex(visibleIndex, isCol);
        },
        highlightHeaders: function(selection) {
            this.getTileHelper().highlightHeaders(selection);
        },
        clearHeaderSelection: function() {
            this.getTileHelper().clearHeaderSelection();
        },
        convertModelIndexToVisibleIndex: function(modelIndex, isCol) {
            return this.getTileHelper().convertModelIndexToVisibleIndex(modelIndex, isCol);
        },
        convertModelIndicesRangeToVisibleIndices: function(modelTopLeftIndex, modelBottomRightIndex, isCol) {
            return this.getTileHelper().convertModelIndicesRangeToVisibleIndices(modelTopLeftIndex, modelBottomRightIndex, isCol);
        },
        canScrollToShowCell: function(colVisibleIndex, rowVisibleIndex) {
            var scrollArea = this.getTileHelper().getScrollArea();

            return scrollArea.isCellInRange(colVisibleIndex, rowVisibleIndex);
        },
        getCellEditingText: function(colModelIndex, rowModelIndex) {
            return this.getTileHelper().getCellEditingText(colModelIndex, rowModelIndex);
        },
        getCellValue: function(colModelIndex, rowModelIndex) {
            return this.getTileHelper().getCellValue(colModelIndex, rowModelIndex);
        },
        getCellComment: function(colModelIndex, rowModelIndex) {
            return this.getTileHelper().getCellComment(colModelIndex, rowModelIndex);
        },
        getCommentInfo: function(colModelIndex, rowModelIndex) {
            return this.getTileHelper().getCommentInfo(colModelIndex, rowModelIndex);
        },
        getCommentViewOptions: function(commentId) {
            return this.getTileHelper().getCommentViewOptions(commentId);
        },
        isMergerCellContainsInCroppedRange: function(cellVisiblePosition) {
            return this.getTileHelper().isMergerCellContainsInCroppedRange(cellVisiblePosition);
        },
        getCellLayoutInfo_ByModelIndices: function(colModelIndex, rowModelIndex) {
            return this.getTileHelper().getCellLayoutInfo_ByModelIndices(colModelIndex, rowModelIndex);
        },
        getCachedTiles: function() {
            return this.getTileHelper().getCachedTiles();
        },
        loadTilesSoftly: function(visibleRange) {
            var tileHelper = this.getTileHelper();
            tileHelper.loadGridTiles(visibleRange);
            tileHelper.setVisibleRange(visibleRange);
        },
        getParentTileInfo: function(selection) {
            return this.getTileHelper().getParentTileInfo(selection);
        },
        convertModelRangeToVisible: function(range) {
            return this.getTileHelper().convertModelRangeToVisible(range);
        },
        getVisibleModelCellRange: function() {
            return this.getTileHelper().getVisibleModelCellRange();
        },
        isSelectionVisibleInPane: function(selection) {
            return this.getTileHelper().isSelectionVisible(selection);
        },
        getCellVisibleRange: function() {
            return this.getTileHelper().getCellVisibleRange();
        },
        putCellColIndexInVisibleRange: function(colIndex) {
            return this.getTileHelper().putCellColIndexInVisibleRange(colIndex);
        },
        putCellRowIndexInVisibleRange: function(rowIndex) {
            return this.getTileHelper().putCellRowIndexInVisibleRange(rowIndex);
        },
        getMergedCellRangesIntersectsRange: function(range) {
            return this.getTileHelper().getMergedCellRangesIntersectsRange(range);
        },
        getActiveCellParentTileInfo: function(selection) {
            return this.getTileHelper().getActiveCellParentTileInfo(selection);
        },
        getVisibleVisibleCellRange: function() {
            return this.getTileHelper().getVisibleVisibleCellRange();
        },
        getLastVisibleHeaderRowTileIndex: function() {
            return this.getTileHelper().getLastVisibleHeaderRowTileIndex();
        },
        setLastVisibleHeaderRowTileIndex: function(tileIndex) {
            return this.getTileHelper().setLastVisibleHeaderRowTileIndex(tileIndex);
        },
        searchCellInVisibleRange: function(cellModelPosition) {
            return this.getTileHelper().cellInVisibleRange(cellModelPosition);
        },
        getPaneTopLeftCellVisiblePosition: function() {
            return this.getPaneManager().getPaneTopLeftCellVisiblePosition(this.getPaneType());
        },
        getCellParentTileInfo: function(cell) {
            return this.getTileHelper().getCellParentTileInfo(cell);
        },

        // Real pane cell visible range
        setPaneCellVisibleRange: function(range) {
            this.cellVisibleRange = range;
        },
        getPaneCellVisibleRange: function() {
            return this.cellVisibleRange;
        },
        isCellInPaneVisibleRange: function(cell) {
            var sheetCell = this.putCellToSheetRange(cell);
            return this.cellVisibleRange && this.cellVisibleRange.isCellInRange(sheetCell.col, sheetCell.row);
        },
        putCellToSheetRange: function(cell) {
            var sheetColIndex = cell.col < 0 ? 0 : cell.col;
            sheetColIndex = sheetColIndex > ASPxClientSpreadsheet.Range.MAX_COL_INDEX ? ASPxClientSpreadsheet.Range.MAX_COL_INDEX : sheetColIndex;

            var sheetRowIndex = cell.row < 0 ? 0 : cell.row;
            sheetRowIndex = sheetRowIndex > ASPxClientSpreadsheet.Range.MAX_ROW_INDEX ? ASPxClientSpreadsheet.Range.MAX_ROW_INDEX : sheetRowIndex;

            return { col: sheetColIndex, row: sheetRowIndex };
        },

        // Drawing selection elements
        drawPartSelection: function(selection, visibleBorders) {
            if(this.canDisplaySelection(selection)) {
                var topLeftCellLayoutInfoBase = this.getCellLayoutInfo(selection.range.leftColIndex, selection.range.topRowIndex),
                    bottomRightCellLayoutInfoBase = this.getCellLayoutInfo(selection.range.rightColIndex, selection.range.bottomRowIndex);
                if(topLeftCellLayoutInfoBase && bottomRightCellLayoutInfoBase) {
                    var rect = ASPxClientSpreadsheet.CellHelper.getCellRangeRect(topLeftCellLayoutInfoBase, bottomRightCellLayoutInfoBase, topLeftCellLayoutInfoBase.tileInfo);
                    var parentTileInfo = this.getCellParentTileInfo({ col: selection.range.leftColIndex, row: selection.range.topRowIndex });

                    this.correctSelectionRect(rect);

                    var leftBottomSelectionElement = this.getDrawingHelper().getLeftBottomSelectionElement();
                    ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(leftBottomSelectionElement, parentTileInfo.htmlElement);
                    ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRect(leftBottomSelectionElement, rect);
                    ASPx.SetElementDisplay(leftBottomSelectionElement, true);

                    var borderTopRect = null,
                        borderBottomRect = null,
                        borderLeftRect = null,
                        borderRightRect = null;
                    if(visibleBorders.top) {
                        var topBorderElement = this.getDrawingHelper().getTopBorderElement();
                        ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(topBorderElement, parentTileInfo.htmlElement);
                        borderTopRect = { x: rect.x, y: rect.y, width: rect.width, height: 0 };
                        ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRect(topBorderElement, borderTopRect);
                        ASPx.SetElementDisplay(topBorderElement, true);
                    }
                    if(visibleBorders.bottom) {
                        var bottomBorderElement = this.getDrawingHelper().getBottomBorderElement();
                        ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(bottomBorderElement, parentTileInfo.htmlElement);
                        borderBottomRect = { x: rect.x, y: rect.y + rect.height, width: rect.width, height: 0 };
                        ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRect(bottomBorderElement, borderBottomRect);
                        ASPx.SetElementDisplay(bottomBorderElement, true);
                    }
                    if(visibleBorders.left) {
                        var leftBorderElement = this.getDrawingHelper().getLeftBorderElement();
                        ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(leftBorderElement, parentTileInfo.htmlElement);
                        borderLeftRect = { x: rect.x, y: rect.y, width: 0, height: rect.height };
                        ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRect(leftBorderElement, borderLeftRect);
                        ASPx.SetElementDisplay(leftBorderElement, true);
                    }
                    if(visibleBorders.right) {
                        var rightBorderElement = this.getDrawingHelper().getRightBorderElement();
                        ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(rightBorderElement, parentTileInfo.htmlElement);
                        borderRightRect = { x: rect.x + rect.width, y: rect.y, width: 0, height: rect.height + ASPxClientSpreadsheet.SelectionHelper.BorderCorrectionFactor };
                        ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRect(rightBorderElement, borderRightRect);
                        ASPx.SetElementDisplay(rightBorderElement, true);
                    }
                    if(ASPx.Browser.TouchUI)
                        this.setTouchSelectionElementsPosition(selection, parentTileInfo, borderTopRect, borderRightRect, borderBottomRect, borderLeftRect);
                }
            }
        },

        drawSelection: function(selection, keepOldSelection) {
            if(this.canDisplaySelection(selection)) {
                var activeCellRect = this.getActiveCellRect(selection),
                    selectionElementsRects = null;
                if(!selection.range.isSingleCell())
                    selectionElementsRects = this.getSelectionElementsRect(selection);
                this.drawSelectionBase(selection, activeCellRect, selectionElementsRects, keepOldSelection);
            }
        },
        getActiveCellRect: function(selection) {
            var activeCellRect = null;
            if(selection.isActiveCellMerged()) {
                var topLeftCellRect = this.getCellLayoutInfo(selection.activeCellRange.leftColIndex, selection.activeCellRange.topRowIndex).rect,
                    bottomRightCellRect = this.getCellLayoutInfo(selection.activeCellRange.rightColIndex, selection.activeCellRange.bottomRowIndex).rect;

                if(topLeftCellRect && bottomRightCellRect)
                    activeCellRect = ASPxClientSpreadsheet.CellHelper.mergeCellRects(topLeftCellRect, bottomRightCellRect);
            } else {
                activeCellRect = this.getCellLayoutInfo(selection.activeCellColIndex, selection.activeCellRowIndex).rect;
            }
            return activeCellRect;
        },
        getSelectionElementsRect: function(selection) {
            var selectionElementsRects = {
                leftTop: null,
                leftBottom: null,
                rightTop: null,
                rightBottom: null,
                selection: null
            };

            var topLeftCellLayoutInfoBase = this.getCellLayoutInfo(selection.range.leftColIndex, selection.range.topRowIndex),
                bottomRightCellLayoutInfoBase = this.getCellLayoutInfo(selection.range.rightColIndex, selection.range.bottomRowIndex);

            var rowIndex = selection.activeCellRange.topRowIndex > 0 ? this.putCellRowIndexInVisibleRange(selection.activeCellRange.topRowIndex - 1) : 0,
                topLeftCellLayoutInfo = this.getCellLayoutInfo(selection.range.leftColIndex, selection.range.topRowIndex),
                bottomRightCellLayoutInfo = this.getCellLayoutInfo(selection.activeCellRange.rightColIndex, rowIndex);
            selectionElementsRects.leftTop = ASPxClientSpreadsheet.CellHelper.getCellRangeRect(topLeftCellLayoutInfo, bottomRightCellLayoutInfo, topLeftCellLayoutInfoBase.tileInfo);

            var colIndex = selection.activeCellRange.leftColIndex > 0 ? this.putCellColIndexInVisibleRange(selection.activeCellRange.leftColIndex - 1) : 0;
            topLeftCellLayoutInfo = this.getCellLayoutInfo(selection.range.leftColIndex, selection.activeCellRange.topRowIndex);
            bottomRightCellLayoutInfo = this.getCellLayoutInfo(colIndex, selection.range.bottomRowIndex);
            selectionElementsRects.leftBottom = ASPxClientSpreadsheet.CellHelper.getCellRangeRect(topLeftCellLayoutInfo, bottomRightCellLayoutInfo, topLeftCellLayoutInfoBase.tileInfo);

            topLeftCellLayoutInfo = this.getCellLayoutInfo(this.putCellColIndexInVisibleRange(selection.activeCellRange.rightColIndex + 1), selection.range.topRowIndex);
            bottomRightCellLayoutInfo = this.getCellLayoutInfo(selection.range.rightColIndex, selection.activeCellRange.bottomRowIndex);
            selectionElementsRects.rightTop = ASPxClientSpreadsheet.CellHelper.getCellRangeRect(topLeftCellLayoutInfo, bottomRightCellLayoutInfo, topLeftCellLayoutInfoBase.tileInfo);

            topLeftCellLayoutInfo = this.getCellLayoutInfo(selection.activeCellRange.leftColIndex, this.putCellRowIndexInVisibleRange(selection.activeCellRange.bottomRowIndex + 1));
            bottomRightCellLayoutInfo = this.getCellLayoutInfo(selection.range.rightColIndex, selection.range.bottomRowIndex);
            selectionElementsRects.rightBottom = ASPxClientSpreadsheet.CellHelper.getCellRangeRect(topLeftCellLayoutInfo, bottomRightCellLayoutInfo, topLeftCellLayoutInfoBase.tileInfo);

            selectionElementsRects.selection = ASPxClientSpreadsheet.CellHelper.getCellRangeRect(topLeftCellLayoutInfoBase, bottomRightCellLayoutInfoBase, topLeftCellLayoutInfoBase.tileInfo);

            return selectionElementsRects;
        },
        correctSelectionRect: function(rect) {
            rect.x -= 1;
            rect.y -= 1;
            rect.width += 1;
            rect.height += 1;
        },
        drawSelectionBase: function(selection, activeCellRect, selectionElementsRects, keepOldSelection) {
            if(activeCellRect) {
                var activeCellParentTileInfo = this.getCellParentTileInfo({ col: selection.activeCellColIndex, row: selection.activeCellRowIndex }),
                    activeCellSelectedElement = this.getDrawingHelper().getActiveSelectionElement();

                ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(activeCellSelectedElement, activeCellParentTileInfo.htmlElement);
                ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRect(activeCellSelectedElement, activeCellRect);
                ASPx.SetElementDisplay(activeCellSelectedElement, true);
            }

            if(!keepOldSelection)
                this.drawSelectionRect(selection, selectionElementsRects, activeCellRect);
        },
        drawSelectionRect: function(selection, selectionRectArray, activeCellRect) {
            var parentTileInfo = this.getCellParentTileInfo({ col: selection.range.leftColIndex, row: selection.range.topRowIndex });
            if(selectionRectArray && selectionRectArray.leftTop) {
                if(this.isSelectionElementVisible(selection.activeCellRange.topRowIndex, selection.range.topRowIndex, "top"))
                    selectionRectArray.leftTop.height = 0;

                var leftTopSelectionElement = this.getDrawingHelper().getLeftTopSelectionElement();
                ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(leftTopSelectionElement, parentTileInfo.htmlElement);
                ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRect(leftTopSelectionElement, selectionRectArray.leftTop);
                ASPx.SetElementDisplay(leftTopSelectionElement, true);
            }
            if(selectionRectArray && selectionRectArray.leftBottom) {
                if(this.isSelectionElementVisible(selection.activeCellRange.leftColIndex, selection.range.leftColIndex, "left"))
                    selectionRectArray.leftBottom.width = 0;

                var leftBottomSelectionElement = this.getDrawingHelper().getLeftBottomSelectionElement();
                ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(leftBottomSelectionElement, parentTileInfo.htmlElement);
                ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRect(leftBottomSelectionElement, selectionRectArray.leftBottom);
                ASPx.SetElementDisplay(leftBottomSelectionElement, true);
            }
            if(selectionRectArray && selectionRectArray.rightTop) {
                var rightTopSelectionElement = this.getDrawingHelper().getRightTopSelectionElement();
                ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(rightTopSelectionElement, parentTileInfo.htmlElement);
                ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRect(rightTopSelectionElement, selectionRectArray.rightTop);
                ASPx.SetElementDisplay(rightTopSelectionElement, true);
            }
            if(selectionRectArray && selectionRectArray.rightBottom) {
                var rightBottomSelectionElement = this.getDrawingHelper().getRightBottomSelectionElement();
                ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(rightBottomSelectionElement, parentTileInfo.htmlElement);
                ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRect(rightBottomSelectionElement, selectionRectArray.rightBottom);
                ASPx.SetElementDisplay(rightBottomSelectionElement, true);
            }

            var topBorderElement = this.getDrawingHelper().getTopBorderElement();
            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(topBorderElement, parentTileInfo.htmlElement);
            var borderTopRect = this.getDrawingHelper().getTopBorderRect(activeCellRect, selectionRectArray, selection.range.isSingleCell());
            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRect(topBorderElement, borderTopRect);
            ASPx.SetElementDisplay(topBorderElement, true);

            var rightBorderElement = this.getDrawingHelper().getRightBorderElement();
            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(rightBorderElement, parentTileInfo.htmlElement);
            var borderRightRect = this.getDrawingHelper().getRightBorderRect(activeCellRect, selectionRectArray, selection.range.isSingleCell());
            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRect(rightBorderElement, borderRightRect);
            ASPx.SetElementDisplay(rightBorderElement, true);

            var bottomBorderElement = this.getDrawingHelper().getBottomBorderElement();
            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(bottomBorderElement, parentTileInfo.htmlElement);
            var borderBottomRect = this.getDrawingHelper().getBottomBorderRect(activeCellRect, selectionRectArray, selection.range.isSingleCell());
            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRect(bottomBorderElement, borderBottomRect);
            ASPx.SetElementDisplay(bottomBorderElement, true);

            var leftBorderElement = this.getDrawingHelper().getLeftBorderElement();
            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(leftBorderElement, parentTileInfo.htmlElement);
            var borderLeftRect = this.getDrawingHelper().getLeftBorderRect(activeCellRect, selectionRectArray, selection.range.isSingleCell());
            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRect(leftBorderElement, borderLeftRect);
            ASPx.SetElementDisplay(leftBorderElement, true);

            if(ASPx.Browser.TouchUI)
                this.setTouchSelectionElementsPosition(selection, parentTileInfo, borderTopRect, borderRightRect, borderBottomRect, borderLeftRect);
        },

        setTouchSelectionElementsPosition: function(selection, parentTileInfo, borderTopRect, borderRightRect, borderBottomRect, borderLeftRect) {
            var leftTop = {},
                rightBottom = {};
            leftTop.x = borderTopRect ? borderTopRect.x :
                (borderLeftRect ? borderLeftRect.x : borderBottomRect.x);
            leftTop.y = borderTopRect ? borderTopRect.y :
                (borderLeftRect ? borderLeftRect.y : borderRightRect.y);
            rightBottom.x = borderRightRect ? borderRightRect.x :
                (borderBottomRect ? borderBottomRect.x + borderBottomRect.width :
                    (borderTopRect.x + borderTopRect.width));
            rightBottom.y = borderBottomRect ? borderBottomRect.y :
                (borderRightRect ? borderRightRect.y + borderRightRect.height :
                    (borderLeftRect.y + borderLeftRect.height));
            var elements = this.getDrawingHelper().getTouchSelectionElements();
            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(elements.leftTop, parentTileInfo.htmlElement);
            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(elements.rightBottom, parentTileInfo.htmlElement);
            var coordinates;
            if(selection.entireColsSelected) {
                var y = this.getDrawingHelper().prepareEntireColsRowsSelectionElementPos(true);
                coordinates = this.getDrawingHelper().getTouchSelectionElementCoordinates(leftTop.x, y, rightBottom.x, y);
            } else if(selection.entireRowsSelected) {
                var x = this.getDrawingHelper().prepareEntireColsRowsSelectionElementPos(false);
                coordinates = this.getDrawingHelper().getTouchSelectionElementCoordinates(x, leftTop.y, x, rightBottom.y);
            } else {
                coordinates = this.getDrawingHelper().getTouchSelectionElementCoordinates(leftTop.x, leftTop.y, rightBottom.x, rightBottom.y);
            }
            elements.leftTop.style.left = coordinates.leftTopX;
            elements.leftTop.style.top = coordinates.leftTopY;
            elements.rightBottom.style.left = coordinates.rightBottomX;
            elements.rightBottom.style.top = coordinates.rightBottomY;
        },
        moveTouchSelectionElementsOnScroll: function(selection) {
            this.getDrawingHelper().moveTouchSelectionElementsOnScroll(selection);
        },
        hideTouchSelectionElements: function(display) {
            this.getDrawingHelper().hideTouchSelectionElements(display);
        },
        isRightBottomTouchSelectionElement: function(element) {
            var touchElements = this.getDrawingHelper().getTouchSelectionElements();
            return touchElements.rightBottom == element;
        },

        isSelectionElementVisible: function(startInitialPosition, endInitialPosition, position) {
            var visibleCellRange = this.getVisibleVisibleCellRange();
            return startInitialPosition === visibleCellRange[position] && startInitialPosition === endInitialPosition;
        },
        canDisplaySelection: function(selection) {
            var parentTileInfo = this.getCellParentTileInfo({ col: selection.range.leftColIndex, row: selection.range.topRowIndex });
            return parentTileInfo && ASPx.IsValidElement(parentTileInfo.htmlElement);
        },
        hideSelection: function() {
            this.getDrawingHelper().hideSelection();
            // TODO to azhuravlev: each pane must hide selection without others
            if(ASPx.Browser.TouchUI)
                this.getPaneManager().hideTouchSelectionElements(false);
        },

        //  Model box selection
        drawModelBoxSelection: function(modelBox, isCommentBox) {
            this.hideSelection();
            this.clearHeaderSelection();

            modelBox = isCommentBox ? this.getCommentBoxInPane(modelBox) : this.getDrawingBoxInPane(modelBox);

            if(modelBox) {
                var tileElement = modelBox.parentNode,
                    selectionElement = this.getDrawingHelper().getModelBoxSelectionElement(isCommentBox);

                ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(selectionElement, tileElement);
                var rect = {
                    x: ASPx.PxToInt(modelBox.style.left),
                    y: ASPx.PxToInt(modelBox.style.top),
                    width: ASPx.PxToInt(modelBox.style.width) - ASPx.GetHorizontalBordersWidth(selectionElement),
                    height: ASPx.PxToInt(modelBox.style.height) - ASPx.GetHorizontalBordersWidth(selectionElement)
                };
                ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRect(selectionElement, rect);
                ASPx.SetElementDisplay(selectionElement, true);
            }
        },
        getCommentBoxInPane: function(modelBox) {
            var rowIndex = parseInt(ASPx.Attr.GetAttribute(modelBox, "r")),
                colIndex = parseInt(ASPx.Attr.GetAttribute(modelBox, "c")),
                commentElementId = this.getRenderHelper().getCommentElementId(rowIndex, colIndex, this.getPaneType());

            return ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(this.getGridContainer(), commentElementId);
        },
        getDrawingBoxInPane: function(modelBox) {
            var tilesContainer = this.getGridContainer(),
                index = parseInt(ASPx.Attr.GetAttribute(modelBox, "data-dbi"));
            if(tilesContainer) {
                var drawingBoxes = tilesContainer.getElementsByTagName("IMG");
                for(var i = 0; i < drawingBoxes.length; i++) {
                    var drawingBox = drawingBoxes[i],
                        drawingBoxIndex = parseInt(ASPx.Attr.GetAttribute(drawingBox, "data-dbi"));
                    if(drawingBoxIndex === index)
                        return drawingBox;
                }
            }
            return null;
        },
        getCurrentModelBoxSelectionElement: function() {
            return this.getDrawingHelper().getCurrentModelBoxSelectionElement();
        },
        keepResizingPanelPosition: function() {
            var resizingPanel = this.getCurrentModelBoxSelectionElement();
            if(resizingPanel && resizingPanel.parentNode) {
                this.resizingPanelPosition = {
                    initPosX: this.getAbsoluteX(resizingPanel),
                    initPosY: this.getAbsoluteY(resizingPanel),
                    initWidth: resizingPanel.offsetWidth,
                    initHeight: resizingPanel.offsetHeight
                };
            }
        },
        updateResizingPanelPosition: function(resizeOptions, proportional) {
            if(!this.resizingPanelPosition)
                return;
            var minDrawingSize = 2;

            var deltaX = resizeOptions.deltaX,
                deltaY = resizeOptions.deltaY,
                sideH = resizeOptions.sideH,
                sideV = resizeOptions.sideV,
                newLeft = this.resizingPanelPosition.initPosX,
                newTop = this.resizingPanelPosition.initPosY,
                newWidth = this.resizingPanelPosition.initWidth,
                newHeight = this.resizingPanelPosition.initHeight;

            deltaX = !sideH && deltaX > 0 ? Math.min(this.resizingPanelPosition.initWidth + 1, deltaX) : deltaX;
            deltaY = !sideV && deltaY > 0 ? Math.min(this.resizingPanelPosition.initHeight + 1, deltaY) : deltaY;

            if(!this.lockH && !this.lockV) {
                if(proportional) {
                    if(Math.abs(deltaX) > Math.abs(deltaY)) {
                        newWidth = sideH ? Math.max(minDrawingSize, this.resizingPanelPosition.initWidth + deltaX) : (this.resizingPanelPosition.initWidth - deltaX);
                        newHeight = this.resizingPanelPosition.initHeight * (newWidth / this.resizingPanelPosition.initWidth);
                    } else {
                        newHeight = sideV ? Math.max(minDrawingSize, this.resizingPanelPosition.initHeight + deltaY) : (this.resizingPanelPosition.initHeight - deltaY);
                        newWidth = this.resizingPanelPosition.initWidth * (newHeight / this.resizingPanelPosition.initHeight);
                    }
                } else {
                    newHeight = sideV ? Math.max(minDrawingSize, this.resizingPanelPosition.initHeight + deltaY) : (this.resizingPanelPosition.initHeight - deltaY);
                    newWidth = sideH ? Math.max(minDrawingSize, this.resizingPanelPosition.initWidth + deltaX) : (this.resizingPanelPosition.initWidth - deltaX);
                }
            } else {
                deltaX = this.lockH ? 0 : deltaX;
                deltaY = this.lockV ? 0 : deltaY;
                newWidth = Math.max(minDrawingSize, sideH ? (this.resizingPanelPosition.initWidth + deltaX) : (this.resizingPanelPosition.initWidth - deltaX));
                newHeight = Math.max(minDrawingSize, sideV ? (this.resizingPanelPosition.initHeight + deltaY) : (this.resizingPanelPosition.initHeight - deltaY));
            }

            newLeft += sideH ? 0 : this.resizingPanelPosition.initWidth - newWidth;
            newTop += sideV ? 0 : this.resizingPanelPosition.initHeight - newHeight;

            this.setResizePanelPositionAndDimensions(newLeft, newTop, newWidth, newHeight);
        },
        moveResizingPane: function(moveOptions, canBoxBeMovedHorizontally, canBoxBeMovedVertically) {
            var offsetX = 0,
                offsetY = 0;

            if(canBoxBeMovedHorizontally)
                offsetX = moveOptions.deltaX + this.resizingPanelPosition.initPosX;
            if(canBoxBeMovedVertically)
                offsetY = moveOptions.deltaY + this.resizingPanelPosition.initPosY;
            this.setResizePanelPositionAndDimensions(offsetX, offsetY);
        },
        setResizePanelPositionAndDimensions: function(x, y, width, height) {
            var resizingPanel = this.getCurrentModelBoxSelectionElement();
            if(resizingPanel && resizingPanel.parentNode) {
                ASPx.SetAbsoluteX(resizingPanel, x);
                ASPx.SetAbsoluteY(resizingPanel, y);
                if(width >= 0)
                    ASPx.SetOffsetWidth(resizingPanel, width);
                if(height >= 0)
                    ASPx.SetOffsetHeight(resizingPanel, height);
            }
        },
        resetResizingPanelPosition: function() {
            this.setResizePanelPositionAndDimensions(
                this.resizingPanelPosition.initPosX,
                this.resizingPanelPosition.initPosY,
                this.resizingPanelPosition.initWidth,
                this.resizingPanelPosition.initHeight
            );
        },
        hideModelBoxSelection: function() {
            this.getDrawingHelper().hideModelBoxSelectionElement();
        },

        // Helper
        getDrawingHelper: function() {
            if(!this.drawingHelper)
                this.drawingHelper = new ASPxClientSpreadsheet.PaneView.DrawingHelper(this);
            return this.drawingHelper;
        },
        getAbsoluteX: function(element) {
            var x = ASPx.GetAbsoluteX(element);
            if(ASPx.Browser.IE && ASPx.Browser.Version >= 10)
                x = Math.round(x);
            return x;
        },
        getAbsoluteY: function(element) {
            var y = ASPx.GetAbsoluteY(element);
            if(ASPx.Browser.IE && ASPx.Browser.Version >= 10)
                y = Math.round(y);
            return y;
        }
    });

    ASPxClientSpreadsheet.PaneView.DrawingHelper = function(paneView) {
        var pane = paneView;

        // Public members
        this.hideSelection = function() {
            ASPx.SetElementDisplay(this.getActiveSelectionElement(), false);
            ASPx.SetElementDisplay(this.getRightBottomSelectionElement(), false);
            ASPx.SetElementDisplay(this.getRightTopSelectionElement(), false);
            ASPx.SetElementDisplay(this.getLeftBottomSelectionElement(), false);
            ASPx.SetElementDisplay(this.getLeftTopSelectionElement(), false);

            ASPx.SetElementDisplay(this.getBottomBorderElement(), false);
            ASPx.SetElementDisplay(this.getLeftBorderElement(), false);
            ASPx.SetElementDisplay(this.getTopBorderElement(), false);
            ASPx.SetElementDisplay(this.getRightBorderElement(), false);
        };
        this.getActiveSelectionElement = function() {
            if(!pane.selectElement)
                pane.selectElement = createActiveSelectionElement();
            return pane.selectElement;
        };
        this.getRightBottomSelectionElement = function() {
            if(!pane.rightBottomSelectionElement)
                pane.rightBottomSelectionElement = createRightBottomSelectionElement();
            return pane.rightBottomSelectionElement;
        };
        this.getRightTopSelectionElement = function() {
            if(!pane.rightTopSelectionElement)
                pane.rightTopSelectionElement = createRightTopSelectionElement();
            return pane.rightTopSelectionElement;
        };
        this.getLeftBottomSelectionElement = function() {
            if(!pane.leftBottomSelectionElement)
                pane.leftBottomSelectionElement = createLeftBottomSelectionElement();
            return pane.leftBottomSelectionElement;
        };
        this.getLeftTopSelectionElement = function() {
            if(!pane.leftTopSelectionElement)
                pane.leftTopSelectionElement = createLeftTopSelectionElement();
            return pane.leftTopSelectionElement;
        };
        this.getBottomBorderElement = function() {
            if(!pane.bottomBorderElement) {
                var fillHandleElement = this.getFillHandleElement();
                pane.bottomBorderElement = createBottomBorderElement(fillHandleElement);
            }
            return pane.bottomBorderElement;
        };
        this.getLeftBorderElement = function() {
            if(!pane.leftBorderElement)
                pane.leftBorderElement = createLeftBorderElement();
            return pane.leftBorderElement;
        };
        this.getTopBorderElement = function() {
            if(!pane.topBorderElement)
                pane.topBorderElement = createTopBorderElement();
            return pane.topBorderElement;
        };
        this.getRightBorderElement = function() {
            if(!pane.rightBorderElement)
                pane.rightBorderElement = createRightBorderElement();
            return pane.rightBorderElement;
        };
        this.getTouchSelectionElements = function() {
            if(!pane.touchSelectionElemnts)
                pane.touchSelectionElemnts = createTouchSelectionElements();
            return pane.touchSelectionElemnts;
        };
        this.getSelectionBorderElement = function() {
            if(!pane.selectionBorderElement)
                pane.selectionBorderElement = createSelectionBorderElement();
            return pane.selectionBorderElement;
        };
        this.getFillHandleElement = function() {
            if(!pane.fillHandleElement)
                pane.fillHandleElement = createFillHandleElement();
            return pane.fillHandleElement;
        };

        this.getModelBoxSelectionElement = function(isCommentResizing) {
            if(!pane.modelBoxSelectElement)
                pane.modelBoxSelectElement = createModelBoxSelectionElement();
            pane.modelBoxSelectElement.className = isCommentResizing ? ASPx.SpreadsheetCssClasses.CommentBoxSelectionElement : ASPx.SpreadsheetCssClasses.DrawingBoxSelectedElement;
            return pane.modelBoxSelectElement;
        };
        this.hideModelBoxSelectionElement = function() {
            ASPx.SetElementDisplay(this.getModelBoxSelectionElement(), false);
        };
        this.getCurrentModelBoxSelectionElement = function() {
            return pane.modelBoxSelectElement;
        };

        // Border Rect
        this.getTopBorderRect = function(activeCellRect, selectionRectArray, isSingleCell) {
            if(isSingleCell)
                return {
                    x: activeCellRect.x - 1,
                    y: activeCellRect.y - 1,
                    width: activeCellRect.width + 1,
                    height: 1
                };
            else return {
                x: selectionRectArray.leftTop.x - 1,
                y: selectionRectArray.leftTop.y - 1,
                width: selectionRectArray.leftTop.width + selectionRectArray.rightTop.width + 1,
                height: 1
            };
        };
        this.getRightBorderRect = function(activeCellRect, selectionRectArray, isSingleCell) {
            if(isSingleCell)
                return {
                    x: activeCellRect.x + activeCellRect.width - 1,
                    y: activeCellRect.y - 1,
                    width: 1,
                    height: activeCellRect.height + ASPxClientSpreadsheet.SelectionHelper.BorderCorrectionFactor + 1
                };
            else return {
                x: selectionRectArray.rightTop.x + selectionRectArray.rightTop.width - 1,
                y: selectionRectArray.rightTop.y - 1,
                width: 1,
                height: selectionRectArray.rightTop.height + selectionRectArray.rightBottom.height + ASPxClientSpreadsheet.SelectionHelper.BorderCorrectionFactor + 1
            };
        };
        this.getBottomBorderRect = function(activeCellRect, selectionRectArray, isSingleCell) {
            if(isSingleCell)
                return {
                    x: activeCellRect.x - 1,
                    y: activeCellRect.y + activeCellRect.height - 1,
                    width: activeCellRect.width + 1,
                    height: 1
                };
            else return {
                x: selectionRectArray.leftTop.x - 1,
                y: selectionRectArray.rightBottom.y + selectionRectArray.rightBottom.height - 1,
                width: selectionRectArray.leftTop.width + selectionRectArray.rightTop.width + 1,
                height: 1
            };
        };
        this.getLeftBorderRect = function(activeCellRect, selectionRectArray, isSingleCell) {
            if(isSingleCell)
                return {
                    x: activeCellRect.x - 1,
                    y: activeCellRect.y - 1,
                    width: 1,
                    height: activeCellRect.height + 1
                };
            else return {
                x: selectionRectArray.leftTop.x - 1,
                y: selectionRectArray.rightTop.y - 1,
                width: 1,
                height: selectionRectArray.rightTop.height + selectionRectArray.rightBottom.height + 1
            };
        };

        // Touch Selection Radius
        this.getTouchSelectionElementCoordinates = function(leftTopX, leftTopY, rightBottomX, rightBottomY) {
            var offset = getTouchSelectionElementsRadius(this.getTouchSelectionElements());
            return {
                leftTopX: leftTopX - offset + "px",
                leftTopY: leftTopY - offset + "px",
                rightBottomX: rightBottomX - offset + "px",
                rightBottomY: rightBottomY - offset + "px"
            };
        };
        this.prepareEntireColsRowsSelectionElementPos = function(isColSelection) {
            var workbook = pane.getWorkbookControl(),
                visibleBorder;
            if(isColSelection) {
                var rightBorder = pane.getDrawingHelper().getRightBorderElement();
                visibleBorder = ASPx.GetElementDisplay(rightBorder) ? rightBorder : pane.getDrawingHelper().getLeftBorderElement();
                return ASPx.PrepareClientPosForElement(ASPx.GetAbsoluteY(workbook) + workbook.offsetHeight / 2, visibleBorder, false);
            } else {
                var bottomBorder = pane.getDrawingHelper().getBottomBorderElement();
                visibleBorder = ASPx.GetElementDisplay(bottomBorder) ? bottomBorder : pane.getDrawingHelper().getTopBorderElement();
                return ASPx.PrepareClientPosForElement(ASPx.GetAbsoluteX(workbook) + workbook.offsetWidth / 2, visibleBorder, true);
            }
        };
        this.moveTouchSelectionElementsOnScroll = function(selection) {
            var elements = this.getTouchSelectionElements(),
                leftTop = elements.leftTop,
                rightBottom = elements.rightBottom;
            if(!ASPx.GetElementDisplay(leftTop) || !ASPx.GetElementDisplay(leftTop))
                return;
            var pos = this.prepareEntireColsRowsSelectionElementPos(selection.entireColsSelected) - getTouchSelectionElementsRadius(this.getTouchSelectionElements()) + "px";
            if(selection.entireColsSelected) {
                leftTop.style.top = pos;
                rightBottom.style.top = pos;
            } else if(selection.entireRowsSelected) {
                leftTop.style.left = pos;
                rightBottom.style.left = pos;
            }
        };
        this.hideTouchSelectionElements = function(display) {
            var elements = this.getTouchSelectionElements();
            ASPx.SetElementDisplay(elements.leftTop, display);
            ASPx.SetElementDisplay(elements.rightBottom, display);
        };

        // Model box selection

        // Internal members
        function createActiveSelectionElement() {
            var element = document.createElement("DIV");
            element.className = ASPx.SpreadsheetCssClasses.CellActiveSelectedElement;
            return element;
        }

        function createLeftBottomSelectionElement() {
            var element = document.createElement("DIV");
            element.className = ASPx.SpreadsheetCssClasses.CellRangeSelectedElement;
            return element;
        }

        function createRightTopSelectionElement() {
            var element = document.createElement("DIV");
            element.className = ASPx.SpreadsheetCssClasses.CellRangeSelectedElement;
            return element;
        }

        function createRightBottomSelectionElement() {
            var element = document.createElement("DIV");
            element.className = ASPx.SpreadsheetCssClasses.CellRangeSelectedElement;
            return element;
        }

        function createLeftTopSelectionElement() {
            var element = document.createElement("DIV");
            element.className = ASPx.SpreadsheetCssClasses.CellRangeSelectedElement;
            return element;
        }

        function createLeftBorderElement() {
            var element = document.createElement("DIV");
            element.className = ASPx.SpreadsheetCssClasses.LeftRangeBorderElement;
            return element;
        }

        function createBottomBorderElement(fillHandleElement) {
            var element = document.createElement("DIV");
            element.className = ASPx.SpreadsheetCssClasses.BottomRangeBorderElement;
            element.appendChild(fillHandleElement);
            return element;
        }

        function createTopBorderElement() {
            var element = document.createElement("DIV");
            element.className = ASPx.SpreadsheetCssClasses.TopRangeBorderElement;
            return element;
        }

        function createRightBorderElement() {
            var element = document.createElement("DIV");
            element.className = ASPx.SpreadsheetCssClasses.RightRangeBorderElement;
            return element;
        }

        function createTouchSelectionElements() {
            var elements = {};
            elements.leftTop = createTouchSelectionElement();
            elements.rightBottom = createTouchSelectionElement();
            return elements;
        }

        function createTouchSelectionElement() {
            var element = document.createElement("DIV");
            element.className = ASPx.SpreadsheetCssClasses.TouchSelectionElement;
            return element;
        }

        function getTouchSelectionElementsRadius(elements) {
            if(!elements.radius) {
                var style = window.getComputedStyle(elements.leftTop);
                elements.radius = Math.ceil(ASPx.PxToInt(style.getPropertyValue('width')) / 2);
            }
            return elements.radius;
        }

        function createSelectionBorderElement() {
            var element = document.createElement("DIV");
            element.className = ASPx.SpreadsheetCssClasses.SelectionBorderElement;
            return element;
        }

        function createFillHandleElement() {
            var element = document.createElement("DIV");
            element.className = ASPx.SpreadsheetCssClasses.FillHandleElement;
            return element;
        }

        function createModelBoxSelectionElement() {
            var element = document.createElement("DIV");
            element.className = ASPx.SpreadsheetCssClasses.DrawingBoxSelectedElement;

            var corner = document.createElement("DIV");
            corner.className = "corner nw";
            addTouchClassForCorner(corner);
            ASPx.Attr.SetAttribute(corner, "resizeDirection", "nw");
            element.appendChild(corner);

            corner = document.createElement("DIV");
            corner.className = "corner ne";
            addTouchClassForCorner(corner);
            ASPx.Attr.SetAttribute(corner, "resizeDirection", "ne");
            element.appendChild(corner);

            corner = document.createElement("DIV");
            corner.className = "corner se";
            addTouchClassForCorner(corner);
            ASPx.Attr.SetAttribute(corner, "resizeDirection", "se");
            element.appendChild(corner);

            corner = document.createElement("DIV");
            corner.className = "corner sw";
            addTouchClassForCorner(corner);
            ASPx.Attr.SetAttribute(corner, "resizeDirection", "sw");
            element.appendChild(corner);

            corner = document.createElement("DIV");
            corner.className = "corner n";
            addTouchClassForCorner(corner);
            ASPx.Attr.SetAttribute(corner, "resizeDirection", "n");
            element.appendChild(corner);

            corner = document.createElement("DIV");
            corner.className = "corner e";
            addTouchClassForCorner(corner);
            ASPx.Attr.SetAttribute(corner, "resizeDirection", "e");
            element.appendChild(corner);

            corner = document.createElement("DIV");
            corner.className = "corner s";
            addTouchClassForCorner(corner);
            ASPx.Attr.SetAttribute(corner, "resizeDirection", "s");
            element.appendChild(corner);

            corner = document.createElement("DIV");
            corner.className = "corner w";
            addTouchClassForCorner(corner);
            ASPx.Attr.SetAttribute(corner, "resizeDirection", "w");
            element.appendChild(corner);

            return element;
        }

        function addTouchClassForCorner(corner) {
            if(ASPx.Browser.TouchUI)
                corner.className += " cornerTouch";
        }
    };
})();
(function() {
    ASPxClientSpreadsheet.TileHelper = ASPx.CreateClass(null, {
        constructor: function(parentPane) {
            this.parentPane = parentPane;
            this.tileSize = this.parentPane.getTileSize();
            this.visibleRangePadding = this.parentPane.getVisibleRangePaddings();
            this.clientVisibleRangePadding = {
                row: Math.floor(this.visibleRangePadding.row / 3),
                col: Math.floor(this.visibleRangePadding.col / 3)
            };
            this.tileMatrix = null;
            this.etalonGridTileRow = null;
            this.etalonGridTileRowHtml = "<div class='dxss-fc'></div>";

            this.visibleRangesWaitingForLoad = [];

            this.visibleRange = { top: -1, right: -1, bottom: -1, left: -1 }; // Tile indices
            this.scrollBounds = { top: 0, right: 0, bottom: 0, left: 0 }; // Cell indices

            this.headerVisibleRange = { top: 0, right: 0, bottom: 0, left: 0 }; // Tile indices
            this.headerScrollBounds = { top: 0, right: 0, bottom: 0, left: 0 }; // Cell indices

            this.lastVisibleHeaderRowTileIndex = 0;

            this.highlightHeadersArray = [];

            this.complexBoxes = new ASPxClientSpreadsheet.ComplexBoxArray();

            this.autoFilters = new ASPxClientSpreadsheet.AutoFilterConfigArray();
            this.pivotTableAutoFilters = new ASPxClientSpreadsheet.AutoFilterConfigArray();
        },
        getDefaultCellSize: function() { return this.parentPane.getDefaultCellSize(); },
        getPaneType: function() { return this.parentPane.getPaneType(); },
        getRenderHelper: function() { return this.parentPane.getRenderHelper(); },
        getGridContainer: function() { return this.parentPane.getGridContainer(); },
        getGridTilesContainer: function() { return this.parentPane.getGridTilesContainer(); },
        getColumnHeaderTilesContainer: function() { return this.parentPane.getColumnHeaderTilesContainer(); },
        getRowHeaderTilesContainer: function() { return this.parentPane.getRowHeaderTilesContainer(); },
        getPaneTopLeftCellVisiblePosition: function() { return this.parentPane.getPaneTopLeftCellVisiblePosition(); },
        getRenderProvider: function() { return this.parentPane.getRenderProvider(); },

        getScrollHelper: function() { return this.parentPane.getScrollHelper(); },
        getScrollAnchorVisiblePosition: function() { return this.getScrollHelper().getScrollAnchorVisiblePosition(); },
        getLastVisibleHeaderRowTileIndex: function() { return this.lastVisibleHeaderRowTileIndex; },
        setLastVisibleHeaderRowTileIndex: function(tileIndex) { this.lastVisibleHeaderRowTileIndex = tileIndex; },
        getTileMatrix: function() {
            if(!this.tileMatrix)
                this.tileMatrix = new ASPxClientSpreadsheet.TileMatrix();
            return this.tileMatrix;
        },
        getHeaderOffsetSize: function() { return this.parentPane.getHeaderOffsetSize(); },

        // Receive data from server side
        processDocumentResponse: function(newTiles, visibleRange, expiredTiles) {

            this.beforeChildControlsCreated(expiredTiles);

            this.createControlHierarchy(newTiles, visibleRange);

            this.afterChildControlsCreated(visibleRange);
        },

        // Remove tiles
        removeExpiredTiles: function(expiredTiles) {
            var matrix = this.getTileMatrix(),
                len = expiredTiles.length;

            while(len--) {
                var tileInfo = expiredTiles[len];
                if(tileInfo)
                    this.removeTile(matrix, expiredTiles.rowIndex, expiredTiles.colIndex);
            }
        },
        removeTile: function(matrix, rowIndex, colIndex) {
            matrix.removeGridTileInfo(rowIndex, colIndex);
            ASPx.RemoveElement(this.getRenderHelper().getGridTileElement(rowIndex, colIndex, this.getPaneType()));
        },
        removeGridTileSmart: function(rowIndex, colIndex) {
            var gridTileElement = this.getRenderHelper().getGridTileElement(rowIndex, colIndex, this.getPaneType());
            if(gridTileElement) {
                var tileContainer = gridTileElement.parentNode;
                ASPx.RemoveElement(gridTileElement);
                if(tileContainer && tileContainer.childNodes.length === 0 && ASPx.ElementContainsCssClass(tileContainer, "dxss-fc"))
                    ASPx.RemoveElement(tileContainer);
            }
        },

        createControlHierarchy: function(receivedTiles, visibleRange) {
            this.getRenderProvider().updateTileRender(this, receivedTiles, visibleRange);
            //Add tiles to DOM
            this.loadChildControls(visibleRange);
        },
        loadChildControls: function(visibleRange) {
            this.loadGridTiles(visibleRange);
            this.loadHeaderTiles(visibleRange);
        },

        beforeChildControlsCreated: function(expiredTiles) {
            if(expiredTiles)
                this.removeExpiredTiles(expiredTiles);
        },

        afterChildControlsCreated: function(visibleRange) {
            this.setVisibleRange(visibleRange);

            this.getRenderProvider().onAfterTileRenderUpdated(this, visibleRange);

            var size = this.getVisiblePartSize();
            ASPx.SetStyles(this.getGridTilesContainer(), { width: size.width, height: size.height });
        },

        //get it from render provider
        createHeaderTemplate: function(tileIndex, isCol) {
            var mainDiv = document.createElement("DIV");
            mainDiv.className = "dxss-ht";
            var cellContainer = document.createElement("DIV");
            cellContainer.className = ASPx.SpreadsheetCssClasses.HeaderContainer;
            cellContainer.setAttribute(ASPxClientSpreadsheet.TileHelper.DataAttributes.HeaderContainerTileIndex, tileIndex);
            mainDiv.appendChild(cellContainer);
            var gridLinesContainer = document.createElement("DIV");
            gridLinesContainer.className = ASPx.SpreadsheetCssClasses.GridLineContainer;
            mainDiv.appendChild(gridLinesContainer);
            var gridLineClass = ASPx.SpreadsheetCssClasses.getGridLine(isCol);
            var cellCount = isCol ? this.tileSize.col : this.tileSize.row;
            for(var i = 0; i < cellCount; i++) {
                var cell = document.createElement("DIV");
                cell.className = ASPx.SpreadsheetCssClasses.HeaderCell;
                cell.setAttribute(ASPxClientSpreadsheet.TileHelper.DataAttributes.HeaderCellIndex, i);
                cellContainer.appendChild(cell);
                var gl = document.createElement("DIV");
                gl.className = gridLineClass;
                gridLinesContainer.appendChild(gl);
            }
            return mainDiv;
        },


        adjustControls: function() {
            // TODO set row headers width, col headers height and remove it from assignHeaderContentSizes function
            this.parentPane.adjustRootControls();
        },
        loadInvisibleTiles: function(loadRequestId) { this.parentPane.loadInvisibleTiles(loadRequestId); },

        getVisibleRange: function() { return this.visibleRange; },
        setVisibleRange: function(range) {
            var changed = this.visibleRange.top !== range.top || this.visibleRange.right !== range.right || this.visibleRange.bottom !== range.bottom || this.visibleRange.left !== range.left;
            if(changed) {
                this.visibleRange = range;
                this.onVisibleRangeChanged();
            }
        },

        getVisibleModelCellRange: function() {
            var visibleTileRange = this.getVisibleRange();
            var top, right, bottom, left;

            top = this.getHeaderInfo(visibleTileRange.top, false).modelIndices[0];
            left = this.getHeaderInfo(visibleTileRange.left, true).modelIndices[0];

            bottom = this.getHeaderInfo(visibleTileRange.bottom, false).modelIndices[this.tileSize.col - 1];
            right = this.getHeaderInfo(visibleTileRange.right, true).modelIndices[this.tileSize.row - 1];

            return { top: top, right: right, bottom: bottom, left: left };
        },
        getVisibleVisibleCellRange: function() {
            var visibleTileRange = this.getVisibleRange();
            var top = 0, right = 0, bottom = 0, left = 0;

            if(visibleTileRange.top > 0)
                top = visibleTileRange.top * this.tileSize.row;
            if(visibleTileRange.left > 0)
                left = visibleTileRange.left * this.tileSize.col;

            bottom = (visibleTileRange.bottom + 1) * this.tileSize.row - 1;
            right = (visibleTileRange.right + 1) * this.tileSize.col - 1;

            return { top: top, right: right, bottom: bottom, left: left };
        },

        onVisibleRangeChanged: function() {
            this.resetCellVisibleRange();
            var visibleRange = this.getVisibleRange();
            this.removeInvisibleTiles(visibleRange);
            this.calculateLoadedArea(visibleRange);
            this.invalidateVisibleRangesWaitingForLoad();

            this.parentPane.onVisibleTileRangeChanged();
        },

        getCachedTiles: function() {
            return this.getTileMatrix().getGridTileInfoArray();
        },

        // Parent tile information
        getCellParentTileInfo: function(cell) {
            var tilePosition = ASPxClientSpreadsheet.CellHelper.getCellTilePosition(this.getRenderHelper(), cell.col, cell.row);
            return this.getGridTileInfo(tilePosition.row, tilePosition.col);
        },
        getParentTileInfo: function(selection) {
            var parentTilePosition = ASPxClientSpreadsheet.CellHelper.getCellTilePosition(this.getRenderHelper(), selection.range.leftColIndex, selection.range.topRowIndex);
            return this.getGridTileInfo(parentTilePosition.row, parentTilePosition.col);
        },
        getActiveCellParentTileInfo: function(selection) {
            var activeCellParentTilePosition = ASPxClientSpreadsheet.CellHelper.getCellTilePosition(this.getRenderHelper(), selection.activeCellColIndex, selection.activeCellRowIndex);
            return this.getGridTileInfo(activeCellParentTilePosition.row, activeCellParentTilePosition.col);
        },
        updateGridTileCache: function(serverVisibleRange) {
            var clientVisibleRange = this.getVisibleRange(),
                matrix = this.getTileMatrix();

            if(serverVisibleRange && this.containsRange(serverVisibleRange, clientVisibleRange)) {
                for(var i = clientVisibleRange.top; i <= clientVisibleRange.bottom; i++) {
                    for(var k = clientVisibleRange.left; k <= clientVisibleRange.right; k++) {
                        var rowInRange = (serverVisibleRange.top <= i) && (i <= serverVisibleRange.bottom),
                            columnInRange = (serverVisibleRange.left <= k) && (k <= serverVisibleRange.right),
                            tileIsNotInServerRange = !(rowInRange && columnInRange);
                        if(tileIsNotInServerRange) {
                            this.removeGridTileSmart(i, k);

                            if(!rowInRange)
                                ASPx.RemoveElement(this.getRenderHelper().getHeaderTileElement(i, false, this.getPaneType()));

                            if(!columnInRange)
                                ASPx.RemoveElement(this.getRenderHelper().getHeaderTileElement(k, true, this.getPaneType()));
                        }
                    }
                }
                matrix.clearCacheSmart(serverVisibleRange);
            } else
                matrix.clearCache();
        },
        containsRange: function(serverRange, clientRange) {
            return clientRange.top <= serverRange.top ||
                clientRange.bottom >= serverRange.bottom ||
                clientRange.left <= serverRange.left ||
                clientRange.right >= serverRange.right;
        },

        removeInvisibleTiles: function(visibleRange, onlyHeaders) {
            var trash = [],
                matrix = this.getTileMatrix(),
                i;

            for(var k = 0; k < 2; k++) {
                var isCol = k == 0;
                var headerInfoArray = matrix.getHeaderInfoArray(isCol);
                for(i = 0; i < headerInfoArray.length; i++) {
                    var index = headerInfoArray[i].index;
                    if(isCol && (index < visibleRange.left || index > visibleRange.right) || !isCol && (index < visibleRange.top || index > visibleRange.bottom))
                        trash.push(this.getRenderHelper().getHeaderTileElement(index, isCol, this.getPaneType()));
                }
            }
            var gridTileInfoArray = matrix.getGridTileInfoArray();
            if(!onlyHeaders) {
                for(i = 0; i < gridTileInfoArray.length; i++) {
                    var tileInfo = gridTileInfoArray[i];
                    if(tileInfo.rowIndex < visibleRange.top || tileInfo.rowIndex > visibleRange.bottom)
                        trash.push(this.getRenderHelper().getGridTileRowElement(tileInfo.rowIndex, this.getPaneType()));
                    else if(tileInfo.colIndex < visibleRange.left || tileInfo.colIndex > visibleRange.right)
                        trash.push(this.getRenderHelper().getGridTileElement(tileInfo.rowIndex, tileInfo.colIndex, this.getPaneType()));
                }
            }
            for(i = 0; i < trash.length; i++)
                ASPx.RemoveElement(trash[i]);
        },

        removeAllTiles: function() {
            var visibleRange = {
                left: -1,
                top: -1,
                right: -1,
                bottom: -1
            };
            this.removeInvisibleTiles(visibleRange); // TODO refactor it;
            this.getTileMatrix().clearCache();
            this.resetComplexBoxes();
            this.autoFilters.reset();
            this.pivotTableAutoFilters.reset();

            this.visibleRangesWaitingForLoad = [];
        },

        getScrollBounds: function() { return this.scrollBounds; },
        getScrollArea: function() { return this.scrollArea; },

        calculateLoadedArea: function(visibleRange) {
            var loadedArea = this.calculateScrollArea(visibleRange),
                scrollArea = loadedArea.scrollArea;

            this.scrollBounds = loadedArea.scrollBounds;
            this.scrollArea = new ASPxClientSpreadsheet.Range(scrollArea.left, scrollArea.top, scrollArea.right, scrollArea.bottom);
        },

        calculateScrollBounds: function(visibleRange) {
            var top, right, bottom, left;
            top = right = bottom = left = 0;

            if(visibleRange.top > 0)
                top = visibleRange.top * this.tileSize.row + this.clientVisibleRangePadding.row;
            if(visibleRange.left > 0)
                left = visibleRange.left * this.tileSize.col + this.clientVisibleRangePadding.col;

            var anchor = {
                row: (visibleRange.bottom + 1) * this.tileSize.row - 1 - this.clientVisibleRangePadding.row,
                col: (visibleRange.right + 1) * this.tileSize.col - 1 - this.clientVisibleRangePadding.col
            };
            var maxScrollViewBound = this.calculateViewBoundRange(anchor, this.getRenderHelper().getGridOffsetSize(this.getPaneType()), false, true, true);
            if(maxScrollViewBound) {
                bottom = maxScrollViewBound.top;
                right = maxScrollViewBound.left;
            }
            if(this.endOfDocumentReachedByRange(false, visibleRange))
                bottom = this.getEndOfDocumentCellInfo(false).visibleIndex;
            if(this.endOfDocumentReachedByRange(true, visibleRange))
                right = this.getEndOfDocumentCellInfo(true).visibleIndex;

            return { top: top, right: right, bottom: bottom, left: left };
        },
        calculateScrollArea: function(visibleRange) {
            var top = visibleRange.top > 0 ? visibleRange.top * this.tileSize.row + this.clientVisibleRangePadding.row : 0,
                left = visibleRange.left > 0 ? visibleRange.left * this.tileSize.col + this.clientVisibleRangePadding.col : 0,
                anchor = {
                    row: (visibleRange.bottom + 1) * this.tileSize.row - 1 - this.clientVisibleRangePadding.row,
                    col: (visibleRange.right + 1) * this.tileSize.col - 1 - this.clientVisibleRangePadding.col
                },
                maxScrollViewBound = this.calculateViewBoundRange(anchor, this.getRenderHelper().getGridOffsetSize(this.getPaneType()), false, true, true),
                bottom = maxScrollViewBound ? maxScrollViewBound.top : 0,
                right = maxScrollViewBound ? maxScrollViewBound.left : 0;

            var verticalEndOfDocumentReached = this.endOfDocumentReachedByRange(false, visibleRange),
                horizontalEndOfDocumentReached = this.endOfDocumentReachedByRange(true, visibleRange);

            if(verticalEndOfDocumentReached)
                bottom = this.getEndOfDocumentCellInfo(false).visibleIndex;
            if(horizontalEndOfDocumentReached)
                right = this.getEndOfDocumentCellInfo(true).visibleIndex;

            var scrollBounds = { top: top, right: right, bottom: bottom, left: left },
                bottom = maxScrollViewBound ? maxScrollViewBound.bottom : 0,
                right = maxScrollViewBound ? maxScrollViewBound.right : 0;

            if(verticalEndOfDocumentReached)
                bottom = this.getEndOfDocumentCellInfo(false).visibleIndex;
            if(horizontalEndOfDocumentReached)
                right = this.getEndOfDocumentCellInfo(true).visibleIndex;

            var scrollArea = { top: top, right: right, bottom: bottom, left: left };

            return { scrollBounds: scrollBounds, scrollArea: scrollArea };
        },

        loadTilesAccordingToScrollAnchor: function() {
            var newVisibleRange = this.calculateNewVisibleRange(this.getScrollAnchorVisiblePosition());
            if(newVisibleRange) {
                var loadRequestId = this.parentPane.getLoadRequestId();

                this.loadInvisibleTiles(loadRequestId);
                this.addVisibleRangeToWiatingForLoad(newVisibleRange, loadRequestId);

                this.parentPane.increaseLoadRequestId();
            }
        },
        addVisibleRangeToWiatingForLoad: function(visibleRange, loadRequestId) {
            if(loadRequestId)
                visibleRange.requestId = loadRequestId;
            this.visibleRangesWaitingForLoad.push(visibleRange);
        },
        calculateNewVisibleRange: function(scrollAnchor) {
            var viewBoundRange = this.calculateViewBoundRange(scrollAnchor, this.getRenderHelper().getGridOffsetSize(), false);
            if(!viewBoundRange) return; // WORKAROUND for IE9-

            var newVisibleRange = this.calculateVisibleRange(viewBoundRange);
            if(this.checkIsVisibleRangeAlreadyWaitingForLoad(newVisibleRange))
                return;

            return newVisibleRange;
        },
        calculateCurrentVisibleRange: function(scrollAnchorVisiblePosition) {
            scrollAnchorVisiblePosition = scrollAnchorVisiblePosition || this.getScrollAnchorVisiblePosition();
            var viewBoundRange = this.calculateViewBoundRange(scrollAnchorVisiblePosition, this.getRenderHelper().getGridOffsetSize(), false);
            if(viewBoundRange)
                return this.calculateVisibleRange(viewBoundRange);
            return null;
        },
        // attention: use this method only through PaneManager
        canLoadTilesFromCache: function() {
            var viewBoundRange = this.calculateViewBoundRange(this.getScrollAnchorVisiblePosition(), this.getRenderHelper().getGridOffsetSize(), true);
            if(!viewBoundRange)
                return false;
            var newVisibleRange = this.calculateVisibleRange(viewBoundRange),
                matrix = this.getTileMatrix();
            if(!matrix.containsRange(newVisibleRange))
                return false;
            return true;
        },
        // attention: use this method only through PaneManager
        tryLoadTilesFromCache: function() {
            var viewBoundRange = this.calculateViewBoundRange(this.getScrollAnchorVisiblePosition(), this.getRenderHelper().getGridOffsetSize(), true);
            if(!viewBoundRange)
                return;
            var newVisibleRange = this.calculateVisibleRange(viewBoundRange);
            var matrix = this.getTileMatrix();
            if(!matrix.containsRange(newVisibleRange))
                return;

            this.loadChildControls(newVisibleRange);
            this.afterChildControlsCreated(newVisibleRange);

            return true;
        },

        calculateVisibleRange: function(viewBoundRange) {
            var top = Math.max(0, viewBoundRange.top - this.visibleRangePadding.row);
            var left = Math.max(0, viewBoundRange.left - this.visibleRangePadding.col);
            var bottom = viewBoundRange.bottom + this.visibleRangePadding.row;
            if(this.endOfDocumentReachedByIndex(false, viewBoundRange.bottom))
                bottom = Math.min(this.getEndOfDocumentCellInfo(false).visibleIndex, bottom);
            var right = viewBoundRange.right + this.visibleRangePadding.col;
            if(this.endOfDocumentReachedByIndex(true, viewBoundRange.right))
                right = Math.min(this.getEndOfDocumentCellInfo(true).visibleIndex, right);
            return {
                top: Math.floor(top / this.tileSize.row),
                right: Math.floor(right / this.tileSize.col),
                bottom: Math.floor(bottom / this.tileSize.row),
                left: Math.floor(left / this.tileSize.col)
            };
        },
        calculateViewBoundRange: function(cell, viewBounds, useOnlyCachedTiles, horzFarAlign, vertFarAlign) {
            var top = vertFarAlign ? this.calculateVisibleBoundIndex(cell, false, viewBounds.height, false, useOnlyCachedTiles) : cell.row;
            var right = !horzFarAlign ? this.calculateVisibleBoundIndex(cell, true, viewBounds.width, true, useOnlyCachedTiles) : cell.col;
            var bottom = !vertFarAlign ? this.calculateVisibleBoundIndex(cell, false, viewBounds.height, true, useOnlyCachedTiles) : cell.row;
            var left = horzFarAlign ? this.calculateVisibleBoundIndex(cell, true, viewBounds.width, false, useOnlyCachedTiles) : cell.col;

            if(top > -1 && right > -1 && bottom > -1 && left > -1 && right >= left && bottom >= top)
                return { top: top, right: right, bottom: bottom, left: left };
        },

        findEndOfDocumentHeaderInfo: function(isCol) {
            var headerInfoArray = this.getTileMatrix().getHeaderInfoArray(isCol),
                indices, headerInfo;
            for(i = headerInfoArray.length - 1; i >= 0; i--) {
                headerInfo = headerInfoArray[i];
                indices = headerInfo.modelIndices;
                if(!!indices) break;
            }
            if(!indices)
                return null;
            var lastTileModelIndex = indices[indices.length - 1];
            if(!ASPxClientSpreadsheet.Range.isAllowableIndex(isCol, lastTileModelIndex))
                return headerInfo;
            return null;
        },
        endOfDocumentReachedByIndex: function(isCol, visibleIndex) {
            var endOfDocHeaderInfo = this.findEndOfDocumentHeaderInfo(isCol);
            if(!!endOfDocHeaderInfo) {
                var cellPosInTile = this.findCellPositionInTileInfo(visibleIndex, isCol),
                    tileIndex = ASPxClientSpreadsheet.Range.isAllowableIndex(isCol, endOfDocHeaderInfo.modelIndices[0]) ? endOfDocHeaderInfo.index : endOfDocHeaderInfo.index - 1;
                return tileIndex <= cellPosInTile.tileIndex;
            }
            return false;
        },
        endOfDocumentReachedByRange: function(isCol, visibleRange) {
            var headerInfo = this.findEndOfDocumentHeaderInfo(isCol),
                visibleMaxTileIndex = isCol ? visibleRange.right : visibleRange.bottom;
            return !!headerInfo && headerInfo.index === visibleMaxTileIndex;
        },
        getEndOfDocumentCellInfo: function(isCol) {
            var headerInfo = this.findEndOfDocumentHeaderInfo(isCol);
            if(!headerInfo)
                return null;
            var indices = headerInfo.modelIndices,
                tileSize = isCol ? this.tileSize.col : this.tileSize.row;
            for(var i = indices.length - 1; i >= 0; i--) {
                var index = indices[i];
                if(ASPxClientSpreadsheet.Range.isAllowableIndex(isCol, index))
                    return {
                        tileIndex: headerInfo.index,
                        indexInTile: i,
                        modelIndex: index,
                        visibleIndex: i + headerInfo.index * tileSize
                    };
            }
            var previousTile = this.getHeaderInfo(headerInfo.index - 1, isCol),
                indexInTile = previousTile.modelIndices.length - 1;
            return {
                tileIndex: previousTile.index,
                indexInTile: indexInTile,
                modelIndex: previousTile.modelIndices[indexInTile],
                visibleIndex: indexInTile + previousTile.index * tileSize
            };
        },
        getEndOfDocumentAbsPos: function(isCol) {
            if(!this.endOfDocumentReachedByRange(isCol, this.getVisibleRange()))
                return null;
            var cell = this.getEndOfDocumentCellInfo(isCol),
                pos = null;
            if(cell) {
                var visibleCellRange = this.getVisibleModelCellRange(),
                    cellLayoutInfo = this.getCellLayoutInfo(isCol ? cell.visibleIndex : visibleCellRange.left, isCol ? visibleCellRange.top : cell.visibleIndex);
                if(isCol)
                    pos = ASPx.GetAbsoluteX(cellLayoutInfo.tileInfo.htmlElement) + cellLayoutInfo.rect.x + cellLayoutInfo.rect.width;
                else
                    pos = ASPx.GetAbsoluteY(cellLayoutInfo.tileInfo.htmlElement) + cellLayoutInfo.rect.y + cellLayoutInfo.rect.height;
            }
            return pos;
        },

        calculateVisibleBoundIndex: function(cell, isCol, minSize, isRightDir, useOnlyCachedTiles) {
            var cellIndex = isCol ? cell.col : cell.row,
                tileSize = isCol ? this.tileSize.col : this.tileSize.row,
                tileIndex = Math.floor(cellIndex / tileSize),
                cellPositionInTile = cellIndex - tileIndex * tileSize;

            var headerInfo = this.getHeaderInfo(tileIndex, isCol);
            if(!headerInfo && useOnlyCachedTiles)
                return -1;

            var boundIndexInfo = this.findBoundIndexInTilePart(headerInfo, isCol, minSize, cellPositionInTile, isRightDir);
            if(!boundIndexInfo.found)
                return -1;
            if(boundIndexInfo.index >= 0)
                return tileIndex * tileSize + boundIndexInfo.index;

            var inc = isRightDir ? 1 : -1;
            cellIndex += boundIndexInfo.partLength * inc;
            tileIndex += inc;

            var defaultTileInfo = this.getDefaultTileInfo(),
                totalSizeName = isCol ? "totalWidth" : "totalHeight",
                diff = minSize - boundIndexInfo.partTotalSize,
                i = 0,
                prevDiff,
                maxCellCount = ASPxClientSpreadsheet.Range.getMaxCellsCount(isCol),
                visibleRange = this.getVisibleRange(),
                maxTileIndex = Math.round(maxCellCount / tileSize) + 1,
                endOfDocument = this.endOfDocumentReachedByRange(isCol, visibleRange);
            if(endOfDocument) {
                var endOfDocCellInfo = this.getEndOfDocumentCellInfo(isCol);
                maxTileIndex = endOfDocCellInfo.tileIndex;
                if(tileIndex > maxTileIndex)
                    return endOfDocCellInfo.visibleIndex;
            }
            do {
                headerInfo = this.getHeaderInfo(tileIndex, isCol);
                if(!headerInfo && useOnlyCachedTiles)
                    return -1;
                var tileTotalSize = headerInfo ? headerInfo[totalSizeName] : defaultTileInfo[totalSizeName];
                prevDiff = diff;
                diff -= tileTotalSize;
                i++;
                tileIndex += inc;
            } while(diff > 0 && tileIndex <= maxTileIndex);

            cellIndex += (i - 1) * tileSize * inc;
            tileIndex -= inc;

            headerInfo = this.getHeaderInfo(tileIndex, isCol);
            if(!headerInfo && useOnlyCachedTiles)
                return -1;
            cellPositionInTile = isRightDir ? 0 : tileSize - 1;
            boundIndexInfo = this.findBoundIndexInTilePart(headerInfo, isCol, prevDiff, cellPositionInTile, isRightDir);
            if(boundIndexInfo.index == -1 && endOfDocument)
                boundIndexInfo.index = this.getEndOfDocumentCellInfo(isCol).indexInTile;
            var result = tileIndex * tileSize + boundIndexInfo.index;
            if(result < 0 && endOfDocument)
                result = 0;
            return result;
        },
        findBoundIndexInTilePart: function(headerInfo, isCol, bound, startIndex, isRightDir) {
            var defaultTileInfo = this.getDefaultTileInfo();
            var sizeName = isCol ? "widths" : "heights";
            var tileSizes = headerInfo ? headerInfo[sizeName] : defaultTileInfo[sizeName];

            var partSizes = isRightDir ? tileSizes.slice(startIndex) : tileSizes.slice(0, startIndex + 1).reverse();
            var partSizeRanges = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getIncrementalRangeArray(partSizes);
            var partTotalSize = partSizeRanges[partSizeRanges.length - 1];

            if(bound === partTotalSize) {
                var endOfDocCellInfo = this.getEndOfDocumentCellInfo(isCol),
                    minIndex = !!endOfDocCellInfo ? Math.min(tileSizes.length - 1, endOfDocCellInfo.indexInTile) : tileSizes.length - 1;
                return { index: !isRightDir ? 0 : minIndex, found: true };
            }
            if(bound < partTotalSize) {
                var indexInPart = ASPx.Data.ArrayBinarySearch(partSizeRanges, bound, ASPx.Data.NearestLeftBinarySearchComparer);
                var index = startIndex + indexInPart * (isRightDir ? 1 : -1);
                return { index: index, found: index >= 0 };
            }
            return { index: -1, partTotalSize: partTotalSize, partLength: partSizes.length, found: true };
        },
        getDefaultTileInfo: function() {
            if(!this.defaultTileInfo) {
                var totalWidth = this.tileSize.col * this.getDefaultCellSize().width;
                var totalHeight = this.tileSize.row * this.getDefaultCellSize().height;
                var widths = [];
                var heights = [];
                var iterationCount = Math.max(this.tileSize.col, this.tileSize.row);
                for(var i = 0; i < iterationCount; i++) {
                    if(i < this.tileSize.col)
                        widths.push(this.getDefaultCellSize().width);
                    if(i < this.tileSize.row)
                        heights.push(this.getDefaultCellSize().height);
                }
                this.defaultTileInfo = { totalWidth: totalWidth, totalHeight: totalHeight, widths: widths, heights: heights };
            }
            return this.defaultTileInfo;
        },

        getVisiblePartSize: function() {
            var startCellRowIndex = this.visibleRange.top * this.tileSize.row;
            var endCellRowIndex = (this.visibleRange.bottom + 1) * this.tileSize.row - 1;
            var startCellColIndex = this.visibleRange.left * this.tileSize.col;
            var endCellColIndex = (this.visibleRange.right + 1) * this.tileSize.col - 1;
            return {
                width: this.calculateCellSize(startCellColIndex, endCellColIndex, true, true),
                height: this.calculateCellSize(startCellRowIndex, endCellRowIndex, false, true)
            };
        },


        getHeaderCellContainer: function(headerElement) {
            return ASPx.GetChildByClassName(headerElement, ASPx.SpreadsheetCssClasses.HeaderContainer);
        },
        assignHeaderContentSizes: function(headerElement, headerInfo, isCol) {
            var headerOffsetSize = this.getHeaderOffsetSize();
            var headerOffsetWidth = headerOffsetSize.width;
            var headerOffsetHeight = headerOffsetSize.height; // TODO get header width and all header heigths from server and use it here (or create css rule for all header elements)
            //var headerOffset = this.parentPane.headerOffset; 
            var hWidth = isCol ? headerInfo.totalWidth : headerOffsetWidth;
            var hHeight = isCol ? headerOffsetHeight : headerInfo.totalHeight;
            if(isCol)
                headerElement.style.width = hWidth + "px";
            headerElement.style.height = hHeight + "px";
            if(isCol)
                headerElement.style.lineHeight = hHeight + "px";

            var gridLineContainer, cellContainer, i;
            for(i = 0; i < headerElement.childNodes.length; i++) {
                var child = headerElement.childNodes[i];
                if(child.className === "dxss-gl")
                    gridLineContainer = child;
                else if(child.className === ASPx.SpreadsheetCssClasses.HeaderContainer)
                    cellContainer = child;
            }
            var tileSizeInfo = this.ensureNewHeaderTileSizes(headerInfo, isCol);
            var stylePosName = isCol ? "left" : "top";
            var index = 0;
            for(i = 0; i < gridLineContainer.childNodes.length; i++) {
                var line = gridLineContainer.childNodes[i];
                if(line.tagName !== "DIV") continue;

                if(headerInfo.modelIndices) {
                    if(i >= 1)
                        if(headerInfo.modelIndices[i] - headerInfo.modelIndices[i - 1] > 1)
                            line.className += " db";
                    if((i === 0) && this.thereAreHiddenElementsBetweenTiles) {
                        line.className += " db";
                        this.thereAreHiddenElementsBetweenTiles = false;
                    }
                }

                line.style[stylePosName] = tileSizeInfo.incrementalSizeRanges[index] + "px";
                index++;
            }
            var styleSizeName = isCol ? "width" : "height";
            index = 0;
            for(i = 0; i < cellContainer.childNodes.length; i++) {
                var cell = cellContainer.childNodes[i];
                if(cell.tagName !== "DIV") continue;
                cell.style[stylePosName] = tileSizeInfo.incrementalSizeRanges[index] + "px";
                cell.style[styleSizeName] = tileSizeInfo.sizes[index] + "px";
                if(!isCol)
                    cell.style.lineHeight = tileSizeInfo.sizes[index] + "px";
                index++;
            }
        },
        populateHeaderTextCells: function(headerElement, headerInfo, isCol, cellContainer) {
            cellContainer = cellContainer || this.getHeaderCellContainer(headerElement);
            if(headerInfo.modelIndices)
                this.populateHeaderTextCellsByModelIndices(headerElement, headerInfo, isCol, cellContainer);
            else
                this.populateHeaderTextCellsByOrder(headerElement, headerInfo, isCol, cellContainer);
        },
        populateHeaderTextCellsByOrder: function(headerElement, headerInfo, isCol, cellContainer) {
            var index = 0;
            var tileSize = isCol ? this.tileSize.col : this.tileSize.row;
            var startCellIndexInTile = headerInfo.index * tileSize;
            if(!isCol)
                startCellIndexInTile++;
            for(var i = 0; i < cellContainer.childNodes.length; i++) {
                var cell = cellContainer.childNodes[i];
                if(cell.tagName !== "DIV") continue;
                cell.innerHTML = this.getHeaderCellTextByOrder(startCellIndexInTile + index, isCol);
                index++;
            }
        },
        populateHeaderTextCellsByModelIndices: function(headerElement, headerInfo, isCol, cellContainer) {
            for(var i = 0; i < cellContainer.childNodes.length; i++) {
                var cell = cellContainer.childNodes[i];
                if(cell.tagName !== "DIV") continue;
                cell.innerHTML = this.getHeaderCellTextByOrder(headerInfo.modelIndices[i] + (isCol ? 0 : 1), isCol);
            }
        },
        ensureNewHeaderTileSizes: function(headerInfo, isCol) { // TODO move to TileMatrix
            var sizeName = isCol ? "widths" : "heights";
            var sizeRangeName = isCol ? "incrementalWidths" : "incrementalHeights";
            headerInfo[sizeRangeName] = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getIncrementalRangeArray(headerInfo[sizeName]);
            return { sizes: headerInfo[sizeName], incrementalSizeRanges: headerInfo[sizeRangeName] };
        },
        getHeaderCellTextByOrder: function(cellIndex, isCol) {
            return isCol ? this.getHeaderCellIndexStringRepresentation(cellIndex) : cellIndex;
        },

        getHeaderCellIndexStringRepresentation: function(index) {
            return ASPxClientSpreadsheet.CellHelper.getColumnStringRepresentaion(index);
        },

        //Working with DOM
        insertGridTile: function(tileInfo) {
            if(!tileInfo) return;
            this.insertGridTileBase(tileInfo);
        },
        insertGridTileBase: function(tileInfo) {
            var oldTile = this.getRenderHelper().getGridTileElement(tileInfo.rowIndex, tileInfo.colIndex, this.getPaneType());
            if(!oldTile) {
                var row = this.getRenderHelper().getGridTileRowElement(tileInfo.rowIndex, this.getPaneType());
                if(!row)
                    row = this.createGridTileRow(tileInfo.rowIndex);
                var refTile = this.findReferenceElementForTileInsertion(row, tileInfo.colIndex),
                    newTile = tileInfo.htmlElement;
                if(refTile)
                    row.insertBefore(newTile, refTile);
                else
                    row.appendChild(newTile);
            }
        },

        insertHeaderTile: function(headerTileInfo, isCol) {
            if(!headerTileInfo) return;
            var oldHeaderTileElement = this.getRenderHelper().getHeaderTileElement(headerTileInfo.index, isCol, this.getPaneType());
            if(!oldHeaderTileElement) {
                var container = isCol ? this.getColumnHeaderTilesContainer() : this.getRowHeaderTilesContainer(),
                    refTile = this.findReferenceElementForTileInsertion(container, headerTileInfo.index),
                    newHeaderTileElement = headerTileInfo.htmlElement;
                if(refTile)
                    container.insertBefore(newHeaderTileElement, refTile);
                else
                    container.appendChild(newHeaderTileElement);
            }
        },
        findReferenceElementForTileInsertion: function(container, index) {
            var siblings = ASPx.GetChildNodesByTagName(container, "DIV");
            for(var i = 0; i < siblings.length; i++) {
                var sibling = siblings[i];
                var siblingIndex = this.getNumberFromEndOfString(sibling.id);
                if(siblingIndex > index)
                    return sibling;
            }
            return null;
        },

        createGridTileRow: function(rowIndex) {
            if(!this.etalonGridTileRow) {
                var fragment = this.createFragmentFromHtml(this.etalonGridTileRowHtml);
                this.etalonGridTileRow = ASPx.GetChildByTagName(fragment, "DIV");
            }
            var row = this.etalonGridTileRow.cloneNode(true);
            row.id = this.getRenderHelper().getGridTileRowElementId(rowIndex, this.getPaneType());
            this.insertGridTileRow(row, rowIndex);
            return row;
        },
        insertGridTileRow: function(row, rowIndex) {
            var container = this.getGridTilesContainer();
            var siblings = ASPx.GetChildNodesByTagName(container, "DIV");
            for(var i = 0; i < siblings.length; i++) {
                var sibling = siblings[i];
                var siblingRowIndex = this.getNumberFromEndOfString(sibling.id);
                if(siblingRowIndex > rowIndex) {
                    container.insertBefore(row, sibling);
                    return;
                }
            }
            container.appendChild(row);
        },

        calculateCellSize: function(startIndex, endIndex, isCol, useOnlyCachedTiles) {
            if(startIndex < 0 || endIndex < 0)
                return 0;
            var count = endIndex - startIndex + 1;

            var tileSize = isCol ? this.tileSize.col : this.tileSize.row;
            var tileIndex = Math.floor(startIndex / tileSize);
            var headerInfo = this.getHeaderInfo(tileIndex, isCol);
            if(!headerInfo && useOnlyCachedTiles)
                return 0;

            var startIndexInTile = startIndex - tileIndex * tileSize;
            var endIndexInTile = endIndex - tileIndex * tileSize;
            if(endIndexInTile >= tileSize)
                endIndexInTile = tileSize - 1;

            var size = this.calculateCellSizeInTile(headerInfo, startIndexInTile, endIndexInTile, isCol);
            count -= endIndexInTile - startIndexInTile + 1;
            tileIndex++;
            if(count === 0)
                return size;

            var defaultTileInfo = this.getDefaultTileInfo();
            var totalSizeName = isCol ? "totalWidth" : "totalHeight";
            var lastTileIndex = tileIndex + Math.floor(count / tileSize);
            for(var i = tileIndex; i < lastTileIndex; i++) {
                headerInfo = this.getHeaderInfo(i, isCol);
                if(!headerInfo && useOnlyCachedTiles)
                    return 0;
                size += headerInfo ? headerInfo[totalSizeName] : defaultTileInfo[totalSizeName];
                count -= tileSize;
            }
            headerInfo = this.getHeaderInfo(lastTileIndex, isCol);
            if(!headerInfo && useOnlyCachedTiles)
                return 0;
            size += this.calculateCellSizeInTile(headerInfo, 0, count - 1, isCol);
            return size;
        },
        calculateCellSizeInTile: function(headerInfo, startIndex, endIndex, isCol) {
            if(!headerInfo) {
                var size = isCol ? this.getDefaultCellSize().width : this.getDefaultCellSize().height;
                return (endIndex - startIndex + 1) * size;
            }
            var incSizeName = isCol ? "incrementalWidths" : "incrementalHeights";
            var incrementSizeRanges = headerInfo[incSizeName];
            var partSizeRanges = incrementSizeRanges.slice(startIndex, endIndex + 2);
            return partSizeRanges[partSizeRanges.length - 1] - partSizeRanges[0];
        },

        invalidateVisibleRangesWaitingForLoad: function() { // use callbackIDs for invalidating
            var newRanges = [],
                serverRequestId = this.parentPane.getCurrentServerRequestId();
            for(var i = 0; i < this.visibleRangesWaitingForLoad.length; i++) {
                var range = this.visibleRangesWaitingForLoad[i];
                if(!this.isRangeContainsOther(this.visibleRange, range))
                    if(!this.requestIdsAreEqual(serverRequestId, range.requestId))
                        newRanges.push(range);
            }
            this.visibleRangesWaitingForLoad = newRanges;
        },
        requestIdsAreEqual: function(serverRequestId, rangeRequestId) {
            return serverRequestId && rangeRequestId && serverRequestId === rangeRequestId;
        },
        checkIsVisibleRangeAlreadyWaitingForLoad: function(target) {
            for(var i = 0; i < this.visibleRangesWaitingForLoad.length; i++)
                if(this.isRangeContainsOther(this.visibleRangesWaitingForLoad[i], target))
                    return true;
            return false;
        },

        isRangeContainsOther: function(source, target) { // TODO create client rect object
            return target.top >= source.top && target.left >= source.left && target.bottom <= source.bottom && target.right <= source.right;
        },

        patchIDs: function(html) {
            var renderHelper = this.getRenderHelper(),
                panePostfix = renderHelper.getPanePostfixByType(this.getPaneType()),
                postfix = panePostfix != "" ? panePostfix + "_" : panePostfix + "_";

            var newIdPrefix = "id=\"" + renderHelper.getChildControlsPrefix(true) + postfix;
            return String(html).replace(/id="/g, newIdPrefix);
        },
        createFragmentFromHtml: function(html) {
            html = this.patchIDs(html);
            var container = document.createElement("DIV");
            container.innerHTML = html;
            var doc = document.createDocumentFragment();
            var first = null;
            for(var i = container.childNodes.length - 1; i >= 0; i--) {
                var el = container.childNodes[i];
                if(first)
                    doc.insertBefore(el, first);
                else
                    doc.appendChild(el);
                first = el;
            }
            return doc;
        },

        getNumberFromEndOfString: function(str) {
            var matches = str.match(/\d+$/),
                id = matches ? parseInt(matches[0], 10) : -1;

            return id;
        },

        getCellByCoord: function(x, y) {
            var cellVisiblePosition = this.getCellVisiblePositionByCoords(x, y);

            var cellLayoutInfo = this.getCellLayoutInfo(cellVisiblePosition.colIndex, cellVisiblePosition.rowIndex);
            return cellLayoutInfo;
        },
        convertVisiblePositionToModelPosition: function(colIndex, rowIndex) {
            return {
                colIndex: this.convertVisibleIndexToModelIndex(colIndex, true),
                rowIndex: this.convertVisibleIndexToModelIndex(rowIndex, false)
            };
        },

        getTileSize: function(isCol) {
            return isCol ? this.tileSize.col : this.tileSize.row;
        },
        findCellPositionInTileInfo: function(visibleIndex, isCol) {
            var tileSize = this.getTileSize(isCol);
            var tileIndex = Math.floor(visibleIndex / tileSize);
            var cellIndexInTile = visibleIndex - tileIndex * tileSize;
            return {
                tileSize: tileSize,
                tileIndex: tileIndex,
                cellIndexInTile: cellIndexInTile
            };
        },

        convertVisibleIndexToModelIndex: function(visibleIndex, isCol) {
            var cellPosInTile = this.findCellPositionInTileInfo(visibleIndex, isCol),
                headerInfo = this.getHeaderInfo(cellPosInTile.tileIndex, isCol),
                modelIndex = -1;

            if(!headerInfo || this.getHeaderTileIsClientTemporal(headerInfo))
                return modelIndex;

            modelIndex = headerInfo.modelIndices[cellPosInTile.cellIndexInTile];

            modelIndex = isCol ? Math.min(modelIndex, ASPxClientSpreadsheet.Range.MAX_COL_INDEX) : modelIndex = Math.min(modelIndex, ASPxClientSpreadsheet.Range.MAX_ROW_INDEX);

            return modelIndex;
        },
        convertFormulaRangeToVisibleRange: function(modelTopLeftIndex, modelBottomRightIndex, isCol) {
            var visibleTopLeftIndex = this.convertModelIndexToVisibleIndex(modelTopLeftIndex, isCol);
            var visibleBottomRightIndex = this.convertModelIndexToVisibleIndex(modelBottomRightIndex, isCol);
            if(visibleBottomRightIndex < 0 && visibleTopLeftIndex < 0)
                return { visibleTopLeftIndex: -1, visibleBottomRightIndex: -1 };

            if(visibleTopLeftIndex < 0)
                visibleTopLeftIndex = this.findExistVisibleIndexForComplexBoxesOrFormulaRange(modelTopLeftIndex, isCol);
            if(visibleBottomRightIndex < 0)
                visibleBottomRightIndex = this.findExistVisibleIndexForComplexBoxesOrFormulaRange(modelBottomRightIndex, isCol, true);

            if(visibleTopLeftIndex == -1 || visibleBottomRightIndex == -1) {
                var modelRangeIntersectsVisibleRange = this.getIsModelRangeIntersectsVisibleRange(modelTopLeftIndex, modelBottomRightIndex, isCol);
                if(modelRangeIntersectsVisibleRange) {
                    var visibleVisibleCellRange = this.getVisibleVisibleCellRange();
                    if(visibleTopLeftIndex == -1)
                        visibleTopLeftIndex = isCol ? visibleVisibleCellRange.top : visibleVisibleCellRange.left;
                    if(visibleBottomRightIndex == -1)
                        visibleBottomRightIndex = isCol ? visibleVisibleCellRange.bottom : visibleVisibleCellRange.right;
                }
            }
            return { visibleTopLeftIndex: visibleTopLeftIndex, visibleBottomRightIndex: visibleBottomRightIndex };
        },
        convertModelIndicesRangeToVisibleIndices: function(modelTopLeftIndex, modelBottomRightIndex, isCol) {
            var visibleTopLeftIndex = this.convertModelIndexToVisibleIndex(modelTopLeftIndex, isCol),
                rangeExistOnClient = { topLeft: true, bottomRight: true };
            if(visibleTopLeftIndex < 0)
                visibleTopLeftIndex = this.findExistVisibleIndexForComplexBoxesOrFormulaRange(modelTopLeftIndex, isCol);

            var visibleBottomRightIndex = this.convertModelIndexToVisibleIndex(modelBottomRightIndex, isCol);
            if(visibleBottomRightIndex < 0)
                visibleBottomRightIndex = this.findExistVisibleIndexForComplexBoxesOrFormulaRange(modelBottomRightIndex, isCol);

            //NOTE: (T223707) indeces can be negative if
            //not all range (some tiles in range) has on client side
            if(visibleTopLeftIndex < 0) {
                visibleTopLeftIndex = modelTopLeftIndex;
                rangeExistOnClient.topLeft = false;
            }
            if(visibleBottomRightIndex < 0) {
                visibleBottomRightIndex = modelBottomRightIndex;
                rangeExistOnClient.bottomRight = false;
            }

            return { visibleTopLeftIndex: visibleTopLeftIndex, visibleBottomRightIndex: visibleBottomRightIndex, rangeExist: rangeExistOnClient };
        },
        getIsModelRangeIntersectsVisibleRange: function(modelTopLeftIndex, modelBottomRightIndex, isCol) {
            var visibleModelCellRange = this.getVisibleModelCellRange();
            if(isCol)
                return modelTopLeftIndex <= visibleModelCellRange.bottom && modelBottomRightIndex >= visibleModelCellRange.top;
            return modelTopLeftIndex <= visibleModelCellRange.right && modelBottomRightIndex >= visibleModelCellRange.left;
        },
        convertModelIndexToVisibleIndex: function(modelIndex, isCol) {
            if(!ASPxClientSpreadsheet.Range.isAllowableIndex(isCol, modelIndex))
                return this.getEndOfDocumentCellInfo(isCol).visibleIndex;
            var headerInfo = this.findHeaderInfoByCellModelIndex(modelIndex, isCol);
            if(!headerInfo || this.getHeaderTileIsClientTemporal(headerInfo))
                return -1;

            var tileSize = this.getTileSize(isCol);
            for(var i = 0; i < tileSize; i++) {
                if(headerInfo.modelIndices[i] == modelIndex) {
                    var cellVisibleIndexInTile = i;
                    var cellBeforeCurrentTile = tileSize * headerInfo.index;
                    var cellVisibleIndex = cellBeforeCurrentTile + cellVisibleIndexInTile;
                    return cellVisibleIndex;
                }
            }
            return -1;
        },
        // TODO refactor it
        findFirstVisibleIndexOnASCDirection: function(modelIndex, isCol) {
            var headers = this.getTileMatrix().getHeaderInfoArray(isCol),
                tileSize = this.getTileSize(isCol),
                visibleIndex = -1;
            if(headers) {
                var len = headers.length,
                    searchedHeaderInfo,
                    i;
                for(i = 0; i < len; i++) {
                    var headerInfo = headers[i];
                    if(!this.getHeaderTileIsClientTemporal(headerInfo)) {
                        var firstIndex = headerInfo.modelIndices[0],
                            lastIndex = headerInfo.modelIndices[headerInfo.modelIndices.length - 1];
                        if(modelIndex >= firstIndex && modelIndex <= lastIndex) {
                            searchedHeaderInfo = headerInfo;
                            break;
                        }
                    }
                }
                if(searchedHeaderInfo) {
                    len = searchedHeaderInfo.modelIndices.length;
                    for(i = 0; i < len; i++)
                        if(searchedHeaderInfo.modelIndices[i] >= modelIndex) {
                            var cellVisibleIndexInTile = i;
                            var cellBeforeCurrentTile = tileSize * searchedHeaderInfo.index;
                            visibleIndex = cellBeforeCurrentTile + cellVisibleIndexInTile;
                            break;
                        }
                } else {
                    visibleIndex = this.tryToFindExistVisibleIndexBetweenTiles(modelIndex, isCol);
                }
            }
            if(visibleIndex === -1)
                visibleIndex = isCol ? this.getFirstVisibleColumnIndex() : this.getFirstVisibleRowIndex();
            return visibleIndex;
        },
        findFirstVisibleIndexOnDESCDirection: function(modelIndex, isCol) {
            var headers = this.getTileMatrix().getHeaderInfoArray(isCol),
                tileSize = this.getTileSize(isCol),
                visibleIndex = -1;
            if(headers) {
                var len = headers.length,
                    searchedHeaderInfo;
                for(var i = 0; i < len; i++) {
                    var headerInfo = headers[i];
                    if(!this.getHeaderTileIsClientTemporal(headerInfo)) {
                        var firstIndex = headerInfo.modelIndices[0],
                            lastIndex = headerInfo.modelIndices[headerInfo.modelIndices.length - 1];
                        if(modelIndex >= firstIndex && modelIndex <= lastIndex) {
                            searchedHeaderInfo = headerInfo;
                            break;
                        }
                    }
                }
                if(searchedHeaderInfo) {
                    len = searchedHeaderInfo.modelIndices.length;
                    while(len--)
                        if(searchedHeaderInfo.modelIndices[len] <= modelIndex) {
                            var cellVisibleIndexInTile = len;
                            var cellBeforeCurrentTile = tileSize * searchedHeaderInfo.index;
                            visibleIndex = cellBeforeCurrentTile + cellVisibleIndexInTile;
                            break;
                        }
                } else {
                    visibleIndex = this.tryToFindExistVisibleIndexBetweenTiles(modelIndex, isCol);
                }
            }
            if(visibleIndex === -1)
                visibleIndex = isCol ? this.getLastVisibleColumnIndex() : this.getLastVisibleRowIndex();
            return visibleIndex;
        },
        tryToFindExistVisibleIndexBetweenTiles: function(modelIndex, isCol) {
            var matrix = this.getTileMatrix(),
                boundaryArray = matrix.getModelIndecesBoundaryPositions(isCol),
                len = boundaryArray.length;
            for(var i = 0; i < len; i += 2) {
                if((boundaryArray[i + 1] - boundaryArray[i] > 1) && boundaryArray[i] < modelIndex && boundaryArray[i + 1] > modelIndex)
                    return boundaryArray[i + 1] - 1;
            }
            return -1;
        },

        getComplexBoxesArray: function() {
            return this.complexBoxes;
        },
        addComplexBox: function(complexBox) {
            return this.complexBoxes.push(complexBox);
        },

        convertModelRangeToVisible: function(range) {
            var convertedRange = range.clone();
            convertedRange.isVisible = true;
            var modelColRange = this.convertFormulaRangeToVisibleRange(
                convertedRange.leftColIndex,
                convertedRange.rightColIndex,
                true);

            var modelRowRange = this.convertFormulaRangeToVisibleRange(
                convertedRange.topRowIndex,
                convertedRange.bottomRowIndex,
                false);

            if(modelColRange.visibleTopLeftIndex < 0 && modelColRange.visibleBottomRightIndex < 0 ||
                modelRowRange.visibleTopLeftIndex < 0 && modelRowRange.visibleBottomRightIndex < 0)
                convertedRange.isVisible = false;

            convertedRange.leftColIndex = modelColRange.visibleTopLeftIndex;
            convertedRange.rightColIndex = modelColRange.visibleBottomRightIndex;
            convertedRange.topRowIndex = modelRowRange.visibleTopLeftIndex;
            convertedRange.bottomRowIndex = modelRowRange.visibleBottomRightIndex;
            return convertedRange;
        },
        findHeaderInfoByCellModelIndex: function(modelIndex, isCol) {
            var tileSize = this.getTileSize(isCol);
            var headerInfo = null;

            var matrix = this.getTileMatrix();
            matrix.findHeaderInfo(isCol, function(curHeaderInfo) {
                if(this.getHeaderTileIsClientTemporal(curHeaderInfo)) return;
                if(curHeaderInfo.modelIndices[0] <= modelIndex && modelIndex <= curHeaderInfo.modelIndices[tileSize - 1]) {
                    headerInfo = curHeaderInfo;
                    return true;
                }
            }.aspxBind(this));
            return headerInfo;
        },
        getCellVisiblePositionByCoords: function(x, y) {
            var headerOffsetSize = this.parentPane.getHeaderOffsetSizeForMousePointer();

            x -= headerOffsetSize.width;
            y -= headerOffsetSize.height;

            var anchor = this.getPaneTopLeftCellVisiblePosition();
            var colIndex = this.calculateVisibleBoundIndex(anchor, true, x, true, true);
            var rowIndex = this.calculateVisibleBoundIndex(anchor, false, y, true, true);
            return {
                colIndex: colIndex,
                rowIndex: rowIndex
            };
        },
        getCellLayoutInfo_ByModelIndices: function(colModelIndex, rowModelIndex) {
            var colVisibleIndex = this.convertModelIndexToVisibleIndex(colModelIndex, true);
            var rowVisibleIndex = this.convertModelIndexToVisibleIndex(rowModelIndex, false);
            return this.getCellLayoutInfo(colVisibleIndex, rowVisibleIndex);
        },
        getCellLayoutInfo: function(colVisibleIndex, rowVisibleIndex) {
            if(colVisibleIndex < 0 || rowVisibleIndex < 0)
                return new ASPxClientSpreadsheet.TileHelper.CellLayoutInfo(null, colVisibleIndex, rowVisibleIndex);

            var cellModelPosition = this.convertVisiblePositionToModelPosition(colVisibleIndex, rowVisibleIndex);

            var tilePosition = ASPxClientSpreadsheet.CellHelper.getCellTilePosition(this.getRenderHelper(), colVisibleIndex, rowVisibleIndex);

            var tileInfo = this.getGridTileInfo(tilePosition.row, tilePosition.col);

            var cellPositionInTile = this.getCellPositionInTile(tilePosition, colVisibleIndex, rowVisibleIndex);
            var rectangle = this.getCellRectInsideTile(tilePosition, cellPositionInTile);
            if(rectangle && cellModelPosition.colIndex >= 0 && cellModelPosition.rowIndex >= 0)
                return new ASPxClientSpreadsheet.TileHelper.CellLayoutInfo(tileInfo,
                    colVisibleIndex, rowVisibleIndex,
                    cellModelPosition.colIndex, cellModelPosition.rowIndex,
                    rectangle, this.getPaneType());
            return null;
        },
        // NOTE: can return NULL if there is not such a tile in cache
        getCellRectInsideTile: function(tilePosition, cellPositionInTile) {
            var colHeaderInfo = this.getHeaderInfo(tilePosition.col, true);
            var rowHeaderInfo = this.getHeaderInfo(tilePosition.row, false);
            if(!colHeaderInfo || !rowHeaderInfo)
                return null;

            return {
                x: colHeaderInfo.incrementalWidths[cellPositionInTile.colIndex],
                y: rowHeaderInfo.incrementalHeights[cellPositionInTile.rowIndex],
                width: this.getTileSizes(tilePosition.col, true)[cellPositionInTile.colIndex],
                height: this.getTileSizes(tilePosition.row, false)[cellPositionInTile.rowIndex]
            };
        },
        getCellPositionInTile: function(tilePosition, colIndex, rowIndex) {
            var colIndexInTile = colIndex - tilePosition.col * this.tileSize.col;
            var rowIndexInTile = rowIndex - tilePosition.row * this.tileSize.row;
            return { colIndex: colIndexInTile, rowIndex: rowIndexInTile };
        },
        getCellEditingText: function(colModelIndex, rowModelIndex) {
            var cellEditingText = this.getCellEditingTextCore(colModelIndex, rowModelIndex);
            if(ASPx.IsExists(cellEditingText))
                return cellEditingText;
            return this.getCellValue(colModelIndex, rowModelIndex);
        },
        getCellEditingTextCore: function(colModelIndex, rowModelIndex) {
            var cellTileInfo = this.getCellTileInfo_ByModelIndex(colModelIndex, rowModelIndex);
            return cellTileInfo ? cellTileInfo.editTexts[colModelIndex + "|" + rowModelIndex] : null;
        },
        getCellValue: function(colModelIndex, rowModelIndex) {
            var variantValue = this.getCellVariantValue(colModelIndex, rowModelIndex);
            return variantValue == null ? null : variantValue.value;
        },
        getCellVariantValue: function(colModelIndex, rowModelIndex) {
            var cellTileInfo = this.getCellTileInfo_ByModelIndex(colModelIndex, rowModelIndex);
            var strVariantValue = cellTileInfo ? cellTileInfo.values[colModelIndex + "|" + rowModelIndex] : cellTileInfo;
            if(strVariantValue) {
                var variantValue = strVariantValue.split("|");
                return {
                    type: variantValue[0],
                    value: strVariantValue.substr(variantValue[0].length + 1)
                };
            }
            return null;
        },
        getCellTileInfo_ByModelIndex: function(colModelIndex, rowModelIndex) {
            var colVisibleIndex = this.convertModelIndexToVisibleIndex(colModelIndex, true);
            if(colVisibleIndex < 0)
                colVisibleIndex = this.findExistVisibleIndexForComplexBoxesOrFormulaRange(colModelIndex, true);
            var rowVisibleIndex = this.convertModelIndexToVisibleIndex(rowModelIndex, false);
            if(rowVisibleIndex < 0)
                rowVisibleIndex = this.findExistVisibleIndexForComplexBoxesOrFormulaRange(rowModelIndex, false);

            var tilePosition = ASPxClientSpreadsheet.CellHelper.getCellTilePosition(this.getRenderHelper(), colVisibleIndex, rowVisibleIndex);

            return this.getGridTileInfo(tilePosition.row, tilePosition.col);
        },
        // Comments
        getCommentInfo: function(colModelIndex, rowModelIndex) {
            var visibleRange = this.getVisibleRange();
            for(var i = visibleRange.top; i <= visibleRange.bottom; i++) {
                for(var j = visibleRange.left; j <= visibleRange.right; j++) {
                    var tilInfo = this.getGridTileInfo(i, j),
                        commentBoxes = tilInfo.json.R,
                        len = commentBoxes ? commentBoxes.length : 0;
                    while(len--) {
                        var comment = commentBoxes[len];
                        if(comment.P[1] === colModelIndex && comment.P[0] === rowModelIndex)
                            return comment;
                    }
                }
            }
            return null;
        },
        getCellComment: function(colModelIndex, rowModelIndex) {
            var visibleRange = this.getVisibleRange();
            for(var i = visibleRange.top; i <= visibleRange.bottom; i++) {
                for(var j = visibleRange.left; j <= visibleRange.right; j++) {
                    var tilInfo = this.getGridTileInfo(i, j),
                        comments = tilInfo.comments || {},
                        value = comments[colModelIndex + "|" + rowModelIndex];
                    if(value)
                        return value;
                }
            }
            return null;
        },
        getCommentViewOptions: function(commentId) {
            var visibleRange = this.getVisibleRange();
            for(var i = visibleRange.top; i <= visibleRange.bottom; i++) {
                for(var j = visibleRange.left; j <= visibleRange.right; j++) {
                    var tilInfo = this.getGridTileInfo(i, j),
                        commentBoxes = tilInfo.json.R,
                        len = commentBoxes ? commentBoxes.length : 0;
                    while(len--) {
                        var commentBox = commentBoxes[len];
                        if(commentBox.P[2] === commentId) {
                            return {
                                paneType: this.getPaneType(),
                                tileHelper: this,
                                tileInfo: tilInfo
                            };
                        }
                    }
                }
            }
            return null;
        },
        // Complex boxes
        resetComplexBoxes: function() {
            this.getComplexBoxesArray().reset();
        },
        findExistVisibleIndexForComplexBoxesOrFormulaRange: function(modelIndex, isCol, findLess) {
            var headerInfo = this.findHeaderInfoByCellModelIndex(modelIndex, isCol),
                tileSize = this.getTileSize(isCol);
            if(!headerInfo || this.getHeaderTileIsClientTemporal(headerInfo))
                return this.tryToFindExistVisibleIndexBetweenTiles(modelIndex, isCol);

            for(var i = 0; i < tileSize; i++) {
                if(headerInfo.modelIndices[i] >= modelIndex) {
                    var cellVisibleIndexInTile = findLess ? i - 1 : i;
                    var cellBeforeCurrentTile = tileSize * headerInfo.index;
                    var cellVisibleIndex = cellBeforeCurrentTile + cellVisibleIndexInTile;
                    return cellVisibleIndex;
                }
            }
            throw new Error("Can't find visible index");
        },

        getMergedCellRangesIntersectsRange: function(visibleRange) {
            var complexBoxes = this.getComplexBoxesArray();
            return complexBoxes.getMergedCellRangesIntersectsRange(visibleRange);
        },

        isMergerCellContainsInCroppedRange: function(visibleCellPosition) {
            return this.getComplexBoxesArray().cellIsInCroppedRanges(visibleCellPosition.colIndex, visibleCellPosition.rowIndex);
        },

        // Header visible range
        getHeaderScrollBounds: function() { return this.headerScrollBounds; },
        getHeaderVisibleRange: function() { return this.headerVisibleRange; },
        setHeaderVisibleRange: function(range) {
            var changed = this.headerVisibleRange.top !== range.top || this.headerVisibleRange.right !== range.right || this.headerVisibleRange.bottom !== range.bottom || this.headerVisibleRange.left !== range.left;
            if(changed) {
                this.headerVisibleRange = range;
                this.onHeaderVisibleRangeChanged();
            }
        },
        onHeaderVisibleRangeChanged: function() {
            var headerVisibleRange = this.getHeaderVisibleRange();
            this.setLastVisibleHeaderRowTileIndex(headerVisibleRange.bottom);
            this.adjustControls();

            this.removeInvisibleTiles(headerVisibleRange, true);
            this.headerScrollBounds = this.calculateScrollBounds(headerVisibleRange);
        },

        loadGridTiles: function(visibleRange) {
            var tilInfo;
            for(var i = visibleRange.top; i <= visibleRange.bottom; i++) {
                for(var j = visibleRange.left; j <= visibleRange.right; j++) {
                    tilInfo = this.getGridTileInfo(i, j);
                    this.insertGridTile(tilInfo);
                }
            }
        },

        resetCellVisibleRange: function() {
            this.cellVisibleRange = null;
        },

        createCellVisibleRange: function(visibleRange) {
            return {
                left: (visibleRange.left) * this.tileSize.col,
                top: (visibleRange.top) * this.tileSize.row,
                right: (visibleRange.right + 1) * this.tileSize.col - 1,
                bottom: (visibleRange.bottom + 1) * this.tileSize.row - 1
            };
        },
        getCellVisibleRange: function() {
            if(!this.cellVisibleRange)
                this.cellVisibleRange = this.createCellVisibleRange(this.getVisibleRange());
            return this.cellVisibleRange;
        },
        getCellHeaderVisibleRange: function() {
            if(!this.cellHeaderVisibleRange)
                this.cellHeaderVisibleRange = this.createCellVisibleRange(this.getHeaderVisibleRange());
            return this.cellHeaderVisibleRange;
        },

        getFirstVisibleColumnIndex: function() {
            var cellVisibleRange = this.getCellVisibleRange();
            return cellVisibleRange.left;
        },
        getLastVisibleColumnIndex: function() {
            var cellVisibleRange = this.getCellVisibleRange();
            return cellVisibleRange.right;
        },
        getFirstVisibleRowIndex: function() {
            var cellVisibleRange = this.getCellVisibleRange();
            return cellVisibleRange.top;
        },
        getLastVisibleRowIndex: function() {
            var cellVisibleRange = this.getCellVisibleRange();
            return cellVisibleRange.bottom;
        },

        putCellColIndexInVisibleRange: function(colIndex) {
            var cellVisibleRange = this.getCellVisibleRange();
            if(colIndex < cellVisibleRange.left) {
                colIndex = cellVisibleRange.left;
            }
            if(colIndex > cellVisibleRange.right) {
                colIndex = cellVisibleRange.right;
            }
            return colIndex;
        },
        putCellRowIndexInVisibleRange: function(rowIndex) {
            var cellVisibleRange = this.getCellVisibleRange();
            if(rowIndex < cellVisibleRange.top) {
                rowIndex = cellVisibleRange.top;
            }
            if(rowIndex > cellVisibleRange.bottom) {
                rowIndex = cellVisibleRange.bottom;
            }
            return rowIndex;
        },
        putTileColIndexInVisibleRange: function(colIndex) {
            if(colIndex < this.visibleRange.left) {
                colIndex = this.visibleRange.left;
            }
            if(colIndex > this.visibleRange.right) {
                colIndex = this.visibleRange.right;
            }
            return colIndex;
        },
        putTileRowIndexInVisibleRange: function(rowIndex) {
            if(rowIndex < this.visibleRange.top) {
                rowIndex = this.visibleRange.top;
            }
            if(rowIndex > this.visibleRange.bottom) {
                rowIndex = this.visibleRange.bottom;
            }
            return rowIndex;
        },

        correctRectForGridLine: function(rect) { // TODO find if it still used?
            var gridLineSize = 1;
            rect.x += gridLineSize;
            rect.y += gridLineSize;
            rect.width -= gridLineSize;
            rect.height -= gridLineSize;
            return rect;
        },
        loadHeaderTiles: function(newVisibleRange) {
            if(!newVisibleRange) {
                var viewBoundRange = this.calculateViewBoundRange(this.getScrollAnchorVisiblePosition(), this.getRenderHelper().getGridOffsetSize());
                if(!viewBoundRange) return; // WORKAROUND for IE9-

                newVisibleRange = this.calculateVisibleRange(viewBoundRange);
            }
            var matrix = this.getTileMatrix();
            var headerInfo;
            if(this.getRowHeaderTilesContainer()) {
                for(var i = newVisibleRange.top; i <= newVisibleRange.bottom; i++) {
                    headerInfo = matrix.getHeaderInfo(i, false);
                    if(!headerInfo) {
                        headerInfo = this.getDefaultHeaderInfo(i, false);
                        matrix.insertHeaderInfo(headerInfo, false);
                    }
                    this.insertHeaderTile(headerInfo, false);
                }
            }
            if(this.getColumnHeaderTilesContainer()) {
                for(var j = newVisibleRange.left; j <= newVisibleRange.right; j++) {
                    headerInfo = matrix.getHeaderInfo(j, true);
                    if(!headerInfo) {
                        headerInfo = this.getDefaultHeaderInfo(j, true);
                        matrix.insertHeaderInfo(headerInfo, true);
                    }
                    this.insertHeaderTile(headerInfo, true);
                }
            }
            this.setHeaderVisibleRange(newVisibleRange);
        },
        getDefaultHeaderInfo: function(tileIndex, isCol) {
            var headerInfo = this.cloneDefaultHeaderInfo(tileIndex, isCol);
            headerInfo.index = tileIndex;
            headerInfo.htmlElement.id = this.getRenderHelper().getHeaderTileElementId(tileIndex, isCol, this.getPaneType());
            this.populateHeaderTextCells(headerInfo.htmlElement, headerInfo, isCol);

            var headerContainer = ASPx.GetChildByClassName(headerInfo.htmlElement, ASPx.SpreadsheetCssClasses.HeaderContainer);
            if(headerContainer)
                headerContainer.setAttribute(ASPxClientSpreadsheet.TileHelper.DataAttributes.HeaderContainerTileIndex, tileIndex);
            return headerInfo;
        },
        cloneDefaultHeaderInfo: function(tileIndex, isCol) {
            var info = ASPx.CloneObject(this.getDefaultHeaderInfoTemplate(tileIndex, isCol));
            info.htmlElement = info.htmlElement.cloneNode(true);
            return info;
        },
        getDefaultHeaderInfoTemplate: function(tileIndex, isCol) {
            var headerInfo = isCol ? this.defaultColHeaderInfo : this.defaultRowHeaderInfo;
            if(!headerInfo) {
                headerInfo = this.createDefaultHeaderInfo(tileIndex, isCol);
                if(isCol)
                    this.defaultColHeaderInfo = headerInfo;
                else
                    this.defaultRowHeaderInfo = headerInfo;
            }
            return headerInfo;
        },
        createDefaultHeaderInfo: function(tileIndex, isCol) {
            var sizeName = isCol ? "widths" : "heights";
            var totalSizeName = isCol ? "totalWidth" : "totalHeight";
            var cellSize = isCol ? this.getDefaultCellSize().width : this.getDefaultCellSize().height;
            var tileSize = isCol ? this.tileSize.col : this.tileSize.row;
            var sizes = [];
            for(var i = 0; i < tileSize; i++)
                sizes.push(cellSize);
            var headerInfo = {};
            headerInfo[sizeName] = sizes;
            headerInfo[totalSizeName] = cellSize * tileSize;
            headerInfo.index = -1;
            headerInfo.htmlElement = this.createHeaderTemplate(tileIndex, isCol);
            this.assignHeaderContentSizes(headerInfo.htmlElement, headerInfo, isCol);
            return headerInfo;
        },
        getHeaderTileIsClientTemporal: function(headerInfo) {
            return !ASPx.IsExists(headerInfo.modelIndices);
        },

        // HighLight selection
        highlightHeaders: function(selection) {
            this.clearHeaderSelection();
            var cellVisibleRange = this.getCellVisibleRange(),
                beginColumnIndex = selection.allSelected ? cellVisibleRange.left : selection.range.leftColIndex,
                endColumnIndex = selection.allSelected ? cellVisibleRange.right : selection.range.rightColIndex,
                beginRowIndex = selection.allSelected ? cellVisibleRange.top : selection.range.topRowIndex,
                endRowIndex = selection.allSelected ? cellVisibleRange.bottom : selection.range.bottomRowIndex;

            this.highlightHeadersCore(beginColumnIndex, endColumnIndex, true);
            this.highlightHeadersCore(beginRowIndex, endRowIndex, false);
        },
        clearHeaderSelection: function() {
            while(this.highlightHeadersArray.length > 0) {
                var headerCell = this.highlightHeadersArray.pop();
                ASPx.RemoveClassNameFromElement(headerCell, "dxss-hlh");
            }
        },
        highlightHeadersCore: function(startIndex, endIndex, isCol) {
            if(this.endOfDocumentReachedByIndex(isCol, endIndex))
                endIndex = Math.min(endIndex, this.getEndOfDocumentCellInfo(isCol).modelIndex);
            for(var i = startIndex; i <= endIndex; i++) {
                var headerCell = this.getHeaderCellByIndex(i, isCol);
                if(headerCell && !ASPx.ElementContainsCssClass(headerCell, "dxss-hlh")) {
                    ASPx.AddClassNameToElement(headerCell, "dxss-hlh");
                    this.highlightHeadersArray.push(headerCell);
                }
            }
        },
        getHeaderCellByIndex: function(index, isCol) {
            var columnContainer = isCol ? this.getRenderHelper().getColumnHeader(this.getPaneType()) : this.getRenderHelper().getRowHeader(this.getPaneType());
            if(columnContainer) {
                var headers = ASPx.GetNodesByClassName(columnContainer, ASPx.SpreadsheetCssClasses.HeaderContainer),
                    tileSize = isCol ? this.tileSize.col : this.tileSize.row,
                    tileIndex = Math.floor(index / tileSize),
                    cellContainer = this.getCellContainer(headers, tileIndex);
                if(cellContainer)
                    return cellContainer.childNodes[index - tileIndex * tileSize];
            }
            return null;
        },
        getCellContainer: function(headersArray, tileIndex) {
            for(var i in headersArray) {
                if(ASPx.Attr.GetAttribute(headersArray[i], ASPxClientSpreadsheet.TileHelper.DataAttributes.HeaderContainerTileIndex) == tileIndex)
                    return headersArray[i];
            }
            return null;
        },

        isSelectionVisible: function(selection) {
            if(selection.isAllSelected) return true;

            var cellVisibleRange = this.getCellVisibleRange();

            if(selection.range.bottomRowIndex < cellVisibleRange.top) return false;
            if(selection.range.topRowIndex > cellVisibleRange.bottom) return false;

            if(selection.range.rightColIndex < cellVisibleRange.left) return false;
            return selection.range.leftColIndex <= cellVisibleRange.right;
        },

        // Multy panes working
        cellInVisibleRange: function(cellModelPosition) {
            var cellVisibleRange = this.getCellVisibleRange();
            if(cellModelPosition.col >= cellVisibleRange.left && cellModelPosition.col <= cellVisibleRange.right &&
                cellModelPosition.row >= cellVisibleRange.top && cellModelPosition.row <= cellVisibleRange.bottom)
                return this;
            return null;
        },

        // TileMatrix worker API
        getTileTotalSize: function(index, isCol) {
            return this.getTileMatrix().getTileTotalSize(index, isCol);
        },
        getTileSizes: function(index, isCol) {
            return this.getTileMatrix().getTileSizes(index, isCol);
        },
        getTileIncrementalRanges: function(index, isCol) {
            return this.getTileMatrix().getTileIncrementalRanges(index, isCol);
        },
        getGridTileInfo: function(rowIndex, colIndex) {
            return this.getTileMatrix().getGridTileInfo(rowIndex, colIndex);
        },
        getHeaderInfo: function(index, isCol) {
            return this.getTileMatrix().getHeaderInfo(index, isCol);
        },
        // AutoFilters
        processAutoFilters: function(newAutoFilterConfigArray, paneManager) {
            this.prepareAutoFilterConfigArray(newAutoFilterConfigArray, paneManager, this.autoFilters, ASPxClientSpreadsheet.AutoFilterConfig);
            this.renderAutoFilterImages(this.autoFilters);
            this.afterAutoFilterConfigSyncronization(this.autoFilters);
        },
        prepareAutoFilterConfigArray: function(newAutoFilterConfigArray, paneManager, autoFilterCollection, autoFilterType) {
            if(typeof (newAutoFilterConfigArray) !== "undefined") {
                ASPx.Data.ForEach(newAutoFilterConfigArray, function(rawConfig) {
                    var autoFilterConfig = new autoFilterType(rawConfig, paneManager);
                    autoFilterCollection.updateElement(autoFilterConfig);
                }.aspxBind(this));
            }
            autoFilterCollection.setElementsDeleted();
        },
        renderAutoFilterImages: function(autoFilterCollection) {
            autoFilterCollection.updateElementsRender();
        },
        afterAutoFilterConfigSyncronization: function(autoFilterCollection) {
            autoFilterCollection.removeDeletedElements();
            autoFilterCollection.resetState();
        },
        processPivotTableAutoFilters: function(newAutoFilterConfigArray, paneManager) {
            this.prepareAutoFilterConfigArray(newAutoFilterConfigArray, paneManager, this.pivotTableAutoFilters, ASPxClientSpreadsheet.PivotTableAutoFilterConfig);
            this.renderAutoFilterImages(this.pivotTableAutoFilters);
            this.afterAutoFilterConfigSyncronization(this.pivotTableAutoFilters);
        },
        updateAutoFilterImages: function() {
            this.renderAutoFilterImages(this.autoFilters);
            this.renderAutoFilterImages(this.pivotTableAutoFilters);
        }
    });

    ASPxClientSpreadsheet.TileHelper.DataAttributes = {
        HeaderContainerTileIndex: "data-tile-index",
        HeaderCellIndex: "data-header-cell-index"
    };

    ASPxClientSpreadsheet.CellHelper = (function() {
        var CellHelper = {};

        CellHelper.getCellTilePosition = function(renderHelper, cellCol, cellRow) {
            return {
                col: Math.floor(cellCol / renderHelper.getTileSize().col),
                row: Math.floor(cellRow / renderHelper.getTileSize().row)
            };
        };

        CellHelper.mergeCellRects = function(leftTopRect, rightBottomRect) {
            return {
                x: leftTopRect.x,
                y: leftTopRect.y,
                width: rightBottomRect.x + rightBottomRect.width - leftTopRect.x,
                height: rightBottomRect.y + rightBottomRect.height - leftTopRect.y
            };
        };

        CellHelper.getCellRangeRect = function(topLeftCellLayoutInfo, bottomRightCellLayoutInfo, parentTileInfo) {
            var relativeOffsetLeftTopCornerX = ASPx.GetAbsoluteX(bottomRightCellLayoutInfo.tileInfo.htmlElement) - ASPx.GetAbsoluteX(parentTileInfo.htmlElement),
                relativeOffsetLeftTopCornerY = ASPx.GetAbsoluteY(bottomRightCellLayoutInfo.tileInfo.htmlElement) - ASPx.GetAbsoluteY(parentTileInfo.htmlElement);

            var relativeOffsetRightBottomCornerX = ASPx.GetAbsoluteX(topLeftCellLayoutInfo.tileInfo.htmlElement) - ASPx.GetAbsoluteX(parentTileInfo.htmlElement),
                relativeOffsetRightBottomCornerY = ASPx.GetAbsoluteY(topLeftCellLayoutInfo.tileInfo.htmlElement) - ASPx.GetAbsoluteY(parentTileInfo.htmlElement);

            var bottomRightCellRect = bottomRightCellLayoutInfo.rect;
            bottomRightCellRect.x += relativeOffsetLeftTopCornerX;
            bottomRightCellRect.y += relativeOffsetLeftTopCornerY;

            var topLeftCellRect = topLeftCellLayoutInfo.rect;
            topLeftCellRect.x += relativeOffsetRightBottomCornerX;
            topLeftCellRect.y += relativeOffsetRightBottomCornerY;

            return this.mergeCellRects(topLeftCellRect, bottomRightCellRect);
        };


        CellHelper.getColumnStringRepresentaion = function(modelIndex) {
            var result = "",
                radix = 26,
                firstCharCode = 65;

            while(modelIndex >= 0) {
                result = String.fromCharCode(modelIndex % radix + firstCharCode) + result;
                modelIndex = parseInt(modelIndex / radix) - 1;
            }

            return result;
        };

        CellHelper.getColumnModelIndexByStringRepresentation = function(cellName) {
            var rowIndex = -1,
                colIndex = -1;

            var row = /(\$)?(\d+)/.exec(cellName);
            if(row && row.length > 0)
                rowIndex = parseInt(row[0]) - 1;

            var col = /(\$)?([A-Z]+)/.exec(cellName.toUpperCase());
            if(col && col.length > 0)
                colIndex = getColumnIndex(col[0]);

            return { col: colIndex, row: rowIndex };
        };

        function getColumnIndex(columnName) {
            var result = 0;

            for(var i = 0; i < columnName.length; i++) {
                result += columnName.charCodeAt(i) - 64 + result * 25;
            }
            return result - 1;
        }

        CellHelper.getLinkElementInSelection = function(spreadsheet, selection) {
            var activeCellElement = spreadsheet.getRenderHelper().getActiveCellElement();

            var selectionData = selection.range.singleCell ? getCellAnchorElement(activeCellElement) :
                findLinkElementInRangeSelection(spreadsheet, selection);
            return selectionData;
        };

        function findLinkElementInRangeSelection(spreadsheet, selection) {
            var linkElement = null;
            for(var i = selection.range.leftColIndex; i <= selection.range.rightColIndex; i++) {
                for(var k = selection.range.topRowIndex; k <= selection.range.bottomRowIndex; k++) {
                    var cellElement = spreadsheet.getRenderHelper().getCellElementByVisiblePosition(i, k);
                    if(cellElement) {
                        linkElement = getCellAnchorElement(cellElement);
                        if(linkElement)
                            return linkElement;
                    }
                }
            }
            return linkElement;
        }

        function getCellAnchorElement(cellElement) {
            return ASPx.GetNodeByTagName(cellElement, "a", 0);
        }

        return CellHelper;
    })();

    ASPxClientSpreadsheet.TileHelper.CellLayoutInfo = function(tileInfo, colVisibleIndex, rowVisibleIndex, colModelIndex, rowModelIndex, rect, paneType) {
        this.tileInfo = tileInfo;
        this.colIndex = colVisibleIndex;
        this.rowIndex = rowVisibleIndex;
        this.colModelIndex = colModelIndex;
        this.rowModelIndex = rowModelIndex;
        this.rect = rect;
        this.paneType = paneType;

        validate(this);

        this.assignFrom = function(cellLayoutInfo) {
            this.tileInfo = cellLayoutInfo.tileInfo;
            this.colIndex = cellLayoutInfo.colIndex;
            this.rowIndex = cellLayoutInfo.rowIndex;
            this.colModelIndex = cellLayoutInfo.colModelIndex;
            this.rowModelIndex = cellLayoutInfo.rowModelIndex;
            this.rect = cellLayoutInfo.rect;
            this.paneType = cellLayoutInfo.paneType;
            validate(this);
        };

        function validate(cellLayoutInfo) {
            cellLayoutInfo.valid = cellLayoutInfo.colIndex >= 0 && cellLayoutInfo.rowIndex >= 0;
        }
    };

    ASPxClientSpreadsheet.ComplexBoxArray = (function() {
        var ComplexBoxArray = function() {
            this.arrayElements = [];
        };
        ComplexBoxArray.prototype = {
            length: function() {
                return this.arrayElements.length;
            },

            indexOf: function(complexBox) {
                return ASPx.Data.ArrayIndexOf(this.arrayElements, complexBox, complexBoxComparer);
            },
            contains: function(complexBox) {
                var index = this.indexOf(complexBox);
                return index !== -1;
            },
            indexOfRange: function(range) {
                var len = this.length();
                while(len--) {
                    if(this.arrayElements[len].getModelRange().equals(range))
                        return len;
                }
                return -1;
            },
            add: function() {
                if(!this.contains(complexBox)) {
                    this.arrayElements.push(complexBox);
                    return true;
                }
                return false;
            },
            get: function(index) {
                if(index >= 0 && index < this.length())
                    return this.arrayElements[index];
                return null;
            },
            push: function(complexBox) {
                this.arrayElements.push(complexBox);
            },
            remove: function(complexBox) {
                var index = this.indexOf(complexBox);
                if(index !== -1)
                    this.removeAt(index);
            },
            removeAt: function(index) {
                return ASPx.Data.ArrayRemoveAt(this.arrayElements, index);
            },

            isNotNullOrEmpty: function() {
                return this.arrayElements && this.length() > 0;
            },
            reset: function() {
                var len = this.length();
                while(len--) {
                    var elements = this.arrayElements[len].elements,
                        elementsLength = elements.length;
                    while(elementsLength--)
                        ASPx.RemoveElement(elements[elementsLength]);
                }
                this.arrayElements = [];
            },
            getMergedCellRangesIntersectsRange: function(visibleRange) {
                var len = this.length(),
                    ranges = [];
                while(len--) {
                    if(this.arrayElements[len].intersectsVisibleRange(visibleRange))
                        ranges.push(this.arrayElements[len].getVisibleRange());
                }
                return ranges;
            },
            rangeIsInCroppedRanges: function(visibleRange) {
                var len = this.length();
                while(len--) {
                    var complexBox = this.arrayElements[len];
                    if(complexBox.isRangeCropped() && complexBox.containsVisibleRange(visibleRange)) {
                        return { modelRange: complexBox.getModelRange(), visibleRange: complexBox.getVisibleRange() };
                    }
                }
                return null;
            },
            cellIsInCroppedRanges: function(colIndex, rowIndex) {
                var len = this.length();
                while(len--) {
                    var complexBox = this.arrayElements[len];
                    if(complexBox.isRangeCropped() && complexBox.isCellInVisibleRange(colIndex, rowIndex)) {
                        var modelRange = complexBox.getModelRange();
                        return { modelRange: modelRange, visibleRange: complexBox.getVisibleRange(), topLeftModelCellPostition: { colIndex: modelRange.leftColIndex, rowIndex: modelRange.topRowIndex } };
                    }
                }
                return null;
            }
        };

        function complexBoxComparer(comblexBox1, complexBox2) {
            return comblexBox1.equals(complexBox2);
        }

        return ComplexBoxArray;
    })();

    ASPxClientSpreadsheet.ComplexBox = (function() {
        var ComplexBox = function(leftColModelIndex, topRowModelIndex, rightColModelIndex, bottomRowModelIndex) {
            this.setModelPosition(leftColModelIndex, topRowModelIndex, rightColModelIndex, bottomRowModelIndex);
            this.elements = [];
        };
        ComplexBox.prototype = {
            setModelPosition: function(leftColModelIndex, topRowModelIndex, rightColModelIndex, bottomRowModelIndex) {
                this.modelRange = new ASPxClientSpreadsheet.Range(leftColModelIndex, topRowModelIndex, rightColModelIndex, bottomRowModelIndex);
            },
            setVisiblePosition: function(leftColVisibleIndex, topRowVisibleIndex, rightColVisibleIndex, bottomRowVisibleIndex) {
                this.visibleRange = new ASPxClientSpreadsheet.Range(leftColVisibleIndex, topRowVisibleIndex, rightColVisibleIndex, bottomRowVisibleIndex);
            },

            setModelRange: function(modelRange) {
                this.modelRange = modelRange;
            },
            setVisibleRange: function(visibleRange) {
                this.visibleRange = visibleRange;
            },

            setCoordinates: function(width, height, top, left) {
                this.width = width;
                this.height = height;
                this.top = top;
                this.left = left;
            },

            setAssociatedElement: function(element) {
                this.elements.push(element);
            },

            setRangeIsCropped: function(rangeIsCropped) {
                this.rangeIsCropped = rangeIsCropped;
            },

            setVisibility: function(isVisible) {
                this.isInvisible = !isVisible;
            },
            isVisible: function() {
                return !this.isInvisible;
            },

            clone: function() {
                var clone = new ASPxClientSpreadsheet.ComplexBox(0, 0, 0, 0);

                clone.setModelRange(this.getModelRange());
                clone.setVisibleRange(this.getVisibleRange());
                clone.setCoordinates(this.width, this.height, this.top, this.left);
                clone.setAssociatedElement(this.getAssociatedElement());
                clone.setRangeIsCropped(this.isRangeCropped());
                clone.setVisibility(this.isVisible());

                return clone;
            },
            equals: function(complexBox) {
                return this.getModelRange().equals(complexBox.getModelRange());
            },

            intersectsModelRange: function(modelRange) {
                return this.getModelRange().intersectsRange(modelRange);
            },
            intersectsVisibleRange: function(visibleRange) {
                return this.getVisibleRange().intersectsRange(visibleRange);
            },

            containsModelRange: function(modelRange) {
                return this.getModelRange().containsRange(modelRange);
            },
            containsVisibleRange: function(visibleRange) {
                return this.getVisibleRange().containsRange(visibleRange);
            },

            isCellInModelRange: function(colModelIndex, rowModelIndex) {
                return this.getModelRange().isCellInRange(colModelIndex, rowModelIndex);
            },
            isCellInVisibleRange: function(colVisibleIndex, rowVisibleIndex) {
                return this.getVisibleRange().isCellInRange(colVisibleIndex, rowVisibleIndex);
            },

            // Getters
            getModelRange: function() {
                return this.modelRange;
            },
            getVisibleRange: function() {
                return this.visibleRange;
            },
            getAssociatedElement: function() {
                return this.element;
            },
            getCoordinates: function() {
                return { width: this.width, height: this.height, top: this.top, left: this.left };
            },
            isRangeCropped: function() {
                return this.rangeIsCropped;
            }

        };
        return ComplexBox;
    })();
})();
(function() {
    var defaultAutoFilterImageSize = 17;
    ASPxClientSpreadsheet.AutoFilterConfig = ASPx.CreateClass(null, {
        constructor: function(rawConfig, paneManager) {
            this.colIndex = rawConfig[0];
            this.rowIndex = rawConfig[1];
            this.columnType = rawConfig[2];
            this.imageName = rawConfig[3];
            this.isDefault = rawConfig[4];
            this.paneManager = paneManager;
        },
        equals: function(obj) {
            return this.colIndex === obj.colIndex && this.rowIndex === obj.rowIndex && this.columnType === obj.columnType
                && this.imageName === obj.imageName && this.isDefault === obj.isDefault;
        },
        assign: function(src) {
            this.colIndex = src.colIndex;
            this.rowIndex = src.rowIndex;
            this.columnType = src.columnType;
            this.imageName = src.imageName;
            this.isDefault = src.isDefault;
            this.state = src.state;
        },
        getDefaultCssClassName: function() {
            return ASPx.SpreadsheetCssClasses.AutoFilterImage;
        },
        getImageElement: function() {
            if(!this.imageElement)
                this.createImageElement();
            return this.imageElement;
        },
        renderAutoFilterImage: function() {
            this.createImageElement();
            this.attachEventsToElement();
            this.updateAutoFilterImageElement();
        },
        createImageElement: function() {
            if(!this.needUseSvgForAutoFilterImage()) {
                this.imageElement = document.createElement("div");
            }
            else {                
                this.imageElement = this.paneManager.getRenderHelper().createSvgElement();
            }
        },
        attachEventsToElement: function() {
            ASPx.Evt.AttachEventToElement(this.imageElement, "click", function() {
                this.paneManager.getOwnerControl().onAutoFilterClick(this.imageElement, this.columnType, !this.isDefault);
            }.aspxBind(this));

            ASPx.Evt.AttachEventToElement(this.imageElement, "contextmenu", ASPx.Evt.PreventEventAndBubble);
        },
        insertImageElementToDOM: function() {
            var cellContainer = this.getAutoFilterImageParentContainer();

            if(cellContainer && this.imageElement) {
                cellContainer.appendChild(this.imageElement);
                this.setImageElementPosition(cellContainer);
            }
        },
        setImageElementPosition: function(cellContainer) {
            var imagePosition = this.calculateImageElementPosition();
            this.imageElement.style.left = Math.min(imagePosition.left, this.getMaximumImageElementOffset(cellContainer, true)) + "px";
            this.imageElement.style.top = Math.min(imagePosition.top, this.getMaximumImageElementOffset(cellContainer, false)) + "px";
        },
        getMaximumImageElementOffset: function(cellContainer, isCol) {
            var offset = (isCol) ? cellContainer.offsetWidth : cellContainer.offsetHeight;
            return offset - defaultAutoFilterImageSize;
        },
        calculateImageElementPosition: function() {
            var range = this.getMergedCellsRange();
            return {
                left: this.calculateImageElementOffset(range.leftColIndex, range.rightColIndex, true),
                top: this.calculateImageElementOffset(range.topRowIndex, range.bottomRowIndex, false)
            };
        },
        calculateImageElementOffset: function(startIndex, endIndex, isCol) {
            var cellSize = this.getCellSize(startIndex, endIndex, isCol);
            return cellSize - defaultAutoFilterImageSize;
        },
        getCellSize: function(startIndex, endIndex, isCol) {
            var cellSize = 0;
            for(var i = startIndex; i <= endIndex; i++) 
                cellSize += this.paneManager.getCellSize(i, isCol);
            return cellSize;
        },
        getAutoFilterImageParentContainer: function() {
            var tileSize = this.paneManager.getTileSize(),
                cellContainer = null;
            if(this.cellIsLocatedInSeveralTiles(tileSize)) {
                // cell located on the tile border && document has hidden rows/columns
                var range = this.getMergedCellsRange();
                if(range.leftColIndex !== range.rightColIndex || range.topRowIndex !== range.bottomRowIndex) {
                    // cell is merged and located in 2+ different tiles and we need to find bottom right tile to  add image element
                    var pane = this.paneManager.getPaneByCell({ col: this.colIndex, row: this.rowIndex });
                    if(pane) {
                        var tileHelper = pane.getTileHelper(),
                            visibleRange = tileHelper.getVisibleRange(),
                            cellElementId = this.paneManager.getRenderHelper().getCellContainerElementId(this.rowIndex, this.colIndex, pane.getPaneType());
                        for(var i = visibleRange.top; i <= visibleRange.bottom; i++) {
                            for(var j = visibleRange.left; j <= visibleRange.right; j++) {
                                var tilInfo = tileHelper.getGridTileInfo(i, j);
                                if(tilInfo) {
                                    var parentElement = tilInfo.htmlElement;
                                    if(parentElement) {
                                        var cell = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(parentElement, cellElementId);
                                        if(cell)
                                            cellContainer = cell;
                                    }
                                }
                            }
                        }
                    }
                }
            }
            if(!cellContainer)
                cellContainer = this.paneManager.getCellElementByModelPosition(this.colIndex, this.rowIndex);

            if(!cellContainer)
                cellContainer = this.paneManager.getRenderHelper().createDataCell(this.colIndex, this.rowIndex, "");

            return cellContainer;
        },
        getMergedCellsRange: function() {
            var colVisibleIndex = this.paneManager.convertModelIndexToVisibleIndex(this.colIndex, true),
                rowVisibleIndex = this.paneManager.convertModelIndexToVisibleIndex(this.rowIndex, false);
            return this.paneManager.getSelectionHelper().ExpandRangeToMergedCellSize(new ASPxClientSpreadsheet.Range(colVisibleIndex, rowVisibleIndex));
        },
        cellIsLocatedInSeveralTiles: function(tileSize) {
            var range = this.getMergedCellsRange();
            return Math.floor(range.leftColIndex / tileSize.col) != Math.floor(range.rightColIndex / tileSize.col)
                || Math.floor(range.topRowIndex / tileSize.row) != Math.floor(range.bottomRowIndex / tileSize.row);
        },
        assignImageElementProperties: function() {
            this.assignSpriteProperties(this.imageElement, this.getDefaultCssClassName());
            this.imageElement.setAttribute("r", this.rowIndex);
            this.imageElement.setAttribute("c", this.colIndex);
        },
        assignSpriteProperties: function(imageElement, baseClassName) {
            if(!this.needUseSvgForAutoFilterImage()) {
                imageElement.className = baseClassName + " " + this.getAutoFilterImagesClassName(this.imageName);
            }
            else {
                var className = this.getAutoFilterImagesClassName(this.imageName);
                imageElement.className.baseVal = baseClassName + " dx-img16 " + className;
                var useElement = imageElement.childNodes[0];
                useElement.setAttributeNS('http://www.w3.org/1999/xlink', 'href', "#" + className);
            }
        },
        updateAutoFilterImageElement: function() {
            this.assignImageElementProperties();
            this.insertImageElementToDOM();
        },
        updateAutoFilterImage: function() {
            if(!this.imageElement)
                this.renderAutoFilterImage();
            else
                this.updateAutoFilterImageElement();
        },
        removeAutoFilterImage: function() {
            if(this.imageElement && this.imageElement.parentNode) {
                this.imageElement.parentNode.removeChild(this.imageElement);
                this.imageElement = null;
            }
        },
        getAutoFilterImagesClassName: function(imageName) {
            return this.paneManager.getOwnerControl().getAutoFilterImagesClassName(imageName);
        },
        needUseSvgForAutoFilterImage: function() {
            return this.paneManager.getRenderHelper().needUseSvgImages();
        }
    });

    ASPxClientSpreadsheet.PivotTableAutoFilterConfig = ASPx.CreateClass(ASPxClientSpreadsheet.AutoFilterConfig, {
        constructor: function(rawConfig, paneManager) {
            this.constructor.prototype.constructor.call(this, rawConfig, paneManager);
            this.filterButtonType = rawConfig[4];
            this.fieldIndex = rawConfig[2];
        },
        equals: function(obj) {
            return ASPxClientSpreadsheet.AutoFilterConfig.prototype.equals.call(this, obj) && this.filterButtonType === obj.filterButtonType &&
                this.fieldIndex === obj.fieldIndex;
        },
        assign: function(src) {
            ASPxClientSpreadsheet.AutoFilterConfig.prototype.assign.call(this, src);
            this.filterButtonType = src.filterButtonType;
            this.fieldIndex = src.fieldIndex;
        },
        attachEventsToElement: function() {
            ASPx.Evt.AttachEventToElement(this.imageElement, "click", function() {
                this.paneManager.getOwnerControl().onPivotTableAutoFilterClick(this.imageElement, this.fieldIndex, this.filterButtonType);
            }.aspxBind(this));

            ASPx.Evt.AttachEventToElement(this.imageElement, "contextmenu", ASPx.Evt.PreventEventAndBubble);
        },
    });

    ASPxClientSpreadsheet.AutoFilterConfigArray = (function() {
        var AutoFilterConfigArray = function() {
            this.arrayElements = [];
        };
        AutoFilterConfigArray.prototype = {
            length: function() {
                return this.arrayElements.length;
            },
            indexOf: function(autoFilterConfig) {
                return ASPx.Data.ArrayIndexOf(this.arrayElements, autoFilterConfig, autoFilterConfigComparer);
            },
            get: function(index) {
                if(index >= 0 && index < this.length())
                    return this.arrayElements[index];
                return null;
            },
            push: function(autoFilterConfig) {
                this.arrayElements.push(autoFilterConfig);
            },
            removeAt: function(index) {
                return ASPx.Data.ArrayRemoveAt(this.arrayElements, index);
            },
            updateElement: function(element) {
                var elementIndex = this.indexOf(element);
                if(elementIndex < 0) {
                    element.state = ASPxClientSpreadsheet.ElementState.Added;
                    this.push(element);
                }
                else {
                    var arrayElement = this.get(elementIndex);
                    if(arrayElement.state)
                        return;
                    var equals = arrayElement.equals(element);
                    var newState = (equals) ? ASPxClientSpreadsheet.ElementState.NotChanged : ASPxClientSpreadsheet.ElementState.Updated;
                    if(!equals)
                        this.arrayElements[elementIndex].assign(element);
                    this.arrayElements[elementIndex].state = newState;
                }
            },
            setElementsDeleted: function() {
                ASPx.Data.ForEach(this.arrayElements, function(element) {
                    if(!element.state)
                        element.state = ASPxClientSpreadsheet.ElementState.Deleted;
                }.aspxBind(this));
            },
            removeDeletedElements: function() {
                for(var i = 0; i < this.length;) {
                    if(this.get(i).state === ASPxClientSpreadsheet.ElementState.Deleted)
                        this.removeAt(i);
                    else
                        i++;
                }
            },
            resetState: function() {
                ASPx.Data.ForEach(this.arrayElements, function(element) {
                    element.state = null;
                }.aspxBind(this));
            },
            updateElementsRender: function() {
                ASPx.Data.ForEach(this.arrayElements, function(element) {
                    switch(element.state) {
                        case ASPxClientSpreadsheet.ElementState.Deleted:
                            element.removeAutoFilterImage();
                            break;
                        default:
                            element.updateAutoFilterImage();
                            break;
                    }
                }.aspxBind(this));
            },
            reset: function() {
                this.arrayElements = [];
            }
        };

        function autoFilterConfigComparer(autoFilterConfig1, autoFilterConfig2) {
            return autoFilterConfig1.colIndex === autoFilterConfig2.colIndex && autoFilterConfig1.rowIndex === autoFilterConfig2.rowIndex;
        }

        return AutoFilterConfigArray;
    })();

    ASPxClientSpreadsheet.ElementState = {
        NotChanged: "NotChanged",
        Added: "Added",
        Updated: "Updated",
        Deleted: "Deleted"
    };
})();
(function() {
    ASPxClientSpreadsheet.RenderProvider = ASPx.CreateClass(null, {

        constructor: function(spreadsheetControl) {
            this.spreadsheetControl = spreadsheetControl;
            this.createRenderStrategy();
        },

        updateTileRender: function(tileHelper, receivedTiles, visibleRange) {
            var renderStrategy = this.getRenderStrategy();
            renderStrategy.bindToTileHelper(tileHelper);

            renderStrategy.processRequest(receivedTiles, visibleRange);

            renderStrategy.release();
        },

        onAfterTileRenderUpdated: function(tileHelper, visibleRange) {
            var renderStrategy = this.getRenderStrategy();
            renderStrategy.bindToTileHelper(tileHelper);

            renderStrategy.onAfterDataTilesProcessing(visibleRange);

            renderStrategy.release();
        },

        createRenderStrategy: function() {
            this.renderStrategy = new ASPxClientSpreadsheet.LightRenderStrategy(this.getParentControl());
        },

        createCellElement: function(tileHelper, cellInfo) {
            var renderStrategy = this.getRenderStrategy();
            renderStrategy.bindToTileHelper(tileHelper);

            var cellElement = this.getRenderStrategy().createCell(cellInfo);

            renderStrategy.release();
            return cellElement;
        },

        // Helpers
        getParentControl: function() {
            return this.spreadsheetControl;
        },
        getRenderStrategy: function() {
            return this.renderStrategy;
        }
    });

    ASPxClientSpreadsheet.LightRenderStrategy = ASPx.CreateClass(null, {
        constructor: function(spreadsheetControl) {
            this.spreadsheetControl = spreadsheetControl;
            this.paneType = null;
            this.tileHelper = null;

            this.lightRenderHelper = spreadsheetControl.getRenderHelper();
            this.etalonHeaderContainer = { column: null, row: null };
        },

        bindToTileHelper: function(tileHelper) {
            this.setTileHelper(tileHelper);
            this.parentContainer = this.getRenderHelper().getGridContainer(this.getPaneType());
        },
        processRequest: function(receivedTiles, visibleRange) {
            var gridTiles = receivedTiles.grid,
                columnHeaderTiles = receivedTiles.columnHeader,
                rowHeaderTiles = receivedTiles.rowHeader;

            this.processHeaderTiles(columnHeaderTiles, true);

            this.processHeaderTiles(rowHeaderTiles, false);

            this.processDataTiles(gridTiles);
        },
        release: function() {
            this.setTileHelper(null);
            this.parentContainer = null;
        },

        /*********Create header information**********/
        processHeaderTiles: function(headerTiles, isColumn) {
            var len = headerTiles.length;
            for(var i = 0; i < len; i++) {
                var newTileHeaderInfo = headerTiles[i],
                    oldTileHeaderInfo = this.getHeaderInfo(newTileHeaderInfo.index, isColumn);

                if(oldTileHeaderInfo) {
                    this.updateTileHeader(newTileHeaderInfo, oldTileHeaderInfo, isColumn);
                } else {
                    this.updateHeaderInfo(newTileHeaderInfo, isColumn);
                    newTileHeaderInfo.htmlElement = this.createHeaderTileHtmlElement(newTileHeaderInfo, isColumn);
                    this.setHeaderInfo(newTileHeaderInfo, isColumn);
                }
            }
        },
        updateHeaderInfo: function(headerTileInfo, isColumn) {
            var sizeName = isColumn ? "widths" : "heights",
                sizeRangeName = isColumn ? "incrementalWidths" : "incrementalHeights";
            headerTileInfo[sizeRangeName] = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getIncrementalRangeArray(headerTileInfo[sizeName]);
        },
        createHeaderTileHtmlElement: function(headerInfo, isColumn) {
            var headerElement = this.getHeaderTemplate(isColumn).cloneNode(true);
            headerElement.id = this.getRenderHelper().getHeaderTileElementId(headerInfo.index, isColumn, this.getPaneType());

            this.applyHeaderInfo(headerElement, headerInfo, isColumn);

            return headerElement;
        },
        createHeaderTemplate: function(isColumn) {
            var stringBuilder = [];

            stringBuilder.push("<div class='dxss-ht'>");
            stringBuilder = stringBuilder.concat(this.getColumnContainerInnerHtml(isColumn), this.getGridContainerInnerHtml(isColumn));
            stringBuilder.push("</div>");

            return this.createFragmentFromHtml(stringBuilder.join(""));
        },
        getHeaderTemplate: function(isColumn) {
            var headerTemplate = isColumn ? this.etalonHeaderContainer.column : this.etalonHeaderContainer.row;
            if(!headerTemplate) {
                headerTemplate = this.createHeaderTemplate(isColumn);
                if(isColumn)
                    this.etalonHeaderContainer.column = headerTemplate;
                else
                    this.etalonHeaderContainer.row = headerTemplate;
            }
            return headerTemplate;
        },
        getGridContainerInnerHtml: function(isColumn) {
            var gridLineHtml = this.getGridLineTemplateHtml(isColumn),
                tileSize = this.getParentControl().getTileSize(),
                linesCount = isColumn ? tileSize.col : tileSize.row,
                stringBuilder = [];

            stringBuilder.push("<div class='dxss-gl'>");
            while(linesCount--)
                stringBuilder.push(gridLineHtml);
            stringBuilder.push("</div>");

            return stringBuilder;
        },
        getGridLineTemplateHtml: function(isColumn) {
            return "<div class='" + ASPx.SpreadsheetCssClasses.getGridLine(isColumn) + "'></div>";
        },
        getColumnContainerInnerHtml: function(isColumn) {
            var tileSize = this.getParentControl().getTileSize(),
                len = isColumn ? tileSize.col : tileSize.row,
                stringBuilder = [];

            stringBuilder.push("<div class='hcc'>");
            for(var i = 0; i < len; i++) {
                stringBuilder.push("<div class='dxss-htd' data-header-cell-index='");
                stringBuilder.push(i);
                stringBuilder.push("'></div>");
            }
            stringBuilder.push("</div>");
            return stringBuilder;
        },
        applyHeaderInfo: function(element, headerInfo, isColumn) {
            var gridLineContainer = ASPx.GetChildByClassName(element, ASPx.SpreadsheetCssClasses.GridLineContainer),
                cellContainer = ASPx.GetChildByClassName(element, ASPx.SpreadsheetCssClasses.HeaderContainer);

            this.adjustHeaderSize(element, headerInfo, isColumn);

            this.updateChildControls(gridLineContainer.childNodes, cellContainer.childNodes, headerInfo, isColumn);
            cellContainer.setAttribute(ASPxClientSpreadsheet.TileHelper.DataAttributes.HeaderContainerTileIndex, headerInfo.index);
        },
        adjustHeaderSize: function(element, headerInfo, isColumn) {
            var headerOffsetSize = this.getTileHelper().getHeaderOffsetSize(),
                headerOffsetWidth = headerOffsetSize.width,
                headerOffsetHeight = headerOffsetSize.height,
                headerWidth = isColumn ? headerInfo.totalWidth : headerOffsetWidth,
                headerHeight = isColumn ? headerOffsetHeight : headerInfo.totalHeight;

            if(isColumn) {
                element.style.width = headerWidth + "px";
                element.style.lineHeight = headerHeight + "px";
            }
            element.style.height = headerHeight + "px";
        },
        updateChildControls: function(gridLines, cells, headerInfo, isColumn) {
            var stylePositionName = isColumn ? "left" : "top",
                styleSizeName = isColumn ? "width" : "height",
                headerSizeNameParam = isColumn ? "widths" : "heights",
                sizeRangeName = isColumn ? "incrementalWidths" : "incrementalHeights",
                incrementalSizeArray = headerInfo[sizeRangeName],
                sizes = headerInfo[headerSizeNameParam],
                len = gridLines.length;

            for(var i = 0; i < len; i++) {
                var line = gridLines[i],
                    cell = cells[i];

                line.style[stylePositionName] = incrementalSizeArray[i] + "px";
                cell.style[stylePositionName] = incrementalSizeArray[i] + "px";

                cell.style[styleSizeName] = sizes[i] + "px";

                if(!isColumn)
                    cell.style.lineHeight = sizes[i] + "px";

                if(headerInfo.modelIndices) {
                    cell.innerHTML = this.getHeaderCellTextByOrder(headerInfo.modelIndices[i] + (isColumn ? 0 : 1), isColumn);
                    if(this.hasHiddenElments(i, headerInfo, isColumn))
                        ASPx.AddClassNameToElement(line, "db");
                    else
                        ASPx.RemoveClassNameFromElement(line, "db");
                } else {
                    var tileSize = this.getParentControl().getTileSize(),
                        cellCount = isCol ? tileSize.col : tileSize.row,
                        startCellIndexInTile = headerInfo.index * cellCount;
                    if(!isCol)
                        startCellIndexInTile++;
                    cell.innerHTML = this.getHeaderCellTextByOrder(startCellIndexInTile + i, isColumn);
                }
            }
        },
        getHeaderCellTextByOrder: function(cellIndex, isColumn) {
            return isColumn ? this.getHeaderCellIndexStringRepresentation(cellIndex) : cellIndex;
        },
        getHeaderCellIndexStringRepresentation: function(index) {
            return ASPxClientSpreadsheet.CellHelper.getColumnStringRepresentaion(index);
        },
        hasHiddenElments: function(counter, headerInfo, isColumn) {
            if(headerInfo.modelIndices[counter] - headerInfo.modelIndices[counter - 1] > 1)
                return true;
            if(counter === 0) {
                if(headerInfo.index > 0) {
                    var beforeHeaderInfo = this.getHeaderInfo(headerInfo.index - 1, isColumn);
                    if(beforeHeaderInfo && beforeHeaderInfo.modelIndices) {
                        var len = beforeHeaderInfo.modelIndices.length;
                        return headerInfo.modelIndices[counter] - beforeHeaderInfo.modelIndices[len - 1] > 1;
                    }
                } else if(headerInfo.index === 0) { //sheet started with hidden rows/columns
                    if(headerInfo.modelIndices[counter] > 0)
                        return true;
                }
            }
            return false;
        },
        /***********Update header information********/
        updateTileHeader: function(newTileInfo, oldTileInfo, isColumn) {
            if(newTileInfo.CRC !== oldTileInfo.CRC) {
                var indecesChanged = this.isModelIndecesChanged(newTileInfo, oldTileInfo),
                    sizeChanged = this.isHeaderSizeChanged(newTileInfo, oldTileInfo, isColumn);
                if(indecesChanged || sizeChanged) {
                    this.updateHeaderInfo(newTileInfo, isColumn);
                    newTileInfo.htmlElement = this.updateTileHeaderElement(oldTileInfo.htmlElement, newTileInfo, indecesChanged, sizeChanged, isColumn);
                    this.setHeaderInfo(newTileInfo, isColumn);
                    if(sizeChanged) {
                        this.updateGridLinsInDataTiles(newTileInfo, isColumn);
                        this.updateHeaderTileSize(newTileInfo.htmlElement, newTileInfo, isColumn);
                    }
                }
            }
            if(isColumn) {
                var element = newTileInfo.htmlElement || oldTileInfo.htmlElement;
                this.adjustHeaderSize(element, newTileInfo, isColumn);
            }
        },
        isHeaderSizeChanged: function(newTileInfo, oldTileInfo, isColumn) {
            return !(((isColumn && newTileInfo.totalWidth === oldTileInfo.totalWidth && newTileInfo.widths.join("") == oldTileInfo.widths.join("")) ||
                (!isColumn && newTileInfo.totalHeight === oldTileInfo.totalHeight && newTileInfo.heights.join("") == oldTileInfo.heights.join(""))));
        },
        isModelIndecesChanged: function(newTileInfo, oldTileInfo) {
            return !oldTileInfo.modelIndices || newTileInfo.modelIndices.join("") != oldTileInfo.modelIndices.join("");
        },
        updateTileHeaderElement: function(element, headerInfo, indecesChanged, sizeChanged, isColumn) {
            var gridLineContainer = ASPx.GetChildByClassName(element, ASPx.SpreadsheetCssClasses.GridLineContainer),
                cellContainer = ASPx.GetChildByClassName(element, ASPx.SpreadsheetCssClasses.HeaderContainer),
                cells = ASPx.GetChildNodesByClassName(cellContainer, ASPx.SpreadsheetCssClasses.HeaderCell),
                gridLines = ASPx.GetChildNodesByClassName(gridLineContainer, ASPx.SpreadsheetCssClasses.getGridLine(isColumn));

            this.updateChildControls(gridLines, cells, headerInfo, isColumn);
            return element;
        },
        updateGridLinsInDataTiles: function(headerTileInfo, isColumn) {
            var updatedTiles = isColumn ? this.getTileMatrix().getGridTilesArrayByColumnPosition(headerTileInfo.index) : this.getTileMatrix().getGridTilesArrayByRowPosition(headerTileInfo.index),
                newLineContainer = this.prepareNewLinesContainer(headerTileInfo),
                itemLength = updatedTiles.length;

            while(itemLength--) {
                var dataTile = updatedTiles[itemLength],
                    dataTileConteiner = dataTile.htmlElement,
                    oldLineContainer = this.findGridLineTileContainer(dataTileConteiner, isColumn);
                dataTileConteiner.replaceChild(newLineContainer.cloneNode(true), oldLineContainer);
            }
        },
        prepareNewLinesContainer: function(headerTileInfo) {
            var container = ASPx.GetChildByClassName(headerTileInfo.htmlElement, ASPx.SpreadsheetCssClasses.GridLineContainer);
            if(ASPx.Browser.TouchUI) {
                container = container.cloneNode(true);
                var touchResizeElement = ASPx.GetNodeByClassName(container, ASPx.SpreadsheetCssClasses.TouchResizeElement, 0);
                ASPx.RemoveElement(touchResizeElement);
            }
            return container;
        },
        findGridLineTileContainer: function(element, isColumn) {
            var containers = ASPx.GetChildNodesByClassName(element, ASPx.SpreadsheetCssClasses.GridLineContainer);
            if(containers[0].childNodes[0].className.indexOf(ASPx.SpreadsheetCssClasses.getGridLine(isColumn)) >= 0)
                return containers[0];
            return containers[1];
        },
        updateHeaderTileSize: function(element, headerTileInfo, isCol) {
            var size = isCol ? headerTileInfo.totalWidth : headerTileInfo.totalHeight,
                styleName = isCol ? "width" : "height";
            element.style[styleName] = size + "px";
        },

        /*******Create data inforamtion******/
        processDataTiles: function(dataTiles) {
            var len = dataTiles.length;
            for(var i = 0; i < len; i++) {
                var newDataTileInfo = dataTiles[i],
                    oldDataTileInfo = this.getDataTileInfo(newDataTileInfo.rowIndex, newDataTileInfo.colIndex);
                if(oldDataTileInfo)
                    this.updateTileDataElement(newDataTileInfo, oldDataTileInfo);
                else
                    newDataTileInfo.htmlElement = this.createDataTileHtmlElement(newDataTileInfo);
                newDataTileInfo.expiredOnClient = false;
                this.setDataTileInfo(newDataTileInfo);
            }
        },
        createDataTileHtmlElement: function(tileInfo) {
            var columnContainer = this.createDataTileElement(tileInfo);
            this.fillColumnContainer(columnContainer, tileInfo);
            return columnContainer;
        },
        createDataTileElement: function(tileInfo) {
            var sizes = tileInfo.json.S,
                width = sizes[0],
                height = sizes[1],
                rowIndex = tileInfo.rowIndex,
                columnIndex = tileInfo.colIndex,
                html = "<div class='dxss-gt' style='width:" + width + "px;height:" + height + "px;'></div>",
                element = this.createFragmentFromHtml(html);

            element.id = this.getRenderHelper().getGridTileElementId(rowIndex, columnIndex, this.getPaneType());
            this.appendGridLines(element, tileInfo);
            return element;
        },
        appendGridLines: function(parentElement, tileInfo) {
            var rowIndex = tileInfo.rowIndex,
                columnIndex = tileInfo.colIndex,
                columnHeaderHtmlElement = this.getHeaderInfo(columnIndex, true),
                rowHeaderHtmlElement = this.getHeaderInfo(rowIndex, false);

            if(columnHeaderHtmlElement) {
                var vertiacalGridLines = ASPx.GetChildByClassName(columnHeaderHtmlElement.htmlElement, ASPx.SpreadsheetCssClasses.GridLineContainer);
                if(vertiacalGridLines)
                    parentElement.appendChild(vertiacalGridLines.cloneNode(true));
            }
            if(rowHeaderHtmlElement) {
                var horizontalGridLines = ASPx.GetChildByClassName(rowHeaderHtmlElement.htmlElement, ASPx.SpreadsheetCssClasses.GridLineContainer);
                if(horizontalGridLines)
                    parentElement.appendChild(horizontalGridLines.cloneNode(true));
            }
        },
        fillColumnContainer: function(parentContainer, tileInfo) {
            var tileJSON = tileInfo.json,
                cells = tileJSON.C,
                borders = tileJSON.B,
                pictures = tileJSON.P;

            if(cells && cells.length > 0)
                this.createCells(cells, parentContainer);

            if(borders && borders.length > 0)
                this.createBorders(borders, parentContainer);

            if(pictures && pictures.length > 0)
                this.createPictures(pictures, parentContainer);
        },
        createCells: function(cells, parentContainer) {
            var len = cells.length;
            while(len--) {
                var cellHtml = this.createCell(cells[len]);
                parentContainer.insertAdjacentHTML("afterbegin", cellHtml);
            }
        },
        createCell: function(cellInfo) {
            var columnIndex = cellInfo.P[1],
                rowIndex = cellInfo.P[0],
                width = cellInfo.S ? cellInfo.S[0] : this.getTileHelper().getDefaultCellSize().width,
                height = cellInfo.S ? cellInfo.S[1] : this.getTileHelper().getDefaultCellSize().height,
                top = cellInfo.C[0],
                left = cellInfo.C[1],
                backColor = cellInfo.BC,
                textBoxStyle = this.getTextBoxContainerStyle(cellInfo),
                style = cellInfo.CE.ST,
                hasFillContainer = !!cellInfo.FB;

            var html = [];
            html.push("<div id='" + this.getRenderHelper().getCellContainerElementId(rowIndex, columnIndex, this.getPaneType()) + "' ");
            html.push("class='" + textBoxStyle + "' style='");
            html.push("width:" + width + "px;");
            html.push("height:" + height + "px;");
            html.push("top:" + top + "px;");
            html.push("left:" + left + "px;");
            if(style && style.W === 1)
                html.push("overflow:hidden;");
            if(!hasFillContainer && backColor) html.push("background-color:" + backColor + ";");
            html.push("'>");

            if(hasFillContainer)
                html = html.concat(this.getFillContainerElementHtml(cellInfo, rowIndex, columnIndex));

            html = html.concat(this.getTextBoxWrapperElementHtml(cellInfo));

            html.push("</div>");

            return html.join("");
        },
        getTextBoxWrapperElementHtml: function(cellInfo) {
            var textBoxWrapperInfo = cellInfo.TW,

                columnIndex = cellInfo.P[1],
                rowIndex = cellInfo.P[0];

            var html = [];
            if(!!textBoxWrapperInfo) {
                var width = textBoxWrapperInfo.S[0],
                    height = textBoxWrapperInfo.S[1],
                    left = textBoxWrapperInfo.S.length > 2 ? textBoxWrapperInfo.S[2] : ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Aligment.LeftPadding,
                    top = textBoxWrapperInfo.S.length > 3 ? textBoxWrapperInfo.S[3] : ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Aligment.TopPadding;

                html.push("<div class='" + "dxss-tw" + "' style='");
                html.push("width:" + width + "px;");
                html.push("height:" + height + "px;");
                html.push("top:" + top + "px;");
                html.push("left:" + left + "px;");
                html.push("'>");
                html = html.concat(this.getCellTextBoxElementHtml(cellInfo.CE, rowIndex, columnIndex, true));
                html.push("</div>");
            } else
                html = this.getCellTextBoxElementHtml(cellInfo.CE, rowIndex, columnIndex, false);
            return html;
        },

        getFillContainerElementHtml: function(cellContainerInfo, rowIndex, columnIndex) {
            var cellInfo = cellContainerInfo.FB,
                width = cellInfo.S[0],
                height = cellInfo.S[1],
                top = cellInfo.S[2],
                left = cellInfo.S[3],
                backColor = cellContainerInfo.BC,
                html = [];

            html.push("<div class='" + ASPx.SpreadsheetCssClasses.FillContainerElement + "' style='");
            html.push("width:" + width + "px;");
            html.push("height:" + height + "px;");
            html.push("top:" + top + "px;");
            html.push("left:" + left + "px;");
            if(backColor) html.push("background-color:" + backColor + ";");
            html.push("'></div>");
            return html;
        },
        isBrowserRequiredComplexMultylineRender: function() {
            return ASPx.Browser.Firefox || ASPx.Browser.IE || ASPx.Browser.Edge;
        },
        getCellTextBoxElementHtml: function(cellInfo, rowIndex, colIndex, isComplexCell) {
            var style = cellInfo.ST,
                cellStyleHelper = new ASPxClientSpreadsheet.DocumentModel.CellStyle(style),
                cellTextBoxDefaultSize = cellStyleHelper.getTextBoxDefaultSize(this.getTileHelper()),
                width = cellInfo.S ? cellInfo.S[0] : cellTextBoxDefaultSize.width,
                height = cellInfo.S ? cellInfo.S[1] : cellTextBoxDefaultSize.height,
                isDigital = cellInfo.D === 1,
                isHyperlink = cellInfo.L !== undefined,
                isComplexMultiLineRender = cellStyleHelper.Aligment.isTextWrapped() && this.isBrowserRequiredComplexMultylineRender();

            var html = [];
            if(isComplexMultiLineRender)
                html.push("<div class='" + ASPx.SpreadsheetCssClasses.MultylineTextContainer + "' style='vertical-align:" + cellStyleHelper.Aligment.getVertiacal() + "'>");
            html.push("<div id='" + this.getRenderHelper().getCellElementId(rowIndex, colIndex, this.getPaneType()) + "' ");
            html.push("class='" + ASPx.SpreadsheetCssClasses.TextBoxContent + "");
            if(!style)
                html.push(cellStyleHelper.Aligment.getDefaultCellStyle(isDigital));
            if(cellStyleHelper.Aligment.isTextWrapped())
                html.push(cellStyleHelper.Aligment.getTextWrapCss());
            html.push("'");
            html.push(" style='");
            html.push("width:" + width + "px;");

            if(isComplexMultiLineRender)
                html.push("max-height:" + height + "px;");
            else
                html.push("height:" + height + "px;");

            if(isComplexCell)
                html.push("padding: 0;");
            if(style) {
                html.push("text-align:" + cellStyleHelper.Aligment.getHorizontal(isDigital) + ";");
                if(isComplexMultiLineRender)
                    html.push("display: block;");
                else
                    html.push("display:" + cellStyleHelper.getDisplay() + ";");
                if(!isComplexMultiLineRender)
                    html.push("vertical-align:" + cellStyleHelper.Aligment.getVertiacal() + ";");
                if(!isHyperlink)
                    html = html.concat(this.getFontStyle(cellInfo));
                if(!isComplexCell)
                    html.push("padding:" + cellStyleHelper.getPadding() + ";");
            }
            html.push("'>");
            html = html.concat(this.getCellTextBoxInnerHtml(cellInfo));
            html.push("</div>");

            if(isComplexMultiLineRender)
                html.push("</div>");
            return html;
        },
        getFontStyle: function(cellInfo) {
            var style = cellInfo.ST,
                cellStyleHelper = new ASPxClientSpreadsheet.DocumentModel.CellStyle(style),
                isHyperlink = cellInfo.L !== undefined;
            var html = [];

            html.push("font-family:" + cellStyleHelper.Font.getName() + ";");
            html.push("font-size:" + cellStyleHelper.Font.getSize() + "pt;");
            html.push("color:" + cellStyleHelper.Font.getColor() + ";");


            if(cellStyleHelper.Font.isBold())
                html.push("font-weight: bold;");
            if(cellStyleHelper.Font.isItalic())
                html.push("font-style: italic;");

            if(cellStyleHelper.Font.isTextDecorated()) {
                html.push("text-decoration:");
                if(cellStyleHelper.Font.isUnderline())
                    html.push("underline");
                if(cellStyleHelper.Font.isStrikethrough())
                    html.push(" line-through");
                html.push(";");
            } else if(isHyperlink)
                html.push("text-decoration: none;");
            return html;
        },
        getCellTextBoxInnerHtml: function(cellInfo) {
            var linkProperties = cellInfo.L,
                innerText = ASPx.IsExists(cellInfo.T) ? cellInfo.T : "";
            if(!linkProperties)
                return [innerText];

            var navigateLink = linkProperties[0],
                toolTip = linkProperties[2],
                isBookMark = linkProperties[1] === "1",
                html = [];

            html.push("<a href='javascript:;' ");
            html.push("_loc='" + navigateLink + "' ");
            html.push("onclick='javascript:return ASPx.SSOnHyperLinkClicked(event, this);' ");
            html.push((isBookMark ? "bm='1' " : ""));
            html.push("style='");
            html = html.concat(this.getFontStyle(cellInfo));
            html.push("'");
            html.push("title='" + toolTip + "'>");
            html.push(innerText);
            html.push("</a>");
            return html;
        },
        getTextBoxContainerStyle: function(cellInfo) {
            var displayText = ASPx.IsExists(cellInfo.CE.T) ? cellInfo.CE.T : "",
                isComplexCell = cellInfo.TW,
                textBoxStyle = "";

            if(displayText === "")
                textBoxStyle = ASPx.SpreadsheetCssClasses.BackgroundCellTextBox;
            else
                textBoxStyle = isComplexCell ? ASPx.SpreadsheetCssClasses.ComplexCellTextBox : ASPx.SpreadsheetCssClasses.SingleCellTextBox;
            return textBoxStyle;
        },

        createBorders: function(borders, parentContainer) {
            var len = borders.length;
            while(len--) {
                var borderElementHtml = this.createBorder(borders[len]);
                parentContainer.insertAdjacentHTML("beforeend", borderElementHtml);
            }
        },
        createBorder: function(borderInfo) {
            var width = borderInfo.S[0],
                height = borderInfo.S[1],
                top = borderInfo.S[2],
                left = borderInfo.S[3],
                borderColor = borderInfo.C ? borderInfo.C : ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Border.Color,
                classNameIndex = borderInfo.L ? borderInfo.L : ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Border.LineStyle,
                isVertical = borderInfo.O === ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Border.IsVertical,
                borderPosition = borderInfo.G[0],
                firstGridIndex = borderInfo.G[1],
                lastGridIndex = borderInfo.G[2],
                className = ASPx.SpreadsheetCssClasses.getGridLine(isVertical) + " " + this.getBorderCssFromIndex(classNameIndex);

            var html = [];
            html.push("<div id='" + this.getRenderHelper().getBorderElementId(borderPosition, firstGridIndex, lastGridIndex, this.getPaneType(), isVertical) + "' ");
            html.push("class='" + className + "' ");
            html.push("style='");
            html.push("width:" + width + "px;");
            html.push("height:" + height + "px;");
            html.push("top:" + top + "px;");
            html.push("left:" + left + "px;");
            html.push("border-color:" + borderColor + ";");
            html.push("'>");
            html.push("</div>");

            return html.join("");
        },
        getBorderCssFromIndex: function(index) {
            var className = "";
            switch(index) {
                case 1:
                    className = "dxss-bt-h";
                    break;
                case 2:
                    className = "dxss-bt-d";
                    break;
                case 3:
                    className = "dxss-bt-da";
                    break;
                case 4:
                    className = "dxss-bt-ddd";
                    break;
                case 5:
                    className = "dxss-bt-ddd";
                    break;
                case 6:
                    className = "dxss-bt-dbl";
                    break;
                case 7:
                    className = "dxss-bt-m";
                    break;
                case 8:
                    className = "dxss-bt-md";
                    break;
                case 9:
                    className = "dxss-bt-mdd";
                    break;
                case 10:
                    className = "dxss-bt-mddd";
                    break;
                case 11:
                    className = "dxss-bt-sdd";
                    break;
                case 12:
                    className = "dxss-bt-tk";
                    break;
                default:
                    className = "dxss-bt-t";
                    break;
            }
            return className;
        },

        createPictures: function(pictures, parentContainer) {
            var len = pictures.length;
            while(len--) {
                var picture = this.createPicture(pictures[len]);
                this.appendPicture(parentContainer, picture);
            }
        },
        createPicture: function(pictureInfo) {
            var width = pictureInfo.S[0],
                height = pictureInfo.S[1],
                top = pictureInfo.S[2],
                left = pictureInfo.S[3],
                src = pictureInfo.P[0],
                index = pictureInfo.P[1],
                zIndex = parseInt(pictureInfo.P[3]),
                gid = pictureInfo.P[4],
                isChart = pictureInfo.P[2] === "1",
                linkProperties = pictureInfo.L,
                className = "dxss-db" + (isChart ? " dxss-chart" : "");

            var html = "<img class='" + className + "' style='";
            html += "width:" + width + "px;";
            html += "height:" + height + "px;";
            html += "top:" + top + "px;";
            html += "left:" + left + "px;";
            html += "z-index:" + (ASPx.SpreadsheetCssClasses.MaxElementZIndex + zIndex) + ";";
            if(linkProperties)
                html += "cursor:pointer;";
            html += "' ";
            html += "src='" + src + "' ";
            html += "data-dbi='" + index + "' ";
            html += "gid='" + gid + "'";
            if(linkProperties) {
                var navigateLink = linkProperties[0],
                    toolTip = linkProperties[2],
                    isBookMark = linkProperties[1] === "1";
                html += " _loc='" + navigateLink + "' ";
                html += isBookMark ? "bm='1' " : "";
                html += "title='" + toolTip + "'";
            }
            html += "/>";
            var pictureContainer = this.createFragmentFromHtml(html);
            return pictureContainer;
        },
        appendPicture: function(parentContainer, pictureElement) {
            if(parentContainer.childNodes.length > 0)
                parentContainer.insertBefore(pictureElement, parentContainer.firstChild);
            else
                parentContainer.appendChild(pictureElement);
        },

        // Complex boxes processing
        onAfterDataTilesProcessing: function(visibleRange) {
            this.getTileHelper().resetComplexBoxes();
            for(var i = visibleRange.top; i <= visibleRange.bottom; i++) {
                for(var j = visibleRange.left; j <= visibleRange.right; j++) {
                    var dateTilInfo = this.getDataTileInfo(i, j);
                    this.processingComplexBoxes(dateTilInfo);
                }
            }

            for(var i = visibleRange.top; i <= visibleRange.bottom; i++) {
                for(var j = visibleRange.left; j <= visibleRange.right; j++) {
                    var dateTilInfo = this.getDataTileInfo(i, j);
                    this.processingComments(dateTilInfo);
                }
            }
        },
        processingComplexBoxes: function(tileInfo) {
            var complexBoxes = tileInfo.json.M;
            if(complexBoxes && complexBoxes.length > 0) {
                var len = complexBoxes.length;
                while(len--) {
                    this.processComplexBox(tileInfo, complexBoxes[len]);
                }
            }
        },
        processComplexBox: function(tileInfo, complexBoxInfo) {
            var complexBoxes = this.getTileHelper().getComplexBoxesArray(),
                parentContainer = tileInfo.htmlElement,
                colModelIndex = complexBoxInfo[0],
                rowModelIndex = complexBoxInfo[1],
                modelRange = new ASPxClientSpreadsheet.Range(colModelIndex, rowModelIndex, complexBoxInfo[2], complexBoxInfo[3]),
                index = complexBoxes.indexOfRange(modelRange),
                complexBox,
                complexBoxExist = index !== -1;

            var cellElementId = this.getRenderHelper().getCellContainerElementId(rowModelIndex, colModelIndex, this.getPaneType()),
                cellElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(parentContainer, cellElementId),
                isComplexBoxElementRequired = !cellElement || (cellElement && cellElement.style.backgroundColor === "");
            if(isComplexBoxElementRequired) {
                complexBox = complexBoxExist ? complexBoxes.get(index) : this.getComplexBoxes(tileInfo, complexBoxInfo);
                if(complexBox.isVisible()) {
                    var complexBoxElement = this.createComplexBox(tileInfo, complexBox);
                    complexBox.setAssociatedElement(complexBoxElement);
                    parentContainer.appendChild(complexBoxElement);
                    if(!complexBoxExist)
                        complexBoxes.push(complexBox);
                }
            } else {
                if(!complexBoxExist) {
                    complexBox = this.getComplexBoxes(tileInfo, complexBoxInfo);
                    if(complexBox.isVisible())
                        complexBoxes.push(complexBox);
                }
            }
        },
        getComplexBoxes: function(tileInfo, complexBoxInfo) {
            var invalidIndex = -1;

            var leftColModelIndex = complexBoxInfo[0],
                topRowModelIndex = complexBoxInfo[1],
                rightColModelIndex = complexBoxInfo[2],
                bottomRowModelIndex = complexBoxInfo[3],
                complexBox = new ASPxClientSpreadsheet.ComplexBox(leftColModelIndex, topRowModelIndex, rightColModelIndex, bottomRowModelIndex);

            var rangeIsCropped = false,
                visibleIndex = -1,
                leftColVisibleIndex = 0,
                topRowVisibleIndex = 0,
                rightColVisibleIndex = 0,
                bottomRowVisibleIndex = 0;

            visibleIndex = this.getTileHelper().convertModelIndexToVisibleIndex(leftColModelIndex, true);
            if(visibleIndex === invalidIndex) {
                visibleIndex = this.getTileHelper().findFirstVisibleIndexOnASCDirection(leftColModelIndex, true);
                rangeIsCropped = true;
            }
            leftColVisibleIndex = visibleIndex;

            visibleIndex = this.getTileHelper().convertModelIndexToVisibleIndex(topRowModelIndex, false);
            if(visibleIndex === invalidIndex) {
                visibleIndex = this.getTileHelper().findFirstVisibleIndexOnASCDirection(topRowModelIndex, false);
                rangeIsCropped = true;
            }
            topRowVisibleIndex = visibleIndex;


            visibleIndex = this.getTileHelper().convertModelIndexToVisibleIndex(rightColModelIndex, true);
            if(visibleIndex === invalidIndex) {
                visibleIndex = this.getTileHelper().findFirstVisibleIndexOnDESCDirection(rightColModelIndex, true);
                rangeIsCropped = true;
            }
            rightColVisibleIndex = visibleIndex;

            visibleIndex = this.getTileHelper().convertModelIndexToVisibleIndex(bottomRowModelIndex, false);
            if(visibleIndex === invalidIndex) {
                visibleIndex = this.getTileHelper().findFirstVisibleIndexOnDESCDirection(bottomRowModelIndex, false);
                rangeIsCropped = true;
            }
            bottomRowVisibleIndex = visibleIndex;

            complexBox.setVisibility(!((topRowVisibleIndex > bottomRowVisibleIndex) || (leftColVisibleIndex > rightColVisibleIndex)));

            complexBox.setVisiblePosition(leftColVisibleIndex, topRowVisibleIndex, rightColVisibleIndex, bottomRowVisibleIndex);
            complexBox.setRangeIsCropped(rangeIsCropped);

            return complexBox;
        },

        createComplexBox: function(tileInfo, complexBox) {
            var modelRange = complexBox.getModelRange(),
                colModelIndex = modelRange.leftColIndex,
                rowModelIndex = modelRange.topRowIndex;

            var complexBoxPosition = this.getComplexBoxPosition(tileInfo, complexBox),
                html = "";

            html += "<div class='" + ASPx.SpreadsheetCssClasses.ComplexBoxContainer + "' ";
            html += "style='";
            html += "width:" + complexBoxPosition.width + "px;";
            html += "height:" + complexBoxPosition.height + "px;";
            html += "top:" + complexBoxPosition.y + "px;";
            html += "left:" + complexBoxPosition.x + "px;";
            html += "'>";
            html += "</div>";

            var comblexBoxContainer = this.createFragmentFromHtml(html);
            comblexBoxContainer.id = this.getRenderHelper().getComplexBoxElementId(rowModelIndex, colModelIndex, this.getPaneType());
            return comblexBoxContainer;
        },
        getComplexBoxPosition: function(tileInfo, complexBox) {
            var tileHelper = this.getTileHelper(),
                visibleRange = complexBox.getVisibleRange();

            var topLeftCellLayoutInfo = tileHelper.getCellLayoutInfo(
                tileHelper.putCellColIndexInVisibleRange(visibleRange.leftColIndex),
                tileHelper.putCellRowIndexInVisibleRange(visibleRange.topRowIndex));

            var bottomRightCellLayoutInfo = tileHelper.getCellLayoutInfo(
                tileHelper.putCellColIndexInVisibleRange(visibleRange.rightColIndex),
                tileHelper.putCellRowIndexInVisibleRange(visibleRange.bottomRowIndex));

            var rect = ASPxClientSpreadsheet.CellHelper.getCellRangeRect(topLeftCellLayoutInfo, bottomRightCellLayoutInfo, tileInfo);
            return this.correctRectForGridLine(rect);
        },
        correctRectForGridLine: function(rect) {
            var gridLineSize = 1;
            rect.x += gridLineSize;
            rect.y += gridLineSize;
            rect.width -= gridLineSize;
            rect.height -= gridLineSize;
            return rect;
        },

        processingComments: function(tileInfo) {
            var parentContainer = tileInfo.htmlElement,
                comments = tileInfo.json.R;

            if(comments && comments.length > 0) {
                tileInfo.comments = {};
                var len = comments.length;

                while(len--) {
                    this.createComment(parentContainer, comments[len], tileInfo);
                }
            }
        },
        createComment: function(parentContainer, commentInfo, tileInfo) {
            this.prepareCommentValue(tileInfo.comments, commentInfo);
            this.markingCellElement(parentContainer, commentInfo, tileInfo);

            var width = commentInfo.S[0],
                height = commentInfo.S[1],
                top = commentInfo.S[2],
                left = commentInfo.S[3],
                columnIndex = commentInfo.P[1],
                rowIndex = commentInfo.P[0],
                commentIndex = commentInfo.P[2],
                commentElementId = this.getRenderHelper().getCommentElementId(rowIndex, columnIndex, this.getPaneType()),
                commentElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(parentContainer, commentElementId),
                display = commentInfo.V ? "" : "none";
            if(!commentElement) {
                var html = "<div id='" + this.getRenderHelper().getCommentElementId(rowIndex, columnIndex, this.getPaneType()) + "' ";
                html += "class='" + ASPx.SpreadsheetCssClasses.CommentBox + "' style='";
                html += "width:" + width + "px;";
                html += "height:" + height + "px;";
                html += "top:" + top + "px;";
                html += "left:" + left + "px;";
                html += "display:" + display + ";";
                html += "' data-dbi='" + commentIndex + "'";
                html += " r='" + rowIndex + "'";
                html += " c='" + columnIndex + "'";
                html += ">";
                html += "</div>";

                var commentBox = this.createFragmentFromHtml(html);
                parentContainer.appendChild(commentBox);

                var inplaceCommentEditor = this.createInplaceCommentEditor(commentInfo.T);
                commentBox.appendChild(inplaceCommentEditor);

                this.createConnectionLinde(commentBox, tileInfo, commentInfo);
            } else {  // update
                this.updateCommentAttributes(commentElement, commentInfo);
                this.updateConnectionLine(commentElement, tileInfo, commentInfo);
            }
        },
        prepareCommentValue: function(comments, commentInfo) {
            var columnIndex = commentInfo.P[1],
                rowIndex = commentInfo.P[0],
                value = commentInfo.T ? commentInfo.T : "";
            comments[columnIndex + "|" + rowIndex] = value;
        },
        markingCellElement: function(parentContainer, commentInfo, tileInfo) {
            var columnIndex = commentInfo.P[1],
                rowIndex = commentInfo.P[0],
                cellId = this.getRenderHelper().getCellContainerElementId(rowIndex, columnIndex, this.getPaneType()),
                tileInfo = this.getCommentCellParentTileInfo(tileInfo, columnIndex, rowIndex),
                cellElement = null;
            if(tileInfo) {
                var parentContainer = tileInfo.htmlElement;

                cellElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(parentContainer, cellId);
                if(!cellElement) {
                    var rect = this.getRenderHelper().getCellLayoutPosition(this.getTileHelper(), columnIndex, rowIndex);
                    if(rect) {
                        var cellObject = this.getRenderHelper().createCellRepresentationObject(columnIndex, rowIndex, rect, ""),
                            cellElementHtml = this.createCell(cellObject);

                        this.getRenderHelper().updateTileInfo(tileInfo, cellObject);

                        parentContainer.insertAdjacentHTML("beforeend", cellElementHtml);
                        cellElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(parentContainer, cellId);
                    }
                }
            }
            if(cellElement) {
                var markerElement = this.getIndicatorElement(cellElement, columnIndex, rowIndex);
                if(markerElement && !ASPx.ElementContainsCssClass(markerElement, ASPx.SpreadsheetCssClasses.CommentIndicator))
                    ASPx.AddClassNameToElement(markerElement, ASPx.SpreadsheetCssClasses.CommentIndicator);
            }
        },
        getIndicatorElement: function(cellElement, columnIndex, rowIndex) {
            if(ASPx.ElementContainsCssClass(cellElement, ASPx.SpreadsheetCssClasses.ComplexCellTextBox)) {
                var fillContainers = ASPx.GetChildNodesByClassName(cellElement, ASPx.SpreadsheetCssClasses.FillContainerElement);
                if(fillContainers && fillContainers.length > 0)
                    return fillContainers[0];
                else {
                    var cellLayoutRect = this.getRenderHelper().getCellLayoutPosition(this.getTileHelper(), columnIndex, rowIndex);
                    if(cellLayoutRect) {
                        cellLayoutRect.x -= cellElement.offsetLeft;
                        if(cellLayoutRect.x >= 0)
                            return this.createIndicatorElement(cellElement, cellLayoutRect);
                    }
                    return null;
                }
            }
            return cellElement;
        },
        createIndicatorElement: function(cellElement, rect) {
            var html = [];

            html.push("<div class='" + ASPx.SpreadsheetCssClasses.FillContainerElement + "' style='");
            html.push("width:" + rect.width + "px;");
            html.push("height:" + rect.height + "px;");
            html.push("top:" + 0 + "px;");
            html.push("left:" + rect.x + "px;");
            html.push("'></div>");

            var indicatorElement = this.createFragmentFromHtml(html.join(""));
            if(cellElement.childNodes && cellElement.childNodes.length > 0)
                cellElement.insertBefore(indicatorElement, cellElement.childNodes[0]);
            else
                cellElement.appendChild(indicatorElement);

            return indicatorElement;
        },
        createConnectionLinde: function(commentBox, tileInfo, commentInfo) {
            var columnIndex = commentInfo.P[1],
                rowIndex = commentInfo.P[0],
                cellId = this.getRenderHelper().getCellContainerElementId(rowIndex, columnIndex, this.getPaneType()),
                parentContainer = tileInfo.htmlElement,
                cellTileInfo = this.getCommentCellParentTileInfo(tileInfo, columnIndex, rowIndex),
                cellElement = null;
            if(cellTileInfo) {
                var cellParentContainer = cellTileInfo.htmlElement,
                    display = commentInfo.V ? "" : "none";

                cellElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(cellParentContainer, cellId);
                if(cellElement) {
                    var parentElementOffsets = this.getContainerOffsets(tileInfo, cellTileInfo),
                        commentBoxOffset = { width: commentInfo.S[0], height: 0, y: commentInfo.S[2], x: commentInfo.S[3] },
                        cellBoxOffset = this.getCellBoxOffset(cellElement, parentElementOffsets, columnIndex, rowIndex),
                        linePosition = this.getConnectionLinePosition(cellBoxOffset, commentBoxOffset);

                    var html = "<div id='" + this.getRenderHelper().getConnectionLineElementId(rowIndex, columnIndex, this.getPaneType()) + "' ";
                    html += "class='dxss-cl' style='left:" + linePosition.left + "px; top:" + linePosition.top + "px;";
                    html += "display:" + display + ";";
                    html += "width:" + linePosition.width + "px; -moz-transform:rotate(" + linePosition.angle + "deg); ";
                    html += "-webkit-transform:rotate(" + linePosition.angle + "deg); -o-transform:rotate(" + linePosition.angle + "deg); ";
                    html += "-ms-transform:rotate(" + linePosition.angle + "deg); transform:rotate(" + linePosition.angle + "deg);' />";
                    var connectionLine = this.createFragmentFromHtml(html);
                    parentContainer.insertBefore(connectionLine, commentBox);
                }
            }
        },
        getCellBoxOffset: function(cellElement, parentElementOffsets, columnIndex, rowIndex) {
            if(ASPx.ElementContainsCssClass(cellElement, ASPx.SpreadsheetCssClasses.ComplexCellTextBox)) {
                var markerCellRect = this.getRenderHelper().getCellLayoutPosition(this.getTileHelper(), columnIndex, rowIndex);

                return { width: 0, height: 0, x: markerCellRect.x + markerCellRect.width - parentElementOffsets.offsetX, y: markerCellRect.y - parentElementOffsets.offsetY };
            }
            return { width: 0, height: 0, x: cellElement.offsetLeft + cellElement.offsetWidth - parentElementOffsets.offsetX, y: cellElement.offsetTop - parentElementOffsets.offsetY };
        },
        getConnectionLinePosition: function(cellPosition, commentPosition) {
            var thickness = 1,
                points = this.getJoiningPoints(cellPosition, commentPosition),
                cellConnectionPoint = points.startPoint,
                commentConnectionPoint = points.endPoint;

            var length = Math.sqrt(((commentConnectionPoint.x - cellConnectionPoint.x) * (commentConnectionPoint.x - cellConnectionPoint.x))
                + ((commentConnectionPoint.y - cellConnectionPoint.y) * (commentConnectionPoint.y - cellConnectionPoint.y))),
                cx = ((cellConnectionPoint.x + commentConnectionPoint.x) / 2) - (length / 2),
                cy = ((cellConnectionPoint.y + commentConnectionPoint.y) / 2) - (thickness / 2),
                angle = Math.atan2((cellConnectionPoint.y - commentConnectionPoint.y), (cellConnectionPoint.x - commentConnectionPoint.x)) * (180 / Math.PI);

            return { top: cy, left: cx, width: length, angle: angle };
        },
        createInplaceCommentEditor: function(value) {
            var inplaceCommentEditor = document.createElement("textarea");
            inplaceCommentEditor.className = ASPx.SpreadsheetCssClasses.CommentEditorElement;

            ASPx.Attr.SetAttribute(inplaceCommentEditor, "spellcheck", "false");
            if(value)
                inplaceCommentEditor.value = value;

            ASPx.Evt.AttachEventToElement(inplaceCommentEditor, "keydown", function(evt) {
                if(ASPx.Evt.GetKeyCode(evt) === ASPx.KeyCode.Tab)
                    return ASPx.Evt.PreventEvent(evt);
            }.aspxBind(this));

            return inplaceCommentEditor;
        },
        getCommentCellParentTileInfo: function(tileInfo, columnIndex, rowIndex) {
            var cellTileInfo = this.getTileHelper().getCellTileInfo_ByModelIndex(columnIndex, rowIndex);
            if(cellTileInfo && cellTileInfo.colIndex === tileInfo.colIndex && cellTileInfo.rowIndex === tileInfo.rowIndex)
                return tileInfo;

            return cellTileInfo;
        },
        getContainerOffsets: function(tileInfo, cellTileInfo) {
            var parentContainer = tileInfo.htmlElement,
                cellParentContainer = cellTileInfo.htmlElement,
                offsets = { offsetX: 0, offsetY: 0 };
            if(cellTileInfo.colIndex === tileInfo.colIndex && cellTileInfo.rowIndex === tileInfo.rowIndex)
                return offsets;

            offsets.offsetX = ASPx.GetAbsoluteX(parentContainer) - ASPx.GetAbsoluteX(cellParentContainer);
            offsets.offsetY = ASPx.GetAbsoluteY(parentContainer) - ASPx.GetAbsoluteY(cellParentContainer);
            return offsets;
        },
        // startPoint is always on cell element, endPoint is always on comment element
        getJoiningPoints: function(cellElement, commentElement) {
            var nearestX = this.getNearestPointsInDirection(
                { coord: cellElement.x, size: cellElement.width },
                { coord: commentElement.x, size: commentElement.width });

            var nearestY = this.getNearestPointsInDirection(
                { coord: cellElement.y, size: cellElement.height },
                { coord: commentElement.y, size: commentElement.height });

            var startPoint = { x: nearestX.startPoint, y: nearestY.startPoint },
                endPoint = { x: nearestX.endPoint, y: nearestY.endPoint };

            return { startPoint: startPoint, endPoint: endPoint };
        },
        getNearestPointsInDirection: function(object1, object2) {
            if(object1.coord >= object2.coord)
                startPoint = object1.coord;
            else
                startPoint = object1.coord + object1.size;

            if(startPoint >= object2.coord + object2.size / 2)
                endPoint = object2.coord + object2.size;
            else
                endPoint = object2.coord;
            return { startPoint: startPoint, endPoint: endPoint };
        },

        updateCommentAttributes: function(commentElement, commentInfo) {
            var width = commentInfo.S[0],
                height = commentInfo.S[1],
                top = commentInfo.S[2],
                left = commentInfo.S[3],
                display = commentInfo.V ? "" : "none",
                value = commentInfo.T ? commentInfo.T : "";

            ASPx.SetStyles(commentElement, { width: width, height: height, top: top, left: left, display: display });
            var inplaceCommentEditor = commentElement.childNodes[0];
            if(inplaceCommentEditor)
                inplaceCommentEditor.value = value;
        },
        updateConnectionLine: function(commentElement, tileInfo, commentInfo) {
            var columnIndex = commentInfo.P[1],
                rowIndex = commentInfo.P[0],
                parentContainer = tileInfo.htmlElement,
                cellTileInfo = this.getCommentCellParentTileInfo(tileInfo, columnIndex, rowIndex),
                cellElement = null;
            if(cellTileInfo) {
                var cellParentContainer = cellTileInfo.htmlElement,
                    cellId = this.getRenderHelper().getCellContainerElementId(rowIndex, columnIndex, this.getPaneType()),
                    display = commentInfo.V ? "" : "none";

                cellElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(cellParentContainer, cellId);
                if(cellElement) {
                    var parentElementOffsets = this.getContainerOffsets(tileInfo, cellTileInfo),
                        commentBoxOffset = { width: commentInfo.S[0], height: 0, y: commentInfo.S[2], x: commentInfo.S[3] },
                        cellBoxOffset = this.getCellBoxOffset(cellElement, parentElementOffsets, columnIndex, rowIndex),
                        linePosition = this.getConnectionLinePosition(cellBoxOffset, commentBoxOffset);
                    var connectionLineElementId = this.getRenderHelper().getConnectionLineElementId(rowIndex, columnIndex, this.getPaneType()),
                        connectionLineElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(parentContainer, connectionLineElementId);
                    if(connectionLineElement)
                        ASPx.SetStyles(connectionLineElement, {
                            width: linePosition.width, top: linePosition.top, left: linePosition.left, display: display,
                            "-webkit-transform": "rotate(" + linePosition.angle + "deg)",
                            "-o-transform": "rotate(" + linePosition.angle + "deg)",
                            "-ms-transform": "rotate(" + linePosition.angle + "deg)",
                            "transform": "rotate(" + linePosition.angle + "deg)"
                        });
                }
            }
        },

        /***********Update data information********/
        updateTileDataElement: function(newDataTileInfo, oldDataTileInfo) {
            var isTileSizeChanged = this.isTileSizeChanged(newDataTileInfo, oldDataTileInfo);
            if(isTileSizeChanged)
                this.updateTileSize(oldDataTileInfo.htmlElement, newDataTileInfo);

            newDataTileInfo.htmlElement = this.updateChildElements(newDataTileInfo, oldDataTileInfo);
        },
        isTileSizeChanged: function(newDataTileInfo, oldDataTileInfo) {
            var newSize = newDataTileInfo.json.S,
                oldSize = oldDataTileInfo.json.S;
            return newSize[0] !== oldSize[0] || newSize[1] !== oldSize[1];
        },
        updateTileSize: function(element, dataTileInfo) {
            var size = dataTileInfo.json.S;
            ASPx.SetStyles(element, { width: size[0], height: size[1] });
        },
        updateChildElements: function(tileInfo, oldTileInfo) {
            var tileJSON = tileInfo.json,
                oldJSON = oldTileInfo.json;

            var cells = tileJSON.C,
                borders = tileJSON.B,
                pictures = tileJSON.P,
                comments = tileJSON.R;

            if(this.isCellsUpdateRequired(tileInfo, oldTileInfo))
                this.updateCells(cells, oldTileInfo);
            if(tileJSON.CSP !== oldJSON.CSP)
                this.updatePictures(pictures, oldTileInfo);
            if(tileJSON.CSB !== oldJSON.CSB)
                this.updateBorders(borders, oldTileInfo);

            if(tileJSON.CSR !== oldJSON.CSR)
                this.updateComments(comments, oldTileInfo);

            return oldTileInfo.htmlElement;
        },
        isCellsUpdateRequired: function(tileInfo, oldTileInfo) {
            var tileJSON = tileInfo.json,
                oldJSON = oldTileInfo.json;
            var tileEditTexts = tileInfo.editTexts,
                oldEditTexts = oldTileInfo.editTexts;

            return tileJSON.CSC !== oldJSON.CSC || this.spreadsheetControl.isDefaultCellSizeChangedOnResponse() || tileEditTexts !== oldEditTexts;
        },
        updateCells: function(cells, oldTileInfo) {
            var len = cells ? cells.length : 0,
                existingCellsInfo = oldTileInfo.json.C || [];
            while(len--) {
                this.updateCell(cells[len], oldTileInfo);
            }

            len = existingCellsInfo ? existingCellsInfo.length : 0;
            while(len--) {
                this.removeCell(existingCellsInfo[len], oldTileInfo);
            }
        },
        updateCell: function(cellInfo, oldTileInfo) {
            var parentContainer = oldTileInfo.htmlElement,
                oldCells = oldTileInfo.json.C || [],
                columnIndex = cellInfo.P[1],
                rowIndex = cellInfo.P[0],
                cellId = this.getRenderHelper().getCellContainerElementId(rowIndex, columnIndex, this.getPaneType()),
                cellElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(parentContainer, cellId);

            if(cellElement) {
                var index = oldCells ? ASPx.Data.ArrayIndexOf(oldCells, cellInfo, this.cellRecordComparer) : -1;
                if(index >= 0) {
                    if(this.isCellUpdateRequired(cellInfo, oldCells[index], cellElement))
                        this.updateCellStyle(cellElement, cellInfo);
                    ASPx.Data.ArrayRemoveAt(oldCells, index);
                } else
                    this.updateCellStyle(cellElement, cellInfo);
            } else {
                cellElementHtml = this.createCell(cellInfo);
                parentContainer.insertAdjacentHTML("beforeend", cellElementHtml);
            }
        },
        isCellUpdateRequired: function(cellInfo, oldCellInfo, cellElement) {
            return this.spreadsheetControl.isDefaultCellSizeChangedOnResponse() || JSON.stringify(oldCellInfo) != JSON.stringify(cellInfo) || this.needToUpdateCellText(cellElement, cellInfo);
        },
        needToUpdateCellText: function(cellElement, cellInfo) {
            var oldCellHTML = cellElement.childNodes[cellElement.childNodes.length - 1].innerHTML;
            var newCellHTML = this.getCellTextBoxInnerHtml(cellInfo.CE).join("");
            var cellContainsFormula = ASPx.GetInnerText(cellElement).indexOf("=") === 0;

            return (cellContainsFormula || this.needToUpdateValidatingCell(cellInfo)) && oldCellHTML !== newCellHTML;
        },
        needToUpdateValidatingCell: function(cellInfo) {
            var cellColIndex = cellInfo.P[1],
                cellRowIndex = cellInfo.P[0];
            var validationHelper = this.spreadsheetControl.getValidationHelper();
            var currentlyValidatingCell = validationHelper.getCurrentlyValidatingCell();
            var cellIsCurrentlyValidating = false;
            if(currentlyValidatingCell)
                cellIsCurrentlyValidating = currentlyValidatingCell.col == cellColIndex && currentlyValidatingCell.row == cellRowIndex;
            if(cellIsCurrentlyValidating)
                return false;

            return validationHelper.isCellHaveValidation(cellColIndex, cellRowIndex);
        },
        removeCell: function(cellInfo, oldTileInfo) {
            var parentContainer = oldTileInfo.htmlElement,
                columnIndex = cellInfo.P[1],
                rowIndex = cellInfo.P[0],
                cellId = this.getRenderHelper().getCellContainerElementId(rowIndex, columnIndex, this.getPaneType()),
                cellElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(parentContainer, cellId);

            ASPx.RemoveElement(cellElement);
        },
        cellRecordComparer: function(record1, record2) {
            return record1.P[0] === record2.P[0] && record1.P[1] === record2.P[1];
        },
        updateCellStyle: function(cellElement, cellInfo) {
            var newCellElement = this.createFragmentFromHtml(this.createCell(cellInfo)),
                parentContainer = cellElement.parentNode;

            parentContainer.replaceChild(newCellElement, cellElement);
        },

        updatePictures: function(pictures, oldTileInfo) {
            var len = pictures ? pictures.length : 0,
                existingPicturesInfo = oldTileInfo.json.P;
            while(len--) {
                this.updatePicture(pictures[len], oldTileInfo);
            }

            len = existingPicturesInfo ? existingPicturesInfo.length : 0;
            while(len--) {
                this.removePicture(existingPicturesInfo[len], oldTileInfo);
            }
        },
        updatePicture: function(pictureInfo, oldTileInfo) {
            var parentContainer = oldTileInfo.htmlElement,
                id = pictureInfo.P[4],
                existingPictures = oldTileInfo.json.P,
                pictureElement = this.getPictureElementById(parentContainer, id);

            if(pictureElement) {
                var index = existingPictures ? ASPx.Data.ArrayIndexOf(existingPictures, pictureInfo, this.pictureRecordComparer) : -1;
                if(index >= 0) {
                    if(JSON.stringify(existingPictures[index]) !== JSON.stringify(pictureInfo))
                        this.updatePictureAttributes(pictureElement, pictureInfo);
                    this.appendPicture(parentContainer, pictureElement);
                    ASPx.Data.ArrayRemoveAt(existingPictures, index);
                }
            } else {
                pictureElement = this.createPicture(pictureInfo);
                this.appendPicture(parentContainer, pictureElement);
            }
        },
        pictureRecordComparer: function(record1, record2) {
            return record1.P[4] === record2.P[4];
        },
        getPictureElementById: function(parentContainer, id) {
            var pictures = parentContainer.getElementsByTagName("IMG");
            if(pictures && pictures.length > 0) {
                var index = ASPx.Data.ArrayIndexOf(pictures, id, this.pictureComparer);
                return pictures[index];
            }
            return null;
        },
        pictureComparer: function(picture1, id) {
            return ASPx.Attr.GetAttribute(picture1, "gid") === id;
        },
        updatePictureAttributes: function(pictureElement, pictureInfo) {
            var width = pictureInfo.S[0],
                height = pictureInfo.S[1],
                top = pictureInfo.S[2],
                left = pictureInfo.S[3],
                src = pictureInfo.P[0],
                index = pictureInfo.P[1],
                linkProperties = pictureInfo.L,
                zIndex = ASPx.SpreadsheetCssClasses.MaxElementZIndex + parseInt(pictureInfo.P[3]);

            this.updateCollectionIndexAttribute(pictureElement, index);
            this.updatePictureLinksAttributes(pictureElement, linkProperties);
            this.updateSrcAttribute(pictureElement, src);
            ASPx.SetStyles(pictureElement, { width: width, height: height, top: top, left: left, zIndex: zIndex });
        },
        updatePictureLinksAttributes: function(pictureElement, hyperlinkProperties) {
            if(hyperlinkProperties) {
                var navigationUrl = hyperlinkProperties[0],
                    toolTip = hyperlinkProperties[2],
                    isBookMark = hyperlinkProperties[1] === "1";

                ASPx.Attr.SetAttribute(pictureElement.style, "cursor", "pointer");
                ASPx.Attr.SetAttribute(pictureElement, "_loc", navigationUrl);
                ASPx.Attr.SetAttribute(pictureElement, "title", toolTip);
                if(isBookMark)
                    ASPx.Attr.SetAttribute(pictureElement, "bm", "1");
            } else {
                ASPx.Attr.RemoveAttribute(pictureElement, "_loc");
                ASPx.Attr.RemoveAttribute(pictureElement, "title");
                ASPx.Attr.RemoveAttribute(pictureElement, "bm");
                ASPx.Attr.RemoveAttribute(pictureElement.style, "cursor");
            }
        },
        updateSrcAttribute: function(pictureElement, src) {
            var currentSrc = ASPx.Attr.GetAttribute(pictureElement, "src");
            if(currentSrc !== src)
                ASPx.Attr.SetAttribute(pictureElement, "src", src);
        },
        updateCollectionIndexAttribute: function(pictureElement, index) {
            ASPx.Attr.SetAttribute(pictureElement, "data-dbi", index);
        },
        removePicture: function(pictureInfo, oldTileInfo) {
            var parentContainer = oldTileInfo.htmlElement,
                id = pictureInfo.P[4],
                pictureElement = this.getPictureElementById(parentContainer, id);
            if(pictureElement)
                ASPx.RemoveElement(pictureElement);
        },

        updateBorders: function(borders, oldTileInfo) {
            var len = borders ? borders.length : 0,
                existingBorderInfo = oldTileInfo.json.B;
            while(len--) {
                this.updateBorder(borders[len], oldTileInfo);
            }

            len = existingBorderInfo ? existingBorderInfo.length : 0;
            while(len--) {
                this.removeBorder(existingBorderInfo[len], oldTileInfo);
            }
        },
        updateBorder: function(borderInfo, oldTileInfo) {
            var parentContainer = oldTileInfo.htmlElement,
                isVertical = borderInfo.O === ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Border.IsVertical,
                borderPosition = borderInfo.G[0],
                firstGridIndex = borderInfo.G[1],
                lastGridIndex = borderInfo.G[2],
                existingBorders = oldTileInfo.json.B,
                borderId = this.getRenderHelper().getBorderElementId(borderPosition, firstGridIndex, lastGridIndex, this.getPaneType(), isVertical),
                borderElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(parentContainer, borderId);

            if(borderElement) {
                var index = existingBorders ? ASPx.Data.ArrayIndexOf(existingBorders, borderInfo, this.borderRecordComparer) : -1;
                if(index >= 0) {
                    if(JSON.stringify(existingBorders[index]) != JSON.stringify(borderInfo))
                        this.updateBorderAttributes(borderElement, borderInfo);
                    ASPx.Data.ArrayRemoveAt(existingBorders, index);
                }
            } else {
                borderElementHtml = this.createBorder(borderInfo);
                parentContainer.insertAdjacentHTML("beforeend", borderElementHtml);
            }
        },
        borderRecordComparer: function(record1, record2) {
            return record1.G[0] === record2.G[0] && record1.G[1] === record2.G[1] &&
                record1.G[2] === record2.G[2] && record1.O === record2.O;
        },
        updateBorderAttributes: function(borderElement, borderInfo) {
            var width = borderInfo.S[0],
                height = borderInfo.S[1],
                top = borderInfo.S[2],
                left = borderInfo.S[3],
                borderColor = borderInfo.C ? borderInfo.C : ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Border.Color,
                classNameIndex = borderInfo.L ? borderInfo.L : ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Border.LineStyle,
                className = this.getBorderCssFromIndex(classNameIndex),
                isVertical = borderInfo.O === ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Border.IsVertical;

            ASPx.SetStyles(borderElement, { width: width, height: height, top: top, left: left, borderColor: borderColor });
            if(!ASPx.ElementHasCssClass(borderElement, className))
                borderElement.className = ASPx.SpreadsheetCssClasses.getGridLine(isVertical) + " " + className;
        },
        removeBorder: function(borderInfo, oldTileInfo) {
            var parentContainer = oldTileInfo.htmlElement,
                isVertical = borderInfo.O === ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Border.IsVertical,
                borderPosition = borderInfo.G[0],
                firstGridIndex = borderInfo.G[1],
                lastGridIndex = borderInfo.G[2],
                borderId = this.getRenderHelper().getBorderElementId(borderPosition, firstGridIndex, lastGridIndex, this.getPaneType(), isVertical),
                borderElement = ASPx.GetChildById(parentContainer, borderId);
            if(borderElement)
                ASPx.RemoveElement(borderElement);
        },

        updateComments: function(comments, oldTileInfo) {
            var len = comments ? comments.length : 0,
                existingCommentsInfo = oldTileInfo.json.R;
            while(len--)
                this.updateCommentCollection(comments[len], oldTileInfo);

            len = existingCommentsInfo ? existingCommentsInfo.length : 0;
            while(len--)
                this.removeComment(existingCommentsInfo[len], oldTileInfo);
        },
        updateCommentCollection: function(commentInfo, oldTileInfo) {
            var parentContainer = oldTileInfo.htmlElement,
                columnIndex = commentInfo.P[1],
                rowIndex = commentInfo.P[0],
                existingComments = oldTileInfo.json.R,
                commentElementId = this.getRenderHelper().getCommentElementId(rowIndex, columnIndex, this.getPaneType()),
                commentElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(parentContainer, commentElementId);

            if(commentElement) {
                var index = existingComments ? ASPx.Data.ArrayIndexOf(existingComments, commentInfo, this.cellRecordComparer) : -1;
                if(index >= 0 && commentInfo.V)
                    ASPx.Data.ArrayRemoveAt(existingComments, index);
            }
        },
        removeComment: function(commentInfo, oldTileInfo) {
            var parentContainer = this.getRenderHelper().getGridContainer(this.getPaneType()),
                columnIndex = commentInfo.P[1],
                rowIndex = commentInfo.P[0],
                cellId = this.getRenderHelper().getCellContainerElementId(rowIndex, columnIndex, this.getPaneType()),
                cellElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(parentContainer, cellId);


            var commentElementId = this.getRenderHelper().getCommentElementId(rowIndex, columnIndex, this.getPaneType()),
                commentElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(parentContainer, commentElementId),

                connectionLineElementId = this.getRenderHelper().getConnectionLineElementId(rowIndex, columnIndex, this.getPaneType()),
                connectionLineElement = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.getChildElementById(parentContainer, connectionLineElementId);

            ASPx.RemoveElement(commentElement);
            ASPx.RemoveElement(connectionLineElement);

            var indicatorElement = this.getIndicatorElement(cellElement, columnIndex, rowIndex);
            if(indicatorElement && ASPx.ElementContainsCssClass(indicatorElement, ASPx.SpreadsheetCssClasses.CommentIndicator))
                ASPx.RemoveClassNameFromElement(indicatorElement, ASPx.SpreadsheetCssClasses.CommentIndicator);
        },

        createFragmentFromHtml: function(html) {
            /*var range = document.createRange();
            if(range && range.createContextualFragment) {
                parrentNode = this.parentContainer;
                range.selectNode(parrentNode);
                return range.createContextualFragment(html).firstChild;
            }*/ //TODO: uncomment when T367352 will be fixed

            var container = document.createElement("DIV");
            container.innerHTML = html;
            return container.firstChild;
        },
        // Helpers
        getRenderHelper: function() {
            return this.lightRenderHelper;
        },
        getParentControl: function() {
            return this.spreadsheetControl;
        },
        getPaneType: function() {
            return this.getTileHelper().getPaneType();
        },
        setTileHelper: function(tileHelper) {
            this.tileHelper = tileHelper;
        },
        getTileHelper: function() {
            return this.tileHelper;
        },
        getTileMatrix: function() {
            return this.getTileHelper().getTileMatrix();
        },
        getHeaderInfo: function(index, isColumn) {
            return this.getTileHelper().getTileMatrix().getHeaderInfo(index, isColumn);
        },
        setHeaderInfo: function(headerInfo, isColumn) {
            this.getTileMatrix().insertHeaderInfo(headerInfo, isColumn);
        },
        getDataTileInfo: function(rowIndex, columnIndex) {
            return this.getTileMatrix().getGridTileInfo(rowIndex, columnIndex);
        },
        setDataTileInfo: function(dataTileInfo) {
            this.getTileMatrix().insertGridTileInfo(dataTileInfo);
        }
    });
})();

(function() {
    ASPxClientSpreadsheet.TileMatrix = ASPx.CreateClass(null, {
        constructor: function() {
            this.clearCache();
        },
        clearCache: function() {
            this.gridMatrix = {};
            this.colHeaders = {};
            this.rowHeaders = {};
        },
        clearCacheSmart: function(excludedRange) {
            for(var rowCounterIndex in this.gridMatrix) {
                if(!this.gridMatrix.hasOwnProperty(rowCounterIndex)) continue;
                var row = this.gridMatrix[rowCounterIndex];
                for(var colCounterIndex in row) {
                    if(!row.hasOwnProperty(colCounterIndex)) continue;
                    var tileInfo = row[colCounterIndex],
                        rowIndex = tileInfo.rowIndex,
                        colIndex = tileInfo.colIndex,
                        rowInRange = (excludedRange.top <= rowIndex) && (rowIndex <= excludedRange.bottom),
                        columnInRange = (excludedRange.left <= colIndex) && (colIndex <= excludedRange.right),
                        tileIsNotInExcludeRange = !(rowInRange && columnInRange);
                    if(tileIsNotInExcludeRange) {
                        this.removeGridTileInfo(rowIndex, colIndex);
                        if(!rowInRange)
                            this.removeHeaderInfo(rowIndex, false);

                        if(!columnInRange)
                            this.removeHeaderInfo(colIndex, true);
                    }
                }
            }
        },
        getHeaderInfo: function(index, isCol) {
            var hash = isCol ? this.colHeaders : this.rowHeaders;
            return hash[index];
        },
        getTileSizes: function(index, isCol) {
            var headerInfo = this.getHeaderInfo(index, isCol);
            if(!headerInfo) return null;
            return headerInfo[isCol ? "widths" : "heights"];
        },
        getTileTotalSize: function(index, isCol) {
            var headerInfo = this.getHeaderInfo(index, isCol);
            if(!headerInfo) return null;
            return headerInfo[isCol ? "totalWidth" : "totalHeight"];
        },
        getTileIncrementalRanges: function(index, isCol) {
            var headerInfo = this.getHeaderInfo(index, isCol);
            if(!headerInfo) return null;
            return headerInfo[isCol ? "incrementalWidths" : "incrementalHeights"];
        },
        getHeaderInfoArray: function(isCol) {
            var result = [];
            var hash = isCol ? this.colHeaders : this.rowHeaders;
            for(var index in hash)
                if(hash.hasOwnProperty(index))
                    result.push(hash[index]);
            return result;
        },
        getModelIndecesBoundaryPositions: function(isCol) {
            var hash = isCol ? this.colHeaders : this.rowHeaders,
                boundaryIndices = [];
            for(var index in hash)
                if(hash.hasOwnProperty(index) && hash[index]) {
                    var headerInfo = hash[index];
                    if(headerInfo.modelIndices && headerInfo.modelIndices.length > 0) {
                        boundaryIndices.push(headerInfo.modelIndices[0]);
                        boundaryIndices.push(headerInfo.modelIndices[headerInfo.modelIndices.length - 1]);
                    }
                }
            if(boundaryIndices.length > 0)
                boundaryIndices.shift();
            if(boundaryIndices.length > 0)
                boundaryIndices.pop();

            return boundaryIndices;
        },
        findHeaderInfo: function(isCol, delegate) {
            var hash = isCol ? this.colHeaders : this.rowHeaders;
            for(var index in hash) {
                if(!hash.hasOwnProperty(index)) continue;
                var found = delegate(hash[index]);
                if(found) break;
            }
        },
        insertHeaderInfo: function(info, isCol) {
            if(!info) return;
            var hash = isCol ? this.colHeaders : this.rowHeaders;
            hash[info.index] = info;
        },
        removeHeaderInfo: function(index, isCol) {
            var hash = isCol ? this.colHeaders : this.rowHeaders;
            delete hash[index];
        },
        getGridTileInfo: function(rowIndex, colIndex) {
            var row = this.gridMatrix[rowIndex];
            return row && row[colIndex];
        },
        getGridTilesArrayByRowPosition: function(rowIndex) {
            var rowTiles = this.gridMatrix[rowIndex],
                result = [];

            for(var columnIndex in rowTiles)
                if(rowTiles.hasOwnProperty(columnIndex))
                    result.push(rowTiles[columnIndex]);

            return result;
        },
        getGridTilesArrayByColumnPosition: function(columnIndex) {
            var result = [];
            for(var rowIndex in this.gridMatrix) {
                if(!this.gridMatrix.hasOwnProperty(rowIndex)) continue;
                var row = this.gridMatrix[rowIndex];
                if(row[columnIndex])
                    result.push(row[columnIndex]);
            }
            return result;
        },
        getGridTileInfoArray: function() {
            var result = [];
            for(var rowIndex in this.gridMatrix) {
                if(!this.gridMatrix.hasOwnProperty(rowIndex)) continue;
                var row = this.gridMatrix[rowIndex];
                for(var colIndex in row)
                    if(row.hasOwnProperty(colIndex))
                        result.push(row[colIndex]);
            }
            return result;
        },
        insertGridTileInfo: function(info) {
            if(!info) return;
            var row = this.gridMatrix[info.rowIndex] = this.gridMatrix[info.rowIndex] || {};
            row[info.colIndex] = info;
        },
        removeGridTileInfo: function(rowIndex, colIndex) {
            var row = this.gridMatrix[rowIndex];
            if(!row) return;
            delete row[colIndex];
            if(this.getObjectSize(row) > 0) return;
            delete this.gridMatrix[rowIndex];
        },
        containsRange: function(range) {
            for(var r = range.top; r <= range.bottom; r++) {
                for(var c = range.left; c <= range.right; c++)
                    if(!this.getGridTileInfo(r, c))
                        return false;
            }
            return true;
        },
        getObjectSize: function(obj) {
            if(Object.keys)
                return Object.keys(obj).length;
            var count = 0;
            for(var key in obj) {
                if(obj.hasOwnProperty(key))
                    count++;
            }
            return count;
        }
    });
})();
(function() {
    ASPxClientSpreadsheet.GridResizingHelper = ASPx.CreateClass(null, {
        constructor: function(spreadsheet) {
            this.spreadsheet = spreadsheet;
            this.tileSize = this.spreadsheet.getTileSize();

            this.maxSize = { col: 1785, row: 546 }; //Spreadsheet Core Value
            this.resizeGrip = null;
            this.gripSize = 1;
            this.maximumOffset = ASPx.Browser.TouchUI ? 10 : 3;
            this.savedScrollAnchor = null;
            this.headerWidthRanges = {};
            this.headerHeightRanges = {};
        },

        // DOM containers and Helpers
        getRenderHelper: function() { return this.spreadsheet.getRenderHelper(); },
        getPaneManager: function() { return this.spreadsheet.getPaneManager(); },
        getColumnHeader: function(paneType) { return this.getRenderHelper().getColumnHeader(paneType); },
        getRowHeader: function(paneType) { return this.getRenderHelper().getRowHeader(paneType); },
        getHeadersContainer: function(isCol, paneType) { return isCol ? this.getColumnHeader(paneType) : this.getRowHeader(paneType); },

        getEventControlPoint: function(e, exceptHeaders, paneType) {
            var point = this.spreadsheet.getEventControlPoint(e);
            if(exceptHeaders) {
                var headerOffsetSize = this.getPaneManager().getHeaderOffsetSizeForMousePointer(paneType);
                point.x -= headerOffsetSize.width;
                point.y -= headerOffsetSize.height;
            }
            return point;
        },

        getScrollAnchorVisiblePosition: function() { return this.getPaneManager().getScrollAnchorVisiblePosition(); },

        // Resizing flags
        update: function() {
            this.lockResizing = false;
            this.headerWidthRanges = {};
            this.headerHeightRanges = {};

        },
        isResizing: function() { return ASPxClientSpreadsheet.activeResizingHelper === this; },
        canStartResizing: function(e, isCol, paneType) {
            return this.getResizeInfoByMouseEvent(e, isCol, paneType).canResize;
        },
        canStartResizingOnMouseMove: function(e, isCol, paneType) {
            return this.isHeaderCaptured() && this.getResizeInfoByMouseEvent(e, isCol, paneType, this.maximumOffset + 1).canResize;
        },

        // Header Events
        onMouseDown: function(e, isCol, paneType) {
            if(this.lockResizing) return;
            if(ASPx.Browser.TouchUI) {
                var resizeElement = this.getTouchResizeElement();
                paneType = this.getPaneManager().getHeaderPaneTypeByControlPoint({
                    x: ASPx.PxToInt(resizeElement.style.left),
                    y: ASPx.PxToInt(resizeElement.style.top)
                }, isCol);
            }
            var resizeInfo = this.getResizeInfoByMouseEvent(e, isCol, paneType);
            if(!resizeInfo.canResize)
                return;
            
            if(ASPx.Browser.TouchUI)
                this.startResizing(e, isCol, resizeInfo.indexInHeaderRange, paneType);
            else
                this.captureHeader();
            this.showResizeGrip(e, isCol, resizeInfo.indexInHeaderRange, paneType);
            this.spreadsheet.getStateController().finializeProcessing();
            ASPx.Evt.PreventEventAndBubble(e);
        },
        onMouseMove: function(e, isCol, paneType) {
            if(this.lockResizing) return;
            if(this.isHeaderCaptured() && this.headerResizeInfo == null) {
                var resizeInfo = this.getResizeInfoByMouseEvent(e, isCol, paneType);
                this.startResizing(e, isCol, resizeInfo.indexInHeaderRange, paneType);
            }
            if(!this.isResizing()) {
                this.updateCursor(this.canStartResizing(e, isCol, paneType), isCol, paneType);
                return;
            }
            ASPx.Selection.Clear();
            this.resize(e, this.headerResizeInfo.isCol);
        },
        onMouseUp: function(e, isCol) {
            if(ASPxClientSpreadsheet.activeResizingHelper == this)
                this.endResizing(e);
            else
                this.changeResizeGripVisibility(isCol, false);
            this.releaseHeader();
        },

        onDoubleClick: function(e, isCol, paneType) {
            var resizeInfo = this.getResizeInfoByMouseEvent(e, isCol, paneType),
                cellIndexInHeaderRange = resizeInfo.indexInHeaderRange,
                paneManager = this.getPaneManager(),
                scrollAnchor = paneManager.getPaneTopLeftCellVisiblePosition(paneType),
                cellIndex = cellIndexInHeaderRange + (isCol ? scrollAnchor.col : scrollAnchor.row),
                modelIndex = this.getPaneManager().convertVisibleIndexToModelIndex(cellIndex, isCol);

            this.spreadsheet.autoFitHeaderSize(isCol, modelIndex);
            this.releaseHeader();
            this.changeResizeGripVisibility(isCol, false);
            ASPx.Evt.PreventEventAndBubble(e);
        },

        // Header actions
        isHeaderCaptured: function() {
            return this.headerCaptured;
        },
        captureHeader: function() {
            this.headerCaptured = true;
        },
        releaseHeader: function() {
            this.headerCaptured = false;
        },
        startResizing: function(e, isCol, cellIndexInHeaderRange, paneType) {
            this.headerResizeInfo = this.getHeaderResizeInfo(cellIndexInHeaderRange, isCol, paneType);

            ASPxClientSpreadsheet.activeResizingHelper = this;
            ASPx.Selection.SetElementSelectionEnabled(document.body, false);
        },
        resize: function(e, isCol) {
            var pos = this.getCurrentCursorPosition(e, isCol);
            
            var movedHeaderElementsInfo = this.headerResizeInfo.movedHeaderElementsInfo;
            var diff = pos - this.initialPos;
            var sizeStyleName = isCol ? "width" : "height";
            var cellNewSize = this.headerResizeInfo.cellSize + diff;
            var headerNewSize = this.headerResizeInfo.headerTotalSize + diff;
            movedHeaderElementsInfo.resizedTextCell.style[sizeStyleName] = cellNewSize + "px";
            movedHeaderElementsInfo.headerElement.style[sizeStyleName] = headerNewSize + "px";

            var posStyleName = isCol ? "left" : "top";
            movedHeaderElementsInfo.gridLinesContainer.style[posStyleName] = diff + "px";
            movedHeaderElementsInfo.textCellsContainer.style[posStyleName] = diff + "px";
            this.savedPos = pos;

            this.updateResizeGripPosition(pos, isCol);
        },
        endResizing: function(e) {
            var isCol = this.headerResizeInfo.isCol;
            var point = this.getEventControlPoint(e, false);
            var pos = isCol ? point.x : point.y;
            if(pos < this.minPos)
                pos = this.minPos;
            if(pos > this.maxPos)
                pos = this.maxPos;
            var diff = Math.round(pos - this.initialPos);
            if(diff !== 0) {
                var visibleIndex = this.headerResizeInfo.cellIndex;
                var index = this.getPaneManager().convertVisibleIndexToModelIndex(visibleIndex, isCol);
                var size = this.headerResizeInfo.cellSize + diff;
                var resizeMethodName = isCol ? "resizeColumn" : "resizeRow";
                this.spreadsheet[resizeMethodName](index, size);
            }

            this.restoreMovedElements(this.headerResizeInfo);

            this.changeResizeGripVisibility(this.headerResizeInfo.isCol, false);
            this.updateCursor(false, isCol, this.headerResizeInfo.paneType);
            ASPx.Selection.SetElementSelectionEnabled(document.body, true);

            this.initialPos = -1;
            this.minPos = -1;
            this.maxPos = -1;
            this.headerResizeInfo = null;
            ASPxClientSpreadsheet.activeResizingHelper = null;
            this.lockResizing = diff !== 0;
        },

        // Resizing Grip
        changeResizeGripVisibility: function(isCol, visible) {
            var resizeGrip = this.getResizeGrip();
            if(visible) {
                var gridOffsetSize = this.getPaneManager().getVisibleAreaSize(),
                    headerOffsetSize = this.getPaneManager().getHeaderOffsetSize(),
                    width = isCol ? this.gripSize : gridOffsetSize.width - headerOffsetSize.width,
                    height = isCol ? gridOffsetSize.height - headerOffsetSize.height : this.gripSize;

                ASPx.SetStyles(resizeGrip, {
                    width: width,
                    height: height,
                    cursor: this.getCursorValue(isCol)
                });
                resizeGrip.className = isCol ? ASPx.SpreadsheetCssClasses.VerticalResizeGrip : ASPx.SpreadsheetCssClasses.HorizontalResizeGrip;
            }
            ASPx.SetElementDisplay(resizeGrip, visible);
        },
        getCurrentCursorPosition: function(e, isCol) {
            var point = this.getEventControlPoint(e, false),
                pos = isCol ? point.x : point.y;

            if(this.savedPos && this.savedPos === pos)
                return;
            if(pos < this.minPos || pos > this.maxPos) {
                if(this.savedPos === this.minPos || this.savedPos === this.maxPos)
                    return;
                pos = pos < this.minPos ? this.minPos : this.maxPos;
            }
            return pos;
        },
        showResizeGrip: function(e, isCol, cellIndexInHeaderRange, paneType) {
            var point = this.getEventControlPoint(e, false, paneType);

            var headerOffsetSize = this.getPaneManager().getHeaderOffsetSizeForMousePointer(paneType);
            var headerOffset = isCol ? headerOffsetSize.width : headerOffsetSize.height;
            var sizeRanges = isCol ? this.headerWidthRanges[paneType] : this.headerHeightRanges[paneType];

            if(ASPx.Browser.TouchUI) {
                var linePos = sizeRanges[cellIndexInHeaderRange + 1] + headerOffset;
                point.x = isCol ? linePos : point.x;
                point.y = isCol ? point.y : linePos;
            }

            this.initialPos = isCol ? point.x : point.y;

            var maxSize = isCol ? this.maxSize.col : this.maxSize.row;

            var gripCorrection = Math.floor(this.gripSize / 2);
            this.minPos = sizeRanges[cellIndexInHeaderRange] + headerOffset - gripCorrection;
            this.maxPos = maxSize + headerOffset - gripCorrection;

            this.changeResizeGripVisibility(isCol, true);
            var pos = this.getCurrentCursorPosition(e, isCol);
            this.updateResizeGripPosition(pos, isCol);
        },
        updateResizeGripPosition: function(pos, isCol) {
            var headerOffsetSize = this.getPaneManager().getHeaderOffsetSize(),
                resizeGrip = this.getResizeGrip();

            var x = isCol ? pos : headerOffsetSize.width,
                y = !isCol ? pos : headerOffsetSize.height;
            ASPx.SetStyles(resizeGrip, { left: x, top: y });
            this.setTouchResizeElementPos(x, y, isCol);
        },
        getResizeGrip: function() {
            var id = this.getResizeGripID();
            var resizeGrip = ASPx.GetElementById(id);
            if(!resizeGrip) {
                resizeGrip = document.createElement("DIV");
                resizeGrip.id = id;
                this.getRenderHelper().getWorkbookControl().appendChild(resizeGrip);
            }
            return resizeGrip;
        },
        getResizeGripID: function() { return this.getRenderHelper().getChildControlsPrefix() + ASPxClientSpreadsheet.ChildControlIdPostfixes.resizeGrip; },
        getCursorValue: function(isCol) {
            return isCol ? "ew-resize" : "ns-resize";
        },

        // Touch device support
        getTouchResizeElement: function() {
            if(!this.spreadsheet.touchResizeElemnt) {
                this.spreadsheet.touchResizeElemnt = this.createTouchResizeElemnt();
            }
            return this.spreadsheet.touchResizeElemnt;
        },
        getIsTouchResizeElement: function(e) {
            var tapPosition = this.getEventControlPoint(e),
                resizeElement = this.getTouchResizeElement(),
                resizeElementX = ASPx.PxToInt(resizeElement.style.left),
                resizeElementY = ASPx.PxToInt(resizeElement.style.top),
                resizeElementWidthHeight = 20;

            return ASPx.GetElementDisplay(resizeElement) && tapPosition.x >= resizeElementX && tapPosition.x <= resizeElementX + resizeElementWidthHeight &&
                tapPosition.y >= resizeElementY && tapPosition.y <= resizeElementY + resizeElementWidthHeight;
        },
        createTouchResizeElemnt: function() {
            var element = document.createElement("DIV");
            element.className = ASPx.SpreadsheetCssClasses.TouchResizeElement;
            return element;
        },
        setTouchResizeElementPos: function(x, y, isCol) {
            var touchResizeElement = this.getTouchResizeElement(),
                halfSize = 10;

            ASPx.SetStyles(touchResizeElement, { left: isCol ? x - halfSize : 0, top: isCol ? 0 : y - halfSize });
        },
        onScroll: function() {
            if(this.getPaneManager().getFrozenPaneSettings().isFrozen)
                ASPx.SetElementDisplay(this.getTouchResizeElement(), this.spreadsheet.isActiveCellVisible());
            this.updateTouchResizeElementPos();
        },
        updateTouchResizeElementPos: function() {
            if(!ASPx.GetElementDisplay(this.getTouchResizeElement()))
                return;

            var tileSize = this.isCol ? this.tileSize.col : this.tileSize.row,
                lastLineIndex = tileSize - 1,
                tileIndex = Math.floor(this.cellIndex / tileSize),
                lineIndexInTile = this.cellIndex % tileSize + 1;
            if(lineIndexInTile > lastLineIndex) {
                tileIndex++;
                lineIndexInTile = 0;
            }
            var headerTile = this.getRenderHelper().getHeaderTileElementByCellIndex(this.cellIndex, tileIndex, this.isCol);
            if(!headerTile)
                return;
            var lines = ASPx.GetNodesByClassName(headerTile, ASPx.SpreadsheetCssClasses.getGridLine(this.isCol));
            var touchResizeDiv = lines[lineIndexInTile];
            var workbook = this.getRenderHelper().getWorkbookControl();
            var x = ASPx.GetAbsoluteX(touchResizeDiv) - ASPx.GetAbsoluteX(workbook);
            var y = ASPx.GetAbsoluteY(touchResizeDiv) - ASPx.GetAbsoluteY(workbook);
            this.setTouchResizeElementPos(x, y, this.isCol);
        },
        initTouchResizeElement: function(cellIndex, isCol) {
            var touchResizeElement = this.getTouchResizeElement();
            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(touchResizeElement, this.getRenderHelper().getWorkbookControl());
            var changeClassFunc = isCol ? ASPx.RemoveClassNameFromElement : ASPx.AddClassNameToElement;
            changeClassFunc(touchResizeElement, "tre-hor");
            this.isCol = isCol;
            this.cellIndex = cellIndex;
        },
        showTouchResizeElement: function(cellIndex, isCol) {
            this.initTouchResizeElement(cellIndex, isCol);
            ASPx.SetElementDisplay(this.getTouchResizeElement(), true);
            this.updateTouchResizeElementPos();
        },
        hideTouchResizeElement: function() {
            if(this.spreadsheet.touchResizeElemnt)
                ASPx.SetElementDisplay(this.spreadsheet.touchResizeElemnt, false);
        },

        // Helpers
        getHeaderResizeInfo: function(indexInHeaderRange, isCol, paneType) {
            var paneManager = this.getPaneManager(),
                pane = paneManager.getPaneByType(paneType),
                scrollAnchor = paneManager.getPaneTopLeftCellVisiblePosition(paneType);

            var cellIndex = indexInHeaderRange + (isCol ? scrollAnchor.col : scrollAnchor.row),
                tileSize = isCol ? this.tileSize.col : this.tileSize.row,
                tileIndex = Math.floor(cellIndex / tileSize),
                cellIndexInTile = cellIndex - tileIndex * tileSize,
                cellSize = pane.getTileSizes(tileIndex, isCol)[cellIndexInTile],
                headerTotalSize = pane.getTileTotalSize(tileIndex, isCol),
                movedHeaderElementsInfo = this.getMovedHeaderElementsInfo(tileIndex, cellIndexInTile, isCol, paneType);

            return {
                isCol: isCol,
                cellIndex: cellIndex,
                tileIndex: tileIndex,
                cellIndexInTile: cellIndexInTile,
                cellSize: cellSize,
                headerTotalSize: headerTotalSize,
                movedHeaderElementsInfo: movedHeaderElementsInfo,
                paneType: paneType
            };
        },
        getMovedHeaderElementsInfo: function(tileIndex, cellIndexInTile, isCol, paneType) {
            var headerElement = this.getRenderHelper().getHeaderTileElement(tileIndex, isCol, paneType),
                gridLinesContainer = ASPx.GetChildByClassName(headerElement, ASPx.SpreadsheetCssClasses.GridLineContainer),
                textCellsContainer = ASPx.GetChildByClassName(headerElement, ASPx.SpreadsheetCssClasses.HeaderContainer),
                lines = ASPx.GetChildNodesByClassName(gridLinesContainer, ASPx.SpreadsheetCssClasses.getGridLine(isCol)), //TODO replace it to gridLinesContainer.childNodes
                textCells = ASPx.GetChildNodesByClassName(textCellsContainer, ASPx.SpreadsheetCssClasses.HeaderCell); //TODO try to replace to textCellsContainer.childNodes

            var movedLinesContainer = this.createMovedContainer(),
                movedTextCellsContainer = movedLinesContainer.cloneNode(false);

            gridLinesContainer.appendChild(movedLinesContainer);
            textCellsContainer.appendChild(movedTextCellsContainer);

            var elementLength = lines.length;

            for(var i = cellIndexInTile + 1; i < elementLength; i++) {
                var line = lines[i],
                    textCell = textCells[i];

                ASPx.RemoveElement(line);
                movedLinesContainer.appendChild(line);

                ASPx.RemoveElement(textCell);
                movedTextCellsContainer.appendChild(textCell);
            }

            return {
                resizedTextCell: textCells[cellIndexInTile],
                gridLinesContainer: movedLinesContainer,
                textCellsContainer: movedTextCellsContainer,
                headerElement: headerElement
            };
        },
        createMovedContainer: function() {
            var movedContainer = document.createElement("DIV");
            movedContainer.className = ASPx.SpreadsheetCssClasses.ResizeMovedContainer;
            return movedContainer;
        },
        restoreMovedElements: function(headerResizeInfo) {
            var movedHeaderElementsInfo = headerResizeInfo.movedHeaderElementsInfo,
                gridLinesContainer = ASPx.GetChildByClassName(movedHeaderElementsInfo.headerElement, ASPx.SpreadsheetCssClasses.GridLineContainer),
                lines = ASPx.GetChildNodesByClassName(movedHeaderElementsInfo.gridLinesContainer, ASPx.SpreadsheetCssClasses.getGridLine(headerResizeInfo.isCol)),
                textCellsContainer = ASPx.GetChildByClassName(movedHeaderElementsInfo.headerElement, ASPx.SpreadsheetCssClasses.HeaderContainer),
                textCells = ASPx.GetChildNodesByClassName(movedHeaderElementsInfo.textCellsContainer, ASPx.SpreadsheetCssClasses.HeaderCell);

            var elementLength = lines.length;
            for(var i = 0; i < elementLength; i++) {
                var line = lines[i],
                    textCell = textCells[i];

                gridLinesContainer.appendChild(line);
                textCellsContainer.appendChild(textCell);
            }
            ASPx.RemoveElement(movedHeaderElementsInfo.gridLinesContainer);
            ASPx.RemoveElement(movedHeaderElementsInfo.textCellsContainer);
        },
        getResizeInfoByMouseEvent: function(e, isCol, paneType, offset) {
            offset = offset || this.maximumOffset;
            this.ensureCachedHeaderSizes();

            var coordValue = this.getResizeCoordinate(e, isCol, paneType);

            var sizeRanges = isCol ? this.headerWidthRanges[paneType] : this.headerHeightRanges[paneType];
            var indexInRange = ASPx.Data.ArrayBinarySearch(sizeRanges, coordValue, ASPx.Data.NearestLeftBinarySearchComparer);
            var indexFallInRange = indexInRange >= 0;

            var leftBound = sizeRanges[indexInRange] + offset;
            var rightBound = sizeRanges[indexInRange + 1] - offset - 1;

            var satisfyLeftBound = coordValue <= leftBound && indexInRange > 0;
            var satisfyRightBound = coordValue >= rightBound;

            var canResize = ASPx.Browser.TouchUI ? this.getIsTouchResizeElement(e)
                : indexFallInRange && (satisfyLeftBound || satisfyRightBound);
            return {
                canResize: canResize,
                indexInHeaderRange: coordValue >= rightBound ? indexInRange : indexInRange - 1
            };
        },
        getResizeCoordinate: function(e, isCol, paneType) {
            var point = this.getEventControlPoint(e, true, paneType);
            return isCol ? point.x : point.y;
        },
        ensureCachedHeaderSizes: function() {
            var scrollAnchor = this.getScrollAnchorVisiblePosition();
            if(this.savedScrollAnchor && this.savedScrollAnchor.col === scrollAnchor.col && this.savedScrollAnchor.row === scrollAnchor.row &&
                this.headerWidthRanges[ASPxClientSpreadsheet.PaneManager.PanesType.MainPane] && this.headerWidthRanges[ASPxClientSpreadsheet.PaneManager.PanesType.MainPane].length > 0 &&
                this.headerHeightRanges[ASPxClientSpreadsheet.PaneManager.PanesType.MainPane].length > 0)
                return;

            this.updateHeaderRanges();
        },
        updateHeaderRanges: function() {
            var viewBounds = this.getPaneManager().calculateHeaderViewBounds();
            for(var paneType in viewBounds) {
                if(viewBounds.hasOwnProperty(paneType) && viewBounds[paneType]) {
                    var viewBound = viewBounds[paneType];
                    this.headerWidthRanges[paneType] = this.calculateHeaderSizeRanges(viewBound, true, paneType);
                    this.headerHeightRanges[paneType] = this.calculateHeaderSizeRanges(viewBound, false, paneType);
                }
            }
            this.savedScrollAnchor = this.getScrollAnchorVisiblePosition();
        },
        calculateHeaderSizeRanges: function(viewBound, isCol, paneType) {
            var pane = this.getPaneManager().getPaneByType(paneType),
                startCellIndex = isCol ? viewBound.left : viewBound.top,
                endCellIndex = isCol ? viewBound.right : viewBound.bottom,
                tileSize = isCol ? this.tileSize.col : this.tileSize.row;

            var startTileIndex = Math.floor(startCellIndex / tileSize),
                endTileIndex = Math.floor(endCellIndex / tileSize);

            var startCellIndexInTile = startCellIndex - startTileIndex * tileSize,
                endCellIndexInTile = endCellIndex - endTileIndex * tileSize;

            var resultRanges = [];
            var totalSize = 0;
            resultRanges.push(totalSize);
            for(var i = startTileIndex; i <= endTileIndex; i++) {
                var start = i === startTileIndex ? startCellIndexInTile : 0,
                    end = i === endTileIndex ? endCellIndexInTile : tileSize - 1,
                    tileSizeArray = pane.getTileSizes(i, isCol);
                if(!tileSizeArray)
                    continue;
                var tileSizes = tileSizeArray.slice(start, end + 1);
                for(var j = 0; j < tileSizes.length; j++) {
                    totalSize += tileSizes[j];
                    resultRanges.push(totalSize);
                }
            }
            return resultRanges;
        },
        updateCursor: function(canResize, isCol, paneType) {
            var headerContainer = this.getHeadersContainer(isCol, paneType);
            var prevCanResize = !!headerContainer.dxPrevCanResize;
            if(prevCanResize === canResize)
                return;
            headerContainer.dxPrevCanResize = canResize;

            if(canResize)
                ASPx.AddClassNameToElement(headerContainer, "resizing");
            else
                ASPx.RemoveClassNameFromElement(headerContainer, "resizing");
        },
        generateRandomClassName: function() {
            return "dxss" + Math.floor((Math.random() + 1) * 100000).toString(36);
        }
    });

    ASPxClientSpreadsheet.activeResizingHelper = null;

    ASPx.Evt.AttachEventToDocument(ASPx.TouchUIHelper.touchMouseMoveEventName, function(e) {
        if(ASPxClientSpreadsheet.activeResizingHelper != null && !(ASPx.Browser.WebKitTouchUI && ASPx.TouchUIHelper.isGesture)) {
            ASPxClientSpreadsheet.activeResizingHelper.onMouseMove(e);
            return true;
        }
    });
})();

/*# using DevExpress.Web.Scripts; #*/
/*# namespace DevExpress.Web.ASPxSpreadsheet.Scripts #*/

(function () {
    /*# public delegate void ASPxClientSpreadsheetSelectionChangedEventHandler(object source,ASPxClientSpreadsheetSelectionChangedEventArgs e);#*/
    /*# public class ASPxClientSpreadsheetSelectionChangedEventArgs : ASPxClientEventArgs #*/
    var ASPxClientSpreadsheetSelectionChangedEventArgs = ASPx.CreateClass(ASPxClientEventArgs, {
        /*# public ASPxClientSpreadsheetSelectionChangedEventArgs(ASPxClientSpreadsheetSelection selection) : base() {} #*/
        constructor: function(selection) {
            this.constructor.prototype.constructor.call(this);
            /*# public ASPxClientSpreadsheetSelection selection { get { return null; } } #*/
            this.selection = selection;
        }
    });

    /*# public class ASPxClientSpreadsheetSelection : JavaScriptObject #*/
    ASPxClientSpreadsheet.ASPxClientSpreadsheetSelection = (function(){
        return function(activeCellColumnIndex, activeCellRowIndex, leftColumnIndex, topRowIndex, rightColumnIndex, bottomRowIndex) {
            /*# public int activeCellColumnIndex { get { return 0; } } #*/
            /*# public int activeCellRowIndex    { get { return 0; } } #*/

            /*# public int leftColumnIndex  { get { return 0; } } #*/
            /*# public int topRowIndex      { get { return 0; } } #*/
            /*# public int rightColumnIndex { get { return 0; } } #*/
            /*# public int bottomRowIndex   { get { return 0; } } #*/

            this.activeCellColumnIndex = activeCellColumnIndex;
            this.activeCellRowIndex = activeCellRowIndex;

            this.leftColumnIndex = leftColumnIndex;
            this.topRowIndex = topRowIndex;
            this.rightColumnIndex = rightColumnIndex;
            this.bottomRowIndex = bottomRowIndex;
        };
    })();
    
    window.ASPxClientSpreadsheetSelectionChangedEventArgs = ASPxClientSpreadsheetSelectionChangedEventArgs;
})();
ASPxClientSpreadsheet.CellPosHint = {
    show: function(cellLayoutInfo, cellEditorElement) {
        if(!cellLayoutInfo) return;

        var wnd = ASPxClientHint.createdWindows.findByTargetElement(cellEditorElement);
        if(wnd) return;

        var positionText = ASPxClientSpreadsheet.CellHelper.getColumnStringRepresentaion(cellLayoutInfo.colModelIndex) + (cellLayoutInfo.rowModelIndex + 1);

        ASPxClientHint.Show(cellEditorElement, {
            classNames: {
                mainElementClassName: "dxss-cell-pos-hint",
                sysClassName: "dxhSys",
                contentElementClassName: "dxh-content"
            },
            position: "left",
            content: positionText,
            showCallout: false,
            offset: 2,
            height: "19px",
            container: cellEditorElement.parentNode
        });
    },

    hide: function(cellEditorElement) {
        ASPxClientHint.Hide(cellEditorElement);
    }
};

(function() {
    ASPxClientSpreadsheet.EditingHelper = function(spreadsheetControl) {
        this.spreadsheetControl = spreadsheetControl;

        var editingCellCache = {},
            formulaMultySheetEditing = false;

        this.onScroll = function() {
            var editMode = spreadsheetControl.getStateController().getEditMode();

            if(editMode === ASPxClientSpreadsheet.StateController.Modes.Edit
                || editMode === ASPxClientSpreadsheet.StateController.Modes.Enter) {
                var cellEditorElement = this.getInplaceEditor();
                ASPxClientSpreadsheet.CellPosHint.show(editingCellCache.cellLayoutInfo, cellEditorElement);

                spreadsheetControl.getDynamicSelectionHelper().refresh();

                // INFO: following code allows cell editor to track the scroll. This behaviour contradicts to T497229.
                /*var cellLayoutInfo = editingCellCache.cellLayoutInfo;
                isEditingCellVisible = (cellLayoutInfo != null) && getIsEditingCellVisible(cellLayoutInfo.rect, cellLayoutInfo);
                if(isEditingCellVisible) {
                    ASPx.SetElementDisplay(this.getInplaceEditor(), true);
                    ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementPosWithElementOffset(this.getInplaceEditor(), cellLayoutInfo.rect, cellLayoutInfo.tileInfo.htmlElement);
                }
                else
                    ASPx.SetElementDisplay(this.getInplaceEditor(), false);
				*/
            }
        };

        //TODO Breake this function
        this.startEditing = function(cellLayoutInfo, editMode) {
            var inputController = this.spreadsheetControl.getInputController(),
                sizeParameters = calculateInplaceEditorSizeParameters(cellLayoutInfo),
                rect = sizeParameters.inplaceEditorRect,
                cellModelPosition = sizeParameters.inplaceEitorCellModelPosition;
            cellLayoutInfo = sizeParameters.inplaceEditorCellLayoutInfo;

            var cancel = this.spreadsheetControl.RaiseCellBeginEdit(cellModelPosition);
            if(cancel)
                return this.spreadsheetControl.getStateController().cancelEditingSilently();

            this.spreadsheetControl.onEditingStarting();
            inputController.onEditingStarting();

            var isFormulaBarEditMode = editMode === ASPxClientSpreadsheet.StateController.Modes.FormulaBarEdit;
            var cellEditorElement = this.getInplaceEditor();
            var cellTextViewElement = this.spreadsheetControl.getCellTextViewElement();
            var inplaceEditingCellElement = isFormulaBarEditMode ? cellTextViewElement : cellEditorElement;
            var isEditingCellVisible = getIsEditingCellVisible(rect, cellLayoutInfo);
            var cellTextViewElementSelectionOnClick = isFormulaBarEditMode ? ASPx.Selection.GetInfo(cellTextViewElement) : null;

            var editingIsVisible = isEditingCellVisible || isFormulaBarEditMode;
            if(editingIsVisible) {
                if(isFormulaBarEditMode)
                    this.adjustIframeOverFormulaBar();

                if(isEditingCellVisible)
                    moveElementToCell(inplaceEditingCellElement, cellLayoutInfo, rect);

                if(ASPxClientSpreadsheet.StateController.IsEditingMode(editMode)) {
                    var rawValue = ASPx.IsExists(cellTextViewElement) ? cellTextViewElement.value
                        : this.spreadsheetControl.getPaneManager().getCellEditingText(cellModelPosition.colIndex, cellModelPosition.rowIndex);
                    if(rawValue && rawValue.length) {
                        inputController.setTextAsHtml(rawValue);
                        inputController.setCaretPosition();
                    }
                    if(isFormulaBarEditMode) {
                        inputController.captureFocus();
                        setSelectionToEditor(cellEditorElement, cellTextViewElementSelectionOnClick);
                    }
                    else
                        this.scrollCellTextViewElementToEditingRow();
                }

                editingCellCache.cellLayoutInfo = cellLayoutInfo;
                editingCellCache.cellModelPosition = cellModelPosition;

                prepareInplaceCellElement(isFormulaBarEditMode ? cellTextViewElement : inputController.getContentContainer(), cellModelPosition);
                if(!isFormulaBarEditMode)
                    prepareTextVerticalAlign(inputController.getContentContainer(), rect);

                adjustEditorSize(inplaceEditingCellElement);
                hideSelectionBorder();
                prepareInplaceFormulaBarElement(this.getInplaceFormulaBarElement());

                this.spreadsheetControl.onEditingStarted();

                editingCellCache.editorBorderWidth = editingCellCache.editorBorderWidth || (ASPx.GetHorizontalBordersWidth(cellEditorElement) / 2);

                inputController.onEditingStarted();
            } else {
                var onScroll = function() { this.startEditing(cellLayoutInfo, editMode); }.aspxBind(this);
                this.spreadsheetControl.navigateToCell(cellLayoutInfo.colModelIndex, cellLayoutInfo.rowModelIndex, onScroll);
            }
        };

        this.apply = function(cellLayoutInfo) {
            var value = spreadsheetControl.getInputController().getEditorText(),
                rowModelIndex = cellLayoutInfo.rowModelIndex,
                colModelIndex = cellLayoutInfo.colModelIndex;
            if(editingCellCache.croppedRange) {
                if(rowModelIndex === editingCellCache.croppedRange.visibleModelPosition.rowIndex && editingCellCache.croppedRange.visibleModelPosition.colIndex == colModelIndex) {
                    colModelIndex = editingCellCache.croppedRange.realModelPosition.colIndex;
                    rowModelIndex = editingCellCache.croppedRange.realModelPosition.rowIndex;
                }
                editingCellCache.croppedRange = null;
            }

            var oldRawValue = this.spreadsheetControl.getPaneManager().getCellEditingText(colModelIndex, rowModelIndex),
                isValueChanged = !((oldRawValue === value) || (oldRawValue == null && value == "")),
                isCellHaveValidation = this.spreadsheetControl.getValidationHelper().isCellHaveValidation(colModelIndex, rowModelIndex),
                ownerSheetId = this.getOwnerSheetId();

            this.stopEditing();

            if(isValueChanged || isCellHaveValidation) {
                this.spreadsheetControl.onEditingEventStopped();
                this.spreadsheetControl.onCellValueChangedWithNewSelection(
                    {
                        Column: colModelIndex,
                        Row: rowModelIndex
                    }, value, ownerSheetId);
            }
        };

        this.raiseCellEndEditEvent = function(cellLayoutInfo, value) {
            value = (typeof value !== "undefined") ? value : spreadsheetControl.getInputController().getEditorText();
            var rowModelIndex = cellLayoutInfo.rowModelIndex,
                colModelIndex = cellLayoutInfo.colModelIndex;
            if(editingCellCache.croppedRange) {
                if(rowModelIndex === editingCellCache.croppedRange.visibleModelPosition.rowIndex && editingCellCache.croppedRange.visibleModelPosition.colIndex == colModelIndex) {
                    colModelIndex = editingCellCache.croppedRange.realModelPosition.colIndex;
                    rowModelIndex = editingCellCache.croppedRange.realModelPosition.rowIndex;
                }
            }
            var args = spreadsheetControl.RaiseCellEndEdit({ colIndex: colModelIndex, rowIndex: rowModelIndex }, value);
            if(args) {
                if(value !== args.editorText) {
                    spreadsheetControl.getInputController().setTextAsHtml(args.editorText);
                }
                return !args.cancel;
            }
            return true;
        };

        this.scrollCellTextViewElementToNeighbourRow = function(step) {
            var cellTextViewElement = spreadsheetControl.getCellTextViewElement();
            var oldScrollTop = cellTextViewElement.scrollTop;
            var scrollTopDifference = cellTextViewElement.offsetHeight * step;
            cellTextViewElement.scrollTop += scrollTopDifference;
            var scrollTopHasExpectedValue = cellTextViewElement.scrollTop === oldScrollTop + scrollTopDifference;
            if(!scrollTopHasExpectedValue)
                cellTextViewElement.scrollTop = oldScrollTop;
        };

        this.cancelEditing = function() {
            var destinationSheetId = this.getOwnerSheetId(),
                multySheetEditing = multySheetFormulaEditingInProgress();

            spreadsheetControl.RaiseCellCancelEdit(editingCellCache.cellModelPosition);
            this.stopEditing();

            onAfterStopEditing(multySheetEditing, destinationSheetId);
        };

        this.stopEditing = function() {
            var cellEditorElement = this.getInplaceEditor();
            ASPxClientSpreadsheet.CellPosHint.hide(cellEditorElement);

            ASPx.SetElementDisplay(cellEditorElement, true);
            var inputController = spreadsheetControl.getInputController();
            inputController.onEditingStopped();

            this.spreadsheetControl.onEditingStopped();
            editingCellCache = {};

            this.deactivateCrossSheetMode();

            var cellTextViewElement = this.spreadsheetControl.getCellTextViewElement();
            if(ASPx.IsExists(cellTextViewElement)) {
                cellTextViewElement.scrollTop = 0;
                if(spreadsheetControl.isFormulaBarEditMode()) {
                    moveViewElementToFormulaBar(cellTextViewElement);
                    prepareInplaceFormulaBarElement(cellTextViewElement);
                }
            }
            this.spreadsheetControl.hideIntelliSenseElements();
        };

        this.getInplaceFormulaBarElement = function() {
            return spreadsheetControl.isFormulaBarEditMode() ? spreadsheetControl.getInputController().getContentContainer() : spreadsheetControl.getCellTextViewElement();
        };
        this.getInplaceEditingCellElement = function() {
            return spreadsheetControl.isFormulaBarEditMode() ? spreadsheetControl.getCellTextViewElement() : this.getInplaceEditor();
        };
        this.getInplaceEditor = function() {
            return spreadsheetControl.getInputController().getInplaceEditor();
        };

        this.updateInplaceEditingCellElementSize = function() {
            var paneManager = spreadsheetControl.getPaneManager(),
                colIndex = editingCellCache.cellLayoutInfo.colIndex,
                rowIndex = editingCellCache.cellLayoutInfo.rowIndex,
                editorBorderWidth = editingCellCache.editorBorderWidth,
                sizeParameters;

            editingCellCache = {
                editorBorderWidth: editorBorderWidth,
                cellLayoutInfo: paneManager.getCellLayoutInfo(colIndex, rowIndex)
            };

            sizeParameters = calculateInplaceEditorSizeParameters(editingCellCache.cellLayoutInfo);

            editingCellCache.cellModelPosition = sizeParameters.inplaceEitorCellModelPosition;

            var inplaceEditingCellElement = this.getInplaceEditingCellElement();

            // moveElementToCell(inplaceEditingCellElement, editingCellCache.cellLayoutInfo, sizeParameters.inplaceEditorRect); // T497229
            adjustEditorSize(inplaceEditingCellElement);
        };

        this.createCellTextViewElement = function() {
            var cellTextViewElement = document.createElement("textarea");
            cellTextViewElement.className = ASPx.SpreadsheetCssClasses.CellTextViewElement;
            moveViewElementToFormulaBar(cellTextViewElement);
            prepareInplaceFormulaBarElement(cellTextViewElement);
            return cellTextViewElement;
        };

        function setSelectionToEditor(cellEditorElement, selection) {
            if(!selection) return;
            var setSelectionToEditorCore = function() {
                var inputController = spreadsheetControl.getInputController();
                inputController.setSelection(selection.startPos, selection.endPos);
            };
            if(ASPx.Browser.Opera || ASPx.Browser.IE || ASPx.Browser.TouchUI)
                setTimeout(function() { setSelectionToEditorCore(); }, 100);
            else
                setSelectionToEditorCore();
        }

        this.scrollCellTextViewElementToEditingRow = function() {
            var inputController = spreadsheetControl.getInputController();
            var cellTextViewElement = spreadsheetControl.getCellTextViewElement();
            if(ASPx.IsExists(cellTextViewElement))
                cellTextViewElement.scrollTop = inputController.getEditorCurrentRowIndex() * cellTextViewElement.offsetHeight;
        };

        this.onEditorElementValueChange = function() {
            this.syncronizeEditorValue();
            if(!spreadsheetControl.isFormulaBarEditMode())
                this.scrollCellTextViewElementToEditingRow();

            window.setTimeout(function() {
                if(spreadsheetControl.getStateController().getEditMode() === ASPxClientSpreadsheet.StateController.Modes.Ready)
                    return;
                this.adjustEditor();
            }.aspxBind(this), 0);
        };

        this.syncronizeEditorValue = function() {
            var inputController = spreadsheetControl.getInputController();
            var editorText = inputController.getEditorText();
            if(this.getInplaceFormulaBarElement())
                this.getInplaceFormulaBarElement().value = editorText;
            if(this.getInplaceEditingCellElement())
                this.getInplaceEditingCellElement().value = editorText;
        };

        function getEditMergedCellsRange(colIndex, rowIndex) {
            var selectionHelper = spreadsheetControl.getSelectionHelper(),
                editingRange = new ASPxClientSpreadsheet.Range(colIndex, rowIndex, colIndex, rowIndex);
            return selectionHelper.ExpandRangeToMergedCellSize(editingRange);
        }

        function getElementAttributesList(skipPaddings, skipColorAndAlign) {
            var result = [
                "fontWeight",
                "fontFamily",
                "fontSize",
                "fontStyle",
                "fontDecoration"
            ];

            if(!skipPaddings)
                result.push(
                    "padding",
                    "paddingLeft",
                    "paddingTop",
                    "paddingRight",
                    "paddingBottom"
                );

            if(!skipColorAndAlign)
                result.push(
                    "backgroundColor",
                    "color",
                    "verticalAlign",
                    "textAlign"
                );

            return result;
        }

        function getCorrectCellPosition() {
            var paneManager = spreadsheetControl.getPaneManager(),
                paneType = paneManager.getPaneTypeByCell(editingCellCache.activeCell),
                topLeftCell = paneManager.getPaneTopLeftCellVisiblePosition(paneType),
                activeCellInfo = editingCellCache.cellLayoutInfo,
                topLeftCellLayoutInfo = paneManager.getCellLayoutInfo(topLeftCell.col, topLeftCell.row),
                rect = ASPxClientSpreadsheet.CellHelper.getCellRangeRect(topLeftCellLayoutInfo, editingCellCache.cellLayoutInfo, editingCellCache.cellLayoutInfo.tileInfo);

            return {
                x: rect.width - activeCellInfo.rect.width,
                y: rect.height - activeCellInfo.rect.height
            };
        }

        function getCorrectCellLayoutInfo(cellLayoutInfo) {
            var paneManager = spreadsheetControl.getPaneManager(),
                editingRange = getEditMergedCellsRange(cellLayoutInfo.colIndex, cellLayoutInfo.rowIndex),
                correctionWidth = 0;

            if(!editingRange.singleCell) {
                var topLeftCLI = paneManager.getCellLayoutInfo(editingRange.leftColIndex, editingRange.topRowIndex),
                    bottomRightCLI = paneManager.getCellLayoutInfo(editingRange.rightColIndex, editingRange.bottomRowIndex);

                if(topLeftCLI.paneType !== bottomRightCLI.paneType) {
                    var rightPaneTopLeftCLI = paneManager.getPaneTopLeftCellLayoutInfo(bottomRightCLI.paneType);

                    if(rightPaneTopLeftCLI.colIndex > bottomRightCLI.colIndex) { // bottom right cell is overlapped by a left pane
                        bottomRightCLI.colModelIndex = rightPaneTopLeftCLI.colModelIndex;
                        bottomRightCLI.rect.x = rightPaneTopLeftCLI.rect.x;

                        correctionWidth = correctionWidth - rightPaneTopLeftCLI.rect.width;
                    }
                }

                cellLayoutInfo.rect = ASPxClientSpreadsheet.CellHelper.getCellRangeRect(topLeftCLI, bottomRightCLI, topLeftCLI.tileInfo);

                // Correction for client area
                cellLayoutInfo.rect.width -= spreadsheetControl.getGridLineSize();
                cellLayoutInfo.rect.height -= spreadsheetControl.getGridLineSize();

                cellLayoutInfo.colIndex = editingCellCache.elementHasRightTextAlign ? editingRange.leftColIndex : editingRange.rightColIndex;
            }
            cellLayoutInfo.rect.width += correctionWidth;

            editingCellCache.editingRange = editingRange;

            return cellLayoutInfo;
        }

        function getWrapText(editingCellCache) {
            if(editingCellCache.wrapText === undefined) {
                var cellTextElement = spreadsheetControl.getRenderHelper().getCellTextElement(editingCellCache.cellLayoutInfo.colIndex, editingCellCache.cellLayoutInfo.rowIndex);
                if(!!cellTextElement)
                    editingCellCache.wrapText = ASPx.ElementHasCssClass(cellTextElement, "dxss-wrap");
            }

            return editingCellCache.wrapText;
        }

        this.adjustIframeOverFormulaBar = function() {
            var textWrapperElement = spreadsheetControl.getRenderHelper().getFormulaBarTextWrapperElement(),
                style = ASPx.GetCurrentStyle(textWrapperElement),
                rect = {
                    x: ASPx.GetAbsoluteX(textWrapperElement) + ASPx.PxToInt(style.paddingLeft) + ASPx.PxToInt(style.borderLeftWidth),
                    y: ASPx.GetAbsoluteY(textWrapperElement) + ASPx.PxToInt(style.paddingTop) + ASPx.PxToInt(style.borderTopWidth),
                    width: ASPx.GetClearClientWidth(textWrapperElement),
                    height: ASPx.GetClearClientHeight(textWrapperElement)
                };

            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRectWithElementOffset(this.getInplaceEditor(), rect, null);
        };
        this.adjustEditor = function() {
            adjustEditorSize(this.getInplaceEditingCellElement());
        };
        function adjustEditorSize(element) {
            if(!ASPx.IsElementVisible(element)) return;

            ensureEditingCellCache(element);

            adjustEditorWidth();
            adjustEditorLeftPosition();
            adjustEditorHeight();

            updateIntelliSenseElementsPosition();
        }

        function ensureEditingCellCache(element) {
            var renderHelper = spreadsheetControl.getRenderHelper(),
                inputController = spreadsheetControl.getInputController(),
                contentContainer = inputController.getContentContainer(),
                isFormulaBarEditingMode = spreadsheetControl.isFormulaBarEditMode();

            ensureActiveCell();

            editingCellCache.element = element;
            editingCellCache.contentContainer = contentContainer;
            editingCellCache.elementHasRightTextAlign = ASPx.GetCurrentStyle(contentContainer).textAlign === "right";
            editingCellCache.cellLayoutInfo = getCorrectCellLayoutInfo(editingCellCache.cellLayoutInfo);
            editingCellCache.headerWidth = editingCellCache.headerWidth || renderHelper.getRowHeader().offsetWidth;
            editingCellCache.headerHeight = editingCellCache.headerHeight || renderHelper.getColumnHeader().offsetHeight;

            ensureBoundaries();

            editingCellCache.editorPosition = editingCellCache.editorPosition || getCorrectCellPosition();

            ensureCellWidth();
            ensureCellHeight();

            editingCellCache.wrapText = getWrapText(editingCellCache);
            editingCellCache.editorWidth = editingCellCache.cellWidth;
            editingCellCache.colIndex = editingCellCache.elementHasRightTextAlign ? editingCellCache.cellLayoutInfo.colIndex - 1 : editingCellCache.cellLayoutInfo.colIndex + 1;
            editingCellCache.rowIndex = editingCellCache.cellLayoutInfo.rowIndex + 1;
            editingCellCache.editorX = editingCellCache.editorPosition.x;

            var normalizedText = inputController.getEditorText().replace(/ /g, "'");
            var etalonElement = isFormulaBarEditingMode ? element : contentContainer;
            editingCellCache.normalizedTextLines = normalizedText.split("\n");
            editingCellCache.fontSize = ASPx.PxToFloat(etalonElement.style.fontSize);
            editingCellCache.textSize = getMaxLineSize(editingCellCache.normalizedTextLines, etalonElement.style);

            if(!editingCellCache.initialTextSize) {
                var initialCellText = spreadsheetControl.getPaneManager().getCellEditingText(editingCellCache.cellModelPosition.colIndex, editingCellCache.cellModelPosition.rowIndex);
                if(initialCellText)
                    editingCellCache.initialTextSize = getMaxLineSize(initialCellText.split("\n"), etalonElement.style);
                else
                    editingCellCache.initialTextSize = editingCellCache.textSize;
                editingCellCache.initialEditorWidth = -1;
            }
            editingCellCache.needAdjustHeight = editingCellCache.wrapText || false;
            editingCellCache.edgeReached = false;
        }

        function ensureBoundaries() {
            var cache = editingCellCache,
                renderHelper = spreadsheetControl.getRenderHelper(),
                paneManager = spreadsheetControl.getPaneManager();

            var topLeftCellLayoutInfo = paneManager.getCellLayoutInfo(cache.editingRange.leftColIndex, cache.editingRange.topRowIndex),
                topRightCellLayoutInfo = paneManager.getCellLayoutInfo(cache.editingRange.rightColIndex, cache.editingRange.topRowIndex),
                bottomRightCellLayoutInfo = paneManager.getCellLayoutInfo(cache.editingRange.rightColIndex, cache.editingRange.bottomRowIndex);

            cache.paneWidth = cache.paneWidth || renderHelper.getGridOffsetSize(topLeftCellLayoutInfo.paneType).width;
            if(topLeftCellLayoutInfo.paneType !== topRightCellLayoutInfo.paneType)
                cache.paneWidth += renderHelper.getGridOffsetSize(topRightCellLayoutInfo.paneType).width;

            cache.paneHeight = cache.paneHeight || renderHelper.getGridOffsetSize(topRightCellLayoutInfo.paneType).height;
            if(topRightCellLayoutInfo.paneType !== bottomRightCellLayoutInfo.paneType)
                cache.paneHeight += renderHelper.getGridOffsetSize(bottomRightCellLayoutInfo.paneType).height;
        }

        function ensureActiveCell() {
            if(!editingCellCache.activeCell) {
                editingCellCache.activeCell = {
                    col: editingCellCache.cellLayoutInfo.colIndex,
                    row: editingCellCache.cellLayoutInfo.rowIndex
                };
            }
        }
        function ensureCellWidth() {
            if(!editingCellCache.cellWidth)
                editingCellCache.cellWidth = calculateCellWidth();
        }
        function calculateCellWidth() {
            var cellEditorOutsideRightVisibleAreaBound = editingCellCache.cellLayoutInfo.rect.width > editingCellCache.paneWidth - editingCellCache.editorPosition.x;
            if(cellEditorOutsideRightVisibleAreaBound)
                return editingCellCache.paneWidth - editingCellCache.editorPosition.x - editingCellCache.editorBorderWidth;
            else
                return editingCellCache.cellLayoutInfo.rect.width;
        }
        function ensureCellHeight() {
            if(!editingCellCache.cellHeight)
                editingCellCache.cellHeight = calculateCellHeight();
        }
        function calculateCellHeight() {
            var cellEditorOutsideBottomVisibleAreaBound = editingCellCache.cellLayoutInfo.rect.height > editingCellCache.paneHeight - editingCellCache.editorPosition.y;
            if(cellEditorOutsideBottomVisibleAreaBound)
                return editingCellCache.paneHeight - editingCellCache.editorPosition.y - editingCellCache.editorBorderWidth;
            else
                return editingCellCache.cellLayoutInfo.rect.height;
        }

        function adjustEditorWidth() {
            var cache = editingCellCache;

            while(shouldAdjustWidth())
                adjustWidthCore();

            editingCellCache.editorWidth -= ASPx.GetLeftRightPaddings(cache.element);

            if(cache.editorWidth >= cache.initialEditorWidth) {
                cache.element.style.width = cache.editorWidth + "px";
                synchronizeChildControls(cache.editorWidth);
            }

            if(editingCellCache.initialEditorWidth < 0)
                editingCellCache.initialEditorWidth = editingCellCache.editorWidth;
        }
        function shouldAdjustWidth() {
            return (editingCellCache.editorWidth < editingCellCache.textSize.width || editingCellCache.editorWidth < editingCellCache.initialTextSize.width)
                && !editingCellCache.wrapText && !editingCellCache.edgeReached;
        }
        function adjustWidthCore() {
            var cache = editingCellCache,
                nextCell = getNextHorizontalCell(),
                remainingSpace = getRemainingSpace(),
                isNextCellPartiallyHidden = !nextCell.rect || remainingSpace <= nextCell.rect.width,
                nextCellOutOfBoundary = nextCell.colModelIndex >= ASPxClientSpreadsheet.Range.MAX_COL_COUNT;

            if(nextCellOutOfBoundary) {
                cache.needAdjustHeight = true;
                cache.edgeReached = true;
                return;
            }
            if(isNextCellPartiallyHidden) {
                cache.editorWidth += remainingSpace;
                if(cache.elementHasRightTextAlign)
                    cache.editorX -= remainingSpace;

                cache.needAdjustHeight = true;
                cache.edgeReached = true;

                return;
            }
            cache.editorWidth += nextCell.rect.width;
            if(cache.elementHasRightTextAlign)
                cache.editorX -= nextCell.rect.width;

            cache.colIndex = cache.elementHasRightTextAlign ? nextCell.colIndex - 1 : nextCell.colIndex + 1;
        }

        function adjustEditorLeftPosition() {
            if(editingCellCache.elementHasRightTextAlign)
                adjustEditorLeftCore(editingCellCache.editorX - editingCellCache.editorPosition.x);
        }
        function adjustEditorLeftCore(difference) {
            var style = ASPx.GetCurrentStyle(editingCellCache.element);
            var editorClientAreaX = editingCellCache.cellLayoutInfo.rect.x + spreadsheetControl.getGridLineSize();
            var editorX = editorClientAreaX - ASPx.PxToInt(style.borderLeftWidth);

            editingCellCache.tileXOffset = editingCellCache.tileXOffset || ASPxClientUtils.GetAbsoluteX(editingCellCache.cellLayoutInfo.tileInfo.htmlElement);

            ASPxClientUtils.SetAbsoluteX(editingCellCache.element, editingCellCache.tileXOffset + editorX + difference + 1);
        }

        function adjustEditorHeight() {
            var cache = editingCellCache;
            var newLineAdded = cache.cellHeight < cache.textSize.height * cache.normalizedTextLines.length;
            cache.needAdjustHeight = cache.needAdjustHeight && cache.editorWidth <= cache.textSize.width || newLineAdded;

            if(cache.needAdjustHeight)
                adjustEditorHeightCore();
            else
                restoreEditorHeight();
        }

        function adjustEditorHeightCore() {
            if(isBottomReached())
                setEditorFixedHeight();
            else
                setEditorAutoHeight();
        }
        function restoreEditorHeight() {
            if(editingCellCache.textSize.height <= editingCellCache.cellLayoutInfo.rect.height) {
                editingCellCache.element.style.height = editingCellCache.cellHeight + 'px';
                synchronizeChildControls(null, editingCellCache.cellHeight);
            }
        }
        function isBottomReached() {
            var cache = editingCellCache;
            return cache.editorPosition.y + calculateEditorHeight(cache.contentContainer.scrollHeight) + cache.editorBorderWidth >= cache.paneHeight;
        }
        function setEditorFixedHeight() {
            var cache = editingCellCache,
                height = cache.paneHeight - cache.editorPosition.y - cache.editorBorderWidth - 1;
            cache.element.style.height = height + "px";
            synchronizeChildControls(null, height);
        }
        function setEditorAutoHeight() {
            var cache = editingCellCache,
                height;
            var heightAdjustmentElement = (spreadsheetControl.isFormulaBarEditMode()) ? cache.element : cache.contentContainer;
            if(spreadsheetControl.isFormulaBarEditMode())
                cache.element.style.height = 'auto';
            height = calculateEditorHeight(heightAdjustmentElement.scrollHeight);
            cache.element.style.height = height + "px";
            synchronizeChildControls(null, height);
        }

        function calculateEditorHeight(currentHeight) {
            editingCellCache.nextRowIndex = editingCellCache.rowIndex;

            var height = editingCellCache.cellHeight,
                nextCell = getNextVerticalCell();

            while(currentHeight > height && nextCell) {
                height += nextCell.rect.height;
                nextCell = getNextVerticalCell();
            }

            return height;
        }

        function getNextVerticalCell() {
            var colIndex = editingCellCache.cellLayoutInfo.colIndex,
                rowIndex = editingCellCache.nextRowIndex++;

            return getNextCellInfo(colIndex, rowIndex);
        }
        function getNextHorizontalCell() {
            var colIndex = editingCellCache.elementHasRightTextAlign ? editingCellCache.colIndex-- : editingCellCache.colIndex++,
                rowIndex = editingCellCache.cellLayoutInfo.rowIndex;

            if(colIndex < 0)
                colIndex = 0;
            else if(colIndex >= ASPxClientSpreadsheet.Range.MAX_COL_COUNT)
                colIndex = ASPxClientSpreadsheet.Range.MAX_COL_COUNT - 1;

            return getNextCellInfo(colIndex, rowIndex);
        }

        function getNextCellInfo(colIndex, rowIndex) {
            var paneManager = spreadsheetControl.getPaneManager(),
                nextCellLayoutInfo = paneManager.getCellLayoutInfo(colIndex, rowIndex);

            if(!nextCellLayoutInfo)
                return null;
            return getCorrectCellLayoutInfo(nextCellLayoutInfo);
        }
        function getRemainingSpace() {
            var cache = editingCellCache,
                freezePaneBorder = 1,
                space;

            if(cache.elementHasRightTextAlign)
                space = cache.editorX;
            else
                space = cache.paneWidth - cache.editorPosition.x - cache.editorWidth - cache.editorBorderWidth - freezePaneBorder;

            return space;
        }

        function getMaxLineSize(normalizedTextLines, editorStyle) {
            normalizedTextLines[0] += "W";
            var maxSize = ASPx.GetSizeOfText(normalizedTextLines[0] + "0", editorStyle);
            for(var i = 1; i < normalizedTextLines.length; i++) {
                var size = ASPx.GetSizeOfText(normalizedTextLines[i], editorStyle);
                if(maxSize.width < size.width)
                    maxSize = size;
            }

            if(normalizedTextLines.length === 1)
                maxSize.height = fitTextHeightToCell(maxSize.height);

            return maxSize;
        }

        function fitTextHeightToCell(textHeight) {
            var textSizeOverflow = textHeight - editingCellCache.cellHeight,
                fontSizeOverflow = editingCellCache.fontSize - editingCellCache.cellHeight;

            if(textSizeOverflow > 0 && (fontSizeOverflow < editingCellCache.fontSize / 8))
                textHeight = editingCellCache.cellHeight - 1;

            return textHeight;
        }

        function updateIntelliSenseElementsPosition() {
            if(spreadsheetControl.getStateController().getEditMode() !== ASPxClientSpreadsheet.StateController.Modes.FormulaBarEdit)
                spreadsheetControl.updateIntelliSenseElementsPosition();
        }

        function moveViewElementToFormulaBar(element) {
            ensureElementParent(element, true);
            ASPx.SetStyles(element, { width: "", height: "" });
        }
        function moveElementToCell(element, cellLayoutInfo, rect) { // TODO rename moveEditorElementToCell
            ensureElementParent(element, false, cellLayoutInfo.paneType);
            ASPx.SetElementDisplay(element, true);
            var style = ASPx.GetCurrentStyle(element);
            rect.x -= ASPx.PxToInt(style.borderLeftWidth);
            rect.y -= ASPx.PxToInt(style.borderTopWidth);

            ASPxClientSpreadsheet.RenderHelper.PlacementHelper.setElementRectWithElementOffset(element, rect, cellLayoutInfo.tileInfo.htmlElement);
        }

        function ensureElementParent(element, shouldBeInFormulaBar, paneType) {
            if(element.tagName === "IFRAME")
                return;
            var gridTilesContainer = spreadsheetControl.getRenderHelper().getGridTilesContainer(paneType);
            var requiredParentNode = shouldBeInFormulaBar ? spreadsheetControl.getRenderHelper().getFormulaBarTextWrapperElement() : gridTilesContainer;
            if(element.parentNode !== requiredParentNode) {
                ASPxClientSpreadsheet.RenderHelper.PlacementHelper.appendChild(element, requiredParentNode);
            }
        }

        function calculateInplaceEditorSizeParameters(cellLayoutInfo) {
            var paneManager = spreadsheetControl.getPaneManager(),
                rect,
                editingRange = getEditMergedCellsRange(cellLayoutInfo.colIndex, cellLayoutInfo.rowIndex),
                cellModelPosition = paneManager.convertVisiblePositionToModelPosition(editingRange.leftColIndex, editingRange.topRowIndex);

            if(editingRange.singleCell) {
                rect = cellLayoutInfo.rect;
            } else {
                cellLayoutInfo.assignFrom(paneManager.getCellLayoutInfo(editingRange.leftColIndex, editingRange.topRowIndex));
                var farCellLayoutInfo = paneManager.getCellLayoutInfo(editingRange.rightColIndex, editingRange.bottomRowIndex);
                rect = ASPxClientSpreadsheet.CellHelper.getCellRangeRect(cellLayoutInfo, farCellLayoutInfo, cellLayoutInfo.tileInfo);
            }
            var croppedRange = paneManager.isMergerCellContainsInCroppedRange({ colIndex: editingRange.leftColIndex, rowIndex: editingRange.topRowIndex });
            if(croppedRange) {
                editingCellCache.croppedRange = {};
                editingCellCache.croppedRange.visibleModelPosition = { colIndex: cellModelPosition.colIndex, rowIndex: cellModelPosition.rowIndex };
                cellModelPosition = croppedRange.topLeftModelCellPostition;
                editingCellCache.croppedRange.realModelPosition = { colIndex: cellModelPosition.colIndex, rowIndex: cellModelPosition.rowIndex };
            }

            rect = ASPxClientSpreadsheet.RenderHelper.PlacementHelper.correctForClientRect(spreadsheetControl, rect);

            return { inplaceEditorRect: rect, inplaceEitorCellModelPosition: cellModelPosition, inplaceEditorCellLayoutInfo: cellLayoutInfo };
        }

        function ensureFontStyle(fbEditorPlaceHolder) {
            if(ASPx.Browser.IE && !this.fbEditorPlaceHolderFontIsActual) {
                var fbTextBoxStyle = ASPx.GetCurrentStyle(spreadsheetControl.getRenderHelper().getFormulaBarTextBoxElement());
                var fbTextBoxFontStyle = spreadsheetControl.getStyleSetByAttributes(fbTextBoxStyle, getElementAttributesList(true, true));
                ASPx.SetStyles(fbEditorPlaceHolder, fbTextBoxFontStyle);
                this.fbEditorPlaceHolderFontIsActual = true;
            }
        }

        function prepareInplaceFormulaBarElement(element) {
            if(!ASPx.IsExists(element)) return;
            var fbEditorPlaceHolder = spreadsheetControl.getRenderHelper().getFormulaBarEditorPlaceholder();
            ensureFontStyle(fbEditorPlaceHolder);
            var fbEditorPlaceHolderStyle = ASPx.GetCurrentStyle(fbEditorPlaceHolder);
            var elementStyle = spreadsheetControl.getStyleSetByAttributes(fbEditorPlaceHolderStyle, getElementAttributesList());
            ASPx.SetStyles(element, elementStyle);
            if(element.tagName === "TEXTAREA")
                element.style.lineHeight = element.offsetHeight + "px";
        }

        function prepareInplaceCellElement(element, cellModelPosition) {
            var cellElementStyle = spreadsheetControl.getCellElementStyleByModelPosition(cellModelPosition.colIndex, cellModelPosition.rowIndex,
                getElementAttributesList(true)),
                value = spreadsheetControl.getInputController().getEditorText();
            if(value.indexOf('=') === 0)
                cellElementStyle.textAlign = "start";

            ASPx.SetStyles(element, cellElementStyle);
            element.style.lineHeight = "normal";

            editingCellCache.editorBorderWidth = editingCellCache.editorBorderWidth || (ASPx.GetHorizontalBordersWidth(element) / 2);
        }

        function prepareTextVerticalAlign(element, rect) {
            element.style.display = "table-cell";
            element.style.width = rect.width + "px";
            element.style.height = rect.height + "px";

            ASPx.SetStyles(element, {
                "-moz-hyphens": "auto",
                "-webkit-hyphens": "auto",
                "-ms-hyphens": "auto",
                "hyphens": "auto",
                "word-break": "break-word",
                "word-wrap": "break-word",
                "white-space": "pre-wrap"
            });
            if(ASPx.Browser.Firefox || ASPx.Browser.IE || ASPx.Browser.Edge)
                ASPx.SetStyles(element, {
                    "word-break": "break-all"
                });
        }

        function synchronizeChildControls(width, height) {
            if(!spreadsheetControl.isFormulaBarEditMode()) {
                var contentContainer = spreadsheetControl.getInputController().getContentContainer();
                if(width && width >= 0)
                    contentContainer.style.width = width + "px";
                if(height && height >= 0)
                    contentContainer.style.height = height + "px";
            }
        }

        function getIsEditingCellVisible(rect, cellLayoutInfo) {
            var scrollHelper = spreadsheetControl.getPaneManager().getScrollHelper();
            return scrollHelper.getIsEditingCellVisible(rect, cellLayoutInfo);
        }

        function hideSelectionBorder() {
            if(spreadsheetControl.cellSelectionBorderElement)
                ASPx.SetElementDisplay(spreadsheetControl.cellSelectionBorderElement, false);
        }

        this.processDocumentResponse = function() {
            if(multySheetFormulaEditingInProgress()) {
                this.spreadsheetControl.getDynamicSelectionHelper().changeActiveRange();
            }
        };

        this.startFormulaEditing = function() {
            if(!multySheetFormulaEditingInProgress()) {
                formulaMultySheetEditing = true;

                var ownerSheetName = this.spreadsheetControl.getDocumentModel().getActiveSheetName(),
                    ownerSheetId = this.spreadsheetControl.getDocumentModel().getActiveSheetId();

                this.spreadsheetControl.getDynamicSelectionHelper().activateCrossSheetMode(ownerSheetName, ownerSheetId);
            }
        };

        this.onCellEditorChanged = function() {
            if(multySheetFormulaEditingInProgress()) {
                var value = spreadsheetControl.getInputController().getEditorText();
                if(!(value && value[0] === "=")) {
                    var destinationSheetId = this.getOwnerSheetId(),
                        multySheetEditing = multySheetFormulaEditingInProgress();

                    this.deactivateCrossSheetMode();
                    onAfterStopEditing(multySheetEditing, destinationSheetId);
                }
            }
        };

        this.deactivateCrossSheetMode = function() {
            formulaMultySheetEditing = false;
            this.spreadsheetControl.getDynamicSelectionHelper().deactivateCrossSheetMode();
        };
        this.getOwnerSheetId = function() {
            return this.spreadsheetControl.getDynamicSelectionHelper().getOwnerSheetId();
        };

        function multySheetFormulaEditingInProgress() {
            return formulaMultySheetEditing;
        }

        function onAfterStopEditing(multySheetEditing, destinationSheetId) {
            if(multySheetEditing && isSheetChangingRequired(destinationSheetId)) {
                window.setTimeout(function() { spreadsheetControl.changeSheetIndex(destinationSheetId); }, 10);
            }
        }
        function isSheetChangingRequired(destinationSheetId) {
            return destinationSheetId && destinationSheetId >= 0 && spreadsheetControl.getDocumentModel().getActiveSheetId() !== destinationSheetId;
        }
    };
})();
(function() {
    
// TODO think about merge with ASPxHtmlEditorKeyboardManager
var SpreadsheetKeyboardManager = ASPx.CreateClass(null, {
    constructor: function() {
        this.shortcutCommands = [];
    },
    InitializeShortcuts: function(standardSCs, customSCs) {
        for(var i = 0; i < standardSCs.length; i++)
            this.AddShortcut(standardSCs[i][1], standardSCs[i][0]);
        if(customSCs) {
            for(var key in customSCs) {
                if(customSCs.hasOwnProperty(key) && key != 0)
                    this.AddShortcut(key, customSCs[key]);
            }
        }
    },
    AddShortcut: function(shortcutCode, commandID) {
        this.shortcutCommands[shortcutCode] = commandID;
    },
    GetShortcutCommand: function(evt) {
        //only for mac and safari
        var ctrlKeyPressed = ASPx.Browser.MacOSPlatform ? evt.metaKey : evt.ctrlKey;
        var shortcutCode = ASPx.GetShortcutCode(evt.keyCode, ctrlKeyPressed, evt.shiftKey, evt.altKey);
        return this.shortcutCommands[shortcutCode];
    },
    EventKeyCodeChangesTheInput: function(evt) {
        if(ASPx.IsPasteShortcut(evt))
            return true;
        else if(evt.ctrlKey && !evt.altKey)
            return false;

        var keyCode = ASPx.Evt.GetKeyCode(evt);
        var isSystemKey = ASPx.Key.Windows <= keyCode && keyCode <= ASPx.Key.ContextMenu;
        var isFKey = ASPx.Key.F1 <= keyCode && keyCode <= 127; // 127 - F16 for MAC
        return ASPx.Key.Delete <= keyCode && !isSystemKey && !isFKey || keyCode == ASPx.Key.Backspace || keyCode == ASPx.Key.Space;
    },
    IsCursorMovingKey: function(keyCode) {
        return keyCode >= ASPx.Key.PageUp && keyCode <= ASPx.Key.Down;
    },
    onKeyDown: function(spreadsheet, evt, editMode) {
        var inputController = spreadsheet.getInputController();
        var command = this.GetShortcutCommand(evt);
        if(command) {
            if(!inputController.isEditingInProgress() && !(ASPx.Browser.MacOSPlatform && ASPx.Browser.WebKitFamily))
                inputController.setEditableDocumentContent("");
            return command(spreadsheet, evt, editMode);
        } else if(editMode == ASPxClientSpreadsheet.StateController.Modes.Ready) {
            if(ASPx.Browser.MacOSPlatform && ASPx.Browser.WebKitFamily && evt.metaKey)
                spreadsheet.getInputController().prepareIframeForClientSideCopy();
            var selection = spreadsheet.getStateController().getSelection();
            if(selection.activeCellExists()) {
                if(this.EventKeyCodeChangesTheInput(evt))
                    spreadsheet.getStateController().setEditMode(ASPxClientSpreadsheet.StateController.Modes.Enter);
            }
        }
    },
});
SpreadsheetKeyboardManager.selection_move_core = function(spreadsheet, method, evt) {
    spreadsheet.changeSelectionAccordingToKeyboardAction(method);
    return ASPx.Evt.PreventEvent(evt);
};

SpreadsheetKeyboardManager.wrapServerCommand = function(command) {
    return function(spreadsheet, evt, editMode) {
        command(spreadsheet);
        return ASPx.Evt.PreventEvent(evt);
    };
};

SpreadsheetKeyboardManager.ExecuteCommandWithPreventEvent = function(spreadsheet, evt, serverCommandName) {
    var serverCommandId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName(serverCommandName).id;
    spreadsheet.onShortCutCommand(serverCommandId);
    return ASPx.Evt.PreventEvent(evt);
};

SpreadsheetKeyboardManager.CommandsOnServer = {
    FormatFontBold: function(spreadsheet, evt, editMode) {
        ASPxClientSpreadsheet.ServerCommands.FormatFontBold(spreadsheet);
        return ASPx.Evt.PreventEvent(evt);
    },
    FormatFontItalic: function(spreadsheet, evt, editMode) {
        ASPxClientSpreadsheet.ServerCommands.FormatFontItalic(spreadsheet);
        return ASPx.Evt.PreventEvent(evt);
    },
    FormatFontUnderline: function(spreadsheet, evt, editMode) {
        ASPxClientSpreadsheet.ServerCommands.FormatFontUnderline(spreadsheet);
        return ASPx.Evt.PreventEvent(evt);
    },

    InsertSheet: function(spreadsheet, evt, editMode) {
        ASPxClientSpreadsheet.ServerCommands.InsertSheet(spreadsheet);
        return ASPx.Evt.PreventEvent(evt);
    },

    EditingFillDown: function(spreadsheet, evt, editMode) {
        ASPxClientSpreadsheet.ServerCommands.EditingFillDown(spreadsheet);
        return ASPx.Evt.PreventEvent(evt);
    },

    EditingFillRight: function(spreadsheet, evt, editMode) {
        ASPxClientSpreadsheet.ServerCommands.EditingFillRight(spreadsheet);
        return ASPx.Evt.PreventEvent(evt);
    }
};

SpreadsheetKeyboardManager.CommandsOnClient = {
    DOWN_COMMAND: function(spreadsheet, evt, editMode) {
        if(!ASPxClientSpreadsheet.StateController.IsEditingMode(editMode) && !spreadsheet.isFunctionsListBoxDisplayed())
            return SpreadsheetKeyboardManager.selection_move_core(spreadsheet, "moveDown", evt);
    },
    UP_COMMAND: function(spreadsheet, evt, editMode) {
        if(!ASPxClientSpreadsheet.StateController.IsEditingMode(editMode) && !spreadsheet.isFunctionsListBoxDisplayed())
            return SpreadsheetKeyboardManager.selection_move_core(spreadsheet, "moveUp", evt);
    },
    RIGHT_COMMAND: function(spreadsheet, evt, editMode) {
        if(!ASPxClientSpreadsheet.StateController.IsEditingMode(editMode))
            return SpreadsheetKeyboardManager.selection_move_core(spreadsheet, "moveRight", evt);
    },
    LEFT_COMMAND: function(spreadsheet, evt, editMode) {
        if(!ASPxClientSpreadsheet.StateController.IsEditingMode(editMode))
            return SpreadsheetKeyboardManager.selection_move_core(spreadsheet, "moveLeft", evt);
    },
    ENTER_COMMAND: function(spreadsheet, evt, editMode) {
        SpreadsheetKeyboardManager.selection_move_core(spreadsheet, "moveActiveCellDown", evt);
        return ASPx.Evt.PreventEvent(evt);
    },
    SHIFT_ENTER_COMMAND: function(spreadsheet, evt, editMode) {
        var retValue = SpreadsheetKeyboardManager.selection_move_core(spreadsheet, "moveActiveCellUp", evt);
        return retValue;
    },
    ALT_ENTER_COMMAND: function(spreadsheet, evt, editMode) {
        if(ASPxClientSpreadsheet.StateController.IsEditingMode(editMode) || editMode === ASPxClientSpreadsheet.StateController.Modes.Enter) {
            spreadsheet.getInputController().onAltEnterEvent();
            return ASPx.Evt.PreventEventAndBubble(evt);
        }
    },

    TAB_COMMAND: function(spreadsheet, evt, editMode) {
		//TODO to think: var navigationAllowed = !spreadsheet.isFunctionsListBoxDisplayed();
        if(spreadsheet.isFunctionsListBoxDisplayed())
            return ASPx.Evt.PreventEvent(evt);

        var retValue = SpreadsheetKeyboardManager.selection_move_core(spreadsheet, "moveActiveCellRight", evt);
        return retValue;
    },
    SHIFT_TAB_COMMAND: function(spreadsheet, evt, editMode) {
        var retValue = SpreadsheetKeyboardManager.selection_move_core(spreadsheet, "moveActiveCellLeft", evt);
        return retValue;
    },

    SHIFT_LEFT_COMMAND: function(spreadsheet, evt, editMode) {
        if(ASPxClientSpreadsheet.StateController.IsEditingMode(editMode)) return;

        var retValue = SpreadsheetKeyboardManager.selection_move_core(spreadsheet, "expandLeft", evt);
        return retValue;
    },
    SHIFT_RIGHT_COMMAND: function(spreadsheet, evt, editMode) {
        if(ASPxClientSpreadsheet.StateController.IsEditingMode(editMode)) return;

        var retValue = SpreadsheetKeyboardManager.selection_move_core(spreadsheet, "expandRight", evt);
        return retValue;
    },
    SHIFT_UP_COMMAND: function(spreadsheet, evt, editMode) {
        if(ASPxClientSpreadsheet.StateController.IsEditingMode(editMode)) return;

        var retValue = SpreadsheetKeyboardManager.selection_move_core(spreadsheet, "expandUp", evt);
        return retValue;
    },
    SHIFT_DOWN_COMMAND: function(spreadsheet, evt, editMode) {
        if(ASPxClientSpreadsheet.StateController.IsEditingMode(editMode)) return;

        var retValue = SpreadsheetKeyboardManager.selection_move_core(spreadsheet, "expandDown", evt);
        return retValue;
    },

    // TODO make it a real edit mode toggle
    F2_COMMAND: function(spreadsheet, evt, editMode) {
        if(!ASPxClientSpreadsheet.StateController.IsEditingMode(editMode) && spreadsheet.CanEditDocument())
            spreadsheet.getStateController().setEditMode(ASPxClientSpreadsheet.StateController.Modes.Edit);
    },
    ESCAPE_COMMAND: function(spreadsheet, evt, editMode) {
        spreadsheet.getStateController().onEscape();
    },
    SELECT_ALL_COMMAND: function(spreadsheet, evt, editMode) {
        if(editMode === ASPxClientSpreadsheet.StateController.Modes.Ready) {
            spreadsheet.getStateController().selectAll();
            return ASPx.Evt.PreventEvent(evt);
        }
        return;
    },
    DELETE_COMMAND: function(spreadsheet, evt, editMode) {
        if((editMode != ASPxClientSpreadsheet.StateController.Modes.Ready) || !spreadsheet.CanEditDocument()) return;

        var selection = spreadsheet.getStateController().getSelection(),
            inputController = spreadsheet.getInputController();

        inputController.moveInplaceEditorToActiveCell();

        if(selection.isDrawingBoxSelection()) {
            ASPxClientSpreadsheet.ServerCommands.FormatClearAll(spreadsheet);
            spreadsheet.getPaneManager().hideModelBoxSelection();
        } else {
            spreadsheet.onUICommand(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatClearContents").id);
        }

        inputController.releaseInplaceEditor();
    },
    CTRL_C_COMMAND: function(spreadsheet, evt, editMode) {
        if(editMode == ASPxClientSpreadsheet.StateController.Modes.Ready)
            spreadsheet.getInputController().onCopyEventProcessing(1);
    },
    CTRL_V_COMMAND: function(spreadsheet, evt, editMode) {
        if((editMode == ASPxClientSpreadsheet.StateController.Modes.Ready) && spreadsheet.CanEditDocument()) {
            var inputController = spreadsheet.getInputController();
            if(inputController) {
                spreadsheet.ShowLoadingPanel();
                inputController.moveInplaceEditorToActiveCell();
                inputController.setEditableDocumentContent("");
                setTimeout(function() {
                    inputController.onPasteEventProcessing();
                    inputController.releaseInplaceEditor();
                }, ASPx.Browser.MacOSPlatform && ASPx.Browser.WebKitFamily ? inputController.getWebkitMacTimeout() : 0);
            }
        }        
    },
    CTRL_X_COMMAND: function(spreadsheet, evt, editMode) {
        if((editMode == ASPxClientSpreadsheet.StateController.Modes.Ready) && spreadsheet.CanEditDocument())
            spreadsheet.getInputController().onCopyEventProcessing(0);
    },
    FILE_UNDO: function(spreadsheet, evt, editMode) {
        if(spreadsheet.getRibbonManager().canUndo()
            && !ASPxClientSpreadsheet.StateController.IsEditingMode(editMode)
            && editMode !== ASPxClientSpreadsheet.StateController.Modes.Enter)
            ASPxClientSpreadsheet.ServerCommands.FileUndo(spreadsheet);
    },
    FILE_REDO: function(spreadsheet, evt, editMode) {
        if(spreadsheet.getRibbonManager().canRedo())
            ASPxClientSpreadsheet.ServerCommands.FileRedo(spreadsheet);
    },
    FORMAT_CELLS: function(spreadsheet, evt) {
        return SpreadsheetKeyboardManager.ExecuteCommandWithPreventEvent(spreadsheet, evt, "FormatCells");
    },
    FORMAT_FONT_BOLD: function(spreadsheet, evt) {
        return SpreadsheetKeyboardManager.ExecuteCommandWithPreventEvent(spreadsheet, evt, "FormatFontBold");
    },
    FORMAT_FONT_ITALIC: function(spreadsheet, evt) {
        return SpreadsheetKeyboardManager.ExecuteCommandWithPreventEvent(spreadsheet, evt, "FormatFontItalic");
    },
    FORMAT_FONT_UNDERLINE: function(spreadsheet, evt) {
        return SpreadsheetKeyboardManager.ExecuteCommandWithPreventEvent(spreadsheet, evt, "FormatFontUnderline");
    },
    FORMAT_FONT_STRIKEOUT: function(spreadsheet, evt) {
        return SpreadsheetKeyboardManager.ExecuteCommandWithPreventEvent(spreadsheet, evt, "FormatFontStrikeout");
    },

    // NON Spreadsheet's specific shortcuts
    CTRL_F_COMMAND: function(spreadsheet, evt) {
        return SpreadsheetKeyboardManager.ExecuteCommandWithPreventEvent(spreadsheet, evt, "FindAll");
    },
    F11_COMMAND: function(spreadsheet, evt) {
        return SpreadsheetKeyboardManager.ExecuteCommandWithPreventEvent(spreadsheet, evt, "FullScreen");
    },
    SHOW_RIBBON_KEY_TIPS_COMMAND: function(spreadsheet, evt) {
        spreadsheet.getRibbonManager().showKeyTips();
        return ASPx.Evt.PreventEvent(evt);
    },
    CONTEXTMENU_COMMAND: function(spreadsheet, evt, editMode) {
        if(editMode !== ASPxClientSpreadsheet.StateController.Modes.Ready)
            return;

        spreadsheet.onGridContextMenu(evt, true);

        return ASPx.Evt.PreventEvent(evt);
    },
    BACKSPACE_COMMAND: function(spreadsheet, evt, editMode) {
        if(editMode == ASPxClientSpreadsheet.StateController.Modes.Ready && spreadsheet.CanEditDocument())
            spreadsheet.getStateController().setEditMode(ASPxClientSpreadsheet.StateController.Modes.Enter);
    },
    FILE_OPEN: function(spreadsheet, evt, editMode) {
        return SpreadsheetKeyboardManager.ExecuteCommandWithPreventEvent(spreadsheet, evt, "FileOpen");
    }//,
};

SpreadsheetKeyboardManager.Shortcuts = [
    [SpreadsheetKeyboardManager.CommandsOnClient.DOWN_COMMAND, ASPx.KeyCode.Down],
    [SpreadsheetKeyboardManager.CommandsOnClient.UP_COMMAND, ASPx.KeyCode.Up],
    [SpreadsheetKeyboardManager.CommandsOnClient.RIGHT_COMMAND, ASPx.KeyCode.Right],
    [SpreadsheetKeyboardManager.CommandsOnClient.LEFT_COMMAND, ASPx.KeyCode.Left],

    [SpreadsheetKeyboardManager.CommandsOnClient.ENTER_COMMAND, ASPx.KeyCode.Enter],
    [SpreadsheetKeyboardManager.CommandsOnClient.SHIFT_ENTER_COMMAND, ASPx.ModifierKey.Shift | ASPx.KeyCode.Enter],
    [SpreadsheetKeyboardManager.CommandsOnClient.ALT_ENTER_COMMAND, ASPx.ModifierKey.Alt | ASPx.KeyCode.Enter],

    [SpreadsheetKeyboardManager.CommandsOnClient.TAB_COMMAND, ASPx.KeyCode.Tab],
    [SpreadsheetKeyboardManager.CommandsOnClient.SHIFT_TAB_COMMAND, ASPx.ModifierKey.Shift | ASPx.KeyCode.Tab],

    [SpreadsheetKeyboardManager.CommandsOnClient.SHIFT_LEFT_COMMAND, ASPx.ModifierKey.Shift | ASPx.KeyCode.Left],
    [SpreadsheetKeyboardManager.CommandsOnClient.SHIFT_RIGHT_COMMAND, ASPx.ModifierKey.Shift | ASPx.KeyCode.Right],
    [SpreadsheetKeyboardManager.CommandsOnClient.SHIFT_UP_COMMAND, ASPx.ModifierKey.Shift | ASPx.KeyCode.Up],
    [SpreadsheetKeyboardManager.CommandsOnClient.SHIFT_DOWN_COMMAND, ASPx.ModifierKey.Shift | ASPx.KeyCode.Down],

    [SpreadsheetKeyboardManager.CommandsOnClient.F2_COMMAND, ASPx.KeyCode.F2],
    [SpreadsheetKeyboardManager.CommandsOnClient.ESCAPE_COMMAND, ASPx.KeyCode.Esc],
    [SpreadsheetKeyboardManager.CommandsOnClient.BACKSPACE_COMMAND, ASPx.KeyCode.Backspace],

    [SpreadsheetKeyboardManager.CommandsOnClient.SELECT_ALL_COMMAND, ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_a],
    // TODO Keys.Space, Keys.Control | Keys.Shift, SpreadsheetCommandId.SelectAll

    // TODO Keys.PageDown, Keys.None, SpreadsheetCommandId.SelectionMovePageDown
    // TODO Keys.PageUp, Keys.None, SpreadsheetCommandId.SelectionMovePageUp
    // TODO Keys.PageDown, Keys.Shift, SpreadsheetCommandId.SelectionExpandPageDown
    // TODO Keys.PageUp, Keys.Shift, SpreadsheetCommandId.SelectionExpandPageUp

    [SpreadsheetKeyboardManager.CommandsOnClient.FILE_UNDO, ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_z],
    [SpreadsheetKeyboardManager.CommandsOnClient.FILE_UNDO, ASPx.ModifierKey.Alt | ASPx.KeyCode.Backspace],
    [SpreadsheetKeyboardManager.CommandsOnClient.FILE_REDO, ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_y],
    [SpreadsheetKeyboardManager.CommandsOnClient.FILE_REDO, ASPx.ModifierKey.Alt | ASPx.ModifierKey.Shift | ASPx.KeyCode.Backspace],

    [SpreadsheetKeyboardManager.CommandsOnClient.SHOW_RIBBON_KEY_TIPS_COMMAND, ASPx.KeyCode.F10],
    [SpreadsheetKeyboardManager.CommandsOnClient.SHOW_RIBBON_KEY_TIPS_COMMAND, ASPx.ModifierKey.Alt | ASPx.KeyCode.Windows],
    [SpreadsheetKeyboardManager.CommandsOnClient.CONTEXTMENU_COMMAND, ASPx.KeyCode.ContextMenu],

    [SpreadsheetKeyboardManager.CommandsOnClient.FORMAT_CELLS, ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_1],
    [SpreadsheetKeyboardManager.wrapServerCommand(ASPxClientSpreadsheet.ServerCommands.FormatFontBold), ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_b],
    [SpreadsheetKeyboardManager.CommandsOnClient.FORMAT_FONT_BOLD, ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_2],
    [SpreadsheetKeyboardManager.wrapServerCommand(ASPxClientSpreadsheet.ServerCommands.FormatFontItalic), ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_i],
    [SpreadsheetKeyboardManager.CommandsOnClient.FORMAT_FONT_ITALIC, ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_3],
    [SpreadsheetKeyboardManager.wrapServerCommand(ASPxClientSpreadsheet.ServerCommands.FormatFontUnderline), ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_u],
    [SpreadsheetKeyboardManager.CommandsOnClient.FORMAT_FONT_UNDERLINE, ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_4],
    [SpreadsheetKeyboardManager.CommandsOnClient.FORMAT_FONT_STRIKEOUT, ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_5],

    [ASPxClientSpreadsheet.ServerCommands.HideRows, ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_9],
    [ASPxClientSpreadsheet.ServerCommands.HideColumns, ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_0],
    [ASPxClientSpreadsheet.ServerCommands.UnhideRows, ASPx.ModifierKey.Ctrl | ASPx.ModifierKey.Shift | ASPx.KeyCode.Key_9],
    [ASPxClientSpreadsheet.ServerCommands.UnhideColumns, ASPx.ModifierKey.Ctrl | ASPx.ModifierKey.Shift | ASPx.KeyCode.Key_0],

    [ASPxClientSpreadsheet.ServerCommands.FormatNumberPredefined4, ASPx.ModifierKey.Ctrl | ASPx.ModifierKey.Shift | ASPx.KeyCode.Key_1],
    [ASPxClientSpreadsheet.ServerCommands.FormatNumberPredefined18, ASPx.ModifierKey.Ctrl | ASPx.ModifierKey.Shift | ASPx.KeyCode.Key_2],
    [ASPxClientSpreadsheet.ServerCommands.FormatNumberPredefined15, ASPx.ModifierKey.Ctrl | ASPx.ModifierKey.Shift | ASPx.KeyCode.Key_3],
    [ASPxClientSpreadsheet.ServerCommands.FormatNumberPredefined8, ASPx.ModifierKey.Ctrl | ASPx.ModifierKey.Shift | ASPx.KeyCode.Key_4],
    [ASPxClientSpreadsheet.ServerCommands.FormatNumberPercent, ASPx.ModifierKey.Ctrl | ASPx.ModifierKey.Shift | ASPx.KeyCode.Key_5],
    [ASPxClientSpreadsheet.ServerCommands.FormatNumberScientific, ASPx.ModifierKey.Ctrl | ASPx.ModifierKey.Shift | ASPx.KeyCode.Key_6],
    [ASPxClientSpreadsheet.ServerCommands.FormatOutsideBorders, ASPx.ModifierKey.Ctrl | ASPx.ModifierKey.Shift | ASPx.KeyCode.Key_7],

    [SpreadsheetKeyboardManager.CommandsOnClient.DELETE_COMMAND, ASPx.KeyCode.Delete],

    [SpreadsheetKeyboardManager.wrapServerCommand(ASPxClientSpreadsheet.ServerCommands.InsertSheet), ASPx.ModifierKey.Shift | ASPx.KeyCode.F11],
    [SpreadsheetKeyboardManager.wrapServerCommand(ASPxClientSpreadsheet.ServerCommands.EditingFillDown), ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_d],
    [SpreadsheetKeyboardManager.wrapServerCommand(ASPxClientSpreadsheet.ServerCommands.EditingFillRight), ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_r],
    [SpreadsheetKeyboardManager.wrapServerCommand(ASPxClientSpreadsheet.ServerCommands.FileSave), ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_s],
    [SpreadsheetKeyboardManager.CommandsOnClient.FILE_OPEN, ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_o],
    [SpreadsheetKeyboardManager.wrapServerCommand(ASPxClientSpreadsheet.ServerCommands.FileNew), ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_n],
    [SpreadsheetKeyboardManager.wrapServerCommand(ASPxClientSpreadsheet.ServerCommands.Print), ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_p],

    [SpreadsheetKeyboardManager.wrapServerCommand(ASPxClientSpreadsheet.ServerCommands.FunctionsInsertSum), ASPx.ModifierKey.Alt | ASPx.KeyCode.Equals],

    // TODO IN SECOND VERSION Keys.Left, Keys.Control, SpreadsheetCommandId.SelectionMoveLeftToDataEdge
    // TODO IN SECOND VERSION Keys.Right, Keys.Control, SpreadsheetCommandId.SelectionMoveRightToDataEdge
    // TODO IN SECOND VERSION Keys.Up, Keys.Control, SpreadsheetCommandId.SelectionMoveUpToDataEdge
    // TODO IN SECOND VERSION Keys.Down, Keys.Control, SpreadsheetCommandId.SelectionMoveDownToDataEdge
    // TODO IN SECOND VERSION Keys.Home, Keys.None, SpreadsheetCommandId.SelectionMoveToLeftColumn
    // TODO IN SECOND VERSION Keys.Home, Keys.Control, SpreadsheetCommandId.SelectionMoveToTopLeftCell
    // TODO IN SECOND VERSION Keys.End, Keys.Control, SpreadsheetCommandId.SelectionMoveToLastUsedCell
    // TODO IN SECOND VERSION Keys.Tab, Keys.None, SpreadsheetCommandId.SelectionMoveActiveCellRight
    // TODO IN SECOND VERSION Keys.Tab, Keys.Shift, SpreadsheetCommandId.SelectionMoveActiveCellLeft
    // TODO IN SECOND VERSION Keys.OemPeriod, Keys.Control, SpreadsheetCommandId.SelectionMoveActiveCellToNextCorner
    // TODO IN SECOND VERSION Keys.Left, Keys.Control | Keys.Alt, SpreadsheetCommandId.SelectionPreviousRange
    // TODO IN SECOND VERSION Keys.Right, Keys.Control | Keys.Alt, SpreadsheetCommandId.SelectionNextRange
    // TODO IN SECOND VERSION Keys.Back, Keys.Shift, SpreadsheetCommandId.SelectActiveCell
    // TODO IN SECOND VERSION Keys.Space, Keys.Control, SpreadsheetCommandId.SelectActiveColumn
    // TODO IN SECOND VERSION Keys.Space, Keys.Shift, SpreadsheetCommandId.SelectActiveRow
    // TODO IN SECOND VERSION Keys.Left, Keys.Control | Keys.Shift, SpreadsheetCommandId.SelectionExpandLeftToDataEdge
    // TODO IN SECOND VERSION Keys.Right, Keys.Control | Keys.Shift, SpreadsheetCommandId.SelectionExpandRightToDataEdge
    // TODO IN SECOND VERSION Keys.Up, Keys.Control | Keys.Shift, SpreadsheetCommandId.SelectionExpandUpToDataEdge
    // TODO IN SECOND VERSION Keys.Down, Keys.Control | Keys.Shift, SpreadsheetCommandId.SelectionExpandDownToDataEdge
    // TODO IN SECOND VERSION Keys.Home, Keys.Shift, SpreadsheetCommandId.SelectionExpandToLeftColumn
    // TODO IN SECOND VERSION Keys.Home, Keys.Control | Keys.Shift, SpreadsheetCommandId.SelectionExpandToTopLeftCell
    // TODO IN SECOND VERSION Keys.End, Keys.Control | Keys.Shift, SpreadsheetCommandId.SelectionExpandToLastUsedCell

    [SpreadsheetKeyboardManager.CommandsOnClient.CTRL_C_COMMAND, ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_c],
    [SpreadsheetKeyboardManager.CommandsOnClient.CTRL_C_COMMAND, ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Insert],
    [SpreadsheetKeyboardManager.CommandsOnClient.CTRL_V_COMMAND, ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_v],
    [SpreadsheetKeyboardManager.CommandsOnClient.CTRL_V_COMMAND, ASPx.ModifierKey.Shift | ASPx.KeyCode.Insert],
    [SpreadsheetKeyboardManager.CommandsOnClient.CTRL_X_COMMAND, ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_x],
    [SpreadsheetKeyboardManager.CommandsOnClient.CTRL_X_COMMAND, ASPx.ModifierKey.Shift | ASPx.KeyCode.Delete],
    // TODO Keys.V, Keys.Control | Keys.Alt, SpreadsheetCommandId.ShowPasteSpecialForm

    // Keys.Escape, Keys.None, SpreadsheetCommandId.ClearCopiedRange

    // TODO Keys.Control, Keys.K, SpreadsheetCommandId.InsertHyperlinkContextMenuItem
    // TODO Keys.Control, Keys.Shift | Keys.U, SpreadsheetCommandId.CollapseOrExpandFormulaBar
    // TODO Keys.PageDown, Keys.Control, SpreadsheetCommandId.MoveToNextSheet 
    // TODO Keys.PageUp, Keys.Control, SpreadsheetCommandId.MoveToPreviousSheet
    // TODO Keys.Control, Keys.Shift | Keys.Enter, SpreadsheetCommandId.InsertArrayFormula
    // TODO Keys.Oemtilde, Keys.Control, SpreadsheetCommandId.ViewShowFormulas
    // TODO Keys.Delete, Keys.None, SpreadsheetCommandId.FormatClearAll
    // TODO Keys.Back, Keys.None, SpreadsheetCommandId.FormatClearAll

    // TODO IN SECOND VERSION Keys.Left, Keys.Alt, SpreadsheetCommandId.ShapeRotateLeft
    // TODO IN SECOND VERSION Keys.Left, Keys.Alt | Keys.Control, SpreadsheetCommandId.ShapeRotateLeftByDegree
    // TODO IN SECOND VERSION Keys.Right, Keys.Alt, SpreadsheetCommandId.ShapeRotateRight
    // TODO IN SECOND VERSION Keys.Right, Keys.Alt | Keys.Control, SpreadsheetCommandId.ShapeRotateRightByDegree
    // TODO IN SECOND VERSION Keys.Right, Keys.Shift, SpreadsheetCommandId.ShapeEnlargeWidth
    // TODO IN SECOND VERSION Keys.Up, Keys.Shift, SpreadsheetCommandId.ShapeEnlargeHeight
    // TODO IN SECOND VERSION Keys.Right, Keys.Shift | Keys.Control, SpreadsheetCommandId.ShapeBitEnlargeWidth
    // TODO IN SECOND VERSION Keys.Up, Keys.Shift | Keys.Control, SpreadsheetCommandId.ShapeBitEnlargeHeight
    // TODO IN SECOND VERSION Keys.Left, Keys.Shift, SpreadsheetCommandId.ShapeReduceWidth
    // TODO IN SECOND VERSION Keys.Down, Keys.Shift, SpreadsheetCommandId.ShapeReduceHeight
    // TODO IN SECOND VERSION Keys.Left, Keys.Shift | Keys.Control, SpreadsheetCommandId.ShapeBitReduceWidth
    // TODO IN SECOND VERSION Keys.Down, Keys.Shift | Keys.Control, SpreadsheetCommandId.ShapeBitReduceHeight
    // TODO IN SECOND VERSION Keys.A, Keys.Control, SpreadsheetCommandId.ShapeSelectAll
    // TODO IN SECOND VERSION Keys.Tab, Keys.None, SpreadsheetCommandId.ShapeSelectNext
    // TODO IN SECOND VERSION Keys.Tab, Keys.Shift, SpreadsheetCommandId.ShapeSelectPrevious

    // TODO Keys.Enter, Keys.Control | Keys.Shift, SpreadsheetCommandId.InplaceEndEditEnterArrayFormula
    // TODO Keys.Escape, Keys.None, SpreadsheetCommandId.InplaceCancelEdit
    // TODO Keys.Enter, Keys.Control, SpreadsheetCommandId.InplaceEndEditEnterToMultipleCells

    // NON Spreadsheet's specific shortcuts
    [SpreadsheetKeyboardManager.CommandsOnClient.CTRL_F_COMMAND, ASPx.ModifierKey.Ctrl | ASPx.KeyCode.Key_f],
    [SpreadsheetKeyboardManager.CommandsOnClient.F11_COMMAND, ASPx.KeyCode.F11]//,
];

ASPx.SpreadsheetKeyboardManager = SpreadsheetKeyboardManager;
})();
(function() {
    ASPxClientSpreadsheet.InputController = ASPx.CreateClass(null, {
        constructor: function(spreadsheetControl, targetInput) {
            this.spreadsheetControl = spreadsheetControl;
            this.targetInput = targetInput;
            this.attachTargetInputEvents();
            this.initialize();
            this.pastedHTML = "";
            this.currentColIndex = -1;
            this.currentRowIndex = -1;
            this.mode = ASPxClientSpreadsheet.InputController.Modes.Listening;
            this.readyToEditOnMS = false;
            this.webkitOnMacTimeout = 10;
        },
        initialize: function() {
            var frameHtml = "<!DOCTYPE html>";
            frameHtml += "<html>";
            frameHtml += "<head>";
            frameHtml += "</head>";
            frameHtml += "<body style=\"" + this.getDefaultStyle() + "\" spellcheck='false'>";
            frameHtml += "</body>";
            frameHtml += "</html>";
            var editableDocument = this.getEditableDocument();
            editableDocument.designMode = "on";
            editableDocument.open();
            editableDocument.write(frameHtml);
            editableDocument.close();
            this.firstInitialization = true;
            this.initEvents();
        },
        attachTargetInputEvents: function() {
            ASPx.Evt.AttachEventToElement(this.targetInput, "load", function() {
                this.reinitializeIfNeeded();
            }.aspxBind(this));
        },
        reinitializeIfNeeded: function() {
            if(this.getIFrameDesignMode() !== "on") {
                this.initialize();
                this.adjustSpreadsheetControl();
            }
        },
        getIFrameDesignMode: function() {
            var designMode = this.getEditableDocument().designMode;
            if(designMode)
                return designMode.toLowerCase();
            else
                return "";
        },
        adjustSpreadsheetControl: function() {
            var scrollHelper = this.spreadsheetControl.getPaneManager().getScrollHelper();
            scrollHelper.needToRestoreScrollPositionOnAdjust = true;
            this.spreadsheetControl.AdjustControlCore();
            scrollHelper.needToRestoreScrollPositionOnAdjust = false;
        },
        getWebkitMacTimeout: function() {
            return this.webkitOnMacTimeout;
        },
        getDefaultStyle: function() {
            return "padding: 0 2px !important; margin: 0; overflow: hidden; word-wrap: break-word; -ms-user-select: element; -webkit-text-size-adjust: none";
        },
        initEvents: function() {
            ASPx.Evt.AttachEventToElement(this.getEditableDocument(), "keydown", function(evt) {
                this.valueShouldBeSynchronizedOnInputEvent = false;
                this.spreadsheetControl.onKeyDown(evt, this.spreadsheetControl.getStateController().getEditMode());
                if(ASPx.Browser.IE || ASPx.Browser.Edge) {
                    var selection = this.getSelection();
                    var complexCharacter = !evt.shiftKey && evt.keyCode != ASPx.Key.Shift && (ASPx.Browser.IE || ASPx.Browser.Edge)
                        && !!selection.focusOffset && Math.abs(selection.anchorOffset - selection.focusOffset) === 1;
                    var keyboardManager = this.spreadsheetControl.getKeyboardManager();
                    if(!complexCharacter && this.eventClearsEditor(ASPx.Evt.GetKeyCode(evt)) && keyboardManager.EventKeyCodeChangesTheInput(evt))
                        this.setEditorContent("");
                }
            }.aspxBind(this));

            ASPx.Evt.AttachEventToElement(this.getEditableDocument(), "cut", function(evt) {
                if(ASPx.Browser.IE && this.isEditingInProgress() && this.eventClearsEditor(ASPx.Evt.GetKeyCode(evt))) {
                    window.clipboardData.setData('Text', this.getEditableDocumentContent());
                    this.setEditorContent("");
                    evt.preventDefault();
                }
                else
                    this.processContentChangeByContextMenu();
            }.aspxBind(this));

            ASPx.Evt.AttachEventToElement(this.getEditableDocument(), "focus", function() {
                this.selectEditableDocumentContent();
            }.aspxBind(this));

            ASPx.Evt.AttachEventToElement(this.getEditableDocument(), "paste", function(evt) {
                if(this.isEditingInProgress()) {
                    evt.preventDefault();
                    this.pasteClipboardDataAsPlainText(evt);
                    return;
                }
                var e = evt;
                if(e && e.clipboardData && e.clipboardData.items) {
                    this.savePastedHtml(e.clipboardData.getData('text/html'));
                    var items = e.clipboardData.items;

                    if(!ASPx.OfficeBuffer.isBufferContainText(items)) {
                        var blob = ASPx.OfficeBuffer.getBufferImage(items);
                        if(blob) {
                            ASPx.Evt.PreventEvent(evt);
                            var reader = new FileReader(),
                                image = this.getEditableDocument().createElement("IMG"),
                                spreadsheet = this.spreadsheetControl;

                            image.alt = "pastedByCallback";
                            reader.onload = function(ev) {
                                image.src = ev.target.result;
                                spreadsheet.sendInternalServiceCallback(ASPxClientSpreadsheet.CallbackPrefixes.SaveImageCallbackPrefix, ev.target.result);
                            };
                            reader.readAsDataURL(blob);
                            this.getContentContainer().appendChild(image);
                        }
                    }
                } else {
                    this.savePastedHtml("");
                }
            }.aspxBind(this));

            ASPx.Evt.AttachEventToElement(this.getEditableDocument(), "click", function() {
                if(this.isEditingInProgress()) {
                    var editingHelper = this.spreadsheetControl.getEditingHelper();
                    editingHelper.scrollCellTextViewElementToEditingRow();
                    this.spreadsheetControl.getStateController().onCellEditorChanged();
                }
            }.aspxBind(this));

            ASPx.Evt.AttachEventToElement(this.getEditableDocument(), "keyup", function(evt) {
                if(this.isEditingInProgress()) {
                    var selection = this.getSelection();
                    var needToClearSelectionForComplexCharacter = !evt.shiftKey && evt.keyCode != ASPx.Key.Shift && (ASPx.Browser.IE || ASPx.Browser.Edge)
                        && !!selection.focusOffset && Math.abs(selection.anchorOffset - selection.focusOffset) === 1;
                    if(needToClearSelectionForComplexCharacter)
                        selection.collapseToEnd();
                    this.spreadsheetControl.getStateController().onCellEditorChanged();
                    if(!this.spreadsheetControl.isFormulaBarEditMode() && this.spreadsheetControl.showFormulaBar && !this.spreadsheetControl.isFunctionsListBoxDisplayed()) {
                        var keyboardManager = this.spreadsheetControl.getKeyboardManager();
                        if(keyboardManager.IsCursorMovingKey(ASPx.Evt.GetKeyCode(evt))) {
                            var editingHelper = this.spreadsheetControl.getEditingHelper();
                            editingHelper.scrollCellTextViewElementToEditingRow();
                        }
                    }
                    this.valueShouldBeSynchronizedOnInputEvent = true;
                    this.afterInputEvent();
                } else if(ASPx.Browser.MacOSPlatform && ASPx.Browser.WebKitFamily && this.prepareIframeForCopyLocked) {
                    var cmdOrCtrlKeyUp = evt.keyCode === 91 || evt.keyCode === ASPx.Key.Ctrl;
                    if(cmdOrCtrlKeyUp)
                        window.setTimeout(function() { this.setEditableDocumentContent(""); }.aspxBind(this), this.getWebkitMacTimeout());
                    this.prepareIframeForCopyLocked = false;
                }
            }.aspxBind(this), true);

            ASPx.Evt.AttachEventToElement(this.getEditableDocument(), "contextmenu", function(evt) {
                if(!this.isEditingInProgress())
                    ASPx.PopupUtils.PreventContextMenu(evt);
            }.aspxBind(this));

            ASPx.Evt.AttachEventToElement(this.getEditableDocument(), "input", function(evt) {
                this.processContentChangeByContextMenu();
            }.aspxBind(this));

            if(ASPx.Browser.WebKitTouchUI)
                ASPx.Evt.AttachEventToElement(this.getEditableDocument(), "touchstart", function(evt) { evt.stopPropagation(); });
            if(ASPx.Browser.MSTouchUI && ASPx.TouchUIHelper.msGestureEnabled)
                ASPx.Evt.AttachEventToElement(this.getEditableDocument(), ASPx.TouchUIHelper.pointerDownEventName, function(evt) {
                    this.spreadsheetControl.getRenderHelper().getGridContainer().MSGestureTapStopPropagation = true;
                }.aspxBind(this));

            this.spreadsheetControl.attachTooltipsToEditor(this);

            this.initRefocusingHandler();
        },
        processContentChangeByContextMenu: function() {
            if(this.valueShouldBeSynchronizedOnInputEvent && this.isEditingInProgress()) {
                if(ASPx.Browser.Edge && this.eventClearsEditor())
                    setTimeout(function(evt) { this.setEditorContent(""); }.aspxBind(this), 0);
                else
                    setTimeout(function(evt) { this.afterInputEvent(); }.aspxBind(this), 0);
            }
        },
        removeExtraTagsFromEditor: function() {
            if(!ASPx.Browser.Edge && !ASPx.Browser.IE) return;
            var documentContent = this.getEditableDocumentContent();
            if(ASPx.Browser.Edge) {
                if(documentContent.match(/^<div><br><\/div>$/gi))
                    this.setEditorContent("");
                else if(documentContent.match(/^<div>.<\/div>/gi))
                    this.setEditorContent(documentContent.substr(5, 1));
            }
            else {
                if(documentContent.match(/^<p>.<\/p>/gi))
                    this.setEditorContent(documentContent.substr(3, 1));
            }
        },
        setEditorContent: function(documentContent) {
            this.setEditableDocumentContent(documentContent);
            this.setCaretPositionInHtml(documentContent.length);
            this.afterInputEvent();
        },
        afterInputEvent: function() {
            if(this.valueChanged()) {
                this.removeExtraTagsFromEditor();
                this.cachedEditorValue = this.getEditorText();
                this.onEditorElementValueChange();
            }
        },
        eventClearsEditor: function(keyCode) {
            var documentContent = this.getEditableDocumentContent(),
                selection = this.getSelectionPosition(true);
            var isAllSelected = documentContent.length > 0 && selection.startPosition === 0 && selection.endPosition === documentContent.length;
            var isLastSymbolUnderCaret = documentContent.length === 1 &&
                ((selection.startPosition === 0 && keyCode === ASPx.Key.Delete) ||
                    (selection.startPosition === 1 && keyCode === ASPx.Key.Backspace));
            return isAllSelected || isLastSymbolUnderCaret;
        },
        getClipboardText: function(evt) {
            var clipboardText = "";
            if(evt && evt.clipboardData)
                clipboardText = evt.clipboardData.getData('text/plain');
            else if(window.clipboardData)
                clipboardText = window.clipboardData.getData('Text');
            return clipboardText;
        },
        pasteClipboardDataAsPlainText: function(evt) {
            this.cachedEditorValue = this.getEditorText();
            var pastedText = this.getClipboardText(evt);
            this.pasteCopiedText(pastedText);
            this.afterInputEvent();
        },
        pasteCopiedText: function(clipboardText) {
            var pastingHtml = this.processClipboardText(clipboardText),
                selection = this.getSelectionPosition(true),
                caretPosition = selection.startPosition + pastingHtml.length,
                container = this.getContentContainer(),
                containerHtml = container.innerHTML;

            container.innerHTML = this.insertHtml(containerHtml, pastingHtml, selection);
            this.setCaretPositionInHtml(caretPosition);
        },
        processClipboardText: function(clipboardText) {
            return clipboardText.replace(/(?:\r\n)|\n/g, "\r").replace(/\r/g, "<BR>");
        },
        insertHtml: function(sourceHtml, insertedHtml, selection) {
            return sourceHtml.substr(0, selection.startPosition) + insertedHtml + sourceHtml.substr(selection.endPosition);
        },
        initRefocusingHandler: function() {
            var focusHandlerCore = function() {
                if(document.activeElement !== this.getInplaceEditor())
                    this.captureFocus();
            }.aspxBind(this);

            this.refocusHandler = function(evt) {
                var eventSourceElement = ASPx.Evt.GetEventSource(evt),
                    shouldPreserveCustomFocus = eventSourceElement && (this.isInExcludedHtmlElements(eventSourceElement.tagName) || this.eventSourceIsRibbonDropDownControl(evt)),
                    commentEditingInProgress = this.isCommentTextSelection(evt);

                if(!shouldPreserveCustomFocus && !commentEditingInProgress)
                    focusHandlerCore();
            }.aspxBind(this);

            var refocusOnClick = function(element) {
                ASPx.Evt.AttachEventToElement(element, ASPx.TouchUIHelper.touchMouseUpEventName, this.refocusHandler);
            }.aspxBind(this);

            var mainSheetDiv = this.spreadsheetControl.getRenderHelper().getWorkbookControl();
            if(mainSheetDiv)
                refocusOnClick(mainSheetDiv);

            var tabControl = this.spreadsheetControl.getTabControl();
            if(tabControl)
                refocusOnClick(tabControl.GetMainElement());

            var formulaBar = this.spreadsheetControl.getRenderHelper().getFormulaBar();
            if(formulaBar)
                refocusOnClick(formulaBar);
        },
        detachRefocusHandlerFromRibbon: function() {
            if(this.refocusHandler) {
                var ribbon = this.spreadsheetControl.GetRibbon();
                if(ribbon) {
                    ASPx.Evt.DetachEventFromElement(ribbon.GetMainElement(), ASPx.TouchUIHelper.touchMouseUpEventName, this.refocusHandler);
                    this.unscribeOnRibbonDropDownSelectionChanged(ribbon);
                }
            }
        },
        attachRefocusHandlerToRibbon: function() {
            var ribbon = this.spreadsheetControl.GetRibbon();
            if(ribbon && !ribbon.disableRefocus) {
                ASPx.Evt.AttachEventToElement(ribbon.GetMainElement(), ASPx.TouchUIHelper.touchMouseUpEventName, this.refocusHandler);

                this.subscribeOnRibbonDropDownSelectionChanged(ribbon);
            }
        },
        subscribeOnRibbonDropDownSelectionChanged: function(ribbon) {
            var dropDownCommands = this.getDropDownRibbonCommands(),
                len = dropDownCommands.length;
            while(len--) {
                var item = ribbon.GetItemByName(dropDownCommands[len]);
                if(item) {
                    var comboBox = item.getEditor();
                    if(comboBox) {
                        comboBox.QueryCloseUp.AddHandler(function(s, e) {
                            this.onDropDownElementClosed();
                        }.aspxBind(this), this.spreadsheetControl);
                        comboBox.SelectedIndexChanged.AddHandler(function(s, e) {
                            this.dropDownSelectionChanged = true;
                        }.aspxBind(this), this.spreadsheetControl);
                    }
                }
            }
        },
        unscribeOnRibbonDropDownSelectionChanged: function(ribbon) {
            var dropDownCommands = this.getDropDownRibbonCommands(),
                len = dropDownCommands.length;
            while(len--) {
                var item = ribbon.GetItemByName(dropDownCommands[len]);
                if(item) {
                    var comboBox = item.getEditor();
                    if(comboBox) {
                        comboBox.QueryCloseUp.removeHandlerByControlName(this.spreadsheetControl.name);
                        comboBox.SelectedIndexChanged.removeHandlerByControlName(this.spreadsheetControl.name);
                    }
                }
            }
        },
        getDropDownRibbonCommands: function() {
            return [ASPxClientSpreadsheet.ServerCommands.internalCommands.FormatFontName.id, ASPxClientSpreadsheet.ServerCommands.internalCommands.FormatFontSize.id];
        },
        onDropDownElementClosed: function() {
            if(this.dropDownSelectionChanged) {
                setTimeout(function() { this.captureFocus(); }.aspxBind(this), 0);
                this.dropDownSelectionChanged = false;
            }
        },

        isInExcludedHtmlElements: function(elementTagName) {
            var excludedItems = ["INPUT", "TEXTAREA"];
            return excludedItems.indexOf(elementTagName) >= 0;
        },
        isCommentTextSelection: function(evt) {
            var stateController = this.spreadsheetControl.getStateController();
            return stateController.isCommentEditingInProgress() && ASPx.Evt.IsLeftButtonPressed(evt);
        },
        eventSourceIsRibbonDropDownControl: function(evt) {
            var ribbon = this.spreadsheetControl.GetRibbon();
            if(ribbon)
                return ASPxClientRibbon.Events.eventSourceIsDropDownControl(evt) || this.eventSourceIsPartOfDropDownControl(evt);

            return false;
        },
        eventSourceIsPartOfDropDownControl: function(evt) {
            var sourceElement = ASPx.Evt.GetEventSource(evt);
            return sourceElement && sourceElement.tagName === "DIV" && ASPx.ElementHasCssClass(sourceElement, "dxlbd");
        },

        getTouchEditingHelper: function() {
            return this.spreadsheetControl.getTouchEditingHelper();
        },

        getInplaceEditor: function() {
            return this.targetInput;
        },
        getEditableDocument: function() {
            return this.getInplaceEditor().contentDocument || this.getInplaceEditor().contentWindow.document;
        },

        captureFocus: function() {
            if(this.needToPreserveExistingFocus()) return;
            this.callFocusMethod();
            this.ensureCaretInsideInput();
            this.swithControlToReadyForEditingMode();
        },

        ensureCaretInsideInput: function() {
            var needToSetCaretPosition = this.readyToEditingInMSBrowsers() || ASPx.Browser.WebKitTouchUI && !ASPx.Browser.MacOSMobilePlatform;
            if(needToSetCaretPosition)
                setTimeout(function() {
                    this.setCaretPosition();
                }.aspxBind(this), 100);
        },

        performFocusing: function() {
            var needToFocusIFrameBody = ASPx.Browser.WebKitFamily && !ASPx.Browser.WebKitTouchUI || ASPx.Browser.Edge && ASPx.Browser.Version < 17;
            if(needToFocusIFrameBody)
                this.getContentContainer().focus();
            else {
                var iframeContent = this.getInplaceEditor().contentWindow || this.getInplaceEditor().contentDocument;
                iframeContent.focus();
            }
        },

        focusingDoesNotRequireTimeout: function() {
            return ASPx.Browser.MacOSMobilePlatform && (ASPx.Browser.Safari || ASPx.Browser.Chrome);
        },

        setFocus: function() {
            this.prepareForFocusingInIEBrowser();
            this.performFocusing();
            this.restoreStateAfterFocusingInIEBrowser();
        },
        cancelFocusing: function() {
            if(this.focusingTimeout)
                clearTimeout(this.focusingTimeout);
        },
        callFocusMethod: function() {
            if(this.focusingDoesNotRequireTimeout())
                this.setFocus();
            else
                this.focusingTimeout = setTimeout(function() {
                    this.setFocus();
                }.aspxBind(this), 100);
        },

        needToPreserveExistingFocus: function() {
            var isIOSChromeBrowser = ASPx.Browser.MacOSMobilePlatform && ASPx.Browser.Chrome;
            return this.getTouchEditingHelper().isTouchMobileDevice()
                && !this.isEditingInProgress() && !isIOSChromeBrowser;
        },

        readyToEditingInMSBrowsers: function() {
            return this.readyToEditOnMS;
        },

        prepareForFocusingInIEBrowser: function() {
            if(this.firstInitialization && ASPx.Browser.IE && ASPx.Browser.Version === 11)
                this.getContentContainer().style["-ms-user-select"] = "";
        },

        restoreStateAfterFocusingInIEBrowser: function() {
            if(ASPx.Browser.IE && ASPx.Browser.Version === 11) {
                this.getContentContainer().style["-ms-user-select"] = "element";
                this.firstInitialization = false;
            }
        },

        valueChanged: function() {
            return this.cachedEditorValue != this.getEditorText();
        },

        onEditorElementValueChange: function() {
            this.spreadsheetControl.getEditingHelper().onEditorElementValueChange();
        },

        swithControlToReadyForEditingMode: function() {
            this.readyToEditOnMS = false;
        },

        selectEditableDocumentContent: function() {
            var firstChildNode = null;
            if(this.getContentContainer().childNodes.length) {
                firstChildNode = this.getContentContainer().childNodes[0];
                if(!firstChildNode.childNodes.length)
                    return;
            }
            var selection = this.getEditableDocument().getSelection();
            selection.removeAllRanges();
            selection.selectAllChildren(firstChildNode || this.getContentContainer());
        },

        setEditableDocumentContent: function(content) {
            this.getContentContainer().innerHTML = content;
        },
        restoreDefaultContentContainerStyle: function() {
            var contentContainer = this.getContentContainer();
            contentContainer.style.cssText = this.getDefaultStyle();
        },
        replaceEditableDocumentContent: function(content){
            if(ASPx.Browser.Firefox) {
                var body = this.getContentContainer(),
                    newBodyElement = body.cloneNode(false);

                newBodyElement.innerHTML = content;
                body.parentNode.replaceChild(newBodyElement, body);
            } else
                this.setEditableDocumentContent(content);
        },
        getEditableDocumentContent: function() {
            return this.getContentContainer().innerHTML;
        },

        // Editing with IFRAME
        getCaretPosition: function(considerHtmlTags) {
            var body = this.getContentContainer();
            var innerDocument = this.getEditableDocument();
            var innerWindow = innerDocument.defaultView || innerDocument.parentWindow;
            var caretPosition = 0;
            var selection;
            if(typeof innerWindow.getSelection != "undefined") {
                selection = innerWindow.getSelection();
                if(selection && selection.rangeCount > 0) {
                    var range = innerWindow.getSelection().getRangeAt(0);
                    var preCaretRange = range.cloneRange();
                    preCaretRange.selectNodeContents(body);
                    preCaretRange.setEnd(range.endContainer, range.endOffset);
                    caretPosition = this.getRangeLength(preCaretRange, considerHtmlTags);
                }
            } else if((selection = innerDocument.selection) && selection && selection.type != "Control") {
                var textRange = selection.createRange();
                var preCaretTextRange = body.createTextRange();
                preCaretTextRange.moveToElementText(body);
                preCaretTextRange.setEndPoint("EndToEnd", textRange);
                caretPosition = preCaretTextRange.text.length;
            }

            return caretPosition;
        },

        getIFrameInnerWindow: function() {
            return this.getEditableDocument().defaultView || this.getEditableDocument().parentWindow;
        },

        getSelectionPosition: function(considerHtmlTags) {
            var body = this.getContentContainer(),
                innerWindow = this.getIFrameInnerWindow(),
                startPos = 0,
                endPos = 0,
                selection = null;
            if(typeof innerWindow.getSelection != "undefined") {
                selection = innerWindow.getSelection();
                if(selection.rangeCount > 0) {
                    var range = innerWindow.getSelection().getRangeAt(0);

                    var preCaretRange = range.cloneRange();
                    preCaretRange.selectNodeContents(body);
                    preCaretRange.setEnd(range.endContainer, range.endOffset);
                    endPos = this.getRangeLength(preCaretRange, considerHtmlTags);

                    var preSelectionRange = range.cloneRange();
                    preSelectionRange.selectNodeContents(body);
                    preSelectionRange.setEnd(range.startContainer, range.startOffset);
                    startPos = this.getRangeLength(preSelectionRange, considerHtmlTags);
                }
            }
            return { startPosition: startPos, endPosition: endPos };
        },

        getRangeLength: function(range, considerHtmlTags) {
            if(considerHtmlTags) {
                var rangeContent = range.cloneContents();
                return this.getElementHtmlContentLength(rangeContent);
            }
            else
                return range.toString().length;
        },

        getElementHtmlContentLength: function(element) {
            var testElement = document.createElement("SPAN");
            testElement.appendChild(element);
            return testElement.innerHTML.length;
        },

        setCaretPosition: function(globalCaretPosition) {
            var innerDocument = this.getEditableDocument(),
                selection = innerDocument.getSelection(),
                selectionRange = innerDocument.createRange(),
                selectionParams = this.getNodeByCaretPosition(globalCaretPosition),
                targetNode = selectionParams.targetNode,
                caretPosition = selectionParams.caretPosition;

            selectionRange.setStart(targetNode, caretPosition);
            selectionRange.setEnd(targetNode, caretPosition);

            this.clearExistingSelection(selection);
            selection.addRange(selectionRange);
        },

        setCaretPositionInHtml: function(caretPosition) {
            var innerDocument = this.getEditableDocument(),
                body = this.getContentContainer();
            if(!body.childNodes)
                return;
            var selection = innerDocument.getSelection(),
                selectionRange = innerDocument.createRange(),
                currentCaretPosition = 0;
            selectionRange.setStart(body, 0);
            selectionRange.setEnd(body, 0);

            for(var i = 0; i < body.childNodes.length && currentCaretPosition < caretPosition; i++) {
                var currentNode = body.childNodes[i];
                var nodeHtmlLength = this.getNodeHtmlContentLength(currentNode);
                var nodeValue = currentNode.nodeValue || currentNode.outerHTML;
                currentCaretPosition += nodeHtmlLength;
                if(currentCaretPosition >= caretPosition) {
                    var offset = (/^<BR>$/i.test(nodeValue)) ? 0 : nodeHtmlLength;
                    if(currentCaretPosition === caretPosition && !offset && body.childNodes.length > i + 1) {
                        selectionRange.setStart(body, i + 1);
                        selectionRange.setEnd(body, i + 1);
                    }
                    else {
                        var selectionPosition = caretPosition - currentCaretPosition + offset;
                        if(nodeHtmlLength !== nodeValue.length)
                            selectionPosition = this.correctSelectionPositionInNode(selectionPosition, currentNode);
                        selectionRange.setStart(currentNode, selectionPosition);
                        selectionRange.setEnd(currentNode, selectionPosition);
                    }
                }
            }
            this.clearExistingSelection(selection);
            selection.addRange(selectionRange);
        },

        correctSelectionPositionInNode: function(position, textNode) {
            var clonedNode = textNode.cloneNode();
            var testElement = document.createElement("SPAN");
            testElement.appendChild(clonedNode);
            var innerHTML = testElement.innerHTML;
            testElement.innerHTML = innerHTML.substr(0, position);
            return testElement.innerText.length;
        },

        getNodeHtmlContentLength: function(textNode) {
            var clonedNode = textNode.cloneNode();
            return this.getElementHtmlContentLength(clonedNode);
        },

        setSelection: function(startPos, endPos) {
            if(startPos > endPos) return;

            var innerDocument = this.getEditableDocument(),
                innerWindow = this.getIFrameInnerWindow(),
                startNode = this.getNodeByCaretPosition(startPos),
                endNode = this.getNodeByCaretPosition(endPos),
                selection = innerWindow.getSelection();
            this.clearSelections();

            var range = innerDocument.createRange();
            range.setStart(startNode.targetNode, startNode.caretPosition);
            range.setEnd(endNode.targetNode, endNode.caretPosition);
            selection.addRange(range);
        },
        selectAll: function() {
            var innerWindow = this.getIFrameInnerWindow(),
                selection = innerWindow.getSelection(),
                body = this.getContentContainer();

            this.clearSelections();
            selection.selectAllChildren(body);
        },

        clearSelections: function() {
            var innerWindow = this.getIFrameInnerWindow();
            if(innerWindow.getSelection().empty) {  // Chrome
                innerWindow.getSelection().empty();
            } else if(innerWindow.getSelection().removeAllRanges) {  // Firefox
                innerWindow.getSelection().removeAllRanges();
            }
        },

        clearExistingSelection: function(selection) {
            var existingRange;
            try {
                existingRange = selection.getRangeAt(0);
            } catch(e) { }

            if(existingRange)
                selection.removeAllRanges(existingRange);
        },

        getLastTextNode: function(childNodes) {
            var textNode = childNodes[0];
            if(childNodes) {
                var len = childNodes.length;
                while(len--) {
                    if(childNodes[len].tagName !== "BR" && typeof (childNodes[len].length) !== "undefined") {
                        textNode = childNodes[len];
                        break;
                    }
                }
            }
            return textNode;
        },

        setControllerMode: function(mode) {
            this.mode = mode;
        },
        isEditingInProgress: function() {
            return this.mode === ASPxClientSpreadsheet.InputController.Modes.Editing;
        },
        onEditingStarting: function() {
            this.showTargetInput();
        },
        onEditingStarted: function() {
            this.setControllerMode(ASPxClientSpreadsheet.InputController.Modes.Editing);
            this.cachedEditorValue = this.getEditorText();
            this.captureFocus();
            this.showTouchEditingFloatingActionPanel();
        },
        onEditingStopped: function() {
            this.setControllerMode(ASPxClientSpreadsheet.InputController.Modes.Listening);
            this.setEditableDocumentContent("");
            this.cachedEditorValue = "";
            this.hideTouchEditingFloatingActionPanel();
            this.hideKeyboardOnWebkitTouch();
            this.hideTargetInput();
            this.restoreDefaultContentContainerStyle();
        },
        continueEditing: function() {
            this.captureFocus();
        },
        hideKeyboardOnWebkitTouch: function() {
            if(ASPx.Browser.WebKitTouchUI) {
                var input = this.getEditableDocument().createElement('INPUT');
                this.getContentContainer().appendChild(input);
                input.focus();
                input.blur();
                this.getContentContainer().removeChild(input);
            }
        },
        showTouchEditingFloatingActionPanel: function() {
            if(this.getTouchEditingHelper().isTouchMobileDevice())
                setTimeout(function() {
                    this.getTouchEditingHelper().createFloatingActionPanel();
                }.aspxBind(this), 300);
        },
        hideTouchEditingFloatingActionPanel: function() {
            this.getTouchEditingHelper().removeFloatingActionPanel();
        },
        
        showTargetInput: function() {
        },
        hideTargetInput: function() {
        },

        getContentContainer: function() {
            return this.getEditableDocument().body;
        },

        setTextAsHtml: function(stringText) {
            this.setEditableDocumentContent("");
            stringText = stringText.replace(/</gi, "&lt;").replace(/>/gi, "&gt;");
            var multiLineText = (stringText.match(/\n/g) || []).length > 0;
            if(multiLineText) {
                stringText = stringText.replace(/\r\n/g, "<BR>");
                stringText = stringText.replace(/\n/g, "<BR>");
            }

            var nodes = stringText.split("<BR>"),
                len = nodes.length,
                innerContentHTML = [];
            if(len === 1) {
                innerContentHTML.push(stringText.replace(/\s/gi, "&nbsp;"));
            } else {
                for(var i = 0; i < len; i++) {
                    var text = nodes[i] || "";

                    text = text.replace(/&lt;/gi, "<").replace(/&gt;/gi, ">").replace(/\s/gi, "&nbsp;");
                    innerContentHTML.push(text);
                    if((i !== len - 1) || (text === ""))
                        innerContentHTML.push("<BR/>");
                }
            }

            this.setEditableDocumentContent(innerContentHTML.join(''));
        },
        getEditorText: function() {
            return ASPxClientSpreadsheet.InputController.ConvertHtmlToText(this.getEditableDocumentContent());
        },
        getEditorCurrentRowIndex: function() {
            var caretPosition = this.getCaretPosition(true);
            var editorHtml = this.getEditableDocumentContent();
            editorHtml = editorHtml.substring(0, caretPosition);
            return (/<BR>/ig.test(editorHtml)) ? editorHtml.match(/<BR>/ig).length : 0;
        },
        onAltEnterEvent: function() {
            var selectionPosition = this.getSelectionPosition(true),
                caretPosition = selectionPosition.startPosition + 4,
                container = this.getContentContainer(),
                containerHtml = container.innerHTML,
                newLineHtml = (selectionPosition.startPosition < containerHtml.length) ? "<BR>" : "<BR><BR>";
            container.innerHTML = this.insertHtml(containerHtml, newLineHtml, selectionPosition);
            this.setCaretPositionInHtml(caretPosition);
            this.scrollContentToNextLine();
        },
        scrollContentToNextLine: function() {
            var contentWindow = this.getInplaceEditor().contentWindow,
                verticalOffset = contentWindow.scrollY || contentWindow.pageYOffset;

            var lineHeight = ASPx.PxToInt(this.getInplaceEditor().style.height);
            contentWindow.scrollTo(0, verticalOffset + lineHeight);
        },
        // on multiline string need to analyze selected node
        // for caret set and focusing
        getNodeByCaretPosition: function(caretPosition, selection, range) {
            var innerDocument = this.getEditableDocument();
            selection = selection || innerDocument.getSelection();

            var container = this.getContentContainer(),
                children = container.childNodes,
                currentCaretPosition = caretPosition,
                len;
            var targetNode = (selection.isCollapsed) ? this.getContentContainer() : selection.anchorNode;
            var hasChildren = children && children.length > 0;
            if(hasChildren) {
                if(typeof (currentCaretPosition) !== "undefined") {
                    targetNode = children.length > 0 ? this.getLastTextNode(children) : container;
                    len = children.length;
                    for(var i = 0; i < len; i++) {
                        var childNode = children[i];
                        if(childNode.tagName !== "BR") {
                            if(childNode.length >= currentCaretPosition) {
                                // in multiline mode last caretPosition on firstNode is the
                                // same as first position on secondNode
                                // so need to analyze selection
                                targetNode = childNode;
                                break;
                            } else {
                                currentCaretPosition -= childNode.length;
                            }
                        }
                    }

                } else {
                    targetNode = this.getLastTextNode(children);
                    currentCaretPosition = targetNode.length || 0;
                }
            }

            len = targetNode.length || 0;
            currentCaretPosition = currentCaretPosition > len ? len : currentCaretPosition;

            return { targetNode: targetNode, caretPosition: currentCaretPosition };
        },

        setCaretPositionToNode: function(targetNode, caretPosition) {
            var innerDocument = this.getEditableDocument(),
                selection = innerDocument.getSelection(),
                selectionRange = innerDocument.createRange(),
                len = 0;
            if(targetNode)
                len = targetNode.length;

            if(typeof (caretPosition) !== "undefined") {
                caretPosition = caretPosition > len ? len : caretPosition;
            } else {
                caretPosition = len;
            }

            if(!targetNode) {
                var container = this.getContentContainer(),
                    children = container.childNodes,
                    hasChildren = children && children.length > 0;
                targetNode = (hasChildren && children.length > 0) ? this.getLastTextNode(children) : container;
            }
            selectionRange.setStart(targetNode, caretPosition);
            selectionRange.setEnd(targetNode, caretPosition);

            this.clearExistingSelection(selection);
            selection.addRange(selectionRange);
        },

        getSelection: function() {
            var innerDocument = this.getEditableDocument();
            return innerDocument.getSelection();
        },
        getOnlyText: function() {
            var multiLineText = this.getEditorText();
            var oneLineText = multiLineText.replace(/\n/g, "");
            return oneLineText;
        },

        savePastedHtml: function(html) {
            this.pastedHTML = html;
        },
        getPastedHtml: function() {
            return this.pastedHTML;
        },

        prepareIframeForClientSideCopy: function() {
            if(!this.prepareIframeForCopyLocked) {
                if(ASPx.Browser.MacOSPlatform && ASPx.Browser.WebKitFamily)
                    this.prepareIframeForCopyLocked = true;
                this.setEditableDocumentContent("");
                this.selectEditableDocumentContent();
                this.renderSelectionToEditableDocument();
                this.selectEditableDocumentContent();
            }
        },
        onCopyEventProcessing: function(commandId) {
            if(!(ASPx.Browser.MacOSPlatform && ASPx.Browser.WebKitFamily))
                this.prepareIframeForClientSideCopy();
            this.renderCopiedRangeArea(commandId);

            var args = this.spreadsheetControl.getClipboardHelper().CreateCopyCutServerCommandArgs();
            
            if(commandId)
                ASPxClientSpreadsheet.ServerCommands.CopySelection(this.spreadsheetControl, args);
            else
                ASPxClientSpreadsheet.ServerCommands.CutSelection(this.spreadsheetControl, args);

            if(this.isBrowserRequiredCleaning())
                setTimeout(function() { this.setEditableDocumentContent(""); }.aspxBind(this), 10);
        },
        isBrowserRequiredCleaning: function() {
            return true;
        },
        renderSelectionToEditableDocument: function() {
            var selection = this.spreadsheetControl.getStateController().getSelection(),
                paneManager = this.spreadsheetControl.getPaneManager();
            selection.expandToAllSheetIfRequired(paneManager);
            if(selection.isDrawingBoxSelection())
                this.renderDrawingBoxToEditableDocument(selection.drawingBoxElement);
            else
                this.renderTableToEditableDocument(selection);
        },
        renderCopiedRangeArea: function(commandId) {
            this.spreadsheetControl.getStateController().markCopiedRange(commandId);
        },
        renderDrawingBoxToEditableDocument: function(drawingBoxElement) {
            var span = this.getEditableDocument().createElement("SPAN"),
                image = drawingBoxElement.cloneNode();
            image.className = "";
            span.appendChild(image);
            this.getContentContainer().appendChild(span);
        },
        renderTableToEditableDocument: function(selection) {
            var table = this.getEditableDocument().createElement("TABLE"),
                defaultTableStyles = {
                    "border-collapse": "collapse",
                    "border-spacing": 0
                };
            ASPx.SetStyles(table, defaultTableStyles);
            table.cellPadding = 0;

            // create marker
            var marker = this.getEditableDocument().createElement("I");
            ASPx.Attr.SetAttribute(marker, "id", this.spreadsheetControl.getCurrentClipboardBufferId(true));

            var paneManager = this.spreadsheetControl.getPaneManager(),
                // TODO if freeze panes and selectAll, document have 2+ visible area
                visibleRange = paneManager.getVisibleModelCellRange(),
                copyModelRange = selection.isAllSelected() ? visibleRange : {
                    top: selection.entireColsSelected ? visibleRange.top : selection.range.topRowIndex,
                    bottom: selection.entireColsSelected ? visibleRange.bottom : selection.range.bottomRowIndex,
                    left: selection.entireRowsSelected ? visibleRange.left : selection.range.leftColIndex,
                    right: selection.entireRowsSelected ? visibleRange.right : selection.range.rightColIndex
                };
            for(var row = copyModelRange.top; row <= copyModelRange.bottom; row++) {
                var tr = table.insertRow(),
                    rowModelIndex = paneManager.convertVisibleIndexToModelIndex(row, false),
                    rowHeight = this.spreadsheetControl.getCellElementStyleByModelPosition(selection.range.leftColIndex, rowModelIndex, ["height"]).height;
                ASPx.SetStyles(tr, { height: rowHeight });
                for(var col = copyModelRange.left; col <= copyModelRange.right; col++) {
                    var selectionHelper = this.spreadsheetControl.getSelectionHelper(),
                        editingRange = new ASPxClientSpreadsheet.Range(col, row, col, row),
                        expandedRange = selectionHelper.ExpandRangeToMergedCellSize(editingRange),
                        colModelIndex = paneManager.convertVisibleIndexToModelIndex(col, true),
                        shouldCreateTd = true,
                        colSpan = 0,
                        rowSpan = 0;

                    if(expandedRange.leftColIndex !== expandedRange.rightColIndex) {
                        colSpan = expandedRange.rightColIndex - expandedRange.leftColIndex + 1;
                        if(col !== expandedRange.leftColIndex) shouldCreateTd = false;
                    }
                    if(expandedRange.topRowIndex !== expandedRange.bottomRowIndex) {
                        rowSpan = expandedRange.bottomRowIndex - expandedRange.topRowIndex + 1;
                        if(row !== expandedRange.topRowIndex) shouldCreateTd = false;
                    }

                    if(shouldCreateTd) {
                        var td = tr.insertCell(),
                            cellStyle = this.getCellStyleForClipboard(colModelIndex, rowModelIndex, row === selection.range.topRowIndex),
                            rawValue = this.spreadsheetControl.getPaneManager().getCellValue(colModelIndex, rowModelIndex),
                            cell = this.spreadsheetControl.getRenderHelper().getCellTextElementByModelPosition(colModelIndex, rowModelIndex),
                            link = ASPx.GetNodeByTagName(cell, "a", 0);
                        ASPx.SetStyles(td, cellStyle);
                        if(colSpan)
                            td.colSpan = colSpan;
                        if(rowSpan)
                            td.rowSpan = rowSpan;

                        td.appendChild(link ? link.cloneNode(true) : this.getEditableDocument().createTextNode(rawValue ? rawValue : ""));
                    }
                }
            }
            marker.appendChild(table);
            this.getContentContainer().appendChild(marker);
        },
        getCellStyleForClipboard: function(col, row, isFistRow) {
            var defaultCellStyle = {
                color: "#000000",
                backgroundColor: "#FFFFFF",
                textAlign: "left",
                textDecoration: "none",
                fontStyle: "normal",
                fontWeight: "normal",
                padding: 0
            };
            var cellStyle = this.spreadsheetControl.getCellElementStyleByModelPosition(col, row, this.getCellStyleAttributes(isFistRow));
            var defaultStyleAttributes = ASPx.GetObjectKeys(defaultCellStyle);
            for(var i = 0, len = defaultStyleAttributes.length; i < len; i++) {
                var attr = defaultStyleAttributes[i];
                if(cellStyle[attr] === defaultCellStyle[attr])
                    delete cellStyle[attr];
            }
            return cellStyle;
        },
        getCellStyleAttributes: function(isCellInFistRow) {
            var attributes = [
                "color", "backgroundColor", "verticalAlign", "whiteSpace",
                "fontFamily", "fontSize", "fontWeight", "fontStyle",
                "textAlign", "textDecoration", "textAlign"
            ];
            if(isCellInFistRow) attributes.push("width");
            return attributes;
        },

        moveInplaceEditorToActiveCell: function() {
            var inplaceEditor = this.getInplaceEditor();
            if(ASPx.Browser.WebKitFamily) {
                var isChrome65 = ASPx.Browser.Chrome && ASPx.Browser.MajorVersion > 64;
                if(!isChrome65)
                    inplaceEditor.style.display = "none";
            } else {
                var selection = this.spreadsheetControl.getSelectionInternal(),
                    activeCellColVisibleIndex = selection.activeCellColIndex,
                    activeCellRowVisibleIndex = selection.activeCellRowIndex,
                    cellLayoutInfo = this.spreadsheetControl.getPaneManager().getCellLayoutInfo(activeCellColVisibleIndex, activeCellRowVisibleIndex),
                    rect = cellLayoutInfo.rect,
                    elementOffset = cellLayoutInfo.tileInfo.htmlElement;

                var xOffset = ASPxClientUtils.GetAbsoluteX(elementOffset);
                var yOffset = ASPxClientUtils.GetAbsoluteY(elementOffset);

                if(ASPx.Browser.IE && ASPx.Browser.Version >= 10) {
                    xOffset = Math.round(xOffset);
                    yOffset = Math.round(yOffset);
                }

                ASPxClientUtils.SetAbsoluteX(inplaceEditor, rect.x + xOffset);
                ASPxClientUtils.SetAbsoluteY(inplaceEditor, rect.y + yOffset);
            }
        },
        releaseInplaceEditor: function() {
            if(ASPx.Browser.WebKitFamily) {
                var isChrome65 = ASPx.Browser.Chrome && ASPx.Browser.MajorVersion > 64;
                if(!isChrome65) {
                    var inplaceEditor = this.getInplaceEditor();
                    inplaceEditor.style.display = "";
                }
            }
        },
        getClipboardHelper: function() {
            return this.spreadsheetControl.getClipboardHelper();
        },
        // Paste Event
        onPasteEventProcessing: function() {
            this.getClipboardHelper().onPasteEvent();
            this.captureFocus();
        }
    });

    ASPxClientSpreadsheet.InputController.ConvertHtmlToText = function(html) {
        if(!html)
            return "";

        if(/<BR><BR>$/i.test(html)) {
            if(ASPx.Browser.MacOSPlatform && ASPx.Browser.Safari)
                html = html.replace(/<BR><BR>$/i, "");
            else
                html = html.replace(/<BR><BR>$/i, "<BR>");
        }
        else if(/<BR>$/i.test(html)) {
            // Chrome optimization - remove textNode or BR at end of string 
            // if it's empty or before BR none empty textNode
            html = html.replace(/<BR>$/i, "");
        }

        html = html.replace(/<BR\/?>/ig, '\n');
        html = html.replace(/&nbsp;/g, " ").replace(/&amp;/g, "&").replace(/&gt;/g, ">").replace(/&lt;/g, "<");

        return html;
    };

    ASPxClientSpreadsheet.InputController.Modes = {
        Listening: 0,
        Editing: 1/*,
        ClipboardProcessing: 2*/
    };
})();
(function() {

    function EditorInfo() {
        this.assign = function(editorText, editorCaretPosition) {
            this.text = editorText;
            this.caretPosition = editorCaretPosition;
        };
    }

    var EditorTextParser = {
        lettersDigitsDotsPattern: "[^~!@#\$%\^&\*\(\)\\-\+=\{\[\\]\}\|:;\"',/\?<>\\\\ \r\n]+",
        digitsDotsAtTheBeginningPattern: "^[0-9\.]+",
        getLettersDigitsDotsAtTheEndPattern: function() {
            return EditorTextParser.lettersDigitsDotsPattern + "$";
        },
        getLettersDigitsDotsAtTheBeginningPattern: function() {
            return "^" + EditorTextParser.lettersDigitsDotsPattern;
        },
        getTextBeforeCaret: function(editorInfo) {
            return editorInfo.text.substring(0, editorInfo.caretPosition);
        },
        getTextAfterCaret: function(editorInfo) {
            return editorInfo.text.substring(editorInfo.caretPosition);
        },
        getTextBeforePartialFunctionNameBeforeCaret: function(editorInfo) {
            var partialFunctionNameBeforeCaret = EditorTextParser.getPartialFunctionNameBeforeCaret(editorInfo);
            return editorInfo.text.substring(0, editorInfo.caretPosition - partialFunctionNameBeforeCaret.length);
        },
        editorTextContainsFormula: function(editorInfo) {
            return EditorTextParser.getCharByIndex(editorInfo.text, 0) === "=";
        },
        getCharByIndex: function(string, index) {
            return string.substring(index, index + 1); // TODO - substring is used only for web server tests - to replace with text[i] after Jasmine test implementation
        },
        getPartialFunctionNameBeforeCaret: function(editorInfo) {
            if(!EditorTextParser.editorTextContainsFormula(editorInfo))
                return "";
            var textBeforeCaret = EditorTextParser.getTextBeforeCaret(editorInfo);
            var lettersDigitsDotsBeforeCaretMatch = new RegExp(EditorTextParser.getLettersDigitsDotsAtTheEndPattern()).exec(textBeforeCaret);
            if(!ASPx.IsExists(lettersDigitsDotsBeforeCaretMatch))
                return "";
            return lettersDigitsDotsBeforeCaretMatch[0].replace(new RegExp(EditorTextParser.digitsDotsAtTheBeginningPattern), "");
        },
        getPartialFunctionNameAfterCaret: function(editorInfo) {
            if(!EditorTextParser.editorTextContainsFormula(editorInfo))
                return "";
            var textAfterCaret = EditorTextParser.getTextAfterCaret(editorInfo);
            var lettersDigitsDotsAfterCaretMatch = new RegExp(EditorTextParser.getLettersDigitsDotsAtTheBeginningPattern()).exec(textAfterCaret);
            return ASPx.IsExists(lettersDigitsDotsAfterCaretMatch) ? lettersDigitsDotsAfterCaretMatch[0] : "";
        },
        removeOpenBracketFromBeginning: function(text) {
            return text.substring(0, 1) === "(" ? text.substring(1) : text;
        },
        modifyEditorInfoByFunctionNameInserting: function(editorInfo, functionName) {
            var textBeforePartialFunctionNameBeforeCaret = EditorTextParser.getTextBeforePartialFunctionNameBeforeCaret(editorInfo);
            var textAfterCaret = EditorTextParser.getTextAfterCaret(editorInfo);
            var requiredTextAfterFunction = EditorTextParser.removeOpenBracketFromBeginning(textAfterCaret);
            var newText = textBeforePartialFunctionNameBeforeCaret + functionName + "(" + requiredTextAfterFunction;
            var newCaretPosition = newText.length - requiredTextAfterFunction.length;
            editorInfo.assign(newText, newCaretPosition);
        },
        getOuterOpenBracketAtLeftPosition: function(editorInfo) {
            var textBeforeCaret = EditorTextParser.getTextBeforeCaret(editorInfo);
            var openBracketsAtLeftCounter = 0;
            var closeBracketsAtLeftCounter = 0;
            for(var i = textBeforeCaret.length - 1; i >= 0; i--) {
                if(EditorTextParser.getCharByIndex(textBeforeCaret, i) === "(")
                    openBracketsAtLeftCounter++;
                if(EditorTextParser.getCharByIndex(textBeforeCaret, i) === ")")
                    closeBracketsAtLeftCounter++;
                if(openBracketsAtLeftCounter > closeBracketsAtLeftCounter)
                    return i;
            }
            return -1;
        },
        getPartialFunctionNameWithOpenBracketAroundCaret: function(editorInfo) {
            var partialFunctionNameBeforeCaret = EditorTextParser.getPartialFunctionNameBeforeCaret(editorInfo);
            if(partialFunctionNameBeforeCaret === "")
                return "";
            var partialFunctionNameAfterCaret = EditorTextParser.getPartialFunctionNameAfterCaret(editorInfo);
            var positionAfterPartialFunctionName = editorInfo.caretPosition + partialFunctionNameAfterCaret.length;
            var isOpenBracketAfterFunctionName = EditorTextParser.getCharByIndex(editorInfo.text, positionAfterPartialFunctionName) === "(";
            return isOpenBracketAfterFunctionName ? partialFunctionNameBeforeCaret + partialFunctionNameAfterCaret : "";
        },
        getPartialFunctionNameBeforeOuterOpenBracket: function(editorInfo) {
            var outerOpenBracketAtLeftPosition = this.getOuterOpenBracketAtLeftPosition(editorInfo);
            if(outerOpenBracketAtLeftPosition !== -1) {
                var newEditorInfo = new EditorInfo();
                newEditorInfo.assign(editorInfo.text, outerOpenBracketAtLeftPosition);
                return EditorTextParser.getPartialFunctionNameBeforeCaret(newEditorInfo);
            }
            return EditorTextParser.getPartialFunctionNameWithOpenBracketAroundCaret(editorInfo);
        }
    };

    var HintManager = {
        hintClassName: "dxss-hint",
        hintIdPostfix: "_Hint",
        GetHintId: function(hintIdPrefix) {
            return hintIdPrefix + HintManager.hintIdPostfix;
        },
        FindHint: function(hintParent, hintIdPrefix) {
            return ASPx.GetChildById(hintParent, HintManager.GetHintId(hintIdPrefix));
        },
        FindOrCreateHint: function(hintParent, hintIdPrefix, hintStyle) {
            var hint = HintManager.FindHint(hintParent, hintIdPrefix);
            if(!ASPx.IsExists(hint)) {
                hintStyle = hintStyle || ["", null];
                hint = document.createElement("DIV");
                hint.id = HintManager.GetHintId(hintIdPrefix);
                ASPx.AddClassNameToElement(hint, HintManager.hintClassName);
                ASPx.AddClassNameToElement(hint, hintStyle[0]);
                if(ASPx.IsExists(hintStyle[1]))
                    ASPx.AddClassNameToElement(hint, ASPx.CreateImportantStyleRule(ASPx.GetCurrentStyleSheet(), hintStyle[1]));
                hintParent.appendChild(hint);
            }
            return hint;
        },
        ShowHint: function(hintParent, hintIdPrefix, text, posX, posY, hintStyle, getOffsetToLeftWhenPlaceIsNotEnough) {
            var hint = HintManager.FindOrCreateHint(hintParent, hintIdPrefix, hintStyle);
            ASPx.SetInnerHtml(hint, text);
            ASPx.SetAbsoluteX(hint, posX);
            ASPx.SetAbsoluteY(hint, posY);
            var hintRightPosition = ASPx.GetAbsoluteX(hint) + hint.offsetWidth + ASPx.GetLeftRightMargins(hint);
            var isPlaceAtRightIsNotEnoughForHint = hintRightPosition > ASPx.GetDocumentClientWidth();
            if(isPlaceAtRightIsNotEnoughForHint && getOffsetToLeftWhenPlaceIsNotEnough) {
                var correctedPosX = posX - getOffsetToLeftWhenPlaceIsNotEnough(hint);
                if(correctedPosX >= 0)
                    ASPx.SetAbsoluteX(hint, correctedPosX);
            }
        },
        HideHint: function(hintParent, hintIdPrefix) {
            var hint = HintManager.FindHint(hintParent, hintIdPrefix);
            if(ASPx.IsExists(hint))
                ASPx.RemoveElement(hint);
        }
    };

    ASPxClientSpreadsheet.FormulaIntelliSenseManager = ASPx.CreateClass(null, {
        constructor: function(spreadsheet) {
            this.ownerControl = spreadsheet;
            this.functionsListBox = spreadsheet.getFunctionsListBox();
            this.initialize();
        },
        initialize: function() {
            var functionsListBoxMainElement = this.getFunctionsListBox().GetMainElement();

            if(ASPx.Browser.WebKitTouchUI)
                ASPx.TouchUIHelper.AttachDoubleTapEventToElement(functionsListBoxMainElement, function(e) {
                    this.onFunctionsListBoxItemDoubleClick();
                }.aspxBind(this));
            else
                ASPx.Evt.AttachEventToElement(functionsListBoxMainElement, "dblclick", function(evt) {
                    this.onFunctionsListBoxItemDoubleClick();
                }.aspxBind(this));

            this.functionsListBox.Hide();
        },
        getFunctionsListBox: function() {
            return this.functionsListBox;
        },
        getOwnerControl: function() {
            return this.ownerControl;
        },
        getInputController: function() {
            return this.inputController;
        },
        setInputController: function(inputController) {
            this.inputController = inputController;
        },
        getEditorText: function() {
            return this.getInputController().getEditorText();
        },
        getEditorCaretPosition: function() {
            return this.getInputController().getCaretPosition();
        },

        attachToEditorElement: function(inputController) {
            this.setInputController(inputController);
            var editableDocument = this.getInputController().getEditableDocument();
            ASPx.Evt.AttachEventToElement(editableDocument, "click", function(evt) { this.onEditorClick(); }.aspxBind(this));
            ASPx.Evt.AttachEventToElement(editableDocument, "keydown", function(evt) { this.onEditorKeyDown(evt); }.aspxBind(this));
            ASPx.Evt.AttachEventToElement(editableDocument, "keyup", function(evt) { this.onEditorKeyUp(evt); }.aspxBind(this));
        },
        onFunctionsListBoxItemDoubleClick: function() {
            this.insertSelectedFunctionNameToEditor();
            this.displayCurrentFunctionArgumentsHint();
        },
        updateIntelliSenseElementsPosition: function(requiredElementNearIntelliSenseElements) {
            this.intelliSenseElementPositionX = ASPx.GetAbsoluteX(requiredElementNearIntelliSenseElements);
            this.intelliSenseElementPositionY = ASPx.GetAbsoluteY(requiredElementNearIntelliSenseElements)
                + requiredElementNearIntelliSenseElements.offsetHeight;
            if(this.isFunctionsListBoxDisplayed())
                this.showFunctionsListBoxAtActualPosition();
        },
        onEditorClick: function() {
            this.hideFunctionsListBox();
            this.displayCurrentFunctionArgumentsHint();
        },
        isNavigationInListBoxKeyCode: function(evt) {
            var keyCode = ASPx.Evt.GetKeyCode(evt);
            return keyCode === ASPx.Key.Up || keyCode === ASPx.Key.Down
                || keyCode === ASPx.Key.PageUp || keyCode === ASPx.Key.PageDown;
        },
        isInsertFunctionKeyCode: function(evt) {
            return ASPx.Evt.GetKeyCode(evt) == ASPx.Key.Tab;
        },
        onEditorKeyDown: function(evt) {
            this.editorValueOnKeyDown = this.getEditorText();
            if(this.isFunctionsListBoxDisplayed()) {
                if(this.isNavigationInListBoxKeyCode(evt))
                    this.performNavigationInListBox(evt);
                if(this.isInsertFunctionKeyCode(evt))
                    ASPx.Evt.PreventEventAndBubble(evt);
            }
        },
        onEditorKeyUp: function(evt) {
            if(this.isFunctionsListBoxDisplayed() && this.isInsertFunctionKeyCode(evt))
                this.insertSelectedFunctionNameToEditor();
            else if(!this.isNavigationInListBoxKeyCode(evt) && this.getEditorText() === this.editorValueOnKeyDown)
                this.hideFunctionsListBox();
            else if(!this.isNavigationInListBoxKeyCode(evt) && this.getInputController().valueChanged()) {
                this.getOwnerControl().updateIntelliSenseElementsPosition();
                this.displayPossibleFunctionNamesInListBox();
            }
            setTimeout(function() {
                if(!this.isFunctionsListBoxDisplayed())
                    this.displayCurrentFunctionArgumentsHint();
            }.aspxBind(this), 0);
        },
        getEditorInfo: function() {
            if(!ASPx.IsExists(this.editorInfo))
                this.editorInfo = new EditorInfo();
            this.editorInfo.assign(this.getEditorText(), this.getEditorCaretPosition());
            return this.editorInfo;
        },
        getFunctionByName: function(name) {
            if(name === "")
                return null;
            var nameForFiltering = ASPx.Str.PrepareStringForFilter(name);
            var functionIndex = ASPx.Data.ArrayIndexOf(ASPxClientSpreadsheet.Functions, nameForFiltering,
                function(currentFunction) {
                    var functionNameForFiltering = ASPx.Str.PrepareStringForFilter(currentFunction.name);
                    return functionNameForFiltering === nameForFiltering;
                });
            return functionIndex !== -1 ? ASPxClientSpreadsheet.Functions[functionIndex] : null;
        },
        displayCurrentFunctionArgumentsHint: function() {
            var editorInfo = this.getEditorInfo();
            var partialFunctionNameBeforeOuterOpenBracket = EditorTextParser.getPartialFunctionNameBeforeOuterOpenBracket(editorInfo);
            var spreadsheetFunction = this.getFunctionByName(partialFunctionNameBeforeOuterOpenBracket);
            if(ASPx.IsExists(spreadsheetFunction))
                this.showFunctionArgumentsHint(spreadsheetFunction);
            else
                this.hideFunctionArgumentsHint();
        },
        getFunctionArgumentsHintText: function(spreadsheetFunction) {
            var argumentsString = "";
            var argumentsWithDescriptionsString = "";
            for(var i = 0; i < spreadsheetFunction.arguments.length; i++) {
                var argument = spreadsheetFunction.arguments[i];
                argumentsString += argument.name;
                if(i !== spreadsheetFunction.arguments.length - 1)
                    argumentsString += ", ";
                argumentsWithDescriptionsString += "\r\n\t<b>" + argument.name + ": </b>" + argument.description;
            }
            var result = spreadsheetFunction.name + "(" + argumentsString;
            if(spreadsheetFunction.hasUnlimitedParametersCount)
                result += "...";
            result += ")" + argumentsWithDescriptionsString;
            return result;
        },
        insertSelectedFunctionNameToEditor: function() {
            var listBoxSelectedItem = this.getFunctionsListBox().GetSelectedItem();
            if(!ASPx.IsExists(listBoxSelectedItem))
                return;
            var functionName = listBoxSelectedItem.text;
            var editorInfo = this.getEditorInfo();
            EditorTextParser.modifyEditorInfoByFunctionNameInserting(editorInfo, functionName);
            this.getOwnerControl().setElementsValue(editorInfo.text);
            this.hideFunctionsListBoxOnFunctionInserting();
            this.getOwnerControl().getEditingHelper().updateInplaceEditingCellElementSize();
            this.getInputController().setCaretPosition(editorInfo.caretPosition);
        },
        hideFunctionsListBoxOnFunctionInserting: function() {
            this.hideFunctionsListBox();
        },
        displayPossibleFunctionNamesInListBox: function() {
            if(ASPx.Browser.Safari)
                setTimeout(function() { this.displayPossibleFunctionNamesInListBoxCore(); }.aspxBind(this), 0);
            else
                this.displayPossibleFunctionNamesInListBoxCore();
        },
        displayPossibleFunctionNamesInListBoxCore: function() {
            this.getFunctionsListBox().ChangeMainElementDisplayProperty("table");
            var editorInfo = this.getEditorInfo();
            editorInfo.caretPosition += this.getInputController().getEditorCurrentRowIndex();
            var partialFunctionNameBeforeCaret = EditorTextParser.getPartialFunctionNameBeforeCaret(editorInfo);
            this.recreateListBoxItems(partialFunctionNameBeforeCaret);
            if(this.getFunctionsListBox().GetItemCount() > 0) {
                this.hideFunctionArgumentsHint();
                this.showFunctionsListBoxAtActualPosition();
                this.getFunctionsListBox().SetSelectedIndex(0);
            }
            else
                this.hideFunctionsListBox();
        },

        recreateListBoxItems: function(partialFunctionName) {
            this.getFunctionsListBox().ClearItems();
            if(partialFunctionName)
                this.addListBoxItems(partialFunctionName);
        },
        addListBoxItems: function(partialFunctionName) {
            var partialFunctionNameForFiltering = ASPx.Str.PrepareStringForFilter(partialFunctionName);
            this.getFunctionsListBox().AddFunctionItemsByFilter(function(currentFunction) {
                var functionNameForFiltering = ASPx.Str.PrepareStringForFilter(currentFunction.name);
                return functionNameForFiltering.indexOf(partialFunctionNameForFiltering) === 0;
            });
        },
        performNavigationInListBox: function(evt) {
            var keyCode = ASPx.Evt.GetKeyCode(evt);
            if(keyCode === ASPx.Key.Up)
                this.getFunctionsListBox().OnArrowUp();
            if(keyCode === ASPx.Key.Down)
                this.getFunctionsListBox().OnArrowDown();
            if(keyCode === ASPx.Key.PageUp)
                this.getFunctionsListBox().OnPageUp();
            if(keyCode === ASPx.Key.PageDown)
                this.getFunctionsListBox().OnPageDown();
            /*return*/ ASPx.Evt.PreventEventAndBubble(evt); // TODO
        },
        showFunctionArgumentsHint: function(spreadsheetFunction) {
            var argumentsHintText = this.getFunctionArgumentsHintText(spreadsheetFunction);
            HintManager.ShowHint(this.getOwnerControl().GetMainElement(), this.getOwnerControl().name, argumentsHintText,
                this.intelliSenseElementPositionX, this.intelliSenseElementPositionY,
                this.getOwnerControl().functionArgumentsHintStyle, function(hint) {
                    return hint.offsetWidth > this.getInputController().getInplaceEditor().offsetWidth ? hint.offsetWidth - this.getInputController().getInplaceEditor().offsetWidth : 0;
                }.aspxBind(this));
        },
        hideFunctionArgumentsHint: function() {
            HintManager.HideHint(this.getOwnerControl().GetMainElement(), this.getOwnerControl().name);
        },
        showFunctionsListBoxAtActualPosition: function() {
            this.getFunctionsListBox().ShowAtPos(this.intelliSenseElementPositionX, this.intelliSenseElementPositionY);
        },
        hideFunctionsListBox: function() {
            this.getFunctionsListBox().Hide();
        },
        hideIntelliSenseElements: function() {
            this.hideFunctionsListBox();
            this.hideFunctionArgumentsHint();
        },
        isFunctionsListBoxDisplayed: function() {
            return ASPx.GetElementVisibility(this.getFunctionsListBox().GetMainElement());
        }
    });

    ASPxClientSpreadsheet.EditorTextParser = EditorTextParser;
    ASPxClientSpreadsheet.EditorInfo = EditorInfo;
    ASPxClientSpreadsheet.HintManager = HintManager;

})();
(function() {
    ASPxClientSpreadsheet.FunctionsListBoxHelper = ASPx.CreateClass(null, {
        constructor: function(listBox) {
            this.functionDescriptions = [];
            this.listBox = listBox;
            this.positionX = null;
            this.positionY = null;
        },
        showAtPos: function(mainElement, x, y) {
            ASPx.SetElementVisibility(mainElement, true);
            if(this.positionX !== x || this.positionY !== y) {
                ASPx.SetAbsoluteX(mainElement, x);
                ASPx.SetAbsoluteY(mainElement, y);
                this.positionX = x;
                this.positionY = y;
            }
        },
        addFunctionItemsByFilter: function(filter) {
            ASPx.Data.ForEach(ASPxClientSpreadsheet.Functions, function(currentFunction) {
                if(filter(currentFunction))
                    this.addFunctionItem(currentFunction);
            }.aspxBind(this));
        },
        addFunctionItem: function(spreadsheetFunction) {
            var itemIndex = this.listBox.AddItem(spreadsheetFunction.name);
            this.functionDescriptions[itemIndex] = spreadsheetFunction.description;
        },
        getDescription: function(selectedIndex) {
            return this.functionDescriptions[selectedIndex];
        },
        getMaxScrollPageSize: function() {
            return 10;
        },
        clearItems: function() {
            ASPx.Data.ArrayClear(this.functionDescriptions);
        },

        updateFunctionDescriptionHintState: function(mainElement, name, selectedIndex, selectedItemElement, functionDescriptionHintStyle) {
            var newHintText = this.getDescription(selectedIndex);
            if(newHintText === "") {
                this.hideDescription(mainElement, name);
                return;
            }
            setTimeout(function() {
                var newHintPosX = ASPx.GetAbsoluteX(mainElement) + mainElement.offsetWidth;
                var newHintPosY = ASPx.GetAbsoluteY(selectedItemElement);
                this.showDescription(mainElement, name, newHintText, newHintPosX, newHintPosY, functionDescriptionHintStyle);
            }.aspxBind(this), 0);
        },
        showDescription: function(mainElement, editorName, text, posX, posY, functionDescriptionHintStyle) {
            ASPxClientSpreadsheet.HintManager.ShowHint(mainElement.parentNode,
                editorName, text, posX, posY, functionDescriptionHintStyle, function(hint) {
                    return mainElement.offsetWidth + hint.offsetWidth + ASPx.GetLeftRightMargins(hint);
                }.aspxBind(this));
        },
        hide: function(mainElement, name) {
            ASPx.SetElementDisplay(mainElement, false);
            ASPx.SetElementVisibility(mainElement, false);
            this.hideDescription(mainElement, name);
        },
        hideDescription: function(mainElement, name) {
            ASPxClientSpreadsheet.HintManager.HideHint(mainElement.parentNode, name);
        },
    });
})();

(function() {
    ASPxClientSpreadsheet.TouchEditingHelper = (function() {
        function TouchEditingHelper(spreadsheetControl) {
            this.spreadsheetControl = spreadsheetControl;
            this.floatingActionPanel = null;
        }

        TouchEditingHelper.prototype = {
            isTouchMobileDevice: function() {
                return ASPx.Browser.TouchUI && !ASPx.Browser.MSTouchUI || this.isMsTabletMode();
            },
            isMsTabletMode: function() {
                var scrollHelper = this.spreadsheetControl.getPaneManager().getScrollHelper();
                return ASPx.Browser.MSTouchUI && scrollHelper.getDeviceScrollBarWidth() == 0;
            },
            createFloatingActionPanel: function() {
                if(this.floatingActionPanel != null)
                    this.removeFloatingActionPanel();
                var workbookControl = this.spreadsheetControl.getRenderHelper().getWorkbookControl();
                this.floatingActionPanel = createChildElement(workbookControl, ASPx.SpreadsheetCssClasses.FloatingActionPanel);

                var cancelButton = createTouchButton(this.floatingActionPanel, "cancel");
                ASPx.Evt.AttachEventToElement(cancelButton, ASPx.TouchUIHelper.touchMouseUpEventName, function() {
                    this.spreadsheetControl.getStateController().onEscape();
                }.aspxBind(this));

                var applyButton = createTouchButton(this.floatingActionPanel, "apply");
                ASPx.Evt.AttachEventToElement(applyButton, ASPx.TouchUIHelper.touchMouseUpEventName, function() {
                    this.spreadsheetControl.getStateController().applyEditingWithRaisingEvent();
                }.aspxBind(this));

                this.updateFloatingActionPanelPosition();
            },
            updateFloatingActionPanelPosition: function() {
                if(this.floatingActionPanel) {
                    var workbookControl = this.spreadsheetControl.getRenderHelper().getWorkbookControl();
                    var workbookControlBounds = workbookControl.getBoundingClientRect();
                    var styles = {
                        top: 0,
                        right: 0,
                        marginTop: ""
                    };
                    var rowHeadersHeight = this.spreadsheetControl.getRenderHelper().getColumnHeader().offsetHeight;
                    if(workbookControlBounds.top < 0) {
                        styles.top = -workbookControlBounds.top;
                        if(workbookControlBounds.top < -rowHeadersHeight)
                            styles.marginTop = 2;
                        else
                            styles.marginTop = rowHeadersHeight + workbookControlBounds.top;
                    }
                    if(workbookControlBounds.left > window.innerWidth)
                        styles.right = workbookControlBounds - window.innerWidth;
                    ASPx.SetStyles(this.floatingActionPanel, styles);
                }
            },
            removeFloatingActionPanel: function() {
                if(this.floatingActionPanel) {
                    var workbookControl = this.spreadsheetControl.getRenderHelper().getWorkbookControl();
                    workbookControl.removeChild(this.floatingActionPanel);
                    this.floatingActionPanel = null;
                }
            }
        };

        function createTouchButton(panel, buttonType) {
            var className = ASPx.SpreadsheetCssClasses.FloatingActionPanelButton;
            switch(buttonType) {
                case "apply":
                    className += " " + ASPx.SpreadsheetCssClasses.FloatingActionApplyButton;
                    break;
                case "cancel":
                    className += " " + ASPx.SpreadsheetCssClasses.FloatingActionCancelButton;
                    break;
            }

            var touchButton = createChildElement(null, className);
            var container = createChildElement(touchButton, ASPx.SpreadsheetCssClasses.FloatButtonImage);
            createChildElement(container, ASPx.SpreadsheetCssClasses.FloatButtonStem);
            createChildElement(container, ASPx.SpreadsheetCssClasses.FloatButtonKick);
            panel.appendChild(touchButton);

            return touchButton;
        }

        function createChildElement(parentElement, childClassName) {
            var childElement = document.createElement("DIV");
            childElement.className = childClassName;
            if(parentElement)
                parentElement.appendChild(childElement);
            return childElement;
        }

        return TouchEditingHelper;
    })();
})();
(function() {
    var DYNAMIC_COLORS_COUNT = 7;

    var originalEditorContentLeft,
        originalEditorContentRight,
        originalEditorRange,
        cachedTextPosition,
        selectionMode,
        activeDynamicSelection,
        activeSelectionIndex,
        caretPosition,
        isMarkerEditing,
        currentCellLayoutInfo,
        activeRangeTextLength,
        startCellLayoutInfo,
        focusedNode,
        processingAllowed;

    ASPxClientSpreadsheet.DynamicSelectionHelper = ASPx.CreateClass(null, {
        constructor: function(spreadsheet) {
            this.dynamicSelections = [];
            this.spreadsheet = spreadsheet;
            this.mode = ASPxClientSpreadsheet.DynamicSelectionHelper.Mode.Frame;
            this.appendSheetNameToRange = false;
            this.ownerSheetProperties = null;
        },

        getOwnerControl: function() {
            return this.spreadsheet;
        },
        getInputController: function() {
            return this.getOwnerControl().getInputController();
        },
        getSelectionHelper: function() {
            return this.getOwnerControl().getSelectionHelper();
        },
        isInEditorMode: function() {
            return this.mode === ASPxClientSpreadsheet.DynamicSelectionHelper.Mode.Editor;
        },
        needToAppendSheetNameToRange: function() {
            return this.appendSheetNameToRange;
        },

        attach: function() {
            this.mode = ASPxClientSpreadsheet.DynamicSelectionHelper.Mode.Frame;
            this.appendSheetNameToRange = false;
            this.clean();
            this.render();
        },

        attachToInput: function(editorElement) {
            this.mode = ASPxClientSpreadsheet.DynamicSelectionHelper.Mode.Editor;
            this.appendSheetNameToRange = true;
            this.editorElement = editorElement;
            this.render();
        },

        detach: function() {
            this.mode = ASPxClientSpreadsheet.DynamicSelectionHelper.Mode.Frame;
            this.appendSheetNameToRange = false;
            this.editorElement = null;
            this.clean();
        },

        activate: function(cellLayoutInfo, rangeEditMode) {
            processingAllowed = false;
            selectionMode = rangeEditMode;

            if(this.needToExpandRange() && this.appendRangeMode())
                this.startNewSelection();

            var cachedglobalCaretPosition,
                cachedselection,
                cachedrange;
            if(!this.isInEditorMode()) {
                cachedglobalCaretPosition = this.getInputController().getCaretPosition();
                cachedselection = ASPx.Browser.IE ? ASPx.CloneObject(this.getInputController().getSelection()) : this.getInputController().getSelection();
                cachedrange = this.getInputController().getSelection().getRangeAt(0);
            }
            window.setTimeout(function() {
                this.onActivateRangeEditing(cellLayoutInfo, cachedselection, cachedrange, cachedglobalCaretPosition);
            }.aspxBind(this), 0);
        },

        onActivateRangeEditing: function(cellLayoutInfo, selection, range, globalCaretPosition) {
            if(isMarkerEditing || this.needToExpandRange()) {
                startCellLayoutInfo = startCellLayoutInfo || cellLayoutInfo;
                this.expandRange(cellLayoutInfo);
            } else
                startCellLayoutInfo = cellLayoutInfo;
            var textPosition = {}, text;
            if(activeDynamicSelection) {
                if(cachedTextPosition && !(isMarkerEditing || this.needToExpandRange()))
                    textPosition = cachedTextPosition;
                else {
                    textPosition = activeDynamicSelection.selection.range.textPosition;
                    if(this.appendRangeMode())
                        cachedTextPosition = textPosition;
                }
            }
            else {
                var start = 0;
                if(this.isInEditorMode())
                    start = ASPx.Selection.GetCaretPosition(this.editorElement);
                else {
                    if(ASPx.Browser.IE || ASPx.Browser.Edge)
                        start = globalCaretPosition;
                    else
                        start = this.getInputController().getCaretPosition();
                }
                textPosition = { start: start, length: 0 };
            }
            if(this.isInEditorMode()) {
                text = this.editorElement.value;
                originalEditorContentLeft = text.substr(0, textPosition.start);
                originalEditorContentRight = text.substr(textPosition.start + textPosition.length);
                originalEditorRange = text.substr(textPosition.start, textPosition.length);
                caretPosition = textPosition.start;
            } else {
                var selectionParams;
                if(ASPx.Browser.IE || ASPx.Browser.Edge)
                    selectionParams = this.getInputController().getNodeByCaretPosition(textPosition.start, selection, range);
                else
                    selectionParams = this.getInputController().getNodeByCaretPosition(textPosition.start);

                var targetNode = selectionParams.targetNode;

                caretPosition = selectionParams.caretPosition;

                text = targetNode.nodeValue || targetNode.textContent;
                originalEditorContentLeft = text.substr(0, caretPosition);
                originalEditorContentRight = text.substr(caretPosition + textPosition.length);
                originalEditorRange = text.substr(caretPosition, textPosition.length);
                focusedNode = targetNode;
            }
            processingAllowed = true;
            this.updateActiveSelection(cellLayoutInfo);
        },

        deactivate: function() {
            if(this.isInEditorMode()) {
                ASPx.Selection.SetCaretPosition(this.editorElement, caretPosition + activeRangeTextLength);
                this.editorElement.focus();
            } else {
                this.getInputController().captureFocus();
                this.getInputController().setCaretPositionToNode(focusedNode, caretPosition + activeRangeTextLength);
            }
            this.cleanCachedParameters();
        },

        render: function() {
            var selections = this.parseFormula(),
                dynamicSelection,
                colorIndex = 0,
                currentIndex = 0,
                that = this;

            this.dynamicSelections = [];
            activeDynamicSelection = null;

            ASPx.Data.ForEach(selections, function(selection) {
                dynamicSelection = new ASPxClientSpreadsheet.DynamicSelection(that.spreadsheet, colorIndex++, markerMouseDownHandler);
                selection.range = that.getSelectionHelper().ExpandRangeToMergedCellSize(selection.range);

                dynamicSelection.setSelection(selection);
                dynamicSelection.render();

                that.dynamicSelections.push(dynamicSelection);

                if(selection.range.isHighlighted) {
                    activeDynamicSelection = dynamicSelection;
                    if(currentIndex !== activeSelectionIndex) {
                        activeSelectionIndex = currentIndex;
                        that.activeSelectionChanged();
                    }
                }

                if(colorIndex === DYNAMIC_COLORS_COUNT) {
                    colorIndex = 0;
                }

                currentIndex++;
            });
        },

        refresh: function() {
            this.clean();
            this.render();
        },

        startNewSelection: function() {
            this.cleanCachedParameters();
            startCellLayoutInfo = null;
            this.getInputController().setTextAsHtml("=");
            this.getInputController().onEditorElementValueChange();
        },

        cleanCachedParameters: function() {
            isMarkerEditing = false;
            caretPosition = 0;
            originalEditorContentLeft = "";
            originalEditorContentRight = "";
            activeRangeTextLength = 0;
            currentCellLayoutInfo = null;
            focusedNode = null;
        },

        needToExpandRange: function() {
            return (selectionMode & ASPxClientSpreadsheet.DynamicSelectionHelper.DynamicSelectionKeys.ShiftKey) != 0;
        },

        appendRangeMode: function() {
            return (selectionMode & ASPxClientSpreadsheet.DynamicSelectionHelper.DynamicSelectionKeys.CtrlKey) != 0;
        },

        isAttachedToDialog: function() {
            return this.isInEditorMode();
        },

        parseFormula: function() {
            var selections = [],
                formulaParams = this.getFormulaParams();

            if(formulaParams.canParse)
                selections = ASPx.SpreadsheetFormulaParser.parse(formulaParams.formula, this.getFormulaOwnerSheetName(), formulaParams.caretPosition, this.getDefaultCellOwner());

            return selections;
        },

        getRangesFromFormula: function() {
            var selections = [],
                formulaParams = this.getFormulaParams();

            if(formulaParams.canParse)
                selections = ASPx.SpreadsheetFormulaParser.getRangesFromFormula(formulaParams.formula, formulaParams.caretPosition);

            return selections;
        },

        getFormulaParams: function() {
            var formulaCaretPosition = caretPosition || this.getInputController().getCaretPosition(),
                formula = (this.editorElement && this.editorElement.value) || this.getInputController().getOnlyText(),
                canParseFormula = formula && (formula[0] === "=" || this.isInEditorMode());

            return { formula: formula, caretPosition: formulaCaretPosition, canParse: canParseFormula };
        },

        activeSelectionChanged: function() {
            cachedTextPosition = null;
        },

        updateActiveSelection: function(cellLayoutInfo) {
            this.processCellSelection(cellLayoutInfo);
        },

        expandRange: function(cellLayoutInfo) {
            if(!activeDynamicSelection) return;
            var modelRange = activeDynamicSelection.selection.range;
            currentCellLayoutInfo = cellLayoutInfo;
            if(isMarkerEditing) {
                this.correctMarkerCellLayoutInfo(cellLayoutInfo, modelRange);
                this.correctMarkerStartCellLayoutInfo(cellLayoutInfo, modelRange);
            }
        },

        correctMarkerCellLayoutInfo: function(cellLayoutInfo, modelRange) {
            if(cellLayoutInfo.colIndex < modelRange.leftColIndex)
                cellLayoutInfo.colIndex = modelRange.leftColIndex;
            if(cellLayoutInfo.colIndex > modelRange.rightColIndex)
                cellLayoutInfo.colIndex = modelRange.rightColIndex;

            if(cellLayoutInfo.rowIndex < modelRange.topRowIndex)
                cellLayoutInfo.rowIndex = modelRange.topRowIndex;
            if(cellLayoutInfo.rowIndex > modelRange.bottomRowIndex)
                cellLayoutInfo.rowIndex = modelRange.bottomRowIndex;
        },

        correctMarkerStartCellLayoutInfo: function(cellLayoutInfo, modelRange) {
            if(modelRange.leftColIndex === cellLayoutInfo.colIndex)
                startCellLayoutInfo.colIndex = modelRange.rightColIndex;
            else
                startCellLayoutInfo.colIndex = modelRange.leftColIndex;

            if(modelRange.topRowIndex === cellLayoutInfo.rowIndex)
                startCellLayoutInfo.rowIndex = modelRange.bottomRowIndex;
            else
                startCellLayoutInfo.rowIndex = modelRange.topRowIndex;
        },

        processCellSelection: function(cellLayoutInfo) {
            if(!startCellLayoutInfo || !processingAllowed || this.isCurrentlyEditingCellSelection(cellLayoutInfo))
                return;

            currentCellLayoutInfo = cellLayoutInfo;
            var rangeText = (this.appendRangeMode()) ? originalEditorRange + this.getRangeSeparatorIfNeeded(originalEditorRange) : "";
            rangeText += this.needToAppendSheetNameToRange() ? this.getSheetName() + "!" : "";
            rangeText += getRangeText(currentCellLayoutInfo, startCellLayoutInfo);
            this.setEditorValue(rangeText);
            activeRangeTextLength = rangeText.length;
            if(!this.appendRangeMode() || isMarkerEditing)
                cachedTextPosition = null;
            if(cachedTextPosition)
                cachedTextPosition.length = rangeText.length;

            this.refresh();
        },

        getRangeSeparatorIfNeeded: function(originalRange) {
            if(originalRange.indexOf(ASPxClientSpreadsheet.Range.UNION_OPERATOR) !== originalRange.length - 1)
                return ASPxClientSpreadsheet.Range.UNION_OPERATOR;
            return "";
        },

        isCurrentlyEditingCellSelection: function(cellLayoutInfo) {
            var selection = this.getOwnerControl().getSelectionInternal();
            var paneManager = this.getOwnerControl().getPaneManager();
            return selection.activeCellColIndex === paneManager.convertModelIndexToVisibleIndex(cellLayoutInfo.colIndex, true)
                && selection.activeCellRowIndex === paneManager.convertModelIndexToVisibleIndex(cellLayoutInfo.rowIndex);
        },

        setEditorValue: function(rangeText) {
            var activeEditor = this.editorElement || this.getInputController().getEditableDocument();
            if(originalEditorContentLeft === "")
                rangeText = "=" + rangeText;

            if(this.isInEditorMode()) {
                activeEditor.value = originalEditorContentLeft + rangeText + originalEditorContentRight;
                ASPx.Evt.DispatchEvent(activeEditor, "input", false, false);
            }
            else {
                var container = this.getInputController().getContentContainer(),
                    newNode = document.createTextNode(originalEditorContentLeft + rangeText + originalEditorContentRight);

                if(focusedNode) {
                    container.replaceChild(newNode, focusedNode);
                    focusedNode = newNode;
                }
                this.getInputController().onEditorElementValueChange();
            }
        },

        getDefaultCellOwner: function() {
            if(!this.ownerSheetProperties)
                return "";
            return this.ownerSheetProperties.name;
        },

        getFormulaOwnerSheetName: function() {
            return this.getSheetName();
        },

        getSheetName: function() {
            return this.getSheetNameForFormulas(this.getOwnerControl().getDocumentModel().getActiveSheetName());
        },

        getActiveEditor: function() {
            return this.editorElement;
        },

        clean: function() {
            var selection;

            while(selection = this.dynamicSelections.pop()) {
                selection.dispose();
            }
        },

        activateFullRangeName: function() {
            this.appendSheetNameToRange = true;
        },
        deactivateFullRangeName: function() {
            this.appendSheetNameToRange = false;
        },
        activateCrossSheetMode: function(sheetName, sheetId) {
            this.activateFullRangeName();

            this.ownerSheetProperties = {};
            this.ownerSheetProperties.id = sheetId;
            this.ownerSheetProperties.name = this.getSheetNameForFormulas(sheetName);
        },
        deactivateCrossSheetMode: function() {
            this.deactivateFullRangeName();
            this.ownerSheetProperties = null;
        },

        changeActiveRange: function() {
            var selection = this.getHighlightSelection();
            if(selection) {
                var formula = this.getInputController().getOnlyText(),
                    focusedNode = this.getFocusedNode(),
                    activeFormulaRange = formula.substr(selection.range.textPosition.start, selection.range.textPosition.length);

                var formulaSheetName = this.getSheetNameFromRange(activeFormulaRange),
                    activeSheetName = this.getOwnerControl().getDocumentModel().getActiveSheetName();
                
                if(formulaSheetName !== activeSheetName) {
                    formulaSheetName = formulaSheetName.indexOf(" ") >= 0 ? "'" + formulaSheetName + "'" : formulaSheetName;
                    activeSheetName = activeSheetName.indexOf(" ") >= 0 ? "'" + activeSheetName + "'" : activeSheetName;

                    if(formulaSheetName === "")
                        activeFormulaRange = activeSheetName + "!" + activeFormulaRange;
                    else
                        activeFormulaRange = activeFormulaRange.replace(formulaSheetName, activeSheetName);

                    var leftFormulaText = formula.substr(0, selection.range.textPosition.start),
                        rightFormulaText = formula.substr(selection.range.textPosition.start + selection.range.textPosition.length);

                    var newText = leftFormulaText + activeFormulaRange + rightFormulaText;

                    var container = this.getInputController().getContentContainer(),
                        newNode = document.createTextNode(newText);

                    if(focusedNode) {
                        container.replaceChild(newNode, focusedNode);
                        focusedNode = newNode;
                    }
                    this.getInputController().onEditorElementValueChange();
                    this.getInputController().setCaretPositionToNode(focusedNode, selection.range.textPosition.start + activeFormulaRange.length);
                }
            }
            this.refresh();
        },

        getHighlightSelection: function() {
            var selections = this.getRangesFromFormula(),
                len = selections.length;
            while(len--)
                if(selections[len].range.isHighlighted)
                    return selections[len];
            return null;
        },

        getSheetNameFromRange: function(range) {
            range = range.trim();
            if(range.indexOf("=") === 0)
                range = range.substr(1);
            var rawSheetName = range.substr(0, range.indexOf("!"));
            if(rawSheetName && rawSheetName !== "") {
                if(rawSheetName.indexOf("'") === 0)
                    rawSheetName = rawSheetName.substr(1, rawSheetName.length - 2);
            }
            return rawSheetName;
        },

        getFocusedNode: function() {
            var caretPosition = this.getInputController().getCaretPosition(),
                selection = ASPx.Browser.IE ? ASPx.CloneObject(this.getInputController().getSelection()) : this.getInputController().getSelection(),
                range = selection.getRangeAt(0),
                selectionParams,
                start = 0;

            if(ASPx.Browser.IE || ASPx.Browser.Edge)
                start = caretPosition;
            else
                start = this.getInputController().getCaretPosition();

            if(ASPx.Browser.IE || ASPx.Browser.Edge)
                selectionParams = this.getInputController().getNodeByCaretPosition(start, selection, range);
            else
                selectionParams = this.getInputController().getNodeByCaretPosition(start);

            return selectionParams.targetNode;
        },

        getSheetNameForFormulas: function(sheetName) {
            if(sheetName.indexOf(' ') >= 0)
                sheetName = "'" + sheetName + "'";

            return sheetName;
        },

        getOwnerSheetId: function() {
            if(this.ownerSheetProperties)
                return this.ownerSheetProperties.id;
            return -1;
        }
    });

    ASPxClientSpreadsheet.DynamicSelectionHelper.DynamicSelectionKeys = {
        None: 0,
        CtrlKey: 1,
        ShiftKey: 2,
        All: 3
    };

    ASPxClientSpreadsheet.DynamicSelectionHelper.Mode = {
        Frame: 0,
        Editor: 1
    };

    function markerMouseDownHandler(dynamicSelection) {
        if(activeDynamicSelection) activeDynamicSelection.setHighlighted(false);
        activeDynamicSelection = dynamicSelection;
        activeDynamicSelection.setHighlighted(true);

        isMarkerEditing = true;
        processingAllowed = false;
    }

    function getRangeText(currentCellLayoutInfo, startCellLayoutInfo) {
        if(currentCellLayoutInfo.colIndex === startCellLayoutInfo.colIndex &&
            currentCellLayoutInfo.rowIndex === startCellLayoutInfo.rowIndex) {
            return ASPxClientSpreadsheet.CellHelper.getColumnStringRepresentaion(currentCellLayoutInfo.colIndex) + (currentCellLayoutInfo.rowIndex + 1);
        }
        else {
            var indexes = getStartEndIndexes(currentCellLayoutInfo, startCellLayoutInfo);

            return ASPxClientSpreadsheet.CellHelper.getColumnStringRepresentaion(indexes.startCol) + (indexes.startRow + 1) + ":" +
                ASPxClientSpreadsheet.CellHelper.getColumnStringRepresentaion(indexes.endCol) + (indexes.endRow + 1);
        }
    }

    function getStartEndIndexes(currentCLI, startCLI) {
        return {
            startCol: startCLI.colIndex < currentCLI.colIndex ? startCLI.colIndex : currentCLI.colIndex,
            startRow: startCLI.rowIndex < currentCLI.rowIndex ? startCLI.rowIndex : currentCLI.rowIndex,
            endCol: startCLI.colIndex > currentCLI.colIndex ? startCLI.colIndex : currentCLI.colIndex,
            endRow: startCLI.rowIndex > currentCLI.rowIndex ? startCLI.rowIndex : currentCLI.rowIndex
        };
    }

    ASPxClientSpreadsheet.DynamicSelectionHelper.getRangeText = getRangeText;
})();

/*# using DevExpress.Web.Scripts; #*/
/*# namespace DevExpress.Web.ASPxSpreadsheet.Scripts #*/

(function() {
    ASPxClientSpreadsheet.RibbonManager = function(spreadsheetControl) {
        var commandHelper;
        var historyOperation = { canRedo: undefined, canUndo: undefined };
        this.spreadsheetControl = spreadsheetControl;        
        this.containingTable = null;
        this.intersectingTable = null;
        this.isSelectionWithinAnyTable = false;
        this.isPictureSelected = false;
        this.isChartSelected = false;
        this.itemCache = {};
        var tablePropertiesMask = {
            FILTERED_OR_SORTED: 1,
            HEADER_ROW: 2,
            TOTAL_ROW: 4,
            BANDED_COLUMNS: 8,
            BANDED_ROWS: 16,
            FIRST_COLUMN: 32,
            LAST_COLUMN: 64,
            FILTER_ENABLED: 128
        };

        // Helpers
        function getRibbonControl() {
            return spreadsheetControl.GetRibbon();
        }
        function getCommandHelper() {
            if(!commandHelper)
                commandHelper = new ASPxClientSpreadsheet.Commands.CommandHelper(spreadsheetControl);
            return commandHelper;
        }

        // Active cell changed
        function activeCellChanged() {
            applyCellContextToRibbon();
        }
        function applyCellContextToRibbon() {
            var ribbon = getRibbonControl(),
                currentCellContext = getCellFormatContext();

            if(ribbon) {
                var item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatFontBold").id);
                if(item)
                    item.SetValue(currentCellContext.isTextBold);

                item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatFontItalic").id);
                if(item)
                    item.SetValue(currentCellContext.isTextItalic);

                item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatFontUnderline").id);
                if(item)
                    item.SetValue(currentCellContext.isTextUnderlined);

                item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatFontStrikeout").id);
                if(item)
                    item.SetValue(currentCellContext.isTextStriked);

                item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatFontSize").id);
                if(item)
                    item.SetValue(currentCellContext.fontSize);

                item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatFontName").id);
                if(item)
                    item.SetValue(currentCellContext.fontName);

                item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatWrapText").id);
                if(item)
                    item.SetValue(currentCellContext.isTextWrapped);

                applyVerticalAlignContext(ribbon, currentCellContext.verticalTextAlign);
                applyHorizontalAlignContext(ribbon, currentCellContext.horizontalTextAlign);
                applyLinkContext(ribbon, currentCellContext.isCellContainsLink);

                if(spreadsheetControl.isCellSelection())
                    applyComment();
            }
        }
        function applyVerticalAlignContext(ribbon, verticalAlign) {
            var itemTop = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatAlignmentTop").id),
                itemBottom = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatAlignmentBottom").id),
                itemMiddle = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatAlignmentMiddle").id);

            uncheckButtons(itemTop, itemMiddle, itemBottom);
            switch(verticalAlign) {
                case 'auto':
                case 'baseline':
                case 'top':
                    if(itemTop)
                        itemTop.SetValue(true);
                    break;
                case 'middle':
                    if(itemMiddle)
                        itemMiddle.SetValue(true);
                    break;
                case 'bottom':
                    if(itemBottom)
                        itemBottom.SetValue(true);
                    break;
            }
        }
        function applyHorizontalAlignContext(ribbon, horizontalAlign) {
            var itemLeft = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatAlignmentLeft").id),
                itemRight = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatAlignmentRight").id),
                itemCenter = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatAlignmentCenter").id);

            uncheckButtons(itemLeft, itemCenter, itemRight);
            switch(horizontalAlign) {
                case 'right':
                    if(itemRight)
                        itemRight.SetValue(true);
                    break;
                case 'center':
                    if(itemCenter)
                        itemCenter.SetValue(true);
                    break;
                case 'left':
                    if(itemLeft)
                        itemLeft.SetValue(true);
                    break;
            }
        }
        function applyLinkContext(ribbon, isCellContainsLink) {
            var item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatClearHyperlinks").id);
            if(item)
                item.SetEnabled(isCellContainsLink);

            item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatRemoveHyperlinks").id);
            if(item)
                item.SetEnabled(isCellContainsLink);

            var commandId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("InsertHyperlink").id;
            item = ribbon.GetItemByName(commandId);
            if(item) {
                var pivotTableContext = getCellPivotTableContext();
                if(spreadsheetControl.isSheetLocked()) {
                    var isCommandEnabled = getCommandHelper().GetEnabled(commandId);
                    item.SetEnabled(isCommandEnabled && !pivotTableContext.isPivotTableSelected);
                } else {                    
                    item.SetEnabled(!pivotTableContext.isPivotTableSelected);
                }
            }
        }
        function applyComment() {
            var ribbon = getRibbonControl(),
                cellModelPosition = spreadsheetControl.getActiveCellModelPosition(),
                commentValue = spreadsheetControl.GetCellComment(cellModelPosition.colIndex, cellModelPosition.rowIndex),
                isCommentExist = commentValue !== null,
                baseCommandId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("CommentInsert").id,
                commentApiEnabled = getCommandHelper().GetEnabled(baseCommandId);

            var item = ribbon.GetItemByName(baseCommandId);
            if(item)
                item.SetEnabled(!isCommentExist && commentApiEnabled);

            item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("ReviewEditComment").id);
            if(item)
                item.SetEnabled(isCommentExist && commentApiEnabled);

            item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("ReviewDeleteComment").id);
            if(item)
                item.SetEnabled(isCommentExist && commentApiEnabled);

            item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("ReviewShowHideComment").id);
            if(item)
                item.SetEnabled(isCommentExist && commentApiEnabled);
        }
        function uncheckButtons(itemTopOrLeft, itemMiddleOrCenter, itemBottomOrRight) {
            if(itemTopOrLeft)
                itemTopOrLeft.SetValue(false);
            if(itemMiddleOrCenter)
                itemMiddleOrCenter.SetValue(false);
            if(itemBottomOrRight)
                itemBottomOrRight.SetValue(false);
        }

        this.refreshFontSize = function() {
            var ribbon = getRibbonControl();
            if(ribbon) {
                var cellFontContext = getCellFontContext(),
                    item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatFontSize").id);
                if(item)
                    item.SetValue(cellFontContext.fontSize);
            }
        };
        this.refreshFontName = function() {
            var ribbon = getRibbonControl();
            if(ribbon) {
                var cellFontContext = getCellFontContext(),
                    item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatFontName").id);
                if(item)
                    item.SetValue(cellFontContext.fontName);
            }
        };

        // Cell Format Context
        function getDefaultCellContext() {
            var context = {
                isTextBold: false,
                isTextItalic: false,
                isTextUnderlined: false,
                isTextStriked: false,
                isTextWrapped: false,

                fontName: "Calibri",
                fontSize: 11,

                verticalTextAlign: "",
                horizontalTextAlign: "",

                isCellContainsLink: false
            };
            return context;
        }

        function combineContexts(sourceContext, targetContext) {
            for(var property in sourceContext) {
                if(sourceContext.hasOwnProperty(property)) {
                    if(targetContext.hasOwnProperty(property))
                        targetContext[property] = targetContext[property] || sourceContext[property];
                    else
                        targetContext[property] = sourceContext[property];
                }
            }
            return targetContext;
        }

        function getCellFormatContext(context) {
            var currentContext = typeof (context) === "undefined" ? getDefaultCellContext() : combineContexts(context, getDefaultCellContext()),
                cellContainer = spreadsheetControl.getRenderHelper().getActiveCellElement();

            if(cellContainer) {
                var textBoxContainer = ASPx.GetNodeByClassName(cellContainer, ASPx.SpreadsheetCssClasses.TextBoxContent),
                    textBoxWrapperContainer = ASPx.GetNodeByClassName(cellContainer, ASPx.SpreadsheetCssClasses.MultylineTextContainer);
                if(textBoxContainer) {
                    var textBoxContainerStyle = ASPx.GetCurrentStyle(textBoxContainer);
                    if(textBoxContainerStyle) {
                        if(textBoxWrapperContainer) {
                            var textBoxWrapperContainerStyle = ASPx.GetCurrentStyle(textBoxWrapperContainer);
                            currentContext.verticalTextAlign = textBoxWrapperContainerStyle.verticalAlign.toLowerCase();
                        } else
                            currentContext.verticalTextAlign = textBoxContainerStyle.verticalAlign.toLowerCase();

                        currentContext.horizontalTextAlign = textBoxContainerStyle.textAlign.toLowerCase();

                        currentContext.isCellContainsLink = doesCellContainsHyperLink(cellContainer);
                        if(currentContext.isCellContainsLink) {
                            var linkContainer = getCellHyperLink(cellContainer);
                            textBoxContainerStyle = ASPx.GetCurrentStyle(linkContainer);
                        }

                        currentContext.isTextBold = checkFontBold(textBoxContainerStyle.fontWeight);
                        currentContext.isTextItalic = textBoxContainerStyle.fontStyle === 'italic';
                        currentContext.isTextUnderlined = textBoxContainerStyle.textDecoration.indexOf('underline') !== -1;
                        currentContext.isTextStriked = textBoxContainerStyle.textDecoration.indexOf('line-through') !== -1;
                        currentContext.fontSize = getFontSize(textBoxContainerStyle.fontSize);
                        currentContext.fontName = getFontName(textBoxContainerStyle.fontFamily);
                    }
                    currentContext.textWrap = ASPx.ElementContainsCssClass(textBoxContainer, "wrap");
                }
            }
            return currentContext;
        }

        function getCellFontContext(textBoxContainerStyle) {
            var defaultContext = getDefaultCellContext(),
                currentContext = {
                    fontName: defaultContext.fontName,
                    fontSize: defaultContext.fontSize
                };
            if(!textBoxContainerStyle)
                textBoxContainerStyle = getTextBoxContainerStyle();
            if(textBoxContainerStyle) {
                currentContext.fontSize = getFontSize(textBoxContainerStyle.fontSize);
                currentContext.fontName = getFontName(textBoxContainerStyle.fontFamily);
            }
            return currentContext;
        }

        function getTextBoxContainerStyle() {
            var cellContainer = spreadsheetControl.getRenderHelper().getActiveCellElement(),
                textBoxContainerStyle = null;
            if(cellContainer) {
                var textBoxContainer = ASPx.GetNodeByClassName(cellContainer, ASPx.SpreadsheetCssClasses.TextBoxContent);
                if(textBoxContainer) {
                    if(doesCellContainsHyperLink(cellContainer)) {
                        var linkContainer = getCellHyperLink(cellContainer);
                        textBoxContainerStyle = ASPx.GetCurrentStyle(linkContainer);
                    } else
                        textBoxContainerStyle = ASPx.GetCurrentStyle(textBoxContainer);

                    return textBoxContainerStyle;
                }
            }
            return textBoxContainerStyle;
        }

        function getFontName(fontName) {
            if((fontName.indexOf("'") > -1) || (fontName.indexOf('"') > -1) || (fontName.indexOf('`') > -1))
                fontName = fontName.substr(1, fontName.length - 2);
            return fontName;
        }

        function getFontSize(fontSize) {
            var size = 0;
            if(fontSize.indexOf('px') > -1)
                size = Math.round(ASPx.PixelToPoint(fontSize, false));
            else {
                if(fontSize.indexOf('p') > -1)
                    size = fontSize.substr(0, fontSize.indexOf('p'));
                else size = fontSize;
            }
            return size;
        }

        function checkFontBold(fontWeight) {
            var fontIsBold = false;
            if((ASPx.Browser.Chrome || ASPx.Browser.Opera) && ASPx.Browser.MajorVersion < 68)
                fontIsBold = fontWeight === "bold";
            else fontIsBold = parseInt(fontWeight) >= 700;
            return fontIsBold;
        }

        // Cell PivotTable Context
        function getCellPivotTableContext() {
            var currentContext = { isPivotTableSelected: false },
                selectionRange = getSelectionRange(),
                pivotTables = spreadsheetControl.getDocumentModel().getPivotTables();
            if(pivotTables.length > 0) {
                var pivotTable = pivotTables.getItemByRange(selectionRange);
                if(pivotTable)
                    currentContext.isPivotTableSelected = true;
            }

            return currentContext;
        }


        this.applyViewMode = function(viewMode) {
            if(!this.isRibbonExist()) return;
            var ribbon = getRibbonControl(),
                item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("EditingView").id),
                isInReadingView = viewMode == ASPxClientSpreadsheetViewMode.Reading;
            if(item)
                item.SetValue(!isInReadingView);

            item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("ReadingView").id);
            if(item)
                item.SetValue(isInReadingView);
        };

        function selectionRangeChanged() {
            var ribbon = getRibbonControl(),
                ribbonManager = spreadsheetControl.getRibbonManager();

            updateActiveTable();
            updateActiveDrawing();
            updateActivePivotTable();

            if(ribbon.showTabs)
                updateContextTabsVisibility(ribbon);

            if(spreadsheetControl.isCellSelection()) {
                applyTable(ribbon);
                applyPivotTable(ribbon);
            }
            if(ribbonManager.isChartSelected)
                applyChart(ribbon);
            if(ribbonManager.isPictureSelected)
                applyPicture(ribbon);
        }
        function updateContextTabsVisibility(ribbon) {
            var ribbonManager = spreadsheetControl.getRibbonManager(),
                isPivotTableContextTabsVisible = ribbonManager.containingPivotTable && ASPxClientSpreadsheet.ProtectionHelper.isPivotTableAndPivotChartsEditingAvailable(spreadsheetControl);

            ribbon.SetContextTabCategoryVisible("TableTools", ribbonManager.isSelectionWithinAnyTable);
            ribbon.SetContextTabCategoryVisible("PictureTools", ribbonManager.isPictureSelected);
            ribbon.SetContextTabCategoryVisible("ChartTools", ribbonManager.isChartSelected);
            ribbon.SetContextTabCategoryVisible("PivotTable", isPivotTableContextTabsVisible);
        }

        function updateActiveTable() {
            var ribbonManager = spreadsheetControl.getRibbonManager(),
                tableInfos = ribbonManager.tableInfos,
                selection = getSelection(),
                selectionRange = getSelectionRange();

            ribbonManager.intersectingTable = null;
            ribbonManager.containingTable = false;
            ribbonManager.isSelectionWithinAnyTable = false;

            if(selection.isCommentBoxSelected() || selection.isDrawingBoxSelection())
                return;

            ribbonManager.containingTable = findContainingTable(tableInfos, selectionRange);
            if(!ribbonManager.containingTable)
                ribbonManager.intersectingTable = findIntersectingTable(tableInfos, selectionRange);

            ribbonManager.isSelectionWithinAnyTable = !!ribbonManager.containingTable;
        }

        function updateActivePivotTable() {
            var activeCellRange = getActiveCellRange(),
                selectionRange = getSelectionRange(),
                selection = getSelection(),
                pivotTables = spreadsheetControl.getDocumentModel().getPivotTables(),
                ribbonManager = spreadsheetControl.getRibbonManager();

            ribbonManager.containingPivotTable = false;
            ribbonManager.intersectingPivotTable = false;

            if(selection.isCommentBoxSelected() || selection.isDrawingBoxSelection())
                return;

            pivotTables.forEach(findPivotTable, activeCellRange, selectionRange, ribbonManager);
        }

        function findPivotTable(pivotTable, range, selectionRange, ribbonManager) {
            ribbonManager.containingPivotTable = ribbonManager.containingPivotTable || pivotTable.containsRange(range);
            ribbonManager.intersectingPivotTable = ribbonManager.intersectingPivotTable || pivotTable.intersectsRange(selectionRange);
        }

        function applyTable(ribbon) {
            var ribbonManager = spreadsheetControl.getRibbonManager(),
                selectionContext = getTableSelectionContext(ribbonManager),
                tableCommandsIDs = ASPxClientSpreadsheet.ServerCommands.getTableCommandsIDs();

            updateContextItemsEnabledState(spreadsheetControl, ribbon, selectionContext, tableCommandsIDs);
            updateContextItemsCheckedState(ribbon, selectionContext, tableCommandsIDs);

            if(selectionContext.contextTabShown)
                updateTableNameTextBox(ribbon, ribbonManager.containingTable.name);
        }

        function applyPivotTable(ribbon) {
            var ribbonManager = spreadsheetControl.getRibbonManager(),
                insertPivotTableCommandId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("InsertPivotTable").id,
                enabled = isCommandAvailable(spreadsheetControl, insertPivotTableCommandId) && !ribbonManager.containingPivotTable;

            var item = ribbon.GetItemByName(insertPivotTableCommandId);
            if(item)
                item.SetEnabled(enabled);
            if(ribbonManager.containingPivotTable) {
                var pivotTable = spreadsheetControl.getActivePivotTable();
                if(pivotTable) {                    
                    var commandId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("ShowPivotTableFieldHeaders").id;
                    item = ribbon.GetItemByName(commandId);
                    if(item)
                        item.SetValue(pivotTable.ShowRowHeaders);

                    commandId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("PivotTableToggleRowHeaders").id;
                    item = ribbon.GetItemByName(commandId);
                    if(item)
                        item.SetValue(pivotTable.ShowRowHeaders);

                    commandId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("PivotTableToggleColumnHeaders").id;
                    item = ribbon.GetItemByName(commandId);
                    if(item)
                        item.SetValue(pivotTable.ShowColumnHeaders);

                    commandId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("PivotTableToggleBandedRows").id;
                    item = ribbon.GetItemByName(commandId);
                    if(item)
                        item.SetValue(pivotTable.ShowRowStripes);
                    
                    commandId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("PivotTableToggleBandedColumns").id;
                    item = ribbon.GetItemByName(commandId);
                    if(item)
                        item.SetValue(pivotTable.ShowColumnStripes);

                    commandId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FieldListPanelPivotTable").id;
                    item = ribbon.GetItemByName(commandId);
                    if(item) {
                        var currentDialog = spreadsheetControl.getCurrentDialog(),
                            isDialogOpened = currentDialog && currentDialog.commandId === ASPxClientSpreadsheet.ServerCommands.internalCommands.FieldListPanelPivotTable.id;
                        item.SetValue(isDialogOpened);
                    }
                }
            }
        }

        this.updatePivotTableFieldList = function() {
            var ribbon = getRibbonControl();
            if(ribbon) {
                var pivotTable = spreadsheetControl.getActivePivotTable();
                if(pivotTable) {
                    var commandId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FieldListPanelPivotTable").id,
                        item = ribbon.GetItemByName(commandId);
                    if(item) {
                        var currentDialog = spreadsheetControl.getCurrentDialog(),
                            isDialogOpened = currentDialog && currentDialog.commandId === ASPxClientSpreadsheet.ServerCommands.internalCommands.FieldListPanelPivotTable.id;
                        item.SetValue(isDialogOpened);
                    }
                }
            }
        };

        function updateActiveDrawing() {
            var ribbonManager = spreadsheetControl.getRibbonManager(),
                selection = getSelection();

            ribbonManager.isPictureSelected = false;
            ribbonManager.isChartSelected = false;

            if(selection.isDrawingBoxSelection()) {
                ribbonManager.isPictureSelected = !spreadsheetControl.getIsChartElement(selection.drawingBoxElement);
                ribbonManager.isChartSelected = !ribbonManager.isPictureSelected;
            }
        }

        function applyPicture(ribbon) {
            var ribbonManager = spreadsheetControl.getRibbonManager(),
                selectionContext = getDrawingSelectionContext(ribbonManager),
                pictureCommandsIDs = ASPxClientSpreadsheet.ServerCommands.getPictureCommandsIDs();

            updateContextItemsEnabledState(spreadsheetControl, ribbon, selectionContext, pictureCommandsIDs);
        }

        function getDrawingSelectionContext(ribbonManager) {
            return {
                isArrangeEnabled: spreadsheetControl.isArrangeCommandEnabled(),
                contextTabShown: true
            };
        }

        function getChartSelectionContext(ribbonManager) {
            var selection = getSelection(),
                chartId = selection.drawingBoxIndex,
                chartLayoutInfo = spreadsheetControl.getChartAttributeById(chartId, "LayoutProperties"),
                context = getDrawingSelectionContext(ribbonManager);

            context.appliedCommandsIds = chartLayoutInfo.split(',');

            return context;
        }

        function applyChart(ribbon) {
            var ribbonManager = spreadsheetControl.getRibbonManager(),
                selectionContext = getChartSelectionContext(ribbonManager),
                chartCommandsIDs = ASPxClientSpreadsheet.ServerCommands.getChartCommandsIDs();

            updateContextItemsCheckedState(ribbon, selectionContext, chartCommandsIDs);
            updateContextItemsEnabledState(spreadsheetControl, ribbon, selectionContext, chartCommandsIDs);
        }

        function getTableSelectionContext(ribbonManager) {
            var isSelectionIntersectsTable = !!ribbonManager.intersectingTable;

            var canInsertTable = !(ribbonManager.isSelectionWithinAnyTable || isSelectionIntersectsTable || ribbonManager.intersectingPivotTable),
                canSort = ribbonManager.isSelectionWithinAnyTable || !isSelectionIntersectsTable;

            var context = {
                lockedSheet: !!spreadsheetControl.isSheetLocked(),
                readonlyMode: !!spreadsheetControl.isReadOnly(),
                lockedWorkbook: !!spreadsheetControl.isWorkbookLocked(),
                canInsertTable: canInsertTable,
                canSort: canSort,
                canToggleFilter: !isSelectionIntersectsTable,
                canFormatAsTable: !isSelectionIntersectsTable,
                isFilterEnabled: isAutoFilterEnabled(ribbonManager),
                isFilterApplied: isAutoFilterApplied(ribbonManager)
            };

            if(ribbonManager.isSelectionWithinAnyTable) {
                var properties = ribbonManager.containingTable.properties;

                context.showHeaderRow = getTableBoolProperty(properties, tablePropertiesMask.HEADER_ROW);
                context.showTotalRow = getTableBoolProperty(properties, tablePropertiesMask.TOTAL_ROW);
                context.showBandedColumns = getTableBoolProperty(properties, tablePropertiesMask.BANDED_COLUMNS);
                context.showBandedRows = getTableBoolProperty(properties, tablePropertiesMask.BANDED_ROWS);
                context.showFirstColumn = getTableBoolProperty(properties, tablePropertiesMask.FIRST_COLUMN);
                context.showLastColumn = getTableBoolProperty(properties, tablePropertiesMask.LAST_COLUMN);
                context.contextTabShown = true;
            }

            return context;
        }

        function isAutoFilterEnabled(ribbonManager) {
            if(!!ribbonManager.intersectingTable)
                return false;

            var insideTable = !!ribbonManager.containingTable,
                isTableFilterEnabled = ribbonManager.containingTable && getTableBoolProperty(ribbonManager.containingTable.properties, tablePropertiesMask.FILTER_ENABLED),
                isSheetFilterEnabled = ribbonManager.sheetFilterState.enabled;

            return insideTable ? isTableFilterEnabled : isSheetFilterEnabled;
        }
        function isAutoFilterApplied(ribbonManager) {
            if(!!ribbonManager.intersectingTable)
                return false;

            var insideTable = !!ribbonManager.containingTable,
                isTableFilterApplied = ribbonManager.containingTable && getTableBoolProperty(ribbonManager.containingTable.properties, tablePropertiesMask.FILTERED_OR_SORTED),
                isSheetFilterApplied = ribbonManager.sheetFilterState.applied;

            return insideTable ? isTableFilterApplied : isSheetFilterApplied;
        }

        function updateContextItemsEnabledState(spreadsheetControl, ribbon, context, commandsIDs) {
            var changeEnabledStateDelegate = function(commandName, commandConfig) {
                updateRibbonItemEnabledState(ribbon, commandName, getIsCommandEnabled(spreadsheetControl, commandConfig, context));
            };

            updateContextItemsState(changeEnabledStateDelegate, commandsIDs);
        }
        function updateContextItemsCheckedState(ribbon, context, commandsIDs) {
            var changeCheckedStateDelegate = function(commandName, commandConfig) {
                var isCommandVisible = !commandConfig.isContextCommand || commandConfig.isContextCommand === context.contextTabShown;

                if(isCommandVisible && (commandConfig.checked || context.appliedCommandsIds))
                    updateRibbonItemCheckedState(ribbon, commandName, getIsCommandChecked(commandConfig, context));
            };

            updateContextItemsState(changeCheckedStateDelegate, commandsIDs);
        }

        function updateContextItemsState(changeStateDelegate, commandsIDs) {
            for(var commandID in commandsIDs) {
                if(!commandsIDs.hasOwnProperty(commandID))
                    continue;

                var commandConfig = ASPxClientSpreadsheet.ServerCommands.getCommandConfigByID(commandID);

                changeStateDelegate(commandsIDs[commandID], commandConfig);
            }
        }

        function getIsCommandEnabled(spreadsheetControl, commandConfig, context) {
            var commandName = commandConfig.id + "",
                enabled = getCommandStateCore(commandConfig.enabled, context);

            if(enabled && ASPxClientSpreadsheet.ServerCommands.isCommandInternal(commandName))
                return isCommandAvailable(spreadsheetControl, commandName);

            return enabled;
        }
        function isCommandAvailable(spreadsheetControl, commandName) {
            var rejectReason = ASPxClientSpreadsheet.ProtectionHelper.isCommandAvailable(spreadsheetControl, commandName),
                isCommandEnable = rejectReason === ASPxClientSpreadsheet.ProtectionHelper.RejectReason.None;
            return isCommandEnable && spreadsheetControl.getDocumentSettings().isCommandEnabled(commandName);
        }

        function getIsCommandChecked(commandConfig, context) {
            if(context.appliedCommandsIds) {
                return context.appliedCommandsIds.indexOf('' + commandConfig.id) > -1;
            }

            return getCommandStateCore(commandConfig.checked, context);
        }

        function getCommandStateCore(stateConfig, context) {
            if(!stateConfig)
                return true;

            for(var property in stateConfig) {
                if(!(stateConfig.hasOwnProperty(property) && context.hasOwnProperty(property)))
                    continue;

                if(context[property] !== stateConfig[property])
                    return false;
            }
            return true;
        }

        function updateRibbonItemEnabledState(ribbon, commandName, enabled) {
            var item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName(commandName).id);
            if(item && item.GetEnabled() !== enabled)
                item.SetEnabled(enabled);
        }
        function updateRibbonItemCheckedState(ribbon, commandName, checked) {
            var item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName(commandName).id);
            if(item && item.GetValue() !== checked)
                item.SetValue(checked);
        }
        function updateTableNameTextBox(ribbon, tableName) {
            var item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("TableToolsRenameTable").id);
            if(item)
                item.SetValue(tableName);
        }
        function findContainingTable(tableInfos, selectionRange) {
            return findTableCore(tableInfos, selectionRange, "containsRange");
        }
        function findIntersectingTable(tableInfos, selectionRange) {
            return findTableCore(tableInfos, selectionRange, "intersectsRange");
        }
        function findTableCore(tableInfos, selectionRange, compareFn) {
            for(var i = 0; i < tableInfos.length; i++) {
                if(tableInfos[i].range[compareFn](selectionRange))
                    return tableInfos[i];
            }
            return null;
        }
        function getTableBoolProperty(properties, propertyMask) {
            return !!(properties & propertyMask);
        }
        // Selection
        function getSelection() {
            return spreadsheetControl.getStateController().getSelection();
        }
        function getSelectionRange() {
            var range = getSelection().range;
            return convertSelectionToRange(range);
        }
        function getActiveCellRange() {
            var selection = getSelection(),
                range = selection.getActiveCellRange();
            return convertSelectionToRange(range);
        }
        function convertSelectionToRange(range) {
            var paneManager = spreadsheetControl.getPaneManager();
            return paneManager.convertVisibleRangeToModel(range);
        }
        function getCellHyperLink(element) {
            if(element)
                return ASPx.GetNodeByTagName(element, "a", 0);
            return null;
        }
        function doesCellContainsHyperLink(element) {
            return ASPx.IsExists(getCellHyperLink(element));
        }
        // Editing
        function onEditModeChanged(inEditMode) {
            switchRibbonEditingMode(!inEditMode);
        }
        function switchRibbonEditingMode(enabled) {
            var ribbon = getRibbonControl();
            if(ribbon) {
                var disabledCommands = ASPxClientSpreadsheet.ServerCommands.getEditModeDisabledCommandsIDs();
                for(var commandID in disabledCommands) {
                    if(!disabledCommands.hasOwnProperty(commandID)) continue;
                    var item = ribbon.GetItemByName(commandID);
                    itemEnabled = enabled && isCommandAvailable(spreadsheetControl, commandID);

                    if(item)
                        if(item.GetEnabled() != itemEnabled)
                            item.SetEnabled(itemEnabled);
                }
            }
        }
        function restoreDisabledItems() {
            var ribbon = getRibbonControl();
            if(ribbon) {
                applyLinkContext(ribbon, doesCellContainsHyperLink(spreadsheetControl.getRenderHelper().getActiveCellElement()));
                applyHistoryNavigation(historyOperation);
                applyTabParams();
            }
        }
        function applyCalculationMode(calculationMode) {
            var ribbon = getRibbonControl(),
                item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormulasCalculationModeAutomatic").id);
            if(item)
                item.SetValue(calculationMode == ASPxClientSpreadsheet.DocumentModel.CalculationMode.Automatic);

            item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormulasCalculationModeManual").id);
            if(item)
                item.SetValue(calculationMode === ASPxClientSpreadsheet.DocumentModel.CalculationMode.Manual);
        }
        function applyPageOrientation(pageOrientation) {
            var ribbon = getRibbonControl(),
                item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("PageSetupOrientationPortrait").id);
            if(item)
                item.SetValue(pageOrientation === ASPxClientSpreadsheet.DocumentModel.PageOrientation.Portrait);

            item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("PageSetupOrientationLandscape").id);
            if(item)
                item.SetValue(pageOrientation === ASPxClientSpreadsheet.DocumentModel.PageOrientation.Landscape);
        }
        function applyPageMargins(pageMargins) {
            var ribbon = getRibbonControl(),
                item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("PageSetupMarginsNormal").id);
            if(item)
                item.SetValue(pageMargins === ASPxClientSpreadsheet.DocumentModel.PageMargin.Normal);

            item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("PageSetupMarginsNarrow").id);
            if(item)
                item.SetValue(pageMargins === ASPxClientSpreadsheet.DocumentModel.PageMargin.Narrow);

            item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("PageSetupMarginsWide").id);
            if(item)
                item.SetValue(pageMargins === ASPxClientSpreadsheet.DocumentModel.PageMargin.Wide);
        }
        function applyPaperKind(paperKind) {
            var ribbon = getRibbonControl(),
                baseCommandId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("PageSetupPaperKindCommandGroup").id,
                baseCommnadItem = ribbon.GetItemByName(baseCommandId);

            if(baseCommnadItem) {
                resetToggleSubItems(baseCommnadItem);

                var itemId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("SetPaperKind").id + ";#" + paperKind,
                    item = ribbon.GetItemByName(itemId);
                if(item)
                    item.SetValue(true);
            }            
        }
        function applyTabParams() {
            var ribbon = getRibbonControl(),
                documentModel = spreadsheetControl.getDocumentModel();

            var isHideCommandEnable = documentModel.getVisibleSheets().length > 1;
            var isUnhideCommandEnable = documentModel.getHiddenSheets().length > 0;

            var item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("UnhideSheet").id);
            if(item)
                item.SetEnabled(isUnhideCommandEnable);

            item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("HideSheet").id);
            if(item)
                item.SetEnabled(isHideCommandEnable);

            item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("RemoveSheet").id);
            if(item)
                item.SetEnabled(isHideCommandEnable);
        }
        function applyHistoryNavigation(history) {
            var ribbon = getRibbonControl();
            if(history) {
                var item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FileUndo").id);
                if(item)
                    item.SetEnabled(history.canUndo);

                item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FileRedo").id);
                if(item)
                    item.SetEnabled(history.canRedo);
            }
        }

        // Fill items
        function updateFillGroup(fillDownDisabled, fillRightDisabled) {
            var ribbon = getRibbonControl();
            var item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("EditingFillDown").id);
            if(item)
                item.SetEnabled(fillDownDisabled);

            item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("EditingFillRight").id);
            if(item)
                item.SetEnabled(fillRightDisabled);
        }
        // Ribbon state update
        function isHistoryChanged(history) {
            var canUndo = history[ASPxClientSpreadsheet.DocumentModel.History.Undo] === 1,
                canRedo = history[ASPxClientSpreadsheet.DocumentModel.History.Redo] === 1;
            return (historyOperation.canUndo !== canUndo) || (historyOperation.canRedo !== canRedo);
        }
        function updateHistory(history) {
            historyOperation.canRedo = history[ASPxClientSpreadsheet.DocumentModel.History.Redo] === 1;
            historyOperation.canUndo = history[ASPxClientSpreadsheet.DocumentModel.History.Undo] === 1;
            applyHistoryNavigation(historyOperation);
        }
        function updateCalculationMode(calcMode) {
            applyCalculationMode(calcMode);
        }
        function updatePageOrientation(pageOrientation) {
            applyPageOrientation(pageOrientation);
        }
        function updatePaperKind(paperKind) {
            applyPaperKind(paperKind);
        }
        function updatePageMargins(pageMargins) {
            applyPageMargins(pageMargins);
        }
        function updatePageLayoutPrintOptions(printOptions) {
            var ribbon = getRibbonControl(),
                showGridLines = printOptions[ASPxClientSpreadsheet.DocumentModel.PrintOptions.GridLines] === 1,
                showHeading = printOptions[ASPxClientSpreadsheet.DocumentModel.PrintOptions.Headings] === 1,
                item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("PageSetupPrintGridlines").id);

            if(item)
                item.SetValue(showGridLines);

            item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("PageSetupPrintHeadings").id);
            if(item)
                item.SetValue(showHeading);
        }
        function updateShowOptions(showGridLines, showHeadings) {
            var ribbon = getRibbonControl();
            var item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("ViewShowGridlines").id);
            if(item)
                item.SetValue(showGridLines);

            item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("ViewShowHeadings").id);
            if(item)
                item.SetValue(showHeadings);
        }
        function updateFreezePanes(isFrozen) {
            var ribbon = getRibbonControl();
            var item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FreezePanes").id);
            if(item)
                item.SetEnabled(!isFrozen);

            item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("ViewUnfreezePanes").id);
            if(item)
                item.SetEnabled(isFrozen);
        }
        function updateSaveButtonState(modified) {
            var ribbon = getRibbonControl(),
                item = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FileSave").id);
            if(item) {
                var commandName = item.name,
                    isCommandEnable = modified && spreadsheetControl.getDocumentSettings().isCommandEnabled(commandName);
                item.SetEnabled(isCommandEnable);
            }
        }
        function updateActulaBorderStyle(borderLineStyle) {
            var ribbon = getRibbonControl(),
                borderLineStyleItem = ribbon.GetItemByName(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatBorderLineStyle").id);
            if(borderLineStyleItem) {
                resetToggleSubItems(borderLineStyleItem);
                var itemId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName("FormatBorderLineStyle").id + ";#" + borderLineStyle,
                    item = ribbon.GetItemByName(itemId);
                if(item)
                    item.SetValue(true);
            }
        }
        function resetToggleSubItems(baseItem) {
            var len = baseItem.items.length;
            while(len--)
                baseItem.items[len].SetValue(false);
        }
        function updateTableInfos(ribbonManager, tableInfos) {
            var NAME_INDEX = 0,
                PROPERTIES_INDEX = 1,
                RANGE_INDEX = 2;

            ribbonManager.tableInfos = [];

            if(!tableInfos)
                return;

            ASPx.Data.ForEach(tableInfos, function(rawTableInfo) {
                ribbonManager.tableInfos.push({
                    name: rawTableInfo[NAME_INDEX],
                    properties: rawTableInfo[PROPERTIES_INDEX],
                    range: createTableRange(rawTableInfo[RANGE_INDEX])
                });
            });

        }
        function createTableRange(range) {
            return new ASPxClientSpreadsheet.Range(range[0], range[1], range[2], range[3]);
        }

        // History
        this.canRedo = function() {
            return historyOperation.canRedo;
        };
        this.canUndo = function() {
            return historyOperation.canUndo;
        };

        // Fill items
        this.onFillItemsChanged = function(fillDownDisabled, fillRightDisabled) {
            if(this.isRibbonExist()) {
                updateFillGroup(fillDownDisabled, fillRightDisabled);
            }
        };

        // Active cell
        this.onActiveCellChanged = function() {
            if(this.isRibbonExist())
                activeCellChanged();
        };

        this.onSelectionChanged = function() {
            if(this.isRibbonExist())
                selectionRangeChanged();
        };

        // Editing
        this.onEditingStarted = function() {
            if(this.canEdit() && this.isRibbonExist())
                onEditModeChanged(true);
        };
        this.onEditingStopped = function() {
            if(this.canEdit() && this.isRibbonExist()) {
                onEditModeChanged(false);
                restoreDisabledItems();
            }
        };

        // ReadOnly || LockedCell || LockedSheet
        this.onItemsEnabledChanged = function() {
            if(this.isRibbonExist()) {
                var ribbon = getRibbonControl(),
                    allEnabled = !spreadsheetControl.isReadOnly() && !spreadsheetControl.isSheetLocked() && !spreadsheetControl.isWorkbookLocked();

                if(ribbon.items) {
                    setItemsEnable(ribbon.items, allEnabled);
                    this.onActiveCellChanged();
                }
            }
        };
        // Readonly || LockedCell || LockedSheet
        function setItemsEnable(items, allEnabled) {
            if(items) {
                for(var itemID in items) {
                    if(!items.hasOwnProperty(itemID)) continue;
                    var item = items[itemID],
                        commandName = ASPxClientSpreadsheet.ServerCommands.getParentCommandId(item.name);

                    var isCommandEnabled = true;
                    if(ASPxClientSpreadsheet.ServerCommands.isCommandInternal(commandName)) {
                        // apply protection
                        isCommandEnabled = allEnabled || isCommandAvailable(spreadsheetControl, commandName);

                        item.SetEnabled(isCommandEnabled);
                    }

                    if(isCommandEnabled && item.items)
                        setItemsEnable(item.items, allEnabled);
                }
            }
        }

        this.onCellLockedStateChanged = function() {
            if(this.isRibbonExist()) {
                var ribbon = getRibbonControl();

                if(ribbon.items) {
                    updateItemsEnabledForLockedCell(ribbon.items);
                    this.onActiveCellChanged();
                }
            }
        };
        function updateItemsEnabledForLockedCell(items) {
            if(items) {
                for(var itemID in items) {
                    if(!items.hasOwnProperty(itemID)) continue;
                    var item = items[itemID],
                        commandName = ASPxClientSpreadsheet.ServerCommands.getParentCommandId(item.name);

                    if(ASPxClientSpreadsheet.ServerCommands.isCommandInternal(commandName) && ASPxClientSpreadsheet.ServerCommands.isCommandDisabledForLockedCell(commandName))
                        item.SetEnabled(isCommandAvailable(spreadsheetControl, commandName));

                    if(item.GetEnabled() && item.items)
                        updateItemsEnabledForLockedCell(item.items);
                }
            }
        }

        // Full screen mode
        this.setExternalRibbonPositionOnPageTop = function() {
            var externalRibbon = getRibbonControl();
            var ribbonMainElement = externalRibbon.GetMainElement();
            if(ribbonMainElement.style.position == "fixed")
                return;
            ASPx.Attr.ChangeStyleAttribute(ribbonMainElement, "position", "fixed");
            ASPx.Attr.ChangeStyleAttribute(ribbonMainElement, "top", "0px");
            ASPx.Attr.ChangeStyleAttribute(ribbonMainElement, "left", "0px");
            ASPx.Attr.ChangeStyleAttribute(ribbonMainElement, ASPx.Browser.IE ? "zIndex" : "z-index", 10002);

            if(ASPx.IsPercentageSize(ribbonMainElement.style.width))
                this.saveRibbonWidth = ribbonMainElement.style.width;
            else
                this.saveRibbonWidth = externalRibbon.GetWidth();

            ribbonMainElement.style.width = "100%";
            externalRibbon.AdjustControl();
            this.SetRibbonHeight(ribbonMainElement.offsetHeight);
        };
        this.restoreExternalRibbonPositionOnPage = function() {
            var externalRibbon = getRibbonControl();
            var ribbonMainElement = externalRibbon.GetMainElement();
            if(!ribbonMainElement.style.position)
                return;
            ASPx.Attr.RestoreStyleAttribute(ribbonMainElement, "left");
            ASPx.Attr.RestoreStyleAttribute(ribbonMainElement, "top");
            ASPx.Attr.RestoreStyleAttribute(ribbonMainElement, "position");
            ASPx.Attr.RestoreStyleAttribute(ribbonMainElement, ASPx.Browser.IE ? "zIndex" : "z-index");
            if(this.saveRibbonWidth) {
                if(!ASPx.IsNumber(this.saveRibbonWidth) && ASPx.IsPercentageSize(this.saveRibbonWidth))
                    ribbonMainElement.style.width = this.saveRibbonWidth;
                else
                    ribbonMainElement.style.width = this.saveRibbonWidth + "px";
                this.saveRibbonWidth = undefined;
            }
            externalRibbon.AdjustControl();
        };
        this.SetRibbonHeight = function(ribbonHeight) {
            this.saveRibbonHeight = ribbonHeight;
        };
        this.GetRibbonHeight = function() {
            return this.saveRibbonHeight;
        };
        // Drawing box
        this.onModelBoxSelecting = function() {
            if(this.isRibbonExist())
                this.onEditingStarted();
        };
        this.onModelBoxUnselecting = function() {
            this.onEditingStopped();
            if(this.isRibbonExist() && spreadsheetControl.isCellSelection())
                applyComment();
        };

        // Ribbon state update
        this.processDocumentResponse = function(response) {
            if(this.isRibbonExist()) {
                if(response.tabControlInfo)
                    applyTabParams();

                if(response[ASPxClientSpreadsheet.ResponseStringKeys.RibbonUpdate] === 1)
                    this.onActiveCellChanged();
                
                if(isHistoryChanged(response[ASPxClientSpreadsheet.ResponseStringKeys.History]) && !spreadsheetControl.isReadOnly())
                    updateHistory(response[ASPxClientSpreadsheet.ResponseStringKeys.History]);

                var calculationMode = response[ASPxClientSpreadsheet.ResponseStringKeys.Calculation];
                if(ASPx.IsExists(calculationMode))
                    updateCalculationMode(calculationMode);

                var pageOrientation = response[ASPxClientSpreadsheet.ResponseStringKeys.PageOrientation];
                if(ASPx.IsExists(pageOrientation))
                    updatePageOrientation(pageOrientation);

                var paperKind = response[ASPxClientSpreadsheet.ResponseStringKeys.PaperKind];
                if(ASPx.IsExists(paperKind))
                    updatePaperKind(paperKind);

                var pageMargins = response[ASPxClientSpreadsheet.ResponseStringKeys.PageMargins];
                if(ASPx.IsExists(pageMargins))
                    updatePageMargins(pageMargins);

                var printOptions = response[ASPxClientSpreadsheet.ResponseStringKeys.PrintOptions];
                if(!!printOptions)
                    updatePageLayoutPrintOptions(printOptions);

                var borderStyle = response[ASPxClientSpreadsheet.ResponseStringKeys.BorderStyle];
                if(ASPx.IsExists(borderStyle))
                    updateActulaBorderStyle(borderStyle);

                updateSaveButtonState(response[ASPxClientSpreadsheet.ResponseStringKeys.Modified] === 1);

                updateShowOptions(!response.gridLinesHidden, !response.hideHeaders);

                updateFreezePanes(!!response.fp);

                updateTableInfos(this, response.tableInfos);

                this.sheetFilterState = response.sheetFilterState;

                selectionRangeChanged();

                applyControlSettings();
            }
        };

        function applyControlSettings() {
            spreadsheetControl.getDocumentSettings().forEach(applyControlOptionToRibbonButton);
        }
        function applyControlOptionToRibbonButton(command, isVisible, isEnable) {
            var ribbon = getRibbonControl(),
                item = ribbon.GetItemByName(command);
            if(item) {
                if(!isEnable)
                    item.SetEnabled(isEnable);
            }
        }
        // Helpers
        this.isRibbonExist = function() {
            var ribbon = getRibbonControl();
            return ASPx.IsExists(ribbon);
        };
        this.canEdit = function() {
            return !spreadsheetControl.isReadOnly() && !spreadsheetControl.isSheetLocked();
        };

        // Update Client Command State
        this.onFullScreenCommandExecuted = function(commandId) {
            var ribbon = getRibbonControl();
            var item = ribbon.GetItemByName(commandId);
            if(item)
                item.SetValue(!spreadsheetControl.isInFullScreen());
        };

        this.showKeyTips = function() {
            if(!this.isRibbonExist()) return;
            var ribbon = getRibbonControl();
            ribbon.ShowKeyTips();
        };

        this.SubscribeCommandExecuted = function (handler, executionContext) {
            var ribbon = getRibbonControl();
            ribbon.CommandExecuted.AddHandler(handler, executionContext);
        };
        this.SubscribeMinimizationStateChanged = function (handler, executionContext) {
            var ribbon = getRibbonControl();
            ribbon.MinimizationStateChanged.AddHandler(handler, executionContext);
        };
        this.SubscribeDialogBoxLauncherClicked = function (handler, executionContext) {
            var ribbon = getRibbonControl();
            ribbon.DialogBoxLauncherClicked.AddHandler(handler, executionContext);
        };
        this.SubscribeKeyTipsClosedOnEscape = function (handler, executionContext) {
            var ribbon = getRibbonControl();
            ribbon.KeyTipsClosedOnEscape.AddHandler(handler, executionContext);
        };

        this.UnsubscribeCommandExecutedByName = function (name) {
            var ribbon = getRibbonControl();
            ribbon.CommandExecuted.removeHandlerByControlName(name);
        };
        this.UnsubscribeMinimizationStateChangedByName = function (name) {
            var ribbon = getRibbonControl();
            ribbon.MinimizationStateChanged.removeHandlerByControlName(name);
        };
        this.UnsubscribeDialogBoxLauncherClickedByName = function (name) {
            var ribbon = getRibbonControl();
            ribbon.DialogBoxLauncherClicked.removeHandlerByControlName(name);
        };
        this.UnsubscribeKeyTipsClosedOnEscapeByName = function (name) {
            var ribbon = getRibbonControl();
            ribbon.KeyTipsClosedOnEscape.removeHandlerByControlName(name);
        };


    };
})();

(function() {
    var SelectionClass = ASPxClientSpreadsheet.Selection,
        definedNames = {};

    var SpreadsheetFormulaParser = {
        getRangesFromFormula: function(formula, cursorPosition) {
            return this.parse(formula, "", cursorPosition, "");
        },

        parse: function(formula, sheetName, cursorPosition, defaultCellOwner) {
            var highlightedTerms = {
                terms: [],
                textPosition: undefined
            },
                termPositions = {},
                re = /(('[^']+'|[\w]*)[\!|\$|A-Z|\d|\:|\\|\_]+)/gi,
                term;

            while(term = re.exec(formula)) {
                var equalCorrection = formula[0] === "=" ? 1 : 0;
                if(term.index <= cursorPosition + equalCorrection && term.index + term[0].length >= cursorPosition) {
                    highlightedTerms.terms.push(term[0]);
                    highlightedTerms.textPosition = {
                        start: term.index,
                        length: term[0].length
                    };
                } else {
                    termPositions[term[0]] = {
                        start: term.index,
                        length: term[0].length
                    };
                }
            }

            // Define names support
            formula = processDefinedNames(formula);

            return parseCore(formula, parseCells, sheetName, highlightedTerms, termPositions, defaultCellOwner);
        },
        // using for bookmark navigation
        getCellRangeByCellRepresentation: function(topLeftCell, bottomRightCell) {
            var cells = [topLeftCell];
            if(bottomRightCell)
                cells.push(bottomRightCell);

            var selection = parseCells(cells);
            return selection.range;
        },
        definedNames: definedNames
    };

    function getColumnIndex(columnName) {
        var result = 0;

        for(var i = 0; i < columnName.length; i++)
            result += columnName.charCodeAt(i) - 64 + result * 25;

        return result - 1;
    }

    function compileDefinedNamesRegex() {
        var result = [];

        for(var definedName in definedNames) {
            if(definedNames.hasOwnProperty(definedName))
                result.push(definedName);
        }

        return result.length ? new RegExp(result.join("|"), "g") : null;
    }

    function getCellCoords(cellName, isRange) {
        var pureName = cellName.replace(/'|!/g, "").toUpperCase(),
            row = /(\$)?(\d+)/.exec(pureName),
            col = /(\$)?([A-Z]+)/.exec(pureName),
            result = {};

        if(row && row.length) {
            result.row = parseInt(row[2]) - 1;
            result.relative = !(row && row[1] || col && col[1]);
            if(col && col.length) {
                result.col = getColumnIndex(col[2]);
            } else if(isRange) {
                result.absolute = true;
                result.fullRow = true;
            } else {
                return false;
            }

            return result;
        } else if(isRange && col && col.length) {
            return {
                absolute: true,
                fullColumn: true,
                col: getColumnIndex(col[0])
            };
        } else {
            return false;
        }
    }

    function parseCells(cells) {
        var isRange = cells.length === 2,
            firstCell = getCellCoords(cells[0], isRange);

        if(!firstCell) {
            return;
        }

        var selection = new SelectionClass(),
            firstColumnIndex,
            firstRowIndex,
            secondColumnIndex,
            secondRowIndex;

        if(firstCell.absolute) {
            if(firstCell.fullColumn) {
                firstColumnIndex = firstCell.col;
                firstRowIndex = 0;
            } else if(firstCell.fullRow) {
                firstColumnIndex = 0;
                firstRowIndex = firstCell.row;
            } else {
                firstColumnIndex = firstCell.col - 1;
                firstRowIndex = firstCell.row - 1;
            }
        } else {
            firstColumnIndex = firstCell.col;
            firstRowIndex = firstCell.row;
        }

        if(isRange) {
            var secondCell = getCellCoords(cells[1], isRange);

            if(secondCell.fullColumn) {
                secondColumnIndex = secondCell.col;
                secondRowIndex = ASPxClientSpreadsheet.Range.MAX_ROW_COUNT;
            } else if(secondCell.fullRow) {
                secondColumnIndex = ASPxClientSpreadsheet.Range.MAX_COL_COUNT;
                secondRowIndex = secondCell.row;
            } else {
                secondColumnIndex = secondCell.col;
                secondRowIndex = secondCell.row;
            }
        }

        selection.range.set(firstColumnIndex, firstRowIndex, secondColumnIndex, secondRowIndex);

        return selection;
    }

    function parseCore(formula, cellsParser, sheetName, highlightedTerms, termPositions, defaultCellOwner) {
        var result = [],
            terms = formula.split(/=|\w+\(|\)|(?:[\,\+\-\/\*><](?!\s*\d+\s*\]))/i);

        ASPx.Data.ForEach(terms, function(term) {
            var cells = term.replace(/\s+/g, "").split(":");

            if(!(cells.length && cells[0].length && checkCellsSheet(cells, sheetName, defaultCellOwner))) {
                return;
            }

            ASPx.Data.ForEach(cells, function(cell, index) {
                cells[index] = cell.substr(cell.indexOf("!") + 1);
            });

            var parsedCells = cellsParser(cells);

            if(parsedCells) {
                if(ASPx.Data.ArrayIndexOf(highlightedTerms.terms, ASPx.Str.Trim(term)) > -1) {
                    parsedCells.range.isHighlighted = true;
                    parsedCells.range.textPosition = highlightedTerms.textPosition;
                } else {
                    parsedCells.range.textPosition = termPositions[ASPx.Str.Trim(term)];
                }
                result.push(parsedCells);
            }
        });

        return result;
    }

    function checkCellsSheet(cells, sheetName, defaultCellOwner) {
        var result = true;
        if(sheetName === undefined || sheetName === "")
            return result;

        sheetName = sheetName.replace(/\s+/g, "");
        defaultCellOwner = !!defaultCellOwner ? defaultCellOwner.replace(/\s+/g, "") : "";

        var cellParts = cells[0].split("!");

        if(cellParts.length === 2 && cellParts[0] !== sheetName) {
            result = false;
        } else if(cellParts.length === 1 && defaultCellOwner !== "" && sheetName !== defaultCellOwner)
            result = false;

        return result;
    }

    // Define names support
    function processDefinedNames(formula, baseCell) {
        var definedNamesRegex = compileDefinedNamesRegex();

        if(definedNamesRegex) {
            var rootBaseCellParsed = baseCell;

            if(!rootBaseCellParsed.row) {
                rootBaseCellParsed = getCellCoords(baseCell);
            }

            formula = formula.replace(definedNamesRegex, function(definedName) {
                var definedNameValue = definedNames[definedName],
                    compiledFormula = definedNameValue.cell,
                    baseCellParsed = getCellCoords(definedNameValue.baseCell);

                if(definedNamesRegex.test(compiledFormula)) {
                    compiledFormula = processDefinedNames(compiledFormula, baseCellParsed);
                }
                parseCore(compiledFormula, rootBaseCellParsed, function(cells) {
                    ASPx.Data.ForEach(cells, function(cell) {
                        var parsedCell = getCellCoords(cell);

                        if(parsedCell.relative && !parsedCell.r1c1Style) {
                            compiledFormula = compiledFormula.replace(cell, "R[" + (parsedCell.row - baseCellParsed.row) +
                                "]C[" + (parsedCell.col - baseCellParsed.col) + "]");
                        }
                    });
                });

                return compiledFormula;
            });
        }

        return formula;
    }

    ASPx.SpreadsheetFormulaParser = SpreadsheetFormulaParser;
})();

/*# using DevExpress.Web.Scripts; #*/
/*# namespace DevExpress.Web.ASPxSpreadsheet.Scripts #*/
(function() {
    /*# public delegate void ASPxClientSpreadsheetCellBeginEditEventHandler(object source, ASPxClientSpreadsheetCellBeginEditEventArgs e); #*/
    /*# public class ASPxClientSpreadsheetCellBeginEditEventArgs : ASPxClientCancelEventArgs #*/
    var ASPxClientSpreadsheetCellBeginEditEventArgs = ASPx.CreateClass(ASPxClientCancelEventArgs, {
        /*# public ASPxClientSpreadsheetCellBeginEditEventArgs(int columnIndex, int rowIndex, string formula, string value, string sheetName) : base() {} #*/
        constructor: function(columnIndex, rowIndex, formula, value, sheetName) {
            this.constructor.prototype.constructor.call(this);
            /*# public int columnIndex { get { return 0; } } #*/
            this.columnIndex = columnIndex;
            /*# public int rowIndex { get { return 0; } } #*/
            this.rowIndex = rowIndex;
            /*# public string formula { get { return string.Empty; } } #*/
            this.formula = formula;
            /*# public string value { get { return string.Empty; } } #*/
            this.value = value;
            /*# public string sheetName { get { return string.Empty; } } #*/
            this.sheetName = sheetName;
        }
    });

    /*# public delegate void ASPxClientSpreadsheetCellEndEditEventHandler(object source, ASPxClientSpreadsheetCellEndEditEventArgs e); #*/
    /*# public class ASPxClientSpreadsheetCellEndEditEventArgs : ASPxClientSpreadsheetCellBeginEditEventArgs #*/
    var ASPxClientSpreadsheetCellEndEditEventArgs = ASPx.CreateClass(ASPxClientSpreadsheetCellBeginEditEventArgs, {
        /*# public ASPxClientSpreadsheetCellEndEditEventArgs(int columnIndex, int rowIndex, string formula, string value, string sheetName, string editorText) : base(columnIndex, rowIndex, formula, value, sheetName) {} #*/
        constructor: function(columnIndex, rowIndex, formula, value, sheetName, editorText) {
            this.constructor.prototype.constructor.call(this, columnIndex, rowIndex, formula, value, sheetName);
            /*# public string editorText { get { return string.Empty; } set {} } #*/
            this.editorText = editorText;
        }
    });

    /*# public delegate void ASPxClientSpreadsheetCellCancelEditEventHandler(object source, ASPxClientSpreadsheetCellCancelEditEventArgs e); #*/
    /*# public class ASPxClientSpreadsheetCellCancelEditEventArgs : ASPxClientEventArgs #*/
    var ASPxClientSpreadsheetCellCancelEditEventArgs = ASPx.CreateClass(ASPxClientCancelEventArgs, {
        /*# public ASPxClientSpreadsheetCellCancelEditEventArgs(int columnIndex, int rowIndex, string formula, string value, string sheetName) : base() {} #*/
        constructor: function(columnIndex, rowIndex, formula, value, sheetName) {
            this.constructor.prototype.constructor.call(this);
            /*# public int columnIndex { get { return 0; } } #*/
            this.columnIndex = columnIndex;
            /*# public int rowIndex { get { return 0; } } #*/
            this.rowIndex = rowIndex;
            /*# public string formula { get { return string.Empty; } } #*/
            this.formula = formula;
            /*# public string value { get { return string.Empty; } } #*/
            this.value = value;
            /*# public string sheetName { get { return string.Empty; } } #*/
            this.sheetName = sheetName;
        }
    });

    window.ASPxClientSpreadsheetCellBeginEditEventArgs = ASPxClientSpreadsheetCellBeginEditEventArgs;
    window.ASPxClientSpreadsheetCellEndEditEventArgs = ASPxClientSpreadsheetCellEndEditEventArgs;
    window.ASPxClientSpreadsheetCellCancelEditEventArgs = ASPxClientSpreadsheetCellCancelEditEventArgs;
})();
(function() {
    ASPxClientSpreadsheet.ResizingHelper = (function() {
        var capturedEntityTypes = {
            Nothing: 0,
            Resize: 1,
            Move: 2
        };
        var capturedEntity = capturedEntityTypes.Nothing;

        var ResizingHelper = function(stateHelper, evt, resizingPanel) {
            this.ownerControl = stateHelper.getOwnerControl();
            this.stateHelper = stateHelper;
            if(stateHelper.isMovingStarted(resizingPanel)) {
                this.resizingPanel = resizingPanel;
                captureMove();
            } else if(stateHelper.isResizingStarted(resizingPanel)) {
                this.resizingPanel = resizingPanel.parentNode;

                var resizingDirection = ASPx.Attr.GetAttribute(resizingPanel, "resizeDirection");
                this.sideH = resizingDirection.indexOf("e") > -1;
                this.sideV = resizingDirection.indexOf("s") > -1;

                captureResize();
            }

            this.startPoint = getEventPoint(evt);

            this.initPosX = getAbsoluteX(this.resizingPanel);
            this.initPosY = getAbsoluteY(this.resizingPanel);

            this.initWidth = this.resizingPanel.offsetWidth;
            this.initHeight = this.resizingPanel.offsetHeight;

            this.keepResizingPanelPosition();

            this.ownerControl.modelBoxStartMovingOrResizing();
        };
        ResizingHelper.prototype = {
            getChanges: function() {
                return {
                    offsetX: getAbsoluteX(this.resizingPanel) - this.initPosX,
                    offsetY: getAbsoluteY(this.resizingPanel) - this.initPosY,
                    width: this.resizingPanel.offsetWidth,
                    height: this.resizingPanel.offsetHeight
                };
            },
            hasChanges: function() {
                return (
                    this.initPosX != getAbsoluteX(this.resizingPanel) ||
                    this.initPosY != getAbsoluteY(this.resizingPanel) ||
                    this.initWidth != this.resizingPanel.offsetWidth ||
                    this.initHeight != this.resizingPanel.offsetHeight);
            },
            onMouseMove: function(evt) {
                if(ASPx.Browser.WebKitTouchUI)
                    evt.preventDefault();
                if(isResizingCaptured())
                    this.onResize(evt, this.stateHelper.isResizingProportional(evt));
                else if(isMovingCaptured())
                    this.onMove(evt);
            },
            onMouseUp: function(evt) {
                releaseCapturedEntity();
                this.ownerControl.modelBoxEndMovingOrResizing();
            },
            onEscape: function() {
                var activePanes = this.getActivePanes();
                for(var paneType in activePanes)
                    if(activePanes.hasOwnProperty(paneType) && activePanes[paneType]) {
                        var pane = activePanes[paneType];
                        pane.resetResizingPanelPosition();
                    }
                releaseCapturedEntity();
            },
            onResize: function(evt, proportional) {
                var eventPoint = getEventPoint(evt),
                    deltaX = eventPoint.x - this.startPoint.x,
                    deltaY = eventPoint.y - this.startPoint.y;

                this.updateResizingPanelPosition({ deltaX: deltaX, deltaY: deltaY, sideH: this.sideH, sideV: this.sideV }, proportional);
            },
            updateResizingPanelPosition: function(resizeOptions, proportional) {
                var activePanes = this.getActivePanes();
                for(var paneType in activePanes)
                    if(activePanes.hasOwnProperty(paneType) && activePanes[paneType]) {
                        var pane = activePanes[paneType];
                        pane.updateResizingPanelPosition(resizeOptions, proportional);
                    }
            },
            onMove: function(evt) {
                var paneManager = this.ownerControl.getPaneManager(),
                    controlPoint = this.ownerControl.getEventControlPoint(evt),
                    cellLayoutInfo = paneManager.getCellByCoord(controlPoint.x + this.initPosX - this.startPoint.x, controlPoint.y + this.initPosY - this.startPoint.y, ASPxClientSpreadsheet.PaneManager.PanesType.MainPane),
                    tileHelper = paneManager.getTileHelper(),
                    endOfDocumentCol = tileHelper.getEndOfDocumentCellInfo(true),
                    endOfDocumentRow = tileHelper.getEndOfDocumentCellInfo(false),
                    canBoxBeMovedHorizontally = !endOfDocumentCol || !!cellLayoutInfo && endOfDocumentCol.visibleIndex > cellLayoutInfo.colIndex,
                    canBoxBeMovedVertically = !endOfDocumentRow || !!cellLayoutInfo && endOfDocumentRow.visibleIndex > cellLayoutInfo.rowIndex;

                if(canBoxBeMovedHorizontally || canBoxBeMovedVertically) {
                    var eventPoint = getEventPoint(evt),
                        deltaX = eventPoint.x - this.startPoint.x,
                        deltaY = eventPoint.y - this.startPoint.y,
                        activePanes = this.getActivePanes();
                    for(var paneType in activePanes)
                        if(activePanes.hasOwnProperty(paneType) && activePanes[paneType]) {
                            var pane = activePanes[paneType];
                            pane.moveResizingPane({ deltaX: deltaX, deltaY: deltaY }, canBoxBeMovedHorizontally, canBoxBeMovedVertically);
                        }
                }
            },
            getActivePanes: function() {
                return this.ownerControl.getPaneManager().getActivePanes();
            },
            keepResizingPanelPosition: function() {
                var activePanes = this.getActivePanes();
                for(var paneType in activePanes)
                    if(activePanes.hasOwnProperty(paneType) && activePanes[paneType]) {
                        var pane = activePanes[paneType];
                        pane.keepResizingPanelPosition();
                    }
            }
        };

        // Private functions
        function getAbsoluteX(element) {
            return Math.round(ASPx.GetAbsoluteX(element));
        }
        function getAbsoluteY(element) {
            return Math.round(ASPx.GetAbsoluteY(element));
        }
        function getEventPoint(evt) {
            var x = ASPx.Evt.GetEventX(evt),
                y = ASPx.Evt.GetEventY(evt);
            if(ASPx.Browser.IE && ASPx.Browser.Version >= 10) {
                x = Math.round(x);
                y = Math.round(y);
            }
            return { x: x, y: y };
        }

        function captureMove() {
            capturedEntity = capturedEntityTypes.Move;
        }
        function captureResize() {
            capturedEntity = capturedEntityTypes.Resize;
        }
        function releaseCapturedEntity() {
            capturedEntity = capturedEntityTypes.Nothing;
        }

        function isMovingCaptured() {
            return capturedEntity === capturedEntityTypes.Move;
        }
        function isResizingCaptured() {
            return capturedEntity == capturedEntityTypes.Resize;
        }
        return ResizingHelper;
    })();
})();
(function() {
    ASPxClientSpreadsheet.UpdateWatcherHelper = ASPx.CreateClass(ASPx.UpdateWatcherHelper, {
        constructor: function(owner) {
            this.constructor.prototype.constructor.call(this, owner);
            this.spreadsheet = owner;
            this.confirmOnCallback = false;
            this.confirmOnPostback = false;
            this.isInUploadControlCallback = false;
        },
        HasChanges: function() {
            return this.spreadsheet.getModified();
        },
        IsCallbackRequireConfirm: function(arg) {
            return this.spreadsheet.isNewDocumentCallback(arg) || this.spreadsheet.isOpenFileCallback(arg);
        },
        NeedConfirmOnCallback: function(dxCallbackOwner, arg) {
            var defaultCustomersCallbackProcessingStrategy = this.confirmOnCallback && !this.spreadsheet.isInternalServiceCallback(arg);
            return this.IsCallbackRequireConfirm(arg) || defaultCustomersCallbackProcessingStrategy;
        },
        NeedConfirmOnPostback: function() {
            return this.confirmOnPostback;
        },
        GetConfirmUpdateText: function() {
            return this.spreadsheet.getConfirmUpdateText();
        },
        SetConfirmOnCallbackEnabled: function(enabled) {
            this.confirmOnCallback = enabled;
        },
        SetConfirmOnPostbackEnabled: function(enabled) {
            this.confirmOnPostback = enabled;
        },
        StartImageUploadCallback: function() {
            this.isInUploadControlCallback = true;
        },
        EndImageUploadCallback: function() {
            this.isInUploadControlCallback = false;
        },
        isInUploadCallback: function() {
            return this.isInUploadControlCallback;
        }
    });

    ASPxClientSpreadsheet.StateWatcherHelper = ASPx.CreateClass(null, {
        constructor: function(owner) {
            this.spreadsheet = owner;
            this.activated = false;

            this.selectionEventProcessed = false;

            this.dialogWatcherActivated = false;

            this.activeDialogCommand = null;
        },
        activate: function() {
            if(!this.isActivated()) {
                var that = this;
                this.onActiveCellChangedBase = this.getOwnerControl().onActiveCellChanged;

                this.getOwnerControl().onActiveCellChanged = function(selection) {
                    that.onActiveCellChangedBase.call(this, selection);
                    that.onActiveCellChanged(selection);
                }.aspxBind(this.getOwnerControl());
                this.activated = true;
            }
        },
        deactivate: function() {
            if(this.isActivated()) {
                this.getOwnerControl().onSelectionChanged = this.selectionChangedBase;
                this.getOwnerControl().onActiveCellChanged = this.onActiveCellChangedBase;
                this.activated = false;
            }
        },
        isActivated: function() {
            return this.activated;
        },

        processResponse: function(response) {
            if(this.isActivated()) {
                var dialogCommandId = response[ASPxClientSpreadsheet.ResponseStringKeys.ShowDialog];
                if(dialogCommandId && ASPxClientSpreadsheet.Commands.CommandHelper.GetCommandEnabled(this.getOwnerControl(), dialogCommandId)) {
                    this.activateDialogWatched(dialogCommandId);
                } else {
                    this.deactivateDialogWatcher();
                }
            }
        },
        update: function(response) {
            if(this.isActivated()) {
                var commandId = response[ASPxClientSpreadsheet.ResponseStringKeys.CommandId];
                if(commandId === ASPxClientSpreadsheet.ServerCommands.internalCommands.HideFieldListPanelPivotTable.id)
                    this.deactivateDialogWatcher();
            }
        },
        onDialogClose: function() {
            var dialog = this.getOwnerControl().getCurrentDialog();
            if(this.isPivotTableFieldDialog(dialog)) {
                if(this.isDialogWatcherActivated()) {
                    this.updateDialogWatcher(this.getOwnerControl().getStateController().getSelection());
                } else {
                    this.activateDialogWatched(dialog.commandId);
                }
            }
        },

        // Selection changed
        onActiveCellChanged: function(selection) {
            if(this.isDialogWatcherActivated()) {
                this.updateDialogWatcher(selection);
            }
        },
        isSelectionEventProcessed: function() {
            return this.selectionEventProcessed;
        },

        // Dialog Watcher
        activateDialogWatched: function(dialogCommandId) {
            var selection = this.getOwnerControl().getStateController().getSelection();
            if(!this.isDialogWatcherActivated()) {
                this.dialogWatcherActivated = true;
                this.activeDialogCommand = dialogCommandId;
                this.onActiveCellChanged(selection);
            } else {
                this.updateDialogWatcher(selection);
            }
        },
        deactivateDialogWatcher: function() {
            if(this.isDialogWatcherActivated()) {
                this.activeDialogCommand = null;
                this.dialogWatcherActivated = false;
            }
        },
        isDialogWatcherActivated: function() {
            return this.dialogWatcherActivated;
        },
        updateDialogWatcher: function(selection) {
            if(this.isDialogWatcherActivated()) {
                if(this.isPivotTableDialogMonitor())
                    this.refreshPivotTableDialogState(selection);
            }
        },

        // PivotTable Dialog Watcher
        isPivotTableDialogMonitor: function() {
            return this.activeDialogCommand === ASPxClientSpreadsheet.ServerCommands.internalCommands.FieldListPanelPivotTable.id;
        },
        isPivotTableFieldDialog: function(dialog) {
            return dialog && dialog.commandId === ASPxClientSpreadsheet.ServerCommands.internalCommands.FieldListPanelPivotTable.id;
        },
        refreshPivotTableDialogState: function(selection) {
            var currentDialog = this.getOwnerControl().getCurrentDialog(),
                activePivotTable = null;
            if(!currentDialog) {
                activePivotTable = this.getActivePivotTableBySelection(selection);
                if(activePivotTable)
                    this.getOwnerControl().showDialog(this.activeDialogCommand);
            } else if(this.isPivotTableFieldDialog(currentDialog) && !currentDialog.GetDialogPopup().IsVisible()) {
                activePivotTable = this.getActivePivotTableBySelection(selection);
                if(activePivotTable)
                    currentDialog.showDialog();
            }
        },
        getActivePivotTableBySelection: function(selection) {
            var pivotTables = this.getOwnerControl().getDocumentModel().getPivotTables(),
                activePivotTable = null;
            if(pivotTables.length >= 0) {
                var paneManager = this.getOwnerControl().getPaneManager(),
                    modelRange = paneManager.convertVisibleRangeToModel(selection.activeCellRange);
                activePivotTable = pivotTables.getItemByRange(modelRange);
            }
            return activePivotTable;
        },
        // Owner Helpres
        getOwnerControl: function() {
            return this.spreadsheet;
        }
    });
})();
(function() {

    ASPxClientSpreadsheet.ClipboardHelper = (function() {
        var ClipboardHelper = function(spreadsheet) {
            this.spreadsheet = spreadsheet;
            this.clipboardBuffer = [];
            this.currentColIndex = -1;
            this.currentRowIndex = -1;
            this.styleSectionContents = null;
            this.styleCache = {};

            this.allowStyleSectionAnalyzing = true;
            this.allowDataInsertionWithFormatting = true;
        };

        ClipboardHelper.prototype = {
            onPasteEvent: function() {
                this.onBeforePasteEvent();
                this.onPasteEventProcessing();
                this.onAfterPasteEvent();
            },

            // Before Paste Event
            onBeforePasteEvent: function() {
                this.clipboardBuffer = [];

                //Simplify format                
                var innerText = this.simplifyInnerHTML(this.getInputController().getEditableDocumentContent());
                this.getInputController().replaceEditableDocumentContent(innerText);
                // Save current position of selection
                this.calculateInitialCellPostion();

                // Save styles section if can (Chrome)
                this.tryToGetStylesFromClipboard();

                this.getOwnerControl().getStateController().onBeforePasteEvent();
            },
            simplifyInnerHTML: function(html) {
                // clear word formatting
                // remove Word attributes
                html = html.replace(/<(\w[^>]*) lang=([^ |>]*)([^>]*)/gi, "<$1$3");
                html = html.replace(/\s*mso-bidi-font-family/gi, "font-family");
                html = html.replace(/\s*MARGIN: 0cm 0cm 0pt\s*;/gi, '');
                html = html.replace(/\s*MARGIN: 0cm 0cm 0pt\s*"/gi, "\"");
                html = html.replace(/\s*TEXT-INDENT: 0cm\s*;/gi, '');
                html = html.replace(/\s*TEXT-INDENT: 0cm\s*"/gi, "\"");
                html = html.replace(/\s*FONT-VARIANT: [^\s;]+;?"/gi, "\"");
                html = html.replace(/\s*tab-stops:[^;"]*;?/gi, '');
                html = html.replace(/\s*tab-stops:[^"]*/gi, '');

                // remove special Word tags
                html = html.replace(/<\w+:imagedata/gi, '<img');
                html = html.replace(/<\/?\w+:[^>]*>/gi, '');
                html = html.replace(/<STYLE[^>]*>[\s\S]*?<\/STYLE[^>]*>/gi, '');
                html = html.replace(/<(?:META|LINK)[^>]*>\s*/gi, '');
                html = html.replace(/<\\?\?xml[^>]*>/gi, '');
                html = html.replace(/<o:[pP][^>]*>\s*<\/o:[pP]>/gi, '');
                html = html.replace(/<o:[pP][^>]*>.*?<\/o:[pP]>/gi, '&nbsp;');
                html = html.replace(/<st1:.*?>/gi, '');
                html = html.replace(/<\!--[\s\S]*?-->/g, '');

                // remove empty attributes
                html = html.replace(/\s*style="\s*"/gi, '');
                html = html.replace(/style=""/ig, "");
                html = html.replace(/style=''/ig, "");

                // clean style attributes
                var stRegExp = new RegExp('(?:style=\\")([^\\"]*)(?:\\")', 'gi');
                html = html.replace(stRegExp, function(str) {
                    str = str.replace(/&quot;/gi, "'");
                    str = str.replace(/&#xA;/gi, " ");
                    return str;
                });

                // replace ugly Word markup
                if(ASPx.Browser.Firefox)
                    html = html.replace(/^\n /gi, '');
                html = html.replace(/^\s|\s$/gi, '');
                html = html.replace(/<p>&nbsp;<\/p>/gi, '<br /><br />');
                html = html.replace(/<font\s*>([^<>]+)<\/font>/gi, '$1');
                html = html.replace(/<span\s*><span\s*>([^<>]+)<\/span><\/span>/ig, '$1');
                html = html.replace(/<span>([^<>]+)<\/span>/gi, '$1');

                // Remove nested empty tags
                // safe empty td
                html = html.replace(/<td([^>]*)>\s*<\/td>/gi, '<td$1 empty>&nbsp;</td>');

                var re = /<([^\s>]+)(\s[^>]*)?><\/\1>/g;
                while(html != html.replace(re, ''))
                    html = html.replace(re, '');

                re = /<([^\s>]+)(\s[^>]*)?>((?!\t)\s*)<\/\1>/g;
                while(html != html.replace(re, ' '))
                    html = html.replace(re, ' ');

                // merge font family attributes
                var array = html.match(/<[^>]*style\s*=\s*[^>]*>/gi);
                if(array && array.length > 0) {
                    for(var i = 0, elementHtml; elementHtml = array[i]; i++) {
                        var fontFamilyArray = elementHtml.match(/\s*font-family\s*:\s*(([^;]*)([\"';\s)](?!>))|([^;"']*))/gi);
                        if(fontFamilyArray && fontFamilyArray.length > 1) {
                            var commonValue = fontFamilyArray[0].replace(/font-family\s*:\s*([^;]*)[\"'; ]/gi, "$1");
                            var resultElementHtml = elementHtml;
                            for(var j = 0, fontFamily; fontFamily = fontFamilyArray[j]; j++)
                                resultElementHtml = resultElementHtml.replace(fontFamily, "font-family: " + commonValue + ";");
                            html = html.replace(elementHtml, resultElementHtml);
                        }
                    }
                }
                if(ASPx.Browser.Safari) {
                    re = /<pre[\s\S]*<\/pre>/gi;
                    var preContainer = html.match(re);
                    if(preContainer) {
                        var len = preContainer.length;
                        while(len--) {
                            var wordBreaks = preContainer[len].replace(/\n/gi, "<br>");
                            html = html.replace(preContainer[len], wordBreaks);
                        }
                    }
                }

                html = html.replace(/^\n|\n$/gi, '');
                html = html.replace(/(\n+(<br>)|(<\/p>|<br>)\n+)/gi, '$2$3');
                html = html.replace(/(\n+\s+)|(\s+\n+)/gi, ' ');
                html = html.replace(/\n+/gi, ' ');

                //clear particular tags
                //html = html.replace(/<u>([\s\S]*?)<\/u>/gi, '<span style="text-decoration: underline">$1</span>');
                //html = html.replace(/<s>([\s\S]*?)<\/s>/gi, '<span style="text-decoration: line-through">$1</span>');
                re = /<span style=\"mso-bookmark:\s*?OLE_LINK\d*?;?\"\>([\s\S]*?)<\/span>/gi;
                while(html != html.replace(re, "$1"))
                    html = html.replace(re, "$1");
                re = /<a name=\"OLE_LINK\d*?\"\>([\s\S]*?)<\/a>/gi;
                while(html != html.replace(re, "$1"))
                    html = html.replace(re, "$1");

                html = html.replace(/<\/([^\s>]+)(\s[^>]*)?><br><\/([^\s>]+)(\s[^>]*)?>/gi, '');

                if(ASPx.Browser.MacOSPlatform && ASPx.Browser.Safari)
                    html = html.replace(/<BR>$/i, "");

                if(ASPx.Browser.WebKitFamily) {
                    re = /<div>((?!(div)).)*.<\/div>/gi; //Get simple divs that doesn't contains another divs
                    var simpleContainers = html.match(re);
                    if(simpleContainers) {
                        var len = simpleContainers.length;
                        while(len--) {
                            var simpleDiv = simpleContainers[len];
                            // span with white-space param is tabulation container
                            re = /<span style=\"white-space:\s?pre;?\s?\">\t(\t*)<\/span>/gi;
                            if(simpleDiv.match(re)) { //tab delimited text
                                var table = simpleDiv.replace(/<div>/gi, "<table><tr><td>");
                                table = table.replace(/<\/div>/gi, "</td></tr></table>");
                                table = table.replace(re, "</td>$1<td>");
                                table = table.replace(/\t/gi, "<td></td>");
                                html = html.replace(simpleDiv, table);
                            }
                        }
                    }
                } else {
                    re = /<\/?br>/gi;
                    var simpleContainers = html.split(re);
                    if(simpleContainers) {
                        html = html.replace(re, "<br>");
                        var len = simpleContainers.length;
                        while(len--) {
                            var simpleDiv = simpleContainers[len];
                            re = /(&nbsp;){2,}/gi;
                            if(simpleDiv.match(re) && simpleDiv.indexOf("<") !== 0) { //tab delimited text
                                if(ASPx.Browser.Firefox) {
                                    // in FireFox tabulations is a continuous sequence separated by space
                                    // replace this continuous sequence with one &nbsp;  (space on end)
                                    simpleDiv = simpleDiv.replace(/(&nbsp;)+\s/gi, "&nbsp;");
                                    // remove one extra &nbsp; from FireFox continuous sequence
                                    simpleDiv = simpleDiv.replace(/&nbsp;((&nbsp;)*)/gi, "$1");
                                }
                                var table = "<table><tr><td>" + simpleDiv + "</td></tr></table>";
                                table = table.replace(/&nbsp;/gi, "</td><td>");
                                html = html.replace(simpleContainers[len], table);
                            }
                        }
                        // remove <br> tag between tables
                        html = html.replace(/<\/table><br><table>/gi, "</table><table>");
                    }
                }

                return html;
            },
            calculateInitialCellPostion: function() {
                var selection = this.getOwnerControl().getSelectionInternal(),
                    modelCellPosition = this.convertVisibleCellPositionToModel(selection.range.leftColIndex, selection.range.topRowIndex);

                this.currentColIndex = modelCellPosition.col;
                this.currentRowIndex = modelCellPosition.row;
            },
            tryToGetStylesFromClipboard: function() {
                var clipboardContents = this.getInputController().getPastedHtml();
                if(clipboardContents) {
                    var styleSectionContents = clipboardContents.match(/<style[\s\S]*?<\/style>/i);
                    if(styleSectionContents && styleSectionContents.length > 0)
                        this.styleSectionContents = styleSectionContents[0];
                }
            },
            getStyleSectionContents: function() {
                return this.styleSectionContents;
            },

            CreateCopyCutServerCommandArgs: function(params) {
                params = params || {};
                params["BufferId"] = this.getOwnerControl().getCurrentClipboardBufferId();
                return params;
            },
            CreatePasteServerCommandArgs: function(clipboardData) {
                return {
                    BufferId: this.getOwnerControl().getCurrentClipboardBufferId(),
                    PasteValue: ASPx.Json.ToJson(clipboardData),
                    HasClientClipboardData: !!clipboardData
                };
            },

            //Paste Event Processing
            onPasteEventProcessing: function() {
                var childNodes = this.getInputController().getContentContainer().childNodes;
                this.reorderChildElements(childNodes);

                var clipboardData = this.convertClipboardData();

                if(clipboardData && clipboardData.length > 0) {
                    if(this.checkTargetCellsAreEditable(clipboardData))
                        ASPxClientSpreadsheet.ServerCommands.Paste(this.getOwnerControl(), this.CreatePasteServerCommandArgs(clipboardData));
                    else {
                        this.getOwnerControl().HideLoadingElements();
                        this.getOwnerControl().showProtectedSheetWarningMessage();
                    }
                }
            },

            onAfterPasteEvent: function() {
                this.currentColIndex = -1;
                this.currentRowIndex = -1;
                this.styleSectionContents = null;
                this.clipboardBuffer = null;
                this.styleCache = {};

                setTimeout(function() { this.getInputController().setEditableDocumentContent(""); }.aspxBind(this), 10);
            },

            reorderChildElements: function(elements) {
                for(var i = 0, element; element = elements[i]; i++) {
                    var childElements = element.childNodes ? element.childNodes : [];

                    if(childElements.length && element.tagName != "TABLE") {
                        this.transferParentStyles(element, childElements);

                        var isParagraph = element.tagName === "DIV" || element.tagName === "P" ||
                            element.tagName.indexOf("H") === 0;
                        if(isParagraph)
                            this.clipboardBuffer.push({ TagName: "P", Element: element, Mark: "BP" });

                        this.reorderChildElements(childElements);

                        if(isParagraph)
                            this.clipboardBuffer.push({ TagName: "P", Mark: "EP" });

                    } else {
                        switch(element.tagName) {
                            case "TABLE":
                                var bufferId = ASPx.Attr.GetAttribute(element, "id");
                                if(bufferId)
                                    this.clipboardBuffer.unshift({ TagName: "Important", Data: { ServerBufferId: bufferId } });
                                this.clipboardBuffer.push({ TagName: element.tagName, Element: element });
                                break;
                            case "IMG":
                                if(element.alt !== "pastedByCallback")
                                    this.clipboardBuffer.push({ TagName: element.tagName, Element: element });
                                break;
                            case "DIV":
                                this.clipboardBuffer.push({ TagName: "P", Element: element, Mark: "BP" });
                                this.clipboardBuffer.push({ TagName: "", Data: ASPx.GetInnerText(element) });
                                this.clipboardBuffer.push({ TagName: "P", Mark: "EP" });
                                break;
                            case "BR":
                                this.clipboardBuffer.push({ TagName: element.tagName, Element: element });
                                break;
                            default:
                                this.clipboardBuffer.push({ TagName: "", Data: element.nodeValue || ASPx.GetInnerText(element) });
                                break;
                        }
                    }
                }
            },
            transferParentStyles: function(parentElement, childElements) {
                var len = childElements.length;
                while(len--) {
                    var childElement = childElements[len];
                    if(childElement.style) {
                        for(var prop in childElement.style) {
                            if(childElement.style[prop] === "" && !(prop == "cssText" || prop == "listStyleType") && parentElement.style[prop] !== "") {
                                childElement.style[prop] = parentElement.style[prop];
                            }
                        }
                    }

                    if(parentElement.tagName === "I") {
                        var bufferId = ASPx.Attr.GetAttribute(parentElement, "id");
                        if(bufferId)
                            ASPx.Attr.SetAttribute(childElement, "id", bufferId);
                    }
                }
            },
            convertClipboardData: function() {
                var clipboardData = [],
                    lastParagraph = null,
                    paragraphText = [],
                    paragraphFlag = false;

                for(var i = 0, element; element = this.clipboardBuffer[i]; i++) {
                    switch(element.TagName) {
                        case "Important":
                            clipboardData.push(element.Data);
                            break;
                        case "TABLE":
                            clipboardData = clipboardData.concat(this.parseTable(element.Element));
                            break;
                        case "IMG":
                            if(paragraphFlag && paragraphText.join("") !== "") {
                                clipboardData.push(this.parseParagraph(lastParagraph, paragraphText.join("")));
                                this.currentRowIndex += 1;
                                paragraphText = [];
                            }

                            clipboardData.push(this.parseImage(element.Element));
                            break;
                        case "P":
                            if(element.Mark === "BP") {
                                paragraphText = [];
                                paragraphFlag = true;
                                if(element.Element) {
                                    lastParagraph = element.Element;
                                }
                            } else if(element.Mark === "EP") {
                                paragraphFlag = false;
                                clipboardData.push(this.parseParagraph(lastParagraph, paragraphText.join("")));
                                this.currentRowIndex += 1;
                                paragraphText = [];
                            }
                            break;
                        case "BR":
                            if(paragraphFlag) {
                                paragraphText.push("\r\n");
                            } else {
                                clipboardData.push(this.parseText(paragraphText.join("")));
                                paragraphText = [];
                                this.currentRowIndex += 1;
                            }
                            break;
                        default:
                            paragraphText.push(element.Data);
                            break;
                    }
                }
                if(paragraphText.length > 0)
                    clipboardData.push(this.parseText(paragraphText.join("")));
                return clipboardData;
            },

            parseText: function(text) {
                var cell = {};
                cell.RowIndex = this.currentRowIndex;
                cell.ColIndex = this.currentColIndex;
                if(text)
                    cell.Value = text;
                if(text.indexOf("\r\n") > 0)
                    cell.Wrap = true;

                return this.clearEmptyProperties(cell);
            },
            parseImage: function(image) {
                var cell = {};
                cell.RowIndex = this.currentRowIndex;
                cell.ColIndex = this.currentColIndex;
                cell.ImgUrl = ASPx.Attr.GetAttribute(image, "src");
                return this.clearEmptyProperties(cell);
            },
            parseParagraph: function(paragraph, text) {
                var cell = this.allowDataInsertionWithFormatting ? this.getElementStyle(paragraph) : {};
                cell.RowIndex = this.currentRowIndex;
                cell.ColIndex = this.currentColIndex;
                if(text)
                    cell.Value = text;
                if(text.indexOf("\r\n") > 0)
                    cell.Wrap = true;

                return this.clearEmptyProperties(cell);
            },

            parseTable: function(element) {
                var tableColumnCount = this.getTableColumnCount(element),
                    rowSpanCorrection = this.initializeArray(tableColumnCount),
                    tableContent = [];

                for(var i = 0, row, colSpanCorrection = 0; row = element.rows[i]; i++) {
                    for(var j = 0; j < tableColumnCount; j++) {
                        if(rowSpanCorrection[j] > 0) {
                            colSpanCorrection = colSpanCorrection + 1;
                            rowSpanCorrection[j] = rowSpanCorrection[j] - 1;
                        } else {
                            var cell = row.cells[j - colSpanCorrection];
                            if(cell) {
                                var cellStyle = this.allowDataInsertionWithFormatting ? this.getElementStyle(cell) : {};

                                cellStyle.Value = cell.hasAttribute("empty") ? "" : this.getInnerTextForCellContianer(cell);
                                cellStyle.Wrap = cellStyle.Wrap || cellStyle.Value.indexOf("\r\n") > 0;
                                cellStyle.RowIndex = this.currentRowIndex + i;
                                cellStyle.ColIndex = this.currentColIndex + j;

                                cellStyle.ColSpan = cell.colSpan;
                                cellStyle.RowSpan = cell.rowSpan;

                                //TODO: to Zhuravlev in one cell can be more than 1 images
                                if(this.allowDataInsertionWithFormatting) {
                                    var innerImages = cell.getElementsByTagName("img");
                                    if(innerImages && innerImages.length > 0)
                                        cellStyle.ImgUrl = ASPx.Attr.GetAttribute(innerImages[0], "src");
                                }

                                //vertical correction
                                if(cellStyle.RowSpan > 1) {
                                    for(var k = j; k < j + cellStyle.ColSpan; k++)
                                        rowSpanCorrection[k] = cellStyle.RowSpan - 1;
                                }
                                //horizontal correction
                                if(cellStyle.ColSpan > 1) {
                                    colSpanCorrection = colSpanCorrection + cellStyle.ColSpan - 1;
                                    j = j + cellStyle.ColSpan - 1;
                                }

                                tableContent.push(this.clearEmptyProperties(cellStyle));
                            }
                        }
                    }
                    colSpanCorrection = 0;
                }
                this.currentRowIndex = this.currentRowIndex + element.rows.length;
                return tableContent;
            },
            getInnerTextForCellContianer: function(cellContainer) {
                if(cellContainer && cellContainer.innerText)
                    return cellContainer.innerText;
                return ASPx.GetInnerText(cellContainer);
            },
            clearEmptyProperties: function(cellStyle) {
                var cell = {};

                cell.c = cellStyle.ColIndex;
                cell.r = cellStyle.RowIndex;

                if(cellStyle.ImgUrl)
                    cell.url = cellStyle.ImgUrl;
                if(cellStyle.BackgroundColor)
                    cell.bc = cellStyle.BackgroundColor;
                if(cellStyle.VAlign && cellStyle.VAlign !== "b")
                    cell.va = cellStyle.VAlign;
                if(cellStyle.HAlign && cellStyle.HAlign !== "g")
                    cell.ha = cellStyle.HAlign;
                if(cellStyle.Wrap)
                    cell.w = true;
                if(cellStyle.ColSpan > 1)
                    cell.cs = cellStyle.ColSpan;
                if(cellStyle.RowSpan > 1)
                    cell.rs = cellStyle.RowSpan;

                if(cellStyle.LinkUrl || cellStyle.LinkAlt) {
                    if(cellStyle.LinkUrl)
                        cell.lu = cellStyle.LinkUrl;
                    if(cellStyle.LinkAlt)
                        cell.lt = cellStyle.LinkAlt;
                }
                if(cellStyle.Value) {
                    cell.v = cellStyle.Value;

                    if(cellStyle.FontName && cellStyle.FontName.toLowerCase() !== ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Font.Name.toLowerCase())
                        cell.fn = cellStyle.FontName;
                    if(cellStyle.FontColor && cellStyle.FontColor !== "#000000")
                        cell.fc = cellStyle.FontColor;
                    if(cellStyle.FontSize && cellStyle.FontSize !== ASPxClientSpreadsheet.DocumentModel.CellStyle.Default.Font.Size.toString())
                        cell.fs = cellStyle.FontSize;
                    if(cellStyle.FontBold)
                        cell.fb = true;
                    if(cellStyle.FontStyle && cellStyle.FontStyle !== "normal")
                        cell.fi = cellStyle.FontStyle;
                    if(cellStyle.FontDecoration && cellStyle.FontDecoration !== "none")
                        cell.fd = cellStyle.FontDecoration;
                }

                if(cellStyle.BorderLeftStyle) {
                    cell.bls = cellStyle.BorderLeftStyle;
                    if(cellStyle.BorderLeftColor && cellStyle.BorderLeftColor !== "#000000")
                        cell.blc = cellStyle.BorderLeftColor;
                }

                if(cellStyle.BorderRightStyle) {
                    cell.brs = cellStyle.BorderRightStyle;
                    if(cellStyle.BorderRightColor && cellStyle.BorderRightColor !== "#000000")
                        cell.brc = cellStyle.BorderRightColor;
                }

                if(cellStyle.BorderTopStyle) {
                    cell.bts = cellStyle.BorderTopStyle;
                    if(cellStyle.BorderTopColor && cellStyle.BorderTopColor !== "#000000")
                        cell.btc = cellStyle.BorderTopColor;
                }

                if(cellStyle.BorderBottomStyle) {
                    cell.bbs = cellStyle.BorderBottomStyle;
                    if(cellStyle.BorderBottomColor && cellStyle.BorderBottomColor !== "#000000")
                        cell.bbc = cellStyle.BorderBottomColor;
                }

                if(this.isSameBorderFormat(cell)) {
                    cell.bs = cell.bbs;
                    if(cell.bbc)
                        cell.bsc = cell.bbc;

                    delete cell.bls;
                    delete cell.blc;

                    delete cell.brs;
                    delete cell.brc;

                    delete cell.bts;
                    delete cell.btc;

                    delete cell.bbs;
                    delete cell.bbc;
                }
                return cell;
            },
            isSameBorderFormat: function(cell) {
                if((cell.bls === cell.bts) && (cell.brs === cell.bbs) && (cell.bls === cell.brs) && cell.bls)
                    return (cell.blc === cell.btc) && (cell.brc === cell.bbc) && (cell.blc === cell.brc);
                return false;
            },
            getElementStyle: function(element) {
                var elementInlineStyle = this.getStyleFromInitialContainer(element);
                if(this.allowStyleSectionAnalyzing) {
                    var elementCssStyle = this.getElementStyleByCssRules(element.className),
                        elementStyleByTagName = this.getElementStyleByTagName(element.tagName);

                    return this.mergeStyles(elementInlineStyle, this.mergeStyles(elementCssStyle, elementStyleByTagName));
                }
                return elementInlineStyle;
            },
            getStyleFromInitialContainer: function(element) {
                var inlineStyle = this.getElementInlineStyle(element.style),
                    textContainers = element.getElementsByTagName("SPAN"),
                    hyperLinks = element.getElementsByTagName("a");

                if(textContainers.length === 1) {
                    inlineStyle = this.mergeStyles(inlineStyle, this.getElementInlineStyle(textContainers[0].style));

                    if(element.getElementsByTagName("B").length || element.getElementsByTagName("STRONG").length)
                        inlineStyle.FontBold = true;

                    if(element.getElementsByTagName("U").length)
                        inlineStyle.FontDecoration += " underline";

                    if(element.getElementsByTagName("S").length)
                        inlineStyle.FontDecoration += " line-through";

                    if(element.getElementsByTagName("I").length || element.getElementsByTagName("EM").length)
                        inlineStyle.FontStyle = "italic";
                }

                if(ASPx.Browser.IE || ASPx.Browser.Edge) {
                    var fontContainers = element.getElementsByTagName("FONT");
                    if(fontContainers.length === 1) {
                        inlineStyle.FontName = inlineStyle.FontName || this.normalizeFontName(fontContainers[0].face);
                        inlineStyle.FontSize = inlineStyle.FontSize || this.getFontSize(this.convertFontSizeFromCUToPoint(fontContainers[0].size));
                        inlineStyle.FontColor = inlineStyle.FontColor || ASPxClientSpreadsheet.ParseColor(fontContainers[0].color);
                    }
                }

                if(hyperLinks.length > 0) {
                    var linkSource = ASPx.Attr.GetAttribute(hyperLinks[0], "href"),
                        linkTitle = ASPx.Attr.GetAttribute(hyperLinks[0], "title");
                    inlineStyle.LinkUrl = linkSource ? linkSource : "";
                    inlineStyle.LinkAlt = linkTitle ? linkTitle : "";
                }

                return inlineStyle;
            },

            getElementInlineStyle: function(cellStyle) {
                var elementStyle = new this.getElementDefaultStyle();
                elementStyle.FontName = this.normalizeFontName(cellStyle.fontFamily);
                elementStyle.FontSize = this.getFontSize(cellStyle.fontSize);
                elementStyle.FontColor = ASPxClientSpreadsheet.ParseColor(cellStyle.color);
                elementStyle.FontBold = this.checkFontBold(cellStyle.fontWeight);
                elementStyle.FontDecoration = cellStyle.textDecoration;
                elementStyle.FontStyle = cellStyle.fontStyle;

                elementStyle.VAlign = this.getVerticalAlign(cellStyle.verticalAlign);
                elementStyle.HAlign = this.getHorizontalAlign(cellStyle.textAlign);

                elementStyle.BackgroundColor = ASPxClientSpreadsheet.ParseColor(cellStyle.backgroundColor);
                elementStyle.Wrap = !(cellStyle.whiteSpace === "nowrap" || cellStyle.whiteSpace === "" || cellStyle.whiteSpace === "pre-wrap");

                elementStyle.BorderLeftColor = ASPxClientSpreadsheet.ParseColor(cellStyle.borderLeftColor);
                elementStyle.BorderLeftStyle = this.getCoreLineStyle(cellStyle.borderLeftWidth, cellStyle.borderLeftStyle);

                elementStyle.BorderRightColor = ASPxClientSpreadsheet.ParseColor(cellStyle.borderRightColor);
                elementStyle.BorderRightStyle = this.getCoreLineStyle(cellStyle.borderRightWidth, cellStyle.borderRightStyle);

                elementStyle.BorderTopColor = ASPxClientSpreadsheet.ParseColor(cellStyle.borderTopColor);
                elementStyle.BorderTopStyle = this.getCoreLineStyle(cellStyle.borderTopWidth, cellStyle.borderTopStyle);

                elementStyle.BorderBottomColor = ASPxClientSpreadsheet.ParseColor(cellStyle.borderBottomColor);
                elementStyle.BorderBottomStyle = this.getCoreLineStyle(cellStyle.borderBottomWidth, cellStyle.borderBottomStyle);
                return elementStyle;
            },
            getElementStyleByCssRules: function(className) {
                return this.getStyleRulesByTagOrClassName(className);
            },
            getElementStyleByTagName: function(tagName) {
                return this.getStyleRulesByTagOrClassName(tagName);
            },
            getStyleRulesByTagOrClassName: function(tagOrClassName) {
                var elementStyle = new this.getElementDefaultStyle(),
                    styleSection = this.getStyleSectionContents();

                if(styleSection && tagOrClassName && tagOrClassName !== "") {
                    var cachedStyle = this.styleCache[tagOrClassName];
                    if(cachedStyle)
                        return cachedStyle;

                    var styleTextValue = styleSection.match(new RegExp(tagOrClassName + "[\\s\\S]*?\\}", "gi"));
                    if(styleTextValue && styleTextValue.length > 0) {
                        var headElement = ASPx.GetNodeByTagName(this.getInputController().getEditableDocument(), "HEAD", 0);
                        var style = this.getInputController().getEditableDocument().createElement('style');
                        style.type = 'text/css';
                        style.innerHTML = styleTextValue[0];
                        headElement.appendChild(style);
                        if(this.getInputController().getEditableDocument().styleSheets.length > 0 && this.getInputController().getEditableDocument().styleSheets[0].cssRules.length > 0) {
                            elementStyle = this.getElementInlineStyle(this.getInputController().getEditableDocument().styleSheets[0].cssRules[0].style);
                            this.styleCache[tagOrClassName] = elementStyle;
                        }
                        headElement.removeChild(style);
                    }
                }
                return elementStyle;
            },

            getCoreLineStyle: function(lineWidth, lineStyle) {
                var result = "";
                if(lineStyle !== "" && lineStyle !== "none") {
                    if(lineWidth.indexOf("pt") > 0)
                        lineWidth = this.convertMSPointsToPixels(lineWidth);
                    else
                        lineWidth = ASPx.PxToInt(lineWidth);
                    if(lineStyle === "solid") {
                        switch(lineWidth) {
                            case 1: result = "Thin";
                                break;
                            case 2: result = "Medium";
                                break;
                            default: result = "Thick";
                                break;
                        }
                    } else if(lineStyle === "dotted" || lineStyle === "dashed") {
                        switch(lineWidth) {
                            case 2: result = "Medium" + lineStyle.charAt(0).toUpperCase() + lineStyle.slice(1);
                                break;
                            default: result = lineStyle.charAt(0).toUpperCase() + lineStyle.slice(1);
                                break;
                        }

                    } else {
                        result = "Thin";
                    }
                }
                return result;
            },
            getFontSize: function(fontSize) {// copied from ribbon manager
                var size = 0;
                if(fontSize.indexOf('px') > -1)
                    size = Math.round(ASPx.PixelToPoint(fontSize, false));
                else {
                    if(fontSize.indexOf('p') > -1)
                        size = fontSize.substr(0, fontSize.indexOf('p'));
                    else size = fontSize;
                }
                return size;
            },
            convertFontSizeFromCUToPoint: function(fontSizeInCU) {
                if(fontSizeInCU === "")
                    return "";
                var pixelFactor = [0.625, 0.80, 1.0, 1.125, 1.5, 2.0, 3.0],
                    baseFontSize = 12;
                return Math.round(pixelFactor[parseInt(fontSizeInCU) - 1] * baseFontSize) + "pt";
            },
            getVerticalAlign: function(verticalAlign) {
                var result = "";
                switch(verticalAlign) {
                    case "top":
                        result = "t";
                        break;
                    case "center":
                        result = "c";
                        break;
                    default:
                        result = "b";
                        break;
                }
                return result;
            },
            getHorizontalAlign: function(horizontalAlign) {
                var result = "";
                switch(horizontalAlign) {
                    case "left":
                        result = "l";
                        break;
                    case "center":
                        result = "c";
                        break;
                    case "right":
                        result = "r";
                        break;
                    default:
                        result = "g";
                        break;
                }
                return result;
            },
            checkFontBold: function(fontWeight) {
                var fontIsBold = fontWeight === "bold";
                if(!fontIsBold)
                    fontIsBold = parseInt(fontWeight) >= 700;
                return fontIsBold;
            },
            convertMSPointsToPixels: function(points) {
                var result = 1;
                try {
                    var indexOfPt = points.toLowerCase().indexOf("pt");
                    if(indexOfPt > -1)
                        points = points.substr(0, indexOfPt);
                    result = parseFloat(points) / 0.5;
                } catch(e) { }
                return result;
            },
            normalizeFontName: function(fontName) {
                if(fontName !== "") {
                    var commaIndex = fontName.indexOf(",");
                    if(commaIndex > 0)
                        fontName = fontName.substr(0, commaIndex);
                    fontName = fontName.replace(/["']/g, "");
                }
                return fontName;
            },

            getTableColumnCount: function(tableElement) {
                var len = tableElement.rows[0].cells.length,
                    colCount = 0;
                while(len--)
                    colCount += tableElement.rows[0].cells[len].colSpan;

                return colCount;
            },
            initializeArray: function(itemCount) {
                var initialArray = [];
                for(var i = 0; i < itemCount; i++)
                    initialArray.push(0);
                return initialArray;
            },
            mergeStyles: function(primaryStyle, secondaryStyle) {
                for(var prop in primaryStyle) {
                    if(secondaryStyle[prop])
                        primaryStyle[prop] = primaryStyle[prop] || secondaryStyle[prop];
                }
                return primaryStyle;
            },
            checkTargetCellsAreEditable: function(clipboardData) {
                var allCellsAreEditable = true;
                if(this.getOwnerControl().isSheetLocked()) {
                    var len = clipboardData.length;

                    while(len--) {
                        var cell = clipboardData[len];
                        if(cell.hasOwnProperty("r"))
                            allCellsAreEditable = allCellsAreEditable && !ASPxClientSpreadsheet.ProtectionHelper.isCellLocked(this.getOwnerControl(), cell.c, cell.r);
                        if(!allCellsAreEditable)
                            break;
                    }
                }
                return allCellsAreEditable;
            },

            getElementDefaultStyle: function() {
                return {
                    Value: "",
                    ImgUrl: "",
                    LinkUrl: "",
                    LinkAlt: "",
                    FontName: "",
                    FontColor: "",
                    FontSize: "",
                    FontBold: "",
                    FontStyle: "",
                    FontDecoration: "",
                    BorderLeftColor: "",
                    BorderLeftStyle: "",
                    BorderRightColor: "",
                    BorderRightStyle: "",
                    BorderTopColor: "",
                    BorderTopStyle: "",
                    BorderBottomColor: "",
                    BorderBottomStyle: "",
                    BackgroundColor: "",
                    VAlign: "",
                    HAlign: "",
                    Wrap: "",
                    ColIndex: -1,
                    RowIndex: -1,
                    ColSpan: 1,
                    RowSpan: 1
                };
            },

            //Helpers
            getOwnerControl: function() {
                return this.spreadsheet;
            },
            getInputController: function() {
                return this.getOwnerControl().getInputController();
            },
            convertVisibleCellPositionToModel: function(colIndex, rowIndex) {
                var paneManager = this.getOwnerControl().getPaneManager();
                return {
                    col: paneManager.convertVisibleIndexToModelIndex(colIndex, true),
                    row: paneManager.convertVisibleIndexToModelIndex(rowIndex, false)
                };
            }
        };

        return ClipboardHelper;
    })();

    var colorNameArray = {
        aliceblue: 'f0f8ff',
        antiquewhite: 'faebd7',
        aqua: '00ffff',
        aquamarine: '7fffd4',
        azure: 'f0ffff',
        beige: 'f5f5dc',
        bisque: 'ffe4c4',
        black: '000000',
        blanchedalmond: 'ffebcd',
        blue: '0000ff',
        blueviolet: '8a2be2',
        brown: 'a52a2a',
        burlywood: 'deb887',
        cadetblue: '5f9ea0',
        chartreuse: '7fff00',
        chocolate: 'd2691e',
        coral: 'ff7f50',
        cornflowerblue: '6495ed',
        cornsilk: 'fff8dc',
        crimson: 'dc143c',
        cyan: '00ffff',
        darkblue: '00008b',
        darkcyan: '008b8b',
        darkgoldenrod: 'b8860b',
        darkgray: 'a9a9a9',
        darkgreen: '006400',
        darkkhaki: 'bdb76b',
        darkmagenta: '8b008b',
        darkolivegreen: '556b2f',
        darkorange: 'ff8c00',
        darkorchid: '9932cc',
        darkred: '8b0000',
        darksalmon: 'e9967a',
        darkseagreen: '8fbc8f',
        darkslateblue: '483d8b',
        darkslategray: '2f4f4f',
        darkturquoise: '00ced1',
        darkviolet: '9400d3',
        deeppink: 'ff1493',
        deepskyblue: '00bfff',
        dimgray: '696969',
        dodgerblue: '1e90ff',
        feldspar: 'd19275',
        firebrick: 'b22222',
        floralwhite: 'fffaf0',
        forestgreen: '228b22',
        fuchsia: 'ff00ff',
        gainsboro: 'dcdcdc',
        ghostwhite: 'f8f8ff',
        gold: 'ffd700',
        goldenrod: 'daa520',
        gray: '808080',
        green: '008000',
        greenyellow: 'adff2f',
        honeydew: 'f0fff0',
        hotpink: 'ff69b4',
        indianred: 'cd5c5c',
        indigo: '4b0082',
        ivory: 'fffff0',
        khaki: 'f0e68c',
        lavender: 'e6e6fa',
        lavenderblush: 'fff0f5',
        lawngreen: '7cfc00',
        lemonchiffon: 'fffacd',
        lightblue: 'add8e6',
        lightcoral: 'f08080',
        lightcyan: 'e0ffff',
        lightgoldenrodyellow: 'fafad2',
        lightgrey: 'd3d3d3',
        lightgreen: '90ee90',
        lightpink: 'ffb6c1',
        lightsalmon: 'ffa07a',
        lightseagreen: '20b2aa',
        lightskyblue: '87cefa',
        lightslateblue: '8470ff',
        lightslategray: '778899',
        lightsteelblue: 'b0c4de',
        lightyellow: 'ffffe0',
        lime: '00ff00',
        limegreen: '32cd32',
        linen: 'faf0e6',
        magenta: 'ff00ff',
        maroon: '800000',
        mediumaquamarine: '66cdaa',
        mediumblue: '0000cd',
        mediumorchid: 'ba55d3',
        mediumpurple: '9370d8',
        mediumseagreen: '3cb371',
        mediumslateblue: '7b68ee',
        mediumspringgreen: '00fa9a',
        mediumturquoise: '48d1cc',
        mediumvioletred: 'c71585',
        midnightblue: '191970',
        mintcream: 'f5fffa',
        mistyrose: 'ffe4e1',
        moccasin: 'ffe4b5',
        navajowhite: 'ffdead',
        navy: '000080',
        oldlace: 'fdf5e6',
        olive: '808000',
        olivedrab: '6b8e23',
        orange: 'ffa500',
        orangered: 'ff4500',
        orchid: 'da70d6',
        palegoldenrod: 'eee8aa',
        palegreen: '98fb98',
        paleturquoise: 'afeeee',
        palevioletred: 'd87093',
        papayawhip: 'ffefd5',
        peachpuff: 'ffdab9',
        peru: 'cd853f',
        pink: 'ffc0cb',
        plum: 'dda0dd',
        powderblue: 'b0e0e6',
        purple: '800080',
        red: 'ff0000',
        rosybrown: 'bc8f8f',
        royalblue: '4169e1',
        saddlebrown: '8b4513',
        salmon: 'fa8072',
        sandybrown: 'f4a460',
        seagreen: '2e8b57',
        seashell: 'fff5ee',
        sienna: 'a0522d',
        silver: 'c0c0c0',
        skyblue: '87ceeb',
        slateblue: '6a5acd',
        slategray: '708090',
        snow: 'fffafa',
        springgreen: '00ff7f',
        steelblue: '4682b4',
        tan: 'd2b48c',
        teal: '008080',
        thistle: 'd8bfd8',
        tomato: 'ff6347',
        turquoise: '40e0d0',
        violet: 'ee82ee',
        violetred: 'd02090',
        wheat: 'f5deb3',
        white: 'ffffff',
        whitesmoke: 'f5f5f5',
        yellow: 'ffff00',
        yellowgreen: '9acd32',
        windowtext: '000000'
    };

    ASPxClientSpreadsheet.ParseColor = function(colorString) {
        if(colorString && colorString !== "") {
            var regExp = new RegExp("^#?([a-f]|[A-F]|[0-9]){3}(([a-f]|[A-F]|[0-9]){3})?$");
            var color = colorNameArray[colorString.toLowerCase()];
            if(!color) {
                if(regExp.test(colorString))
                    colorString = _aspxGetFullHexColor(colorString);
                color = ASPx.Color.ColorToHexadecimal(colorString);
            }
            else
                color = "#" + color;
            return regExp.test(color) ? color : "";
        }
        return "";
    };

    // #XXXXXX
    function _aspxGetFullHexColor(colorString) {
        if(colorString == "")
            return null;
        var color = colorString.replace("#", "");
        if(color.length == 3) {
            var newColor = "";
            for(var i = 0; i < 3; i++)
                newColor += color.charAt(i) + color.charAt(i);

            color = newColor;
        }
        return "#" + color;
    }
})();
(function() {
    ASPxClientSpreadsheet.DialogHelperBase = ASPx.CreateClass(null, {
        constructor: function(spreadsheet) {
            this.spreadsheet = spreadsheet;
        },

        getOwnerControl: function() {
            return this.spreadsheet;
        }
    });

    ASPxClientSpreadsheet.NonModalDialogHelper = ASPx.CreateClass(ASPxClientSpreadsheet.DialogHelperBase, {
        constructor: function(spreadsheet, dialog) {
            this.constructor.prototype.constructor.call(this, spreadsheet);
            this.dialog = dialog;
        },

        getDialog: function() {
            return this.dialog;
        },

        attachToInput: function(inputElement) {
            this.spreadsheet.getDynamicSelectionHelper().attachToInput(inputElement);
            this.spreadsheet.getStateController().notifyNonModalDialogOpen();
        },

        initDynamicSelection: function(inputElement) {
            this.attachToInput(inputElement);
            ASPx.Evt.AttachEventToElement(inputElement, "keyup", this.onInputKeyUp.aspxBind(this));
        },

        onInputKeyUp: function() {
            this.spreadsheet.getDynamicSelectionHelper().refresh();
        },

        getSheetNameFromRange: function(range) {
            range = range.trim();
            if(range.indexOf("=") === 0)
                range = range.substr(1);
            var rawSheetName = range.substr(0, range.indexOf("!"));
            if(rawSheetName && rawSheetName !== "") {
                if(rawSheetName.indexOf("'") === 0)
                    rawSheetName = rawSheetName.substr(1, rawSheetName.length - 2);
            }
            return rawSheetName;
        },

        switchToFormulaSheet: function(range) {
            if(range.indexOf(this.getOwnerControl().getDocumentModel().getActiveSheetName()) < 0) {
                var sheetName = this.getSheetNameFromRange(range),
                    sheetId = this.getOwnerControl().getDocumentModel().getSheetIdByName(sheetName);
                if(sheetId >= 0) {
                    window.setTimeout(function() { this.getDialog().spreadsheet.changeSheetIndex(sheetId); }.aspxBind(this), 10);
                }
            }
        },
        onShown: function() {
            this.getDialog().switchContextMenuEnableMode(false);
            this.getDialog().switchRibbonEnabledMode(false);
        },

        onClose: function() {
            this.spreadsheet.getDynamicSelectionHelper().detach();
            this.spreadsheet.getStateController().notifyNonModalDialogClose();
            this.getDialog().switchRibbonEnabledMode(true);
            this.getDialog().switchContextMenuEnableMode(true);
        }
    });
})();
(function() {
    ASPxClientSpreadsheet.InsertHyperlinkDialogHelper = ASPx.CreateClass(ASPxClientSpreadsheet.DialogHelperBase, {
        constructor: function(spreadsheet) {
            this.constructor.prototype.constructor.call(this, spreadsheet);
        },

        URLConstants: {
            DefaultLinkPrefix: "http://",
            MailToPrefix: "mailto:",
            SubjectPrefix: "?subject="
        },
        getHyperLinkInformation: function() {
            var selection = this.getOwnerControl().getSelectionInternal(),
                context = {};
            if(selection.drawingBoxIndex > -1) {
                context.element = selection.drawingBoxElement;
                context.isDrawing = true;
            } else {
                context.element = ASPxClientSpreadsheet.CellHelper.getLinkElementInSelection(this.getOwnerControl(), selection);
                var cellValue = this.getOwnerControl().getCellValueByVisiblePosition_Internal(selection.activeCellColIndex, selection.activeCellRowIndex);
                if(cellValue)
                    context.displayText = cellValue;
            }
            if(context.element)
                context.isLinkExist = !!ASPx.Attr.GetAttribute(context.element, "_loc");

            return this.getLinkContext(context);
        },
        getLinkContext: function(context) {
            var currentLinkContext = {
                isDrawing: context.isDrawing,
                isLinkExist: context.isLinkExist,
                isMailAddress: false,
                targetUri: this.URLConstants.DefaultLinkPrefix,
                displayText: "",
                title: "",
                subject: ""
            };
            if(context.isLinkExist) {
                var url = ASPx.Attr.GetAttribute(context.element, "_loc"),
                    mailtoIndex = url.indexOf(this.URLConstants.MailToPrefix);
                if(mailtoIndex > -1) {
                    var subjectIndex = url.indexOf(this.URLConstants.SubjectPrefix),
                        index = subjectIndex > -1 ? subjectIndex : url.length;
                    currentLinkContext.isMailAddress = true;
                    currentLinkContext.targetUri = url.substring(mailtoIndex + this.URLConstants.MailToPrefix.length, index);
                    currentLinkContext.subject = subjectIndex > -1 ? url.substring(subjectIndex + this.URLConstants.SubjectPrefix.length) : "";
                } else {
                    currentLinkContext.targetUri = url;
                }
                currentLinkContext.displayText = context.displayText;
                currentLinkContext.title = ASPx.Attr.GetAttribute(context.element, "title");
            }
            else if(context.displayText)
                currentLinkContext.displayText = context.displayText;

            return currentLinkContext;
        },
        getEmailUrl: function(emailText, subjectText) {
            return this.URLConstants.MailToPrefix + emailText + this.URLConstants.SubjectPrefix + subjectText;
        }
    });
})();
(function() {
    ASPxClientSpreadsheet.InsertPictureDialogHelper = ASPx.CreateClass(ASPxClientSpreadsheet.DialogHelperBase, {
        constructor: function(spreadsheet, dialogMainElement) {
            this.constructor.prototype.constructor.call(this, spreadsheet);
            this.dialogMainElement = dialogMainElement;
        },

        checkImageExisting: function(checkingSrc, onLoadFunc, onErrorFunc) {
            if(document.images) {
                this.testImage = new Image();
                ASPx.Evt.AttachEventToElement(this.testImage, "load", function() { onLoadFunc(this.spreadsheet.name); }.aspxBind(this));
                ASPx.Evt.AttachEventToElement(this.testImage, "error", function() { onErrorFunc(this.spreadsheet.name); }.aspxBind(this));
                this.testImage.src = checkingSrc;
            }
        },
        onLoadTestExistingImage: function() {
            var previewAreaCell = this.getPreviewAreaCell(),
                previewTextElement = this.getPreviewTextElement(),
                previewImageElement = this.getPreviewImageElement();
            previewImageElement.src = this.testImage.src;

            var maxWidth = previewAreaCell.clientWidth;
            var maxHeight = ASPx.Browser.WebKitFamily ? previewAreaCell.offsetHeight : previewAreaCell.clientHeight;

            this.SetPreviewImageSize(this.testImage.width, this.testImage.height, maxWidth, maxHeight, previewImageElement);

            ASPx.SetElementDisplay(previewTextElement, false);
            ASPx.SetElementDisplay(previewImageElement, true);
            previewAreaCell.style.borderStyle = "none";
        },
        onErrorTestExistingImage: function() {
            var previewAreaCell = this.getPreviewAreaCell(),
                previewTextElement = this.getPreviewTextElement(),
                previewImageElement = this.getPreviewImageElement();
            ASPx.SetElementDisplay(previewTextElement, true);
            ASPx.SetElementDisplay(previewImageElement, false);
            previewAreaCell.style.borderStyle = "";
        },
        SetPreviewImageSize: function(sourceWidth, sourceHeight, maxWidth, maxHeight, previewImageElement) {
            var newWidth = sourceWidth;
            var newHeight = sourceHeight;
            if(sourceWidth > maxWidth ||
                sourceHeight > maxHeight) {

                var cw = sourceWidth / maxWidth;
                var ch = sourceHeight / maxHeight;

                if(cw > ch) {
                    newWidth = Math.floor(sourceWidth / cw);
                    newHeight = Math.floor(sourceHeight / cw);
                }
                else {
                    newWidth = Math.floor(sourceWidth / ch);
                    newHeight = Math.floor(sourceHeight / ch);
                }
            }
            previewImageElement.style.width = newWidth + "px";
            previewImageElement.style.height = newHeight + "px";
        },
        getPreviewAreaCell: function() {
            return ASPx.GetNodesByClassName(this.dialogMainElement, "dxss-imagePreviewCell")[0];
        },
        getPreviewImageElement: function() {
            return ASPx.GetNodesByClassName(this.dialogMainElement, "dxss-previewImage")[0];
        },
        getPreviewTextElement: function() {
            return ASPx.GetNodesByClassName(this.dialogMainElement, "dxss-imagePreviewText")[0];
        }
    });
})();
(function() {
    ASPxClientSpreadsheet.InsertTableDialogHelper = ASPx.CreateClass(ASPxClientSpreadsheet.NonModalDialogHelper, {
        constructor: function(spreadsheet, dialog) {
            this.constructor.prototype.constructor.call(this, spreadsheet);
            this.dialog = dialog;
        },
        getInitialRange: function() {
            var range = this.spreadsheet.getSelectionInternal().range,
                paneManager = this.spreadsheet.getPaneManager(),
                visibleRange = paneManager.convertVisibleRangeToModel(range, true);

            return ASPxClientSpreadsheet.DynamicSelectionHelper.getRangeText(
                { colIndex: visibleRange.rightColIndex, rowIndex: visibleRange.bottomRowIndex },
                { colIndex: visibleRange.leftColIndex, rowIndex: visibleRange.topRowIndex }
            );
        }
    });
})();
(function() {
    ASPxClientSpreadsheet.AutoFilterDialogsHelper = ASPx.CreateClass(ASPxClientSpreadsheet.DialogHelperBase, {
        constructor: function(spreadsheet) {
            this.constructor.prototype.constructor.call(this, spreadsheet);
        },
        prepareViewModel: function(viewModel) {
            return ASPx.Json.ToJson(viewModel);
        },
        getCheckedNodes: function(rootNode, childNodesPropertyName) {
            this.itemsState = {};

            this.getCheckedChildren(this.getChildNodes(rootNode));

            var result = [false]; /*root node*/
            ASPx.Data.ForEach(ASPx.GetObjectKeys(this.itemsState), function(key) {
                result.push(this.itemsState[key]);
            }.aspxBind(this));

            return result;
        },
        getCheckedChildren: function(nodes) {
            var atLeastOneChecked = false;
            ASPx.Data.ForEach(nodes, function(node) {
                this.itemsState[this.getNodeKey(node)] = this.getChildNodes(node).length ? this.getCheckedChildren(this.getChildNodes(node)) : this.getNodeCheckedState(node);

                atLeastOneChecked = (atLeastOneChecked || this.itemsState[this.getNodeKey(node)] || this.getNodeCheckedState(node));
            }.aspxBind(this));

            return atLeastOneChecked;
        },
        getChildNodes: function(node) {
            return node.nodes;
        },
        getNodeCheckedState: function(node) {
            return node.GetChecked();
        },
        getNodeKey: function(node) {
            return node.name;
        },
        hasCheckedItems: function(rootNode) {
            var checkedNodes = this.getCheckedNodes(rootNode);

            for(var i = 0; i < checkedNodes.length; i++) {
                if(checkedNodes[i])
                    return true;
            }

            return false;
        },
        getFormattedDate: function(date) {
            return (date.getMonth() + 1) + "/" + date.getDate() + "/" + date.getFullYear();
        }
    });
})();
(function() {
    ASPxClientSpreadsheet.InsertPivotTableDialogHelper = ASPx.CreateClass(ASPxClientSpreadsheet.NonModalDialogHelper, {
        constructor: function(spreadsheet, dialog) {
            this.constructor.prototype.constructor.call(this, spreadsheet, dialog);
        }
    });
})();
(function() {
    ASPxClientSpreadsheet.DataValidationDialogHelper = ASPx.CreateClass(ASPxClientSpreadsheet.NonModalDialogHelper, {
        constructor: function(spreadsheet, dialog) {
            this.constructor.prototype.constructor.call(this, spreadsheet);
            this.dialog = dialog;
        },
        Types: {
            AnyValue: 0,
            WholeNumber: 1,
            Decimal: 2,
            List: 3,
            Date: 4,
            Time: 5,
            TextLength: 6,
            Custom: 7
        },
        Operators: {
            Between: 0,
            NotBetween: 1,
            EqualTo: 2,
            NotEqualTo: 3,
            GreaterThan: 4,
            LessThan: 5,
            GreaterThanOrEqualTo: 6,
            LessThanOrEqualTo: 7
        },
        onViewModelReceived: function(viewModel) {
            if(viewModel) {
                this.dialog.viewModel = viewModel;
                this.dialog.populateEditors();
                this.dialog.updateEditors();
                this.dialog.updateMessages();
            }
        },
        getFormulaLabelsByOperator: function(operator, min, equal, max) {
            var labels = { firstText: "", secondText: "", secondVisible: false };
            if(operator === this.Operators.Between ||
                operator === this.Operators.NotBetween) {
                labels.secondVisible = true;
                labels.firstText = min;
                labels.secondText = max;
            }
            else if(operator === this.Operators.GreaterThan ||
                operator === this.Operators.GreaterThanOrEqualTo)
                labels.firstText = min;
            else if(operator === this.Operators.EqualTo ||
                operator === this.Operators.NotEqualTo)
                labels.firstText = equal;
            else if(operator === this.Operators.LessThan ||
                operator === this.Operators.LessThanOrEqualTo)
                labels.firstText = max;
            return labels;
        },
        prepareFormulas: function() {
            var type = this.dialog.getTypeComboBoxSelectedIndex(),
                operator = this.dialog.getOperatorComboBoxSelectedIndex(),
                texts = this.dialog.formulaLabelTexts;

            var labels = { firstText: "", secondText: "", secondVisible: false };
            switch(type) {
                case this.Types.WholeNumber:
                case this.Types.Decimal:
                    labels = this.getFormulaLabelsByOperator(operator, texts.Minimum, texts.Value, texts.Maximum);
                    break;
                case this.Types.List:
                    labels.firstText = texts.Source;
                    break;
                case this.Types.Date:
                    labels = this.getFormulaLabelsByOperator(operator, texts.StartDate, texts.Date, texts.EndDate);
                    break;
                case this.Types.Time:
                    labels = this.getFormulaLabelsByOperator(operator, texts.StartTime, texts.Time, texts.EndTime);
                    break;
                case this.Types.TextLength:
                    labels = this.getFormulaLabelsByOperator(operator, texts.Minimum, texts.Length, texts.Maximum);
                    break;
                case this.Types.Custom:
                    labels.firstText = texts.Formula;
                    break;
            }
            this.dialog.setF1LabelText(labels.firstText + ":");
            this.dialog.setF2LabelText(labels.secondText + ":");
            this.dialog.setFormula1Visible(type !== this.Types.AnyValue);
            this.dialog.setFormula2Visible(labels.secondVisible);
        },
        getIgnoreBlankEnabled: function() {
            var selectedType = this.dialog.getTypeComboBoxSelectedIndex();
            return selectedType !== this.Types.AnyValue;
        },
        getDataOperatorEnabled: function() {
            var selectedType = this.dialog.getTypeComboBoxSelectedIndex();
            return selectedType !== this.Types.AnyValue &&
                selectedType !== this.Types.List &&
                selectedType !== this.Types.Custom;
        },
        getInCellDropdownVisible: function() {
            var selectedType = this.dialog.getTypeComboBoxSelectedIndex();
            return selectedType === this.Types.List;
        },

        rangeEditorGorFocus: function(activeEditorInput, formula1Input, formula2Input, range) {
            this.attachDynamicSelectionHelper(activeEditorInput, formula1Input, formula2Input);
            if(range && this.isFormula(range))
                this.switchToFormulaSheet(range);
        },
        attachDynamicSelectionHelper: function(targetInput, input1, input2) {
            this.detachDynamicSelectionHelper(input1, input2);
            this.spreadsheet.getStateController().notifyNonModalDialogOpen();
            this.spreadsheet.getDynamicSelectionHelper().attachToInput(targetInput);
            ASPx.Evt.AttachEventToElement(targetInput, "keyup", this.onInputKeyUp.aspxBind(this));
        },
        detachDynamicSelectionHelper: function(input1, input2) {
            if(input1)
                ASPx.Evt.DetachEventFromElement(input1, "keyup", this.onInputKeyUp.aspxBind(this));
            if(input2)
                ASPx.Evt.DetachEventFromElement(input2, "keyup", this.onInputKeyUp.aspxBind(this));
            this.spreadsheet.getDynamicSelectionHelper().detach();
        },

        showDataValidationRanges: function(show, dataValidationRange) {
            if(show) {
                this.spreadsheet.getPaneManager().hideSelection();
                this.showMultipleSelection(dataValidationRange);
            } else {
                this.hideMultipleSelection();
                this.spreadsheet.getStateController().updateSelectionRender();
            }
        },
        showMultipleSelection: function(dataValidationRange) {
            this.multiSelection = [];
            for(var i = 0; i < dataValidationRange.length; i++) {
                var validationRange = dataValidationRange[i],
                    range = new ASPxClientSpreadsheet.Range(validationRange[0], validationRange[1], validationRange[2], validationRange[3]),
                    selection = new ASPxClientSpreadsheet.Selection(range),
                    selectionRect = new ASPxClientSpreadsheet.DynamicSelection(this.spreadsheet, 0);

                this.multiSelection.push(selectionRect);
                selectionRect.setSelection(selection);
                selectionRect.render();
            }
        },
        hideMultipleSelection: function() {
            if(!this.multiSelection) return;
            var selection;
            while(selection = this.multiSelection.pop())
                selection.dispose();
        },
        modifySelection: function(canApplyChangesToAllCellsChecked, dataValidationRange) {
            if(!canApplyChangesToAllCellsChecked || dataValidationRange.length === 0) return;
            var selection = this.spreadsheet.getStateController().getSelection();
            selection.multiSelection = true;
            selection.ranges = dataValidationRange.slice(0);
        },

        isDialogValid: function(firstVisible, secondVisible, firstValue, secondValue) {
            var isValid = true,
                value;
            if(firstVisible && firstValue) {
                value = firstValue.trim();
                if(this.isFormula(value))
                    isValid = value.length > 1;
            }
            if(secondVisible && secondValue) {
                value = secondValue.trim();
                if(this.isFormula(value))
                    isValid = isValid || value.length > 1;
            }
            return isValid;
        },
        showInvalidFormulaMessage: function() {
            this.spreadsheet.showLocalizedMessageBox("Msg_InvalidFormula");
        },
        dialogCompletedSuccessfully: function(canApplyChangesToAllCellsChecked, dataValidationRange) {
            this.modifySelection(canApplyChangesToAllCellsChecked, dataValidationRange);
            var selection = this.spreadsheet.getStateController().getSelection();
            this.spreadsheet.getValidationHelper().removeValidations(selection.range);
        },

        onClose: function() {
            this.hideMultipleSelection();
            ASPxClientSpreadsheet.NonModalDialogHelper.prototype.onClose.call(this);
        },

        getNewEditorValueAfterResponse: function(activeRangeEditorValue) {
            var newRange = null;
            if(activeRangeEditorValue && this.isFormula(activeRangeEditorValue)) {
                var formulaSheetName = this.getSheetNameFromRange(activeRangeEditorValue),
                    activeSheetName = this.spreadsheet.getDocumentModel().getActiveSheetName();
                if(formulaSheetName !== activeSheetName) {
                    formulaSheetName = formulaSheetName.indexOf(" ") >= 0 ? "'" + formulaSheetName + "'" : formulaSheetName;
                    activeSheetName = activeSheetName.indexOf(" ") >= 0 ? "'" + activeSheetName + "'" : activeSheetName;

                    newRange = activeRangeEditorValue.replace(formulaSheetName, activeSheetName);
                }
            }
            return newRange;
        },

        isFormula: function(value) {
            return value.trim().indexOf("=") === 0;
        }
    });
})();
(function() {
    ASPxClientSpreadsheet.ValidationConfirmDialogHelper = ASPx.CreateClass(ASPxClientSpreadsheet.DialogHelperBase, {
        constructor: function(spreadsheet) {
            this.constructor.prototype.constructor.call(this, spreadsheet);
        },
        ConfirmTypes: {
            Stop: 0,
            Warning: 1,
            Information: 2
        },
        setValidationConfirm: function(validationConfirm) {
            this.validationConfirm = validationConfirm;
        },
        getYesOkButtonVisible: function() {
            return this.validationConfirm.type !== this.ConfirmTypes.Stop;
        },
        getRetryNoButtonVisible: function() {
            return this.validationConfirm.type !== this.ConfirmTypes.Information;
        },
        getRetryNoButtonText: function(allowedText) {
            return this.validationConfirm.type === this.ConfirmTypes.Stop ? allowedText[0] : allowedText[1];
        },
        getYesOkButtonText: function(allowedText) {
            return this.validationConfirm.type === this.ConfirmTypes.Warning ? allowedText[0] : allowedText[1];
        },
        getFocusedEditor: function(retryNoButton, yesOkButton) {
            return this.validationConfirm.type === this.ConfirmTypes.Stop ? retryNoButton : yesOkButton;
        },
        getValidationConfirmMsg: function() {
            return this.validationConfirm.msg;
        },
        initValidationCell: function() {
            this.selectCell(this.validationConfirm.cell);
            this.spreadsheet.setCellTextViewElementValue(this.validationConfirm.value);
        },
        selectCell: function(modelCell) {
            var paneManager = this.spreadsheet.getPaneManager(),
                visibleCol = paneManager.convertModelIndexToVisibleIndex(modelCell.col, true),
                visibleRow = paneManager.convertModelIndexToVisibleIndex(modelCell.row, false),
                range = new ASPxClientSpreadsheet.Range(visibleCol, visibleRow, visibleCol, visibleRow),
                selection = new ASPxClientSpreadsheet.Selection(range);
            this.spreadsheet.getStateController().setSelection(selection);
        },
        retryInput: function() {
            this.selectCell(this.validationConfirm.cell);
            this.spreadsheet.getStateController().setEditMode(ASPxClientSpreadsheet.StateController.Modes.Edit);
            this.spreadsheet.setElementsValue(this.validationConfirm.value);
            this.spreadsheet.getInputController().selectAll();
        },
        confirmOperation: function(confirmType) {
            this.spreadsheet.onUICommand(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName('UpdateCell').id, {
                colIndex: this.validationConfirm.cell.col,
                rowIndex: this.validationConfirm.cell.row,
                NewValue: ASPx.Str.EncodeHtml(this.validationConfirm.value),
                ReselectAfterCommand: true,
                ConfirmResult: this.validationConfirm.type === this.ConfirmTypes.Warning ? 'Yes' : 'OK'
            });
        },
        cancelValidation: function() {
            this.spreadsheet.getValidationHelper().cancelValidation(this.validationConfirm.cell.col, this.validationConfirm.cell.row);
        }
    });
})();
(function() {
    ASPxClientSpreadsheet.RenameSheetDialogHelper = ASPx.CreateClass(ASPxClientSpreadsheet.DialogHelperBase, {
        constructor: function(spreadsheet) {
            this.constructor.prototype.constructor.call(this, spreadsheet);
        },
        WorksheetNameError: {
            None: 0,
            Blank: 1,
            Duplicate: 2,
            ContainsProhibitedCharacters: 3,
            StartOrEndWithSingleQuote: 4,
            ExceedAllowedLength: 5
        },

        validate: function(sheetName) {
            var errorType = this.WorksheetNameError.None;

            if(sheetName !== null) {
                if(this.isSheetNameBlank(sheetName)) {
                    errorType = this.WorksheetNameError.Blank;
                } if(this.isSheetNameExceedAllowedLengt(sheetName)) {
                    errorType = this.WorksheetNameError.ExceedAllowedLength;
                } else if(this.isSheetNameDuplicate(sheetName)) {
                    errorType = this.WorksheetNameError.Duplicate;
                } else if(this.isSheetNameStartOrEndWithSingleQuote(sheetName)) {
                    errorType = this.WorksheetNameError.StartOrEndWithSingleQuote;
                } else if(this.isSheetNameContainsNotAllowedCharacters(sheetName)) {
                    errorType = this.WorksheetNameError.ContainsProhibitedCharacters;
                }
            } else {
                errorType = this.WorksheetNameError.Blank;
            }

            return errorType;
        },

        isSheetNameDuplicate: function(newSheetName) {
            var documentModel = this.getOwnerControl().getDocumentModel(),
                sheets = documentModel.getVisibleSheets().concat(documentModel.getHiddenSheets()),
                len = sheets.length,
                currentSheetId = documentModel.getActiveSheetId();
            while(len--) {
                var sheetName = sheets[len].Name,
                    sheetId = sheets[len].Id;
                if(sheetName === newSheetName && sheetId !== currentSheetId)
                    return true;
            }
            return false;
        },
        isSheetNameStartOrEndWithSingleQuote: function(newSheetName) {
            return newSheetName[0] === "'" || newSheetName[newSheetName.length - 1] === "'";
        },
        isSheetNameContainsNotAllowedCharacters: function(newSheetName) {
            var notAllowedSharacters = ["\\", "/", "?", "*", "]", "]", ":"],
                checkerFunc = function(element, index, array) {
                    return newSheetName.indexOf(element) >= 0;
                };
            return notAllowedSharacters.some(checkerFunc);
        },
        isSheetNameBlank: function(newSheetName) {
            return newSheetName.length === 0;
        },
        isSheetNameExceedAllowedLengt: function(newSheetName) {
            return newSheetName.length > 31;
        }
    });
})();
(function() {
    ASPxClientSpreadsheet.ChartDialogsHelper = ASPx.CreateClass(ASPxClientSpreadsheet.NonModalDialogHelper, {
        constructor: function(spreadsheet, dialog) {
            this.constructor.prototype.constructor.call(this, spreadsheet, dialog);
        },
        getChartLayoutPresetGroup: function() {
            return this.getSelectedChartAttribute("View");
        },
        getChartTitle: function() {
            return this.getSelectedChartAttribute("Title");
        },
        getChartDataRange: function() {
            return this.getSelectedChartAttribute("Range");
        },
        getChartHorizontalAxisTitle: function() {
            return this.getSelectedChartAttribute("HAxisTitle");
        },
        getChartVerticalAxisTitle: function() {
            return this.getSelectedChartAttribute("VAxisTitle");
        },
        getSelectedChartAttribute: function(attributeName) {
            var drawingBoxElement = this.getOwnerControl().getSelectionInternal().drawingBoxElement;
            if(!drawingBoxElement) return "";

            var chartIndex = ASPx.Attr.GetAttribute(drawingBoxElement, "data-dbi");

            return this.getOwnerControl().getChartAttributeById(chartIndex, attributeName);
        },
        cacheChartSheetIndex: function() {
            this.chartSheetIndex = this.getOwnerControl().getDocumentModel().getActiveSheetId();
        },
        getCachedChartSheetIndex: function() {
            return this.chartSheetIndex;
        },
        prepareDialog: function(range) {
            this.cacheChartSheetIndex();
            this.getDialog().setChartDataRangeTextBoxValue("=" + range);

            var editorElement = this.getDialog().getChartDataRangeTextBoxInputElement();
            this.initDynamicSelection(editorElement);
            this.switchToFormulaSheet(range);
        }
    });
})();
ASPxClientSpreadsheet.PopupMenuItems=[
	{'imageName':'Cut','textID':'MenuCmd_CutSelection','name':'w73'},
	{'imageName':'Copy','textID':'MenuCmd_CopySelection','name':'w72'},
	{'imageName':'Paste','textID':'MenuCmd_Paste','name':'w39'},
	{
		'imageName':'ChartGroupColumn',
		'beginGroup':true,
		'textID':'MenuCmd_ChangeChartType',
		'name':'w26'
	},
	{'imageName':'ChartSelectData','textID':'MenuCmd_ChartSelectData','name':'w27'},
	{'beginGroup':true,'textID':'MenuCmd_InsertSheetRowsContextMenuItem','name':'704'},
	{'textID':'MenuCmd_RemoveSheetRowsContextMenuItem','name':'1003'},
	{'beginGroup':true,'textID':'MenuCmd_InsertSheetColumnsContextMenuItem','name':'706'},
	{'textID':'MenuCmd_RemoveSheetColumnsContextMenuItem','name':'1005'},
	{'beginGroup':true,'textID':'MenuCmd_ChartChangeTitleContextMenuItem','name':'w30'},
	{'textID':'MenuCmd_ChartChangeHorizontalAxisTitleContextMenuItem','name':'w31'},
	{'textID':'MenuCmd_ChartChangeVerticalAxisTitleContextMenuItem','name':'w32'},
	{'beginGroup':true,'textID':'MenuCmd_FormatClearContents','name':'203'},
	{
		'imageName':'InsertComment',
		'beginGroup':true,
		'textID':'MenuCmd_InsertComment',
		'name':'w70'
	},
	{
		'imageName':'EditComment',
		'beginGroup':true,
		'textID':'MenuCmd_EditComment',
		'name':'3502'
	},
	{'imageName':'DeleteComment','textID':'MenuCmd_ReviewDeleteCommentContextMenuItem','name':'3505'},
	{'imageName':'ShowHideComment','textID':'MenuCmd_ReviewShowHideComment','name':'3506'},
	{
		'imageName':'FloatingObjectBringForward',
		'items':[
			{'imageName':'FloatingObjectBringForward','textID':'MenuCmd_FloatingObjectBringForward','name':'2602'},
			{'imageName':'FloatingObjectBringToFront','textID':'MenuCmd_FloatingObjectBringToFront','name':'2603'}
		],
		'beginGroup':true,
		'textID':'MenuCmd_FloatingObjectBringForwardCommandGroup',
		'name':'2600'
	},
	{
		'items':[
			{'imageName':'FloatingObjectSendBackward','textID':'MenuCmd_FloatingObjectSendBackward','name':'2606'},
			{'imageName':'FloatingObjectSendToBack','textID':'MenuCmd_FloatingObjectSendToBack','name':'2607'}
		],
		'imageName':'FloatingObjectSendBackward',
		'textID':'MenuCmd_FloatingObjectSendBackwardCommandGroup',
		'name':'2604'
	},
	{
		'imageName':'FormatCells',
		'beginGroup':true,
		'textID':'MenuCmd_FormatCellsContextMenuItem',
		'name':'w66'
	},
	{'imageName':'Hyperlink','textID':'MenuCmd_InsertHyperlink','name':'w11'},
	{'imageName':'Hyperlink','textID':'MenuCmd_EditHyperlink','name':'w16'},
	{'imageName':'Delete_Hyperlink','textID':'MenuCmd_RemoveHyperlink','name':'715'},
	{'textID':'MenuCmd_FormatRowHeight','name':'w22'},
	{'textID':'MenuCmd_FormatColumnWidth','name':'w23'},
	{'beginGroup':true,'textID':'MenuCmd_HideRows','name':'1203'},
	{'beginGroup':true,'textID':'MenuCmd_HideColumns','name':'1205'},
	{'textID':'MenuCmd_UnhideRows','name':'w20'},
	{'textID':'MenuCmd_UnhideColumns','name':'w21'},
	{'imageName':'ChartChangeLayout','textID':'Caption_GroupChartsDesignLayouts','name':'w29'},
	{'imageName':'ChartChangeStyle','textID':'Caption_GroupChartsDesignStyles','name':'w33'},
	{'imageName':'SortAsc','textID':'MenuCmd_SortAscending','name':'1477'},
	{'imageName':'SortDesc','textID':'MenuCmd_SortDescending','name':'1478'},
	{
		'imageName':'ClearFilter',
		'beginGroup':true,
		'textID':'MenuCmd_DataFilterColumnClear',
		'name':'1468'
	},
	{
		'items':[
			{'textID':'MenuCmd_DataFilterDateEquals','name':'1633'},
			{'beginGroup':true,'textID':'MenuCmd_DataFilterDateBefore','name':'1634'},
			{'textID':'MenuCmd_DataFilterDateAfter','name':'1635'},
			{'textID':'MenuCmd_DataFilterDateBetween','name':'1636'},
			{'beginGroup':true,'textID':'MenuCmd_DataFilterTomorrow','name':'1602'},
			{'textID':'MenuCmd_DataFilterToday','name':'1600'},
			{'textID':'MenuCmd_DataFilterYesterday','name':'1601'},
			{'beginGroup':true,'textID':'MenuCmd_DataFilterNextWeek','name':'1605'},
			{'textID':'MenuCmd_DataFilterThisWeek','name':'1603'},
			{'textID':'MenuCmd_DataFilterLastWeek','name':'1604'},
			{'beginGroup':true,'textID':'MenuCmd_DataFilterNextMonth','name':'1608'},
			{'textID':'MenuCmd_DataFilterThisMonth','name':'1606'},
			{'textID':'MenuCmd_DataFilterLastMonth','name':'1607'},
			{'beginGroup':true,'textID':'MenuCmd_DataFilterNextQuarter','name':'1611'},
			{'textID':'MenuCmd_DataFilterThisQuarter','name':'1609'},
			{'textID':'MenuCmd_DataFilterLastQuarter','name':'1610'},
			{'beginGroup':true,'textID':'MenuCmd_DataFilterNextYear','name':'1614'},
			{'textID':'MenuCmd_DataFilterThisYear','name':'1612'},
			{'textID':'MenuCmd_DataFilterLastYear','name':'1613'},
			{'beginGroup':true,'textID':'MenuCmd_DataFilterYearToDate','name':'1615'},
			{
				'items':[
					{'textID':'MenuCmd_DataFilterQuarter_1','name':'1616'},
					{'textID':'MenuCmd_DataFilterQuarter_2','name':'1617'},
					{'textID':'MenuCmd_DataFilterQuarter_3','name':'1618'},
					{'textID':'MenuCmd_DataFilterQuarter_4','name':'1619'},
					{'beginGroup':true,'textID':'MenuCmd_DataFilterMonth_0','name':'1620'},
					{'textID':'MenuCmd_DataFilterMonth_1','name':'1621'},
					{'textID':'MenuCmd_DataFilterMonth_2','name':'1622'},
					{'textID':'MenuCmd_DataFilterMonth_3','name':'1623'},
					{'textID':'MenuCmd_DataFilterMonth_4','name':'1624'},
					{'textID':'MenuCmd_DataFilterMonth_5','name':'1625'},
					{'textID':'MenuCmd_DataFilterMonth_6','name':'1626'},
					{'textID':'MenuCmd_DataFilterMonth_7','name':'1627'},
					{'textID':'MenuCmd_DataFilterMonth_8','name':'1628'},
					{'textID':'MenuCmd_DataFilterMonth_9','name':'1630'},
					{'textID':'MenuCmd_DataFilterMonth_10','name':'1631'},
					{'textID':'MenuCmd_DataFilterMonth_11','name':'1632'}
				],
				'textID':'MenuCmd_DataFilterAllDatesInPeriodFilters',
				'name':'1476'
			},
			{'beginGroup':true,'textID':'MenuCmd_DataFilterDateCustom','name':'1637'}
		],
		'textID':'MenuCmd_DataFilterDateFilters',
		'name':'1475'
	},
	{
		'items':[
			{'textID':'MenuCmd_DataFilterEquals','name':'1452'},
			{'textID':'MenuCmd_DataFilterDoesNotEqual','name':'1453'},
			{'beginGroup':true,'textID':'MenuCmd_DataFilterBeginsWith','name':'1462'},
			{'textID':'MenuCmd_DataFilterEndsWith','name':'1463'},
			{'beginGroup':true,'textID':'MenuCmd_DataFilterContains','name':'1464'},
			{'textID':'MenuCmd_DataFilterDoesNotContain','name':'1465'},
			{'beginGroup':true,'textID':'MenuCmd_DataFilterCustom','name':'1466'}
		],
		'textID':'MenuCmd_DataFilterTextFilters',
		'name':'1474'
	},
	{
		'items':[
			{'textID':'MenuCmd_DataFilterEquals','name':'1452'},
			{'textID':'MenuCmd_DataFilterDoesNotEqual','name':'1453'},
			{'beginGroup':true,'textID':'MenuCmd_DataFilterGreaterThan','name':'1454'},
			{'textID':'MenuCmd_DataFilterGreaterThanOrEqualTo','name':'1455'},
			{'textID':'MenuCmd_DataFilterLessThan','name':'1456'},
			{'textID':'MenuCmd_DataFilterLessThanOrEqualTo','name':'1457'},
			{'textID':'MenuCmd_DataFilterBetween','name':'1458'},
			{'beginGroup':true,'textID':'MenuCmd_DataFilterTop10','name':'1459'},
			{'textID':'MenuCmd_DataFilterAboveAverage','name':'1460'},
			{'textID':'MenuCmd_DataFilterBelowAverage','name':'1461'},
			{'beginGroup':true,'textID':'MenuCmd_DataFilterCustom','name':'1466'}
		],
		'textID':'MenuCmd_DataFilterNumberFilters',
		'name':'1473'
	},
	{'beginGroup':true,'textID':'MenuCmd_DataFilterSimple','name':'1471'},
	{
		'imageName':'RefreshPivotTable',
		'beginGroup':true,
		'textID':'MenuCmd_PivotTableRefreshCommandAndCommandGroup',
		'name':'3819'
	},
	{'imageName':'FieldListPanelPivotTable','textID':'MenuCmd_ShowFieldListPanelPivotTableContextMenuItem','name':'w79'},
	{
		'groupName':'pt_fl',
		'imageName':'FieldListPanelPivotTable',
		'checked':true,
		'textID':'MenuCmd_HideFieldListPanelPivotTableContextMenuItem',
		'name':'w81'
	},
	{'textID':'MenuCmd_PivotTableFieldsFilters','name':'3869'},
	{
		'groupName':'pt_s',
		'textID':'MenuCmd_PivotSortAscending',
		'beginGroup':true,
		'checked':false,
		'imageName':'SortAsc',
		'name':'3937'
	},
	{
		'groupName':'pt_s',
		'imageName':'SortDesc',
		'checked':false,
		'textID':'MenuCmd_PivotSortDescending',
		'name':'3938'
	},
	{
		'imageName':'ClearFilter',
		'beginGroup':true,
		'textID':'MenuCmd_DataFilterColumnClear',
		'name':'3934'
	},
	{
		'items':[
			{'imageName':'ClearFilter','textID':'MenuCmd_PivotClearFieldFilter','name':'3935'},
			{
				'groupName':'pt_lf',
				'filterType':4,
				'textID':'MenuCmd_DataFilterEquals',
				'beginGroup':true,
				'checked':false,
				'name':'3911'
			},
			{
				'filterType':5,
				'groupName':'pt_lf',
				'checked':false,
				'textID':'MenuCmd_DataFilterDoesNotEqual',
				'name':'3912'
			},
			{
				'groupName':'pt_lf',
				'filterType':6,
				'textID':'MenuCmd_DataFilterBeginsWith',
				'beginGroup':true,
				'checked':false,
				'name':'3913'
			},
			{
				'filterType':7,
				'groupName':'pt_lf',
				'checked':false,
				'textID':'MenuCmd_PivotLabelFilterDoesNotBeginWith',
				'name':'3914'
			},
			{
				'filterType':8,
				'groupName':'pt_lf',
				'checked':false,
				'textID':'MenuCmd_DataFilterEndsWith',
				'name':'3915'
			},
			{
				'filterType':9,
				'groupName':'pt_lf',
				'checked':false,
				'textID':'MenuCmd_PivotLabelFilterDoesNotEndWith',
				'name':'3916'
			},
			{
				'groupName':'pt_lf',
				'filterType':10,
				'textID':'MenuCmd_DataFilterContains',
				'beginGroup':true,
				'checked':false,
				'name':'3917'
			},
			{
				'filterType':11,
				'groupName':'pt_lf',
				'checked':false,
				'textID':'MenuCmd_DataFilterDoesNotContain',
				'name':'3918'
			},
			{
				'groupName':'pt_lf',
				'filterType':12,
				'textID':'MenuCmd_DataFilterGreaterThan',
				'beginGroup':true,
				'checked':false,
				'name':'3919'
			},
			{
				'filterType':13,
				'groupName':'pt_lf',
				'checked':false,
				'textID':'MenuCmd_DataFilterGreaterThanOrEqualTo',
				'name':'3920'
			},
			{
				'filterType':14,
				'groupName':'pt_lf',
				'checked':false,
				'textID':'MenuCmd_DataFilterLessThan',
				'name':'3921'
			},
			{
				'filterType':15,
				'groupName':'pt_lf',
				'checked':false,
				'textID':'MenuCmd_DataFilterLessThanOrEqualTo',
				'name':'3922'
			},
			{
				'groupName':'pt_lf',
				'filterType':16,
				'textID':'MenuCmd_DataFilterBetween',
				'beginGroup':true,
				'checked':false,
				'name':'3923'
			},
			{
				'filterType':17,
				'groupName':'pt_lf',
				'checked':false,
				'textID':'MenuCmd_PivotLabelFilterNotBetween',
				'name':'3924'
			}
		],
		'textID':'MenuCmd_PivotTableLabelFilters',
		'name':'3870'
	},
	{
		'items':[
			{'imageName':'ClearFilter','textID':'MenuCmd_PivotClearFieldFilter','name':'3935'},
			{
				'groupName':'pt_df',
				'filterType':26,
				'textID':'MenuCmd_DataFilterDateEquals',
				'beginGroup':true,
				'checked':false,
				'name':'3906'
			},
			{
				'groupName':'pt_df',
				'filterType':27,
				'textID':'MenuCmd_DataFilterDateBefore',
				'beginGroup':true,
				'checked':false,
				'name':'3907'
			},
			{
				'filterType':28,
				'groupName':'pt_df',
				'checked':false,
				'textID':'MenuCmd_DataFilterDateAfter',
				'name':'3908'
			},
			{
				'filterType':29,
				'groupName':'pt_df',
				'checked':false,
				'textID':'MenuCmd_DataFilterDateBetween',
				'name':'3909'
			},
			{
				'groupName':'pt_df',
				'filterType':30,
				'textID':'MenuCmd_DataFilterTomorrow',
				'beginGroup':true,
				'checked':false,
				'name':'3876'
			},
			{
				'filterType':31,
				'groupName':'pt_df',
				'checked':false,
				'textID':'MenuCmd_DataFilterToday',
				'name':'3874'
			},
			{
				'filterType':32,
				'groupName':'pt_df',
				'checked':false,
				'textID':'MenuCmd_DataFilterYesterday',
				'name':'3875'
			},
			{
				'groupName':'pt_df',
				'filterType':33,
				'textID':'MenuCmd_DataFilterNextWeek',
				'beginGroup':true,
				'checked':false,
				'name':'3878'
			},
			{
				'filterType':34,
				'groupName':'pt_df',
				'checked':false,
				'textID':'MenuCmd_DataFilterThisWeek',
				'name':'3877'
			},
			{
				'filterType':35,
				'groupName':'pt_df',
				'checked':false,
				'textID':'MenuCmd_DataFilterLastWeek',
				'name':'3879'
			},
			{
				'groupName':'pt_df',
				'filterType':36,
				'textID':'MenuCmd_DataFilterNextMonth',
				'beginGroup':true,
				'checked':false,
				'name':'3881'
			},
			{
				'filterType':37,
				'groupName':'pt_df',
				'checked':false,
				'textID':'MenuCmd_DataFilterThisMonth',
				'name':'3880'
			},
			{
				'filterType':38,
				'groupName':'pt_df',
				'checked':false,
				'textID':'MenuCmd_DataFilterLastMonth',
				'name':'3882'
			},
			{
				'groupName':'pt_df',
				'filterType':39,
				'textID':'MenuCmd_DataFilterNextQuarter',
				'beginGroup':true,
				'checked':false,
				'name':'3884'
			},
			{
				'filterType':40,
				'groupName':'pt_df',
				'checked':false,
				'textID':'MenuCmd_DataFilterThisQuarter',
				'name':'3883'
			},
			{
				'filterType':41,
				'groupName':'pt_df',
				'checked':false,
				'textID':'MenuCmd_DataFilterLastQuarter',
				'name':'3885'
			},
			{
				'groupName':'pt_df',
				'filterType':42,
				'textID':'MenuCmd_DataFilterNextYear',
				'beginGroup':true,
				'checked':false,
				'name':'3887'
			},
			{
				'filterType':43,
				'groupName':'pt_df',
				'checked':false,
				'textID':'MenuCmd_DataFilterThisYear',
				'name':'3886'
			},
			{
				'filterType':44,
				'groupName':'pt_df',
				'checked':false,
				'textID':'MenuCmd_DataFilterLastYear',
				'name':'3888'
			},
			{
				'groupName':'pt_df',
				'filterType':45,
				'textID':'MenuCmd_DataFilterYearToDate',
				'beginGroup':true,
				'checked':false,
				'name':'3889'
			},
			{
				'items':[
					{
						'filterType':46,
						'groupName':'pt_df',
						'checked':false,
						'textID':'MenuCmd_DataFilterQuarter_1',
						'name':'3890'
					},
					{
						'filterType':47,
						'groupName':'pt_df',
						'checked':false,
						'textID':'MenuCmd_DataFilterQuarter_2',
						'name':'3891'
					},
					{
						'filterType':48,
						'groupName':'pt_df',
						'checked':false,
						'textID':'MenuCmd_DataFilterQuarter_3',
						'name':'3892'
					},
					{
						'filterType':49,
						'groupName':'pt_df',
						'checked':false,
						'textID':'MenuCmd_DataFilterQuarter_4',
						'name':'3893'
					},
					{
						'groupName':'pt_df',
						'filterType':50,
						'textID':'MenuCmd_DataFilterMonth_0',
						'beginGroup':true,
						'checked':false,
						'name':'3894'
					},
					{
						'filterType':51,
						'groupName':'pt_df',
						'checked':false,
						'textID':'MenuCmd_DataFilterMonth_1',
						'name':'3895'
					},
					{
						'filterType':52,
						'groupName':'pt_df',
						'checked':false,
						'textID':'MenuCmd_DataFilterMonth_2',
						'name':'3896'
					},
					{
						'filterType':53,
						'groupName':'pt_df',
						'checked':false,
						'textID':'MenuCmd_DataFilterMonth_3',
						'name':'3897'
					},
					{
						'filterType':54,
						'groupName':'pt_df',
						'checked':false,
						'textID':'MenuCmd_DataFilterMonth_4',
						'name':'3898'
					},
					{
						'filterType':55,
						'groupName':'pt_df',
						'checked':false,
						'textID':'MenuCmd_DataFilterMonth_5',
						'name':'3899'
					},
					{
						'filterType':56,
						'groupName':'pt_df',
						'checked':false,
						'textID':'MenuCmd_DataFilterMonth_6',
						'name':'3900'
					},
					{
						'filterType':57,
						'groupName':'pt_df',
						'checked':false,
						'textID':'MenuCmd_DataFilterMonth_7',
						'name':'3901'
					},
					{
						'filterType':58,
						'groupName':'pt_df',
						'checked':false,
						'textID':'MenuCmd_DataFilterMonth_8',
						'name':'3902'
					},
					{
						'filterType':59,
						'groupName':'pt_df',
						'checked':false,
						'textID':'MenuCmd_DataFilterMonth_9',
						'name':'3903'
					},
					{
						'filterType':60,
						'groupName':'pt_df',
						'checked':false,
						'textID':'MenuCmd_DataFilterMonth_10',
						'name':'3904'
					},
					{
						'filterType':61,
						'groupName':'pt_df',
						'checked':false,
						'textID':'MenuCmd_DataFilterMonth_11',
						'name':'3905'
					}
				],
				'beginGroup':true,
				'textID':'MenuCmd_DataFilterAllDatesInPeriodFilters',
				'name':'3873'
			},
			{
				'groupName':'pt_df',
				'filterType':62,
				'textID':'MenuCmd_DataFilterDateCustom',
				'beginGroup':true,
				'checked':false,
				'name':'3910'
			}
		],
		'textID':'MenuCmd_PivotTableDateFilters',
		'name':'3871'
	},
	{
		'items':[
			{'imageName':'ClearFilter','textID':'MenuCmd_PivotClearFieldFilter','name':'3936'},
			{
				'groupName':'pt_vf',
				'filterType':18,
				'textID':'MenuCmd_DataFilterEquals',
				'beginGroup':true,
				'checked':false,
				'name':'3925'
			},
			{
				'filterType':19,
				'groupName':'pt_vf',
				'checked':false,
				'textID':'MenuCmd_DataFilterDoesNotEqual',
				'name':'3926'
			},
			{
				'groupName':'pt_vf',
				'filterType':20,
				'textID':'MenuCmd_DataFilterGreaterThan',
				'beginGroup':true,
				'checked':false,
				'name':'3927'
			},
			{
				'filterType':21,
				'groupName':'pt_vf',
				'checked':false,
				'textID':'MenuCmd_DataFilterGreaterThanOrEqualTo',
				'name':'3928'
			},
			{
				'filterType':22,
				'groupName':'pt_vf',
				'checked':false,
				'textID':'MenuCmd_DataFilterLessThan',
				'name':'3929'
			},
			{
				'filterType':23,
				'groupName':'pt_vf',
				'checked':false,
				'textID':'MenuCmd_DataFilterLessThanOrEqualTo',
				'name':'3930'
			},
			{
				'groupName':'pt_vf',
				'filterType':24,
				'textID':'MenuCmd_DataFilterBetween',
				'beginGroup':true,
				'checked':false,
				'name':'3931'
			},
			{
				'filterType':25,
				'groupName':'pt_vf',
				'checked':false,
				'textID':'MenuCmd_PivotLabelFilterNotBetween',
				'name':'3932'
			},
			{
				'groupName':'pt_vf',
				'filterType':1,
				'textID':'MenuCmd_DataFilterTop10',
				'beginGroup':true,
				'checked':false,
				'name':'3933'
			}
		],
		'textID':'MenuCmd_PivotTableValueFilters',
		'name':'3872'
	},
	{'beginGroup':true,'textID':'MenuCmd_PivotTableItemFilter','name':'3851'},
	{'beginGroup':true,'textID':'MenuCmd_PivotTableItemFilter','name':'3852'},
	{'imageName':'InsertSheet','textID':'MenuCmd_InsertSheet','name':'701'},
	{'imageName':'RemoveSheet','textID':'MenuCmd_RemoveSheet','name':'w53'},
	{'textID':'MenuCmd_RenameSheet','name':'w15'},
	{'textID':'MenuCmd_MoveOrCopySheet','name':'w47'},
	{'textID':'MenuCmd_HideSheet','name':'1207'},
	{'textID':'MenuCmd_UnhideSheet','name':'w25'}
]
;
ASPxClientSpreadsheet.Localization={
	'MenuCmd_CutSelection':'Cut',
	'MenuCmd_CopySelection':'Copy',
	'MenuCmd_Paste':'Paste',
	'MenuCmd_ChangeChartType':'Change Chart Type',
	'MenuCmd_ChartSelectData':'Select Data',
	'MenuCmd_InsertSheetRowsContextMenuItem':'Insert',
	'MenuCmd_RemoveSheetRowsContextMenuItem':'Delete',
	'MenuCmd_InsertSheetColumnsContextMenuItem':'Insert',
	'MenuCmd_RemoveSheetColumnsContextMenuItem':'Delete',
	'MenuCmd_ChartChangeTitleContextMenuItem':'Change Chart Title...',
	'MenuCmd_ChartChangeHorizontalAxisTitleContextMenuItem':'Change Horizontal Axis Title...',
	'MenuCmd_ChartChangeVerticalAxisTitleContextMenuItem':'Change Vertical Axis Title...',
	'MenuCmd_FormatClearContents':'Clear Contents',
	'MenuCmd_InsertComment':'New Comment',
	'MenuCmd_EditComment':'Edit Comment',
	'MenuCmd_ReviewDeleteCommentContextMenuItem':'Delete Comment',
	'MenuCmd_ReviewShowHideComment':'Show/Hide Comment',
	'MenuCmd_FloatingObjectBringForwardCommandGroup':'Bring Forward',
	'MenuCmd_FloatingObjectBringForward':'Bring Forward',
	'MenuCmd_FloatingObjectBringToFront':'Bring to Front',
	'MenuCmd_FloatingObjectSendBackwardCommandGroup':'Send Backward',
	'MenuCmd_FloatingObjectSendBackward':'Send Backward',
	'MenuCmd_FloatingObjectSendToBack':'Send to Back',
	'MenuCmd_FormatCellsContextMenuItem':'Format Cells...',
	'MenuCmd_InsertHyperlink':'Hyperlink...',
	'MenuCmd_EditHyperlink':'Edit Hyperlink...',
	'MenuCmd_RemoveHyperlink':'Remove Hyperlink',
	'MenuCmd_FormatRowHeight':'Row Height...',
	'MenuCmd_FormatColumnWidth':'Column Width...',
	'MenuCmd_HideRows':'Hide Rows',
	'MenuCmd_HideColumns':'Hide Columns',
	'MenuCmd_UnhideRows':'Unhide Rows',
	'MenuCmd_UnhideColumns':'Unhide Columns',
	'Caption_GroupChartsDesignLayouts':'Chart Layouts',
	'Caption_GroupChartsDesignStyles':'Chart Styles',
	'MenuCmd_SortAscending':'Sort A to Z',
	'MenuCmd_SortDescending':'Sort Z to A',
	'MenuCmd_DataFilterColumnClear':'Clear Filter From \'{0}\'',
	'MenuCmd_DataFilterDateFilters':'Date filters',
	'MenuCmd_DataFilterDateEquals':'Equals...',
	'MenuCmd_DataFilterDateBefore':'Before...',
	'MenuCmd_DataFilterDateAfter':'After...',
	'MenuCmd_DataFilterDateBetween':'Between...',
	'MenuCmd_DataFilterTomorrow':'Tomorrow',
	'MenuCmd_DataFilterToday':'Today',
	'MenuCmd_DataFilterYesterday':'Yesterday',
	'MenuCmd_DataFilterNextWeek':'Next Week',
	'MenuCmd_DataFilterThisWeek':'This Week',
	'MenuCmd_DataFilterLastWeek':'Last Week',
	'MenuCmd_DataFilterNextMonth':'Next Month',
	'MenuCmd_DataFilterThisMonth':'This Month',
	'MenuCmd_DataFilterLastMonth':'Last Month',
	'MenuCmd_DataFilterNextQuarter':'Next Quarter',
	'MenuCmd_DataFilterThisQuarter':'This Quarter',
	'MenuCmd_DataFilterLastQuarter':'Last Quarter',
	'MenuCmd_DataFilterNextYear':'Next Year',
	'MenuCmd_DataFilterThisYear':'This Year',
	'MenuCmd_DataFilterLastYear':'Last Year',
	'MenuCmd_DataFilterYearToDate':'Year to Date',
	'MenuCmd_DataFilterAllDatesInPeriodFilters':'All Dates in the Period',
	'MenuCmd_DataFilterQuarter_1':'Quarter 1',
	'MenuCmd_DataFilterQuarter_2':'Quarter 2',
	'MenuCmd_DataFilterQuarter_3':'Quarter 3',
	'MenuCmd_DataFilterQuarter_4':'Quarter 4',
	'MenuCmd_DataFilterMonth_0':'January',
	'MenuCmd_DataFilterMonth_1':'February',
	'MenuCmd_DataFilterMonth_2':'March',
	'MenuCmd_DataFilterMonth_3':'April',
	'MenuCmd_DataFilterMonth_4':'May',
	'MenuCmd_DataFilterMonth_5':'June',
	'MenuCmd_DataFilterMonth_6':'July',
	'MenuCmd_DataFilterMonth_7':'August',
	'MenuCmd_DataFilterMonth_8':'September',
	'MenuCmd_DataFilterMonth_9':'October',
	'MenuCmd_DataFilterMonth_10':'November',
	'MenuCmd_DataFilterMonth_11':'December',
	'MenuCmd_DataFilterDateCustom':'Custom Filter...',
	'MenuCmd_DataFilterTextFilters':'Text Filters',
	'MenuCmd_DataFilterEquals':'Equals...',
	'MenuCmd_DataFilterDoesNotEqual':'Does Not Equal...',
	'MenuCmd_DataFilterBeginsWith':'Begins With...',
	'MenuCmd_DataFilterEndsWith':'Ends With...',
	'MenuCmd_DataFilterContains':'Contains...',
	'MenuCmd_DataFilterDoesNotContain':'Does Not Contain...',
	'MenuCmd_DataFilterCustom':'Custom Filter...',
	'MenuCmd_DataFilterNumberFilters':'Number Filters',
	'MenuCmd_DataFilterGreaterThan':'Greater Than...',
	'MenuCmd_DataFilterGreaterThanOrEqualTo':'Greater Than Or Equal To...',
	'MenuCmd_DataFilterLessThan':'Less Than...',
	'MenuCmd_DataFilterLessThanOrEqualTo':'Less Than Or Equal To...',
	'MenuCmd_DataFilterBetween':'Between...',
	'MenuCmd_DataFilterTop10':'Top 10 ...',
	'MenuCmd_DataFilterAboveAverage':'Above Average',
	'MenuCmd_DataFilterBelowAverage':'Below Average',
	'MenuCmd_DataFilterSimple':'Filter by Values ...',
	'MenuCmd_PivotTableRefreshCommandAndCommandGroup':'Refresh',
	'MenuCmd_ShowFieldListPanelPivotTableContextMenuItem':'Show Field List',
	'MenuCmd_HideFieldListPanelPivotTableContextMenuItem':'Hide Field List',
	'MenuCmd_PivotTableFieldsFilters':'Select Field:',
	'MenuCmd_PivotSortAscending':'Sort A to Z',
	'MenuCmd_PivotSortAscendingOnlyNumbers':'Sort Smallest to Largest',
	'MenuCmd_PivotSortAscendingOnlyDates':'Sort Oldest to Newest',
	'MenuCmd_PivotSortDescending':'Sort Z to A',
	'MenuCmd_PivotSortDescendingOnlyNumbers':'Sort Largest to Smallest',
	'MenuCmd_PivotSortDescendingOnlyDates':'Sort Newest to Oldest',
	'MenuCmd_PivotTableLabelFilters':'Label Filters',
	'MenuCmd_PivotClearFieldFilter':'Clear Filter',
	'MenuCmd_PivotLabelFilterDoesNotBeginWith':'Does Not Begin With...',
	'MenuCmd_PivotLabelFilterDoesNotEndWith':'Does Not End With...',
	'MenuCmd_PivotLabelFilterNotBetween':'Not Between...',
	'MenuCmd_PivotTableDateFilters':'Date Filters',
	'MenuCmd_PivotTableValueFilters':'Value Filters',
	'MenuCmd_PivotTableItemFilter':'Item Filter...',
	'MenuCmd_InsertSheet':'Insert Sheet',
	'MenuCmd_RemoveSheet':'Delete Sheet',
	'MenuCmd_RenameSheet':'Rename Sheet...',
	'MenuCmd_MoveOrCopySheet':'Move or Copy Sheet...',
	'MenuCmd_HideSheet':'Hide Sheet',
	'MenuCmd_UnhideSheet':'Unhide Sheet...'
};
ASPxClientSpreadsheet.Functions = [
	{
		name: "ABS",
		description: "Returns the absolute value of a number, a number without its sign.",
		arguments: [
			{
				name: "number",
				description: "is the real number for which you want the absolute value"
			}
		]
	},
	{
		name: "ACCRINTM",
		description: "Returns the accrued interest for a security that pays interest at maturity.",
		arguments: [
			{
				name: "issue",
				description: "is the security's issue date, expressed as a serial date number"
			},
			{
				name: "settlement",
				description: "is the security's maturity date, expressed as a serial date number"
			},
			{
				name: "rate",
				description: "is the security's annual coupon rate"
			},
			{
				name: "par",
				description: "is the security's par value"
			},
			{
				name: "basis",
				description: "is the type of day count basis to use"
			}
		]
	},
	{
		name: "ACOS",
		description: "Returns the arccosine of a number, in radians in the range 0 to Pi. The arccosine is the angle whose cosine is Number.",
		arguments: [
			{
				name: "number",
				description: "is the cosine of the angle you want and must be from -1 to 1"
			}
		]
	},
	{
		name: "ACOSH",
		description: "Returns the inverse hyperbolic cosine of a number.",
		arguments: [
			{
				name: "number",
				description: "is any real number equal to or greater than 1"
			}
		]
	},
	{
		name: "ACOT",
		description: "Returns the arccotangent of a number, in radians in the range 0 to Pi.",
		arguments: [
			{
				name: "number",
				description: "is the cotangent of the angle you want"
			}
		]
	},
	{
		name: "ACOTH",
		description: "Returns the inverse hyperbolic cotangent of a number.",
		arguments: [
			{
				name: "number",
				description: "is the hyperbolic cotangent of the angle that you want"
			}
		]
	},
	{
		name: "ADDRESS",
		description: "Creates a cell reference as text, given specified row and column numbers.",
		arguments: [
			{
				name: "row_num",
				description: "is the row number to use in the cell reference: Row_number = 1 for row 1"
			},
			{
				name: "column_num",
				description: "is the column number to use in the cell reference. For example, Column_number = 4 for column D"
			},
			{
				name: "abs_num",
				description: "specifies the reference type: absolute = 1; absolute row/relative column = 2; relative row/absolute column = 3; relative = 4"
			},
			{
				name: "a1",
				description: "is a logical value that specifies the reference style: A1 style = 1 or TRUE; R1C1 style = 0 or FALSE"
			},
			{
				name: "sheet_text",
				description: "is text specifying the name of the worksheet to be used as the external reference"
			}
		]
	},
	{
		name: "AGGREGATE",
		description: "Returns an aggregate in a list or database.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "function_num",
				description: "is the number 1 to 19 that specifies the summary function for the aggregate."
			},
			{
				name: "options",
				description: "is the number 0 to 7 that specifies the values to ignore for the aggregate"
			},
			{
				name: "array",
				description: "is the array or range of numerical data on which to calculate the aggregate"
			},
			{
				name: "k",
				description: "indicates the position in the array; it is k-th largest, k-th smallest, k-th percentile, or k-th quartile."
			}
		]
	},
	{
		name: "AND",
		description: "Checks whether all arguments are TRUE, and returns TRUE if all arguments are TRUE.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "logical1",
				description: "are 1 to 255 conditions you want to test that can be either TRUE or FALSE and can be logical values, arrays, or references"
			},
			{
				name: "logical2",
				description: "are 1 to 255 conditions you want to test that can be either TRUE or FALSE and can be logical values, arrays, or references"
			}
		]
	},
	{
		name: "ARABIC",
		description: "Converts a Roman numeral to Arabic.",
		arguments: [
			{
				name: "text",
				description: "is the Roman numeral you want to convert"
			}
		]
	},
	{
		name: "AREAS",
		description: "Returns the number of areas in a reference. An area is a range of contiguous cells or a single cell.",
		arguments: [
			{
				name: "reference",
				description: "is a reference to a cell or range of cells and can refer to multiple areas"
			}
		]
	},
	{
		name: "ASIN",
		description: "Returns the arcsine of a number in radians, in the range -Pi/2 to Pi/2.",
		arguments: [
			{
				name: "number",
				description: "is the sine of the angle you want and must be from -1 to 1"
			}
		]
	},
	{
		name: "ASINH",
		description: "Returns the inverse hyperbolic sine of a number.",
		arguments: [
			{
				name: "number",
				description: "is any real number equal to or greater than 1"
			}
		]
	},
	{
		name: "ATAN",
		description: "Returns the arctangent of a number in radians, in the range -Pi/2 to Pi/2.",
		arguments: [
			{
				name: "number",
				description: "is the tangent of the angle you want"
			}
		]
	},
	{
		name: "ATAN2",
		description: "Returns the arctangent of the specified x- and y- coordinates, in radians between -Pi and Pi, excluding -Pi.",
		arguments: [
			{
				name: "x_num",
				description: "is the x-coordinate of the point"
			},
			{
				name: "y_num",
				description: "is the y-coordinate of the point"
			}
		]
	},
	{
		name: "ATANH",
		description: "Returns the inverse hyperbolic tangent of a number.",
		arguments: [
			{
				name: "number",
				description: "is any real number between -1 and 1 excluding -1 and 1"
			}
		]
	},
	{
		name: "AVEDEV",
		description: "Returns the average of the absolute deviations of data points from their mean. Arguments can be numbers or names, arrays, or references that contain numbers.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 arguments for which you want the average of the absolute deviations"
			},
			{
				name: "number2",
				description: "are 1 to 255 arguments for which you want the average of the absolute deviations"
			}
		]
	},
	{
		name: "AVERAGE",
		description: "Returns the average (arithmetic mean) of its arguments, which can be numbers or names, arrays, or references that contain numbers.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numeric arguments for which you want the average"
			},
			{
				name: "number2",
				description: "are 1 to 255 numeric arguments for which you want the average"
			}
		]
	},
	{
		name: "AVERAGEA",
		description: "Returns the average (arithmetic mean) of its arguments, evaluating text and FALSE in arguments as 0; TRUE evaluates as 1. Arguments can be numbers, names, arrays, or references.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "value1",
				description: "are 1 to 255 arguments for which you want the average"
			},
			{
				name: "value2",
				description: "are 1 to 255 arguments for which you want the average"
			}
		]
	},
	{
		name: "AVERAGEIF",
		description: "Finds average(arithmetic mean) for the cells specified by a given condition or criteria.",
		arguments: [
			{
				name: "range",
				description: "is the range of cells you want evaluated"
			},
			{
				name: "criteria",
				description: "is the condition or criteria in the form of a number, expression, or text that defines which cells will be used to find the average"
			},
			{
				name: "average_range",
				description: "are the actual cells to be used to find the average. If omitted, the cells in range are used "
			}
		]
	},
	{
		name: "AVERAGEIFS",
		description: "Finds average(arithmetic mean) for the cells specified by a given set of conditions or criteria.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "average_range",
				description: "are the actual cells to be used to find the average."
			},
			{
				name: "criteria_range",
				description: "is the range of cells you want evaluated for the particular condition"
			},
			{
				name: "criteria",
				description: "is the condition or criteria in the form of a number, expression, or text that defines which cells will be used to find the average"
			}
		]
	},
	{
		name: "BAHTTEXT",
		description: "Converts a number to text (baht).",
		arguments: [
			{
				name: "number",
				description: "is a number that you want to convert"
			}
		]
	},
	{
		name: "BASE",
		description: "Converts a number into a text representation with the given radix (base).",
		arguments: [
			{
				name: "number",
				description: "is the number that you want to convert"
			},
			{
				name: "radix",
				description: "is the base Radix that you want to convert the number into"
			},
			{
				name: "min_length",
				description: "is the minimum length of the returned string.  If omitted leading zeros are not added"
			}
		]
	},
	{
		name: "BESSELI",
		description: "Returns the modified Bessel function In(x).",
		arguments: [
			{
				name: "x",
				description: "is the value at which to evaluate the function"
			},
			{
				name: "n",
				description: "is the order of the Bessel function"
			}
		]
	},
	{
		name: "BESSELJ",
		description: "Returns the Bessel function Jn(x).",
		arguments: [
			{
				name: "x",
				description: "is the value at which to evaluate the function"
			},
			{
				name: "n",
				description: "is the order of the Bessel function"
			}
		]
	},
	{
		name: "BESSELK",
		description: "Returns the modified Bessel function Kn(x).",
		arguments: [
			{
				name: "x",
				description: "is the value at which to evaluate the function"
			},
			{
				name: "n",
				description: "is the order of the function"
			}
		]
	},
	{
		name: "BESSELY",
		description: "Returns the Bessel function Yn(x).",
		arguments: [
			{
				name: "x",
				description: "is the value at which to evaluate the function"
			},
			{
				name: "n",
				description: "is the order of the function"
			}
		]
	},
	{
		name: "BETA.DIST",
		description: "Returns the beta probability distribution function.",
		arguments: [
			{
				name: "x",
				description: "is the value between A and B at which to evaluate the function"
			},
			{
				name: "alpha",
				description: "is a parameter to the distribution and must be greater than 0"
			},
			{
				name: "beta",
				description: "is a parameter to the distribution and must be greater than 0"
			},
			{
				name: "cumulative",
				description: "is a logical value: for the cumulative distribution function, use TRUE; for the probability density function, use FALSE"
			},
			{
				name: "A",
				description: "is an optional lower bound to the interval of x. If omitted, A = 0"
			},
			{
				name: "B",
				description: "is an optional upper bound to the interval of x. If omitted, B = 1"
			}
		]
	},
	{
		name: "BETA.INV",
		description: "Returns the inverse of the cumulative beta probability density function (BETA.DIST).",
		arguments: [
			{
				name: "probability",
				description: "is a probability associated with the beta distribution"
			},
			{
				name: "alpha",
				description: "is a parameter to the distribution and must be greater than 0"
			},
			{
				name: "beta",
				description: "is a parameter to the distribution and must be greater than 0"
			},
			{
				name: "A",
				description: "is an optional lower bound to the interval of x. If omitted, A = 0"
			},
			{
				name: "B",
				description: "is an optional upper bound to the interval of x. If omitted, B = 1"
			}
		]
	},
	{
		name: "BETADIST",
		description: "Returns the cumulative beta probability density function.",
		arguments: [
			{
				name: "x",
				description: "is the value between A and B at which to evaluate the function"
			},
			{
				name: "alpha",
				description: "is a parameter to the distribution and must be greater than 0"
			},
			{
				name: "beta",
				description: "is a parameter to the distribution and must be greater than 0"
			},
			{
				name: "A",
				description: "is an optional lower bound to the interval of x. If omitted, A = 0"
			},
			{
				name: "B",
				description: "is an optional upper bound to the interval of x. If omitted, B = 1"
			}
		]
	},
	{
		name: "BETAINV",
		description: "Returns the inverse of the cumulative beta probability density function (BETADIST).",
		arguments: [
			{
				name: "probability",
				description: "is a probability associated with the beta distribution"
			},
			{
				name: "alpha",
				description: "is a parameter to the distribution and must be greater than 0"
			},
			{
				name: "beta",
				description: "is a parameter to the distribution and must be greater than 0"
			},
			{
				name: "A",
				description: "is an optional lower bound to the interval of x. If omitted, A = 0"
			},
			{
				name: "B",
				description: "is an optional upper bound to the interval of x. If omitted, B = 1"
			}
		]
	},
	{
		name: "BIN2DEC",
		description: "Converts a binary number to decimal.",
		arguments: [
			{
				name: "number",
				description: "is the binary number you want to convert"
			}
		]
	},
	{
		name: "BIN2HEX",
		description: "Converts a binary number to hexadecimal.",
		arguments: [
			{
				name: "number",
				description: "is the binary number you want to convert"
			},
			{
				name: "places",
				description: "is the number of characters to use"
			}
		]
	},
	{
		name: "BIN2OCT",
		description: "Converts a binary number to octal.",
		arguments: [
			{
				name: "number",
				description: "is the binary number you want to convert"
			},
			{
				name: "places",
				description: "is the number of characters to use"
			}
		]
	},
	{
		name: "BINOM.DIST",
		description: "Returns the individual term binomial distribution probability.",
		arguments: [
			{
				name: "number_s",
				description: "is the number of successes in trials"
			},
			{
				name: "trials",
				description: "is the number of independent trials"
			},
			{
				name: "probability_s",
				description: "is the probability of success on each trial"
			},
			{
				name: "cumulative",
				description: "is a logical value: for the cumulative distribution function, use TRUE; for the probability mass function, use FALSE"
			}
		]
	},
	{
		name: "BINOM.DIST.RANGE",
		description: "Returns the probability of a trial result using a binomial distribution.",
		arguments: [
			{
				name: "trials",
				description: "is the number of independent trials"
			},
			{
				name: "probability_s",
				description: "is the probability of success on each trial"
			},
			{
				name: "number_s",
				description: "is the number of successes in trials"
			},
			{
				name: "number_s2",
				description: "if provided this function returns the probability that the number of successful trials shall lie between number_s and number_s2"
			}
		]
	},
	{
		name: "BINOM.INV",
		description: "Returns the smallest value for which the cumulative binomial distribution is greater than or equal to a criterion value.",
		arguments: [
			{
				name: "trials",
				description: "is the number of Bernoulli trials"
			},
			{
				name: "probability_s",
				description: "is the probability of success on each trial, a number between 0 and 1 inclusive"
			},
			{
				name: "alpha",
				description: "is the criterion value, a number between 0 and 1 inclusive"
			}
		]
	},
	{
		name: "BINOMDIST",
		description: "Returns the individual term binomial distribution probability.",
		arguments: [
			{
				name: "number_s",
				description: "is the number of successes in trials"
			},
			{
				name: "trials",
				description: "is the number of independent trials"
			},
			{
				name: "probability_s",
				description: "is the probability of success on each trial"
			},
			{
				name: "cumulative",
				description: "is a logical value: for the cumulative distribution function, use TRUE; for the probability mass function, use FALSE"
			}
		]
	},
	{
		name: "BITAND",
		description: "Returns a bitwise 'And' of two numbers.",
		arguments: [
			{
				name: "number1",
				description: "is the decimal representation of the binary number you want to evaluate"
			},
			{
				name: "number2",
				description: "is the decimal representation of the binary number you want to evaluate"
			}
		]
	},
	{
		name: "BITLSHIFT",
		description: "Returns a number shifted left by shift_amount bits.",
		arguments: [
			{
				name: "number",
				description: "is the decimal representation of the binary number you want to evaluate"
			},
			{
				name: "shift_amount",
				description: "is the number of bits that you want to shift Number left by"
			}
		]
	},
	{
		name: "BITOR",
		description: "Returns a bitwise 'Or' of two numbers.",
		arguments: [
			{
				name: "number1",
				description: "is the decimal representation of the binary number you want to evaluate"
			},
			{
				name: "number2",
				description: "is the decimal representation of the binary number you want to evaluate"
			}
		]
	},
	{
		name: "BITRSHIFT",
		description: "Returns a number shifted right by shift_amount bits.",
		arguments: [
			{
				name: "number",
				description: "is the decimal representation of the binary number you want to evaluate"
			},
			{
				name: "shift_amount",
				description: "is the number of bits that you want to shift Number right by"
			}
		]
	},
	{
		name: "BITXOR",
		description: "Returns a bitwise 'Exclusive Or' of two numbers.",
		arguments: [
			{
				name: "number1",
				description: "is the decimal representation of the binary number you want to evaluate"
			},
			{
				name: "number2",
				description: "is the decimal representation of the binary number you want to evaluate"
			}
		]
	},
	{
		name: "CEILING",
		description: "Rounds a number up, to the nearest multiple of significance.",
		arguments: [
			{
				name: "number",
				description: "is the value you want to round"
			},
			{
				name: "significance",
				description: "is the multiple to which you want to round"
			}
		]
	},
	{
		name: "CEILING.MATH",
		description: "Rounds a number up, to the nearest integer or to the nearest multiple of significance.",
		arguments: [
			{
				name: "number",
				description: "is the value you want to round"
			},
			{
				name: "significance",
				description: "is the multiple to which you want to round"
			},
			{
				name: "mode",
				description: "when given and nonzero this function will round away from zero"
			}
		]
	},
	{
		name: "CEILING.PRECISE",
		description: "Rounds a number up, to the nearest integer or to the nearest multiple of significance.",
		arguments: [
			{
				name: "number",
				description: "is the value you want to round"
			},
			{
				name: "significance",
				description: "is the multiple to which you want to round"
			}
		]
	},
	{
		name: "CELL",
		description: "Returns information about the formatting, location, or contents of the first cell, according to the sheet's reading order, in a reference.",
		arguments: [
			{
				name: "info_type",
				description: "is a text value that specifies what type of cell information you want."
			},
			{
				name: "reference",
				description: "is the cell that you want information about"
			}
		]
	},
	{
		name: "CHAR",
		description: "Returns the character specified by the code number from the character set for your computer.",
		arguments: [
			{
				name: "number",
				description: "is a number between 1 and 255 specifying which character you want"
			}
		]
	},
	{
		name: "CHIDIST",
		description: "Returns the right-tailed probability of the chi-squared distribution.",
		arguments: [
			{
				name: "x",
				description: "is the value at which you want to evaluate the distribution, a nonnegative number"
			},
			{
				name: "deg_freedom",
				description: "is the number of degrees of freedom, a number between 1 and 10^10, excluding 10^10"
			}
		]
	},
	{
		name: "CHIINV",
		description: "Returns the inverse of the right-tailed probability of the chi-squared distribution.",
		arguments: [
			{
				name: "probability",
				description: "is a probability associated with the chi-squared distribution, a value between 0 and 1 inclusive"
			},
			{
				name: "deg_freedom",
				description: "is the number of degrees of freedom, a number between 1 and 10^10, excluding 10^10"
			}
		]
	},
	{
		name: "CHISQ.DIST",
		description: "Returns the left-tailed probability of the chi-squared distribution.",
		arguments: [
			{
				name: "x",
				description: "is the value at which you want to evaluate the distribution, a nonnegative number"
			},
			{
				name: "deg_freedom",
				description: "is the number of degrees of freedom, a number between 1 and 10^10, excluding 10^10"
			},
			{
				name: "cumulative",
				description: "is a logical value for the function to return: the cumulative distribution function = TRUE; the probability density function = FALSE"
			}
		]
	},
	{
		name: "CHISQ.DIST.RT",
		description: "Returns the right-tailed probability of the chi-squared distribution.",
		arguments: [
			{
				name: "x",
				description: "is the value at which you want to evaluate the distribution, a nonnegative number"
			},
			{
				name: "deg_freedom",
				description: "is the number of degrees of freedom, a number between 1 and 10^10, excluding 10^10"
			}
		]
	},
	{
		name: "CHISQ.INV",
		description: "Returns the inverse of the left-tailed probability of the chi-squared distribution.",
		arguments: [
			{
				name: "probability",
				description: "is a probability associated with the chi-squared distribution, a value between 0 and 1 inclusive"
			},
			{
				name: "deg_freedom",
				description: "is the number of degrees of freedom, a number between 1 and 10^10, excluding 10^10"
			}
		]
	},
	{
		name: "CHISQ.INV.RT",
		description: "Returns the inverse of the right-tailed probability of the chi-squared distribution.",
		arguments: [
			{
				name: "probability",
				description: "is a probability associated with the chi-squared distribution, a value between 0 and 1 inclusive"
			},
			{
				name: "deg_freedom",
				description: "is the number of degrees of freedom, a number between 1 and 10^10, excluding 10^10"
			}
		]
	},
	{
		name: "CHISQ.TEST",
		description: "Returns the test for independence: the value from the chi-squared distribution for the statistic and the appropriate degrees of freedom.",
		arguments: [
			{
				name: "actual_range",
				description: "is the range of data that contains observations to test against expected values"
			},
			{
				name: "expected_range",
				description: "is the range of data that contains the ratio of the product of row totals and column totals to the grand total"
			}
		]
	},
	{
		name: "CHITEST",
		description: "Returns the test for independence: the value from the chi-squared distribution for the statistic and the appropriate degrees of freedom.",
		arguments: [
			{
				name: "actual_range",
				description: "is the range of data that contains observations to test against expected values"
			},
			{
				name: "expected_range",
				description: "is the range of data that contains the ratio of the product of row totals and column totals to the grand total"
			}
		]
	},
	{
		name: "CHOOSE",
		description: "Chooses a value or action to perform from a list of values, based on an index number.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "index_num",
				description: "specifies which value argument is selected. Index_num must be between 1 and 254, or a formula or a reference to a number between 1 and 254"
			},
			{
				name: "value1",
				description: "are 1 to 254 numbers, cell references, defined names, formulas, functions, or text arguments from which CHOOSE selects"
			},
			{
				name: "value2",
				description: "are 1 to 254 numbers, cell references, defined names, formulas, functions, or text arguments from which CHOOSE selects"
			}
		]
	},
	{
		name: "CLEAN",
		description: "Removes all nonprintable characters from text.",
		arguments: [
			{
				name: "text",
				description: "is any worksheet information from which you want to remove nonprintable characters"
			}
		]
	},
	{
		name: "CODE",
		description: "Returns a numeric code for the first character in a text string, in the character set used by your computer.",
		arguments: [
			{
				name: "text",
				description: "is the text for which you want the code of the first character"
			}
		]
	},
	{
		name: "COLUMN",
		description: "Returns the column number of a reference.",
		arguments: [
			{
				name: "reference",
				description: "is the cell or range of contiguous cells for which you want the column number. If omitted, the cell containing the COLUMN function is used"
			}
		]
	},
	{
		name: "COLUMNS",
		description: "Returns the number of columns in an array or reference.",
		arguments: [
			{
				name: "array",
				description: "is an array or array formula, or a reference to a range of cells for which you want the number of columns"
			}
		]
	},
	{
		name: "COMBIN",
		description: "Returns the number of combinations for a given number of items.",
		arguments: [
			{
				name: "number",
				description: "is the total number of items"
			},
			{
				name: "number_chosen",
				description: "is the number of items in each combination"
			}
		]
	},
	{
		name: "COMBINA",
		description: "Returns the number of combinations with repetitions for a given number of items.",
		arguments: [
			{
				name: "number",
				description: "is the total number of items"
			},
			{
				name: "number_chosen",
				description: "is the number of items in each combination"
			}
		]
	},
	{
		name: "COMPLEX",
		description: "Converts real and imaginary coefficients into a complex number.",
		arguments: [
			{
				name: "real_num",
				description: "is the real coefficient of the complex number"
			},
			{
				name: "i_num",
				description: "is the imaginary coefficient of the complex number"
			},
			{
				name: "suffix",
				description: "is the suffix for the imaginary component of the complex number"
			}
		]
	},
	{
		name: "CONCATENATE",
		description: "Joins several text strings into one text string.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "text1",
				description: "are 1 to 255 text strings to be joined into a single text string and can be text strings, numbers, or single-cell references"
			},
			{
				name: "text2",
				description: "are 1 to 255 text strings to be joined into a single text string and can be text strings, numbers, or single-cell references"
			}
		]
	},
	{
		name: "CONFIDENCE",
		description: "Returns the confidence interval for a population mean, using a normal distribution.",
		arguments: [
			{
				name: "alpha",
				description: "is the significance level used to compute the confidence level, a number greater than 0 and less than 1"
			},
			{
				name: "standard_dev",
				description: "is the population standard deviation for the data range and is assumed to be known. Standard_dev must be greater than 0"
			},
			{
				name: "size",
				description: "is the sample size"
			}
		]
	},
	{
		name: "CONFIDENCE.NORM",
		description: "Returns the confidence interval for a population mean, using a normal distribution.",
		arguments: [
			{
				name: "alpha",
				description: "is the significance level used to compute the confidence level, a number greater than 0 and less than 1"
			},
			{
				name: "standard_dev",
				description: "is the population standard deviation for the data range and is assumed to be known. Standard_dev must be greater than 0"
			},
			{
				name: "size",
				description: "is the sample size"
			}
		]
	},
	{
		name: "CONFIDENCE.T",
		description: "Returns the confidence interval for a population mean, using a Student's T distribution.",
		arguments: [
			{
				name: "alpha",
				description: "is the significance level used to compute the confidence level, a number greater than 0 and less than 1"
			},
			{
				name: "standard_dev",
				description: "is the population standard deviation for the data range and is assumed to be known. Standard_dev must be greater than 0"
			},
			{
				name: "size",
				description: "is the sample size"
			}
		]
	},
	{
		name: "CONVERT",
		description: "Converts a number from one measurement system to another.",
		arguments: [
			{
				name: "number",
				description: "is the value in from_units to convert"
			},
			{
				name: "from_unit",
				description: "is the units for number"
			},
			{
				name: "to_unit",
				description: "is the units for the result"
			}
		]
	},
	{
		name: "CORREL",
		description: "Returns the correlation coefficient between two data sets.",
		arguments: [
			{
				name: "array1",
				description: "is a cell range of values. The values should be numbers, names, arrays, or references that contain numbers"
			},
			{
				name: "array2",
				description: "is a second cell range of values. The values should be numbers, names, arrays, or references that contain numbers"
			}
		]
	},
	{
		name: "COS",
		description: "Returns the cosine of an angle.",
		arguments: [
			{
				name: "number",
				description: "is the angle in radians for which you want the cosine"
			}
		]
	},
	{
		name: "COSH",
		description: "Returns the hyperbolic cosine of a number.",
		arguments: [
			{
				name: "number",
				description: "is any real number"
			}
		]
	},
	{
		name: "COT",
		description: "Returns the cotangent of an angle.",
		arguments: [
			{
				name: "number",
				description: "is the angle in radians for which you want the cotangent"
			}
		]
	},
	{
		name: "COTH",
		description: "Returns the hyperbolic cotangent of a number.",
		arguments: [
			{
				name: "number",
				description: "is the angle in radians for which you want the hyperbolic cotangent"
			}
		]
	},
	{
		name: "COUNT",
		description: "Counts the number of cells in a range that contain numbers.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "value1",
				description: "are 1 to 255 arguments that can contain or refer to a variety of different types of data, but only numbers are counted"
			},
			{
				name: "value2",
				description: "are 1 to 255 arguments that can contain or refer to a variety of different types of data, but only numbers are counted"
			}
		]
	},
	{
		name: "COUNTA",
		description: "Counts the number of cells in a range that are not empty.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "value1",
				description: "are 1 to 255 arguments representing the values and cells you want to count. Values can be any type of information"
			},
			{
				name: "value2",
				description: "are 1 to 255 arguments representing the values and cells you want to count. Values can be any type of information"
			}
		]
	},
	{
		name: "COUNTBLANK",
		description: "Counts the number of empty cells in a specified range of cells.",
		arguments: [
			{
				name: "range",
				description: "is the range from which you want to count the empty cells"
			}
		]
	},
	{
		name: "COUNTIF",
		description: "Counts the number of cells within a range that meet the given condition.",
		arguments: [
			{
				name: "range",
				description: "is the range of cells from which you want to count nonblank cells"
			},
			{
				name: "criteria",
				description: "is the condition in the form of a number, expression, or text that defines which cells will be counted"
			}
		]
	},
	{
		name: "COUNTIFS",
		description: "Counts the number of cells specified by a given set of conditions or criteria.",
		arguments: [
			{
				name: "criteria_range",
				description: "is the range of cells you want evaluated for the particular condition"
			},
			{
				name: "criteria",
				description: "is the condition in the form of a number, expression, or text that defines which cells will be counted"
			}
		]
	},
	{
		name: "COUPDAYBS",
		description: "Returns the number of days from the beginning of the coupon period to the settlement date.",
		arguments: [
			{
				name: "settlement",
				description: "is the security's settlement date, expressed as a serial date number"
			},
			{
				name: "maturity",
				description: "is the security's maturity date, expressed as a serial date number"
			},
			{
				name: "frequency",
				description: "is the number of coupon payments per year"
			},
			{
				name: "basis",
				description: "is the type of day count basis to use"
			}
		]
	},
	{
		name: "COUPNCD",
		description: "Returns the next coupon date after the settlement date.",
		arguments: [
			{
				name: "settlement",
				description: "is the security's settlement date, expressed as a serial date number"
			},
			{
				name: "maturity",
				description: "is the security's maturity date, expressed as a serial date number"
			},
			{
				name: "frequency",
				description: "is the number of coupon payments per year"
			},
			{
				name: "basis",
				description: "is the type of day count basis to use"
			}
		]
	},
	{
		name: "COUPNUM",
		description: "Returns the number of coupons payable between the settlement date and maturity date.",
		arguments: [
			{
				name: "settlement",
				description: "is the security's settlement date, expressed as a serial date number"
			},
			{
				name: "maturity",
				description: "is the security's maturity date, expressed as a serial date number"
			},
			{
				name: "frequency",
				description: "is the number of coupon payments per year"
			},
			{
				name: "basis",
				description: "is the type of day count basis to use"
			}
		]
	},
	{
		name: "COUPPCD",
		description: "Returns the previous coupon date before the settlement date.",
		arguments: [
			{
				name: "settlement",
				description: "is the security's settlement date, expressed as a serial date number"
			},
			{
				name: "maturity",
				description: "is the security's maturity date, expressed as a serial date number"
			},
			{
				name: "frequency",
				description: "is the number of coupon payments per year"
			},
			{
				name: "basis",
				description: "is the type of day count basis to use"
			}
		]
	},
	{
		name: "COVAR",
		description: "Returns covariance, the average of the products of deviations for each data point pair in two data sets.",
		arguments: [
			{
				name: "array1",
				description: "is the first cell range of integers and must be numbers, arrays, or references that contain numbers"
			},
			{
				name: "array2",
				description: "is the second cell range of integers and must be numbers, arrays, or references that contain numbers"
			}
		]
	},
	{
		name: "COVARIANCE.P",
		description: "Returns population covariance, the average of the products of deviations for each data point pair in two data sets.",
		arguments: [
			{
				name: "array1",
				description: "is the first cell range of integers and must be numbers, arrays, or references that contain numbers"
			},
			{
				name: "array2",
				description: "is the second cell range of integers and must be numbers, arrays, or references that contain numbers"
			}
		]
	},
	{
		name: "COVARIANCE.S",
		description: "Returns sample covariance, the average of the products of deviations for each data point pair in two data sets.",
		arguments: [
			{
				name: "array1",
				description: "is the first cell range of integers and must be numbers, arrays, or references that contain numbers"
			},
			{
				name: "array2",
				description: "is the second cell range of integers and must be numbers, arrays, or references that contain numbers"
			}
		]
	},
	{
		name: "CRITBINOM",
		description: "Returns the smallest value for which the cumulative binomial distribution is greater than or equal to a criterion value.",
		arguments: [
			{
				name: "trials",
				description: "is the number of Bernoulli trials"
			},
			{
				name: "probability_s",
				description: "is the probability of success on each trial, a number between 0 and 1 inclusive"
			},
			{
				name: "alpha",
				description: "is the criterion value, a number between 0 and 1 inclusive"
			}
		]
	},
	{
		name: "CSC",
		description: "Returns the cosecant of an angle.",
		arguments: [
			{
				name: "number",
				description: "is the angle in radians for which you want the cosecant"
			}
		]
	},
	{
		name: "CSCH",
		description: "Returns the hyperbolic cosecant of an angle.",
		arguments: [
			{
				name: "number",
				description: "is the angle in radians for which you want the hyperbolic cosecant"
			}
		]
	},
	{
		name: "CUMIPMT",
		description: "Returns the cumulative interest paid between two periods.",
		arguments: [
			{
				name: "rate",
				description: "is the interest rate"
			},
			{
				name: "nper",
				description: "is the total number of payment periods"
			},
			{
				name: "pv",
				description: "is the present value"
			},
			{
				name: "start_period",
				description: "is the first period in the calculation"
			},
			{
				name: "end_period",
				description: "is the last period in the calculation"
			},
			{
				name: "type",
				description: "is the timing of the payment"
			}
		]
	},
	{
		name: "CUMPRINC",
		description: "Returns the cumulative principal paid on a loan between two periods.",
		arguments: [
			{
				name: "rate",
				description: "is the interest rate"
			},
			{
				name: "nper",
				description: "is the total number of payment periods"
			},
			{
				name: "pv",
				description: "is the present value"
			},
			{
				name: "start_period",
				description: "is the first period in the calculation"
			},
			{
				name: "end_period",
				description: "is the last period in the calculation"
			},
			{
				name: "type",
				description: "is the timing of the payment"
			}
		]
	},
	{
		name: "DATE",
		description: "Returns the number that represents the date in Spreadsheet date-time code.",
		arguments: [
			{
				name: "year",
				description: "is a number from 1900 to 9999 in Spreadsheet for Windows or from 1904 to 9999 in Spreadsheet for the Macintosh"
			},
			{
				name: "month",
				description: "is a number from 1 to 12 representing the month of the year"
			},
			{
				name: "day",
				description: "is a number from 1 to 31 representing the day of the month"
			}
		]
	},
	{
		name: "DATEDIF",
		description: "",
		arguments: [
		]
	},
	{
		name: "DATEVALUE",
		description: "Converts a date in the form of text to a number that represents the date in Spreadsheet date-time code.",
		arguments: [
			{
				name: "date_text",
				description: "is text that represents a date in a Spreadsheet date format, between 1/1/1900 (Windows) or 1/1/1904 (Macintosh) and 12/31/9999"
			}
		]
	},
	{
		name: "DAVERAGE",
		description: "Averages the values in a column in a list or database that match conditions you specify.",
		arguments: [
			{
				name: "database",
				description: "is the range of cells that makes up the list or database. A database is a list of related data"
			},
			{
				name: "field",
				description: "is either the label of the column in double quotation marks or a number that represents the column's position in the list"
			},
			{
				name: "criteria",
				description: "is the range of cells that contains the conditions you specify. The range includes a column label and one cell below the label for a condition"
			}
		]
	},
	{
		name: "DAY",
		description: "Returns the day of the month, a number from 1 to 31.",
		arguments: [
			{
				name: "serial_number",
				description: "is a number in the date-time code used by Spreadsheet"
			}
		]
	},
	{
		name: "DAYS",
		description: "Returns the number of days between the two dates.",
		arguments: [
			{
				name: "end_date",
				description: "start_date and end_date are the two dates between which you want to know the number of days"
			},
			{
				name: "start_date",
				description: "start_date and end_date are the two dates between which you want to know the number of days"
			}
		]
	},
	{
		name: "DAYS360",
		description: "Returns the number of days between two dates based on a 360-day year (twelve 30-day months).",
		arguments: [
			{
				name: "start_date",
				description: "start_date and end_date are the two dates between which you want to know the number of days"
			},
			{
				name: "end_date",
				description: "start_date and end_date are the two dates between which you want to know the number of days"
			},
			{
				name: "method",
				description: "is a logical value specifying the calculation method: U.S. (NASD) = FALSE or omitted; European = TRUE."
			}
		]
	},
	{
		name: "DB",
		description: "Returns the depreciation of an asset for a specified period using the fixed-declining balance method.",
		arguments: [
			{
				name: "cost",
				description: "is the initial cost of the asset"
			},
			{
				name: "salvage",
				description: "is the salvage value at the end of the life of the asset"
			},
			{
				name: "life",
				description: "is the number of periods over which the asset is being depreciated (sometimes called the useful life of the asset)"
			},
			{
				name: "period",
				description: "is the period for which you want to calculate the depreciation. Period must use the same units as Life"
			},
			{
				name: "month",
				description: "is the number of months in the first year. If month is omitted, it is assumed to be 12"
			}
		]
	},
	{
		name: "DCOUNT",
		description: "Counts the cells containing numbers in the field (column) of records in the database that match the conditions you specify.",
		arguments: [
			{
				name: "database",
				description: "is the range of cells that makes up the list or database. A database is a list of related data"
			},
			{
				name: "field",
				description: "is either the label of the column in double quotation marks or a number that represents the column's position in the list"
			},
			{
				name: "criteria",
				description: "is the range of cells that contains the conditions you specify. The range includes a column label and one cell below the label for a condition"
			}
		]
	},
	{
		name: "DCOUNTA",
		description: "Counts nonblank cells in the field (column) of records in the database that match the conditions you specify.",
		arguments: [
			{
				name: "database",
				description: "is the range of cells that makes up the list or database. A database is a list of related data"
			},
			{
				name: "field",
				description: "is either the label of the column in double quotation marks or a number that represents the column's position in the list"
			},
			{
				name: "criteria",
				description: "is the range of cells that contains the conditions you specify. The range includes a column label and one cell below the label for a condition"
			}
		]
	},
	{
		name: "DDB",
		description: "Returns the depreciation of an asset for a specified period using the double-declining balance method or some other method you specify.",
		arguments: [
			{
				name: "cost",
				description: "is the initial cost of the asset"
			},
			{
				name: "salvage",
				description: "is the salvage value at the end of the life of the asset"
			},
			{
				name: "life",
				description: "is the number of periods over which the asset is being depreciated (sometimes called the useful life of the asset)"
			},
			{
				name: "period",
				description: "is the period for which you want to calculate the depreciation. Period must use the same units as Life"
			},
			{
				name: "factor",
				description: "is the rate at which the balance declines. If Factor is omitted, it is assumed to be 2 (the double-declining balance method)"
			}
		]
	},
	{
		name: "DEC2BIN",
		description: "Converts a decimal number to binary.",
		arguments: [
			{
				name: "number",
				description: "is the decimal integer you want to convert"
			},
			{
				name: "places",
				description: "is the number of characters to use"
			}
		]
	},
	{
		name: "DEC2HEX",
		description: "Converts a decimal number to hexadecimal.",
		arguments: [
			{
				name: "number",
				description: "is the decimal integer you want to convert"
			},
			{
				name: "places",
				description: "is the number of characters to use"
			}
		]
	},
	{
		name: "DEC2OCT",
		description: "Converts a decimal number to octal.",
		arguments: [
			{
				name: "number",
				description: "is the decimal integer you want to convert"
			},
			{
				name: "places",
				description: "is the number of characters to use"
			}
		]
	},
	{
		name: "DECIMAL",
		description: "Converts a text representation of a number in a given base into a decimal number.",
		arguments: [
			{
				name: "number",
				description: "is the number that you want to convert"
			},
			{
				name: "radix",
				description: "is the base Radix of the number you are converting"
			}
		]
	},
	{
		name: "DEGREES",
		description: "Converts radians to degrees.",
		arguments: [
			{
				name: "angle",
				description: "is the angle in radians that you want to convert"
			}
		]
	},
	{
		name: "DELTA",
		description: "Tests whether two numbers are equal.",
		arguments: [
			{
				name: "number1",
				description: "is the first number"
			},
			{
				name: "number2",
				description: "is the second number"
			}
		]
	},
	{
		name: "DEVSQ",
		description: "Returns the sum of squares of deviations of data points from their sample mean.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 arguments, or an array or array reference, on which you want DEVSQ to calculate"
			},
			{
				name: "number2",
				description: "are 1 to 255 arguments, or an array or array reference, on which you want DEVSQ to calculate"
			}
		]
	},
	{
		name: "DGET",
		description: "Extracts from a database a single record that matches the conditions you specify.",
		arguments: [
			{
				name: "database",
				description: "is the range of cells that makes up the list or database. A database is a list of related data"
			},
			{
				name: "field",
				description: "is either the label of the column in double quotation marks or a number that represents the column's position in the list"
			},
			{
				name: "criteria",
				description: "is the range of cells that contains the conditions you specify. The range includes a column label and one cell below the label for a condition"
			}
		]
	},
	{
		name: "DISC",
		description: "Returns the discount rate for a security.",
		arguments: [
			{
				name: "settlement",
				description: "is the security's settlement date, expressed as a serial date number"
			},
			{
				name: "maturity",
				description: "is the security's maturity date, expressed as a serial date number"
			},
			{
				name: "pr",
				description: "is the security's price per $100 face value"
			},
			{
				name: "redemption",
				description: "is the security's redemption value per $100 face value"
			},
			{
				name: "basis",
				description: "is the type of day count basis to use"
			}
		]
	},
	{
		name: "DMAX",
		description: "Returns the largest number in the field (column) of records in the database that match the conditions you specify.",
		arguments: [
			{
				name: "database",
				description: "is the range of cells that makes up the list or database. A database is a list of related data"
			},
			{
				name: "field",
				description: "is either the label of the column in double quotation marks or a number that represents the column's position in the list"
			},
			{
				name: "criteria",
				description: "is the range of cells that contains the conditions you specify. The range includes a column label and one cell below the label for a condition"
			}
		]
	},
	{
		name: "DMIN",
		description: "Returns the smallest number in the field (column) of records in the database that match the conditions you specify.",
		arguments: [
			{
				name: "database",
				description: "is the range of cells that makes up the list or database. A database is a list of related data"
			},
			{
				name: "field",
				description: "is either the label of the column in double quotation marks or a number that represents the column's position in the list"
			},
			{
				name: "criteria",
				description: "is the range of cells that contains the conditions you specify. The range includes a column label and one cell below the label for a condition"
			}
		]
	},
	{
		name: "DOLLAR",
		description: "Converts a number to text, using currency format.",
		arguments: [
			{
				name: "number",
				description: "is a number, a reference to a cell containing a number, or a formula that evaluates to a number"
			},
			{
				name: "decimals",
				description: "is the number of digits to the right of the decimal point. The number is rounded as necessary; if omitted, Decimals = 2"
			}
		]
	},
	{
		name: "DOLLARDE",
		description: "Converts a dollar price, expressed as a fraction, into a dollar price, expressed as a decimal number.",
		arguments: [
			{
				name: "fractional_dollar",
				description: "is a number expressed as a fraction"
			},
			{
				name: "fraction",
				description: "is the integer to use in the denominator of the fraction"
			}
		]
	},
	{
		name: "DOLLARFR",
		description: "Converts a dollar price, expressed as a decimal number, into a dollar price, expressed as a fraction.",
		arguments: [
			{
				name: "decimal_dollar",
				description: "is a decimal number"
			},
			{
				name: "fraction",
				description: "is the integer to use in the denominator of a fraction"
			}
		]
	},
	{
		name: "DPRODUCT",
		description: "Multiplies the values in the field (column) of records in the database that match the conditions you specify.",
		arguments: [
			{
				name: "database",
				description: "is the range of cells that makes up the list or database. A database is a list of related data"
			},
			{
				name: "field",
				description: "is either the label of the column in double quotation marks or a number that represents the column's position in the list"
			},
			{
				name: "criteria",
				description: "is the range of cells that contains the conditions you specify. The range includes a column label and one cell below the label for a condition"
			}
		]
	},
	{
		name: "DSTDEV",
		description: "Estimates the standard deviation based on a sample from selected database entries.",
		arguments: [
			{
				name: "database",
				description: "is the range of cells that makes up the list or database. A database is a list of related data"
			},
			{
				name: "field",
				description: "is either the label of the column in double quotation marks or a number that represents the column's position in the list"
			},
			{
				name: "criteria",
				description: "is the range of cells that contains the conditions you specify. The range includes a column label and one cell below the label for a condition"
			}
		]
	},
	{
		name: "DSTDEVP",
		description: "Calculates the standard deviation based on the entire population of selected database entries.",
		arguments: [
			{
				name: "database",
				description: "is the range of cells that makes up the list or database. A database is a list of related data"
			},
			{
				name: "field",
				description: "is either the label of the column in double quotation marks or a number that represents the column's position in the list"
			},
			{
				name: "criteria",
				description: "is the range of cells that contains the conditions you specify. The range includes a column label and one cell below the label for a condition"
			}
		]
	},
	{
		name: "DSUM",
		description: "Adds the numbers in the field (column) of records in the database that match the conditions you specify.",
		arguments: [
			{
				name: "database",
				description: "is the range of cells that makes up the list or database. A database is a list of related data"
			},
			{
				name: "field",
				description: "is either the label of the column in double quotation marks or a number that represents the column's position in the list"
			},
			{
				name: "criteria",
				description: "is the range of cells that contains the conditions you specify. The range includes a column label and one cell below the label for a condition"
			}
		]
	},
	{
		name: "DVAR",
		description: "Estimates variance based on a sample from selected database entries.",
		arguments: [
			{
				name: "database",
				description: "is the range of cells that makes up the list or database. A database is a list of related data"
			},
			{
				name: "field",
				description: "is either the label of the column in double quotation marks or a number that represents the column's position in the list"
			},
			{
				name: "criteria",
				description: "is the range of cells that contains the conditions you specify. The range includes a column label and one cell below the label for a condition"
			}
		]
	},
	{
		name: "DVARP",
		description: "Calculates variance based on the entire population of selected database entries.",
		arguments: [
			{
				name: "database",
				description: "is the range of cells that makes up the list or database. A database is a list of related data"
			},
			{
				name: "field",
				description: "is either the label of the column in double quotation marks or a number that represents the column's position in the list"
			},
			{
				name: "criteria",
				description: "is the range of cells that contains the conditions you specify. The range includes a column label and one cell below the label for a condition"
			}
		]
	},
	{
		name: "EDATE",
		description: "Returns the serial number of the date that is the indicated number of months before or after the start date.",
		arguments: [
			{
				name: "start_date",
				description: "is a serial date number that represents the start date"
			},
			{
				name: "months",
				description: "is the number of months before or after start_date"
			}
		]
	},
	{
		name: "EFFECT",
		description: "Returns the effective annual interest rate.",
		arguments: [
			{
				name: "nominal_rate",
				description: "is the nominal interest rate"
			},
			{
				name: "npery",
				description: "is the number of compounding periods per year"
			}
		]
	},
	{
		name: "ENCODEURL",
		description: "Returns a URL-encoded string.",
		arguments: [
			{
				name: "text",
				description: "is a string to be URL encoded"
			}
		]
	},
	{
		name: "EOMONTH",
		description: "Returns the serial number of the last day of the month before or after a specified number of months.",
		arguments: [
			{
				name: "start_date",
				description: "is a serial date number that represents the start date"
			},
			{
				name: "months",
				description: "is the number of months before or after the start_date"
			}
		]
	},
	{
		name: "ERF",
		description: "Returns the error function.",
		arguments: [
			{
				name: "lower_limit",
				description: "is the lower bound for integrating ERF"
			},
			{
				name: "upper_limit",
				description: "is the upper bound for integrating ERF"
			}
		]
	},
	{
		name: "ERF.PRECISE",
		description: "Returns the error function.",
		arguments: [
			{
				name: "X",
				description: "is the lower bound for integrating ERF.PRECISE"
			}
		]
	},
	{
		name: "ERFC",
		description: "Returns the complementary error function.",
		arguments: [
			{
				name: "x",
				description: "is the lower bound for integrating ERF"
			}
		]
	},
	{
		name: "ERFC.PRECISE",
		description: "Returns the complementary error function.",
		arguments: [
			{
				name: "X",
				description: "is the lower bound for integrating ERFC.PRECISE"
			}
		]
	},
	{
		name: "ERROR.TYPE",
		description: "Returns a number matching an error value.",
		arguments: [
			{
				name: "error_val",
				description: "is the error value for which you want the identifying number, and can be an actual error value or a reference to a cell containing an error value"
			}
		]
	},
	{
		name: "EVEN",
		description: "Rounds a positive number up and negative number down to the nearest even integer.",
		arguments: [
			{
				name: "number",
				description: "is the value to round"
			}
		]
	},
	{
		name: "EXACT",
		description: "Checks whether two text strings are exactly the same, and returns TRUE or FALSE. EXACT is case-sensitive.",
		arguments: [
			{
				name: "text1",
				description: "is the first text string"
			},
			{
				name: "text2",
				description: "is the second text string"
			}
		]
	},
	{
		name: "EXP",
		description: "Returns e raised to the power of a given number.",
		arguments: [
			{
				name: "number",
				description: "is the exponent applied to the base e. The constant e equals 2.71828182845904, the base of the natural logarithm"
			}
		]
	},
	{
		name: "EXPON.DIST",
		description: "Returns the exponential distribution.",
		arguments: [
			{
				name: "x",
				description: "is the value of the function, a nonnegative number"
			},
			{
				name: "lambda",
				description: "is the parameter value, a positive number"
			},
			{
				name: "cumulative",
				description: "is a logical value for the function to return: the cumulative distribution function = TRUE; the probability density function = FALSE"
			}
		]
	},
	{
		name: "EXPONDIST",
		description: "Returns the exponential distribution.",
		arguments: [
			{
				name: "x",
				description: "is the value of the function, a nonnegative number"
			},
			{
				name: "lambda",
				description: "is the parameter value, a positive number"
			},
			{
				name: "cumulative",
				description: "is a logical value for the function to return: the cumulative distribution function = TRUE; the probability density function = FALSE"
			}
		]
	},
	{
		name: "F.DIST",
		description: "Returns the (left-tailed) F probability distribution (degree of diversity) for two data sets.",
		arguments: [
			{
				name: "x",
				description: "is the value at which to evaluate the function, a nonnegative number"
			},
			{
				name: "deg_freedom1",
				description: "is the numerator degrees of freedom, a number between 1 and 10^10, excluding 10^10"
			},
			{
				name: "deg_freedom2",
				description: "is the denominator degrees of freedom, a number between 1 and 10^10, excluding 10^10"
			},
			{
				name: "cumulative",
				description: "is a logical value for the function to return: the cumulative distribution function = TRUE; the probability density function = FALSE"
			}
		]
	},
	{
		name: "F.DIST.RT",
		description: "Returns the (right-tailed) F probability distribution (degree of diversity) for two data sets.",
		arguments: [
			{
				name: "x",
				description: "is the value at which to evaluate the function, a nonnegative number"
			},
			{
				name: "deg_freedom1",
				description: "is the numerator degrees of freedom, a number between 1 and 10^10, excluding 10^10"
			},
			{
				name: "deg_freedom2",
				description: "is the denominator degrees of freedom, a number between 1 and 10^10, excluding 10^10"
			}
		]
	},
	{
		name: "F.INV",
		description: "Returns the inverse of the (left-tailed) F probability distribution: if p = F.DIST(x,...), then F.INV(p,...) = x.",
		arguments: [
			{
				name: "probability",
				description: "is a probability associated with the F cumulative distribution, a number between 0 and 1 inclusive"
			},
			{
				name: "deg_freedom1",
				description: "is the numerator degrees of freedom, a number between 1 and 10^10, excluding 10^10"
			},
			{
				name: "deg_freedom2",
				description: "is the denominator degrees of freedom, a number between 1 and 10^10, excluding 10^10"
			}
		]
	},
	{
		name: "F.INV.RT",
		description: "Returns the inverse of the (right-tailed) F probability distribution: if p = F.DIST.RT(x,...), then F.INV.RT(p,...) = x.",
		arguments: [
			{
				name: "probability",
				description: "is a probability associated with the F cumulative distribution, a number between 0 and 1 inclusive"
			},
			{
				name: "deg_freedom1",
				description: "is the numerator degrees of freedom, a number between 1 and 10^10, excluding 10^10"
			},
			{
				name: "deg_freedom2",
				description: "is the denominator degrees of freedom, a number between 1 and 10^10, excluding 10^10"
			}
		]
	},
	{
		name: "F.TEST",
		description: "Returns the result of an F-test, the two-tailed probability that the variances in Array1 and Array2 are not significantly different.",
		arguments: [
			{
				name: "array1",
				description: "is the first array or range of data and can be numbers or names, arrays, or references that contain numbers (blanks are ignored)"
			},
			{
				name: "array2",
				description: "is the second array or range of data and can be numbers or names, arrays, or references that contain numbers (blanks are ignored)"
			}
		]
	},
	{
		name: "FACT",
		description: "Returns the factorial of a number, equal to 1*2*3*...* Number.",
		arguments: [
			{
				name: "number",
				description: "is the nonnegative number you want the factorial of"
			}
		]
	},
	{
		name: "FACTDOUBLE",
		description: "Returns the double factorial of a number.",
		arguments: [
			{
				name: "number",
				description: "is the value for which to return the double factorial"
			}
		]
	},
	{
		name: "FALSE",
		description: "Returns the logical value FALSE.",
		arguments: [
		]
	},
	{
		name: "FDIST",
		description: "Returns the (right-tailed) F probability distribution (degree of diversity) for two data sets.",
		arguments: [
			{
				name: "x",
				description: "is the value at which to evaluate the function, a nonnegative number"
			},
			{
				name: "deg_freedom1",
				description: "is the numerator degrees of freedom, a number between 1 and 10^10, excluding 10^10"
			},
			{
				name: "deg_freedom2",
				description: "is the denominator degrees of freedom, a number between 1 and 10^10, excluding 10^10"
			}
		]
	},
	{
		name: "FIELD",
		description: "",
		arguments: [
			{
				name: "",
				description: ""
			}
		]
	},
	{
		name: "FIELDPICTURE",
		description: "",
		arguments: [
			{
				name: "",
				description: ""
			},
			{
				name: "",
				description: ""
			},
			{
				name: "",
				description: ""
			},
			{
				name: "",
				description: ""
			},
			{
				name: "",
				description: ""
			},
			{
				name: "",
				description: ""
			},
			{
				name: "",
				description: ""
			},
			{
				name: "",
				description: ""
			}
		]
	},
	{
		name: "FIND",
		description: "Returns the starting position of one text string within another text string. FIND is case-sensitive.",
		arguments: [
			{
				name: "find_text",
				description: "is the text you want to find. Use double quotes (empty text) to match the first character in Within_text; wildcard characters not allowed"
			},
			{
				name: "within_text",
				description: "is the text containing the text you want to find"
			},
			{
				name: "start_num",
				description: "specifies the character at which to start the search. The first character in Within_text is character number 1. If omitted, Start_num = 1"
			}
		]
	},
	{
		name: "FINV",
		description: "Returns the inverse of the (right-tailed) F probability distribution: if p = FDIST(x,...), then FINV(p,...) = x.",
		arguments: [
			{
				name: "probability",
				description: "is a probability associated with the F cumulative distribution, a number between 0 and 1 inclusive"
			},
			{
				name: "deg_freedom1",
				description: "is the numerator degrees of freedom, a number between 1 and 10^10, excluding 10^10"
			},
			{
				name: "deg_freedom2",
				description: "is the denominator degrees of freedom, a number between 1 and 10^10, excluding 10^10"
			}
		]
	},
	{
		name: "FISHER",
		description: "Returns the Fisher transformation.",
		arguments: [
			{
				name: "x",
				description: "is the value for which you want the transformation, a number between -1 and 1, excluding -1 and 1"
			}
		]
	},
	{
		name: "FISHERINV",
		description: "Returns the inverse of the Fisher transformation: if y = FISHER(x), then FISHERINV(y) = x.",
		arguments: [
			{
				name: "y",
				description: "is the value for which you want to perform the inverse of the transformation"
			}
		]
	},
	{
		name: "FIXED",
		description: "Rounds a number to the specified number of decimals and returns the result as text with or without commas.",
		arguments: [
			{
				name: "number",
				description: "is the number you want to round and convert to text"
			},
			{
				name: "decimals",
				description: "is the number of digits to the right of the decimal point. If omitted, Decimals = 2"
			},
			{
				name: "no_commas",
				description: "is a logical value: do not display commas in the returned text = TRUE; do display commas in the returned text = FALSE or omitted"
			}
		]
	},
	{
		name: "FLOOR",
		description: "Rounds a number down to the nearest multiple of significance.",
		arguments: [
			{
				name: "number",
				description: "is the numeric value you want to round"
			},
			{
				name: "significance",
				description: "is the multiple to which you want to round. Number and Significance must either both be positive or both be negative"
			}
		]
	},
	{
		name: "FLOOR.MATH",
		description: "Rounds a number down, to the nearest integer or to the nearest multiple of significance.",
		arguments: [
			{
				name: "number",
				description: "is the value you want to round"
			},
			{
				name: "significance",
				description: "is the multiple to which you want to round"
			},
			{
				name: "mode",
				description: "when given and nonzero this function will round towards zero"
			}
		]
	},
	{
		name: "FLOOR.PRECISE",
		description: "Rounds a number down, to the nearest integer or to the nearest multiple of significance.",
		arguments: [
			{
				name: "number",
				description: "is the numeric value you want to round"
			},
			{
				name: "significance",
				description: "is the multiple to which you want to round. "
			}
		]
	},
	{
		name: "FORECAST",
		description: "Calculates, or predicts, a future value along a linear trend by using existing values.",
		arguments: [
			{
				name: "x",
				description: "is the data point for which you want to predict a value and must be a numeric value"
			},
			{
				name: "known_y's",
				description: "is the dependent array or range of numeric data"
			},
			{
				name: "known_x's",
				description: "is the independent array or range of numeric data. The variance of Known_x's must not be zero"
			}
		]
	},
	{
		name: "FORMULATEXT",
		description: "Returns a formula as a string.",
		arguments: [
			{
				name: "reference",
				description: "is a reference to a formula"
			}
		]
	},
	{
		name: "FREQUENCY",
		description: "Calculates how often values occur within a range of values and then returns a vertical array of numbers having one more element than Bins_array.",
		arguments: [
			{
				name: "data_array",
				description: "is an array of or reference to a set of values for which you want to count frequencies (blanks and text are ignored)"
			},
			{
				name: "bins_array",
				description: "is an array of or reference to intervals into which you want to group the values in data_array"
			}
		]
	},
	{
		name: "FTEST",
		description: "Returns the result of an F-test, the two-tailed probability that the variances in Array1 and Array2 are not significantly different.",
		arguments: [
			{
				name: "array1",
				description: "is the first array or range of data and can be numbers or names, arrays, or references that contain numbers (blanks are ignored)"
			},
			{
				name: "array2",
				description: "is the second array or range of data and can be numbers or names, arrays, or references that contain numbers (blanks are ignored)"
			}
		]
	},
	{
		name: "FV",
		description: "Returns the future value of an investment based on periodic, constant payments and a constant interest rate.",
		arguments: [
			{
				name: "rate",
				description: "is the interest rate per period. For example, use 6%/4 for quarterly payments at 6% APR"
			},
			{
				name: "nper",
				description: "is the total number of payment periods in the investment"
			},
			{
				name: "pmt",
				description: "is the payment made each period; it cannot change over the life of the investment"
			},
			{
				name: "pv",
				description: "is the present value, or the lump-sum amount that a series of future payments is worth now. If omitted, Pv = 0"
			},
			{
				name: "type",
				description: "is a value representing the timing of payment: payment at the beginning of the period = 1; payment at the end of the period = 0 or omitted"
			}
		]
	},
	{
		name: "FVSCHEDULE",
		description: "Returns the future value of an initial principal after applying a series of compound interest rates.",
		arguments: [
			{
				name: "principal",
				description: "is the present value"
			},
			{
				name: "schedule",
				description: "is an array of interest rates to apply"
			}
		]
	},
	{
		name: "GAMMA",
		description: "Returns the Gamma function value.",
		arguments: [
			{
				name: "x",
				description: "is the value for which you want to calculate Gamma"
			}
		]
	},
	{
		name: "GAMMA.DIST",
		description: "Returns the gamma distribution.",
		arguments: [
			{
				name: "x",
				description: "is the value at which you want to evaluate the distribution, a nonnegative number"
			},
			{
				name: "alpha",
				description: "is a parameter to the distribution, a positive number"
			},
			{
				name: "beta",
				description: "is a parameter to the distribution, a positive number. If beta = 1, GAMMA.DIST returns the standard gamma distribution"
			},
			{
				name: "cumulative",
				description: "is a logical value: return the cumulative distribution function = TRUE; return the probability mass function = FALSE or omitted"
			}
		]
	},
	{
		name: "GAMMA.INV",
		description: "Returns the inverse of the gamma cumulative distribution: if p = GAMMA.DIST(x,...), then GAMMA.INV(p,...) = x.",
		arguments: [
			{
				name: "probability",
				description: "is the probability associated with the gamma distribution, a number between 0 and 1, inclusive"
			},
			{
				name: "alpha",
				description: "is a parameter to the distribution, a positive number"
			},
			{
				name: "beta",
				description: "is a parameter to the distribution, a positive number. If beta = 1, GAMMA.INV returns the inverse of the standard gamma distribution"
			}
		]
	},
	{
		name: "GAMMADIST",
		description: "Returns the gamma distribution.",
		arguments: [
			{
				name: "x",
				description: "is the value at which you want to evaluate the distribution, a nonnegative number"
			},
			{
				name: "alpha",
				description: "is a parameter to the distribution, a positive number"
			},
			{
				name: "beta",
				description: "is a parameter to the distribution, a positive number. If beta = 1, GAMMADIST returns the standard gamma distribution"
			},
			{
				name: "cumulative",
				description: "is a logical value: return the cumulative distribution function = TRUE; return the probability mass function = FALSE or omitted"
			}
		]
	},
	{
		name: "GAMMAINV",
		description: "Returns the inverse of the gamma cumulative distribution: if p = GAMMADIST(x,...), then GAMMAINV(p,...) = x.",
		arguments: [
			{
				name: "probability",
				description: "is the probability associated with the gamma distribution, a number between 0 and 1, inclusive"
			},
			{
				name: "alpha",
				description: "is a parameter to the distribution, a positive number"
			},
			{
				name: "beta",
				description: "is a parameter to the distribution, a positive number. If beta = 1, GAMMAINV returns the inverse of the standard gamma distribution"
			}
		]
	},
	{
		name: "GAMMALN",
		description: "Returns the natural logarithm of the gamma function.",
		arguments: [
			{
				name: "x",
				description: "is the value for which you want to calculate GAMMALN, a positive number"
			}
		]
	},
	{
		name: "GAMMALN.PRECISE",
		description: "Returns the natural logarithm of the gamma function.",
		arguments: [
			{
				name: "x",
				description: "is the value for which you want to calculate GAMMALN.PRECISE, a positive number"
			}
		]
	},
	{
		name: "GAUSS",
		description: "",
		arguments: [
			{
				name: "",
				description: ""
			}
		]
	},
	{
		name: "GCD",
		description: "Returns the greatest common divisor.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 values"
			},
			{
				name: "number2",
				description: "are 1 to 255 values"
			}
		]
	},
	{
		name: "GEOMEAN",
		description: "Returns the geometric mean of an array or range of positive numeric data.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numbers or names, arrays, or references that contain numbers for which you want the mean"
			},
			{
				name: "number2",
				description: "are 1 to 255 numbers or names, arrays, or references that contain numbers for which you want the mean"
			}
		]
	},
	{
		name: "GESTEP",
		description: "Tests whether a number is greater than a threshold value.",
		arguments: [
			{
				name: "number",
				description: "is the value to test against step"
			},
			{
				name: "step",
				description: "is the threshold value"
			}
		]
	},
	{
		name: "GETPIVOTDATA",
		description: "Extracts data stored in a PivotTable.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "data_field",
				description: "is the name of the data field to extract data from"
			},
			{
				name: "pivot_table",
				description: "is a reference to a cell or range of cells in the PivotTable that contains the data you want to retrieve"
			},
			{
				name: "field",
				description: "field to refer to"
			},
			{
				name: "item",
				description: "field item to refer to"
			}
		]
	},
	{
		name: "GROWTH",
		description: "Returns numbers in an exponential growth trend matching known data points.",
		arguments: [
			{
				name: "known_y's",
				description: "is the set of y-values you already know in the relationship y = b*m^x, an array or range of positive numbers"
			},
			{
				name: "known_x's",
				description: "is an optional set of x-values that you may already know in the relationship y = b*m^x, an array or range the same size as Known_y's"
			},
			{
				name: "new_x's",
				description: "are new x-values for which you want GROWTH to return corresponding y-values"
			},
			{
				name: "const",
				description: "is a logical value: the constant b is calculated normally if Const = TRUE; b is set equal to 1 if Const = FALSE or omitted"
			}
		]
	},
	{
		name: "HARMEAN",
		description: "Returns the harmonic mean of a data set of positive numbers: the reciprocal of the arithmetic mean of reciprocals.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numbers or names, arrays, or references that contain numbers for which you want the harmonic mean"
			},
			{
				name: "number2",
				description: "are 1 to 255 numbers or names, arrays, or references that contain numbers for which you want the harmonic mean"
			}
		]
	},
	{
		name: "HEX2BIN",
		description: "Converts a Hexadecimal number to binary.",
		arguments: [
			{
				name: "number",
				description: "is the hexadecimal number you want to convert"
			},
			{
				name: "places",
				description: "is the number of characters to use"
			}
		]
	},
	{
		name: "HEX2DEC",
		description: "Converts a hexadecimal number to decimal.",
		arguments: [
			{
				name: "number",
				description: "is the hexadecimal number you want to convert"
			}
		]
	},
	{
		name: "HEX2OCT",
		description: "Converts a hexadecimal number to octal.",
		arguments: [
			{
				name: "number",
				description: "is the hexadecimal number you want to convert"
			},
			{
				name: "places",
				description: "is the number of characters to use"
			}
		]
	},
	{
		name: "HLOOKUP",
		description: "Looks for a value in the top row of a table or array of values and returns the value in the same column from a row you specify.",
		arguments: [
			{
				name: "lookup_value",
				description: "is the value to be found in the first row of the table and can be a value, a reference, or a text string"
			},
			{
				name: "table_array",
				description: "is a table of text, numbers, or logical values in which data is looked up. Table_array can be a reference to a range or a range name"
			},
			{
				name: "row_index_num",
				description: "is the row number in table_array from which the matching value should be returned. The first row of values in the table is row 1"
			},
			{
				name: "range_lookup",
				description: "is a logical value: to find the closest match in the top row (sorted in ascending order) = TRUE or omitted; find an exact match = FALSE"
			}
		]
	},
	{
		name: "HOUR",
		description: "Returns the hour as a number from 0 (12:00 A.M.) to 23 (11:00 P.M.).",
		arguments: [
			{
				name: "serial_number",
				description: "is a number in the date-time code used by Spreadsheet, or text in time format, such as 16:48:00 or 4:48:00 PM"
			}
		]
	},
	{
		name: "HYPERLINK",
		description: "Creates a shortcut or jump that opens a document stored on your hard drive, a network server, or on the Internet.",
		arguments: [
			{
				name: "link_location",
				description: "is the text giving the path and file name to the document to be opened, a hard drive location, UNC address, or URL path"
			},
			{
				name: "friendly_name",
				description: "is text or a number that is displayed in the cell. If omitted, the cell displays the Link_location text"
			}
		]
	},
	{
		name: "HYPGEOM.DIST",
		description: "Returns the hypergeometric distribution.",
		arguments: [
			{
				name: "sample_s",
				description: "is the number of successes in the sample"
			},
			{
				name: "number_sample",
				description: "is the size of the sample"
			},
			{
				name: "population_s",
				description: "is the number of successes in the population"
			},
			{
				name: "number_pop",
				description: "is the population size"
			},
			{
				name: "cumulative",
				description: "is a logical value: for the cumulative distribution function, use TRUE; for the probability density function, use FALSE"
			}
		]
	},
	{
		name: "HYPGEOMDIST",
		description: "Returns the hypergeometric distribution.",
		arguments: [
			{
				name: "sample_s",
				description: "is the number of successes in the sample"
			},
			{
				name: "number_sample",
				description: "is the size of the sample"
			},
			{
				name: "population_s",
				description: "is the number of successes in the population"
			},
			{
				name: "number_pop",
				description: "is the population size"
			}
		]
	},
	{
		name: "IF",
		description: "Checks whether a condition is met, and returns one value if TRUE, and another value if FALSE.",
		arguments: [
			{
				name: "logical_test",
				description: "is any value or expression that can be evaluated to TRUE or FALSE"
			},
			{
				name: "value_if_true",
				description: "is the value that is returned if Logical_test is TRUE. If omitted, TRUE is returned. You can nest up to seven IF functions"
			},
			{
				name: "value_if_false",
				description: "is the value that is returned if Logical_test is FALSE. If omitted, FALSE is returned"
			}
		]
	},
	{
		name: "IFERROR",
		description: "Returns value_if_error if expression is an error and the value of the expression itself otherwise.",
		arguments: [
			{
				name: "value",
				description: "is any value or expression or reference"
			},
			{
				name: "value_if_error",
				description: "is any value or expression or reference"
			}
		]
	},
	{
		name: "IFNA",
		description: "Returns the value you specify if the expression resolves to #N/A, otherwise returns the result of the expression.",
		arguments: [
			{
				name: "value",
				description: "is any value or expression or reference"
			},
			{
				name: "value_if_na",
				description: "is any value or expression or reference"
			}
		]
	},
	{
		name: "IMABS",
		description: "Returns the absolute value (modulus) of a complex number.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the absolute value"
			}
		]
	},
	{
		name: "IMAGINARY",
		description: "Returns the imaginary coefficient of a complex number.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the imaginary coefficient"
			}
		]
	},
	{
		name: "IMARGUMENT",
		description: "Returns the argument q, an angle expressed in radians.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the argument"
			}
		]
	},
	{
		name: "IMCONJUGATE",
		description: "Returns the complex conjugate of a complex number.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the conjugate"
			}
		]
	},
	{
		name: "IMCOS",
		description: "Returns the cosine of a complex number.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the cosine"
			}
		]
	},
	{
		name: "IMCOSH",
		description: "Returns the hyperbolic cosine of a complex number.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the hyperbolic cosine"
			}
		]
	},
	{
		name: "IMCOT",
		description: "Returns the cotangent of a complex number.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the cotangent"
			}
		]
	},
	{
		name: "IMCSC",
		description: "Returns the cosecant of a complex number.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the cosecant"
			}
		]
	},
	{
		name: "IMCSCH",
		description: "Returns the hyperbolic cosecant of a complex number.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the hyperbolic cosecant"
			}
		]
	},
	{
		name: "IMDIV",
		description: "Returns the quotient of two complex numbers.",
		arguments: [
			{
				name: "inumber1",
				description: "is the complex numerator or dividend"
			},
			{
				name: "inumber2",
				description: "is the complex denominator or divisor"
			}
		]
	},
	{
		name: "IMEXP",
		description: "Returns the exponential of a complex number.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the exponential"
			}
		]
	},
	{
		name: "IMLN",
		description: "Returns the natural logarithm of a complex number.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the natural logarithm"
			}
		]
	},
	{
		name: "IMLOG10",
		description: "Returns the base-10 logarithm of a complex number.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the common logarithm"
			}
		]
	},
	{
		name: "IMLOG2",
		description: "Returns the base-2 logarithm of a complex number.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the base-2 logarithm"
			}
		]
	},
	{
		name: "IMPOWER",
		description: "Returns a complex number raised to an integer power.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number you want to raise to a power"
			},
			{
				name: "number",
				description: "is the power to which you want to raise the complex number"
			}
		]
	},
	{
		name: "IMPRODUCT",
		description: "Returns the product of 1 to 255 complex numbers.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "inumber1",
				description: "Inumber1, Inumber2,... are from 1 to 255 complex numbers to multiply."
			},
			{
				name: "inumber2",
				description: "Inumber1, Inumber2,... are from 1 to 255 complex numbers to multiply."
			}
		]
	},
	{
		name: "IMREAL",
		description: "Returns the real coefficient of a complex number.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the real coefficient"
			}
		]
	},
	{
		name: "IMSEC",
		description: "Returns the secant of a complex number.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the secant"
			}
		]
	},
	{
		name: "IMSECH",
		description: "Returns the hyperbolic secant of a complex number.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the hyperbolic secant"
			}
		]
	},
	{
		name: "IMSIN",
		description: "Returns the sine of a complex number.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the sine"
			}
		]
	},
	{
		name: "IMSINH",
		description: "Returns the hyperbolic sine of a complex number.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the hyperbolic sine"
			}
		]
	},
	{
		name: "IMSQRT",
		description: "Returns the square root of a complex number.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the square root"
			}
		]
	},
	{
		name: "IMSUB",
		description: "Returns the difference of two complex numbers.",
		arguments: [
			{
				name: "inumber1",
				description: "is the complex number from which to subtract inumber2"
			},
			{
				name: "inumber2",
				description: "is the complex number to subtract from inumber1"
			}
		]
	},
	{
		name: "IMSUM",
		description: "Returns the sum of complex numbers.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "inumber1",
				description: "are from 1 to 255 complex numbers to add"
			},
			{
				name: "inumber2",
				description: "are from 1 to 255 complex numbers to add"
			}
		]
	},
	{
		name: "IMTAN",
		description: "Returns the tangent of a complex number.",
		arguments: [
			{
				name: "inumber",
				description: "is a complex number for which you want the tangent"
			}
		]
	},
	{
		name: "INDEX",
		description: "Returns a value or reference of the cell at the intersection of a particular row and column, in a given range.",
		arguments: [
			{
				name: "array",
				description: "is a range of cells or an array constant."
			},
			{
				name: "row_num",
				description: "selects the row in Array or Reference from which to return a value. If omitted, Column_num is required"
			},
			{
				name: "column_num",
				description: "selects the column in Array or Reference from which to return a value. If omitted, Row_num is required"
			}
		]
	},
	{
		name: "INDIRECT",
		description: "Returns the reference specified by a text string.",
		arguments: [
			{
				name: "ref_text",
				description: "is a reference to a cell that contains an A1- or R1C1-style reference, a name defined as a reference, or a reference to a cell as a text string"
			},
			{
				name: "a1",
				description: "is a logical value that specifies the type of reference in Ref_text: R1C1-style = FALSE; A1-style = TRUE or omitted"
			}
		]
	},
	{
		name: "INFO",
		description: "Returns information about the current operating environment.",
		arguments: [
			{
				name: "type_text",
				description: "is text specifying what type of information you want returned."
			}
		]
	},
	{
		name: "INT",
		description: "Rounds a number down to the nearest integer.",
		arguments: [
			{
				name: "number",
				description: "is the real number you want to round down to an integer"
			}
		]
	},
	{
		name: "INTERCEPT",
		description: "Calculates the point at which a line will intersect the y-axis by using a best-fit regression line plotted through the known x-values and y-values.",
		arguments: [
			{
				name: "known_y's",
				description: "is the dependent set of observations or data and can be numbers or names, arrays, or references that contain numbers"
			},
			{
				name: "known_x's",
				description: "is the independent set of observations or data and can be numbers or names, arrays, or references that contain numbers"
			}
		]
	},
	{
		name: "INTRATE",
		description: "Returns the interest rate for a fully invested security.",
		arguments: [
			{
				name: "settlement",
				description: "is the security's settlement date, expressed as a serial date number"
			},
			{
				name: "maturity",
				description: "is the security's maturity date, expressed as a serial date number"
			},
			{
				name: "investment",
				description: "is the amount invested in the security"
			},
			{
				name: "redemption",
				description: "is the amount to be received at maturity"
			},
			{
				name: "basis",
				description: "is the type of day count basis to use"
			}
		]
	},
	{
		name: "IPMT",
		description: "Returns the interest payment for a given period for an investment, based on periodic, constant payments and a constant interest rate.",
		arguments: [
			{
				name: "rate",
				description: "is the interest rate per period. For example, use 6%/4 for quarterly payments at 6% APR"
			},
			{
				name: "per",
				description: "is the period for which you want to find the interest and must be in the range 1 to Nper"
			},
			{
				name: "nper",
				description: "is the total number of payment periods in an investment"
			},
			{
				name: "pv",
				description: "is the present value, or the lump-sum amount that a series of future payments is worth now"
			},
			{
				name: "fv",
				description: "is the future value, or a cash balance you want to attain after the last payment is made. If omitted, Fv = 0"
			},
			{
				name: "type",
				description: "is a logical value representing the timing of payment: at the end of the period = 0 or omitted, at the beginning of the period = 1"
			}
		]
	},
	{
		name: "IRR",
		description: "Returns the internal rate of return for a series of cash flows.",
		arguments: [
			{
				name: "values",
				description: "is an array or a reference to cells that contain numbers for which you want to calculate the internal rate of return"
			},
			{
				name: "guess",
				description: "is a number that you guess is close to the result of IRR; 0.1 (10 percent) if omitted"
			}
		]
	},
	{
		name: "ISBLANK",
		description: "Checks whether a reference is to an empty cell, and returns TRUE or FALSE.",
		arguments: [
			{
				name: "value",
				description: "is the cell or a name that refers to the cell you want to test"
			}
		]
	},
	{
		name: "ISERR",
		description: "Checks whether a value is an error (#VALUE!, #REF!, #DIV/0!, #NUM!, #NAME?, or #NULL!) excluding #N/A, and returns TRUE or FALSE.",
		arguments: [
			{
				name: "value",
				description: "is the value you want to test. Value can refer to a cell, a formula, or a name that refers to a cell, formula, or value"
			}
		]
	},
	{
		name: "ISERROR",
		description: "Checks whether a value is an error (#N/A, #VALUE!, #REF!, #DIV/0!, #NUM!, #NAME?, or #NULL!), and returns TRUE or FALSE.",
		arguments: [
			{
				name: "value",
				description: "is the value you want to test. Value can refer to a cell, a formula, or a name that refers to a cell, formula, or value"
			}
		]
	},
	{
		name: "ISEVEN",
		description: "Returns TRUE if the number is even.",
		arguments: [
			{
				name: "number",
				description: "is the value to test"
			}
		]
	},
	{
		name: "ISFORMULA",
		description: "Checks whether a reference is to a cell containing a formula, and returns TRUE or FALSE.",
		arguments: [
			{
				name: "reference",
				description: "is a reference to the cell you want to test.  Reference can be a cell reference, a formula, or name that refers to a cell"
			}
		]
	},
	{
		name: "ISLOGICAL",
		description: "Checks whether a value is a logical value (TRUE or FALSE), and returns TRUE or FALSE.",
		arguments: [
			{
				name: "value",
				description: "is the value you want to test. Value can refer to a cell, a formula, or a name that refers to a cell, formula, or value"
			}
		]
	},
	{
		name: "ISNA",
		description: "Checks whether a value is #N/A, and returns TRUE or FALSE.",
		arguments: [
			{
				name: "value",
				description: "is the value you want to test. Value can refer to a cell, a formula, or a name that refers to a cell, formula, or value"
			}
		]
	},
	{
		name: "ISNONTEXT",
		description: "Checks whether a value is not text (blank cells are not text), and returns TRUE or FALSE.",
		arguments: [
			{
				name: "value",
				description: "is the value you want tested: a cell; a formula; or a name referring to a cell, formula, or value"
			}
		]
	},
	{
		name: "ISNUMBER",
		description: "Checks whether a value is a number, and returns TRUE or FALSE.",
		arguments: [
			{
				name: "value",
				description: "is the value you want to test. Value can refer to a cell, a formula, or a name that refers to a cell, formula, or value"
			}
		]
	},
	{
		name: "ISO.CEILING",
		description: "Rounds a number up, to the nearest integer or to the nearest multiple of significance.",
		arguments: [
			{
				name: "number",
				description: "is the value you want to round"
			},
			{
				name: "significance",
				description: "is the optional multiple to which you want to round"
			}
		]
	},
	{
		name: "ISODD",
		description: "Returns TRUE if the number is odd.",
		arguments: [
			{
				name: "number",
				description: "is the value to test"
			}
		]
	},
	{
		name: "ISOWEEKNUM",
		description: "Returns number of the ISO week number of the year for a given date.",
		arguments: [
			{
				name: "date",
				description: "is the date-time code used by Spreadsheet for date and time calculation"
			}
		]
	},
	{
		name: "ISPMT",
		description: "Returns the interest paid during a specific period of an investment.",
		arguments: [
			{
				name: "rate",
				description: "interest rate per period. For example, use 6%/4 for quarterly payments at 6% APR"
			},
			{
				name: "per",
				description: "period for which you want to find the interest"
			},
			{
				name: "nper",
				description: "number of payment periods in an investment"
			},
			{
				name: "pv",
				description: "lump sum amount that a series of future payments is right now"
			}
		]
	},
	{
		name: "ISREF",
		description: "Checks whether a value is a reference, and returns TRUE or FALSE.",
		arguments: [
			{
				name: "value",
				description: "is the value you want to test. Value can refer to a cell, a formula, or a name that refers to a cell, formula, or value"
			}
		]
	},
	{
		name: "ISTEXT",
		description: "Checks whether a value is text, and returns TRUE or FALSE.",
		arguments: [
			{
				name: "value",
				description: "is the value you want to test. Value can refer to a cell, a formula, or a name that refers to a cell, formula, or value"
			}
		]
	},
	{
		name: "KURT",
		description: "Returns the kurtosis of a data set.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numbers or names, arrays, or references that contain numbers for which you want the kurtosis"
			},
			{
				name: "number2",
				description: "are 1 to 255 numbers or names, arrays, or references that contain numbers for which you want the kurtosis"
			}
		]
	},
	{
		name: "LARGE",
		description: "Returns the k-th largest value in a data set. For example, the fifth largest number.",
		arguments: [
			{
				name: "array",
				description: "is the array or range of data for which you want to determine the k-th largest value"
			},
			{
				name: "k",
				description: "is the position (from the largest) in the array or cell range of the value to return"
			}
		]
	},
	{
		name: "LCM",
		description: "Returns the least common multiple.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 values for which you want the least common multiple"
			},
			{
				name: "number2",
				description: "are 1 to 255 values for which you want the least common multiple"
			}
		]
	},
	{
		name: "LEFT",
		description: "Returns the specified number of characters from the start of a text string.",
		arguments: [
			{
				name: "text",
				description: "is the text string containing the characters you want to extract"
			},
			{
				name: "num_chars",
				description: "specifies how many characters you want LEFT to extract; 1 if omitted"
			}
		]
	},
	{
		name: "LEN",
		description: "Returns the number of characters in a text string.",
		arguments: [
			{
				name: "text",
				description: "is the text whose length you want to find. Spaces count as characters"
			}
		]
	},
	{
		name: "LINEST",
		description: "Returns statistics that describe a linear trend matching known data points, by fitting a straight line using the least squares method.",
		arguments: [
			{
				name: "known_y's",
				description: "is the set of y-values you already know in the relationship y = mx + b"
			},
			{
				name: "known_x's",
				description: "is an optional set of x-values that you may already know in the relationship y = mx + b"
			},
			{
				name: "const",
				description: "is a logical value: the constant b is calculated normally if Const = TRUE or omitted; b is set equal to 0 if Const = FALSE"
			},
			{
				name: "stats",
				description: "is a logical value: return additional regression statistics = TRUE; return m-coefficients and the constant b = FALSE or omitted"
			}
		]
	},
	{
		name: "LN",
		description: "Returns the natural logarithm of a number.",
		arguments: [
			{
				name: "number",
				description: "is the positive real number for which you want the natural logarithm"
			}
		]
	},
	{
		name: "LOG",
		description: "Returns the logarithm of a number to the base you specify.",
		arguments: [
			{
				name: "number",
				description: "is the positive real number for which you want the logarithm"
			},
			{
				name: "base",
				description: "is the base of the logarithm; 10 if omitted"
			}
		]
	},
	{
		name: "LOG10",
		description: "Returns the base-10 logarithm of a number.",
		arguments: [
			{
				name: "number",
				description: "is the positive real number for which you want the base-10 logarithm"
			}
		]
	},
	{
		name: "LOGEST",
		description: "Returns statistics that describe an exponential curve matching known data points.",
		arguments: [
			{
				name: "known_y's",
				description: "is the set of y-values you already know in the relationship y = b*m^x"
			},
			{
				name: "known_x's",
				description: "is an optional set of x-values that you may already know in the relationship y = b*m^x"
			},
			{
				name: "const",
				description: "is a logical value: the constant b is calculated normally if Const = TRUE or omitted; b is set equal to 1 if Const = FALSE"
			},
			{
				name: "stats",
				description: "is a logical value: return additional regression statistics = TRUE; return m-coefficients and the constant b = FALSE or omitted"
			}
		]
	},
	{
		name: "LOGINV",
		description: "Returns the inverse of the lognormal cumulative distribution function of x, where ln(x) is normally distributed with parameters Mean and Standard_dev.",
		arguments: [
			{
				name: "probability",
				description: "is a probability associated with the lognormal distribution, a number between 0 and 1, inclusive"
			},
			{
				name: "mean",
				description: "is the mean of ln(x)"
			},
			{
				name: "standard_dev",
				description: "is the standard deviation of ln(x), a positive number"
			}
		]
	},
	{
		name: "LOGNORM.DIST",
		description: "Returns the lognormal distribution of x, where ln(x) is normally distributed with parameters Mean and Standard_dev.",
		arguments: [
			{
				name: "x",
				description: "is the value at which to evaluate the function, a positive number"
			},
			{
				name: "mean",
				description: "is the mean of ln(x)"
			},
			{
				name: "standard_dev",
				description: "is the standard deviation of ln(x), a positive number"
			},
			{
				name: "cumulative",
				description: "is a logical value: for the cumulative distribution function, use TRUE; for the probability density function, use FALSE"
			}
		]
	},
	{
		name: "LOGNORM.INV",
		description: "Returns the inverse of the lognormal cumulative distribution function of x, where ln(x) is normally distributed with parameters Mean and Standard_dev.",
		arguments: [
			{
				name: "probability",
				description: "is a probability associated with the lognormal distribution, a number between 0 and 1, inclusive"
			},
			{
				name: "mean",
				description: "is the mean of ln(x)"
			},
			{
				name: "standard_dev",
				description: "is the standard deviation of ln(x), a positive number"
			}
		]
	},
	{
		name: "LOGNORMDIST",
		description: "Returns the cumulative lognormal distribution of x, where ln(x) is normally distributed with parameters Mean and Standard_dev.",
		arguments: [
			{
				name: "x",
				description: "is the value at which to evaluate the function, a positive number"
			},
			{
				name: "mean",
				description: "is the mean of ln(x)"
			},
			{
				name: "standard_dev",
				description: "is the standard deviation of ln(x), a positive number"
			}
		]
	},
	{
		name: "LOOKUP",
		description: "Looks up a value either from a one-row or one-column range or from an array. Provided for backward compatibility.",
		arguments: [
			{
				name: "lookup_value",
				description: "is a value that LOOKUP searches for in Lookup_vector and can be a number, text, a logical value, or a name or reference to a value"
			},
			{
				name: "lookup_vector",
				description: "is a range that contains only one row or one column of text, numbers, or logical values, placed in ascending order"
			},
			{
				name: "result_vector",
				description: "is a range that contains only one row or column, the same size as Lookup_vector"
			}
		]
	},
	{
		name: "LOWER",
		description: "Converts all letters in a text string to lowercase.",
		arguments: [
			{
				name: "text",
				description: "is the text you want to convert to lowercase. Characters in Text that are not letters are not changed"
			}
		]
	},
	{
		name: "MATCH",
		description: "Returns the relative position of an item in an array that matches a specified value in a specified order.",
		arguments: [
			{
				name: "lookup_value",
				description: "is the value you use to find the value you want in the array, a number, text, or logical value, or a reference to one of these"
			},
			{
				name: "lookup_array",
				description: "is a contiguous range of cells containing possible lookup values, an array of values, or a reference to an array"
			},
			{
				name: "match_type",
				description: "is a number 1, 0, or -1 indicating which value to return."
			}
		]
	},
	{
		name: "MAX",
		description: "Returns the largest value in a set of values. Ignores logical values and text.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numbers, empty cells, logical values, or text numbers for which you want the maximum"
			},
			{
				name: "number2",
				description: "are 1 to 255 numbers, empty cells, logical values, or text numbers for which you want the maximum"
			}
		]
	},
	{
		name: "MAXA",
		description: "Returns the largest value in a set of values. Does not ignore logical values and text.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "value1",
				description: "are 1 to 255 numbers, empty cells, logical values, or text numbers for which you want the maximum"
			},
			{
				name: "value2",
				description: "are 1 to 255 numbers, empty cells, logical values, or text numbers for which you want the maximum"
			}
		]
	},
	{
		name: "MDETERM",
		description: "Returns the matrix determinant of an array.",
		arguments: [
			{
				name: "array",
				description: "is a numeric array with an equal number of rows and columns, either a cell range or an array constant"
			}
		]
	},
	{
		name: "MEDIAN",
		description: "Returns the median, or the number in the middle of the set of given numbers.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numbers or names, arrays, or references that contain numbers for which you want the median"
			},
			{
				name: "number2",
				description: "are 1 to 255 numbers or names, arrays, or references that contain numbers for which you want the median"
			}
		]
	},
	{
		name: "MID",
		description: "Returns the characters from the middle of a text string, given a starting position and length.",
		arguments: [
			{
				name: "text",
				description: "is the text string from which you want to extract the characters"
			},
			{
				name: "start_num",
				description: "is the position of the first character you want to extract. The first character in Text is 1"
			},
			{
				name: "num_chars",
				description: "specifies how many characters to return from Text"
			}
		]
	},
	{
		name: "MIN",
		description: "Returns the smallest number in a set of values. Ignores logical values and text.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numbers, empty cells, logical values, or text numbers for which you want the minimum"
			},
			{
				name: "number2",
				description: "are 1 to 255 numbers, empty cells, logical values, or text numbers for which you want the minimum"
			}
		]
	},
	{
		name: "MINA",
		description: "Returns the smallest value in a set of values. Does not ignore logical values and text.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "value1",
				description: "are 1 to 255 numbers, empty cells, logical values, or text numbers for which you want the minimum"
			},
			{
				name: "value2",
				description: "are 1 to 255 numbers, empty cells, logical values, or text numbers for which you want the minimum"
			}
		]
	},
	{
		name: "MINUTE",
		description: "Returns the minute, a number from 0 to 59.",
		arguments: [
			{
				name: "serial_number",
				description: "is a number in the date-time code used by Spreadsheet or text in time format, such as 16:48:00 or 4:48:00 PM"
			}
		]
	},
	{
		name: "MINVERSE",
		description: "Returns the inverse matrix for the matrix stored in an array.",
		arguments: [
			{
				name: "array",
				description: "is a numeric array with an equal number of rows and columns, either a cell range or an array constant"
			}
		]
	},
	{
		name: "MIRR",
		description: "Returns the internal rate of return for a series of periodic cash flows, considering both cost of investment and interest on reinvestment of cash.",
		arguments: [
			{
				name: "values",
				description: "is an array or a reference to cells that contain numbers that represent a series of payments (negative) and income (positive) at regular periods"
			},
			{
				name: "finance_rate",
				description: "is the interest rate you pay on the money used in the cash flows"
			},
			{
				name: "reinvest_rate",
				description: "is the interest rate you receive on the cash flows as you reinvest them"
			}
		]
	},
	{
		name: "MMULT",
		description: "Returns the matrix product of two arrays, an array with the same number of rows as array1 and columns as array2.",
		arguments: [
			{
				name: "array1",
				description: "is the first array of numbers to multiply and must have the same number of columns as Array2 has rows"
			},
			{
				name: "array2",
				description: "is the first array of numbers to multiply and must have the same number of columns as Array2 has rows"
			}
		]
	},
	{
		name: "MOD",
		description: "Returns the remainder after a number is divided by a divisor.",
		arguments: [
			{
				name: "number",
				description: "is the number for which you want to find the remainder after the division is performed"
			},
			{
				name: "divisor",
				description: "is the number by which you want to divide Number"
			}
		]
	},
	{
		name: "MODE",
		description: "Returns the most frequently occurring, or repetitive, value in an array or range of data.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numbers, or names, arrays, or references that contain numbers for which you want the mode"
			},
			{
				name: "number2",
				description: "are 1 to 255 numbers, or names, arrays, or references that contain numbers for which you want the mode"
			}
		]
	},
	{
		name: "MODE.MULT",
		description: "Returns a vertical array of the most frequently occurring, or repetitive, values in an array or range of data.  For a horizontal array, use =TRANSPOSE(MODE.MULT(number1,number2,...)).",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numbers, or names, arrays, or references that contain numbers for which you want the mode"
			},
			{
				name: "number2",
				description: "are 1 to 255 numbers, or names, arrays, or references that contain numbers for which you want the mode"
			}
		]
	},
	{
		name: "MODE.SNGL",
		description: "Returns the most frequently occurring, or repetitive, value in an array or range of data.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numbers, or names, arrays, or references that contain numbers for which you want the mode"
			},
			{
				name: "number2",
				description: "are 1 to 255 numbers, or names, arrays, or references that contain numbers for which you want the mode"
			}
		]
	},
	{
		name: "MONTH",
		description: "Returns the month, a number from 1 (January) to 12 (December).",
		arguments: [
			{
				name: "serial_number",
				description: "is a number in the date-time code used by Spreadsheet"
			}
		]
	},
	{
		name: "MROUND",
		description: "Returns a number rounded to the desired multiple.",
		arguments: [
			{
				name: "number",
				description: "is the value to round"
			},
			{
				name: "multiple",
				description: "is the multiple to which you want to round number"
			}
		]
	},
	{
		name: "MULTINOMIAL",
		description: "Returns the multinomial of a set of numbers.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 values for which you want the multinomial"
			},
			{
				name: "number2",
				description: "are 1 to 255 values for which you want the multinomial"
			}
		]
	},
	{
		name: "MUNIT",
		description: "Returns the unit matrix for the specified dimension.",
		arguments: [
			{
				name: "dimension",
				description: "is an integer specifying the dimension of the unit matrix that you want to return"
			}
		]
	},
	{
		name: "N",
		description: "Converts non-number value to a number, dates to serial numbers, TRUE to 1, anything else to 0 (zero).",
		arguments: [
			{
				name: "value",
				description: "is the value you want converted"
			}
		]
	},
	{
		name: "NA",
		description: "Returns the error value #N/A (value not available).",
		arguments: [
		]
	},
	{
		name: "NEGBINOM.DIST",
		description: "Returns the negative binomial distribution, the probability that there will be Number_f failures before the Number_s-th success, with Probability_s probability of a success.",
		arguments: [
			{
				name: "number_f",
				description: "is the number of failures"
			},
			{
				name: "number_s",
				description: "is the threshold number of successes"
			},
			{
				name: "probability_s",
				description: "is the probability of a success; a number between 0 and 1"
			},
			{
				name: "cumulative",
				description: "is a logical value: for the cumulative distribution function, use TRUE; for the probability mass function, use FALSE"
			}
		]
	},
	{
		name: "NEGBINOMDIST",
		description: "Returns the negative binomial distribution, the probability that there will be Number_f failures before the Number_s-th success, with Probability_s probability of a success.",
		arguments: [
			{
				name: "number_f",
				description: "is the number of failures"
			},
			{
				name: "number_s",
				description: "is the threshold number of successes"
			},
			{
				name: "probability_s",
				description: "is the probability of a success; a number between 0 and 1"
			}
		]
	},
	{
		name: "NETWORKDAYS",
		description: "Returns the number of whole workdays between two dates.",
		arguments: [
			{
				name: "start_date",
				description: "is a serial date number that represents the start date"
			},
			{
				name: "end_date",
				description: "is a serial date number that represents the end date"
			},
			{
				name: "holidays",
				description: "is an optional set of one or more serial date numbers to exclude from the working calendar, such as state and federal holidays and floating holidays"
			}
		]
	},
	{
		name: "NETWORKDAYS.INTL",
		description: "Returns the number of whole workdays between two dates with custom weekend parameters.",
		arguments: [
			{
				name: "start_date",
				description: "is a serial date number that represents the start date"
			},
			{
				name: "end_date",
				description: "is a serial date number that represents the end date"
			},
			{
				name: "weekend",
				description: "is a number or string specifying when weekends occur"
			},
			{
				name: "holidays",
				description: "is an optional set of one or more serial date numbers to exclude from the working calendar, such as state and federal holidays and floating holidays"
			}
		]
	},
	{
		name: "NOMINAL",
		description: "Returns the annual nominal interest rate.",
		arguments: [
			{
				name: "effect_rate",
				description: "is the effective interest rate"
			},
			{
				name: "npery",
				description: "is the number of compounding periods per year"
			}
		]
	},
	{
		name: "NORM.DIST",
		description: "Returns the normal distribution for the specified mean and standard deviation.",
		arguments: [
			{
				name: "x",
				description: "is the value for which you want the distribution"
			},
			{
				name: "mean",
				description: "is the arithmetic mean of the distribution"
			},
			{
				name: "standard_dev",
				description: "is the standard deviation of the distribution, a positive number"
			},
			{
				name: "cumulative",
				description: "is a logical value: for the cumulative distribution function, use TRUE; for the probability density function, use FALSE"
			}
		]
	},
	{
		name: "NORM.INV",
		description: "Returns the inverse of the normal cumulative distribution for the specified mean and standard deviation.",
		arguments: [
			{
				name: "probability",
				description: "is a probability corresponding to the normal distribution, a number between 0 and 1 inclusive"
			},
			{
				name: "mean",
				description: "is the arithmetic mean of the distribution"
			},
			{
				name: "standard_dev",
				description: "is the standard deviation of the distribution, a positive number"
			}
		]
	},
	{
		name: "NORM.S.DIST",
		description: "Returns the standard normal distribution (has a mean of zero and a standard deviation of one).",
		arguments: [
			{
				name: "z",
				description: "is the value for which you want the distribution"
			},
			{
				name: "cumulative",
				description: "is a logical value for the function to return: the cumulative distribution function = TRUE; the probability density function = FALSE"
			}
		]
	},
	{
		name: "NORM.S.INV",
		description: "Returns the inverse of the standard normal cumulative distribution (has a mean of zero and a standard deviation of one).",
		arguments: [
			{
				name: "probability",
				description: "is a probability corresponding to the normal distribution, a number between 0 and 1 inclusive"
			}
		]
	},
	{
		name: "NORMDIST",
		description: "Returns the normal cumulative distribution for the specified mean and standard deviation.",
		arguments: [
			{
				name: "x",
				description: "is the value for which you want the distribution"
			},
			{
				name: "mean",
				description: "is the arithmetic mean of the distribution"
			},
			{
				name: "standard_dev",
				description: "is the standard deviation of the distribution, a positive number"
			},
			{
				name: "cumulative",
				description: "is a logical value: for the cumulative distribution function, use TRUE; for the probability density function, use FALSE"
			}
		]
	},
	{
		name: "NORMINV",
		description: "Returns the inverse of the normal cumulative distribution for the specified mean and standard deviation.",
		arguments: [
			{
				name: "probability",
				description: "is a probability corresponding to the normal distribution, a number between 0 and 1 inclusive"
			},
			{
				name: "mean",
				description: "is the arithmetic mean of the distribution"
			},
			{
				name: "standard_dev",
				description: "is the standard deviation of the distribution, a positive number"
			}
		]
	},
	{
		name: "NORMSDIST",
		description: "Returns the standard normal cumulative distribution (has a mean of zero and a standard deviation of one).",
		arguments: [
			{
				name: "z",
				description: "is the value for which you want the distribution"
			}
		]
	},
	{
		name: "NORMSINV",
		description: "Returns the inverse of the standard normal cumulative distribution (has a mean of zero and a standard deviation of one).",
		arguments: [
			{
				name: "probability",
				description: "is a probability corresponding to the normal distribution, a number between 0 and 1 inclusive"
			}
		]
	},
	{
		name: "NOT",
		description: "Changes FALSE to TRUE, or TRUE to FALSE.",
		arguments: [
			{
				name: "logical",
				description: "is a value or expression that can be evaluated to TRUE or FALSE"
			}
		]
	},
	{
		name: "NOW",
		description: "Returns the current date and time formatted as a date and time.",
		arguments: [
		]
	},
	{
		name: "NPER",
		description: "Returns the number of periods for an investment based on periodic, constant payments and a constant interest rate.",
		arguments: [
			{
				name: "rate",
				description: "is the interest rate per period. For example, use 6%/4 for quarterly payments at 6% APR"
			},
			{
				name: "pmt",
				description: "is the payment made each period; it cannot change over the life of the investment"
			},
			{
				name: "pv",
				description: "is the present value, or the lump-sum amount that a series of future payments is worth now"
			},
			{
				name: "fv",
				description: "is the future value, or a cash balance you want to attain after the last payment is made. If omitted, zero is used"
			},
			{
				name: "type",
				description: "is a logical value: payment at the beginning of the period = 1; payment at the end of the period = 0 or omitted"
			}
		]
	},
	{
		name: "NPV",
		description: "Returns the net present value of an investment based on a discount rate and a series of future payments (negative values) and income (positive values).",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "rate",
				description: "is the rate of discount over the length of one period"
			},
			{
				name: "value1",
				description: "are 1 to 254 payments and income, equally spaced in time and occurring at the end of each period"
			},
			{
				name: "value2",
				description: "are 1 to 254 payments and income, equally spaced in time and occurring at the end of each period"
			}
		]
	},
	{
		name: "NUMBERVALUE",
		description: "Converts text to number in a locale-independent manner.",
		arguments: [
			{
				name: "text",
				description: "is the string representing the number you want to convert"
			},
			{
				name: "decimal_separator",
				description: "is the character used as the decimal separator in the string"
			},
			{
				name: "group_separator",
				description: "is the character used as the group separator in the string"
			}
		]
	},
	{
		name: "OCT2BIN",
		description: "Converts an octal number to binary.",
		arguments: [
			{
				name: "number",
				description: "is the octal number you want to convert"
			},
			{
				name: "places",
				description: "is the number of characters to use"
			}
		]
	},
	{
		name: "OCT2DEC",
		description: "Converts an octal number to decimal.",
		arguments: [
			{
				name: "number",
				description: "is the octal number you want to convert"
			}
		]
	},
	{
		name: "OCT2HEX",
		description: "Converts an octal number to hexadecimal.",
		arguments: [
			{
				name: "number",
				description: "is the octal number you want to convert"
			},
			{
				name: "places",
				description: "is the number of characters to use"
			}
		]
	},
	{
		name: "ODD",
		description: "Rounds a positive number up and negative number down to the nearest odd integer.",
		arguments: [
			{
				name: "number",
				description: "is the value to round"
			}
		]
	},
	{
		name: "OFFSET",
		description: "Returns a reference to a range that is a given number of rows and columns from a given reference.",
		arguments: [
			{
				name: "reference",
				description: "is the reference from which you want to base the offset, a reference to a cell or range of adjacent cells"
			},
			{
				name: "rows",
				description: "is the number of rows, up or down, that you want the upper-left cell of the result to refer to"
			},
			{
				name: "cols",
				description: "is the number of columns, to the left or right, that you want the upper-left cell of the result to refer to"
			},
			{
				name: "height",
				description: "is the height, in number of rows, that you want the result to be, the same height as Reference if omitted"
			},
			{
				name: "width",
				description: "is the width, in number of columns, that you want the result to be, the same width as Reference if omitted"
			}
		]
	},
	{
		name: "OR",
		description: "Checks whether any of the arguments are TRUE, and returns TRUE or FALSE. Returns FALSE only if all arguments are FALSE.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "logical1",
				description: "are 1 to 255 conditions that you want to test that can be either TRUE or FALSE"
			},
			{
				name: "logical2",
				description: "are 1 to 255 conditions that you want to test that can be either TRUE or FALSE"
			}
		]
	},
	{
		name: "PARAMETER",
		description: "",
		arguments: [
			{
				name: "",
				description: ""
			}
		]
	},
	{
		name: "PDURATION",
		description: "Returns the number of periods required by an investment to reach a specified value.",
		arguments: [
			{
				name: "rate",
				description: "is the interest rate per period."
			},
			{
				name: "pv",
				description: "is the present value of the investment"
			},
			{
				name: "fv",
				description: "is the desired future value of the investment"
			}
		]
	},
	{
		name: "PEARSON",
		description: "Returns the Pearson product moment correlation coefficient, r.",
		arguments: [
			{
				name: "array1",
				description: "is a set of independent values"
			},
			{
				name: "array2",
				description: "is a set of dependent values"
			}
		]
	},
	{
		name: "PERCENTILE",
		description: "Returns the k-th percentile of values in a range.",
		arguments: [
			{
				name: "array",
				description: "is the array or range of data that defines relative standing"
			},
			{
				name: "k",
				description: "is the percentile value that is between 0 through 1, inclusive"
			}
		]
	},
	{
		name: "PERCENTILE.EXC",
		description: "Returns the k-th percentile of values in a range, where k is in the range 0..1, exclusive.",
		arguments: [
			{
				name: "array",
				description: "is the array or range of data that defines relative standing"
			},
			{
				name: "k",
				description: "is the percentile value that is between 0 through 1, inclusive"
			}
		]
	},
	{
		name: "PERCENTILE.INC",
		description: "Returns the k-th percentile of values in a range, where k is in the range 0..1, inclusive.",
		arguments: [
			{
				name: "array",
				description: "is the array or range of data that defines relative standing"
			},
			{
				name: "k",
				description: "is the percentile value that is between 0 through 1, inclusive"
			}
		]
	},
	{
		name: "PERCENTRANK",
		description: "Returns the rank of a value in a data set as a percentage of the data set.",
		arguments: [
			{
				name: "array",
				description: "is the array or range of data with numeric values that defines relative standing"
			},
			{
				name: "x",
				description: "is the value for which you want to know the rank"
			},
			{
				name: "significance",
				description: "is an optional value that identifies the number of significant digits for the returned percentage, three digits if omitted (0.xxx%)"
			}
		]
	},
	{
		name: "PERCENTRANK.EXC",
		description: "Returns the rank of a value in a data set as a percentage of the data set as a percentage (0..1, exclusive) of the data set.",
		arguments: [
			{
				name: "array",
				description: "is the array or range of data with numeric values that defines relative standing"
			},
			{
				name: "x",
				description: "is the value for which you want to know the rank"
			},
			{
				name: "significance",
				description: "is an optional value that identifies the number of significant digits for the returned percentage, three digits if omitted (0.xxx%)"
			}
		]
	},
	{
		name: "PERCENTRANK.INC",
		description: "Returns the rank of a value in a data set as a percentage of the data set as a percentage (0..1, inclusive) of the data set.",
		arguments: [
			{
				name: "array",
				description: "is the array or range of data with numeric values that defines relative standing"
			},
			{
				name: "x",
				description: "is the value for which you want to know the rank"
			},
			{
				name: "significance",
				description: "is an optional value that identifies the number of significant digits for the returned percentage, three digits if omitted (0.xxx%)"
			}
		]
	},
	{
		name: "PERMUT",
		description: "Returns the number of permutations for a given number of objects that can be selected from the total objects.",
		arguments: [
			{
				name: "number",
				description: "is the total number of objects"
			},
			{
				name: "number_chosen",
				description: "is the number of objects in each permutation"
			}
		]
	},
	{
		name: "PERMUTATIONA",
		description: "Returns the number of permutations for a given number of objects (with repetitions) that can be selected from the total objects.",
		arguments: [
			{
				name: "number",
				description: "is the total number of objects"
			},
			{
				name: "number_chosen",
				description: "is the number of objects in each permutation"
			}
		]
	},
	{
		name: "PHI",
		description: "Returns the value of the density function for a standard normal distribution.",
		arguments: [
			{
				name: "x",
				description: "is the number for which you want the density of the standard normal distribution"
			}
		]
	},
	{
		name: "PI",
		description: "Returns the value of Pi, 3.14159265358979, accurate to 15 digits.",
		arguments: [
		]
	},
	{
		name: "PMT",
		description: "Calculates the payment for a loan based on constant payments and a constant interest rate.",
		arguments: [
			{
				name: "rate",
				description: "is the interest rate per period for the loan. For example, use 6%/4 for quarterly payments at 6% APR"
			},
			{
				name: "nper",
				description: "is the total number of payments for the loan"
			},
			{
				name: "pv",
				description: "is the present value: the total amount that a series of future payments is worth now"
			},
			{
				name: "fv",
				description: "is the future value, or a cash balance you want to attain after the last payment is made, 0 (zero) if omitted"
			},
			{
				name: "type",
				description: "is a logical value: payment at the beginning of the period = 1; payment at the end of the period = 0 or omitted"
			}
		]
	},
	{
		name: "POISSON",
		description: "Returns the Poisson distribution.",
		arguments: [
			{
				name: "x",
				description: "is the number of events"
			},
			{
				name: "mean",
				description: "is the expected numeric value, a positive number"
			},
			{
				name: "cumulative",
				description: "is a logical value: for the cumulative Poisson probability, use TRUE; for the Poisson probability mass function, use FALSE"
			}
		]
	},
	{
		name: "POISSON.DIST",
		description: "Returns the Poisson distribution.",
		arguments: [
			{
				name: "x",
				description: "is the number of events"
			},
			{
				name: "mean",
				description: "is the expected numeric value, a positive number"
			},
			{
				name: "cumulative",
				description: "is a logical value: for the cumulative Poisson probability, use TRUE; for the Poisson probability mass function, use FALSE"
			}
		]
	},
	{
		name: "POWER",
		description: "Returns the result of a number raised to a power.",
		arguments: [
			{
				name: "number",
				description: "is the base number, any real number"
			},
			{
				name: "power",
				description: "is the exponent, to which the base number is raised"
			}
		]
	},
	{
		name: "PPMT",
		description: "Returns the payment on the principal for a given investment based on periodic, constant payments and a constant interest rate.",
		arguments: [
			{
				name: "rate",
				description: "is the interest rate per period. For example, use 6%/4 for quarterly payments at 6% APR"
			},
			{
				name: "per",
				description: "specifies the period and must be in the range 1 to nper"
			},
			{
				name: "nper",
				description: "is the total number of payment periods in an investment"
			},
			{
				name: "pv",
				description: "is the present value: the total amount that a series of future payments is worth now"
			},
			{
				name: "fv",
				description: "is the future value, or cash balance you want to attain after the last payment is made"
			},
			{
				name: "type",
				description: "is a logical value: payment at the beginning of the period = 1; payment at the end of the period = 0 or omitted"
			}
		]
	},
	{
		name: "PRICEDISC",
		description: "Returns the price per $100 face value of a discounted security.",
		arguments: [
			{
				name: "settlement",
				description: "is the security's settlement date, expressed as a serial date number"
			},
			{
				name: "maturity",
				description: "is the security's maturity date, expressed as a serial date number"
			},
			{
				name: "discount",
				description: "is the security's discount rate"
			},
			{
				name: "redemption",
				description: "is the security's redemption value per $100 face value"
			},
			{
				name: "basis",
				description: "is the type of day count basis to use"
			}
		]
	},
	{
		name: "PROB",
		description: "Returns the probability that values in a range are between two limits or equal to a lower limit.",
		arguments: [
			{
				name: "x_range",
				description: "is the range of numeric values of x with which there are associated probabilities"
			},
			{
				name: "prob_range",
				description: "is the set of probabilities associated with values in X_range, values between 0 and 1 and excluding 0"
			},
			{
				name: "lower_limit",
				description: "is the lower bound on the value for which you want a probability"
			},
			{
				name: "upper_limit",
				description: "is the optional upper bound on the value. If omitted, PROB returns the probability that X_range values are equal to Lower_limit"
			}
		]
	},
	{
		name: "PRODUCT",
		description: "Multiplies all the numbers given as arguments.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numbers, logical values, or text representations of numbers that you want to multiply"
			},
			{
				name: "number2",
				description: "are 1 to 255 numbers, logical values, or text representations of numbers that you want to multiply"
			}
		]
	},
	{
		name: "PROPER",
		description: "Converts a text string to proper case; the first letter in each word in uppercase, and all other letters to lowercase.",
		arguments: [
			{
				name: "text",
				description: "is text enclosed in quotation marks, a formula that returns text, or a reference to a cell containing text to partially capitalize"
			}
		]
	},
	{
		name: "PV",
		description: "Returns the present value of an investment: the total amount that a series of future payments is worth now.",
		arguments: [
			{
				name: "rate",
				description: "is the interest rate per period. For example, use 6%/4 for quarterly payments at 6% APR"
			},
			{
				name: "nper",
				description: "is the total number of payment periods in an investment"
			},
			{
				name: "pmt",
				description: "is the payment made each period and cannot change over the life of the investment"
			},
			{
				name: "fv",
				description: "is the future value, or a cash balance you want to attain after the last payment is made"
			},
			{
				name: "type",
				description: "is a logical value: payment at the beginning of the period = 1; payment at the end of the period = 0 or omitted"
			}
		]
	},
	{
		name: "QUARTILE",
		description: "Returns the quartile of a data set.",
		arguments: [
			{
				name: "array",
				description: "is the array or cell range of numeric values for which you want the quartile value"
			},
			{
				name: "quart",
				description: "is a number: minimum value = 0; 1st quartile = 1; median value = 2; 3rd quartile = 3; maximum value = 4"
			}
		]
	},
	{
		name: "QUARTILE.EXC",
		description: "Returns the quartile of a data set, based on percentile values from 0..1, exclusive.",
		arguments: [
			{
				name: "array",
				description: "is the array or cell range of numeric values for which you want the quartile value"
			},
			{
				name: "quart",
				description: "is a number: minimum value = 0; 1st quartile = 1; median value = 2; 3rd quartile = 3; maximum value = 4"
			}
		]
	},
	{
		name: "QUARTILE.INC",
		description: "Returns the quartile of a data set, based on percentile values from 0..1, inclusive.",
		arguments: [
			{
				name: "array",
				description: "is the array or cell range of numeric values for which you want the quartile value"
			},
			{
				name: "quart",
				description: "is a number: minimum value = 0; 1st quartile = 1; median value = 2; 3rd quartile = 3; maximum value = 4"
			}
		]
	},
	{
		name: "QUOTIENT",
		description: "Returns the integer portion of a division.",
		arguments: [
			{
				name: "numerator",
				description: "is the dividend"
			},
			{
				name: "denominator",
				description: "is the divisor"
			}
		]
	},
	{
		name: "RADIANS",
		description: "Converts degrees to radians.",
		arguments: [
			{
				name: "angle",
				description: "is an angle in degrees that you want to convert"
			}
		]
	},
	{
		name: "RAND",
		description: "Returns a random number greater than or equal to 0 and less than 1, evenly distributed (changes on recalculation).",
		arguments: [
		]
	},
	{
		name: "RANDBETWEEN",
		description: "Returns a random number between the numbers you specify.",
		arguments: [
			{
				name: "bottom",
				description: "is the smallest integer RANDBETWEEN will return"
			},
			{
				name: "top",
				description: "is the largest integer RANDBETWEEN will return"
			}
		]
	},
	{
		name: "RANGE",
		description: "",
		arguments: [
			{
				name: "",
				description: ""
			}
		]
	},
	{
		name: "RANK",
		description: "Returns the rank of a number in a list of numbers: its size relative to other values in the list.",
		arguments: [
			{
				name: "number",
				description: "is the number for which you want to find the rank"
			},
			{
				name: "ref",
				description: "is an array of, or a reference to, a list of numbers. Nonnumeric values are ignored"
			},
			{
				name: "order",
				description: "is a number: rank in the list sorted descending = 0 or omitted; rank in the list sorted ascending = any nonzero value"
			}
		]
	},
	{
		name: "RANK.AVG",
		description: "Returns the rank of a number in a list of numbers: its size relative to other values in the list; if more than one value has the same rank, the average rank is returned.",
		arguments: [
			{
				name: "number",
				description: "is the number for which you want to find the rank"
			},
			{
				name: "ref",
				description: "is an array of, or a reference to, a list of numbers. Nonnumeric values are ignored"
			},
			{
				name: "order",
				description: "is a number: rank in the list sorted descending = 0 or omitted; rank in the list sorted ascending = any nonzero value"
			}
		]
	},
	{
		name: "RANK.EQ",
		description: "Returns the rank of a number in a list of numbers: its size relative to other values in the list; if more than one value has the same rank, the top rank of that set of values is returned.",
		arguments: [
			{
				name: "number",
				description: "is the number for which you want to find the rank"
			},
			{
				name: "ref",
				description: "is an array of, or a reference to, a list of numbers. Nonnumeric values are ignored"
			},
			{
				name: "order",
				description: "is a number: rank in the list sorted descending = 0 or omitted; rank in the list sorted ascending = any nonzero value"
			}
		]
	},
	{
		name: "RATE",
		description: "Returns the interest rate per period of a loan or an investment. For example, use 6%/4 for quarterly payments at 6% APR.",
		arguments: [
			{
				name: "nper",
				description: "is the total number of payment periods for the loan or investment"
			},
			{
				name: "pmt",
				description: "is the payment made each period and cannot change over the life of the loan or investment"
			},
			{
				name: "pv",
				description: "is the present value: the total amount that a series of future payments is worth now"
			},
			{
				name: "fv",
				description: "is the future value, or a cash balance you want to attain after the last payment is made. If omitted, uses Fv = 0"
			},
			{
				name: "type",
				description: "is a logical value: payment at the beginning of the period = 1; payment at the end of the period = 0 or omitted"
			},
			{
				name: "guess",
				description: "is your guess for what the rate will be; if omitted, Guess = 0.1 (10 percent)"
			}
		]
	},
	{
		name: "RECEIVED",
		description: "Returns the amount received at maturity for a fully invested security.",
		arguments: [
			{
				name: "settlement",
				description: "is the security's settlement date, expressed as a serial date number"
			},
			{
				name: "maturity",
				description: "is the security's maturity date, expressed as a serial date number"
			},
			{
				name: "investment",
				description: "is the amount invested in the security"
			},
			{
				name: "discount",
				description: "is the security's discount rate"
			},
			{
				name: "basis",
				description: "is the type of day count basis to use"
			}
		]
	},
	{
		name: "REPLACE",
		description: "Replaces part of a text string with a different text string.",
		arguments: [
			{
				name: "old_text",
				description: "is text in which you want to replace some characters"
			},
			{
				name: "start_num",
				description: "is the position of the character in Old_text that you want to replace with New_text"
			},
			{
				name: "num_chars",
				description: "is the number of characters in Old_text that you want to replace"
			},
			{
				name: "new_text",
				description: "is the text that will replace characters in Old_text"
			}
		]
	},
	{
		name: "REPT",
		description: "Repeats text a given number of times. Use REPT to fill a cell with a number of instances of a text string.",
		arguments: [
			{
				name: "text",
				description: "is the text you want to repeat"
			},
			{
				name: "number_times",
				description: "is a positive number specifying the number of times to repeat text"
			}
		]
	},
	{
		name: "RIGHT",
		description: "Returns the specified number of characters from the end of a text string.",
		arguments: [
			{
				name: "text",
				description: "is the text string that contains the characters you want to extract"
			},
			{
				name: "num_chars",
				description: "specifies how many characters you want to extract, 1 if omitted"
			}
		]
	},
	{
		name: "ROMAN",
		description: "Converts an Arabic numeral to Roman, as text.",
		arguments: [
			{
				name: "number",
				description: "is the Arabic numeral you want to convert"
			},
			{
				name: "form",
				description: "is the number specifying the type of Roman numeral you want."
			}
		]
	},
	{
		name: "ROUND",
		description: "Rounds a number to a specified number of digits.",
		arguments: [
			{
				name: "number",
				description: "is the number you want to round"
			},
			{
				name: "num_digits",
				description: "is the number of digits to which you want to round. Negative rounds to the left of the decimal point; zero to the nearest integer"
			}
		]
	},
	{
		name: "ROUNDDOWN",
		description: "Rounds a number down, toward zero.",
		arguments: [
			{
				name: "number",
				description: "is any real number that you want rounded down"
			},
			{
				name: "num_digits",
				description: "is the number of digits to which you want to round. Negative rounds to the left of the decimal point; zero or omitted, to the nearest integer"
			}
		]
	},
	{
		name: "ROUNDUP",
		description: "Rounds a number up, away from zero.",
		arguments: [
			{
				name: "number",
				description: "is any real number that you want rounded up"
			},
			{
				name: "num_digits",
				description: "is the number of digits to which you want to round. Negative rounds to the left of the decimal point; zero or omitted, to the nearest integer"
			}
		]
	},
	{
		name: "ROW",
		description: "Returns the row number of a reference.",
		arguments: [
			{
				name: "reference",
				description: "is the cell or a single range of cells for which you want the row number; if omitted, returns the cell containing the ROW function"
			}
		]
	},
	{
		name: "ROWS",
		description: "Returns the number of rows in a reference or array.",
		arguments: [
			{
				name: "array",
				description: "is an array, an array formula, or a reference to a range of cells for which you want the number of rows"
			}
		]
	},
	{
		name: "RRI",
		description: "Returns an equivalent interest rate for the growth of an investment.",
		arguments: [
			{
				name: "nper",
				description: "is the number of periods for the investment"
			},
			{
				name: "pv",
				description: "is the present value of the investment"
			},
			{
				name: "fv",
				description: "is the future value of the investment"
			}
		]
	},
	{
		name: "RSQ",
		description: "Returns the square of the Pearson product moment correlation coefficient through the given data points.",
		arguments: [
			{
				name: "known_y's",
				description: "is an array or range of data points and can be numbers or names, arrays, or references that contain numbers"
			},
			{
				name: "known_x's",
				description: "is an array or range of data points and can be numbers or names, arrays, or references that contain numbers"
			}
		]
	},
	{
		name: "RTD",
		description: "Retrieves real-time data from a program that supports COM automation.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "progID",
				description: "is the name of the ProgID of a registered COM automation add-in. Enclose the name in quotation marks"
			},
			{
				name: "server",
				description: "is the name of the server where the add-in should be run. Enclose the name in quotation marks. If the add-in is run locally, use an empty string"
			},
			{
				name: "topic1",
				description: "are 1 to 38 parameters that specify a piece of data"
			},
			{
				name: "topic2",
				description: "are 1 to 38 parameters that specify a piece of data"
			}
		]
	},
	{
		name: "SEARCH",
		description: "Returns the number of the character at which a specific character or text string is first found, reading left to right (not case-sensitive).",
		arguments: [
			{
				name: "find_text",
				description: "is the text you want to find. You can use the ? and * wildcard characters; use ~? and ~* to find the ? and * characters"
			},
			{
				name: "within_text",
				description: "is the text in which you want to search for Find_text"
			},
			{
				name: "start_num",
				description: "is the character number in Within_text, counting from the left, at which you want to start searching. If omitted, 1 is used"
			}
		]
	},
	{
		name: "SEC",
		description: "Returns the secant of an angle.",
		arguments: [
			{
				name: "number",
				description: "is the angle in radians for which you want the secant"
			}
		]
	},
	{
		name: "SECH",
		description: "Returns the hyperbolic secant of an angle.",
		arguments: [
			{
				name: "number",
				description: "is the angle in radians for which you want the hyperbolic secant"
			}
		]
	},
	{
		name: "SECOND",
		description: "Returns the second, a number from 0 to 59.",
		arguments: [
			{
				name: "serial_number",
				description: "is a number in the date-time code used by Spreadsheet or text in time format, such as 16:48:23 or 4:48:47 PM"
			}
		]
	},
	{
		name: "SERIESSUM",
		description: "Returns the sum of a power series based on the formula.",
		arguments: [
			{
				name: "x",
				description: "is the input value to the power series"
			},
			{
				name: "n",
				description: "is the initial power to which you want to raise x"
			},
			{
				name: "m",
				description: "is the step by which to increase n for each term in the series"
			},
			{
				name: "coefficients",
				description: "is a set of coefficients by which each successive power of x is multiplied"
			}
		]
	},
	{
		name: "SHEET",
		description: "Returns the sheet number of the referenced sheet.",
		arguments: [
			{
				name: "value",
				description: "is the name of a sheet or a reference that you want the sheet number of.  If omitted the number of the sheet containing the function is returned"
			}
		]
	},
	{
		name: "SHEETS",
		description: "Returns the number of sheets in a reference.",
		arguments: [
			{
				name: "reference",
				description: "is a reference for which you want to know the number of sheets it contains.  If omitted the number of sheets in the workbook containing the function is returned"
			}
		]
	},
	{
		name: "SIGN",
		description: "Returns the sign of a number: 1 if the number is positive, zero if the number is zero, or -1 if the number is negative.",
		arguments: [
			{
				name: "number",
				description: "is any real number"
			}
		]
	},
	{
		name: "SIN",
		description: "Returns the sine of an angle.",
		arguments: [
			{
				name: "number",
				description: "is the angle in radians for which you want the sine. Degrees * PI()/180 = radians"
			}
		]
	},
	{
		name: "SINH",
		description: "Returns the hyperbolic sine of a number.",
		arguments: [
			{
				name: "number",
				description: "is any real number"
			}
		]
	},
	{
		name: "SKEW",
		description: "Returns the skewness of a distribution: a characterization of the degree of asymmetry of a distribution around its mean.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numbers or names, arrays, or references that contain numbers for which you want the skewness"
			},
			{
				name: "number2",
				description: "are 1 to 255 numbers or names, arrays, or references that contain numbers for which you want the skewness"
			}
		]
	},
	{
		name: "SKEW.P",
		description: "Returns the skewness of a distribution based on a population: a characterization of the degree of asymmetry of a distribution around its mean.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 254 numbers or names, arrays, or references that contain numbers for which you want the population skewness"
			},
			{
				name: "number2",
				description: "are 1 to 254 numbers or names, arrays, or references that contain numbers for which you want the population skewness"
			}
		]
	},
	{
		name: "SLN",
		description: "Returns the straight-line depreciation of an asset for one period.",
		arguments: [
			{
				name: "cost",
				description: "is the initial cost of the asset"
			},
			{
				name: "salvage",
				description: "is the salvage value at the end of the life of the asset"
			},
			{
				name: "life",
				description: "is the number of periods over which the asset is being depreciated (sometimes called the useful life of the asset)"
			}
		]
	},
	{
		name: "SLOPE",
		description: "Returns the slope of the linear regression line through the given data points.",
		arguments: [
			{
				name: "known_y's",
				description: "is an array or cell range of numeric dependent data points and can be numbers or names, arrays, or references that contain numbers"
			},
			{
				name: "known_x's",
				description: "is the set of independent data points and can be numbers or names, arrays, or references that contain numbers"
			}
		]
	},
	{
		name: "SMALL",
		description: "Returns the k-th smallest value in a data set. For example, the fifth smallest number.",
		arguments: [
			{
				name: "array",
				description: "is an array or range of numerical data for which you want to determine the k-th smallest value"
			},
			{
				name: "k",
				description: "is the position (from the smallest) in the array or range of the value to return"
			}
		]
	},
	{
		name: "SQRT",
		description: "Returns the square root of a number.",
		arguments: [
			{
				name: "number",
				description: "is the number for which you want the square root"
			}
		]
	},
	{
		name: "SQRTPI",
		description: "Returns the square root of (number * Pi).",
		arguments: [
			{
				name: "number",
				description: "is the number by which p is multiplied"
			}
		]
	},
	{
		name: "STANDARDIZE",
		description: "Returns a normalized value from a distribution characterized by a mean and standard deviation.",
		arguments: [
			{
				name: "x",
				description: "is the value you want to normalize"
			},
			{
				name: "mean",
				description: "is the arithmetic mean of the distribution"
			},
			{
				name: "standard_dev",
				description: "is the standard deviation of the distribution, a positive number"
			}
		]
	},
	{
		name: "STDEV",
		description: "Estimates standard deviation based on a sample (ignores logical values and text in the sample).",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numbers corresponding to a sample of a population and can be numbers or references that contain numbers"
			},
			{
				name: "number2",
				description: "are 1 to 255 numbers corresponding to a sample of a population and can be numbers or references that contain numbers"
			}
		]
	},
	{
		name: "STDEV.P",
		description: "Calculates standard deviation based on the entire population given as arguments (ignores logical values and text).",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numbers corresponding to a population and can be numbers or references that contain numbers"
			},
			{
				name: "number2",
				description: "are 1 to 255 numbers corresponding to a population and can be numbers or references that contain numbers"
			}
		]
	},
	{
		name: "STDEV.S",
		description: "Estimates standard deviation based on a sample (ignores logical values and text in the sample).",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numbers corresponding to a sample of a population and can be numbers or references that contain numbers"
			},
			{
				name: "number2",
				description: "are 1 to 255 numbers corresponding to a sample of a population and can be numbers or references that contain numbers"
			}
		]
	},
	{
		name: "STDEVA",
		description: "Estimates standard deviation based on a sample, including logical values and text. Text and the logical value FALSE have the value 0; the logical value TRUE has the value 1.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "value1",
				description: "are 1 to 255 values corresponding to a sample of a population and can be values or names or references to values"
			},
			{
				name: "value2",
				description: "are 1 to 255 values corresponding to a sample of a population and can be values or names or references to values"
			}
		]
	},
	{
		name: "STDEVP",
		description: "Calculates standard deviation based on the entire population given as arguments (ignores logical values and text).",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numbers corresponding to a population and can be numbers or references that contain numbers"
			},
			{
				name: "number2",
				description: "are 1 to 255 numbers corresponding to a population and can be numbers or references that contain numbers"
			}
		]
	},
	{
		name: "STDEVPA",
		description: "Calculates standard deviation based on an entire population, including logical values and text. Text and the logical value FALSE have the value 0; the logical value TRUE has the value 1.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "value1",
				description: "are 1 to 255 values corresponding to a population and can be values, names, arrays, or references that contain values"
			},
			{
				name: "value2",
				description: "are 1 to 255 values corresponding to a population and can be values, names, arrays, or references that contain values"
			}
		]
	},
	{
		name: "STEYX",
		description: "Returns the standard error of the predicted y-value for each x in a regression.",
		arguments: [
			{
				name: "known_y's",
				description: "is an array or range of dependent data points and can be numbers or names, arrays, or references that contain numbers"
			},
			{
				name: "known_x's",
				description: "is an array or range of independent data points and can be numbers or names, arrays, or references that contain numbers"
			}
		]
	},
	{
		name: "SUBSTITUTE",
		description: "Replaces existing text with new text in a text string.",
		arguments: [
			{
				name: "text",
				description: "is the text or the reference to a cell containing text in which you want to substitute characters"
			},
			{
				name: "old_text",
				description: "is the existing text you want to replace. If the case of Old_text does not match the case of text, SUBSTITUTE will not replace the text"
			},
			{
				name: "new_text",
				description: "is the text you want to replace Old_text with"
			},
			{
				name: "instance_num",
				description: "specifies which occurrence of Old_text you want to replace. If omitted, every instance of Old_text is replaced"
			}
		]
	},
	{
		name: "SUBTOTAL",
		description: "Returns a subtotal in a list or database.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "function_num",
				description: "is the number 1 to 11 that specifies the summary function for the subtotal."
			},
			{
				name: "ref1",
				description: "are 1 to 254 ranges or references for which you want the subtotal"
			}
		]
	},
	{
		name: "SUM",
		description: "Adds all the numbers in a range of cells.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numbers to sum. Logical values and text are ignored in cells, included if typed as arguments"
			},
			{
				name: "number2",
				description: "are 1 to 255 numbers to sum. Logical values and text are ignored in cells, included if typed as arguments"
			}
		]
	},
	{
		name: "SUMIF",
		description: "Adds the cells specified by a given condition or criteria.",
		arguments: [
			{
				name: "range",
				description: "is the range of cells you want evaluated"
			},
			{
				name: "criteria",
				description: "is the condition or criteria in the form of a number, expression, or text that defines which cells will be added"
			},
			{
				name: "sum_range",
				description: "are the actual cells to sum. If omitted, the cells in range are used"
			}
		]
	},
	{
		name: "SUMIFS",
		description: "Adds the cells specified by a given set of conditions or criteria.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "sum_range",
				description: "are the actual cells to sum."
			},
			{
				name: "criteria_range",
				description: "is the range of cells you want evaluated for the particular condition"
			},
			{
				name: "criteria",
				description: "is the condition or criteria in the form of a number, expression, or text that defines which cells will be added"
			}
		]
	},
	{
		name: "SUMPRODUCT",
		description: "Returns the sum of the products of corresponding ranges or arrays.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "array1",
				description: "are 2 to 255 arrays for which you want to multiply and then add components. All arrays must have the same dimensions"
			},
			{
				name: "array2",
				description: "are 2 to 255 arrays for which you want to multiply and then add components. All arrays must have the same dimensions"
			},
			{
				name: "array3",
				description: "are 2 to 255 arrays for which you want to multiply and then add components. All arrays must have the same dimensions"
			}
		]
	},
	{
		name: "SUMSQ",
		description: "Returns the sum of the squares of the arguments. The arguments can be numbers, arrays, names, or references to cells that contain numbers.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numbers, arrays, names, or references to arrays for which you want the sum of the squares"
			},
			{
				name: "number2",
				description: "are 1 to 255 numbers, arrays, names, or references to arrays for which you want the sum of the squares"
			}
		]
	},
	{
		name: "SUMX2MY2",
		description: "Sums the differences between the squares of two corresponding ranges or arrays.",
		arguments: [
			{
				name: "array_x",
				description: "is the first range or array of numbers and can be a number or name, array, or reference that contains numbers"
			},
			{
				name: "array_y",
				description: "is the second range or array of numbers and can be a number or name, array, or reference that contains numbers"
			}
		]
	},
	{
		name: "SUMX2PY2",
		description: "Returns the sum total of the sums of squares of numbers in two corresponding ranges or arrays.",
		arguments: [
			{
				name: "array_x",
				description: "is the first range or array of numbers and can be a number or name, array, or reference that contains numbers"
			},
			{
				name: "array_y",
				description: "is the second range or array of numbers and can be a number or name, array, or reference that contains numbers"
			}
		]
	},
	{
		name: "SUMXMY2",
		description: "Sums the squares of the differences in two corresponding ranges or arrays.",
		arguments: [
			{
				name: "array_x",
				description: "is the first range or array of values and can be a number or name, array, or reference that contains numbers"
			},
			{
				name: "array_y",
				description: "is the second range or array of values and can be a number or name, array, or reference that contains numbers"
			}
		]
	},
	{
		name: "SYD",
		description: "Returns the sum-of-years' digits depreciation of an asset for a specified period.",
		arguments: [
			{
				name: "cost",
				description: "is the initial cost of the asset"
			},
			{
				name: "salvage",
				description: "is the salvage value at the end of the life of the asset"
			},
			{
				name: "life",
				description: "is the number of periods over which the asset is being depreciated (sometimes called the useful life of the asset)"
			},
			{
				name: "per",
				description: "is the period and must use the same units as Life"
			}
		]
	},
	{
		name: "T",
		description: "Checks whether a value is text, and returns the text if it is, or returns double quotes (empty text) if it is not.",
		arguments: [
			{
				name: "value",
				description: "is the value to test"
			}
		]
	},
	{
		name: "T.DIST",
		description: "Returns the left-tailed Student's t-distribution.",
		arguments: [
			{
				name: "x",
				description: "is the numeric value at which to evaluate the distribution"
			},
			{
				name: "deg_freedom",
				description: "is an integer indicating the number of degrees of freedom that characterize the distribution"
			},
			{
				name: "cumulative",
				description: "is a logical value: for the cumulative distribution function, use TRUE; for the probability density function, use FALSE"
			}
		]
	},
	{
		name: "T.DIST.2T",
		description: "Returns the two-tailed Student's t-distribution.",
		arguments: [
			{
				name: "x",
				description: "is the numeric value at which to evaluate the distribution"
			},
			{
				name: "deg_freedom",
				description: "is an integer indicating the number of degrees of freedom that characterize the distribution"
			}
		]
	},
	{
		name: "T.DIST.RT",
		description: "Returns the right-tailed Student's t-distribution.",
		arguments: [
			{
				name: "x",
				description: "is the numeric value at which to evaluate the distribution"
			},
			{
				name: "deg_freedom",
				description: "is an integer indicating the number of degrees of freedom that characterize the distribution"
			}
		]
	},
	{
		name: "T.INV",
		description: "Returns the left-tailed inverse of the Student's t-distribution.",
		arguments: [
			{
				name: "probability",
				description: "is the probability associated with the two-tailed Student's t-distribution, a number between 0 and 1 inclusive"
			},
			{
				name: "deg_freedom",
				description: "is a positive integer indicating the number of degrees of freedom to characterize the distribution"
			}
		]
	},
	{
		name: "T.INV.2T",
		description: "Returns the two-tailed inverse of the Student's t-distribution.",
		arguments: [
			{
				name: "probability",
				description: "is the probability associated with the two-tailed Student's t-distribution, a number between 0 and 1 inclusive"
			},
			{
				name: "deg_freedom",
				description: "is a positive integer indicating the number of degrees of freedom to characterize the distribution"
			}
		]
	},
	{
		name: "T.TEST",
		description: "Returns the probability associated with a Student's t-Test.",
		arguments: [
			{
				name: "array1",
				description: "is the first data set"
			},
			{
				name: "array2",
				description: "is the second data set"
			},
			{
				name: "tails",
				description: "specifies the number of distribution tails to return: one-tailed distribution = 1; two-tailed distribution = 2"
			},
			{
				name: "type",
				description: "is the kind of t-test: paired = 1, two-sample equal variance (homoscedastic) = 2, two-sample unequal variance = 3"
			}
		]
	},
	{
		name: "TAN",
		description: "Returns the tangent of an angle.",
		arguments: [
			{
				name: "number",
				description: "is the angle in radians for which you want the tangent. Degrees * PI()/180 = radians"
			}
		]
	},
	{
		name: "TANH",
		description: "Returns the hyperbolic tangent of a number.",
		arguments: [
			{
				name: "number",
				description: "is any real number"
			}
		]
	},
	{
		name: "TBILLEQ",
		description: "Returns the bond-equivalent yield for a treasury bill.",
		arguments: [
			{
				name: "settlement",
				description: "is the Treasury bill's settlement date, expressed as a serial date number"
			},
			{
				name: "maturity",
				description: "is the Treasury bill's maturity date, expressed as a serial date number"
			},
			{
				name: "discount",
				description: "is the Treasury bill's discount rate"
			}
		]
	},
	{
		name: "TBILLPRICE",
		description: "Returns the price per $100 face value for a treasury bill.",
		arguments: [
			{
				name: "settlement",
				description: "is the Treasury bill's settlement date, expressed as a serial date number"
			},
			{
				name: "maturity",
				description: "is the Treasury bill's maturity date, expressed as a serial date number"
			},
			{
				name: "discount",
				description: "is the Treasury bill's discount rate"
			}
		]
	},
	{
		name: "TBILLYIELD",
		description: "Returns the yield for a treasury bill.",
		arguments: [
			{
				name: "settlement",
				description: "is the Treasury bill's settlement date, expressed as a serial date number"
			},
			{
				name: "maturity",
				description: "is the Treasury bill's maturity date, expressed as a serial date number"
			},
			{
				name: "pr",
				description: "is the Treasury Bill's price per $100 face value"
			}
		]
	},
	{
		name: "TDIST",
		description: "Returns the Student's t-distribution.",
		arguments: [
			{
				name: "x",
				description: "is the numeric value at which to evaluate the distribution"
			},
			{
				name: "deg_freedom",
				description: "is an integer indicating the number of degrees of freedom that characterize the distribution"
			},
			{
				name: "tails",
				description: "specifies the number of distribution tails to return: one-tailed distribution = 1; two-tailed distribution = 2"
			}
		]
	},
	{
		name: "TEXT",
		description: "Converts a value to text in a specific number format.",
		arguments: [
			{
				name: "value",
				description: "is a number, a formula that evaluates to a numeric value, or a reference to a cell containing a numeric value"
			},
			{
				name: "format_text",
				description: "is a number format in text form from the Category box on the Number tab in the Format Cells dialog box (not General)"
			}
		]
	},
	{
		name: "TIME",
		description: "Converts hours, minutes, and seconds given as numbers to an Spreadsheet serial number, formatted with a time format.",
		arguments: [
			{
				name: "hour",
				description: "is a number from 0 to 23 representing the hour"
			},
			{
				name: "minute",
				description: "is a number from 0 to 59 representing the minute"
			},
			{
				name: "second",
				description: "is a number from 0 to 59 representing the second"
			}
		]
	},
	{
		name: "TIMEVALUE",
		description: "Converts a text time to an Spreadsheet serial number for a time, a number from 0 (12:00:00 AM) to 0.999988426 (11:59:59 PM). Format the number with a time format after entering the formula.",
		arguments: [
			{
				name: "time_text",
				description: "is a text string that gives a time in any one of the Spreadsheet time formats (date information in the string is ignored)"
			}
		]
	},
	{
		name: "TINV",
		description: "Returns the two-tailed inverse of the Student's t-distribution.",
		arguments: [
			{
				name: "probability",
				description: "is the probability associated with the two-tailed Student's t-distribution, a number between 0 and 1 inclusive"
			},
			{
				name: "deg_freedom",
				description: "is a positive integer indicating the number of degrees of freedom to characterize the distribution"
			}
		]
	},
	{
		name: "TODAY",
		description: "Returns the current date formatted as a date.",
		arguments: [
		]
	},
	{
		name: "TRANSPOSE",
		description: "Converts a vertical range of cells to a horizontal range, or vice versa.",
		arguments: [
			{
				name: "array",
				description: "is a range of cells on a worksheet or an array of values that you want to transpose"
			}
		]
	},
	{
		name: "TREND",
		description: "Returns numbers in a linear trend matching known data points, using the least squares method.",
		arguments: [
			{
				name: "known_y's",
				description: "is a range or array of y-values you already know in the relationship y = mx + b"
			},
			{
				name: "known_x's",
				description: "is an optional range or array of x-values that you know in the relationship y = mx + b, an array the same size as Known_y's"
			},
			{
				name: "new_x's",
				description: "is a range or array of new x-values for which you want TREND to return corresponding y-values"
			},
			{
				name: "const",
				description: "is a logical value: the constant b is calculated normally if Const = TRUE or omitted; b is set equal to 0 if Const = FALSE"
			}
		]
	},
	{
		name: "TRIM",
		description: "Removes all spaces from a text string except for single spaces between words.",
		arguments: [
			{
				name: "text",
				description: "is the text from which you want spaces removed"
			}
		]
	},
	{
		name: "TRIMMEAN",
		description: "Returns the mean of the interior portion of a set of data values.",
		arguments: [
			{
				name: "array",
				description: "is the range or array of values to trim and average"
			},
			{
				name: "percent",
				description: "is the fractional number of data points to exclude from the top and bottom of the data set"
			}
		]
	},
	{
		name: "TRUE",
		description: "Returns the logical value TRUE.",
		arguments: [
		]
	},
	{
		name: "TRUNC",
		description: "Truncates a number to an integer by removing the decimal, or fractional, part of the number.",
		arguments: [
			{
				name: "number",
				description: "is the number you want to truncate"
			},
			{
				name: "num_digits",
				description: "is a number specifying the precision of the truncation, 0 (zero) if omitted"
			}
		]
	},
	{
		name: "TTEST",
		description: "Returns the probability associated with a Student's t-Test.",
		arguments: [
			{
				name: "array1",
				description: "is the first data set"
			},
			{
				name: "array2",
				description: "is the second data set"
			},
			{
				name: "tails",
				description: "specifies the number of distribution tails to return: one-tailed distribution = 1; two-tailed distribution = 2"
			},
			{
				name: "type",
				description: "is the kind of t-test: paired = 1, two-sample equal variance (homoscedastic) = 2, two-sample unequal variance = 3"
			}
		]
	},
	{
		name: "TYPE",
		description: "Returns an integer representing the data type of a value: number = 1; text = 2; logical value = 4; error value = 16; array = 64.",
		arguments: [
			{
				name: "value",
				description: "can be any value"
			}
		]
	},
	{
		name: "UNICODE",
		description: "Returns the number (code point) corresponding to the first character of the text.",
		arguments: [
			{
				name: "text",
				description: "is the character that you want the Unicode value of"
			}
		]
	},
	{
		name: "UPPER",
		description: "Converts a text string to all uppercase letters.",
		arguments: [
			{
				name: "text",
				description: "is the text you want converted to uppercase, a reference or a text string"
			}
		]
	},
	{
		name: "VALUE",
		description: "Converts a text string that represents a number to a number.",
		arguments: [
			{
				name: "text",
				description: "is the text enclosed in quotation marks or a reference to a cell containing the text you want to convert"
			}
		]
	},
	{
		name: "VAR",
		description: "Estimates variance based on a sample (ignores logical values and text in the sample).",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numeric arguments corresponding to a sample of a population"
			},
			{
				name: "number2",
				description: "are 1 to 255 numeric arguments corresponding to a sample of a population"
			}
		]
	},
	{
		name: "VAR.P",
		description: "Calculates variance based on the entire population (ignores logical values and text in the population).",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numeric arguments corresponding to a population"
			},
			{
				name: "number2",
				description: "are 1 to 255 numeric arguments corresponding to a population"
			}
		]
	},
	{
		name: "VAR.S",
		description: "Estimates variance based on a sample (ignores logical values and text in the sample).",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numeric arguments corresponding to a sample of a population"
			},
			{
				name: "number2",
				description: "are 1 to 255 numeric arguments corresponding to a sample of a population"
			}
		]
	},
	{
		name: "VARA",
		description: "Estimates variance based on a sample, including logical values and text. Text and the logical value FALSE have the value 0; the logical value TRUE has the value 1.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "value1",
				description: "are 1 to 255 value arguments corresponding to a sample of a population"
			},
			{
				name: "value2",
				description: "are 1 to 255 value arguments corresponding to a sample of a population"
			}
		]
	},
	{
		name: "VARP",
		description: "Calculates variance based on the entire population (ignores logical values and text in the population).",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "number1",
				description: "are 1 to 255 numeric arguments corresponding to a population"
			},
			{
				name: "number2",
				description: "are 1 to 255 numeric arguments corresponding to a population"
			}
		]
	},
	{
		name: "VARPA",
		description: "Calculates variance based on the entire population, including logical values and text. Text and the logical value FALSE have the value 0; the logical value TRUE has the value 1.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "value1",
				description: "are 1 to 255 value arguments corresponding to a population"
			},
			{
				name: "value2",
				description: "are 1 to 255 value arguments corresponding to a population"
			}
		]
	},
	{
		name: "VDB",
		description: "Returns the depreciation of an asset for any period you specify, including partial periods, using the double-declining balance method or some other method you specify.",
		arguments: [
			{
				name: "cost",
				description: "is the initial cost of the asset"
			},
			{
				name: "salvage",
				description: "is the salvage value at the end of the life of the asset"
			},
			{
				name: "life",
				description: "is the number of periods over which the asset is being depreciated (sometimes called the useful life of the asset)"
			},
			{
				name: "start_period",
				description: "is the starting period for which you want to calculate the depreciation, in the same units as Life"
			},
			{
				name: "end_period",
				description: "is the ending period for which you want to calculate the depreciation, in the same units as Life"
			},
			{
				name: "factor",
				description: "is the rate at which the balance declines, 2 (double-declining balance) if omitted"
			},
			{
				name: "no_switch",
				description: "switch to straight-line depreciation when depreciation is greater than the declining balance = FALSE or omitted; do not switch = TRUE"
			}
		]
	},
	{
		name: "VLOOKUP",
		description: "Looks for a value in the leftmost column of a table, and then returns a value in the same row from a column you specify. By default, the table must be sorted in an ascending order.",
		arguments: [
			{
				name: "lookup_value",
				description: "is the value to be found in the first column of the table, and can be a value, a reference, or a text string"
			},
			{
				name: "table_array",
				description: "is a table of text, numbers, or logical values, in which data is retrieved. Table_array can be a reference to a range or a range name"
			},
			{
				name: "col_index_num",
				description: "is the column number in table_array from which the matching value should be returned. The first column of values in the table is column 1"
			},
			{
				name: "range_lookup",
				description: "is a logical value: to find the closest match in the first column (sorted in ascending order) = TRUE or omitted; find an exact match = FALSE"
			}
		]
	},
	{
		name: "WEEKDAY",
		description: "Returns a number from 1 to 7 identifying the day of the week of a date.",
		arguments: [
			{
				name: "serial_number",
				description: "is a number that represents a date"
			},
			{
				name: "return_type",
				description: "is a number: for Sunday=1 through Saturday=7, use 1; for Monday=1 through Sunday=7, use 2; for Monday=0 through Sunday=6, use 3"
			}
		]
	},
	{
		name: "WEEKNUM",
		description: "Returns the week number in the year.",
		arguments: [
			{
				name: "serial_number",
				description: "is the date-time code used by Spreadsheet for date and time calculation"
			},
			{
				name: "return_type",
				description: "is a number (1 or 2) that determines the type of the return value"
			}
		]
	},
	{
		name: "WEIBULL",
		description: "Returns the Weibull distribution.",
		arguments: [
			{
				name: "x",
				description: "is the value at which to evaluate the function, a nonnegative number"
			},
			{
				name: "alpha",
				description: "is a parameter to the distribution, a positive number"
			},
			{
				name: "beta",
				description: "is a parameter to the distribution, a positive number"
			},
			{
				name: "cumulative",
				description: "is a logical value: for the cumulative distribution function, use TRUE; for the probability mass function, use FALSE"
			}
		]
	},
	{
		name: "WEIBULL.DIST",
		description: "Returns the Weibull distribution.",
		arguments: [
			{
				name: "x",
				description: "is the value at which to evaluate the function, a nonnegative number"
			},
			{
				name: "alpha",
				description: "is a parameter to the distribution, a positive number"
			},
			{
				name: "beta",
				description: "is a parameter to the distribution, a positive number"
			},
			{
				name: "cumulative",
				description: "is a logical value: for the cumulative distribution function, use TRUE; for the probability mass function, use FALSE"
			}
		]
	},
	{
		name: "WORKDAY",
		description: "Returns the serial number of the date before or after a specified number of workdays.",
		arguments: [
			{
				name: "start_date",
				description: "is a serial date number that represents the start date"
			},
			{
				name: "days",
				description: "is the number of nonweekend and non-holiday days before or after start_date"
			},
			{
				name: "holidays",
				description: "is an optional array of one or more serial date numbers to exclude from the working calendar, such as state and federal holidays and floating holidays"
			}
		]
	},
	{
		name: "WORKDAY.INTL",
		description: "Returns the serial number of the date before or after a specified number of workdays with custom weekend parameters.",
		arguments: [
			{
				name: "start_date",
				description: "is a serial date number that represents the start date"
			},
			{
				name: "days",
				description: "is the number of nonweekend and non-holiday days before or after start_date"
			},
			{
				name: "weekend",
				description: "is a number or string specifying when weekends occur"
			},
			{
				name: "holidays",
				description: "is an optional array of one or more serial date numbers to exclude from the working calendar, such as state and federal holidays and floating holidays"
			}
		]
	},
	{
		name: "XIRR",
		description: "Returns the internal rate of return for a schedule of cash flows.",
		arguments: [
			{
				name: "values",
				description: "is a series of cash flows that correspond to a schedule of payments in dates"
			},
			{
				name: "dates",
				description: "is a schedule of payment dates that corresponds to the cash flow payments"
			},
			{
				name: "guess",
				description: "is a number that you guess is close to the result of XIRR"
			}
		]
	},
	{
		name: "XNPV",
		description: "Returns the net present value for a schedule of cash flows.",
		arguments: [
			{
				name: "rate",
				description: "is the discount rate to apply to the cash flows"
			},
			{
				name: "values",
				description: "is a series of cash flows that correspond to a schedule of payments in dates"
			},
			{
				name: "dates",
				description: "is a schedule of payment dates that corresponds to the cash flow payments"
			}
		]
	},
	{
		name: "XOR",
		description: "Returns a logical 'Exclusive Or' of all arguments.",
		hasUnlimitedParametersCount: true,
		arguments: [
			{
				name: "logical1",
				description: "are 1 to 254 conditions you want to test that can be either TRUE or FALSE and can be logical values, arrays, or references"
			},
			{
				name: "logical2",
				description: "are 1 to 254 conditions you want to test that can be either TRUE or FALSE and can be logical values, arrays, or references"
			}
		]
	},
	{
		name: "YEAR",
		description: "Returns the year of a date, an integer in the range 1900 - 9999.",
		arguments: [
			{
				name: "serial_number",
				description: "is a number in the date-time code used by Spreadsheet"
			}
		]
	},
	{
		name: "YEARFRAC",
		description: "Returns the year fraction representing the number of whole days between start_date and end_date.",
		arguments: [
			{
				name: "start_date",
				description: "is a serial date number that represents the start date"
			},
			{
				name: "end_date",
				description: "is a serial date number that represents the end date"
			},
			{
				name: "basis",
				description: "is the type of day count basis to use"
			}
		]
	},
	{
		name: "YIELDDISC",
		description: "Returns the annual yield for a discounted security. For example, a treasury bill.",
		arguments: [
			{
				name: "settlement",
				description: "is the security's settlement date, expressed as a serial date number"
			},
			{
				name: "maturity",
				description: "is the security's maturity date, expressed as a serial date number"
			},
			{
				name: "pr",
				description: "is the security's price per $100 face value"
			},
			{
				name: "redemption",
				description: "is the security's redemption value per $100 face value"
			},
			{
				name: "basis",
				description: "is the type of day count basis to use"
			}
		]
	},
	{
		name: "Z.TEST",
		description: "Returns the one-tailed P-value of a z-test.",
		arguments: [
			{
				name: "array",
				description: "is the array or range of data against which to test X"
			},
			{
				name: "x",
				description: "is the value to test"
			},
			{
				name: "sigma",
				description: "is the population (known) standard deviation. If omitted, the sample standard deviation is used"
			}
		]
	},
	{
		name: "ZTEST",
		description: "Returns the one-tailed P-value of a z-test.",
		arguments: [
			{
				name: "array",
				description: "is the array or range of data against which to test X"
			},
			{
				name: "x",
				description: "is the value to test"
			},
			{
				name: "sigma",
				description: "is the population (known) standard deviation. If omitted, the sample standard deviation is used"
			}
		]
	}
];

ASPx.EmptyImageUrl = 'data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==';
ASPx.SSLSecureBlankUrl = '';
ASPx.VersionInfo = '';
ASPx.Platform = 'NETCORE';
if(!ASPx.VirtualKeyboardUI)
    ASPx.VirtualKeyboardUI = { getInputNativeFocusLocked: function() { return false; } };
window.DevExpress = window.DevExpress || {};
DevExpress.AspNetCore = DevExpress.AspNetCore || {};
DevExpress.AspNetCore.Spreadsheet = DevExpress.AspNetCore.Spreadsheet = {};

(function () {

    var ANCxClientSpreadsheet = ASPx.CreateClass(ASPxClientSpreadsheet, {
        constructor: function(name) {
            this.constructor.prototype.constructor.call(this, name);
            this.initDefaultProperties();
            this.createEventWrappers();
            this.handlerUrl = '/SpreadsheetController/DxDocumentRequest';
            this.svgStorage = new DevExpress.AspNetCore.Spreadsheet.SvgStorage(this);
        },

        createChildControls: function() {
            if(this.showSheetTabs)
                this.tabControl = new DevExpress.AspNetCore.Spreadsheet.SpreadsheetTabs(this);
            this.ribbonControl = new DevExpress.AspNetCore.Spreadsheet.SpreadsheetRibbon(this.GetMainElement(), this.ribbonSettings);
            ASPxClientSpreadsheet.prototype.createChildControls.call(this);
        },

        // TODO rid this off
        getSessionExpiredMessage: function() {
            return 'Session is expired.Your session has expired. Please refresh the page to continue.';
        },

        onServerCommand: function(commandId, params) {
            if(DevExpress.AspNetCore.Spreadsheet.CommandHelper.isCommandDisabled(commandId))
                return;
            ASPxClientSpreadsheet.prototype.onServerCommand.call(this, commandId, params);
        },

        initDefaultProperties: function() {
            this.showSheetTabs = true;
            this.showFormulaBar = false;
        },

        getHandlerResourceUrl: function() {
            return this.handlerUrl;
        },

        // ANC-specific API
        GetSpreadsheetState: function() {
            var JSONObject = {
                SpreadsheetWorkSessionId: this.getSessionGuid()
            };
            return JSONObject;
        },

        // Remove callback
        PerformCallback: function(parameter, onSuccess) { },

        isFormDataParams: function(commandParams) {
            return commandParams instanceof FormData;
        },

        sendFormDataRequest: function(requestQueryString, formData) {
            var resourceUrl = this.getResourceUrl(),
                postData = this.createPostData(requestQueryString);
            this.addPostDataToFormData(postData, formData);
            this.createXMLHttpRequest(resourceUrl, formData, false);
        },

        addPostDataToFormData: function(postData, formData) {
            var data = postData.split('&');
            data.forEach(function(keyValue) {
                var keyValueArray = keyValue.split('=');
                formData.append(keyValueArray[0], keyValueArray[1]);
            });
        },

        // UI
        ShowLoadingPanel: function() { },
        ShowLoadingDiv: function() { },
        getDialogList: function() { return {}; },
        getTabControl: function() {
            return this.tabControl;
        },

        GetRibbon: function() {
            return this.ribbonControl;
        },
        getFormulaBarHeight: function() { return 0; },
        getPopupMenu: function() {
            if(!this.popupMenu)
                this.popupMenu = new DevExpress.AspNetCore.Spreadsheet.PopupMenu(this);
            return this.popupMenu;
        },
        getPopupMenuHelper: function() {
            if(!this.popupMenuHelper) {
                this.popupMenuHelper = new DevExpress.AspNetCore.Spreadsheet.PopupMenuHelper(this);
                this.popupMenuHelper.initializeItems();
            }
            return this.popupMenuHelper;
        },
        needUseSvgImages: function() {
            return true;
        },
        getAutoFilterImagesClassName: function(imageName) {
            return 'AutoFilter' + imageName;
        },
        getAutoFilterPopupMenu: function() { return null; },
        subscribeToMenuEvents: function(popupMenu) {

        },
        getFunctionsListBox: function() {
            if(!this.functionsListBox)
                this.functionsListBox = new DevExpress.AspNetCore.Spreadsheet.FunctionListBox(this);
            return this.functionsListBox;
        },
        getInputController: function() {
            if(!this.inputController)
                this.inputController = new DevExpress.AspNetCore.Spreadsheet.InputController(this, this.getRenderHelper().getInputTargetElement());
            return this.inputController;
        },

        onTablePresetsReceived: function(response) {
            this.svgStorage.replaceTablePresets(response.svg);
        },

        onTableColumnValuesReceived: function(response) {
            this.getCurrentDialog().updateItems(response.filterValues);
        },

        onChartStylesReceived: function(response) {
            var svgElements = this.svgStorage.parseSvgSymbolsSet(response.svg);
            this.getCurrentDialog().insertChartStylePreviewImages(svgElements);
        },

        onChartStyleDialogClosed: function() {
            this.svgStorage.removeChartStyles();
        },

        showMessage: function(message, messageType, options) {
            this.showNotification(message, messageType, false);
        },
        showBuiltInMessage: function(messageId, messageType, options) {
            this.showNotification(messageId, messageType, true);
        },
        showNotification: function(message, messageType, useMessageId) {
            this.getDialogManager().getNotificationDialog().show(message, messageType, useMessageId);
        },

        onDialogCommand: function(dialog, commandId, params) {
            dialog.show(commandId, params);
        },

        getDialogManager: function() {
            if(!this.dialogManager)
                this.dialogManager = new DevExpress.AspNetCore.Spreadsheet.DialogManager(this.GetMainElement(), this);
            return this.dialogManager;
        }
    });

    DevExpress.AspNetCore.Spreadsheet.Spreadsheet = function(properties) {
        function CreateSpreadsheetRender(mainElementId) {
            //var themeName = "_MaterialCompact";
            var themeName = DevExpress.ui.themes.current().replace(/\./g, '-');
            var customClass = '';
            spreadsheetClientRender.CreateRender(mainElementId, themeName, customClass);
        }
        function InitSpreadsheet(mainElementId, documentProperties) {
            documentProperties.ribbonSettings = JSON.parse(documentProperties.ribbonSettings);
            ASPx.createControl(ANCxClientSpreadsheet, mainElementId, '', documentProperties, documentProperties.events);
        }
        function CreateClientSpreadsheet(mainElementId, documentProperties) {
            CreateSpreadsheetRender(mainElementId);
            InitSpreadsheet(mainElementId, documentProperties);
        }
        function IniControl(control) {
            control.Initialize();
            control.AfterInitialize();
        }

        CreateClientSpreadsheet(properties.name, properties);
        var spreadsheetClientControl = window[properties.name];

        IniControl(spreadsheetClientControl);

        return spreadsheetClientControl;
    };

    DevExpress.AspNetCore.Spreadsheet.Spreadsheet.ANCxClientSpreadsheet = ANCxClientSpreadsheet;

    var spreadsheetClientRender = {
        MainElementSystemClass: 'dxssControlSys',
        MainElementThemeClass: 'dxssControl',
        WorkBookContainerIdPostfix: '_WBC',
        WorkBookContainerClass: 'dxss-md',
		ThemeMainBorderColor: 'dx-theme-border-color',
		

        CreateRender: function (mainElementId, themeName, customClass) {
            var mainDiv = this.CreateMainElement(mainElementId, themeName, customClass);
            var wbcDiv = this.CreateWorkBookContainer(mainElementId);
            mainDiv.appendChild(wbcDiv);
            return mainDiv.outerHTML;
        },
        CreateMainElement: function (mainElementId, themeName, customClass) {
            var mainDiv = document.getElementById(mainElementId);
            var mainElementControlClass = this.MainElementThemeClass + ' ' + themeName;
            if(!customClass) customClass = '';
            mainDiv.className = [mainDiv.className, this.MainElementSystemClass, this.ThemeMainBorderColor, mainElementControlClass, customClass].join(' ');
            return mainDiv;
        },
        CreateWorkBookContainer: function(id) {
            var wbcDiv = document.createElement('DIV');
            wbcDiv.id = id + this.WorkBookContainerIdPostfix;
            wbcDiv.className = this.WorkBookContainerClass;
            wbcDiv.style.height = '100%';
            wbcDiv.style.width = '100%';
            return wbcDiv;
        }
    };
})();

/* eslint valid-jsdoc: [2, { "requireParamDescription": false, "requireReturn": false, "requireReturnDescription": false }] */

(function() {
/** @namespace DevExpress */
/** @namespace DevExpress.AspNetCore */
/** @namespace DevExpress.AspNetCore.Spreadsheet */

    /** @class DevExpress.AspNetCore.Spreadsheet#Spreadsheet */
    var ANCxClientSpreadsheet = DevExpress.AspNetCore.Spreadsheet.Spreadsheet.ANCxClientSpreadsheet;

    /** @function DevExpress.AspNetCore.Spreadsheet#Spreadsheet#focus */
    ANCxClientSpreadsheet.prototype.focus = function() {
        this.Focus();
    };

    /**
    * @function DevExpress.AspNetCore.Spreadsheet#Spreadsheet#getActiveCellValue
    * @returns {Object}
    */
    ANCxClientSpreadsheet.prototype.getActiveCellValue = function() {
        return this.GetActiveCellValue();
    };

    /**
    * @function DevExpress.AspNetCore.Spreadsheet#Spreadsheet#getActiveSheetName
    * @returns {string}
    */
    ANCxClientSpreadsheet.prototype.getActiveSheetName = function() {
        return this.GetActiveSheetName();
    };

    /** @function DevExpress.AspNetCore.Spreadsheet#Spreadsheet#applyCellEdit */
    ANCxClientSpreadsheet.prototype.applyCellEdit = function() {
        this.ApplyCellEdit();
    };

    /** @function DevExpress.AspNetCore.Spreadsheet#Spreadsheet#cancelCellEdit */
    ANCxClientSpreadsheet.prototype.cancelCellEdit = function() {
        this.CancelCellEdit();
    };

    /**
    * @function DevExpress.AspNetCore.Spreadsheet#Spreadsheet#getCellBounds
    * @param {number} colModelIndex
    * @param {number} rowModelIndex
    * @returns {Rectangle}
    */
    ANCxClientSpreadsheet.prototype.getCellBounds = function(colModelIndex, rowModelIndex) {
        return this.GetCellBounds(colModelIndex, rowModelIndex);
    };

    /**
    * @function DevExpress.AspNetCore.Spreadsheet#Spreadsheet#getCellComment
    * @param {number} colModelIndex
    * @param {number} rowModelIndex
    * @returns {Object}
    */
    ANCxClientSpreadsheet.prototype.getCellComment = function(colModelIndex, rowModelIndex) {
        return this.GetCellComment(colModelIndex, rowModelIndex);
    };

    /**
    * @function DevExpress.AspNetCore.Spreadsheet#Spreadsheet#getCellValue
    * @param {number} colModelIndex
    * @param {number} rowModelIndex
    * @returns {Object}
    */
    ANCxClientSpreadsheet.prototype.getCellValue = function(colModelIndex, rowModelIndex) {
        return this.GetCellValue(colModelIndex, rowModelIndex);
    };

    /**
    * @function DevExpress.AspNetCore.Spreadsheet#Spreadsheet#getEditMode
    * @returns {EditMode}
    */
    ANCxClientSpreadsheet.prototype.getEditMode = function() {
        return this.GetEditMode();
    };

    /**
    * @function DevExpress.AspNetCore.Spreadsheet#Spreadsheet#getSelection
    * @returns {Selection}
    */
    ANCxClientSpreadsheet.prototype.getSelection = function() {
        return this.GetSelection();
    };

    /**
    * @function DevExpress.AspNetCore.Spreadsheet#Spreadsheet#hasUnsavedChanges
    * @returns {boolean}
    */
    ANCxClientSpreadsheet.prototype.hasUnsavedChanges = function() {
        return this.HasUnsavedChanges();
    };

    /**
    * @function DevExpress.AspNetCore.Spreadsheet#Spreadsheet#setCellEditorText
    * @param {string} text
    */
    ANCxClientSpreadsheet.prototype.setCellEditorText = function(text) {
        this.SetCellEditorText(text);
    };

    /**
    * @function DevExpress.AspNetCore.Spreadsheet#Spreadsheet#setFullscreenMode
    * @param {boolean} fullscreen
    */
    ANCxClientSpreadsheet.prototype.setFullscreenMode = function(fullscreen) {
        this.SetFullscreenMode(fullscreen);
    };

    /**
    * @function DevExpress.AspNetCore.Spreadsheet#Spreadsheet#print
    * @param {string} target
    */
    ANCxClientSpreadsheet.prototype.print = function(target) {
        this.Print(target);
    };

    ANCxClientSpreadsheet.prototype.createEventWrappers = function() {
        /**
        * @name DevExpress.AspNetCore.Spreadsheet#Spreadsheet#cellBeginEdit
        * @type CellBeginEditEvent
        */
        this.cellBeginEdit = new CellBeginEditEvent(this.CellBeginEdit);
        /**
        * @name DevExpress.AspNetCore.Spreadsheet#Spreadsheet#cellEndEdit
        * @type CellEndEditEvent
        */
        this.cellEndEdit = new CellEndEditEvent(this.CellEndEdit);
        /**
        * @name DevExpress.AspNetCore.Spreadsheet#Spreadsheet#cellCancelEdit
        * @type CellCancelEditEvent
        */
        this.cellCancelEdit = new CellCancelEditEvent(this.CellCancelEdit);
        /**
        * @name DevExpress.AspNetCore.Spreadsheet#Spreadsheet#documentChanged
        * @type DocumentChangedEvent
        */
        this.documentChanged = new DocumentChangedEvent(this.DocumentChanged);
        /**
        * @name DevExpress.AspNetCore.Spreadsheet#Spreadsheet#beginSynchronization
        * @type BeginSynchronizationEvent
        */
        this.beginSynchronization = new BeginSynchronizationEvent(this.BeginSynchronization);
        /**
        * @name DevExpress.AspNetCore.Spreadsheet#Spreadsheet#endSynchronization
        * @type EndSynchronizationEvent
        */
        this.endSynchronization = new EndSynchronizationEvent(this.BeginSynchronization);
        /**
        * @name DevExpress.AspNetCore.Spreadsheet#Spreadsheet#hyperlinkClick
        * @type HyperlinkClickEvent
        */
        this.hyperlinkClick = new HyperlinkClickEvent(this.HyperlinkClick);
        /**
        * @name DevExpress.AspNetCore.Spreadsheet#Spreadsheet#selectionChanged
        * @type SelectionChangedEvent
        */
        this.selectionChanged = new SelectionChangedEvent(this.SelectionChanged);
        /**
        * @name DevExpress.AspNetCore.Spreadsheet#Spreadsheet#protectionWarning
        * @type ProtectionWarningEvent
        */
        this.protectionWarning = new ProtectionWarningEvent(this.ProtectionWarning);
        /**
        * @name DevExpress.AspNetCore.Spreadsheet#Spreadsheet#popupMenuShowing
        * @type PopupMenuShowingEvent
        */
        this.popupMenuShowing = new PopupMenuShowingEvent(this.PopupMenuShowing);
        /**
        * @name DevExpress.AspNetCore.Spreadsheet#Spreadsheet#customCommandExecuted
        * @type CustomCommandExecutedEvent
        */
        this.customCommandExecuted = new CustomCommandExecutedEvent(this.CustomCommandExecuted);

    };


    /** 
    * @class DevExpress.AspNetCore.Spreadsheet#SpreadsheetEvent
    * @template TEventArgs extends EventArgs
    */
    var SpreadsheetEvent = ASPx.CreateClass(null, {
        constructor: function(baseEvent) {
            this.baseEvent = baseEvent;
        },
        /**
        * @function DevExpress.AspNetCore.Spreadsheet#SpreadsheetEvent#addHandler
        * @param {Object} handler
        */
        addHandler: function(handler) {
            this.baseEvent.AddHandler(handler);
        },
        /**
        * @function DevExpress.AspNetCore.Spreadsheet#SpreadsheetEvent#removeHandler
        * @param {Object} handler
        */
        removeHandler: function(handler) {
            this.baseEvent.RemoveHandler(handler);
        },
        /**
        * @function DevExpress.AspNetCore.Spreadsheet#SpreadsheetEvent#clearHandlers
        */
        clearHandlers: function() {
            this.baseEvent.ClearHandlers();
        },
        /**
        * @function DevExpress.AspNetCore.Spreadsheet#SpreadsheetEvent#fireEvent
        * @param {Spreadsheet} source
        * @param {TEventArgs} args
        */
        fireEvent: function(source, args) {
            this.baseEvent.FireEvent(source, args);
        }
    });


    /** 
    *  @class DevExpress.AspNetCore.Spreadsheet#CellBeginEditEvent
    *  @extends SpreadsheetEvent<CellBeginEditEventArgs>
    */
    var CellBeginEditEvent = ASPx.CreateClass(SpreadsheetEvent, {
    });


    /** 
    *  @class DevExpress.AspNetCore.Spreadsheet#CellEndEditEvent
    *  @extends SpreadsheetEvent<CellEndEditEventArgs>
    */
    var CellEndEditEvent = ASPx.CreateClass(SpreadsheetEvent, {
    });


    /** 
    *  @class DevExpress.AspNetCore.Spreadsheet#CellCancelEditEvent
    *  @extends SpreadsheetEvent<CellCancelEditEventArgs>
    */
    var CellCancelEditEvent = ASPx.CreateClass(SpreadsheetEvent, {
    });


    /** 
    *  @class DevExpress.AspNetCore.Spreadsheet#DocumentChangedEvent
    *  @extends SpreadsheetEvent<EventArgs>
    */
    var DocumentChangedEvent = ASPx.CreateClass(SpreadsheetEvent, {
    });


    /** 
    *  @class DevExpress.AspNetCore.Spreadsheet#BeginSynchronizationEvent
    *  @extends SpreadsheetEvent<EventArgs>
    */
    var BeginSynchronizationEvent = ASPx.CreateClass(SpreadsheetEvent, {
    });


    /** 
    *  @class DevExpress.AspNetCore.Spreadsheet#EndSynchronizationEvent
    *  @extends SpreadsheetEvent<EventArgs>
    */
    var EndSynchronizationEvent = ASPx.CreateClass(SpreadsheetEvent, {
    });


    /** 
    *  @class DevExpress.AspNetCore.Spreadsheet#HyperlinkClickEvent
    *  @extends SpreadsheetEvent<HyperlinkClickEventArgs>
    */
    var HyperlinkClickEvent = ASPx.CreateClass(SpreadsheetEvent, {
    });


    /** 
    *  @class DevExpress.AspNetCore.Spreadsheet#SelectionChangedEvent
    *  @extends SpreadsheetEvent<SelectionChangedEventArgs>
    */
    var SelectionChangedEvent = ASPx.CreateClass(SpreadsheetEvent, {
    });

    /** 
    *  @class DevExpress.AspNetCore.Spreadsheet#ProtectionWarningEvent
    *  @extends SpreadsheetEvent<EventArgs>
    */
    var ProtectionWarningEvent = ASPx.CreateClass(SpreadsheetEvent, {
    });


    /** 
    *  @class DevExpress.AspNetCore.Spreadsheet#PopupMenuShowingEvent
    *  @extends SpreadsheetEvent<PopupMenuShowingEventArgs>
    */
    var PopupMenuShowingEvent = ASPx.CreateClass(SpreadsheetEvent, {
    });


    /** 
    *  @class DevExpress.AspNetCore.Spreadsheet#CustomCommandExecutedEvent
    *  @extends SpreadsheetEvent<CustomCommandExecutedEventArgs>
    */
    var CustomCommandExecutedEvent = ASPx.CreateClass(SpreadsheetEvent, {
    });


    /** @class DevExpress.AspNetCore.Spreadsheet#EventArgs */


    /** 
    * @class DevExpress.AspNetCore.Spreadsheet#HyperlinkClickEventArgs
    * @extends EventArgs
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#HyperlinkClickEventArgs#handled
    * @type boolean
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#HyperlinkClickEventArgs#htmlEvent
    * @type MouseEvent
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#HyperlinkClickEventArgs#hyperlinkType
    * @type DocumentLinkType
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#HyperlinkClickEventArgs#targetUri
    * @type string
    */


    /** 
    * @class DevExpress.AspNetCore.Spreadsheet#SelectionChangedEventArgs
    * @extends EventArgs
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#SelectionChangedEventArgs#selection
    * @type Selection
    */


    /** 
    * @class DevExpress.AspNetCore.Spreadsheet#CancelEventArgs 
    * @extends EventArgs
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#CancelEventArgs#cancel
    * @type boolean
    */


    /** 
    * @class DevExpress.AspNetCore.Spreadsheet#CellBeginEditEventArgs
    * @extends CancelEventArgs
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#CellBeginEditEventArgs#columnIndex
    * @type number
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#CellBeginEditEventArgs#rowIndex
    * @type number
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#CellBeginEditEventArgs#formula
    * @type string
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#CellBeginEditEventArgs#value
    * @type string
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#CellBeginEditEventArgs#sheetName
    * @type string
    */


    /** 
    * @class DevExpress.AspNetCore.Spreadsheet#CellEndEditEventArgs
    * @extends CancelEventArgs
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#CellEndEditEventArgs#columnIndex
    * @type number
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#CellEndEditEventArgs#rowIndex
    * @type number
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#CellEndEditEventArgs#formula
    * @type string
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#CellEndEditEventArgs#value
    * @type string
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#CellEndEditEventArgs#sheetName
    * @type string
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#CellEndEditEventArgs#editorText
    * @type string
    */


    /** 
    * @class DevExpress.AspNetCore.Spreadsheet#CellCancelEditEventArgs
    * @extends CancelEventArgs
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#CellCancelEditEventArgs#columnIndex
    * @type number
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#CellCancelEditEventArgs#rowIndex
    * @type number
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#CellCancelEditEventArgs#formula
    * @type string
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#CellCancelEditEventArgs#value
    * @type string
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#CellCancelEditEventArgs#sheetName
    * @type string
    */


    /** 
    * @class DevExpress.AspNetCore.Spreadsheet#PopupMenuShowingEventArgs
    * @extends CancelEventArgs
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#PopupMenuShowingEventArgs#menuItems
    * @type PopupMenuItemCollection
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#PopupMenuShowingEventArgs#menuType
    * @type PopupMenuItemCollection
    */


    /** 
    * @class DevExpress.AspNetCore.Spreadsheet#CustomCommandExecutedEventArgs
    * @extends EventArgs
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#CustomCommandExecutedEventArgs#commandName
    * @type string
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#CustomCommandExecutedEventArgs#parameter
    * @type string
    */

    /** @class DevExpress.AspNetCore.Spreadsheet#Rectangle */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#Rectangle#bottom
    * @type number
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#Rectangle#left
    * @type number
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#Rectangle#right
    * @type number
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#Rectangle#top
    * @type number
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#Rectangle#height
    * @type number
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#Rectangle#width
    * @type number
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#Rectangle#x
    * @type number
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#Rectangle#y
    * @type number
    */


    /** @class DevExpress.AspNetCore.Spreadsheet#Selection */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#Selection#activeCellColumnIndex
    * @type number
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#Selection#activeCellRowIndex
    * @type number
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#Selection#leftColumnIndex
    * @type number
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#Selection#topRowIndex
    * @type number
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#Selection#rightColumnIndex
    * @type number
    */
    /**
    * @name DevExpress.AspNetCore.Spreadsheet#Selection#bottomRowIndex
    * @type number
    */


    /** 
    * @class DevExpress.AspNetCore.Spreadsheet#PopupMenuItem
    */
    var PopupMenuItem = ASPx.CreateClass(ASPxClientSpreadsheetPopupMenuItem, {
        /**
        * @name DevExpress.AspNetCore.Spreadsheet#PopupMenuItem#parent
        * @type PopupMenuItem
        */
        /**
        * @name DevExpress.AspNetCore.Spreadsheet#PopupMenuItem#name
        * @type string
        */
        /**
        * @name DevExpress.AspNetCore.Spreadsheet#PopupMenuItem#text
        * @type string
        */
        /**
        * @name DevExpress.AspNetCore.Spreadsheet#PopupMenuItem#disabled
        * @type boolean
        */
        /**
        * @name DevExpress.AspNetCore.Spreadsheet#PopupMenuItem#beginGroup
        * @type boolean
        */
        /**
        * @name DevExpress.AspNetCore.Spreadsheet#PopupMenuItem#template
        * @type any
        */
        /** 
        * @function DevExpress.AspNetCore.Spreadsheet#PopupMenuItem#getSubItems
        * @returns {PopupMenuItemCollection}
        */
        getSubItems: function() {
            return this.GetSubItems();
        },
        /** 
        * @function DevExpress.AspNetCore.Spreadsheet#PopupMenuItem#getItem
        * @param {number} index
        * @returns {PopupMenuItem}
        */
        getItem: function(index) {
            return this.GetItem(index);
        },
        /** 
        * @function DevExpress.AspNetCore.Spreadsheet#PopupMenuItem#getItemByName
        * @param {string} name
        * @returns {PopupMenuItem}
        */
        getItemByName: function(name) {
            return this.GetItemByName(name);
        },
        /** 
        * @function DevExpress.AspNetCore.Spreadsheet#PopupMenuItem#getItemCount
        * @returns {number}
        */
        getItemCount: function() {
            return this.GetItemCount();
        },
        createItems: function(itemsFromProperties) {
            return new PopupMenuItemCollection(this, itemsFromProperties);
        },
        constructor: function(name, text, parentItem, itemProperties) {
            this.parent = parentItem;
            this.name = name;
            this.text = text;
            this.disabled = false;
            this.beginGroup = false;
            this.icon = '';
            this.closeMenuOnClick = true;
            this.selectable = false;
            this.selected = false;
            this.visible = true;

            this.initializeItem(itemProperties);
        },
        createItemInternal: function(itemProperties) {
            this.name = itemProperties.name || '';
            if(ASPx.IsExists(itemProperties.text))
                this.text = itemProperties.text;

            if(ASPx.IsExists(itemProperties.disabled))
                this.disabled = itemProperties.disabled;

            if(ASPx.IsExists(itemProperties.beginGroup))
                this.beginGroup = itemProperties.beginGroup;

            if(ASPx.IsExists(itemProperties.icon))
                this.icon = itemProperties.icon;

            if(ASPx.IsExists(itemProperties.closeMenuOnClick))
                this.closeMenuOnClick = itemProperties.closeMenuOnClick;

            if(ASPx.IsExists(itemProperties.selectable))
                this.selectable = itemProperties.selectable;

            if(ASPx.IsExists(itemProperties.selected))
                this.selected = itemProperties.selected;

            if(ASPx.IsExists(itemProperties.visible))
                this.visible = itemProperties.visible;
        }
    });


    /** 
    * @class DevExpress.AspNetCore.Spreadsheet#PopupMenuItemCollection
    */
    var PopupMenuItemCollection = ASPx.CreateClass(ASPxClientSpreadsheetPopupMenuItemCollection, {
        /** 
        * @function DevExpress.AspNetCore.Spreadsheet#PopupMenuItemCollection#add
        * @param {PopupMenuItem} item
        */
        add: function(item) {
            this.Add(item);
        },
        /** 
        * @function DevExpress.AspNetCore.Spreadsheet#PopupMenuItemCollection#remove
        * @param {number} index
        */
        remove: function(index) {
            this.Remove(index);
        },
        /** 
        * @function DevExpress.AspNetCore.Spreadsheet#PopupMenuItemCollection#removeByName
        * @param {string} name
        */
        removeByName: function(name) {
            this.RemoveByName(name);
        },
        /** 
        * @function DevExpress.AspNetCore.Spreadsheet#PopupMenuItemCollection#insert
        * @param {number} index
        * @param {PopupMenuItem} item
        */
        insert: function(index, item) {
            this.Insert(index, item);
        },
        /** 
        * @function DevExpress.AspNetCore.Spreadsheet#PopupMenuItemCollection#getCount
        * @returns {number}
        */
        getCount: function() {
            return this.GetCount();
        },
        /** 
        * @function DevExpress.AspNetCore.Spreadsheet#PopupMenuItemCollection#getByName
        * @param {string} name
        * @returns {PopupMenuItem}
        */
        getByName: function(name) {
            return this.GetByName(name);
        },
        /** 
        * @function DevExpress.AspNetCore.Spreadsheet#PopupMenuItemCollection#get
        * @param {number} index
        * @returns {PopupMenuItem}
        */
        get: function(index) {
            return this.Get(index);
        },
        /** @function DevExpress.AspNetCore.Spreadsheet#PopupMenuItemCollection#clear */
        clear: function() {
            this.Clear();
        },
        createNewItem: function(item) {
            return new PopupMenuItem(item.name, item.text, this.parent, item);
        }
    });


    /**
    * @memberof DevExpress.AspNetCore.Spreadsheet
    * @enum
    * @property None
    * @property Cell
    * @property Comment
    */
    var EditMode = ASPxClientSpreadsheetEditMode;


    /**
    * @memberof DevExpress.AspNetCore.Spreadsheet
    * @enum
    * @property Hyperlink
    * @property Bookmark
    * @property EmailAddress
    * @property Document
    */
    var DocumentLinkType = ASPxClientOfficeDocumentLinkType;


    /**
    * @memberof DevExpress.AspNetCore.Spreadsheet
    * @enum
    * @property ColumnHeading
    * @property RowHeading
    * @property SheetTab
    * @property Picture
    * @property Chart
    * @property Cell
    * @property AutoFilter
    * @property PivotTable
    * @property PivotTableAutoFilter
    */
    var PopupMenuType = ASPxClientSpreadsheetPopupMenuType;


    DevExpress.AspNetCore.Spreadsheet.PopupMenuItemCollection = PopupMenuItemCollection;
    DevExpress.AspNetCore.Spreadsheet.PopupMenuItem = PopupMenuItem;
    DevExpress.AspNetCore.Spreadsheet.EditMode = EditMode;
    DevExpress.AspNetCore.Spreadsheet.DocumentLinkType = DocumentLinkType;
    DevExpress.AspNetCore.Spreadsheet.PopupMenuType = PopupMenuType;
})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.InputController = ASPx.CreateClass(ASPxClientSpreadsheet.InputController, {
        constructor: function(spreadsheetControl, targetInput) {
            this.constructor.prototype.constructor.call(this, spreadsheetControl, targetInput);
        },
        eventSourceIsRibbonDropDownControl: function(evt) {
            return false;
        }
    });
})();
(function() {
    var createCommand = ASPxClientSpreadsheet.CommandsCreator.createCommand,
        CommandIDs = ASPxClientSpreadsheet.CommandsCreator.CommandIDs,
        ServerCommands = ASPxClientSpreadsheet.ServerCommands;

    var disabledCommands = [
        ASPxClientSpreadsheet.ServerCommands.internalCommands.FormatCells.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.RefreshPivotTable.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.HideFieldListPanelPivotTable.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableFieldSortAscending.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableFieldSortDescending.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableClearFieldFilters.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableLabelFilterEquals.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableLabelFilterDoesNotEqual.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableLabelFilterBeginsWith.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableLabelFilterDoesNotBeginWith.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableLabelFilterEndsWith.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableLabelFilterDoesNotEndWith.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableLabelFilterContains.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableLabelFilterDoesNotContain.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableLabelFilterGreaterThan.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableLabelFilterGreaterThanOrEqual.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableLabelFilterLessThan.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableLabelFilterLessThanOrEqual.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableLabelFilterBetween.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableLabelFilterNotBetween.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableLabelFiltersCommandGroup.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterEquals.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterBefore.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterAfter.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterBetween.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableFilterAllDatesInPeriodCommandGroup.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterToday.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterYesterday.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterTomorrow.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterThisWeek.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterNextWeek.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterLastWeek.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterThisMonth.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterNextMonth.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterLastMonth.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterThisQuarter.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterNextQuarter.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterLastQuarter.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterThisYear.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterNextYear.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterLastYear.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterYearToDate.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterFirstQuarter.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterSecondQuarter.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterThirdQuarter.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterFourthQuarter.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterJanuary.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterFebruary.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterMarch.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterApril.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterMay.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterJune.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterJuly.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterAugust.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterSeptember.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterOctober.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterNovember.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterDecember.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterEquals.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterBefore.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterAfter.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterBetween.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFilterCustom.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableDateFiltersCommandGroup.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableValueFiltersCommandGroup.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableRowFieldsFilterItems.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableColumnFieldsFilterItems.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableValueFilterEquals.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableValueFilterDoesNotEqual.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableValueFilterGreaterThan.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableValueFilterGreaterThanOrEqual.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableValueFilterLessThan.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableValueFilterLessThanOrEqual.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableValueFilterBetween.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableValueFilterNotBetween.id,
        ASPxClientSpreadsheet.ServerCommands.internalCommands.PivotTableValueFilterTop10.id
    ];

    CommandIDs.InsertPictureNCWebCommand = { id: 'w1000' };
    CommandIDs.GetTableSvgPreviewNCWebCommand = { id: 'w1001' };
    CommandIDs.GetChartStyleSvgPreviewNCWebCommand = { id: 'w1002' };
    CommandIDs.GetTableColumnValuesNCWebCommand = { id: 'w1003' };

    ServerCommands.InsertPictureNCWebCommand = createCommand(CommandIDs.InsertPictureNCWebCommand.id, { PictureUrl: undefined });
    ServerCommands.GetTableSvgPreviewNCWebCommand = createCommand(CommandIDs.GetTableSvgPreviewNCWebCommand.id);
    ServerCommands.GetChartStyleSvgPreviewNCWebCommand = createCommand(CommandIDs.GetChartStyleSvgPreviewNCWebCommand.id);
    ServerCommands.GetTableColumnValuesNCWebCommand = createCommand(CommandIDs.GetTableColumnValuesNCWebCommand.id);

    DevExpress.AspNetCore.Spreadsheet.CommandHelper = (function() {
        var CommandHelper = {};

        CommandHelper.isCommandDisabled = function(commandId) {
            return disabledCommands.indexOf(commandId) >= 0;
        };

        return CommandHelper;
    })();
})();
(function () {
    DevExpress.AspNetCore.Spreadsheet.FunctionListBox = ASPx.CreateClass(null, {
        constructor: function(spreadsheetControl) {
            this.items = [];
            this.spreadsheet = spreadsheetControl;
            this.listEditContainer = document.createElement('div');
            this.listEditContainer.className = 'dxss-funcLB';
            this.functionListBox = new DevExpress.ui.dxList(this.listEditContainer, {
                height: 'auto',
                noDataText: '',
                selectionMode: 'single',
                keyExpr: 'index',
                focusStateEnabled: false,
                onSelectionChanged: this.onSelectionChanged.aspxBind(this)
            });
            ASPx.Evt.AttachEventToElement(this.functionListBox.$element()[0], 'mousedown', function(e) {
                e.preventDefault(); //Prevent focus body on item mousedown
            });

            this.spreadsheet.GetMainElement().appendChild(this.listEditContainer);
            this.functionListBoxHelper = new ASPxClientSpreadsheet.FunctionsListBoxHelper(this);
        },

        GetMainElement: function() {
            return this.listEditContainer;
        },
        ShowAtPos: function(x, y) {
            this.functionListBoxHelper.showAtPos(this.GetMainElement(), x, y);
        },
        Hide: function() {
            this.functionListBoxHelper.hide(this.GetMainElement(), this.spreadsheet.name);
        },
        ClearItems: function() {
            this.items = [];
            this.functionListBox.option('items', this.items);
        },
        GetItemCount: function() {
            return this.items.length;
        },
        GetSelectedItem: function() {
            return this.functionListBox.option('selectedItems')[0];
        },
        SetSelectedIndex: function(index) {
            this.functionListBox.selectItem(index);
            this.functionListBox.scrollToItem(index);
        },
        AddItem: function(item) {
            return this.items.push({ index: this.items.length, text: item }) - 1;
        },
        AddFunctionItemsByFilter: function(filter) {
            this.items = [];
            this.functionListBoxHelper.addFunctionItemsByFilter(filter);
            this.functionListBox.option('items', this.items);
            this.UpdateHeightAfterItemsAdding();
        },
        ChangeMainElementDisplayProperty: function(display) {
            ASPx.SetElementDisplay(this.GetMainElement(), 'block');
        },
        UpdateHeightAfterItemsAdding: function() {
            var itemElements = this.GetMainElement().getElementsByClassName('dx-list-item'),
                itemElement = itemElements[itemElements.length - 1];
            if(itemElement) {
                var scrollContainer = this.GetMainElement().querySelector('.dxss-funcLB .dx-scrollable-container'),
                    maxHeight = itemElement.offsetHeight * this.functionListBoxHelper.getMaxScrollPageSize();
                scrollContainer.style.maxHeight = maxHeight + 'px';
            }
        },
        onSelectionChanged: function(e) {
            if(e.addedItems.length > 0) {
                var index = e.addedItems[0].index,
                    domElement = e.element[0] || e.element,
                    selectedItem = domElement.getElementsByClassName('dx-list-item-selected')[0];

                this.functionListBoxHelper.updateFunctionDescriptionHintState(this.GetMainElement(), this.spreadsheet.name, index,
                    selectedItem, ['dxss-funcInfo', null]);
            }
        },
        getCurrentIndex: function() {
            return this.GetSelectedItem().index;
        },
        getItemsCount: function() {
            return this.functionListBox.option('items').length;
        },
        OnArrowUp: function() {
            var prev = Math.max(this.getCurrentIndex() - 1, 0);
            this.SetSelectedIndex(prev);
        },
        OnArrowDown: function() {
            var next = Math.min(this.getCurrentIndex() + 1, this.getItemsCount() - 1);
            this.SetSelectedIndex(next);
        },
        OnPageUp: function() {
            var prev = Math.max(this.getCurrentIndex() - this.functionListBoxHelper.getMaxScrollPageSize() + 1, 0);
            this.SetSelectedIndex(prev);
        },
        OnPageDown: function() {
            var next = Math.min(this.getCurrentIndex() + this.functionListBoxHelper.getMaxScrollPageSize() - 1, this.getItemsCount() - 1);
            this.SetSelectedIndex(next);
        }
    });
})();

(function () {
    DevExpress.AspNetCore.Spreadsheet.SpreadsheetRibbon = function(container, settings) {
        var createRibbonElement = function(container) {
            var element = document.createElement('DIV');
            container.insertBefore(element, container.firstChild);
            return element;
        };

        var onCommandExecutedHandler = null;
        var ribbonElement = createRibbonElement(container);

        var ribbon = new DevExpress.AspNetCore.Spreadsheet.dxribbon.Ribbon({
            element: ribbonElement,
            activeTabIndex: settings.activeTabIndex,
            items: settings.tabs,
            contextItemsCategories: settings.contextTabCategories,
            onCommandExecuted: function(e) {
                if(onCommandExecutedHandler && e.item.name)
                    onCommandExecutedHandler(null, {
                        item: { name: e.item.name },
                        parameter: e.parameter
                    });
            }.bind(this),
            onSelectionChangedHandler: function(e) { }
        });
        ribbon.render();

        this.getRibbonInternal = function() {
            return ribbon;
        };

        this.showTabs = true;

        this.disableRefocus = true;
        this.GetMainElement = function() {
            return ribbonElement;
        };
        this.GetHeight = function() {
            return ribbonElement.offsetHeight;
        };
        this.SetWidth = function(width) {
        };
        this.AdjustControl = function() {
        };
        this.getInternalRibbonControlHeight = function() {
            return 0;
        };

        this.GetItemByName = function(name) {
            var items = ribbon.getItems(name);
            return {
                items: items || [],
                GetValue: function() {
                    return this.items && this.items.length > 0 && this.items[0].getValue ? this.items[0].getValue() : null;
                },
                SetValue: function(value) {
                    if(this.items) this.items.forEach(function(i) { i.setValue(value); });
                },
                GetEnabled: function() {
                    return null; //TODO
                },
                SetEnabled: function(value) {
                    if(this.items) this.items.forEach(function(i) { i.setEnabled(value); });
                }
            };
        };

        this.SetContextTabCategoryVisible = function(categoryName, visible) {
            ribbon.setContextItemsCategoryVisible(categoryName, visible);
        };

        this.SetEnabled = function(enabled) {
            ribbon.getTabPanel().option('disabled', !enabled);
        };

        this.CommandExecuted = {
            AddHandler: function(handler) {
                onCommandExecutedHandler = handler;
            }.bind(this),
            removeHandlerByControlName: function() {
            }
        };
        this.MinimizationStateChanged = {
            AddHandler: function() {
            },
            removeHandlerByControlName: function() {
            }
        };
        this.DialogBoxLauncherClicked = {
            AddHandler: function() {
            },
            removeHandlerByControlName: function() {
            }
        };
        this.KeyTipsClosedOnEscape = {
            AddHandler: function() {
            },
            removeHandlerByControlName: function() {
            }
        };
    };
})();

(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs = {};
    DevExpress.AspNetCore.Spreadsheet.Dialogs.Base = ASPx.CreateClass(null, {
        constructor: function(element, ownerControl) {
            this.element = element;
            this.ownerControl = ownerControl;
        },
        GetDialogHelper: function() {
            if(!this.dialogHelper)
                this.dialogHelper = this.CreateDialogHelper();
            return this.dialogHelper;
        },
        CreateDialogHelper: function() {
            return new DevExpress.AspNetCore.Spreadsheet.DialogHelpers.DialogHelperBase(this.getOwnerControl());
        },
        /* public void Show(){}*/
        show: function(commandId, parameters, callback, _isModal) {
            this.parameters = parameters;
            this.commandId = commandId;
            this.callback = callback;
            this.element.className = this.getPopupClassName();
            this.element.innerHTML = '';
            this.popupDialog = new DevExpress.ui.dxPopup(this.element, {
                title: this.getTitle(),
                //titleTemplate: this.getTitleTemplate.aspxBind(this),
                shading: this.isShadingDialog(),
                maxHeight: this.getMaxHeight(this.isShadingDialog()),
                maxWidth: this.getMaxWidth(),
                contentTemplate: this.getContentTemplate.aspxBind(this),
                toolbarItems: this.getToolbarItems(),
                height: 'auto',
                shadingColor: 'rgba(0,0,0,0)',
                onShowing: this.onShowing.aspxBind(this),
                onShown: this.onFocus.aspxBind(this),
                onHiding: this.onHiding.aspxBind(this),
                onHidden: this.onHidden.aspxBind(this)
            });
            this.beforeShowing();
            this.popupDialog.show();
            this.afterShowing();
        },
        getContentTemplate: function() {
            var element = document.createElement('div');
            element.className = this.getFormClassName();
            this.form = new DevExpress.ui.dxForm(element, this.spread(this.getFormOptionsCore(), this.getPrepareFormOptions()));
            return element;
        },
        isShadingDialog: function() {
            return true;
        },

        Execute: function(ownerControl, commandId, params) {
            this.show();
        },

        onShowing: function() {
        },
        // virtual
        beforeShowing: function() {
            ASPx.currentControlNameInDialog = this.getOwnerControl().name;
            ASPx.Dialog.PushDialogToCollection(this.getOwnerControl(), this);
        },
        // virtual
        afterShowing: function() {
            this.initializeDialogFields();
        },
        initializeDialogFields: function() {
        },


        afterClosing: function() {
            ASPx.Dialog.RemoveLastDialog(this.getOwnerControl());
            ASPx.currentControlNameInDialog = '';
        },
        getPrepareFormOptions: function() {
            var formOptions = this.getFormOptions();
            if(formOptions.items) {
                for(var key in formOptions.items) {
                    if(formOptions.items.hasOwnProperty(key)) {
                        var item = formOptions.items[key];
                        item.editorOptions = item.editorOptions || {};
                        item.editorOptions.valueChangeEvent = 'keyup';
                    }
                }
            }
            return formOptions;
        },
        getFormOptionsCore: function() {
            return {
                onContentReady: function(e) {
                    this.onContentReady(e);
                    e.component.registerKeyHandler('enter', this.onEnter.aspxBind(this));
                    e.component.registerKeyHandler('escape', this.onEscape.aspxBind(this));
                }.aspxBind(this),
                scrollingEnabled: true
            };
        },
        onContentReady: function(e) {
            if(this.isMobileView())
                e.component.option('labelLocation', 'top');
            else
                e.component.option('labelLocation', 'left');
        },
        getMaxWidth: function() {
            return 500;
        },
        getMaxHeight: function(shading) {
            return shading ? '100%' : null; // '100%' - For form scrolling
        },
        isMobileView: function() {
            return window.innerWidth < 600;
        },
        // virtual 
        getTitle: function() {
            // return '';
        },
        getTitleTemplate: function() {
        },
        getPopupClassName: function() {
            return DevExpress.ui.themes.current().replace(/\./g, '-');
        },
        getFormClassName: function() {
            var className = 'dxss-dialogFormWrapper';
            if(this.isMobileView())
                className = className + ' dxss-mv';
            return className;
        },
        getDialogFormElement: function() {
            return document.getElementsByClassName(this.getFormClassName())[0];
        },
        getEditorNameToAutofocus: function() {
            return '';
        },
        onFocus: function() {
            var editorName = this.getEditorNameToAutofocus();
            if(editorName)
                this.form.getEditor(editorName).focus();
        },
        onHiding: function(e) {
        },
        onHidden: function() {
            this.afterClosing();
        },
        onEnter: function() {
            this.onOk();
        },
        onEscape: function() {
            this.onCancel();
        },
        onOk: function() {
            if(this.isFormValid()) {
                this.applyParameters();
                this.popupDialog.hide();
            } else
                this.validationProcessing();
        },
        onCancel: function() {
            this.popupDialog.hide();
        },

        isFormValid: function() {
            var isValid = false;
            try {
                DevExpress.validationEngine.validateGroup(this.form);
                isValid = this.form.validate().isValid;
            } catch(e) {
                isValid = true;
            }
            return isValid;
        },
        validationProcessing: function() {
        },
        getToolbarItems: function() {
            return [this.getOkToolbarItem(), this.getCancelToolbarItem()];
        },
        getOkToolbarItem: function() {
            return {
                widget: 'dxButton',
                location: 'after',
                toolbar: 'bottom',
                options: {
                    text: 'Ok',
                    onClick: this.onOk.aspxBind(this),
                    onInitialized: function(e) {
                        this.okButton = e.component;
                    }.aspxBind(this)
                }
            };
        },
        getCancelToolbarItem: function() {
            return {
                widget: 'dxButton',
                location: 'after',
                toolbar: 'bottom',
                options: {
                    text: 'Cancel',
                    onClick: this.onCancel.aspxBind(this)
                }
            };
        },
        setClientModality: function(isModal) {
            this.popupDialog.option('shading', isModal);
            this.popupDialog.option('maxHeight', this.getMaxHeight(isModal));
        },
        switchRibbonEnabledMode: function(enabled) {
            var ribbonControl = this.getOwnerControl().GetRibbon();
            if(ribbonControl)
                ribbonControl.SetEnabled(enabled);
            this.getOwnerControl().onEditingStopped();
        },
        switchContextMenuEnableMode: function(enabled) {
            this.getOwnerControl().getPopupMenuHelper().setPopupMenuEnabled(enabled);
        },
        applyParameters: function() {
            var dialogParams = this.getCommandParams(this.form.option('formData'));
            this.dialogCompletedSuccessfully(dialogParams);
        },
        //abstract
        getCommandParams: function(formData) {
        },
        dialogCompletedSuccessfully: function(dialogParams) {
            this.executeCommand(this.getCommandId(), dialogParams);
        },
        executeCommand: function(commandId, commandArgs) {
            this.getOwnerControl().onServerCommand(commandId, commandArgs);
        },
        getCommandArgs: function() {
            return '';
        },
        onActiveCellChanged: function(selection) {
        },
        notifyResponseReceived: function(response) {
        },
        // Helpres
        getOwnerControl: function() {
            return this.ownerControl;
        },
        getCommandId: function() {
            return this.commandId;
        },
        spread: function() {
            var target = {};
            for(var i = 0; i<arguments.length; i++) {
                var source = arguments[i];
                for(var key in source) {
                    if(Object.prototype.hasOwnProperty.call(source, key)) {
                        target[key] = source[key];
                    }
                }
            }
            return target;
        }
    });
   
    DevExpress.AspNetCore.Spreadsheet.DialogManager = (function() {
        function DialogManager(container, ownerControl) {
            this.dialogElement = container.appendChild(document.createElement('div'));
            this.notificationElement = container.appendChild(document.createElement('div'));
            this.ownerControl = ownerControl;
            this.dialogsMap = {};
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.RenameSheet.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.RenameSheet;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.UnhideSheet.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.UnhideSheet;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.MoveOrCopySheet.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.MoveOrCopySheet;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.InsertHyperlink.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.InsertHyperlink;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.FormatColumnWidth.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.ColumnWidth;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.FormatRowHeight.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.RowHeight;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.FormatDefaultColumnWidth.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.ColumnWidthDefault;

            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.ChartChangeType.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.ChartType;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.ChartChangeTitle.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.ChartTitle;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.ChartChangeHorizontalAxisTitle.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.ChartHorizontalAxisTitle;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.ChartChangeVerticalAxisTitle.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.ChartVerticalAxisTitle;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.ModifyChartLayout.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.ChartLayout;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.ChartSelectData.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.ChartSelectData;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.ModifyChartStyle.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.ChartStyle;

            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.InsertTable.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.InsertTable;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.ModifyTableStyle.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.ModifyTableStyle;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.FormatAsTable.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.FormatAsTable;

            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.DataFilterSimple.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.DataFilterSimple;

            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.DataFilterEquals.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomDataFilter;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.DataFilterDoesNotEqual.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomDataFilter;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.DataFilterGreaterThan.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomDataFilter;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.DataFilterGreaterThanOrEqualTo.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomDataFilter;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.DataFilterBetween.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomDataFilter;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.DataFilterBeginsWith.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomDataFilter;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.DataFilterEndsWith.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomDataFilter;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.DataFilterContains.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomDataFilter;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.DataFilterDoesNotContain.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomDataFilter;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.DataFilterCustom.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomDataFilter;

            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.DataFilterDateEquals.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomDateTimeFilter;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.DataFilterDateBefore.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomDateTimeFilter;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.DataFilterDateAfter.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomDateTimeFilter;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.DataFilterDateBetween.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomDateTimeFilter;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.DataFilterDateCustom.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomDateTimeFilter;

            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.DataFilterTop10.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.DataFilterTop10;

            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.InsertPicture.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.InsertPicture;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.FindAll.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.FindAndReplace;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.InsertTableWithStyle.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.InsertTableWithStyle;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.PageSetupCustomMargins.id.toString()] = DevExpress.AspNetCore.Spreadsheet.Dialogs.PageSetup;
            this.dialogsMap[ASPxClientSpreadsheet.ServerCommands.internalCommands.ApplyDataValidation.id] = DevExpress.AspNetCore.Spreadsheet.Dialogs.DataValidation;
        }
        DialogManager.prototype.getDialog = function(name) {
            var dialogType = this.dialogsMap[name];
            return dialogType ? this.getDialogByType(dialogType) : null;
        };
        DialogManager.prototype.getDialogByType = function(type) {
            return new type(this.dialogElement, this.ownerControl);
        };
        DialogManager.prototype.getNotificationDialog = function() {
            if(!this.notificationDialog)
                this.notificationDialog = new DevExpress.AspNetCore.Spreadsheet.Dialogs.Notification(this.notificationElement, this.ownerControl);
            return this.notificationDialog;
        };
        DialogManager.prototype.getValidationConfirm = function() {
            if(!this.validationConfirmDialog)
                this.validationConfirmDialog = new DevExpress.AspNetCore.Spreadsheet.Dialogs.ValidationConfirm(this.dialogElement, this.ownerControl);
            return this.validationConfirmDialog;
        };
        return DialogManager;
    })();
    DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.ClassNames = {
        DialogWithTabs: 'dxss-dialogWithTabs'
    };
})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.DialogHelpers = {};
    DevExpress.AspNetCore.Spreadsheet.DialogHelpers.DialogHelperBase = ASPx.CreateClass(ASPxClientSpreadsheet.DialogHelperBase, {
        constructor: function(ownerControl) {
            this.constructor.prototype.constructor.call(this, ownerControl);
        }
    });
    DevExpress.AspNetCore.Spreadsheet.DialogHelpers.InsertHyperlinkDialogHelper = ASPx.CreateClass(ASPxClientSpreadsheet.InsertHyperlinkDialogHelper, {});
    DevExpress.AspNetCore.Spreadsheet.DialogHelpers.InsertPictureDialogHelper = ASPx.CreateClass(ASPxClientSpreadsheet.InsertPictureDialogHelper, {});
    DevExpress.AspNetCore.Spreadsheet.DialogHelpers.InsertTableDialogHelper = ASPx.CreateClass(ASPxClientSpreadsheet.InsertTableDialogHelper, {});
    DevExpress.AspNetCore.Spreadsheet.DialogHelpers.RenameSheetDialogHelper = ASPx.CreateClass(ASPxClientSpreadsheet.RenameSheetDialogHelper, {});
    DevExpress.AspNetCore.Spreadsheet.DialogHelpers.ChartDialogsHelper = ASPx.CreateClass(ASPxClientSpreadsheet.ChartDialogsHelper, {});
    DevExpress.AspNetCore.Spreadsheet.DialogHelpers.DataValidationDialogHelper = ASPx.CreateClass(ASPxClientSpreadsheet.DataValidationDialogHelper, {});
    DevExpress.AspNetCore.Spreadsheet.DialogHelpers.ValidationConfirmDialogHelper = ASPx.CreateClass(ASPxClientSpreadsheet.ValidationConfirmDialogHelper, {});

    DevExpress.AspNetCore.Spreadsheet.DialogHelpers.AutoFilterDialogsHelper = ASPx.CreateClass(ASPxClientSpreadsheet.AutoFilterDialogsHelper, {
        getChildNodes: function(node) {
            return node.Children;
        },
        getNodeCheckedState: function(node) {
            return node.Checked;
        },
        getNodeKey: function(node) {
            return node.Id;
        }
    });
})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.DataValidation = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {
        constructor: function(element, ownerControl) {
            this.element = element;
            this.ownerControl = ownerControl;

            this.allowedTypes = ['Any value', 'Whole number', 'Decimal', 'List', 'Date', 'Time', 'Text length', 'Custom'];
            this.data = ['between', 'not between', 'equal to', 'not equal to', 'greater than', 'less than', 'greater than or equal to', 'less than or equal to'];
            this.errorAlertStyle = ['Stop', 'Warning', 'Information'];
            this.formulaLabelTexts = {
                Date: 'Date',
                EndDate: 'End date',
                EndTime: 'End time',
                Formula: 'Formula',
                Length: 'Length',
                Maximum: 'Maximum',
                Minimum: 'Minimum',
                Source: 'Source',
                StartDate: 'Start date',
                StartTime: 'Start time',
                Time: 'Time',
                Value: 'Value'
            };
            this.viewModel = {};
            this.formData = {
                f1LabelText: 'Minimum',
                f2LabelText: 'Maximum',
                dataOperatorEnabled: false,
                ignoreBlankEnabled: true,
                f1Visible: true,
                f2Visible: true,
                selectedTab: 0
            };
        },
        CreateDialogHelper: function() {
            return new DevExpress.AspNetCore.Spreadsheet.DialogHelpers.DataValidationDialogHelper(this.ownerControl, this);
        },
        getFormOptions: function() {
            return {
                height: '100%',
                items: this.createItems()
            };
        },
        createItems: function() {
            return [{
                itemType: 'tabbed',
                tabPanelOptions: {
                    deferRendering: false,
                    focusStateEnabled: false,
                    selectedIndex: this.formData.selectedTab,
                    onSelectionChanged: function(e) {
                        this.formData.selectedTab = e.component.option('selectedIndex');
                        this.canApplyCheckBox.option('visible', this.formData.selectedTab === 0);
                    }.aspxBind(this)
                },
                tabs:
                    [{
                        title: 'Settings',
                        items: [{
                            itemType: 'group',
                            name: 'settingsGroup',
                            caption: 'Validation criteria',
                            colCount: 2,
                            items: [{
                                dataField: 'type',
                                editorType: 'dxSelectBox',
                                label: { text: 'Allow', location: 'top' },
                                editorOptions: {
                                    items: this.allowedTypes,
                                    onValueChanged: function(e) {
                                        this.updateEditors();
                                    }.aspxBind(this)
                                },
                                colSpan: 2
                            },
                            {
                                dataField: 'ignoreBlank',
                                editorType: 'dxCheckBox',
                                label: { visible: false },
                                disabled: !this.formData.ignoreBlankEnabled,
                                editorOptions: {
                                    text: 'Ignore blank'
                                },
                                colSpan: this.GetDialogHelper().getInCellDropdownVisible() ? 1 : 2
                            },
                            {
                                dataField: 'inCellDropDown',
                                editorType: 'dxCheckBox',
                                label: { visible: false },
                                visible: this.GetDialogHelper().getInCellDropdownVisible(),
                                editorOptions: {
                                    value: false,
                                    text: 'In-cell dropdown'
                                },
                                colSpan: 1
                            },
                            {
                                dataField: 'operator',
                                editorType: 'dxSelectBox',
                                disabled: !this.formData.dataOperatorEnabled,
                                label: { text: 'Data', location: 'top' },
                                editorOptions: {
                                    items: this.data,
                                    onValueChanged: function(e) {
                                        this.updateEditors();
                                    }.aspxBind(this)
                                },
                                colSpan: 2
                            },
                            {
                                dataField: 'formula1',
                                editorType: 'dxTextBox',
                                label: { text: this.formData.f1LabelText, location: 'top', showColon: false },
                                visible: this.formData.f1Visible,
                                editorOptions: {
                                    onInitialized: function(e) {
                                        this.formula1 = e.component;
                                    }.aspxBind(this),
                                    onFocusIn: function(e) {
                                        this.rangeEditorGorFocus(e.component);
                                    }.aspxBind(this)
                                },
                                colSpan: 2
                            },
                            {
                                dataField: 'formula2',
                                editorType: 'dxTextBox',
                                label: { text: this.formData.f2LabelText, location: 'top', showColon: false },
                                visible: this.formData.f2Visible,
                                editorOptions: {
                                    onInitialized: function(e) {
                                        this.formula2 = e.component;
                                    }.aspxBind(this),
                                    onFocusIn: function(e) {
                                        this.rangeEditorGorFocus(e.component);
                                    }.aspxBind(this)
                                },
                                colSpan: 2
                            }]
                        }]
                    },
                    {
                        title: 'Input Message',
                        items: [{
                            dataField: 'showMessage',
                            editorType: 'dxCheckBox',
                            label: { visible: false },
                            editorOptions: {
                                text: 'Show input message when cell is selected',
                                onValueChanged: function(e) {
                                    this.inputMessageSetEnabled();
                                }.aspxBind(this)
                            }
                        }, {
                            itemType: 'group',
                            caption: 'When cell is selected, show this input message:',
                            items: [{
                                dataField: 'messageTitle',
                                editorType: 'dxTextBox',
                                disabled: !this.formData.showMessage,
                                label: { text: 'Title', location: 'top' }
                            }, {
                                dataField: 'message',
                                editorType: 'dxTextArea',
                                disabled: !this.formData.showMessage,
                                label: { text: 'Input message', location: 'top' },
                                editorOptions: {
                                    height: 180
                                }
                            }]
                        }]
                    },
                    {
                        title: 'Error Alert',
                        items: [{
                            dataField: 'showErrorMessage',
                            editorType: 'dxCheckBox',
                            label: { visible: false },
                            editorOptions: {
                                text: 'Show error alert after invalid data is entered',
                                onValueChanged: function(e) {
                                    this.errorAlertSetEnabled();
                                }.aspxBind(this)
                            }
                        }, {
                            itemType: 'group',
                            caption: 'When user enters invalid data, show this error alert:',
                            items: [{
                                dataField: 'errorStyle',
                                editorType: 'dxSelectBox',
                                label: { visible: false },
                                disabled: !this.formData.showErrorMessage,
                                editorOptions: {
                                    items: this.errorAlertStyle
                                }
                            }, {
                                dataField: 'errorTitle',
                                editorType: 'dxTextBox',
                                disabled: !this.formData.showErrorMessage,
                                label: { text: 'Title', location: 'top' }
                            }, {
                                dataField: 'errorMessage',
                                editorType: 'dxTextArea',
                                disabled: !this.formData.showErrorMessage,
                                label: { text: 'Error message', location: 'top' },
                                editorOptions: {
                                    height: 150
                                }
                            }]
                        }]
                    }]
            }];
        },
        getContentTemplate: function() {
            var baseTemplate = DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.getContentTemplate.call(this),
                element = document.createElement('div'),
                checkBoxElement = document.createElement('div');

            element.className = 'dxss-validation-form-container';
            element.appendChild(baseTemplate);
            element.appendChild(checkBoxElement);
            this.canApplyCheckBox = new DevExpress.ui.dxCheckBox(checkBoxElement, {
                value: false,
                text: 'Apply these changes to all other cells with the same settings',
                disabled: !this.viewModel.DataValidationRange,
                visible: this.formData.selectedTab === 0,
                elementAttr: {
                    class: 'dxss-data-validation-apply-changes'
                },
                onValueChanged: function() {
                    this.GetDialogHelper().showDataValidationRanges(this.getCanApplyChangesToAllCellsCheckBoxChecked(),
                        this.viewModel.DataValidationRange);
                }.aspxBind(this)
            });
            return element;
        },
        getTitle: function() {
            return 'Data Validation';
        },
        getMaxWidth: function() {
            return 540;
        },
        fixDialogHeight: function() {
            var height = this.getDialogFormElement().offsetHeight;
            this.form.option('height', height);
        },
        onHiding: function() {
            this.GetDialogHelper().onClose();
            DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.onHiding.call(this);
        },
        getPopupClassName: function() {
            var baseClassName = DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.getPopupClassName.call(this);
            return baseClassName + ' ' + DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.ClassNames.DialogWithTabs;
        },
        getCommandParams: function(formData) {
            var result = {};
            result.ViewModel = ASPx.Json.ToJson({
                Type: this.allowedTypes.indexOf(formData.type),
                Operator: this.data.indexOf(formData.operator),
                SuppressDropDown: false,
                IgnoreBlank: formData.ignoreBlank,
                InCellDropDown: formData.inCellDropDown,
                Formula1: formData.formula1,
                Formula2: formData.formula2,
                ShowMessage: formData.showMessage,
                MessageTitle: formData.messageTitle,
                Message: formData.message,
                ShowErrorMessage: formData.showErrorMessage,
                ErrorTitle: formData.errorTitle,
                ErrorMessage: formData.errorMessage,
                ErrorStyle: formData.errorStyle
            });
            return result;
        },
        getToolbarItems: function() {
            var buttonItems = DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.getToolbarItems.call(this),
                clearAllButton = {
                    widget: 'dxButton',
                    location: 'before',
                    toolbar: 'bottom',
                    options: {
                        text: 'Clear All',
                        onClick: this.restoreDefault.aspxBind(this)
                    }
                };
            buttonItems.push(clearAllButton);
            return buttonItems;
        },
        initializeDialogFields: function() {
            this.fixDialogHeight();
            this.getOwnerControl().fetchDataValidationViewModelFromDialog(this);
        },
        populateEditors: function() {
            this.formData.type = this.allowedTypes[this.viewModel.Type];
            this.formData.operator = this.data[this.viewModel.Operator];
            this.formData.ignoreBlank = this.viewModel.IgnoreBlank;
            this.formData.inCellDropDown = this.viewModel.InCellDropDown;
            this.formData.formula1 = this.viewModel.Formula1;
            this.formData.formula2 = this.viewModel.Formula2;
            this.formData.showMessage = this.viewModel.ShowMessage;
            this.formData.messageTitle = this.viewModel.MessageTitle;
            this.formData.message = this.viewModel.Message;
            this.formData.showErrorMessage = this.viewModel.ShowErrorMessage;
            this.formData.errorTitle = this.viewModel.ErrorTitle;
            this.formData.errorMessage = this.viewModel.ErrorMessage;
            this.formData.errorStyle = this.viewModel.ErrorStyle;
            this.form.option('formData', this.formData);
            this.canApplyCheckBox.option('disabled', !this.viewModel.DataValidationRange);
        },
        updateItems: function() {
            this.form.option('items', this.createItems());
        },
        updateEditors: function() {
            this.formData.ignoreBlankEnabled = this.GetDialogHelper().getIgnoreBlankEnabled();
            this.formData.dataOperatorEnabled = this.GetDialogHelper().getDataOperatorEnabled();
            this.GetDialogHelper().prepareFormulas();
            this.updateItems();
        },
        updateMessages: function() {
        },

        restoreDefault: function() {
            this.formData.type = this.allowedTypes[0];
            this.formData.operator = this.data[0];
            this.formData.ignoreBlank = true;
            this.formData.inCellDropDown = false;
            this.formData.formula1 = '';
            this.formData.formula2 = '';
            this.formData.showMessage = true;
            this.formData.messageTitle = '';
            this.formData.message = '';
            this.formData.showErrorMessage = true;
            this.formData.errorTitle = '';
            this.formData.errorMessage = '';
            this.formData.errorStyle = this.errorAlertStyle[0];
            this.form.option('formData', this.formData);
        },

        rangeEditorGorFocus: function(activeEditor) {
            var activeEditorInput = activeEditor.$element()[0].getElementsByTagName('input')[0],
                formula1Input = this.getFormula1TextBoxInputElement(),
                formula2Input = this.getFormula2TextBoxInputElement(),
                range = activeEditor.option('value');

            this.setClientModality(false);
            this.GetDialogHelper().rangeEditorGorFocus(activeEditorInput, formula1Input, formula2Input, range);
        },
        isFormValid: function() {
            var firstVisible = this.formData.f1Visible,
                secondVisible = this.formData.f2Visible,
                firstValue = this.formData.formula1,
                secondValue = this.formData.formula2;

            return this.GetDialogHelper().isDialogValid(firstVisible, secondVisible, firstValue, secondValue);
        },
        validationProcessing: function() {
            this.GetDialogHelper().showInvalidFormulaMessage();
        },
        dialogCompletedSuccessfully: function(dialogParams) {
            this.GetDialogHelper().dialogCompletedSuccessfully(this.getCanApplyChangesToAllCellsCheckBoxChecked(), this.viewModel.DataValidationRange);
            DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.dialogCompletedSuccessfully.call(this, dialogParams);
        },
        inputMessageSetEnabled: function() {
            this.updateItems();
        },
        errorAlertSetEnabled: function() {
            this.updateItems();
        },
        setF1LabelText: function(text) {
            this.formData.f1LabelText = text;
        },
        setF2LabelText: function(text) {
            this.formData.f2LabelText = text;
        },
        setFormula1Visible: function(visible) {
            this.formData.f1Visible = visible;
        },
        setFormula2Visible: function(visible) {
            this.formData.f2Visible = visible;
        },
        getTypeComboBoxSelectedIndex: function() {
            return this.allowedTypes.indexOf(this.formData.type);
        },
        getOperatorComboBoxSelectedIndex: function() {
            return this.data.indexOf(this.formData.operator);
        },
        getFormula1TextBoxInputElement: function() {
            return this.formula1.$element()[0].getElementsByTagName('input')[0];
        },
        getFormula2TextBoxInputElement: function() {
            return this.formula2.$element()[0].getElementsByTagName('input')[0];
        },
        getCanApplyChangesToAllCellsCheckBoxChecked: function() {
            return this.canApplyCheckBox.option('value');
        }
    });
})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.ValidationConfirm = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {
        CreateDialogHelper: function() {
            return new DevExpress.AspNetCore.Spreadsheet.DialogHelpers.ValidationConfirmDialogHelper(this.getOwnerControl());
        },
        getFormOptions: function() {
            return {
                items: [
                    {
                        template: function(data, itemElement) {
                            this.messageDiv = document.createElement('div');
                            this.messageDiv.className = 'dxss-validationMessage';
                            return this.messageDiv;
                        }.aspxBind(this)
                    }
                ]
            };
        },
        getToolbarItems: function() {
            return [{
                widget: 'dxButton',
                location: 'after',
                toolbar: 'bottom',
                options: {
                    text: 'Retry',
                    visible: this.GetDialogHelper().getRetryNoButtonVisible(),
                    onInitialized: function(e) {
                        this.retryNoButton = e.component;
                    }.aspxBind(this),
                    onClick: function() {
                        this.tryToApplyValidation = true;
                        this.popupDialog.hide();
                        this.GetDialogHelper().retryInput();
                    }.aspxBind(this)
                }
            }, {
                widget: 'dxButton',
                location: 'after',
                toolbar: 'bottom',
                options: {
                    text: 'Ok',
                    visible: this.GetDialogHelper().getYesOkButtonVisible(),
                    onInitialized: function(e) {
                        this.yesOkButton = e.component;
                    }.aspxBind(this),
                    onClick: function() {
                        this.tryToApplyValidation = true;
                        this.popupDialog.hide();
                        this.GetDialogHelper().confirmOperation();
                    }.aspxBind(this)
                }
            }, this.getCancelToolbarItem()];
        },
        getTitle: function() {
            return 'Data Validation Failed';//TODO
        },
        onFocus: function() {
            this.GetDialogHelper().getFocusedEditor(this.GetRetryNoButton(), this.GetYesOkButton()).focus();
        },
        onHiding: function(e) {
            if(!this.tryToApplyValidation)
                this.GetDialogHelper().cancelValidation();
            this.tryToApplyValidation = false;
            DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.onHiding.call(this, e);
        },
        initializeDialogFields: function() {
            this.GetDialogHelper().initValidationCell();
            this.initializeButtons();
            this.getMessageDiv().innerHTML = this.GetDialogHelper().getValidationConfirmMsg();
            this.popupDialog.repaint();
            //this.GetDialogPopup().SetHeaderText(this.GetDialogCaptionText(this.GetDialogHelper().validationConfirm.error)); //TODO
        },
        initializeButtons: function() {
            var retryNoButton = this.GetRetryNoButton(),
                yesOkButton = this.GetYesOkButton();

            yesOkButton.option('visible', this.GetDialogHelper().getYesOkButtonVisible());
            retryNoButton.option('visible', this.GetDialogHelper().getRetryNoButtonVisible());
            retryNoButton.option('text', this.GetDialogHelper().getRetryNoButtonText(['Retry', 'No']));
            yesOkButton.option('text', this.GetDialogHelper().getYesOkButtonText(['Yes', 'Ok']));
        },
        getMessageDiv: function() {
            return this.messageDiv;
        },
        GetYesOkButton: function() {
            return this.yesOkButton;
        },
        GetRetryNoButton: function() {
            return this.retryNoButton;
        }
    });
})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.InsertHyperlink = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {
        LinkTypes: ['Web page', 'E-mail address'],
        CreateDialogHelper: function() {
            return new DevExpress.AspNetCore.Spreadsheet.DialogHelpers.InsertHyperlinkDialogHelper(this.ownerControl);
        },
        getFormOptions: function() {
            var linkContext = this.getLinkContext();
            this.formData = this.getFormData(linkContext);
            this.focusedEditorName = linkContext.isMailAddress ? 'eMailAddress' : 'targetUri';
            return {
                colCount: 1,
                formData: this.formData,
                items: [
                    {
                        dataField: 'linkType',
                        editorType: 'dxRadioGroup',
                        label: { visible: false },
                        editorOptions: {
                            items: this.LinkTypes,
                            layout: 'horizontal',
                            onValueChanged: function(e) {
                                this.updateEditorsVisibility(e.value === this.LinkTypes[1]);
                            }.aspxBind(this)
                        }
                    },
                    {
                        dataField: 'targetUri',
                        editorType: 'dxTextBox',
                        label: { text: 'URL' },
                        visible: !linkContext.isMailAddress,
                        editorOptions: {
                            validationMessageMode: 'always'
                        },
                        validationRules: [{
                            type: 'required',
                            message: 'URL is required'
                        }]
                    },
                    {
                        dataField: 'eMailAddress',
                        editorType: 'dxTextBox',
                        label: { text: 'E-mail address' },
                        visible: linkContext.isMailAddress,
                        editorOptions: {
                            validationMessageMode: 'always'
                        },
                        validationRules: [{
                            type: 'required',
                            message: 'E-mail address is required'
                        },
                        {
                            type: 'email',
                            message: 'E-mail address is invalid'
                        }]
                    },
                    {
                        dataField: 'subject',
                        editorType: 'dxTextBox',
                        label: { text: 'Subject' },
                        visible: linkContext.isMailAddress
                    },
                    {
                        dataField: 'displayText',
                        editorType: 'dxTextBox',
                        label: { text: 'Text' },
                        editorOptions: {
                            disabled: linkContext.isDrawing
                        }
                    },
                    {
                        dataField: 'title',
                        editorType: 'dxTextBox',
                        label: { text: 'ToolTip' }
                    }
                ]
            };
        },
        getTitle: function() {
            return 'Insert Hyperlink';
        },
        getFormClassName: function() {
            var className = DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.getFormClassName.call(this);
            return className + ' dxss-insertHyperlinkDialog';
        },
        getLinkContext: function() {
            return this.GetDialogHelper().getHyperLinkInformation();
        },
        getFormData: function(linkContext) {
            return {
                linkType: linkContext.isMailAddress ? this.LinkTypes[1] : this.LinkTypes[0],
                targetUri: linkContext.isMailAddress ? '' : linkContext.targetUri,
                eMailAddress: linkContext.isMailAddress ? linkContext.targetUri : '',
                displayText: linkContext.isDrawing ? '<<Selection in Document>>' : linkContext.displayText,
                title: linkContext.title,
                subject: linkContext.subject,
                isDrawing: Boolean(linkContext.isDrawing)
            };
        },
        updateEditorsVisibility: function(isMailAddress) {
            this.form.beginUpdate();
            this.form.itemOption('eMailAddress', 'visible', isMailAddress);
            this.form.itemOption('subject', 'visible', isMailAddress);
            this.form.itemOption('targetUri', 'visible', !isMailAddress);
            this.form.endUpdate();
        },
        getEditorNameToAutofocus: function() {
            return this.focusedEditorName;
        },
        getCommandParams: function(formData) {
            return {
                HyperLinkUrlAddress: this.getUrl(formData),
                HyperLinkDisplayText: formData.isDrawing ? '' : formData.displayText,
                HyperLinkScreenTip: formData.title,
                IsDrawing: formData.isDrawing
            };
        },
        getUrl: function(formData) {
            if(formData.linkType === this.LinkTypes[0])
                return formData.targetUri;
            return this.GetDialogHelper().getEmailUrl(formData.eMailAddress, formData.subject);
        }
    });
})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.NotificationTypes = {
        0: 'warning',
        1: 'error'
    };
    var MessageDictionary = function() {
        var messageDictionary = {
            InvalidFontSize: 'Font size must be between 1 and 409 points',
            Msg_CellOrChartIsReadonlyShort: 'The cell or chart you\'re trying to change is on a protected sheet.',
            Msg_PivotTablePartCanNotBeChanged: 'Cannot change this part of a PivotTable report.',
            OpeningAndOverstoreImpossibleError: 'The open and save document operations are not allowed<br />since the working directory is not specified for the editor.'
        };
        function getMessageById(messageId) {
            if(messageDictionary.hasOwnProperty(messageId))
                return messageDictionary[messageId];
            return '';
        }
        return {
            getMessageById: getMessageById
        };
    };
    DevExpress.AspNetCore.Spreadsheet.Dialogs.MessageDictionary = MessageDictionary;

    DevExpress.AspNetCore.Spreadsheet.Dialogs.Notification = ASPx.CreateClass(null, {
        constructor: function(element, ownerControl) {
            this.ownerControl = ownerControl;
            this.messageDictionary = new DevExpress.AspNetCore.Spreadsheet.Dialogs.MessageDictionary();
            this.toast = new DevExpress.ui.dxToast(element, {
                position: { at: 'bottom', of: this.getAnchorContainer() },
                closeOnOutsideClick: true
            });
        },
        getAnchorContainer: function() {
            return this.ownerControl.getRenderHelper().getWorkbookControl();
        },
        show: function(messageOrId, messageType, useMessageId) {
            var message = useMessageId ? this.messageDictionary.getMessageById(messageOrId) : messageOrId;
            var toastType = DevExpress.AspNetCore.Spreadsheet.Dialogs.NotificationTypes[messageType] || 'custom';
            this.toast.option('message', message);
            this.toast.option('type', toastType);
            this.toast.show();
        }
    });
   
})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.ChartType = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {
        getFormOptions: function() {
            this.formData = this.getFormData();
            return {
                colCount: 3,
                colCountByScreen: {
                    'xs' : 3
                },
                formData: this.formData,
                items: [
                    {
                        editorType: 'dxList',
                        editorOptions: {
                            dataSource: this.formData,
                            selectionMode: 'single',
                            itemTemplate: this.getChartCategoriesListItemTemplate.aspxBind(this),
                            onSelectionChanged: this.onChartCategoryChanged.aspxBind(this),
                            onContentReady: this.onChartCategoriesListContentReady.aspxBind(this)
                        }
                    },
                    {
                        editorType: 'dxTileView',
                        dataField: 'items',
                        label: { visible: false },
                        colSpan: 2,
                        editorOptions: {
                            items: this.formData[0].items,
                            itemTemplate: this.getChartTypeTileTemplate.aspxBind(this),
                            direction: 'vertical',
                            baseItemWidth: 60,
                            baseItemHeight: 60,
                            itemMargin: 10,
                            height: '100%',
                            maxHeight: 400,
                            showScrollbar: true
                        }
                    }
                ]
            };
        },
        getTitle: function() {
            return 'Change Chart Type';
        },
        getChartTypeImageContainerClassName: function() {
            return 'dxss-chartType';
        },
        getChartCategoryContainerClassName: function() {
            return 'dxss-chartCategory';
        },

        getFormData: function() {
            var formData = [
                {
                    text: 'Column',
                    commandName: 'InsertChartColumnCommandGroup',
                    items: [
                        { text: 'Clustered Column', commandName: 'InsertChartColumnClustered2D' },
                        { text: 'Stacked Column', commandName: 'InsertChartColumnStacked2D' },
                        { text: '100% Stacked Column', commandName: 'InsertChartColumnPercentStacked2D' },

                        { text: '3-D Clustered Column', commandName: 'InsertChartColumnClustered3D' },
                        { text: 'Stacked Column in 3-D', commandName: 'InsertChartColumnStacked3D' },
                        { text: '100% Stacked Column in 3-D', commandName: 'InsertChartColumnPercentStacked3D' },
                        { text: '3-D Column', commandName: 'InsertChartColumn3D' },

                        { text: 'Clustered Cylinder', commandName: 'InsertChartCylinderClustered' },
                        { text: 'Stacked Cylinder', commandName: 'InsertChartCylinderStacked' },
                        { text: '100% Stacked Cylinder', commandName: 'InsertChartCylinderPercentStacked' },
                        { text: '3-D Cylinder', commandName: 'InsertChartCylinder' },

                        { text: 'Clustered Cone', commandName: 'InsertChartConeClustered' },
                        { text: 'Stacked Cone', commandName: 'InsertChartConeStacked' },
                        { text: '100% Stacked Cone', commandName: 'InsertChartConePercentStacked' },
                        { text: '3-D Cone', commandName: 'InsertChartCone' },

                        { text: 'Clustered Pyramid', commandName: 'InsertChartPyramidClustered' },
                        { text: 'Stacked Pyramid', commandName: 'InsertChartPyramidStacked' },
                        { text: '100 % Stacked Pyramid', commandName: 'InsertChartPyramidPercentStacked' },
                        { text: '3-D Pyramid', commandName: 'InsertChartPyramid' }
                    ]
                },
                {
                    text: 'Line',
                    commandName: 'InsertChartLineCommandGroup',
                    items: [
                        { text: 'Line', commandName: 'InsertChartLine' },
                        { text: 'Stacked Line', commandName: 'InsertChartStackedLine' },
                        { text: '100% Stacked line', commandName: 'InsertChartPercentStackedLine' },
                        { text: 'Line with Markers', commandName: 'InsertChartLineWithMarkers' },
                        { text: 'Stacked Line with Markers', commandName: 'InsertChartStackedLineWithMarkers' },
                        { text: '100% Stacked Line with Markers', commandName: 'InsertChartPercentStackedLineWithMarkers' },
                        { text: '3-D Line', commandName: 'InsertChartLine3D' }
                    ],
                },
                {
                    text: 'Pie',
                    commandName: 'InsertChartPieCommandGroup',
                    items: [
                        { text: 'Pie', commandName: 'InsertChartPie2D' },
                        { text: 'Exploded Pie', commandName: 'InsertChartPieExploded2D' },
                        { text: 'Pie in 3-D', commandName: 'InsertChartPie3D' },
                        { text: 'Exploded pie in 3-D', commandName: 'InsertChartPieExploded3D' },
                    ],
                },
                {
                    text: 'Bar',
                    commandName: 'InsertChartBarCommandGroup',
                    items: [
                        { text: 'Clustered Bar', commandName: 'InsertChartBarClustered2D' },
                        { text: 'Stacked Bar', commandName: 'InsertChartBarStacked2D' },
                        { text: '100% Stacked Bar', commandName: 'InsertChartBarPercentStacked2D' },

                        { text: 'Clustered Bar in 3-D', commandName: 'InsertChartBarClustered3D' },
                        { text: 'Stacked Bar in 3-D', commandName: 'InsertChartBarStacked3D' },
                        { text: '100% Stacked Bar in 3-D', commandName: 'InsertChartBarPercentStacked3D' },

                        { text: 'Clustered Horizontal Cylinder', commandName: 'InsertChartHorizontalCylinderClustered' },
                        { text: 'Stacked Horizontal Cylinder', commandName: 'InsertChartHorizontalCylinderStacked' },
                        { text: '100% Stacked Horizontal Cylinder', commandName: 'InsertChartHorizontalCylinderPercentStacked' },

                        { text: 'Clustered Horizontal Cone', commandName: 'InsertChartHorizontalConeClustered' },
                        { text: 'Stacked Horizontal Cone', commandName: 'InsertChartHorizontalConeStacked' },
                        { text: '100% Stacked Horizontal Cone', commandName: 'InsertChartHorizontalConePercentStacked' },

                        { text: 'Clustered Horizontal Pyramid', commandName: 'InsertChartHorizontalPyramidClustered' },
                        { text: 'Stacked Horizontal Pyramid', commandName: 'InsertChartHorizontalPyramidStacked' },
                        { text: '100% Stacked Horizontal Pyramid', commandName: 'InsertChartHorizontalPyramidPercentStacked' }
                    ]
                },
                {
                    text: 'Area',
                    commandName: 'InsertChartAreaCommandGroup',
                    items: [
                        { text: 'Area', commandName: 'InsertChartArea' },
                        { text: 'Stacked Area', commandName: 'InsertChartStackedArea' },
                        { text: '100% Stacked Area', commandName: 'InsertChartPercentStackedArea' },

                        { text: '3-D Area', commandName: 'InsertChartArea3D' },
                        { text: 'Stacked Area in 3-D', commandName: 'InsertChartStackedArea3D' },
                        { text: '100% Stacked Area in 3-D', commandName: 'InsertChartPercentStackedArea3D' }
                    ]
                },
                {
                    text: 'Scatter',
                    commandName: 'InsertChartScatterCommandGroup',
                    items: [
                        { text: 'Scatter with only Markers', commandName: 'InsertChartScatterMarkers' },
                        { text: 'Scatter with Smooth Lines and Markers', commandName: 'InsertChartScatterSmoothLinesAndMarkers' },
                        { text: 'Scatter with Smooth Lines', commandName: 'InsertChartScatterSmoothLines' },
                        { text: 'Scatter with Straight Lines and Markers', commandName: 'InsertChartScatterLinesAndMarkers' },
                        { text: 'Scatter with Straight Lines', commandName: 'InsertChartScatterLines' },


                    ]
                },
                {
                    text: 'Stock',
                    commandName: 'InsertChartStockCommandGroup',
                    items: [
                        { text: 'High-Low-Close', commandName: 'InsertChartStockHighLowClose' },
                        { text: 'Open-High-Low-Close', commandName: 'InsertChartStockOpenHighLowClose' },
                        { text: 'Volume-High-Low-Close', commandName: 'InsertChartStockVolumeHighLowClose' },
                        { text: 'Volume-Open-High-Low-Close', commandName: 'InsertChartStockVolumeOpenHighLowClose' },
                    ]
                },
                {
                    text: 'Doughnut',
                    commandName: 'InsertChartDoughnut2DCommandGroup',
                    items: [
                        { text: 'Doughnut', commandName: 'InsertChartDoughnut2D' },
                        { text: 'Exploded Doughnut', commandName: 'InsertChartDoughnutExploded2D' }
                    ]
                },
                {
                    text: 'Bubble',
                    commandName: 'InsertChartBubbleCommandGroup',
                    items: [
                        { text: 'Bubble', commandName: 'InsertChartBubble' },
                        { text: 'Bubble with a 3-D effect', commandName: 'InsertChartBubble3D' }
                    ]
                },
                {
                    text: 'Radar',
                    commandName: 'InsertChartRadarCommandGroup',
                    items: [
                        { text: 'Radar', commandName: 'InsertChartRadar' },
                        { text: 'Radar with Markers', commandName: 'InsertChartRadarWithMarkers' },
                        { text: 'Filled Radar', commandName: 'InsertChartRadarFilled' }
                    ]
                }
            ];
            return formData;
        },
        
        getChartCategoriesListItemTemplate: function(data, index) {
            var listItemContainer = document.createElement('div'),
                listItemImage = DevExpress.AspNetCore.Spreadsheet.SvgStorage.createSvgItem(data.commandName);

            listItemContainer.className = this.getChartCategoryContainerClassName();

            var listItemText = document.createElement('span');
            listItemText.innerHTML = data.text;

            listItemContainer.appendChild(listItemImage);
            listItemContainer.appendChild(listItemText);

            return listItemContainer;
        },
        getChartTypeTileTemplate: function(itemData, itemIndex, itemElement) {
            var tileElementContainer = document.createElement('div');
            new DevExpress.ui.dxButton(tileElementContainer, {
                key: itemData.commandName,
                hint: itemData.text,
                width: '100%',
                height: '100%',
                type: 'normal',
                template: function(buttonData) {
                    var chartTypeImageContainer = document.createElement('div'),
                        chartTypeImage = DevExpress.AspNetCore.Spreadsheet.SvgStorage.createSvgItem(itemData.commandName);

                    chartTypeImageContainer.className = this.getChartTypeImageContainerClassName();
                    chartTypeImageContainer.appendChild(chartTypeImage);
                    return chartTypeImageContainer;
                }.aspxBind(this),
                onClick: function(e) {
                    this.setPressedButtonType('normal');
                    this.setPressedButton(e.component);
                    this.setPressedButtonType('success');
                }.aspxBind(this)
            });
            return tileElementContainer;
        },
        setPressedButtonType: function(type) {
            if(this.pressedButton)
                this.pressedButton.option('type', type);
        },
        setPressedButton: function(button) {
            this.pressedButton = button;
        },
        onChartCategoryChanged: function(e) {
            if(!this.form)
                return;
            if(e.addedItems.length > 0) {
                var editorInstance = this.form.getEditor('items');
                if(!editorInstance) return;
                editorInstance.option('items', this.getChildItemsByText(this.formData, e.addedItems[0].text));
                this.setPressedButtonType('normal');
                this.setPressedButton();
                this.popupDialog.repaint();
            }
        },
        onChartCategoriesListContentReady: function(e) {
            e.component.option('selectedItems', [this.formData[0]]);
        },
        getChildItemsByText: function(formData, text) {
            for(var i = 0; i < formData.length; i++)
                if(formData[i].text === text)
                    return formData[i].items;
            return [];
        },

        getCommandParams: function(formData) {
            if(this.pressedButton)
                return {
                    ChartType: ASPxClientSpreadsheet.ServerCommands.internalCommands[this.pressedButton.option('key')].id
                };
            return undefined;
        },
        dialogCompletedSuccessfully: function(dialogParams) {
            if(this.pressedButton)
                DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.dialogCompletedSuccessfully.call(this, dialogParams);
        }
    });
})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.ChartTitle = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {
        editorName: 'chartTitle',
        getFormOptions: function() {
            this.currentChartTitle = this.getChartTitle();
            return {
                items: [
                    {
                        dataField: this.editorName,
                        editorType: 'dxTextBox',
                        label: { text: 'Chart title' },
                        editorOptions: {
                            value: this.currentChartTitle
                        },
                        validationRules: [{
                            type: 'required',
                            message: 'The chart title must not be an empty string.'
                        }]
                    }]
            };
        },
        getTitle: function() {
            return 'Change Chart Title';
        },
        CreateDialogHelper: function() {
            return new DevExpress.AspNetCore.Spreadsheet.DialogHelpers.ChartDialogsHelper(this.ownerControl);
        },
        getEditorNameToAutofocus: function() {
            return this.editorName;
        },
        getChartTitle: function() {
            return this.GetDialogHelper().getChartTitle();
        },
        getCommandParams: function(formData) {
            return {
                ChartTitle: formData[this.editorName]
            };
        },
        dialogCompletedSuccessfully: function(dialogParams) {
            if(this.currentChartTitle !== dialogParams.ChartTitle)
                DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.dialogCompletedSuccessfully.call(this, dialogParams);
        }
    });
})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.ChartLayout = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {
        getFormOptions: function() {
            return {
                items: [
                    {
                        editorType: 'dxTileView',
                        label: { visible: false },
                        editorOptions: {
                            items: this.getFormData(),
                            itemTemplate: this.getChartLayoutTileTemplate.aspxBind(this),
                            direction: 'vertical',
                            baseItemWidth: 60,
                            baseItemHeight: 60,
                            itemMargin: 10,
                            height: '100%'
                        }
                    }
                ]
            };
        },
        getTitle: function() {
            return 'Change Chart Layout';
        },
        getFormData: function() {
            var formData = [];

            var chartLayoutPresetGroup = this.getChartLayoutPresetGroup(),
                chartLayoutPresets = this.getChartPresets();
            for(var i = 0; i < chartLayoutPresets.length && formData.length === 0; i++) {
                if(chartLayoutPresets[i].chartType === chartLayoutPresetGroup) {
                    for(var presetNumber = 1; presetNumber <= chartLayoutPresets[i].count; presetNumber++) {
                        var numberStr = '00' + presetNumber,
                            layoutPresetNumber = numberStr.substr(numberStr.length - 2);
                        formData.push({
                            chartLayoutPreset: 'ChartPreset' + chartLayoutPresets[i].chartType + layoutPresetNumber,
                            tooltip: 'Preset ' + layoutPresetNumber
                        });
                    }
                }
            }
            return formData;
        },
        getChartLayoutPresetGroup: function() {
            return this.GetDialogHelper().getChartLayoutPresetGroup();
        },
        getChartPresets: function() {
            return [
                { chartType: 'Area', count: 8 },
                { chartType: 'BarClustered', count: 10 },
                { chartType: 'BarStacked', count: 10 },
                { chartType: 'ColumnClustered', count: 11 },
                { chartType: 'ColumnStacked', count: 10 },
                { chartType: 'Doughnut', count: 7 },
                { chartType: 'Line', count: 12 },
                { chartType: 'Pie', count: 7 },
                { chartType: 'Radar', count: 4 },
                { chartType: 'Scatter', count: 11 },
                { chartType: 'Stock', count: 7 }
            ];
        },
        getChartLayoutTileTemplate: function(itemData, itemIndex, itemElement) {
            var tileElementContainer = document.createElement('div');
            new DevExpress.ui.dxButton(tileElementContainer, {
                key: itemData.chartLayoutPreset,
                hint: itemData.tooltip,
                width: '100%',
                height: '100%',
                type: 'normal',
                template: function(buttonData) {
                    var chartTypeImageContainer = document.createElement('div'),
                        chartTypeImage = DevExpress.AspNetCore.Spreadsheet.SvgStorage.createSvgItem(itemData.chartLayoutPreset);

                    chartTypeImageContainer.className = this.getChartLayoutPresetImageContainerClassName();
                    chartTypeImageContainer.appendChild(chartTypeImage);
                    return chartTypeImageContainer;
                }.aspxBind(this),
                onClick: function(e) {
                    this.setPressedButtonType('normal');
                    this.setPressedButton(e.component);
                    this.setPressedButtonType('success');
                }.aspxBind(this)
            });
            return tileElementContainer;
        },
        setPressedButtonType: function(type) {
            if(this.pressedButton)
                this.pressedButton.option('type', type);
        },
        setPressedButton: function(button) {
            this.pressedButton = button;
        },
        getChartLayoutPresetImageContainerClassName: function() {
            return 'dxss-chartLayoutPreset';
        },
        CreateDialogHelper: function() {
            return new DevExpress.AspNetCore.Spreadsheet.DialogHelpers.ChartDialogsHelper(this.ownerControl);
        },
        getCommandParams: function(formData) {
            if(this.pressedButton)
                return {
                    ChartLayoutPreset: this.pressedButton.option('key')
                };
            return undefined;
        },
        dialogCompletedSuccessfully: function(dialogParams) {
            if(this.pressedButton)
                DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.dialogCompletedSuccessfully.call(this, dialogParams);
        }
    });
})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.ChartSelectData = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {
        editorName: 'chartDataRange',
        CreateDialogHelper: function() {
            return new DevExpress.AspNetCore.Spreadsheet.DialogHelpers.ChartDialogsHelper(this.ownerControl, this);
        },
        getFormOptions: function() {
            this.formData = this.getFormData();
            return {
                formData: this.formData,
                items: [
                    {
                        dataField: this.editorName,
                        editorType: 'dxTextBox',
                        label: { text: 'Chart data source', location: 'left' },
                        validationRules: [{
                            type: 'required',
                            message: 'The chart data source not be an empty string.'
                        }]
                    }
                ]
            };
        },
        getTitle: function() {
            return 'Select Data Source';
        },
        isShadingDialog: function() {
            return false;
        },
        getFormData: function() {
            return {
                chartDataRange: this.GetDialogHelper().getChartDataRange()
            };
        },
        getChartDataRangeTextBox: function() {
            return this.form.getEditor(this.editorName);
        },
        getChartDataRangeTextBoxInputElement: function() {
            return this.getChartDataRangeTextBox().$element()[0].getElementsByTagName('input')[0];
        },
        setChartDataRangeTextBoxValue: function(value) {
            this.getChartDataRangeTextBox().option('value', value);
        },
        afterShowing: function() {
            DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.afterShowing.call(this);
            this.GetDialogHelper().prepareDialog(this.GetDialogHelper().getChartDataRange());
            this.GetDialogHelper().onShown();
        },
        getCommandParams: function(formData) {
            return {
                SelectionRange: this.getChartDataRangeTextBox().option('text'),
                ActiveSheetIndex: this.GetDialogHelper().getCachedChartSheetIndex()
            };
        },
        onHiding: function() {
            this.GetDialogHelper().onClose();
            DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.afterClosing.call(this);
        }
    });
})();

(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.ChartStyle = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {
        presetsCount: 48,

        getFormOptions: function() {
            return {
                scrollingEnabled: true,
                items: [
                    {
                        editorType: 'dxTileView',
                        label: { visible: false },
                        editorOptions: {
                            items: this.getFormData(),
                            itemTemplate: this.getChartStyleTileTemplate.aspxBind(this),
                            direction: 'vertical',
                            width: 1000,
                            baseItemWidth: 115,
                            baseItemHeight: 78,
                            itemMargin: 10
                        }
                    }
                ]
            };
        },
        getTitle: function() {
            return 'Change Chart Style';
        },
        beforeShowing: function() {
            DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.beforeShowing.call(this);
            this.executeCommand(ASPxClientSpreadsheet.ServerCommands.internalCommands.GetChartStyleSvgPreviewNCWebCommand.id, {});
        },
        getFormData: function() {
            var formData = [];
            for(var i = 1; i <= this.presetsCount; i++) {
                formData.push({ styleNumber: i });
            }
            return formData;
        },
        getChartStyleContainers: function() {
            if(!this.chartStyleContainers)
                this.chartStyleContainers = new Array(this.presetsCount);
            return this.chartStyleContainers;
        },
        getChartStyleTileTemplate: function(itemData, itemIndex, itemElement) {
            var tileElementContainer = document.createElement('div');
            var styleIndex = itemIndex + 1;
            new DevExpress.ui.dxButton(tileElementContainer, {
                key: styleIndex,
                hint: 'Style ' + styleIndex,
                width: '100%',
                height: '100%',
                type: 'normal',
                template: function(buttonData) {
                    if(!this.getChartStyleContainers()[styleIndex]) 
                        this.getChartStyleContainers()[styleIndex] = document.createElement('div');
                    return this.getChartStyleContainers()[styleIndex];
                }.aspxBind(this),
                onClick: function(e) {
                    this.setPressedButtonType('normal');
                    this.setPressedButton(e.component);
                    this.setPressedButtonType('success');
                }.aspxBind(this)
            });
            return tileElementContainer;
        },
        setPressedButtonType: function(type) {
            if(this.pressedButton)
                this.pressedButton.option('type', type);
        },
        setPressedButton: function(button) {
            this.pressedButton = button;
        },
        getChartStylePresetImageContainerClassName: function() {
            return 'dxss-chartStyle';
        },
        insertChartStylePreviewImages: function(svgImages) {
            for(var i = 0; i < svgImages.length; i++) {
                var presetNumber = parseInt(svgImages[i].attributes.id.value.substring(1));
                this.getChartStyleContainers()[presetNumber].appendChild(svgImages[i]);
            }
        },
        getCommandParams: function(formData) {
            if(this.pressedButton)
                return {
                    ChartPresetStyle: this.pressedButton.option('key')
                };
        },
        dialogCompletedSuccessfully: function(dialogParams) {
            if(this.pressedButton)
                DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.dialogCompletedSuccessfully.call(this, dialogParams);
        },
        afterClosing: function() {
            DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.afterClosing.call(this);
            this.getOwnerControl().onChartStyleDialogClosed();
        }
    });
})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.ChartHorizontalAxisTitle = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {
        editorName: 'horizontalAxisTitle',
        getFormOptions: function() {
            this.horizontalAxisTitle = this.getChartHorizontalAxisTitle();
            return {
                items: [
                    {
                        dataField: this.editorName,
                        editorType: 'dxTextBox',
                        label: { text: 'Horizontal axis title' },
                        editorOptions: {
                            value: this.horizontalAxisTitle
                        },
                        validationRules: [{
                            type: 'required',
                            message: 'The chart horizontal axis title must not be an empty string.'
                        }]
                    }]
            };
        },
        getTitle: function() {
            return 'Change Horizontal Axis Title';
        },
        CreateDialogHelper: function() {
            return new DevExpress.AspNetCore.Spreadsheet.DialogHelpers.ChartDialogsHelper(this.ownerControl);
        },
        getEditorNameToAutofocus: function() {
            return this.editorName;
        },
        getChartHorizontalAxisTitle: function() {
            return this.GetDialogHelper().getChartHorizontalAxisTitle();
        },
        getCommandParams: function(formData) {
            return {
                ChartHorizontalAxisTitle: formData[this.editorName]
            };
        },
        dialogCompletedSuccessfully: function(dialogParams) {
            if(this.horizontalAxisTitle !== dialogParams.ChartHorizontalAxisTitle)
                DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.dialogCompletedSuccessfully.call(this, dialogParams);
        }
    });
})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.ChartVerticalAxisTitle = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {
        editorName: 'verticalAxisTitle',
        getFormOptions: function() {
            this.verticalAxisTitle = this.getChartVerticalAxisTitle();
            return {
                items: [
                    {
                        dataField: this.editorName,
                        editorType: 'dxTextBox',
                        label: { text: 'Vertical axis title' },
                        editorOptions: {
                            value: this.verticalAxisTitle
                        },
                        validationRules: [{
                            type: 'required',
                            message: 'The chart vertical axis title must not be an empty string.'
                        }]
                    }]
            };
        },
        getTitle: function() {
            return 'Change Vertical Axis Title';
        },
        CreateDialogHelper: function() {
            return new DevExpress.AspNetCore.Spreadsheet.DialogHelpers.ChartDialogsHelper(this.ownerControl);
        },
        getEditorNameToAutofocus: function() {
            return this.editorName;
        },
        getChartVerticalAxisTitle: function() {
            return this.GetDialogHelper().getChartVerticalAxisTitle();
        },
        getCommandParams: function(formData) {
            return {
                ChartVerticalAxisTitle: formData[this.editorName]
            };
        },
        dialogCompletedSuccessfully: function(dialogParams) {
            if(this.verticalAxisTitle !== dialogParams.ChartVerticalAxisTitle)
                DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.dialogCompletedSuccessfully.call(this, dialogParams);
        }
    });
})();
(function() {
    
    DevExpress.AspNetCore.Spreadsheet.Dialogs.RenameSheet = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {
        editorName: 'sheetName',
        getFormOptions: function() {
            return {
                validationGroup: 'ssFormGroup',
                items: [
                    {
                        dataField: this.editorName,
                        editorType: 'dxTextBox',
                        label: { text: 'Sheet name' },
                        editorOptions: {
                            value: this.getActiveSheetName()
                        },
                        validationRules: [{
                            type: 'required',
                            message: 'The worksheet name must not be an empty string.'
                        },
                        {
                            type: 'custom',
                            validationCallback: this.validateSheetName.aspxBind(this),
                            message: ''
                        }]
                    }]
            };
        },
        getTitle: function() {
            return 'Rename Sheet';
        },
        getEditorNameToAutofocus: function() {
            return this.editorName;
        },
        CreateDialogHelper: function() {
            return new DevExpress.AspNetCore.Spreadsheet.DialogHelpers.RenameSheetDialogHelper(this.ownerControl);
        },
        getActiveSheetName: function() {
            return this.getOwnerControl().getDocumentModel().getActiveSheetName();
        },
        beforeShowing: function() {
            DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.beforeShowing.call(this);

            this.currentSheetName = this.getActiveSheetName();
        },
        validateSheetName: function(e) {
            var dialogHelper = this.GetDialogHelper(),
                errorType = dialogHelper.validate(e.value),
                isValid = true;

            if(errorType !== dialogHelper.WorksheetNameError.None) {
                isValid = false;
                e.rule.message = this.getErrorMessageByType(dialogHelper, errorType);
            }

            return isValid;
        },

        getErrorMessageByType: function(dialogHelper, errorType) {
            if(errorType === dialogHelper.WorksheetNameError.ContainsProhibitedCharacters)
                return 'The worksheet name must not contain the following symbols: \\ / ? : * [ or ]';
            if(errorType === dialogHelper.WorksheetNameError.ExceedAllowedLength)
                return 'The worksheet name must not exceed 31 characters.';
            if(errorType === dialogHelper.WorksheetNameError.Duplicate)
                return 'Cannot rename a sheet to the same name as existing sheet.';
            if(errorType === dialogHelper.WorksheetNameError.StartOrEndWithSingleQuote)
                return 'The worksheet name must not start and end with a single quote (\').';
        },
        getCommandParams: function(formData) {
            return { NewName: formData[this.editorName] };
        },
        dialogCompletedSuccessfully: function(dialogParams) {
            if(this.currentSheetName !== dialogParams.NewName)
                DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.dialogCompletedSuccessfully.call(this, dialogParams);
        }        
    });
   
})();
(function() {

    DevExpress.AspNetCore.Spreadsheet.Dialogs.UnhideSheet = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {
        getFormOptions: function() {
            var that = this;
            return {
                validationGroup: 'ssFormGroup',
                items: [
                    {
                        label: { text: 'Unhide sheet', location: 'top' },
                        template: function() {
                            var element = document.createElement('div');
                            that.unhideSheetList = new DevExpress.ui.dxList(element, {
                                height: 200,
                                noDataText: '',
                                selectionMode: 'single',
                                 onContentReady: function(e) {
                                    e.component.registerKeyHandler('escape', this.onEscape.aspxBind(this));
                                }.aspxBind(that)
                            });
                            return element;
                        }
                    }
                ]
            };
        },
        getTitle: function() {
            return 'Unhide';
        },

        onFocus: function() {
            this.unhideSheetList.focus();
        },
        afterShowing: function() {
            DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.afterShowing.call(this);

            var hiddenSheets = this.getOwnerControl().getDocumentModel().getHiddenSheets(),
                items = [];
            if(hiddenSheets.length > 0) {
                for(var index = 0; index < hiddenSheets.length; index++) {
                    items.push(hiddenSheets[index].Name);
                }
                this.unhideSheetList.option('items', items);
                this.unhideSheetList.selectItem(0);
            }            
        },

        getCommandParams: function(formData) {
            var selectedItems = this.unhideSheetList.option('selectedItemKeys');
            return { SheetName: selectedItems[0] };
        }
    });
})();
(function() {

    DevExpress.AspNetCore.Spreadsheet.Dialogs.MoveOrCopySheet = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {
        getFormOptions: function() {
            var that = this;
            return {
                validationGroup: 'ssFormGroup',
                items: [
                    {
                        label: { text: 'Move selected sheets before sheet', location: 'top' },
                        template: function() {
                            var element = document.createElement('div');
                            that.beforeSheetList = new DevExpress.ui.dxList(element, {
                                height: 200,
                                noDataText: '',
                                selectionMode: 'single',
                                keyExpr: 'index'
                            });
                            return element;
                        }
                    },
                    {
                        dataField: 'cbCreateCopy',
                        editorType: 'dxCheckBox',
                        label: { visible: false },
                        editorOptions: {
                            value: false,
                            text: 'Create a copy'
                        }
                    }
                ]
            };
        },
        getTitle: function() {
            return 'Move or Copy';
        },
        onFocus: function() {
            this.beforeSheetList.focus();
        },
        afterShowing: function() {
            DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.afterShowing.call(this);

            var visibleSheets = this.getOwnerControl().getDocumentModel().getVisibleSheets(),
                items = [];
            if(visibleSheets.length > 0) {
                for(var index = 0; index < visibleSheets.length; index++) {
                    items.push({ html: visibleSheets[index].Name, index: index });
                }
                items.push({ html: '(move to end)', index: visibleSheets.length });
                this.beforeSheetList.option('items', items);
                this.beforeSheetList.selectItem(0);
            }            
        },

        getCommandParams: function(formData) {
            var selectedItems = this.beforeSheetList.option('selectedItemKeys');
            return { BeforeVisibleSheetIndex: selectedItems[0], CreateCopy: formData.cbCreateCopy };
        }
    });
})();
(function() {
    
    DevExpress.AspNetCore.Spreadsheet.Dialogs.ColumnWidth = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {

        editorName: 'columnWidth',
        validRange: { min: 0, max: 1785 },

        getFormOptions: function() {
            return {
                items: [{
                    dataField: this.editorName,
                    editorType: 'dxNumberBox',
                    label: { text: 'Column Width, px' },
                    editorOptions: {
                        showSpinButtons: true,
                        value: this.geCurrentColumnWidth(),
                        min: this.validRange.min,
                        max: this.validRange.max
                    }
                }]
            };
        },

        getTitle: function() {
            return 'Column Width';
        },
        getEditorNameToAutofocus: function() {
            return this.editorName;
        },
        geCurrentColumnWidth: function() {
            return this.getOwnerControl().getActiveCellSize(true);
        },
        getCommandParams: function(formData) {
            return { ColumnWidth: formData[this.editorName] };
        },
        dialogCompletedSuccessfully: function(dialogParams) {
            if(dialogParams.ColumnWidth !== this.geCurrentColumnWidth())
                DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.dialogCompletedSuccessfully.call(this, dialogParams);
        }        
    });
   
})();
(function() {
    
    DevExpress.AspNetCore.Spreadsheet.Dialogs.ColumnWidthDefault = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {

        editorName: 'defaultColumnWidth',
        validRange: { min: 0, max: 1785 },

        getFormOptions: function() {
            return {
                items: [{
                    dataField: this.editorName,
                    editorType: 'dxNumberBox',
                    label: { text: 'Standard Column Width, px' },
                    editorOptions: {
                        showSpinButtons: true,
                        value: this.geCurrentColumnWidth(),
                        min: this.validRange.min,
                        max: this.validRange.max,
                    }
                }]
            };
        },

        getTitle: function() {
            return 'Standard Width';
        },
        getEditorNameToAutofocus: function() {
            return this.editorName;
        },
        geCurrentColumnWidth: function() {
            return this.getOwnerControl().getDefaultCellSize().width;
        },
        getCommandParams: function(formData) {
            return { DefaultColumnWidth: formData[this.editorName] };
        },
        dialogCompletedSuccessfully: function(dialogParams) {
            if(dialogParams.DefaultColumnWidth !== this.geCurrentColumnWidth())
                DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.dialogCompletedSuccessfully.call(this, dialogParams);
        }        
    });
   
})();
(function() {
    
    DevExpress.AspNetCore.Spreadsheet.Dialogs.RowHeight = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {

        editorName: 'rowHeight',
        validRange: { min: 0, max: 546 },

        getFormOptions: function() {
            return {
                items: [{
                    dataField: this.editorName,
                    editorType: 'dxNumberBox',
                    label: { text: 'Row Height, px' },
                    editorOptions: {
                        showSpinButtons: true,
                        value: this.geCurrentRowHeight(),
                        min: this.validRange.min,
                        max: this.validRange.max
                    }
                }]
            };
        },

        getTitle: function() {
            return 'Row Height';
        },
        getEditorNameToAutofocus: function() {
            return this.editorName;
        },
        geCurrentRowHeight: function() {
            return this.getOwnerControl().getActiveCellSize(false);
        },
        getCommandParams: function(formData) {
            return { RowHeight: formData[this.editorName] };
        },
        dialogCompletedSuccessfully: function(dialogParams) {
            if(dialogParams.RowHeight !== this.geCurrentRowHeight())
                DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.dialogCompletedSuccessfully.call(this, dialogParams);
        }        
    });
   
})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.InsertPicture = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {
        CreateDialogHelper: function() {
            return new DevExpress.AspNetCore.Spreadsheet.DialogHelpers.InsertPictureDialogHelper(this.ownerControl, this.getDialogFormElement());
        },
        imageAddressEditorName: 'imageWebAddress',
        uploadTypes: ['From the web (URL)', 'From your computer'],
        getTitle: function() {
            return 'Insert Picture';
        },
        getFormOptions: function() {
            this.formData = this.getFormData();
            return {
                colCount: 1,
                formData: this.formData,
                items: [
                    {
                        dataField: 'uploadType',
                        editorType: 'dxRadioGroup',
                        label: { visible: false },
                        editorOptions: {
                            items: this.uploadTypes,
                            layout: 'horizontal',
                            onValueChanged: function(e) {
                                this.updateEditorsVisibility(e.value === this.uploadTypes[1]);
                                this.popupDialog.repaint();
                            }.aspxBind(this)
                        }
                    },
                    {
                        dataField: this.imageAddressEditorName,
                        label: { text: 'Enter image web address', location: 'top' },
                        visible: true,
                        validationRules: [{
                            type: 'required'
                        }],
                        editorOptions: {
                            placeholder: 'http://',
                            onValueChanged: function(e) {
                                this.GetDialogHelper().checkImageExisting(e.value, this.onImageLoad.aspxBind(this), this.onImageError.aspxBind(this));
                            }.aspxBind(this)

                        }
                    },
                    {
                        name: 'imagePreview',
                        visible: true,
                        template: function(data, itemElement) {
                            var previewCell = document.createElement('div'),
                                previewText = document.createElement('span'),
                                previewImage = document.createElement('img');
                            previewCell.className = 'dxss-imagePreviewCell';
                            previewText.className = 'dxss-imagePreviewText';
                            previewText.innerHTML = 'Image preview';
                            previewImage.className = 'dxss-previewImage';
                            previewImage.alt = 'Image preview';
                            previewImage.style.display = 'none';

                            previewCell.appendChild(previewText);
                            previewCell.appendChild(previewImage);
                            return previewCell;
                        }
                    },
                    {
                        name: 'imageUploader',
                        visible: false,
                        template: function(data, itemElement) {
                            var uploaderElement = document.createElement('div');
                            uploaderElement.className = 'dxss-insertPictureUploader';
                            this.fileUploader = new DevExpress.ui.dxFileUploader(uploaderElement, {
                                selectButtonText: 'Browse...',
                                accept: 'image/*',
                                uploadMode: 'useButtons',
                                onValueChanged: function(e) {
                                    this.popupDialog.repaint();
                                    this.file = e.value[0];
                                }.aspxBind(this)
                            });
                            return uploaderElement;
                        }.aspxBind(this),
                        validationRules: [{
                            type: 'required'
                        }]
                    }
                ]
            };
        },
        onShowing: function() {
            this.fixDialogHeight();
        },
        fixDialogHeight: function() {
            var height = this.getDialogFormElement().offsetHeight;
            this.form.option('height', height);
        },
        onImageLoad: function() {
            if(this.isPreviewAreaCellVisible())
                this.GetDialogHelper().onLoadTestExistingImage();
        },
        onImageError: function() {
            if(this.isPreviewAreaCellVisible())
                this.GetDialogHelper().onErrorTestExistingImage();
        },
        getFormData: function() {
            return {
                uploadType: this.uploadTypes[0]
            };
        },
        getEditorNameToAutofocus: function() {
            return this.imageAddressEditorName;
        },
        isPreviewAreaCellVisible: function() {
            var element = this.GetDialogHelper().getPreviewAreaCell();
            return element && element.offsetParent;
        },
        updateEditorsVisibility: function(isFromYourComputer) {
            this.form.beginUpdate();
            this.form.itemOption('imageWebAddress', 'visible', !isFromYourComputer);
            this.form.itemOption('imagePreview', 'visible', !isFromYourComputer);
            this.form.itemOption('imageUploader', 'visible', isFromYourComputer);
            this.form.endUpdate();
        },
        applyParameters: function() {
            if(this.form.option('formData').uploadType === this.uploadTypes[1]) {
                var formData = new FormData();
                formData.append('ssImage', this.file);
                this.executeCommand(ASPxClientSpreadsheet.ServerCommands.internalCommands.InsertPictureNCWebCommand.id, formData);
            } else {
                var pictureUrl = this.form.option('formData').imageWebAddress;
                if(pictureUrl)
                    this.executeCommand(ASPxClientSpreadsheet.ServerCommands.internalCommands.InsertPictureNCWebCommand.id, { PictureUrl: pictureUrl });
            }
        }
    });
})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.InsertTable = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {
        CreateDialogHelper: function() {
            return new DevExpress.AspNetCore.Spreadsheet.DialogHelpers.InsertTableDialogHelper(this.ownerControl, this);
        },
        editorName: 'range',
        getFormOptions: function() {
            this.formData = this.getFormData();
            return {
                formData: this.formData,
                items: [
                    {
                        dataField: this.editorName,
                        label: { text: 'Where is the data for your table?', location: 'top', showColon: false }
                    },
                    {
                        dataField: 'hasHeaders',
                        label: { visible: false },
                        editorOptions: {
                            text: 'My table has headers'
                        }
                    }
                ]
            };
        },
        getFormData: function() {
            return {
                range: '',
                hasHeaders: false
            };
        },
        getEditorNameToAutofocus: function() {
            return this.editorName;
        },
        isShadingDialog: function() {
            return false;
        },
        getTitle: function() {
            return 'Create Table';
        },
        getTableRangeTextBox: function() {
            return this.form.getEditor('range');
        },
        getTableRangeTextBoxInputElement: function() {
            return this.getTableRangeTextBox().$element()[0].getElementsByTagName('input')[0];
        },
        afterShowing: function() {
            DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.afterShowing.call(this);
            var tableRangeTextBox = this.getTableRangeTextBox(),
                rangeText = this.GetDialogHelper().getInitialRange();

            tableRangeTextBox.option('value', '=' + rangeText);
            this.GetDialogHelper().initDynamicSelection(this.getTableRangeTextBoxInputElement());
            this.GetDialogHelper().onShown();
        },
        getCommandParams: function(formData) {
            return {
                SelectedRange: this.getTableRangeTextBox().option('text'),
                HasHeaders: formData.hasHeaders
            };
        },
        onHiding: function() {
            this.GetDialogHelper().onClose();
            DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.afterClosing.call(this);
        }
    });
})();

(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.ModifyTableStyle = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {
        getFormOptions: function() {
            this.formData = this.getFormData();
            return {
                colCount: 5,
                items: [
                    {
                        editorType: 'dxList',
                        editorOptions: {
                            dataSource: this.formData,
                            selectionMode: 'single',
                            width: 'auto',
                            onSelectionChanged: this.onTableStyleChanged.aspxBind(this),
                            onContentReady: this.onTableStyleListContentReady.aspxBind(this)
                        }
                    },
                    {
                        editorType: 'dxTileView',
                        dataField: 'items',
                        colSpan: 4,
                        label: { visible: false },
                        editorOptions: {
                            items: this.formData[0].items,
                            itemTemplate: this.getTableStyleTemplate.aspxBind(this),
                            direction: 'vertical',
                            baseItemWidth: 108,
                            baseItemHeight: 84,
                            itemMargin: 10,
                            height: 580,
                            onInitialized: function(e) {
                                var popupDefaultMinHeight = 880;
                                if(window.innerHeight < popupDefaultMinHeight) {
                                    e.component.option('height', window.innerHeight - 300);
                                }
                            }
                        }
                    }
                ]
            };
        },
        getTitle: function() {
            return 'Change Table Style';
        },
        getMaxWidth: function() {
            return 800;
        },
        getFormData: function() {
            var result = [];
            result.push(this.createStyleSet('Light', 21, true));
            result.push(this.createStyleSet('Medium', 28, false));
            result.push(this.createStyleSet('Dark', 11, false));
            return result;
        },
        createStyleSet: function(name, lastIndex, addNone) {
            var styleSet = { text: name, items: [] },
                suffix = '_ts';
            if(addNone) {
                styleSet.items.push({
                    styleName: 'None',
                    title: 'None',
                    svgImage: this.getOwnerControl().name + suffix + name + 'None'
                });
            }
            for(var i = 1; i <= lastIndex; i++) {
                styleSet.items.push({
                    styleName: 'TableStyle' + name + i,
                    title: 'Table Style ' + name + ' ' + i,
                    svgImage: this.getOwnerControl().name + suffix + name + (i - 1)
                });
            }
            return styleSet;
        },

        getTableStyleTemplate: function(itemData, itemIndex, itemElement) {
            var tileElementContainer = document.createElement('div');
            new DevExpress.ui.dxButton(tileElementContainer, {
                key: itemData.styleName,
                hint: itemData.title,
                elementAttr: {
                    class: 'dxss-tableStyleButton'
                },
                width: '100%',
                height: '100%',
                type: 'normal',
                template: function(buttonData) {
                    var tableTypeImageContainer = document.createElement('div'),
                        tableTypeImage = DevExpress.AspNetCore.Spreadsheet.SvgStorage.createSvgItem(itemData.svgImage);

                    tableTypeImageContainer.className = 'dxss-tableStyle';
                    tableTypeImageContainer.appendChild(tableTypeImage);
                    return tableTypeImageContainer;
                }.aspxBind(this),
                onClick: function(e) {
                    this.setPressedButtonType('normal');
                    this.setPressedButton(e.component);
                    this.setPressedButtonType('success');
                    this.setSelectedTableStyle(e.component.option('key'));
                }.aspxBind(this)
            });
            return tileElementContainer;

        },
        setPressedButtonType: function(type) {
            if(this.pressedButton)
                this.pressedButton.option('type', type);
        },
        setPressedButton: function(button) {
            this.pressedButton = button;
        },
        beforeShowing: function() {
            DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.beforeShowing.call(this);
            this.executeCommand(ASPxClientSpreadsheet.ServerCommands.internalCommands.GetTableSvgPreviewNCWebCommand.id, {});
        },
        onTableStyleChanged: function(e) {
            if(!this.form)
                return;
            var editorInstance = this.form.getEditor('items');
            if(editorInstance)
                editorInstance.option('items', e.addedItems[0].items);
            this.popupDialog.repaint();
        },
        onTableStyleListContentReady: function(e) {
            e.component.option('selectedItems', [this.formData[0]]);
        },
        setSelectedTableStyle: function(tableStyle) {
            this.tableStyle = tableStyle;
        },
        getTableStyle: function() {
            return this.tableStyle;
        },
        dialogCompletedSuccessfully: function(dialogParams) {
            var styleName = this.getTableStyle();
            if(styleName)
                DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.dialogCompletedSuccessfully.call(this, { StyleName: styleName });
        }
    });
})();

(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.FormatAsTable = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.ModifyTableStyle, {
        getTitle: function() {
            return 'Select Table Style';
        },
        selectionHasTable: function() {
            return this.getOwnerControl().getRibbonManager().isSelectionWithinAnyTable;
        },
        dialogCompletedSuccessfully: function(dialogParams) {
            var styleName = this.getTableStyle();
            if(!styleName)
                return;

            this.getOwnerControl()._tableStyleValue = styleName;
            if(this.selectionHasTable())
                DevExpress.AspNetCore.Spreadsheet.Dialogs.ModifyTableStyle.prototype.dialogCompletedSuccessfully.call(this, dialogParams);
            else
                this.getOwnerControl().onUICommand(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName('InsertTableWithStyle').id);
        }
    });
})();

(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.InsertTableWithStyle = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.InsertTable, {
        getAndResetTableStyleValue: function() {
            var value = this.getOwnerControl()._tableStyleValue || '';
            this.getOwnerControl()._tableStyleValue = null;
            return value;
        },
        getCommandParams: function(formData) {
            var params = DevExpress.AspNetCore.Spreadsheet.Dialogs.InsertTable.prototype.getCommandParams.call(this, formData);
            params.TableStyle = this.getAndResetTableStyleValue();
            return params;
        }
    });
})();

(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.AutoFilterDialogBase = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {
        CreateDialogHelper: function() {
            return new DevExpress.AspNetCore.Spreadsheet.DialogHelpers.AutoFilterDialogsHelper(this.ownerControl);
        },
        getCommandId: function() {
            return ASPxClientSpreadsheet.ServerCommands.internalCommands.ApplyAutoFilter.id;
        },
        getCommandParams: function(formData) {
            return {
                filterCommandId: this.commandId,
                ViewModel: this.GetDialogHelper().prepareViewModel(this.getViewModel())
            };
        }
    });
})();

(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.DataFilterSimple = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.AutoFilterDialogBase, {
        getTitle: function() {
            return 'AutoFilter';
        },
        getFormOptions: function() {
            return {
                items: [{
                    dataField: 'filterValues',
                    editorType: 'dxTreeView',
                    label: { visible: false },
                    editorOptions: {
                        showCheckBoxesMode: 'normal',
                        selectedExpr: 'Checked',
                        displayExpr: 'Text',
                        keyExpr: 'Id',
                        expandedExpr: 'Expanded',
                        itemsExpr: 'Children',
                        height: 400,
                        onItemSelectionChanged: function(e) {
                            this.onItemSelectionChanged(e.node);
                        }.aspxBind(this)
                    }
                }]
            };
        },
        beforeShowing: function() {
            DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.beforeShowing.call(this);
            this.executeCommand(ASPxClientSpreadsheet.ServerCommands.internalCommands.GetTableColumnValuesNCWebCommand.id, {});
        },
        updateItems: function(items) {
            this.filterItems = JSON.parse(items.replace(/'([a-zA-Z]+)':/g, '"$1":').replace(/:'(.+?)'((?:,")|(?:}))/g, ':"$1"$2'));
            this.decodeProperties(this.filterItems);
            var dataSource = new DevExpress.data.DataSource({
                store: {
                    type: 'array',
                    data: this.filterItems
                }
            });
            this.form.getEditor('filterValues').option('dataSource', dataSource);
        },
        decodeProperties: function(items) {
            for(var i = 0; i < items.length; i++) {
                items[i].Text = ASPx.Str.DecodeHtmlViaTextArea(items[i].Text);
                if(items[i].Children)
                    this.decodeProperties(items[i].Children);
            }
        },
        getViewModel: function() {
            return this.GetDialogHelper().getCheckedNodes({ Children: this.filterItems });
        },
        onItemSelectionChanged: function(node) {
            var topLevelNode = node;
            while(topLevelNode.parent)
                topLevelNode = topLevelNode.parent;
            var dataSourceNode = null;
            for(var i = 0; i < this.filterItems.length && !dataSourceNode; i++)
                if(this.filterItems[i].Id === topLevelNode.key)
                    dataSourceNode = this.filterItems[i];
            this.updateDataSourceCheckedState(dataSourceNode, topLevelNode);
            this.setOkButtonEnabledState(this.GetDialogHelper().hasCheckedItems({ Children: this.filterItems }));
        },
        updateDataSourceCheckedState: function(dataSourceRootNode, treeViewRootNode) {
            dataSourceRootNode.Checked = treeViewRootNode.selected;
            for(var i = 0; i < treeViewRootNode.children.length; i++)
                this.updateDataSourceCheckedState(dataSourceRootNode.Children[i], treeViewRootNode.children[i]);
        },
        setOkButtonEnabledState: function(enabled) {
            if(this.okButton)
                this.okButton.option('disabled', !enabled);
        }
    });
})();

(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomAutoFilterDialogBase = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.AutoFilterDialogBase, {
        getTitle: function() {
            return 'Custom AutoFilter';
        },
        beforeShowing: function() {
            DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.beforeShowing.call(this);
            this.getOwnerControl().fetchAutoFilterViewModelFromDialog(this);
        }
    });
})();

(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomDataFilter = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomAutoFilterDialogBase, {
        getFormOptions: function() {
            return {
                colCount: 2,
                items: [
                    {
                        label: { text: 'Show rows where' },
                        colSpan: 2,
                        template: function(data) {
                            return null;
                        }
                    },
                    {
                        editorType: 'dxSelectBox',
                        dataField: 'FirstFilterOperator',
                        label: { visible: false },
                        editorOptions: {
                            displayExpr: 'Text',
                            valueExpr: 'Value'
                        }
                    },
                    this.getFirstFilterValueEditorOptions(),
                    {
                        editorType: 'dxRadioGroup',
                        dataField: 'CriterionAnd',
                        colSpan: 2,
                        label: { visible: false },
                        editorOptions: {
                            dataSource: [
                                { value: true, text: 'And' },
                                { value: false, text: 'Or' }
                            ],
                            textExp: 'text',
                            valueExpr: 'value',
                            layout: 'horizontal'
                        }
                    },
                    {
                        editorType: 'dxSelectBox',
                        dataField: 'SecondFilterOperator',
                        label: { visible: false },
                        editorOptions: {
                            displayExpr: 'Text',
                            valueExpr: 'Value'
                        }
                    },
                    this.getSecondFilterValueEditorOptions(),
                    {
                        label: { text: 'Use ? to represent any single character', showColon: false },
                        colSpan: 2,
                        template: function(data) {
                            return null;
                        }
                    },
                    {
                        label: { text: 'Use * to represent any series of characters', showColon: false },
                        colSpan: 2,
                        template: function(data) {
                            return null;
                        }
                    }
                ]
            };
        },
        getFirstFilterValueEditorOptions: function() {
            return {
                editorType: 'dxSelectBox',
                dataField: 'FirstFilterValue',
                label: { visible: false },
                editorOptions: {
                    acceptCustomValue: true
                }
            };
        },
        getSecondFilterValueEditorOptions: function() {
            return {
                editorType: 'dxSelectBox',
                dataField: 'SecondFilterValue',
                label: { visible: false },
                editorOptions: {
                    acceptCustomValue: true
                }
            };
        },
        OnViewModelReceived: function(viewModel) {
            this.form.option('formData', viewModel);
            this.form.getEditor('FirstFilterOperator').option('dataSource', viewModel.FilterOperatorsDataSource);
            this.form.getEditor('SecondFilterOperator').option('dataSource', viewModel.FilterOperatorsDataSource);
            this.getFirstFilterValueEditor().option('dataSource', viewModel.UniqueFilterValues);
            this.getSecondFilterValueEditor().option('dataSource', viewModel.UniqueFilterValues);
            this.getFirstFilterValueEditor().option('value', viewModel.FirstFilterValue);
            this.getSecondFilterValueEditor().option('value', viewModel.SecondFilterValue);
        },
        getFirstFilterValueEditor: function() {
            return this.form.getEditor('FirstFilterValue');
        },
        getSecondFilterValueEditor: function() {
            return this.form.getEditor('SecondFilterValue');
        },        
        getViewModel: function() {
            var viewModel = {
                CriterionAnd: this.form.getEditor('CriterionAnd').option('value'),
                FirstFilterValue: this.getFirstFilterValueEditor().option('value'),
                FirstFilterOperator: this.form.getEditor('FirstFilterOperator').option('value')
            };
            var secondFilterOperator = this.form.getEditor('SecondFilterOperator').option('value');
            if(secondFilterOperator !== 'None')
                viewModel.SecondFilterOperator = secondFilterOperator;
            var secondFilterValue = this.getSecondFilterValueEditor().option('value');
            if(secondFilterValue)
                viewModel.SecondFilterValue = secondFilterValue;
            return viewModel;
        }
    });
})();

(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomDateTimeFilter = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomDataFilter, {
        getFirstFilterValueEditorOptions: function() {
            return {
                dataField: 'FirstFilterValue',
                label: { visible: false },
                template: this.getDateCellTemplate.aspxBind(this)
            };
        },
        getSecondFilterValueEditorOptions: function() {
            return {
                dataField: 'SecondFilterValue',
                label: { visible: false },
                template: this.getDateCellTemplate.aspxBind(this)
            };
        },
        getDateCellTemplate: function(data) {
            var container = document.createElement('div');
            container.className = 'dxss-date-container';
            var selectBoxContainer = document.createElement('div');
            this[data.dataField] = new DevExpress.ui.dxSelectBox(selectBoxContainer, {
                acceptCustomValue: true
            });
            var dateBoxContainer = document.createElement('div');
            dateBoxContainer.className = 'dxss-date-box';
            new DevExpress.ui.dxDateBox(dateBoxContainer, {
                onValueChanged: function(e) {
                    this[data.dataField].option('value', this.GetDialogHelper().getFormattedDate(e.value));
                }.aspxBind(this)
            });

            container.appendChild(selectBoxContainer);
            container.appendChild(dateBoxContainer);
            return container;
        },
        getFirstFilterValueEditor: function() {
            return this.FirstFilterValue;
        },
        getSecondFilterValueEditor: function() {
            return this.SecondFilterValue;
        },
    });
})();

(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.DataFilterTop10 = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.CustomAutoFilterDialogBase, {
        validFilterValueRange: { min: 0, max: 500 },

        getFormOptions: function() {
            return {
                colCount: 3,
                items: [
                    {
                        label: { text: 'Show' },
                        colSpan: 3,
                        template: function(data) {
                            return null;
                        }
                    },
                    {
                        editorType: 'dxSelectBox',
                        dataField: 'IsTop',
                        label: { visible: false },
                        editorOptions: {
                            displayExpr: 'Text',
                            valueExpr: 'Value'
                        }
                    },
                    {
                        editorType: 'dxNumberBox',
                        dataField: 'Value',
                        label: { visible: false },
                        editorOptions: {
                            showSpinButtons: true,
                            min: this.validFilterValueRange.min,
                            max: this.validFilterValueRange.max
                        },
                        validationRules: [{
                            type: 'required',
                            message: ''
                        }]
                    },
                    {
                        editorType: 'dxSelectBox',
                        dataField: 'IsPercent',
                        label: { visible: false },
                        editorOptions: {
                            displayExpr: 'Text',
                            valueExpr: 'Value'
                        }
                    }]
            };
        },
        OnViewModelReceived: function(viewModel) {
            this.form.option('formData', viewModel);
            this.form.getEditor('IsTop').option('dataSource', viewModel.OrderDataSource);
            this.form.getEditor('IsPercent').option('dataSource', viewModel.TypeDataSource);
        },
        getViewModel: function() {
            var formData = this.form.option('formData');
            return {
                IsTop: formData.IsTop,
                Value: formData.Value,
                IsPercent: formData.IsPercent
            };
        }
    });
})();

(function() {

    DevExpress.AspNetCore.Spreadsheet.Dialogs.FindAndReplace = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {
        editorName: 'findWhat',
        getSearchByDataSource: function() {
            return [
                { text: 'By Rows', value: 'Rows' },
                { text: 'By Columns', value: 'Columns' }
            ];
        },
        getLookInDataSource: function() {
            return [
                { text: 'Formulas', value: 'Formulas' },
                { text: 'Values', value: 'Values' }
            ];
        },
        getFormOptions: function() {
            var that = this;
            return {
                validationGroup: 'ssFormGroup',
                colCount: 2,
                items: [
                    {
                        dataField: this.editorName,
                        editorType: 'dxTextBox',
                        label: { text: 'Find what' },
                        colSpan: 2,
                        validationRules: [{
                            type: 'required',
                            message: 'This field is required.'
                        }]
                    },
                    {
                        dataField: 'searchBy',
                        editorType: 'dxSelectBox',
                        label: { text: 'Search' },
                        editorOptions: {
                            dataSource: that.getSearchByDataSource(),
                            value: that.getSearchByDataSource()[0].value,
                            displayExpr: 'text',
                            valueExpr: 'value'
                        }
                    },
                    {
                        dataField: 'matchCase',
                        editorType: 'dxCheckBox',
                        label: { text: ' ', showColon: false },
                        editorOptions: {
                            value: false,
                            text: 'Match case'
                        }
                    },
                    {
                        dataField: 'lookIn',
                        editorType: 'dxSelectBox',
                        label: { text: 'Look in' },
                        editorOptions: {
                            dataSource: that.getLookInDataSource(),
                            value: that.getLookInDataSource()[0].value,
                            displayExpr: 'text',
                            valueExpr: 'value'
                        }
                    },
                    {
                        dataField: 'matchCellContent',
                        editorType: 'dxCheckBox',
                        label: { text: ' ', showColon: false },
                        editorOptions: {
                            value: false,
                            text: 'Match entire cell contents'
                        }
                    },
                    {
                        label: { text: 'Search result', location: 'top' },
                        colSpan: 2,
                        template: function() {
                            var element = document.createElement('div');
                            that.resultList = new DevExpress.ui.dxDataGrid(element, {
                                height: 120,
                                keyExpr: 'CellPosition',
                                pager: {
                                    visible: false
                                },
                                hoverStateEnabled: true,
                                showBorders: true,
                                noDataText: '',
                                selection: {
                                    mode: 'single'
                                },
                                columns: [{
                                    dataField: 'CellPosition',
                                    caption: 'Cell',
                                    width: 70
                                },
                                {
                                    dataField: 'DisplayText',
                                    caption: 'Value'
                                }],
                                onSelectionChanged: that.selectionChanged.aspxBind(that)
                            });
                            return element;
                        }
                    }
                ]
            };
        },
        getToolbarItems: function() {
            return [this.getFindAllToolbarItem(), this.getCancelToolbarItem()];
        },
        getFindAllToolbarItem: function() {
            return {
                widget: 'dxButton',
                location: 'after',
                toolbar: 'bottom',
                options: {
                    text: 'Find All',
                    onClick: this.findAll.aspxBind(this)
                }
            };
        },
        findAll: function() {
            var dialogData = this.getCommandParams(this.form.option('formData'));
            this.getOwnerControl().findAllFromDialog(this, dialogData.findWhat, dialogData.matchCase, dialogData.matchCellContent, dialogData.searchBy, dialogData.lookIn);
        },
        getTitle: function() {
            return 'Find';
        },
        getEditorNameToAutofocus: function() {
            return this.editorName;
        },

        getCommandParams: function(formData) {
            return {
                findWhat: formData[this.editorName],
                searchBy: formData.searchBy,
                lookIn: formData.lookIn,
                matchCase: formData.matchCase,
                matchCellContent: formData.matchCellContent
            };
        },
        selectionChanged: function(args) {
            var data = args.selectedRowsData[0];
            if(data) {
                this.getOwnerControl().getPaneManager().scrollTo(data.ModelColumnIndex, data.ModelRowIndex, true);
            }
        },
        OnSearchResultsReceived: function(findAllList, findNextCellModelPosition) {
            this.resultList.option('dataSource', findAllList);
            this.resultList.selectRows([findNextCellModelPosition]);
        },
        onEnter: function() {
            this.findAll();
        },
        getFormClassName: function() {
            var className = DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.getFormClassName.call(this);
            return className + ' dxss-findAndReplaceDialog';
        }
    });

})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.PageSetup = ASPx.CreateClass(DevExpress.AspNetCore.Spreadsheet.Dialogs.Base, {
        viewModel: null,
        formData: null,

        getFormOptions: function() {
            return {
                formData: this.formData,
                items: [{
                    itemType: 'tabbed',
                    tabPanelOptions: {
                        deferRendering: false,
                        focusStateEnabled: false,
                    },
                    tabs: [{
                        title: 'Page',
                        name: 'Page',
                        items: DevExpress.AspNetCore.Spreadsheet.Dialogs.PageSetup.PageTab.getFormItems(this.formData)
                    }, {
                        title: 'Margins',
                        name: 'Margins',
                        items: DevExpress.AspNetCore.Spreadsheet.Dialogs.PageSetup.MarginsTab.getFormItems(this.formData)
                    }, {
                        title: 'Header/Footer',
                        name: 'Header/Footer',
                        items: DevExpress.AspNetCore.Spreadsheet.Dialogs.PageSetup.HeaderFooterTab.getFormItems(this.formData)
                    }, {
                        title: 'Sheet',
						name: 'Sheet',
                        items: DevExpress.AspNetCore.Spreadsheet.Dialogs.PageSetup.SheetTab.getFormItems(this.formData)
                    }]
                }]

            };
        },
        getTitle: function() {
            return 'Page Setup';
        },
        getPopupClassName: function() {
            var baseClassName = DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.getPopupClassName.call(this);
            return baseClassName + ' ' + DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.ClassNames.DialogWithTabs;
        },

        isMobileView: function() {
            return window.innerWidth < 768;
        },
        onContentReady: function(e) {
            DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.onContentReady.call(this, e);
/*            console.log('onContentReady');
            var manes = ['seTopMargin', 'seHeaderMargin', 'seLeftMargin', 'seRightMargin', 'seBottomMargin', 'seFooterMargin' ];
            for(var name in manes) {
                if(manes.hasOwnProperty(name)) {
                    var itemPath = 'Margins.Margins.' + manes[name];
                    var label = e.component.itemOption(itemPath).label;
                    console.log(itemPath);
                    if(!label) {
                        console.log('!!!'); continue;
                    }
                    if(this.isMobileView()) {
                        if(label.location != 'left') {
                            label.location = 'left';
                            e.component.itemOption(itemPath, 'label', label);
                        }
                    } else {
                        if(label.location != 'top') {
                            label.location = 'top';
                            e.component.itemOption(itemPath, 'label', label);
                        }
                    }
                }
            }
*/
        },

        baseShow: null,
        show: function(/*commandId, parameters, callback, _isModal*/) {
            var args = Array.prototype.slice.call(arguments);
            this.baseShow = function() {
                DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.show.apply(this, args);
            }.aspxBind(this);

            this.InitializeDialogFields();
        },

        OnPrint: function() { },
        getPrintToolbarItem: function() {
            return [{
                widget: 'dxButton',
                location: 'before',
                toolbar: 'bottom',
                options: {
                    text: 'Print...',
                    onClick: this.OnPrint.aspxBind(this)
                }
            }];
        },
        getToolbarItems: function() {
            var customToolbar = this.getPrintToolbarItem();
            var defaulToolbar = DevExpress.AspNetCore.Spreadsheet.Dialogs.Base.prototype.getToolbarItems.call(this);
            var toolbar = customToolbar.concat(defaulToolbar);
            return toolbar;
        },

        // TODO refactor: code the same with ASPxSpreadheet's dialog
        InitializeDialogFields: function() {
            //this.subscribeToButtonEvents();
            //this.spreadsheet.fetchPageSetupViewModelFromDialog(this);
            this.getOwnerControl().fetchPageSetupViewModelFromDialog(this);
        },
        OnViewModelReceived: function(viewModel) {
            //if(this.commandParams && this.commandParams.fromInnerDialog) {
            //    this.partialViewModelSaved = this.commandParams.isSaved;
            //    this.viewModel = this.commandParams.viewModel;
            //    this.synchronizeViewModel(viewModel);
            //} else {
            this.viewModel = viewModel;
            this.formData = this.createFormData(viewModel);
            this.baseShow();
            //}
            //this.setInitializationFlag();
            //this.populateEditors();
        },
        patchViewModelDataSources: function(viewModel) {
            // TODO refactor
            for(var printMode in viewModel.PrintMode) {
                if(viewModel.PrintMode.hasOwnProperty(printMode)) {
                    var datasource = viewModel.PrintMode[printMode];
                    viewModel.DataSource[printMode] = [];
                    for(var property in datasource) {
                        if(datasource.hasOwnProperty(property)) {
                            var dataitem = datasource[property];
                            viewModel.DataSource[printMode].push({ value: property, text: dataitem });
                        }
                    }
                }
            }
        },
        createFormData: function(viewModel) {
            this.patchViewModelDataSources(viewModel);
            return viewModel;

            //var formData = {};

            ////'rlOrientationPortrait': 0,
            //formData['rlOrientationPortrait'] = viewModel.rlOrientationPortrait;

            ////'rbAdjustTo': false
            //formData['rbAdjustTo'] = viewModel.rbAdjustTo;
            ////'rbFitToPage': true,
            //formData['rbFitToPage'] = viewModel.rbFitToPage;

            ////seScale: 100
            //formData['seScale'] = viewModel.seScale;

            ////seFitToWidth: 1
            //formData['seFitToWidth'] = viewModel.seFitToWidth;

            ////seFitToHeight: 1
            //formData['seFitToHeight'] = viewModel.seFitToHeight;

            ////cbPaperType: "Letter"
            //formData['cbPaperType'] = viewModel.cbPaperType;

            ////cbPrintQualityMode: "600 dpi"
            //formData['cbPrintQualityMode'] = viewModel.cbPrintQualityMode;

            ////tbFirstPageNumber: "Auto"
            //formData['tbFirstPageNumber'] = viewModel.tbFirstPageNumber;

            ////seTopMargin: 0.75
            //formData['seTopMargin'] = viewModel.seTopMargin;
            ////seHeaderMargin: 0.3
            //formData['seHeaderMargin'] = viewModel.seHeaderMargin;
            ////seLeftMargin: 0.7
            //formData['seLeftMargin'] = viewModel.seLeftMargin;
            ////seRightMargin: 0.7
            //formData['seRightMargin'] = viewModel.seRightMargin;
            ////seBottomMargin: 0.75
            //formData['seBottomMargin'] = viewModel.seBottomMargin;
            ////seFooterMargin: 0.3
            //formData['seFooterMargin'] = viewModel.seFooterMargin;

            ////ckCenterHorizontally: false
            //formData['ckCenterHorizontally'] = viewModel.ckCenterHorizontally;
            ////ckCenterVertically: false
            //formData['ckCenterVertically'] = viewModel.ckCenterVertically;

            //// Header/footer
            ////cbHeader: "(none)"
            //formData['DataSource'] = viewModel.DataSource;
            //formData['cbHeader'] = viewModel.cbHeader;
            ////cbFooter: "(none)"
            //formData['cbFooter'] = viewModel.cbFooter;

            ////ckDifferentOddEven: false
            //formData['ckDifferentOddEven'] = viewModel.ckDifferentOddEven;
            ////ckDifferentFirstPage: false
            //formData['ckDifferentFirstPage'] = viewModel.ckDifferentFirstPage;
            ////ckScaleWithDocument: true
            //formData['ckScaleWithDocument'] = viewModel.ckScaleWithDocument;
            ////ckAlignWithMargins: true
            //formData['ckAlignWithMargins'] = viewModel.ckAlignWithMargins;


            ///////////////

            ////tbPrintArea: ""
            //formData['tbPrintArea'] = viewModel.tbPrintArea;

            ////ckPrintGridlines: false
            //formData['ckPrintGridlines'] = viewModel.ckPrintGridlines;
            ////ckDraft: false
            //formData['ckDraft'] = viewModel.ckDraft;
            ////ckPrintHeadings: false
            //formData['ckPrintHeadings'] = viewModel.ckPrintHeadings;

            ////PrintMode:
            ////cbCommentsPrintMode: { None: "(None)", AtEnd: "At end of sheet", AsDisplayed: "As displayed on sheet" }
            ////cbErrorsPrintMode: { Displayed: "displayed", Blank: "<blank>", Dash: "--", NA: "#N/A" }



            ////cbCommentsPrintMode: "None"
            //formData['cbCommentsPrintMode'] = viewModel.cbCommentsPrintMode;
            ////cbErrorsPrintMode: "Displayed"
            //formData['cbErrorsPrintMode'] = viewModel.cbErrorsPrintMode;

            ////rlDownThenOver: 1
            //formData['rlDownThenOver'] = viewModel.rlDownThenOver;
           
            //// TODO            
            ////displayFooter: ";;"
            ////displayHeader: ";;"
            ////headerFooterViewModel: { OddPage: { … }, EvenPage: { … }, AllPages: { … }, FirstPage: { … } }
            ////meEvenFooter: ""
            ////meEvenHeader: ""
            ////meFirstFooter: ""
            ////meFirstHeader: ""
            ////meOddFooter: ""
            ////meOddHeader: ""

            ////ckBlackAndWhite: false //not supported

            //return formData;
        }

    });
})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.PageSetup.PageTab = {
        getFormItems: function() {
            return [{
                itemType: 'group',
                caption: 'Orientation',
				name: 'Orientation',
                //colCount: 3,
                items: [
                    {
                        editorType: 'dxRadioGroup',
                        dataField: 'rlOrientationPortrait',
                        label: { visible: false },
                        editorOptions: {
                            displayExpr: 'text',
                            valueExpr: 'value',
                            items: [
                                { text: 'Portrait', value: 1 },
                                { text: 'Landscape', value: 0 }],
                            layout: 'horizontal',
                            //onValueChanged: function(e) {
                            //    this.updateEditorsVisibility(e.value === this.uploadTypes[1]);
                            //    this.popupDialog.repaint();
                            //}.aspxBind(this)
                        }
                    }/*,
                    {
                        dataField: 'FinTo',
                        editorType: 'dxRadioGroup',
                        label: { text: 'Portrait', location: 'right', showColon: false },
                        editorOptions: {
                            items: ['Portrait'],
                            //layout: 'vertical',
                            //width: '0',
                        },
                        //width: '0',
                    },
                    {
                        dataField: 'FinTo',
                        editorType: 'dxRadioGroup',
                        label: { text: 'Landscape', location: 'right', showColon: false },
                        editorOptions: {
                            items: ['Landscape'],
                            //layout: 'vertical',
                            //width: '0',
                        },
                        //width: '0',
                    },
                    {
                        itemType: 'empty'
                    },*/

                ]
            }, {
                itemType: 'group',
                caption: 'Scaling',
                colCount: 3,
                cssClass: 'dxss-form-item-middle',
                items: [
                    {
                        editorType: 'dxRadioGroup',
                        dataField: 'rbAdjustTo',
                        label: { visible: false },
                        editorOptions: {
                            displayExpr: 'text',
                            valueExpr: 'value',
                            items: [
                                { text: 'Adjust to:', value: true }],
                            layout: 'vertical',
                            //width: '0',
                        },
                        //width: '0',
                    },
                    {
                        editorType: 'dxNumberBox',
                        dataField: 'seScale',
                        cssClass: 'dxss-dialog-item-label-left',
                        label: { text: '% normal size', location: 'right', showColon: false },
                        alignment: 'left',
                        //cssClass: 'dx-formItem-withLeftPadding',
                        //colSpan: 2,
                        editorOptions: {
                            showSpinButtons: true,
                            //text: '% normal size',
                            width: '76px'
                        },
                    },
                    {
                        itemType: 'empty'
                    },
                    {
                        editorType: 'dxRadioGroup',
                        dataField: 'rbFitToPage',
                        label: { visible: false },
                        //label: { text: 'Fit to', location: 'right', },
                        editorOptions: {
                            displayExpr: 'text',
                            valueExpr: 'value',
                            items: [
                                { text: 'Fit to:', value: true }],
                            layout: 'vertical',
                            //width: '0',
                        },
                        //width: '0',
                    },
                    {
                        editorType: 'dxNumberBox',
                        dataField: 'seFitToWidth',
                        cssClass: 'dxss-dialog-item-label-left',
                        label: { text: 'page(s) wide by', location: 'right', showColon: false },
                        editorOptions: {
                            showSpinButtons: true,
                            //text: 'page(s) wide by',
                            width: '76px'
                        },
                    },
                    {
                        editorType: 'dxNumberBox',
                        dataField: 'seFitToHeight',
                        cssClass: 'dxss-dialog-item-label-left',
                        label: { text: 'tall', location: 'right', showColon: false },
                        editorOptions: {
                            showSpinButtons: true,
                            //text: 'tall',
                            width: '76px'
                        },
                    },
                ]
            },
            {
                itemType: 'group',
                caption: ' ',
                items: [
                    {
                        editorType: 'dxSelectBox',
                        dataField: 'cbPaperType',
                        label: { text: 'Paper size' },
                        editorOptions: {
                            items: ['Letter', 'Legal', 'Executive', 'Folio', 'A6', 'A5', 'B5', 'A4', 'B4', 'A3'],
                        },
                    },
                    {
                        editorType: 'dxSelectBox',
                        dataField: 'cbPrintQualityMode',
                        label: { text: 'Print quality' },
                        editorOptions: {
                            items: ['600 dpi'],
                        },
                    },
                    {
                        editorType: 'dxTextBox',
                        dataField: 'tbFirstPageNumber',
                        label: { text: 'First page number' },
                        //editorOptions: {
                        //    width: '100px'
                        //},
                    }
                ]
            },

            ];
        }

    };
})();
(function() {
    //var isPhone = DevExpress.devices.current().deviceType == 'phone';
    //var editorWidth = isPhone ? '' : '80px';
    var editorWidth = 'auto';

    DevExpress.AspNetCore.Spreadsheet.Dialogs.PageSetup.MarginsTab = {
        getFormItems: function() {
            return [{
                itemType: 'group',
                colCount: 3,
                alignItemLabels: '',
                name: 'Margins',
                items: [
                    {
                        itemType: 'empty'
                    },
                    {
                        editorType: 'dxNumberBox',
                        dataField: 'seTopMargin',
						name: 'seTopMargin',
                        label: { text: 'Top', location: 'top' },
                        cssClass: '',
                        editorOptions: {
                            showSpinButtons: true,
                            width: editorWidth,
                        },
                    },
                    {
                        editorType: 'dxNumberBox',
                        dataField: 'seHeaderMargin',
                        name: 'seHeaderMargin',
                        label: { text: 'Header', location: 'top' },
                        editorOptions: {
                            showSpinButtons: true,
                            width: editorWidth,
                        },
                    },
                    {
                        editorType: 'dxNumberBox',
                        dataField: 'seLeftMargin',
                        name: 'seLeftMargin',
                        label: { text: 'Left', location: 'top' },
                        cssClass: '',
                        editorOptions: {
                            showSpinButtons: true,
                            width: editorWidth,
                        },
                    },
                    //{
                    //    itemType: 'empty',
                    //    cssClass: 'dxss-marginsetup-wysiwyg'
                    //},
                    {
                        itemType: 'group',
                        cssClass: 'dxss-marginsetup-wysiwyg',
                        template: 'TODO'
                    },
                    {
                        editorType: 'dxNumberBox',
                        dataField: 'seRightMargin',
                        name: 'seRightMargin',
                        label: { text: 'Right', location: 'top' },
                        cssClass: '',
                        editorOptions: {
                            showSpinButtons: true,
                            width: editorWidth,
                        },
                    },
                    {
                        itemType: 'empty'
                    },
                    {
                        editorType: 'dxNumberBox',
                        dataField: 'seBottomMargin',
                        name: 'seBottomMargin',
                        label: { text: 'Bottom', location: 'top' },
                        cssClass: '',
                        editorOptions: {
                            showSpinButtons: true,
                            width: editorWidth,
                        },
                    },
                    {
                        editorType: 'dxNumberBox',
                        dataField: 'seFooterMargin',
                        name: 'seFooterMargin',
                        label: { text: 'Footer', location: 'top' },
                        cssClass: '',
                        editorOptions: {
                            showSpinButtons: true,
                            width: editorWidth,
                        },
                    }
                ]
                }, {
                    itemType: 'group',
                    caption: 'Center on page',
                    items: [
                        {
                            editorType: 'dxCheckBox',
                            //dataField: 'ckCenterHorizontally',
                            editorOptions: { text: 'Horizontally' },
                            label: { visible: false },
                        },
                        {
                            editorType: 'dxCheckBox',
                            dataField: 'ckCenterVertically',
                            editorOptions: { text: 'Vertically' },
                            label: { visible: false },
                        }
                    ]
                },

            ];
        }

    };
})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.PageSetup.HeaderFooterTab = {
        getFormItems: function(formData) {
            return [
                {
                    itemType: 'group',
                    cssClass: 'dxss-header-dialogArea',
                    template: 'TODO'
                },
                {
                    editorType: 'dxSelectBox',
                    dataField: 'cbHeader',
                    label: { text: 'Header', location: 'top', alignment: 'left' },
                    editorOptions: {
                        items: formData.DataSource.cbHeader,
                        //placeholder: '(none)',
                    },
                },


                {
                    itemType: 'group',
                    colCount: 2,
                    alignItemLabels: '',
                    //caption: 'Orientation',
                    items: [
                        {
                            itemType: 'button',
                            cssClass: 'dxss-button-one-col-center',
                            horizontalAlignment: 'right',
                            buttonOptions: {
                                text: 'Custom Header...',
                                type: 'normal',
                                //useSubmitBehavior: true
                            }
                        },
                        {
                            itemType: 'button',
                            horizontalAlignment: 'left',
                            cssClass: 'dxss-button-one-col-center',
                            buttonOptions: {
                                text: 'Custom Footer...',
                                type: 'normal',
                                //useSubmitBehavior: true
                            }
                        },
                    ]
                },
                {
                    editorType: 'dxSelectBox',
                    dataField: 'cbFooter',
                    label: { text: 'Footer', location: 'top', alignment: 'left' },
                    editorOptions: {
                        items: formData.DataSource.cbFooter,
                        //placeholder: '(none)',
                    },
                },
                {
                    itemType: 'group',
                    cssClass: 'dxss-footer-dialogArea',
                    template: 'TODO'
                },

                {
                    editorType: 'dxCheckBox',
                    dataField: 'ckDifferentOddEven',
                    editorOptions: { text: 'Different odd and even pages' },
                    label: { visible: false },
                },
                {
                    editorType: 'dxCheckBox',
                    dataField: 'ckDifferentFirstPage',
                    editorOptions: { text: 'Different first page' },
                    label: { visible: false },
                },
                {
                    editorType: 'dxCheckBox',
                    dataField: 'ckScaleWithDocument',
                    editorOptions: { text: 'Scale with document' },
                    label: { visible: false },
                },
                {
                    editorType: 'dxCheckBox',
                    dataField: 'ckAlignWithMargins',
                    editorOptions: { text: 'Align with page margins' },
                    label: { visible: false },
                },

            ];
        }

    };
})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.Dialogs.PageSetup.SheetTab = {
        getFormItems: function(formData) {
            return [{
                editorType: 'dxTextBox',
                dataField: 'tbPrintArea',
                label: { text: 'Print area' },
            },
            {
                itemType: 'group',
                caption: 'Print',
                colCount: 2,
                items: [
                    {
                        editorType: 'dxCheckBox',
                        dataField: 'ckPrintGridlines',
                        editorOptions: { text: 'Gridlines' },
                        label: { visible: false },
                    },
                    {
                        editorType: 'dxSelectBox',
                        dataField: 'cbCommentsPrintMode',
                        label: { text: 'Comments' },
                        editorOptions: {
                            displayExpr: 'text',
                            valueExpr: 'value',
                            items: formData.DataSource.cbCommentsPrintMode,
                        },
                    },
                    {
                        editorType: 'dxCheckBox',
                        dataField: 'ckDraft',
                        editorOptions: { text: 'Draft quality' },
                        label: { visible: false },
                    },
                    {
                        editorType: 'dxSelectBox',
                        dataField: 'cbErrorsPrintMode',
                        label: { text: 'Cell error as' },
                        editorOptions: {
                            displayExpr: 'text',
                            valueExpr: 'value',
                            items: formData.DataSource.cbErrorsPrintMode,
                        },
                    },
                    {
                        editorType: 'dxCheckBox',
                        dataField: 'ckPrintHeadings',
                        editorOptions: { text: 'Row and column headings' },
                        label: { visible: false },
                    },
                ]
            },
            {
                itemType: 'group',
                caption: 'Page order',
                //colCount: 2,
                items: [
                    {
                        dataField: 'rlDownThenOver',
                        editorType: 'dxRadioGroup',
                        label: { visible: false },
                        editorOptions: {
                            displayExpr: 'text',
                            valueExpr: 'value',
                            items: [
                                { text: 'Down, then over', value: 1 },
                                { text: 'Over, then down', value: 0 }],
                            layout: 'vertical',
                        }
                    },
                ]
            },

            ];
        }

    };
})();
(function () {
    var FIRST_SHEET_TAB_CLASS_NAME = 'dxss-first-sheet-tab',
        TAB_CONTAINER_CLASS_NAME = 'dxss-tab-container',
        TAB_CONTROL_WRAPPER_ELEMENT_CLASS_NAME = 'dxss-tabs-wrapper',
        TAB_CONTROL_ELEMENT_CLASS_NAME = 'dxss-tabs',
        BUTTON_ELEMENT_CLASS_NAME = 'dxss-plus-button';
	
    var SpreadsheetTabs = function (ownerControl) {
        var currentTabIndex = -1;
        var activeTabChanged = null;
        var tabClick = null;
        var tabsHeight = 0;
        var addSheetButtonEnabled = true;

        var createContainers = function(container) {
            var wrapperContainer = document.createElement('ul');
            wrapperContainer.className = TAB_CONTAINER_CLASS_NAME;

            var tabControlWrapperContainer = document.createElement('li');
            tabControlWrapperContainer.className = TAB_CONTROL_WRAPPER_ELEMENT_CLASS_NAME;

            var tabControlElement = document.createElement('div');
            tabControlElement.className = TAB_CONTROL_ELEMENT_CLASS_NAME;
            tabControlWrapperContainer.appendChild(tabControlElement);

            wrapperContainer.appendChild(tabControlWrapperContainer);

            var plusButtonWrapper = document.createElement('li');
            var plusButtonElement = document.createElement('div');
            plusButtonElement.className = BUTTON_ELEMENT_CLASS_NAME;

            plusButtonWrapper.appendChild(plusButtonElement);

            wrapperContainer.appendChild(plusButtonWrapper);

            container.appendChild(wrapperContainer);

            return {
                wrapperContainer: wrapperContainer,
                tabControlElement: tabControlElement,
                plusButtonElement: plusButtonElement
            };
        };

        var containers = createContainers(ownerControl.GetMainElement());
        var tabElement = containers.tabControlElement;
        var tabControl = new DevExpress.ui.dxTabs(tabElement, {
            dataSource: [{ text: 'TEMP' }], //TODO: fix for height
            scrollByContent: true,
            showNavButtons: true,
            onItemRendered: function(e) {
                if(e.itemIndex === 0 && e.itemElement)
                    (e.itemElement[0] || e.itemElement).classList.add(FIRST_SHEET_TAB_CLASS_NAME);

                DevExpress.events.on(e.itemElement, 'dxpointerdown', function(event, extraParameters) {
                    if(tabClick) {
                        var e = {
                            cancel: false,
                            htmlEvent: {} //TODO handle double click
                        };
                        tabClick(null, e);
                        if(e.cancel)
                            event.preventDefault(); //TODO cancel does not work
                    }
                });
            },
            onItemClick: function(e) {
                if(activeTabChanged && e.itemIndex !== currentTabIndex)
                    activeTabChanged(null, { tab: { index: e.itemIndex } });
            },
            onItemContextMenu: function(e) {
                ASPx.Evt.PreventEventAndBubble(e.event);
                ownerControl.showTabSelectorContextMenu(e.event);
            },
            onContentReady: function(e) {
                if(this.AdjustControl)
                    this.AdjustControl();
            }.aspxBind(this)
        });

        tabsHeight = containers.wrapperContainer.offsetHeight;
		tabControl.option('dataSource', [{ text: '' }]);
        //tabElement.style.visibility = '';

        var buttonElement = containers.plusButtonElement;
        new DevExpress.ui.dxButton(buttonElement, {
            icon: 'add',
            onClick: function(e) {
                ownerControl.onServerCommand(ASPxClientSpreadsheet.ServerCommands.getCommandIDByName('InsertSheet').id);
            }
        });

        this.onInit = function(spreadsheet) {
        };

        this.processDocumentResponse = function (model, updateSheetTabs) {
            if (updateSheetTabs) {
                var dataSource = [];
                var visibleSheets = model.getVisibleSheets();

                for (var i = 0; i < visibleSheets.length; i++) {
                    var sheet = visibleSheets[i];
                    dataSource.push({ id: sheet.Id, text: sheet.Name });
                    if (model.activeSheetId === sheet.Id) //TODO
                        currentTabIndex = i;
                }
                tabControl.option('dataSource', dataSource);
                tabControl.option('selectedIndex', currentTabIndex);
            }
        };
        this.GetMainElement = function() {
            return containers.wrapperContainer;
        };
        this.getContainers = function() {
            return containers;
        };
        this.GetButtonElement = function() {
            return buttonElement;
        };
        this.AdjustControl = function() {
            buttonElement.style.height = tabElement.offsetHeight + 'px';
        };
        this.GetHeight = function () {
			return tabsHeight;
        };
        this.SetWidth = function (width) {
        };
        // Editing
        this.onEditingStarted = function() {
            this.changeTemplateButtonEnableStatus(false);
            this.updateTemplateButton();
        };
        this.onEditingStopped = function() {
            this.changeTemplateButtonEnableStatus(true);
            this.updateTemplateButton();
        };
        // Add sheet button enabled
        this.updateTemplateButton = function() {
            var container = this.GetButtonElement();
            if(container) {
                var enabled = this.isAddSheetButtonEnabled();
                if(enabled)
                    ASPx.Attr.RemoveAttribute(container.style, 'pointer-events');
                else
                    container.style.pointerEvents = 'none';
            }
        };
        this.changeTemplateButtonEnableStatus = function(enable) {
            addSheetButtonEnabled = enable;
        };
        this.isAddSheetButtonEnabled = function() {
            return addSheetButtonEnabled && ASPxClientSpreadsheet.Commands.CommandHelper.GetCommandEnabled(ownerControl, ASPxClientSpreadsheet.ServerCommands.getCommandIDByName('InsertSheet').id);
        };

        this.SubscribeActiveTabChanged = function (handler, executionContext) {
            activeTabChanged = handler;
        };
        this.SubscribeTabClick = function(handler, executionContext) {
            tabClick = handler;
        };
        this.SubscribeTabMouseDown = function (handler, executionContext) {
        };
        this.SubscribeTabMouseUp = function (handler, executionContext) {
        };
        this.SubscribeTabMouseMove = function (handler, executionContext) {
        };
    };

    DevExpress.AspNetCore.Spreadsheet.SpreadsheetTabs = SpreadsheetTabs;

})();

(function() {
    DevExpress.AspNetCore.Spreadsheet.SvgSpriteContent = '<svg xmlns="http://www.w3.org/2000/svg"><symbol id="AutoFilterAscending" viewBox="0 0 16 16"><style>.s0{fill:#727272}</style><path class="s0" d="M10 7H8v5H7V7H5l2.5-3L10 7z"/></symbol><symbol id="AutoFilterDescending" viewBox="0 0 16 16"><style>.s1{fill:#727272}</style><path class="s1" d="M7.5 12L5 9h2V4h1v5h2l-2.5 3z"/></symbol><symbol id="AutoFilterDropDown" viewBox="0 0 12 12"><style>.s2{fill-rule:evenodd;clip-rule:evenodd;fill:#727272}</style><path class="s2" d="M5.5 8L2 4h7L5.5 8z"/></symbol><symbol id="AutoFilterFiltered" viewBox="0 0 16 16"><style>.s3{fill:#727272}</style><path class="s3" d="M9 7v4l-1 1V7L5 5V4h7v1L9 7z"/></symbol><symbol id="AutoFilterFilteredAndAscending" viewBox="0 0 16 16"><style>.s4{fill:#727272}</style><path class="s4" d="M11 7v4l-1 1V7L7 5V4h7v1l-3 2zM7 8H5v4H4V8H2l2.5-3L7 8z"/></symbol><symbol id="AutoFilterFilteredAndDescending" viewBox="0 0 16 16"><style>.s5{fill:#727272}</style><path class="s5" d="M11 7v4l-1 1V7L7 5V4h7v1l-3 2zm-6.5 5L2 9h2V5h1v4h2l-2.5 3z"/></symbol><symbol id="InsertChartArea" viewBox="0 0 32 32"><style>.s6{fill:#1177d7}.s7{fill:#ffb115}.s8{opacity:.5}</style><path class="s7" d="M2 12l10 8L30 4v24H2z"/><path class="s8 s6" d="M2 22l12-12 16 6v12H2z"/><path class="s6" d="M12 20l-4.4-3.6L2 22v6h28V16l-9.5-3.6z"/></symbol><symbol id="InsertChartArea3D" viewBox="0 0 32 32"><style>.s9{fill:#1177d7}.s10{fill:#d11c1c}.s11{fill:#ffb115}.s12{opacity:.5}.s13{opacity:.75}</style><path class="s11" d="M22 30l4-4v-4l-4 4z"/><g class="s12"><path transform="rotate(-45.001 5 17)" class="s11" d="M2.2 12.8h5.7v8.5H2.2z"/><path transform="rotate(-45.001 19 19)" class="s11" d="M16.2 11.9h5.7V26h-5.7z"/><path transform="rotate(-45.001 9 7)" class="s10" d="M6.2 2.8h5.7v8.5H6.2z"/><path transform="rotate(-45.001 23 9)" class="s10" d="M20.2 1.9h5.7V16h-5.7z"/></g><path class="s10" d="M26 26l4-4V12l-4 4z"/><g class="s13"><path class="s11" d="M0 30V16l6 6 6-6 10 10v4z"/><path class="s10" d="M16 6l-6 6-6-6v6l6 6 6-6 10 10v-6z"/></g></symbol><symbol id="InsertChartAreaCommandGroup" viewBox="0 0 32 32"><style>.s14{fill:#1177d7}.s15{fill:#ffb115}.s16{opacity:.5}</style><path class="s15" d="M2 12l10 8L30 4v24H2z"/><path class="s16 s14" d="M2 22l12-12 16 6v12H2z"/><path class="s14" d="M12 20l-4.4-3.6L2 22v6h28V16l-9.5-3.6z"/></symbol><symbol id="InsertChartBarClustered2D" viewBox="0 0 32 32"><style>.s17{fill:#ffb115}.s18{fill:#d11c1c}</style><path class="s17" d="M4 8V2h12v6H4zm24 16v-6H4v6h24z"/><path class="s18" d="M4 14V8h22v6H4zm18 16v-6H4v6h18z"/></symbol><symbol id="InsertChartBarClustered3D" viewBox="0 0 32 32"><style>.s19{fill:#ffb115}.s20{fill:#1177d7}.s21{opacity:.75}.s22{opacity:.5}</style><path class="s20" d="M18 28l-2 2v-6h2v4zM28 6l-2 2v6l2-2V6z"/><g class="s21"><path class="s20" d="M16 24v6H4v-6h12zM4 8v6h22V8H4z"/><path class="s19" d="M22 18v6H4v-6h18zM4 2v6h18V2H4z"/></g><path class="s19" d="M24 22l-2 2v-6l2-2v6zm0-22l-2 2v6l2-2V0z"/><g class="s22"><path class="s20" d="M24 6l-2 2h4l2-2z"/><path class="s19" d="M24 16l-2 2H4l2-2h18zM6 0L4 2h18l2-2H6z"/></g></symbol><symbol id="InsertChartBarCommandGroup" viewBox="0 0 32 32"><style>.s23{fill:#1177d7}.s24{fill:#d11c1c}.s25{fill:#ffb115}.s26{fill:#039c23}</style><path class="s25" d="M4 0h10v6H4z"/><path class="s26" d="M4 8h16v6H4z"/><path class="s23" d="M4 16h26v6H4z"/><path class="s24" d="M4 24h20v6H4z"/></symbol><symbol id="InsertChartBarPercentStacked2D" viewBox="0 0 32 32"><style>.s27{fill:#ffb115}.s28{fill:#d11c1c}.s29{fill:#1177d7}</style><path class="s28" d="M4 10V4h8v6H4zm6 8v-6H4v6h6zm2 8v-6H4v6h8z"/><path class="s27" d="M12 10V4h8v6h-8zm10 8v-6H10v6h12zm-4 8v-6h-6v6h6z"/><path class="s29" d="M20 10V4h8v6h-8zm8 8v-6h-6v6h6zm0 8v-6H18v6h10z"/></symbol><symbol id="InsertChartBarPercentStacked3D" viewBox="0 0 32 32"><style>.s30{fill:#ffb115}.s31{fill:#1177d7}.s32{opacity:.75}.s33{opacity:.5}</style><path class="s31" d="M28 8l-2 2V4l2-2v6zm0 4l-2 2v6l2-2v-6zm0 10l-2 2v6l2-2v-6z"/><g class="s32"><path class="s31" d="M26 4v6H10V4h16zm-8 10v6h8v-6h-8zm-4 10v6h12v-6H14z"/><path class="s30" d="M10 4v6H4V4h6zM4 14v6h14v-6H4zm0 10v6h10v-6H4z"/></g><g class="s33"><path class="s31" d="M28 2l-2 2H10l2-2h16zm-8 10l-2 2h8l2-2h-8zm-4 10l-2 2h12l2-2H16z"/><path class="s30" d="M12 2l-2 2H4l2-2h6zM6 12l-2 2h14l2-2H6zm0 10l-2 2h10l2-2H6z"/></g></symbol><symbol id="InsertChartBarStacked2D" viewBox="0 0 32 32"><style>.s34{fill:#ffb115}.s35{fill:#d11c1c}.s36{fill:#1177d7}</style><path class="s35" d="M4 10V4h4v6H4zm6 8v-6H4v6h6zm6 8v-6H4v6h12z"/><path class="s34" d="M8 10V4h8v6H8zm10 8v-6h-8v6h8zm4 8v-6h-6v6h6z"/><path class="s36" d="M16 10V4h4v6h-4zm8 8v-6h-6v6h6zm4 8v-6h-6v6h6z"/></symbol><symbol id="InsertChartBarStacked3D" viewBox="0 0 32 32"><style>.s37{fill:#ffb115}.s38{fill:#1177d7}.s39{opacity:.75}.s40{opacity:.5}</style><path class="s38" d="M20 8l-2 2V4l2-2v6zm4 4l-2 2v6l2-2v-6zm4 10l-2 2v6l2-2v-6z"/><g id="Create_Rotated_Stacked_Bar_3D_Chart" class="s39"><path class="s38" d="M18 4v6h-8V4h8zm-6 10v6h10v-6H12zm6 10v6h8v-6h-8z"/><path class="s37" d="M10 4v6H4V4h6zM4 14v6h8v-6H4zm0 10v6h14v-6H4z"/></g><g class="s40"><path class="s38" d="M20 2l-2 2h-8l2-2h8zm-6 10l-2 2h10l2-2H14zm6 10l-2 2h8l2-2h-8z"/><path class="s37" d="M12 2l-2 2H4l2-2h6zM6 12l-2 2h8l2-2H6zm0 10l-2 2h14l2-2H6z"/></g></symbol><symbol id="InsertChartBubble" viewBox="0 0 32 32"><style>.s41{fill:#1177d7}.s42{fill:#d11c1c}.s43{fill:#ffb115}.s44{fill:#039c23}</style><circle class="s43" cx="11" cy="21" r="7"/><circle class="s41" cx="23" cy="11" r="5"/><circle class="s44" cx="24" cy="22" r="2"/><circle class="s42" cx="12" cy="6" r="4"/></symbol><symbol id="InsertChartBubble3D" viewBox="0 0 32 32"><style>.s45{fill:#1177d7}.s46{fill:#d11c1c}.s47{fill:#ffb115}.s48{fill:#039c23}</style><path class="s47" d="M11 14c-3.9 0-7 3.1-7 7s3.1 7 7 7 7-3.1 7-7-3.1-7-7-7zm-2 7c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/><path class="s46" d="M12 2C9.8 2 8 3.8 8 6s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4zm-1 4c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1z"/><path class="s48" d="M24 20c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-.5 2c-.3 0-.5-.2-.5-.5s.2-.5.5-.5.5.2.5.5-.2.5-.5.5z"/><path class="s45" d="M23 6c-2.8 0-5 2.2-5 5s2.2 5 5 5 5-2.2 5-5-2.2-5-5-5zm-1.5 5c-.8 0-1.5-.7-1.5-1.5S20.7 8 21.5 8s1.5.7 1.5 1.5-.7 1.5-1.5 1.5z"/></symbol><symbol id="InsertChartBubbleCommandGroup" viewBox="0 0 32 32"><style>.s49{fill:#1177d7}.s50{fill:#d11c1c}.s51{fill:#ffb115}.s52{fill:#039c23}</style><circle class="s51" cx="11" cy="21" r="7"/><circle class="s49" cx="23" cy="11" r="5"/><circle class="s52" cx="24" cy="22" r="2"/><circle class="s50" cx="12" cy="6" r="4"/></symbol><symbol id="InsertChartColumn3D" viewBox="0 0 32 32"><style>.s53{fill:#1177d7}.s54{fill:#ffb115}.s55{fill:#d11c1c}.s56{opacity:.5}.s57{opacity:.75}</style><path class="s56 s53" d="M14 10v2H6l2-2h6zm2-4l-2 2h8V6h-6zm8-4l-2 2h8V2h-6z"/><path class="s53" d="M14 16h-2v-4l2-2v6zm8-10l-2 2v4h2V6zm8-4l-2 2v20l2-2V2z"/><path class="s57 s53" d="M10 18v2H6v-8h6v4l-2 2zm10-6V8h-6v8h4v-2l2-2zm2-8v8h4v12h2V4h-6z"/><path class="s57 s54" d="M8 28H2v-6h6v6zm8-10h-6v10h6V18zm8-4h-6v14h6V14z"/><path class="s56 s54" d="M10 20v2H2l2-2h6zm2-4l-2 2h8v-2h-6zm8-4l-2 2h8v-2h-6z"/><path class="s54" d="M10 26l-2 2v-6l2-2v6zm8-10l-2 2v10l2-2V16zm8-4l-2 2v14l2-2V12z"/></symbol><symbol id="InsertChartColumnClustered2D" viewBox="0 0 32 32"><style>.s58{fill:#1177d7}.s59{fill:#ffb115}</style><path class="s59" d="M8 28H2V16h6v12zM24 4h-6v24h6V4z"/><path class="s58" d="M14 28H8V6h6v22zm16-18h-6v18h6V10z"/></symbol><symbol id="InsertChartColumnClustered3D" viewBox="0 0 32 32"><style>.s60{fill:#1177d7}.s61{fill:#ffb115}.s62{fill:#d11c1c}.s63{opacity:.75}.s64{opacity:.5}</style><path class="s63 s61" d="M6 28H0V16h6v12zM22 6h-6v22h6V6z"/><path class="s64 s61" d="M6 14v2H0l2-2h4zM18 4l-2 2h8V4h-6z"/><path class="s61" d="M24 8l-2 2V6l2-2z"/><path class="s63 s60" d="M12 28H6V10h6v18zm16-18h-6v18h6V10z"/><path class="s64 s60" d="M14 8v2H6l2-2h6zm10 0l-2 2h8V8h-6z"/><path class="s60" d="M14 26l-2 2V10l2-2v18zM30 8l-2 2v18l2-2V8z"/></symbol><symbol id="InsertChartColumnCommandGroup" viewBox="0 0 32 32"><style>.s65{fill:#1177d7}.s66{fill:#d11c1c}.s67{fill:#039c23}.s68{fill:#ffb115}</style><path class="s68" d="M0 18h6v10H0z"/><path class="s67" d="M8 12h6v16H8z"/><path class="s65" d="M16 2h6v26h-6z"/><path class="s66" d="M24 8h6v20h-6z"/></symbol><symbol id="InsertChartColumnPercentStacked2D" viewBox="0 0 32 32"><style>.s69{fill:#1177d7}.s70{fill:#ffb115}.s71{fill:#d11c1c}</style><path class="s71" d="M10 28H4v-8h6v8zm8-6h-6v6h6v-6zm8-2h-6v8h6v-8z"/><path class="s70" d="M10 20H4v-8h6v8zm8-10h-6v12h6V10zm8 4h-6v6h6v-6z"/><path class="s69" d="M10 12H4V4h6v8zm8-8h-6v6h6V4zm8 0h-6v10h6V4z"/></symbol><symbol id="InsertChartColumnPercentStacked3D" viewBox="0 0 32 32"><style>.s72{fill:#1177d7}.s73{fill:#ffb115}.s74{fill:#d11c1c}.s75{opacity:.75}.s76{opacity:.5}</style><path class="s75 s72" d="M8 14H2V6h6v8zm10-8h-6v6h6V6zm10 0h-6v10h6V6z"/><path class="s75 s73" d="M8 22H2v-8h6v8zm10-10h-6v12h6V12zm10 4h-6v6h6v-6z"/><path class="s75 s74" d="M8 28H2v-6h6v6zm10-4h-6v4h6v-4zm10-2h-6v6h6v-6z"/><path class="s76 s72" d="M10 4v2H2l2-2h6zm4 0l-2 2h8V4h-6zm10 0l-2 2h8V4h-6z"/><path class="s74" d="M10 26l-2 2v-6l2-2v6zm10-4l-2 2v4l2-2v-4zm10-2l-2 2v6l2-2v-6z"/><path class="s73" d="M10 20l-2 2V12h2v8zm10-10h-2v14l2-2V10zm10 4h-2v8l2-2v-6z"/><path class="s72" d="M10 12l-2 2V6l2-2v8zm10-8l-2 2v6l2-2V4zm10 0l-2 2v10l2-2V4z"/></symbol><symbol id="InsertChartColumnStacked2D" viewBox="0 0 32 32"><style>.s77{fill:#1177d7}.s78{fill:#ffb115}.s79{fill:#d11c1c}</style><path class="s79" d="M10 28H4v-4h6v4zm8-6h-6v6h6v-6zm8-6h-6v12h6V16z"/><path class="s78" d="M10 24H4v-8h6v8zm8-10h-6v8h6v-8zm8-4h-6v6h6v-6z"/><path class="s77" d="M10 16H4v-4h6v4zm8-8h-6v6h6V8zm8-4h-6v6h6V4z"/></symbol><symbol id="InsertChartColumnStacked3D" viewBox="0 0 32 32"><style>.s80{fill:#1177d7}.s81{fill:#ffb115}.s82{fill:#d11c1c}.s83{opacity:.75}.s84{opacity:.5}</style><path class="s83 s80" d="M8 18H2v-4h6v4zm10-8h-6v4h6v-4zm10-4h-6v6h6V6z"/><path class="s83 s81" d="M8 24H2v-6h6v6zm10-10h-6v8h6v-8zm10-2h-6v6h6v-6z"/><path class="s83 s82" d="M8 28H2v-4h6v4zm10-6h-6v6h6v-6zm10-4h-6v10h6V18z"/><path class="s84 s80" d="M10 12v2H2l2-2h6zm4-4l-2 2h8V8h-6zm10-4l-2 2h8V4h-6z"/><path class="s82" d="M10 26l-2 2v-6h2v4zm10-6h-2v8l2-2v-6zm10-4h-2v12l2-2V16z"/><path class="s81" d="M10 22l-2 2V14h2v8zm10-10h-2v10l2-2v-8zm10-2h-2v8l2-2v-6z"/><path class="s80" d="M10 16l-2 2v-4l2-2v4zm10-8l-2 2v4l2-2V8zm10-4l-2 2v6l2-2V4z"/></symbol><symbol id="InsertChartCone" viewBox="0 0 32 32"><style>.s85{fill:#ffb115}.s86{fill:#039c23}</style><path class="s86" d="M12 22c0 1.1-1.3 2-3 2s-3-.9-3-2l3-10 3 10zm5-14l-3 14c0 1.1 1.3 2 3 2s3-.9 3-2L17 8zm8-4l-3 18c0 1.1 1.3 2 3 2s3-.9 3-2L25 4z"/><path class="s85" d="M8 26c0 1.1-1.3 2-3 2s-3-.9-3-2l3-8 3 8zm5-12l-3 12c0 1.1 1.3 2 3 2s3-.9 3-2l-3-12zm8-4l-3 16c0 1.1 1.3 2 3 2s3-.9 3-2l-3-16z"/></symbol><symbol id="InsertChartConeClustered" viewBox="0 0 32 32"><style>.s87{fill:#ffb115}.s88{fill:#039c23}</style><path class="s88" d="M8 26c0 1.1-1.3 2-3 2s-3-.9-3-2l3-10 3 10zM21 4l-3 22c0 1.1 1.3 2 3 2s3-.9 3-2L21 4z"/><path class="s87" d="M14 26c0 1.1-1.3 2-3 2s-3-.9-3-2l3-18 3 18zm13-14l-3 14c0 1.1 1.3 2 3 2s3-.9 3-2l-3-14z"/></symbol><symbol id="InsertChartConePercentStacked" viewBox="0 0 32 32"><style>.s89{fill:#ffb115}.s90{fill:#039c23}</style><path class="s90" d="M8 14l2 12c0 1.1-1.8 2-4 2s-4-.9-4-2l2-12h4zm6.3-2L12 26c0 1.1 1.8 2 4 2s4-.9 4-2l-2.3-14h-3.4zm9.4 4L22 26c0 1.1 1.8 2 4 2s4-.9 4-2l-1.7-10h-4.6z"/><path class="s89" d="M8 14c0 .6-.9 1-2 1s-2-.4-2-1L6 3l2 11zm9.7-2L16 3l-1.7 9c0 .5.7.8 1.7.8.9 0 1.7-.3 1.7-.8zM26 3l-2.3 13c0 .6 1 1.2 2.3 1.2 1.3 0 2.3-.5 2.3-1.2L26 3z"/></symbol><symbol id="InsertChartConeStacked" viewBox="0 0 32 32"><style>.s91{fill:#ffb115}.s92{fill:#039c23}</style><path class="s92" d="M8 20l2 6c0 1.1-1.8 2-4 2s-4-.9-4-2l2-6h4zm6-2l-2 8c0 1.1 1.8 2 4 2s4-.9 4-2l-2-8h-4zm10-4l-2 12c0 1.1 1.8 2 4 2s4-.9 4-2l-2-12h-4z"/><path class="s91" d="M28 14c0 .6-.9 1-2 1s-2-.4-2-1l2-11 2 11zm-12-4l-1.9 7.8c0 .1-.1.1-.1.2 0 .6.9 1 2 1s2-.4 2-1c0-.1 0-.2-.1-.2L16 10zM6 14l-1.9 5.7c-.1.1-.1.2-.1.3 0 .6.9 1 2 1s2-.4 2-1c0-.1 0-.2-.1-.3L6 14z"/></symbol><symbol id="InsertChartCylinder" viewBox="0 0 32 32"><style>.s93{fill:#d11c1c}.s94{fill:#ffb115}.s95{opacity:.5}</style><path class="s95 s93" d="M8 12c0-1.1 1.3-2 3-2s3 .9 3 2-1.3 2-3 2-3-.9-3-2zm11-2c1.7 0 3-.9 3-2s-1.3-2-3-2-3 .9-3 2 1.3 2 3 2zm8-4c1.7 0 3-.9 3-2s-1.3-2-3-2-3 .9-3 2 1.3 2 3 2z"/><path class="s93" d="M30 4v16c0 1.1-1.3 2-3 2s-3-.9-3-2V4c0 1.1 1.3 2 3 2s3-.9 3-2zM18 14c0-1.1 1.3-2 3-2 .4 0 .7 0 1 .1V8c0 1.1-1.3 2-3 2s-3-.9-3-2v12c0 .9.8 1.6 2 1.9V14zm-8 4c0-1.1 1.3-2 3-2 .4 0 .7 0 1 .1V12c0 1.1-1.3 2-3 2s-3-.9-3-2v8c0 .9.8 1.6 2 1.9V18z"/><path class="s95 s94" d="M18 14c0-1.1 1.3-2 3-2s3 .9 3 2-1.3 2-3 2-3-.9-3-2zm-5 6c1.7 0 3-.9 3-2s-1.3-2-3-2-3 .9-3 2 1.3 2 3 2zm-8 4c1.7 0 3-.9 3-2s-1.3-2-3-2-3 .9-3 2 1.3 2 3 2z"/><path class="s94" d="M24 14v12c0 1.1-1.3 2-3 2s-3-.9-3-2V14c0 1.1 1.3 2 3 2s3-.9 3-2zm-11 6c-1.7 0-3-.9-3-2v8c0 1.1 1.3 2 3 2s3-.9 3-2v-8c0 1.1-1.3 2-3 2zm-8 4c-1.7 0-3-.9-3-2v4c0 1.1 1.3 2 3 2s3-.9 3-2v-4c0 1.1-1.3 2-3 2z"/></symbol><symbol id="InsertChartCylinderClustered" viewBox="0 0 32 32"><style>.s96{fill:#1177d7}.s97{fill:#d11c1c}.s98{opacity:.5}</style><path class="s98 s97" d="M2 16c0-1.1 1.3-2 3-2s3 .9 3 2-1.3 2-3 2-3-.9-3-2zm19-2c1.7 0 3-.9 3-2s-1.3-2-3-2-3 .9-3 2 1.3 2 3 2z"/><path class="s97" d="M8 16v10c0 1.1-1.3 2-3 2s-3-.9-3-2V16c0 1.1 1.3 2 3 2s3-.9 3-2zm13-2c-1.7 0-3-.9-3-2v14c0 1.1 1.3 2 3 2s3-.9 3-2V12c0 1.1-1.3 2-3 2z"/><path class="s98 s96" d="M8 6c0-1.1 1.3-2 3-2s3 .9 3 2-1.3 2-3 2-3-.9-3-2zm19 14c1.7 0 3-.9 3-2s-1.3-2-3-2-3 .9-3 2 1.3 2 3 2z"/><path class="s96" d="M14 6v20c0 1.1-1.3 2-3 2s-3-.9-3-2V6c0 1.1 1.3 2 3 2s3-.9 3-2zm13 14c-1.7 0-3-.9-3-2v8c0 1.1 1.3 2 3 2s3-.9 3-2v-8c0 1.1-1.3 2-3 2z"/></symbol><symbol id="InsertChartCylinderPercentStacked" viewBox="0 0 32 32"><style>.s99{fill:#1177d7}.s100{fill:#d11c1c}.s101{fill:#ffb115}.s102{opacity:.5}</style><path class="s102 s99" d="M10 6v8H2V6c0-1.1 1.8-2 4-2s4 .9 4 2zm6-2c-2.2 0-4 .9-4 2v8h8V6c0-1.1-1.8-2-4-2zm10 0c-2.2 0-4 .9-4 2v8h8V6c0-1.1-1.8-2-4-2z"/><path class="s99" d="M10 6v10c0 1.1-1.8 2-4 2s-4-.9-4-2V6c0 1.1 1.8 2 4 2s4-.9 4-2zm6 2c-2.2 0-4-.9-4-2v10c0 1.1 1.8 2 4 2s4-.9 4-2V6c0 1.1-1.8 2-4 2zm10 0c-2.2 0-4-.9-4-2v10c0 1.1 1.8 2 4 2s4-.9 4-2V6c0 1.1-1.8 2-4 2z"/><path class="s101" d="M10 12v10c0 1.1-1.8 2-4 2s-4-.9-4-2V12c0 1.1 1.8 2 4 2s4-.9 4-2zm6 0c-2.2 0-4-.9-4-2v14c0 1.1 1.8 2 4 2s4-.9 4-2V10c0 1.1-1.8 2-4 2zm10 4c-2.2 0-4-.9-4-2v10c0 1.1 1.8 2 4 2s4-.9 4-2V14c0 1.1-1.8 2-4 2z"/><path class="s100" d="M10 18v8c0 1.1-1.8 2-4 2s-4-.9-4-2v-8c0 1.1 1.8 2 4 2s4-.9 4-2zm6 4c-2.2 0-4-.9-4-2v6c0 1.1 1.8 2 4 2s4-.9 4-2v-6c0 1.1-1.8 2-4 2zm10-2c-2.2 0-4-.9-4-2v8c0 1.1 1.8 2 4 2s4-.9 4-2v-8c0 1.1-1.8 2-4 2z"/></symbol><symbol id="InsertChartCylinderStacked" viewBox="0 0 32 32"><style>.s103{fill:#1177d7}.s104{fill:#d11c1c}.s105{fill:#ffb115}.s106{opacity:.5}</style><path class="s106 s103" d="M10 14v8H2v-8c0-1.1 1.8-2 4-2s4 .9 4 2zm6-6c-2.2 0-4 .9-4 2v8h8v-8c0-1.1-1.8-2-4-2zm10-4c-2.2 0-4 .9-4 2v8h8V6c0-1.1-1.8-2-4-2z"/><path class="s103" d="M10 14v10c0 1.1-1.8 2-4 2s-4-.9-4-2V14c0 1.1 1.8 2 4 2s4-.9 4-2zm6-2c-2.2 0-4-.9-4-2v10c0 1.1 1.8 2 4 2s4-.9 4-2V10c0 1.1-1.8 2-4 2zm10-4c-2.2 0-4-.9-4-2v10c0 1.1 1.8 2 4 2s4-.9 4-2V6c0 1.1-1.8 2-4 2z"/><path class="s105" d="M10 18v6c0 1.1-1.8 2-4 2s-4-.9-4-2v-6c0 1.1 1.8 2 4 2s4-.9 4-2zm6-2c-2.2 0-4-.9-4-2v10c0 1.1 1.8 2 4 2s4-.9 4-2V14c0 1.1-1.8 2-4 2zm10-2c-2.2 0-4-.9-4-2v10c0 1.1 1.8 2 4 2s4-.9 4-2V12c0 1.1-1.8 2-4 2z"/><path class="s104" d="M10 22v4c0 1.1-1.8 2-4 2s-4-.9-4-2v-4c0 1.1 1.8 2 4 2s4-.9 4-2zm6 0c-2.2 0-4-.9-4-2v6c0 1.1 1.8 2 4 2s4-.9 4-2v-6c0 1.1-1.8 2-4 2zm10-2c-2.2 0-4-.9-4-2v8c0 1.1 1.8 2 4 2s4-.9 4-2v-8c0 1.1-1.8 2-4 2z"/></symbol><symbol id="InsertChartDoughnut2D" viewBox="0 0 32 32"><style>.s107{fill:#1177d7}.s108{fill:#d11c1c}.s109{fill:#ffb115}</style><path class="s109" d="M19.2 20.6c-.9.7-2 1.1-3.2 1.3V30c3.4-.2 6.5-1.6 8.9-3.7l-5.7-5.7z"/><path class="s107" d="M26.3 5.1l-5.7 5.7C21.5 12 22 13.4 22 15s-.5 3-1.4 4.2l5.7 5.7c2.3-2.6 3.7-6.1 3.7-9.9 0-3.8-1.4-7.2-3.7-9.9z"/><path class="s108" d="M8 14.9c0-3.9 3.1-7 7-7 1.6 0 3 .5 4.2 1.4l5.7-5.7C22.2 1.4 18.8 0 15 0 6.7 0 0 6.7 0 15c0 7.9 6.2 14.4 14 14.9v-8.1c-3.4-.4-6-3.3-6-6.9z"/></symbol><symbol id="InsertChartDoughnut2DCommandGroup" viewBox="0 0 32 32"><style>.s110{fill:#1177d7}.s111{fill:#d11c1c}.s112{fill:#ffb115}</style><path class="s112" d="M19.2 20.6c-.9.7-2 1.1-3.2 1.3V30c3.4-.2 6.5-1.6 8.9-3.7l-5.7-5.7z"/><path class="s110" d="M26.3 5.1l-5.7 5.7C21.5 12 22 13.4 22 15s-.5 3-1.4 4.2l5.7 5.7c2.3-2.6 3.7-6.1 3.7-9.9 0-3.8-1.4-7.2-3.7-9.9z"/><path class="s111" d="M8 14.9c0-3.9 3.1-7 7-7 1.6 0 3 .5 4.2 1.4l5.7-5.7C22.2 1.4 18.8 0 15 0 6.7 0 0 6.7 0 15c0 7.9 6.2 14.4 14 14.9v-8.1c-3.4-.4-6-3.3-6-6.9z"/></symbol><symbol id="InsertChartDoughnutExploded2D" viewBox="0 0 32 32"><style>.s113{fill:#1177d7}.s114{fill:#d11c1c}</style><path class="s114" d="M8 17c0 3.9 3.1 7 7 7 1.6 0 3-.5 4.2-1.4l5.7 5.7C22.3 30.6 18.8 32 15 32 6.7 32 0 25.3 0 17 0 9 6.2 2.5 14 2v8.1c-3.4.5-6 3.4-6 6.9z"/><path class="s113" d="M24 14.9c0 1.6-.5 3-1.4 4.2l5.7 5.7c2.3-2.6 3.7-6.1 3.7-9.8C32 7 25.8.5 18 0v8c3.4.5 6 3.4 6 6.9z"/></symbol><symbol id="InsertChartHorizontalConeClustered" viewBox="0 0 32 32"><style>.s115{fill:#d11c1c}.s116{fill:#ffb115}</style><path class="s116" d="M6 8C4.9 8 4 6.7 4 5s.9-3 2-3l10 3L6 8zm22 13L6 18c-1.1 0-2 1.3-2 3s.9 3 2 3l22-3z"/><path class="s115" d="M6 14c-1.1 0-2-1.3-2-3s.9-3 2-3l18 3-18 3zm14 13L6 24c-1.1 0-2 1.3-2 3s.9 3 2 3l14-3z"/></symbol><symbol id="InsertChartHorizontalConePercentStacked" viewBox="0 0 32 32"><style>.s117{fill:#d11c1c}.s118{fill:#ffb115}</style><path class="s118" d="M18 8L6 10c-1.1 0-2-1.8-2-4s.9-4 2-4l12 2v4zm2 6.3L6 12c-1.1 0-2 1.8-2 4s.9 4 2 4l14-2.3v-3.4zm-4 9.4L6 22c-1.1 0-2 1.8-2 4s.9 4 2 4l10-1.7v-4.6z"/><path class="s117" d="M18 8c-.6 0-1-.9-1-2s.4-2 1-2l11 2-11 2zm2 9.7l9-1.7-9-1.7c-.5 0-.8.7-.8 1.7 0 .9.3 1.7.8 1.7zm9 8.3l-13-2.3c-.6 0-1.2 1-1.2 2.3s.5 2.3 1.2 2.3L29 26z"/></symbol><symbol id="InsertChartHorizontalConeStacked" viewBox="0 0 32 32"><style>.s119{fill:#d11c1c}.s120{fill:#ffb115}</style><path class="s120" d="M12 8l-6 2c-1.1 0-2-1.8-2-4s.9-4 2-4l6 2v4zm2 6l-8-2c-1.1 0-2 1.8-2 4s.9 4 2 4l8-2v-4zm4 10L6 22c-1.1 0-2 1.8-2 4s.9 4 2 4l12-2v-4z"/><path class="s119" d="M29 26l-11 2c-.6 0-1-.9-1-2s.4-2 1-2l11 2zM18 6l-5.7-1.9c-.1-.1-.2-.1-.3-.1-.6 0-1 .9-1 2s.4 2 1 2c.1 0 .2 0 .3-.1L18 6zm4 10l-7.8-1.9c0-.1-.1-.1-.2-.1-.6 0-1 .9-1 2s.4 2 1 2c.1 0 .2 0 .2-.1L22 16z"/></symbol><symbol id="InsertChartHorizontalCylinderClustered" viewBox="0 0 32 32"><style>.s121{fill:#1177d7}.s122{fill:#d11c1c}.s123{opacity:.75}</style><path class="s121" d="M26 8c1.1 0 2 1.3 2 3s-.9 3-2 3-2-1.3-2-3 .9-3 2-3zM12 27c0 1.7.9 3 2 3s2-1.3 2-3-.9-3-2-3-2 1.3-2 3z"/><path class="s122" d="M16 2c1.1 0 2 1.3 2 3s-.9 3-2 3-2-1.3-2-3 .9-3 2-3zm2 19c0 1.7.9 3 2 3s2-1.3 2-3-.9-3-2-3-2 1.3-2 3z"/><g class="s123"><path class="s122" d="M16 8H6C4.9 8 4 6.7 4 5s.9-3 2-3h10c-1.1 0-2 1.3-2 3s.9 3 2 3zm2 13c0-1.7.9-3 2-3H6c-1.1 0-2 1.3-2 3s.9 3 2 3h14c-1.1 0-2-1.3-2-3z"/><path class="s121" d="M26 14H6c-1.1 0-2-1.3-2-3s.9-3 2-3h20c-1.1 0-2 1.3-2 3s.9 3 2 3zM12 27c0-1.7.9-3 2-3H6c-1.1 0-2 1.3-2 3s.9 3 2 3h8c-1.1 0-2-1.3-2-3z"/></g></symbol><symbol id="InsertChartHorizontalCylinderPercentStacked" viewBox="0 0 32 32"><style>.s124{fill:#1177d7}.s125{fill:#d11c1c}.s126{opacity:.75}</style><path class="s124" d="M28 6c0 2.2-.9 4-2 4s-2-1.8-2-4 .9-4 2-4 2 1.8 2 4zm-2 6c-1.1 0-2 1.8-2 4s.9 4 2 4 2-1.8 2-4-.9-4-2-4zm0 10c-1.1 0-2 1.8-2 4s.9 4 2 4 2-1.8 2-4-.9-4-2-4z"/><g class="s126"><path class="s124" d="M26 10H12c-1.1 0-2-1.8-2-4s.9-4 2-4h14c-1.1 0-2 1.8-2 4s.9 4 2 4zm-2 6c0-2.2.9-4 2-4h-6c-1.1 0-2 1.8-2 4s.9 4 2 4h6c-1.1 0-2-1.8-2-4zm0 10c0-2.2.9-4 2-4H16c-1.1 0-2 1.8-2 4s.9 4 2 4h10c-1.1 0-2-1.8-2-4z"/><path class="s125" d="M12 10H4c-1.1 0-2-1.8-2-4s.9-4 2-4h8c-1.1 0-2 1.8-2 4s.9 4 2 4zm6 6c0-2.2.9-4 2-4H4c-1.1 0-2 1.8-2 4s.9 4 2 4h16c-1.1 0-2-1.8-2-4zm-4 10c0-2.2.9-4 2-4H4c-1.1 0-2 1.8-2 4s.9 4 2 4h12c-1.1 0-2-1.8-2-4z"/></g></symbol><symbol id="InsertChartHorizontalCylinderStacked" viewBox="0 0 32 32"><style>.s127{fill:#1177d7}.s128{fill:#d11c1c}.s129{opacity:.75}</style><path class="s127" d="M20 6c0 2.2-.9 4-2 4s-2-1.8-2-4 .9-4 2-4 2 1.8 2 4zm2 6c-1.1 0-2 1.8-2 4s.9 4 2 4 2-1.8 2-4-.9-4-2-4zm6 10c-1.1 0-2 1.8-2 4s.9 4 2 4 2-1.8 2-4-.9-4-2-4z"/><g class="s129"><path class="s127" d="M18 10h-6c-1.1 0-2-1.8-2-4s.9-4 2-4h6c-1.1 0-2 1.8-2 4s.9 4 2 4zm2 6c0-2.2.9-4 2-4h-6c-1.1 0-2 1.8-2 4s.9 4 2 4h6c-1.1 0-2-1.8-2-4zm6 10c0-2.2.9-4 2-4h-6c-1.1 0-2 1.8-2 4s.9 4 2 4h6c-1.1 0-2-1.8-2-4z"/><path class="s128" d="M12 10H6c-1.1 0-2-1.8-2-4s.9-4 2-4h6c-1.1 0-2 1.8-2 4s.9 4 2 4zm2 6c0-2.2.9-4 2-4H6c-1.1 0-2 1.8-2 4s.9 4 2 4h10c-1.1 0-2-1.8-2-4zm6 10c0-2.2.9-4 2-4H6c-1.1 0-2 1.8-2 4s.9 4 2 4h16c-1.1 0-2-1.8-2-4z"/></g></symbol><symbol id="InsertChartHorizontalPyramidClustered" viewBox="0 0 32 32"><style>.s130{fill:#ffb115}.s131{fill:#1177d7}.s132{opacity:.75}</style><path class="s130" d="M4 26l14 3-14 3v-6zm0-12l24-3L4 8v6z"/><path class="s131" d="M4 20l20 3-20 3v-6zM4 8l16-3L4 2v6z"/><g class="s132"><path class="s130" d="M18 29L4 26l5-.8 9 3.8zM9.9 6.9L4 8l24 3L9.9 6.9z"/><path class="s131" d="M6 18l18 5-20-3 2-2zM4 2l16 3L6 0 4 2z"/></g></symbol><symbol id="InsertChartHorizontalPyramidPercentStacked" viewBox="0 0 32 32"><style>.s133{fill:#ffb115}.s134{fill:#1177d7}.s135{opacity:.75}</style><g class="s135"><path class="s133" d="M6 18l22 6-24-4 2-2zM4 6l24 4L6 4 4 6z"/><path class="s134" d="M16 8L4 6l2-2 11 3-1 1zm-4.5 11.5L6 18l-2 2 6 1 1.5-1.5z"/></g><path class="s134" d="M16 12L4 14V6l12 2v4zm-6 9l-6-1v8l6-1v-6z"/><path class="s133" d="M28 10l-12 2V8l12 2zM10 27l18-3-18-3v6z"/></symbol><symbol id="InsertChartHorizontalPyramidStacked" viewBox="0 0 32 32"><style>.s136{fill:#ffb115}.s137{fill:#1177d7}.s138{opacity:.75}</style><g class="s138"><path class="s136" d="M6 18l14 6-16-4 2-2zM4 6l24 4L6 4 4 6z"/><path class="s137" d="M16 8L4 6l2-2 11 3-1 1zm-3 13l-7-3-2 2 8 2 1-1z"/></g><path class="s137" d="M16 12L4 14V6l12 2v4zm-4 10l-8-2v8l8-2v-4z"/><path class="s136" d="M28 10l-12 2V8l12 2zM12 26l8-2-8-2v4z"/></symbol><symbol id="InsertChartLine" viewBox="0 0 32 32"><style>.s139{fill:#1177d7}.s140{fill:#ffb115}.s141{fill:#d11c1c}</style><path class="s141" d="M2.8 5.8L3.7 4l11.6 5.7L28.8 2l1 1.7L15.3 12 2.8 5.8z"/><path class="s140" d="M2.7 17.6l1.2-1.5 11.3 9.4 13.4-13.3 1.4 1.4-14.6 14.6L2.7 17.6z"/><path class="s139" d="M2.7 28.1l12.4-10.3 14.5 4.1-.6 1.9L15.5 20 3.9 29.6l-1.2-1.5z"/></symbol><symbol id="InsertChartLine3D" viewBox="0 0 32 32"><style>.s142{fill:#1177d7}.s143{fill:#d11c1c}.s144{opacity:.5}.s145{opacity:.75}.s146{opacity:.35}</style><path transform="rotate(-45.001 14 10.173)" class="s144 s142" d="M12.6 5.9h2.8v8.5h-2.8z"/><path class="s145 s142" d="M26 4.2l-10 10-6-6-8 8V19l8-8 6 6L26 7z"/><path class="s142" d="M26 4.2V7l2-2V2.2z"/><path transform="rotate(-45.001 14 21)" class="s144 s143" d="M12.6 16.8h2.8v8.5h-2.8z"/><path class="s143" d="M26 25v2l2-2v-2z"/><path class="s145 s143" d="M26 27v-2H16l-6-6-8 8v2.8l8-8 5.2 5.2z"/><path class="s146 s143" d="M18 23h10l-2 2H16z"/></symbol><symbol id="InsertChartLineCommandGroup" viewBox="0 0 32 32"><style>.s147{fill:#1177d7}.s148{fill:#d11c1c}.s149{fill:#ffb115}</style><path class="s149" d="M29 10c-1.7 0-3 1.3-3 3 0 .5.1.9.3 1.3l-10 10c-.4-.2-.8-.3-1.3-.3-.6 0-1.1.2-1.5.4L5.8 18c.1-.3.2-.6.2-1 0-1.7-1.3-3-3-3s-3 1.3-3 3 1.3 3 3 3c.6 0 1.1-.2 1.5-.4l7.7 6.4c-.1.3-.2.7-.2 1 0 1.7 1.3 3 3 3s3-1.3 3-3c0-.5-.1-.9-.3-1.3l10-10c.4.2.8.3 1.3.3 1.7 0 3-1.3 3-3s-1.3-3-3-3zM3 18c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm12 10c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm14-14c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1z"/><path class="s147" d="M29 20c-1 0-1.9.5-2.4 1.3L18 18.8c-.1-1.6-1.4-2.8-3-2.8-1.7 0-3 1.3-3 3 0 .4.1.7.2 1l-7.7 6.4c-.4-.2-.9-.4-1.5-.4-1.7 0-3 1.3-3 3s1.3 3 3 3 3-1.3 3-3c0-.4-.1-.7-.2-1l7.7-6.4c.4.3 1 .4 1.5.4 1 0 1.9-.5 2.4-1.3l8.6 2.5c.1 1.6 1.4 2.8 3 2.8 1.7 0 3-1.3 3-3s-1.3-3-3-3zM3 30c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm12-10c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm14 4c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1z"/><path class="s148" d="M29 0c-1.7 0-3 1.3-3 3 0 .2 0 .4.1.5L17 8.7c-.6-.4-1.3-.7-2-.7-.8 0-1.5.3-2.1.8L6 5.4V5c0-1.7-1.3-3-3-3S0 3.3 0 5s1.3 3 3 3c.8 0 1.5-.3 2.1-.8l7 3.5v.4c0 1.7 1.3 3 3 3s3-1.3 3-3c0-.2 0-.4-.1-.5l9.1-5.2c.5.3 1.2.6 1.9.6 1.7 0 3-1.3 3-3s-1.3-3-3-3zM3 6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm12 6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm14-8c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1z"/></symbol><symbol id="InsertChartLineWithMarkers" viewBox="0 0 32 32"><style>.s150{fill:#1177d7}.s151{fill:#d11c1c}.s152{fill:#ffb115}</style><path class="s152" d="M29 10c-1.7 0-3 1.3-3 3 0 .5.1.9.3 1.3l-10 10c-.4-.2-.8-.3-1.3-.3-.6 0-1.1.2-1.5.4L5.8 18c.1-.3.2-.6.2-1 0-1.7-1.3-3-3-3s-3 1.3-3 3 1.3 3 3 3c.6 0 1.1-.2 1.5-.4l7.7 6.4c-.1.3-.2.7-.2 1 0 1.7 1.3 3 3 3s3-1.3 3-3c0-.5-.1-.9-.3-1.3l10-10c.4.2.8.3 1.3.3 1.7 0 3-1.3 3-3s-1.3-3-3-3zM3 18c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm12 10c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm14-14c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1z"/><path class="s150" d="M29 20c-1 0-1.9.5-2.4 1.3L18 18.8c-.1-1.6-1.4-2.8-3-2.8-1.7 0-3 1.3-3 3 0 .4.1.7.2 1l-7.7 6.4c-.4-.2-.9-.4-1.5-.4-1.7 0-3 1.3-3 3s1.3 3 3 3 3-1.3 3-3c0-.4-.1-.7-.2-1l7.7-6.4c.4.3 1 .4 1.5.4 1 0 1.9-.5 2.4-1.3l8.6 2.5c.1 1.6 1.4 2.8 3 2.8 1.7 0 3-1.3 3-3s-1.3-3-3-3zM3 30c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm12-10c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm14 4c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1z"/><path class="s151" d="M29 0c-1.7 0-3 1.3-3 3 0 .2 0 .4.1.5L17 8.7c-.6-.4-1.3-.7-2-.7-.8 0-1.5.3-2.1.8L6 5.4V5c0-1.7-1.3-3-3-3S0 3.3 0 5s1.3 3 3 3c.8 0 1.5-.3 2.1-.8l7 3.5v.4c0 1.7 1.3 3 3 3s3-1.3 3-3c0-.2 0-.4-.1-.5l9.1-5.2c.5.3 1.2.6 1.9.6 1.7 0 3-1.3 3-3s-1.3-3-3-3zM3 6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm12 6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm14-8c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1z"/></symbol><symbol id="InsertChartPercentStackedArea" viewBox="0 0 32 32"><style>.s153{fill:#1177d7}.s154{fill:#d11c1c}.s155{fill:#ffb115}</style><path class="s154" d="M2 28v-6l12-2 16 4v4z"/><path class="s155" d="M2 10l12 4 16-6v16l-16-4-12 2z"/><path class="s153" d="M2 2v8l12 4 16-6V2z"/></symbol><symbol id="InsertChartPercentStackedArea3D" viewBox="0 0 32 32"><style>.s156{fill:#1177d7}.s157{fill:#d11c1c}.s158{fill:#ffb115}.s159{opacity:.5}.s160{opacity:.75}</style><path class="s158" d="M24 28l4-4v-6l-4 4z"/><path class="s159 s157" d="M2 6l4-4h22l-4 4z"/><path class="s157" d="M28 18V2l-4 4v16z"/><g class="s160"><path class="s158" d="M2 28V12l6 6 6-6 10 10v6z"/><path class="s157" d="M2 6v6l6 6 6-6 10 10V6z"/></g></symbol><symbol id="InsertChartPercentStackedLine" viewBox="0 0 32 32"><style>.s161{fill:#1177d7}.s162{fill:#ffb115}.s163{fill:#d11c1c}</style><path class="s163" d="M2 4h26v2H2z"/><path class="s162" d="M1.7 13.9l.6-1.9L14 15.9 27.7 12l.6 1.9L14 18 1.7 13.9z"/><path class="s161" d="M2.4 29.9zm-.8-1.8L13.9 22l14.4 4.1-.6 1.9-13.6-3.9-11.7 5.8-.8-1.8z"/></symbol><symbol id="InsertChartPercentStackedLineWithMarkers" viewBox="0 0 32 32"><style>.s164{fill:#1177d7}.s165{fill:#ffb115}.s166{fill:#d11c1c}</style><path class="s166" d="M29 0c-1.3 0-2.4.8-2.8 2h-8.4C17.4.8 16.3 0 15 0c-1.3 0-2.4.8-2.8 2H5.8C5.4.8 4.3 0 3 0 1.3 0 0 1.3 0 3s1.3 3 3 3c1.3 0 2.4-.8 2.8-2h6.4c.4 1.2 1.5 2 2.8 2 1.3 0 2.4-.8 2.8-2h8.4c.4 1.2 1.5 2 2.8 2 1.7 0 3-1.3 3-3s-1.3-3-3-3zM3 4c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm12 0c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm14 0c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1z"/><path class="s165" d="M29 8c-1.6 0-2.9 1.2-3 2.8l-8.6 2.5C16.9 12.5 16 12 15 12s-1.8.5-2.4 1.2L6 10.9C6 9.3 4.6 8 3 8c-1.7 0-3 1.3-3 3s1.3 3 3 3c1 0 1.8-.5 2.4-1.2l6.7 2.2c0 1.6 1.4 2.9 3 2.9s2.9-1.2 3-2.8l8.6-2.5c.4.9 1.3 1.4 2.3 1.4 1.7 0 3-1.3 3-3s-1.3-3-3-3zM3 12c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm12 4c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm14-4c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1z"/><path class="s164" d="M29 24c-1 0-1.9.5-2.4 1.3L18 22.8c-.1-1.6-1.4-2.8-3-2.8-1.7 0-3 1.3-3 3v.4l-7 3.5c-.5-.6-1.2-.9-2-.9-1.7 0-3 1.3-3 3s1.3 3 3 3 3-1.3 3-3v-.4l7-3.5c.5.5 1.3.8 2.1.8 1 0 1.9-.5 2.4-1.3l8.6 2.5c.1 1.6 1.4 2.8 3 2.8 1.7 0 3-1.3 3-3C32 25.3 30.7 24 29 24zM3 30c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm12-6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm14 4c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1z"/></symbol><symbol id="InsertChartPie2D" viewBox="0 0 32 32"><style>.s167{fill:#1177d7}.s168{fill:#d11c1c}.s169{fill:#ffb115}</style><path class="s167" d="M26.3 5.1L16.4 15l9.9 9.9c2.3-2.6 3.7-6.1 3.7-9.9 0-3.8-1.4-7.2-3.7-9.9z"/><path class="s168" d="M14 16v-1.4L24.9 3.7C22.2 1.4 18.8 0 15 0 6.7 0 0 6.7 0 15c0 7.9 6.2 14.4 14 14.9V16z"/><path class="s169" d="M16 29.9c3.4-.2 6.5-1.6 8.9-3.7L16 17.4v12.5z"/></symbol><symbol id="InsertChartPie3D" viewBox="0 0 32 32"><style>.s170{fill:#1177d7}.s171{fill:#d11c1c}.s172{fill:#ffb115}.s173{opacity:.65}</style><path class="s171" d="M0 12v6c0 5.3 6.2 9.6 14 10v-6c-7.8-.4-14-4.7-14-10z"/><path class="s172" d="M16 22v6c3-.1 5.7-.9 8-2v-6c-2.3 1.1-5 1.8-8 2z"/><path class="s170" d="M26 18.8v6c2.5-1.8 4-4.2 4-6.8v-6c0 2.6-1.5 5-4 6.8z"/><g class="s173"><path class="s171" d="M14 12v-.6L24.1 4c-2.5-1.2-5.7-2-9.1-2C6.7 2 0 6.5 0 12c0 5.3 6.2 9.6 14 10V12z"/><path class="s170" d="M26 5.2L16.6 12l9.4 6.8c2.5-1.8 4-4.2 4-6.8 0-2.6-1.5-5-4-6.8z"/><path class="s172" d="M16 14v8c3-.1 5.7-.8 8-2l-8-6z"/></g></symbol><symbol id="InsertChartPieCommandGroup" viewBox="0 0 32 32"><style>.s174{fill:#1177d7}.s175{fill:#d11c1c}.s176{fill:#ffb115}</style><path class="s174" d="M26.3 5.1L16.4 15l9.9 9.9c2.3-2.6 3.7-6.1 3.7-9.9 0-3.8-1.4-7.2-3.7-9.9z"/><path class="s175" d="M14 16v-1.4L24.9 3.7C22.2 1.4 18.8 0 15 0 6.7 0 0 6.7 0 15c0 7.9 6.2 14.4 14 14.9V16z"/><path class="s176" d="M16 29.9c3.4-.2 6.5-1.6 8.9-3.7L16 17.4v12.5z"/></symbol><symbol id="InsertChartPieExploded2D" viewBox="0 0 32 32"><style>.s177{fill:#1177d7}.s178{fill:#d11c1c}</style><path class="s178" d="M14 2C6.3 2 0 8.3 0 16s6.3 14 14 14c3.9 0 7.4-1.6 9.9-4.1L14 16V2z"/><path class="s177" d="M18 0v14l9.9 9.9c2.5-2.5 4.1-6 4.1-9.9 0-7.7-6.3-14-14-14z"/></symbol><symbol id="InsertChartPieExploded3D" viewBox="0 0 32 32"><style>.s179{fill:#1177d7}.s180{fill:#d11c1c}.s181{opacity:.65}.s182{opacity:.85}</style><path class="s180" d="M0 13v6c0 5 6.3 9 14 9 3.9 0 7.2-1 9.7-2.6v-6C21.2 21 17.9 22 14 22c-7.7 0-14-4-14-9z"/><g class="s181"><path class="s179" d="M18 4v9l9.7 6.4c2.5-1.6 4.3-3.9 4.3-6.4 0-5-6.3-9-14-9z"/><path class="s180" d="M14 4C6.3 4 0 8 0 13s6.3 9 14 9c3.9 0 7.2-1 9.7-2.6L14 13V4z"/></g><path class="s182 s179" d="M27.7 19.4L18 13v2.6l5.7 3.8v3.3l4 2.7z"/><path class="s179" d="M27.7 19.4v6c2.5-1.6 4.3-3.9 4.3-6.4v-6c0 2.5-1.8 4.7-4.3 6.4z"/></symbol><symbol id="InsertChartPyramid" viewBox="0 0 32 32"><style>.s183{fill:#ffb115}.s184{fill:#d11c1c}.s185{opacity:.75}</style><path class="s184" d="M11.5 21.2L9 8l3.3 9.3-.8 3.9zm8.7-4.9L17 6l2.4 14.5.8-4.2zM30 22L25 4l3 20 2-2z"/><path class="s183" d="M8 28L5 16l5 10-2 2zm10-2l-5-12 3 14 2-2zm8 0l-5-14 3 16 2-2z"/><g class="s185"><path class="s184" d="M10.9 24H9l-2.2-4.4L9 8l2.5 13.2-.6 2.8zm8.5-3.5L17 6l-2.1 12.6 2.3 5.4h1.6l.6-3.5zm5.9 3.5H28L25 4l-2 13.5 2.3 6.5z"/><path class="s183" d="M2 28l3-12 3 12H2zm14 0l-3-14-3 14h6zm8 0l-3-16-3 16h6z"/></g></symbol><symbol id="InsertChartPyramidClustered" viewBox="0 0 32 32"><style>.s186{fill:#ffb115}.s187{fill:#d11c1c}.s188{opacity:.75}</style><path class="s188 s186" d="M0 28l3-14 3 14H0zm24 0L21 4l-3 24h6z"/><path class="s188 s187" d="M6 28L9 8l3 20H6zm24 0l-3-16-3 16h6z"/><path class="s186" d="M6.8 23L6 28 3 14l3.8 9zM21 4l3 24 1.1-5.9L21 4z"/><path class="s187" d="M12 28L9 8l5 18-2 2zm20-2l-5-14 3 16 2-2z"/></symbol><symbol id="InsertChartPyramidPercentStacked" viewBox="0 0 32 32"><style>.s189{fill:#ffb115}.s190{fill:#d11c1c}.s191{opacity:.75}</style><path class="s189" d="M26 28L22 4l6 22-2 2zm-12-2L8 4l4 24 2-2z"/><path class="s190" d="M25 15l3 11-2 2-2-12 1-1zm-14 7l1 6 2-2-1.5-5.5L11 22z"/><g class="s191"><path class="s190" d="M24 16l2 12h-8l2-12h4zM5 22l-1 6h8l-1-6H5z"/><path class="s189" d="M24 16h-4l2-12 2 12zm-13 6L8 4 5 22h6z"/></g></symbol><symbol id="InsertChartPyramidStacked" viewBox="0 0 32 32"><style>.s192{fill:#ffb115}.s193{fill:#d11c1c}.s194{opacity:.75}</style><path class="s192" d="M12 28L8 12l6 14-2 2zm16-2L22 4l4 24 2-2z"/><path class="s193" d="M25 15l3 11-2 2-2-12 1-1zm-15 5l2 8 2-2-3-7-1 1z"/><g class="s194"><path class="s193" d="M24 16l2 12h-8l2-12h4zM6 20l-2 8h8l-2-8H6z"/><path class="s192" d="M24 16h-4l2-12 2 12zm-14 4l-2-8-2 8h4z"/></g></symbol><symbol id="InsertChartRadar" viewBox="0 0 32 32"><style>.s195{fill:#727272}.s196{fill:#d11c1c}.s197{opacity:.5}</style><g class="s197"><path class="s195" d="M16 0C7.2 0 0 7.2 0 16s7.2 16 16 16 16-7.2 16-16S24.8 0 16 0zm0 30C8.3 30 2 23.7 2 16S8.3 2 16 2s14 6.3 14 14-6.3 14-14 14z"/><path class="s195" d="M16 6C10.5 6 6 10.5 6 16s4.5 10 10 10 10-4.5 10-10S21.5 6 16 6zm0 18c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8z"/><path class="s195" d="M16 12c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4zm0 6c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></g><path class="s196" d="M5.3 14.7l-.7-.7L16.4 2.2l4.4 11.1 6.8 4.5-9.6 9.6L5.3 14.7zM18 24.6l6.4-6.4-5.2-3.5-3.6-8.9L7.4 14 18 24.6z"/></symbol><symbol id="InsertChartRadarCommandGroup" viewBox="0 0 32 32"><style>.s198{fill:#727272}.s199{fill:#d11c1c}.s200{opacity:.5}</style><g class="s200"><path class="s198" d="M16 0C7.2 0 0 7.2 0 16s7.2 16 16 16 16-7.2 16-16S24.8 0 16 0zm0 30C8.3 30 2 23.7 2 16S8.3 2 16 2s14 6.3 14 14-6.3 14-14 14z"/><path class="s198" d="M16 6C10.5 6 6 10.5 6 16s4.5 10 10 10 10-4.5 10-10S21.5 6 16 6zm0 18c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8z"/><path class="s198" d="M16 12c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4zm0 6c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></g><path class="s199" d="M5.3 14.7l-.7-.7L16.4 2.2l4.4 11.1 6.8 4.5-9.6 9.6L5.3 14.7zM18 24.6l6.4-6.4-5.2-3.5-3.6-8.9L7.4 14 18 24.6z"/></symbol><symbol id="InsertChartRadarFilled" viewBox="0 0 32 32"><style>.s201{fill:#727272}.s202{fill:#d11c1c}.s203{opacity:.5}.s204{opacity:.75}</style><g class="s203"><path class="s201" d="M16 0C7.2 0 0 7.2 0 16s7.2 16 16 16 16-7.2 16-16S24.8 0 16 0zm0 30C8.3 30 2 23.7 2 16S8.3 2 16 2s14 6.3 14 14-6.3 14-14 14z"/><path class="s201" d="M16 6C10.5 6 6 10.5 6 16s4.5 10 10 10 10-4.5 10-10S21.5 6 16 6zm0 18c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8z"/><path class="s201" d="M16 12c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4zm0 6c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></g><path class="s202" d="M8 14c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm8-12c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm4 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-8 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/><path class="s204 s202" d="M15.9 23.9c.5-.5 1.3-.9 2.1-.9s1.6.3 2.1.9l3.8-3.8c-.6-.5-.9-1.3-.9-2.1 0-.6.2-1.2.5-1.7l-1-.7C22 16.5 21 17 20 17c-1.7 0-3-1.3-3-3 0-1.3.8-2.3 1.9-2.8l-1.8-4.4c-.3.1-.7.2-1.1.2-.8 0-1.6-.3-2.1-.9l-5.8 5.8c.6.5.9 1.3.9 2.1s-.3 1.6-.9 2.1l7.8 7.8z"/></symbol><symbol id="InsertChartRadarWithMarkers" viewBox="0 0 32 32"><style>.s205{fill:#727272}.s206{fill:#d11c1c}.s207{opacity:.5}</style><g class="s207"><path class="s205" d="M16 0C7.2 0 0 7.2 0 16s7.2 16 16 16 16-7.2 16-16S24.8 0 16 0zm0 30C8.3 30 2 23.7 2 16S8.3 2 16 2s14 6.3 14 14-6.3 14-14 14z"/><path class="s205" d="M16 6C10.5 6 6 10.5 6 16s4.5 10 10 10 10-4.5 10-10S21.5 6 16 6zm0 18c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8z"/><path class="s205" d="M16 12c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4zm0 6c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></g><path class="s206" d="M8 14c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm8-12c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm4 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-8 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM8.7 12.7l6-6c-.6-.3-1.1-.8-1.4-1.4l-6 6c.6.3 1.1.8 1.4 1.4zM19.9 11L18 6.2c-.5.5-1.2.8-1.9.8l1.9 4.8c.5-.5 1.2-.8 1.9-.8zm4.3 4.6l-1.3-.9c-.2.7-.6 1.3-1.1 1.7l1.3.9c.2-.7.6-1.3 1.1-1.7zm-7.5 7.7l-8-8c-.3.6-.8 1.1-1.4 1.4l8 8c.3-.6.8-1.1 1.4-1.4zm4 1.4l4-4c-.6-.3-1.1-.8-1.4-1.4l-4 4c.6.3 1.1.8 1.4 1.4z"/></symbol><symbol id="InsertChartScatterCommandGroup" viewBox="0 0 32 32"><style>.s208{fill:#1177d7}.s209{fill:#ffb115}</style><path class="s208" d="M6 8c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm4 14c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm8-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm4-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/><path class="s209" d="M8 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm4-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM4 26c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM20 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm8 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></symbol><symbol id="InsertChartScatterLines" viewBox="0 0 32 32"><style>.s210{fill:#1177d7}.s211{fill:#ffb115}</style><path class="s211" d="M8 6.2l-3.1 6.3-1.8-.9L8 1.8l12.3 22.5 7.1-7.1 1.4 1.4-8.9 8.9L8 6.2zm-3.1 6.2z"/><path class="s210" d="M4.4 24.9zm-.8-1.8l15.8-7.9 7.9-9.8 1.6 1.2-8.1 10.2-16.4 8.1-.8-1.8z"/></symbol><symbol id="InsertChartScatterLinesAndMarkers" viewBox="0 0 32 32"><style>.s212{fill:#1177d7}.s213{fill:#ffb115}</style><path class="s213" d="M6 12c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zM8 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 22c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm8-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM5.8 6.1L4.4 9c.7.1 1.3.4 1.8.9l1.5-3c-.8 0-1.4-.3-1.9-.8zm13.7 17l-6.6-11.5-2.7-5.4c-.5.4-1.1.7-1.8.8l2.7 5.5 6.6 11.6c.5-.6 1.1-.9 1.8-1zm5.8-3.8l-4 4c.6.3 1.1.8 1.4 1.4l4-4c-.6-.3-1.1-.8-1.4-1.4z"/><path class="s212" d="M6 24c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zM28 4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-8 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-3 2.4L6 21.9c.5.5.8 1.1.9 1.8l11-5.5c-.5-.5-.8-1.1-.9-1.8zm8.5-8.8L21 13.2c.7.2 1.2.7 1.6 1.2L27 8.8c-.6-.2-1.2-.6-1.5-1.2z"/></symbol><symbol id="InsertChartScatterMarkers" viewBox="0 0 32 32"><style>.s214{fill:#1177d7}.s215{fill:#ffb115}</style><path class="s214" d="M6 8c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm4 14c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm8-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm4-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6-4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/><path class="s215" d="M8 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm4-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM4 26c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM20 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm8 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></symbol><symbol id="InsertChartScatterSmoothLines" viewBox="0 0 32 32"><style>.s216{fill:#1177d7}.s217{fill:#ffb115}</style><path class="s216" d="M3 24c0-3.5 2.4-5.6 4.6-6.6 2.2-1.1 4.3-1.3 4.4-1.4 0 0 .9-.1 2.4-.3 1.5-.2 3.4-.7 5.3-1.4C23.5 12.8 27 10.4 27 6h2c0 5.6-4.5 8.7-8.6 10.2-4.2 1.6-8.2 1.8-8.2 1.8s-.4.1-1.1.2c-.7.2-1.6.5-2.5.9-2 1-3.6 2.4-3.6 4.9H3z"/><path class="s217" d="M19.9 28h0zm.1 0c-.1 0-.1 0 0 0-.1 0-.1 0 0 0h-.3c-2.2-.1-3.9-1.2-5.1-2.7-1.3-1.6-2-3.6-2.6-5.5-1-3.9-1-7.7-1-7.8 0 0 0-.9-.2-2s-.6-2.5-1.2-3.2C9.1 6.3 8.7 6 8 6c-.7 0-1.1.3-1.6.7-.4.5-.7 1.3-.9 2.1C5 10.4 5 12 5 12H3c0-.1-.1-4.1 1.9-6.6C5.6 4.6 6.7 4 8 4s2.4.6 3.1 1.4c.7.8 1.1 1.8 1.4 2.8.5 1.9.5 3.7.5 3.8 0 0 0 2 .4 4.6.4 2.6 1.3 5.6 2.7 7.4 1 1.2 2.2 2 3.8 2 2.6 0 4.1-1.3 5.2-3 1.1-1.7 1.5-3.9 1.7-5.4.2-1 .2-1.6.2-1.6h2c0 .1 0 2.9-1.1 5.8-1 2.9-3.4 6.1-7.8 6.2h.1-.2zm.7-.3c.1-.1.2-.2.2-.3 0 .1-.1.2-.2.3z"/></symbol><symbol id="InsertChartScatterSmoothLinesAndMarkers" viewBox="0 0 32 32"><style>.s218{fill:#1177d7}.s219{fill:#d11c1c}.s220{fill:#ffb115}</style><path class="s218" d="M6 23c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zM28 4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM17 15.1c-1 .3-1.9.4-2.7.6-1.5.2-2.4.3-2.4.3-.1 0-2.2.3-4.4 1.4-1.2.6-2.4 1.4-3.3 2.7.7.1 1.4.4 1.8.9.6-.7 1.4-1.3 2.3-1.7.9-.5 1.8-.7 2.5-.9.7-.2 1.1-.2 1.1-.2s2.5-.2 5.7-1c-.3-.7-.6-1.3-.6-2.1zM28 9c-.5 0-1-.2-1.5-.4-.7 1.9-2.3 3.4-4.2 4.5.4.5.7 1.2.7 1.9 2.4-1.3 4.6-3.3 5.5-6H28zm-8 4c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/><path class="s220" d="M17 26.3c-1-.5-1.8-1.2-2.4-2-1.3-1.6-2-3.6-2.6-5.5-.4-1.3-.6-2.7-.7-3.9.2.1.5.1.7.1.5 0 .9-.1 1.3-.3 0 .3.1.6.1.9.4 2.6 1.2 5.6 2.7 7.4.4.5.9.9 1.4 1.3-.3.5-.5 1.1-.5 1.7v.3zM12.8 9.1c-.1-.4-.2-.9-.4-1.4C11.9 6 10.6 4 8 4c-1.3 0-2.4.6-3.1 1.4C4 6.5 3.6 7.9 3.3 9.1c.2-.1.5-.1.7-.1.5 0 .9.1 1.3.3 0-.2.1-.4.1-.5.2-.8.6-1.5 1-2 .5-.5.9-.8 1.6-.8 1.4 0 2.1 1 2.6 2.3.1.3.2.6.2.9.4-.1.8-.2 1.2-.2.3 0 .5.1.8.1zM28 19c-.5 0-.9-.1-1.3-.3-.3 1.2-.7 2.5-1.4 3.6-.7 1-1.5 1.8-2.6 2.2.1.5.3 1 .3 1.5 0 .2 0 .4-.1.5 2.6-.9 4.2-3.1 5-5.1.3-.9.6-1.7.7-2.4H28zM4 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm8 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm8 14c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm8-10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></symbol><symbol id="InsertChartStackedArea" viewBox="0 0 32 32"><style>.s221{fill:#1177d7}.s222{fill:#d11c1c}.s223{fill:#ffb115}</style><path class="s221" d="M2 28v-6l12-2 16 4v4z"/><path class="s223" d="M2 12l12 4 16-6v14l-16-4-12 2z"/><path class="s222" d="M2 6v6l12 4 16-6V2l-16 8z"/></symbol><symbol id="InsertChartStackedArea3D" viewBox="0 0 32 32"><style>.s224{fill:#1177d7}.s225{fill:#d11c1c}.s226{fill:#ffb115}.s227{opacity:.5}.s228{opacity:.75}</style><g class="s227"><path transform="rotate(-45.001 7 9)" class="s225" d="M4.2 4.8h5.7v8.5H4.2z"/><path transform="rotate(-45.001 21 11)" class="s225" d="M18.2 3.9h5.7V18h-5.7z"/></g><path class="s225" d="M24 24l4-4v-6l-4 4z"/><g class="s228"><path class="s225" d="M14 8l-6 6-6-6v12h6l6-6 10 10v-6z"/><path class="s226" d="M24 28H2v-8h6l6-6 10 10z"/></g><path class="s226" d="M28 24l-4 4v-4l4-4z"/></symbol><symbol id="InsertChartStackedLine" viewBox="0 0 32 32"><style>.s229{fill:#1177d7}.s230{fill:#ffb115}.s231{fill:#d11c1c}</style><path class="s231" d="M1.9 5.9l.9-1.8 11.5 5.8 13.5-7.7 1 1.7-14.5 8.3L1.9 5.9z"/><path class="s230" d="M2 16l.6-1.9L14.3 18 28 14.1l.5 1.9-14.3 4.1L2 16zm0 0z"/><path class="s229" d="M2 28.1l.6 1.9 11.7-3.9L28 30l.5-1.9L14.3 24 2 28.1zm0 0z"/></symbol><symbol id="InsertChartStackedLineWithMarkers" viewBox="0 0 32 32"><style>.s232{fill:#1177d7}.s233{fill:#ffb115}.s234{fill:#d11c1c}</style><path class="s234" d="M29 0c-1.7 0-3 1.3-3 3 0 .2 0 .4.1.5L17 8.7c-.6-.4-1.3-.7-2-.7-.8 0-1.5.3-2.1.8L6 5.4V5c0-1.7-1.3-3-3-3S0 3.4 0 5c0 1.7 1.3 3 3 3 .8 0 1.5-.3 2.1-.8l7 3.5v.4c0 1.7 1.3 3 3 3s3-1.3 3-3c0-.2 0-.4-.1-.5l9.1-5.2c.5.3 1.2.6 1.9.6 1.7 0 3-1.3 3-3 0-1.6-1.3-3-3-3zM3 6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm12 6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm14-8c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1z"/><path class="s233" d="M29 12c-1.6 0-2.9 1.2-3 2.8l-8.6 2.5C16.9 16.5 16 16 15 16s-1.8.5-2.4 1.2L6 15c0-1.7-1.4-3-3-3-1.7 0-3 1.3-3 3s1.3 3 3 3c1 0 1.8-.5 2.4-1.2l6.7 2.2c0 1.6 1.4 2.9 3 2.9s2.9-1.2 3-2.8l8.6-2.5c.4.9 1.3 1.4 2.3 1.4 1.7 0 3-1.3 3-3 0-1.6-1.3-3-3-3zM3 16c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm12 4c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm14-4c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1z"/><path class="s232" d="M29 26c-1.2 0-2.2.7-2.7 1.6l-8.4-1.2c-.2-1.3-1.4-2.4-2.9-2.4-1.3 0-2.4.8-2.8 2H5.8c-.4-1.2-1.5-2-2.8-2-1.7 0-3 1.3-3 3s1.3 3 3 3c1.3 0 2.4-.8 2.8-2h6.4c.4 1.2 1.5 2 2.8 2 1.1 0 2.1-.6 2.6-1.6l8.4 1.2c.3 1.4 1.6 2.4 3 2.4 1.7 0 3-1.3 3-3 0-1.6-1.3-3-3-3zM3 28c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm12 0c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1zm14 2c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1-.4 1-1 1z"/></symbol><symbol id="InsertChartStockCommandGroup" viewBox="0 0 32 32"><style>.s235{fill:#727272}.s236{fill:#d11c1c}</style><path class="s236" d="M8 22H6v6H4v-6H2v-8h2V4h2v10h2v8zM28 8h-2V4h-2v4h-2v14h2v6h2v-6h2V8z"/><path class="s235" d="M16 8V4h-2v4h-2v12h2v8h2v-8h2V8h-2zm0 10h-2v-8h2v8z"/></symbol><symbol id="InsertChartStockHighLowClose" viewBox="0 0 32 32"><style>.s237{fill:#727272}.s238{fill:#d11c1c}</style><path class="s238" d="M4 22h4v2H4v4H2V8h2v14zm16-12V6h-2v20h2V12h4v-2h-4z"/><path class="s237" d="M16 6v2h-4v12h-2V2h2v4h4zm12 8V4h-2v16h2v-4h4v-2h-4z"/></symbol><symbol id="InsertChartStockOpenHighLowClose" viewBox="0 0 32 32"><style>.s239{fill:#727272}.s240{fill:#d11c1c}</style><path class="s240" d="M8 22H6v6H4v-6H2v-8h2V4h2v10h2v8zM28 8h-2V4h-2v4h-2v14h2v6h2v-6h2V8z"/><path class="s239" d="M16 8V4h-2v4h-2v12h2v8h2v-8h2V8h-2zm0 10h-2v-8h2v8z"/></symbol><symbol id="InsertChartStockVolumeHighLowClose" viewBox="0 0 32 32"><style>.s241{fill:#727272}.s242{fill:#d11c1c}.s243{opacity:.5}</style><path class="s243 s241" d="M4 8v22h10V8H4zm8 20H6V10h6v18zm6-14v16h10V14H18zm8 14h-6V16h6v12z"/><path class="s242" d="M10 18h4v2h-4v4H8V4h2v14z"/><path class="s241" d="M28 8v2h-4v12h-2V4h2v4h4z"/></symbol><symbol id="InsertChartStockVolumeOpenHighLowClose" viewBox="0 0 32 32"><style>.s244{fill:#727272}.s245{fill:#d11c1c}.s246{opacity:.5}</style><path class="s246 s244" d="M4 10v20h10V10H4zm8 18H6V12h6v16zm6-22v24h10V6H18zm8 22h-6V8h6v20z"/><path class="s245" d="M12 24h-2v6H8v-6H6v-8h2V2h2v14h2v8z"/><path class="s244" d="M24 12V2h-2v10h-2v12h2v6h2v-6h2V12h-2zm0 10h-2v-8h2v8z"/></symbol></svg>';
})();
(function() {
    var xmlNamespaces = {
        svg: 'http://www.w3.org/2000/svg',
        xlink: 'http://www.w3.org/1999/xlink'
    };

    var SvgStorage = function(spreadsheet) {
        SvgStorage.insertSvg(DevExpress.AspNetCore.Spreadsheet.SvgSpriteContent, spreadsheet.GetMainElement(), '');

        function getDefaultSvgContainer() {
            return spreadsheet.GetMainElement();
        }

        function getDialogSvgContainer() {
            return spreadsheet.getDialogManager().dialogElement;
        }

        function getChartStylesContainerClassName() {
            return 'dxss-chartStyles';
        }

        function replaceSvgElement(svg, containerClassName) {
            var container = getDefaultSvgContainer().getElementsByClassName(getChartStylesContainerClassName)[0];
            if(container) {
                container.innerHTML = '';
                container.appendChild(svg);
            }
            else
                SvgStorage.insertSvgElement(svg, getDefaultSvgContainer(), containerClassName);
        }

        function replaceTablePresets(svgModel) {
            var svg = document.createElementNS(xmlNamespaces.svg, 'svg'),
                rectHeight = 13,
                rectWidth = 17,
                colRowCount = 5;

            svgModel.forEach(function(rectInfo) {
                var symbol = svg.appendChild(document.createElementNS(xmlNamespaces.svg, 'symbol'));
                symbol.id = spreadsheet.name + '_ts' + rectInfo.Id;
                symbol.setAttribute('viewBox', '0 0 86 66');
                var g = symbol.appendChild(SvgStorage.createG());
                for(var col = 0; col < colRowCount; col++) {
                    for(var row = 0; row < colRowCount; row++) {
                        g.appendChild(SvgStorage.createRect(col * rectWidth, row * rectHeight, rectWidth, rectHeight, rectInfo.RectColors[col * colRowCount + row]));

                        var color = rectInfo.Lines[col * colRowCount + row];
                        if(color.l) {
                            g.appendChild(SvgStorage.createPath('M' + col * rectWidth + ' ' + row * rectHeight +
                                ' l' + 0 + ' ' + rectHeight, color.l));
                        }
                        if(color.t) {
                            g.appendChild(SvgStorage.createPath('M' + col * rectWidth + ' ' + row * rectHeight +
                                ' l' + rectWidth + ' ' + 0, color.t));
                        }
                        if(color.r) {
                            g.appendChild(SvgStorage.createPath('M' + (col * rectWidth + rectWidth) + ' ' + row * rectHeight +
                                ' l' + 0 + ' ' + rectHeight, color.r));
                        }
                        if(color.b) {
                            g.appendChild(SvgStorage.createPath('M' + col * rectWidth + ' ' + (row * rectHeight + rectHeight) +
                                ' l' + rectWidth + ' ' + 0, color.b));
                        }
                        if(color.e) {
                            var delta = 3;
                            g.appendChild(SvgStorage.createPath('M' + (col * rectWidth + delta) + ' ' + (row * rectHeight + Math.floor(rectHeight / 2)) +
                                ' l' + (rectWidth - 2 * delta) + ' ' + 0, color.e));
                        }
                    }
                }
            });
            replaceSvgElement(svg, 'dx-ss-tableTypes');
        }

        function insertChartStyles(svg) {
            SvgStorage.insertSvg(svg, getDialogSvgContainer(), getChartStylesContainerClassName());
        }

        function removeChartStyles() {
            var container = getDefaultSvgContainer().getElementsByClassName(getChartStylesContainerClassName())[0];
            if(container) 
                container.parentNode.removeChild(container);
        }

        function parseSvgSymbolsSet(svgSpriteContent) {
            var regex = /<symbol[\w\s]+id="(\w+)"[^>]*>(.|\s)+?<\/symbol>/gi;
            var match = regex.exec(svgSpriteContent);
            var svgElements = [];
            while(match !== null) {
                svgElements.push(createSvgFromXml(match[0]));
                match = regex.exec(svgSpriteContent);
            }
            return svgElements;
        }

        function createSvgFromXml(xmlContent) {
            xmlContent = prepareSvgImageXml(xmlContent);
            var viewBoxSize = getViewBoxSizeFromXml(xmlContent);

            var mockContainer = document.createElement('div');
            mockContainer.insertAdjacentHTML('afterbegin', xmlContent);
            var svgElement = mockContainer.firstChild;

            //Required for IE only
            svgElement.style.width = viewBoxSize.width + 'px';
            svgElement.style.height = viewBoxSize.height + 'px';
            return svgElement;
        }

        function prepareSvgImageXml(xmlContent) {
            xmlContent = xmlContent.replace('symbol', 'svg');
            xmlContent = xmlContent.replace('<svg', '<svg xmlns="http://www.w3.org/2000/svg"');
            return xmlContent;
        }

        function getViewBoxSizeFromXml(xmlContent) {
            var imageSizeRegex = /viewBox="([0-9]+)\s([0-9]+)\s([0-9]+)\s([0-9]+)"/gi;
            var viewBoxDimensions = imageSizeRegex.exec(xmlContent);
            return {
                width: viewBoxDimensions[3],
                height: viewBoxDimensions[4]
            };
        }

        return {
            replaceTablePresets: replaceTablePresets,
            insertChartStyles: insertChartStyles,
            removeChartStyles: removeChartStyles,
            parseSvgSymbolsSet: parseSvgSymbolsSet
        };
    };

    SvgStorage.createG = function() {
        var g = document.createElementNS(xmlNamespaces.svg, 'g');
        g.setAttributeNS(null, 'transform', 'translate(0.5,0.5)');
        return g;
    };

    SvgStorage.createRect = function(x, y, width, height, color) {
        var rect = document.createElementNS(xmlNamespaces.svg, 'rect');
        rect.setAttributeNS(null, 'fill', color);
        rect.setAttributeNS(null, 'x', x);
        rect.setAttributeNS(null, 'y', y);
        rect.setAttributeNS(null, 'width', width);
        rect.setAttributeNS(null, 'height', height);
        return rect;
    };

    SvgStorage.createPath = function(d, color) {
        var path = document.createElementNS(xmlNamespaces.svg, 'path');
        path.setAttributeNS(null, 'stroke', color);
        path.setAttributeNS(null, 'd', d);
        return path;
    };

    SvgStorage.createStorageContainer = function(className) {
        var storageContainer = document.createElement('div');
        storageContainer.className = 'dxss-svg-container';
        if(className)
            ASPx.AddClassNameToElement(storageContainer.className);
        return storageContainer;
    };

    SvgStorage.insertSvgElement = function(svg, container, className) {
        var resourcesDiv = SvgStorage.createStorageContainer(className);
        resourcesDiv.appendChild(svg);
        container.appendChild(resourcesDiv);
        return resourcesDiv;
    };

    SvgStorage.insertSvg = function(svg, container, className) {
        var resourcesDiv = SvgStorage.createStorageContainer(className);
        resourcesDiv.insertAdjacentHTML('afterbegin', svg);
        container.appendChild(resourcesDiv);
        return resourcesDiv;
    };

    SvgStorage.createSvgItem = function(itemId) {
        var svgElement = document.createElementNS(xmlNamespaces.svg, 'svg'),
            useElement = document.createElementNS(xmlNamespaces.svg, 'use');
        useElement.setAttributeNS(xmlNamespaces.xlink, 'href', '#' + itemId);
        svgElement.appendChild(useElement);
        return svgElement;
    };

    SvgStorage.updateSvgItemLink = function(svgElement, newItemId) {
        var useElement = svgElement.firstElementChild;
        useElement.setAttributeNS(xmlNamespaces.xlink, 'href', '#' + newItemId);
    };

    DevExpress.AspNetCore.Spreadsheet.SvgStorage = SvgStorage;
})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.PopupMenuHelper = ASPx.CreateClass(ASPxClientSpreadsheet.PopupMenuHelper, {
        constructor: function(spreadsheetControl) {
            this.constructor.prototype.constructor.call(this, spreadsheetControl);

            // Disable unsupported features
            for(var i = 0; i < this.menuItems.length; i++) {
                if(DevExpress.AspNetCore.Spreadsheet.CommandHelper.isCommandDisabled(this.menuItems[i].name)) {
                    this.menuItems.splice(i, 1);
                    i--;
                }
            }
            
            this.preparePopupMenu = function(popupMenu, items, context, spreadsheetControl, menuType) {
                var menuItemCollection = new DevExpress.AspNetCore.Spreadsheet.PopupMenuItemCollection(null, this.populateItems(items, context));
                this.applyEnabledState(menuItemCollection, context);

                menuType = typeof menuType !== 'undefined' ? menuType : context.MenuType;
                var cancel = this.spreadsheetControl.RaisePopupMenuShowing(menuItemCollection, menuType);
                popupMenu.clearItems();

                if(!cancel) {
                    this.prepareMenuItems(menuItemCollection);
                    popupMenu.createItems(menuItemCollection);
                }
            };

            this.prepareMenuItems = function(items) {
            };

            this.applyEnabledState = function(menuItemCollection, context) {
                var count = menuItemCollection.length;
                while(count--) {
                    var item = menuItemCollection[count];
                    item.disabled = !this.isItemEnabled(item, context);
                }
            };

            this.initializeItem = function(item) {
                item.text = this.getLocalizedString(item.textID);
                if(item.imageName)
                    item.icon = ' dxss-icon-' + item.imageName;

                if(item.items)
                    this.initializeItemsCore(item.items);
            };

            this.getAutoFilterPopupMenu = function() {
                return this.getPopupMenu();
            };

            this.showAutoFilterMenu = function(context, autoFilterImage) {
                var popupMenu = this.getPopupMenu();

                this.prepareClearFilterMenuItem(this.menuItems, context);
                this.preparePopupMenu(popupMenu, this.menuItems, context, this.spreadsheetControl);
                popupMenu.ShowAtElement(autoFilterImage);
            };

            this.prepareClearFilterMenuItem = function(items, context) {
                var clearFilterCommandId = ASPxClientSpreadsheet.ServerCommands.getCommandIDByName('DataFilterColumnClear').id,
                    clearFilterMenuItem = this.getItemByName(items, clearFilterCommandId);
                if(clearFilterMenuItem) {
                    clearFilterMenuItem.text = this.prepareClearFilterText(this.getLocalizedString(clearFilterMenuItem.textID), context.columnCaption);
                    clearFilterMenuItem.disabled = !context.isFilterApplied;
                }
            };

            this.getItemByName = function(items, name) {
                if(!items) return null;
                var i;
                name = String(name);
                for(i = 0; i < items.length; i++)
                    if(String(items[i].name) === name) return items[i];
                for(i = 0; i < items.length; i++) {
                    var item = this.getItemByName(items[i].items, name);
                    if(item) return item;
                }
                return null;
            };
        }
    });
})();
(function() {
    DevExpress.AspNetCore.Spreadsheet.PopupMenu = ASPx.CreateClass(null, {
        constructor: function(ownerControl) {
            this.ownerControl = ownerControl;
            this.targetElement = this.ownerControl.GetMainElement().appendChild(document.createElement('div'));
            this.targetElement.style.position = 'absolute';
            this.popupMenu = new DevExpress.ui.dxContextMenu(this.targetElement, {
                target: this.targetElement,
                onItemClick: function(e) {
                    this.ownerControl.onPopupMenuClick(null, e.itemData);
                }.aspxBind(this)
            });
        },
        clearItems: function() {
            this.popupMenu.option('items', undefined);
        },
        createItems: function(menuItemCollection) {
            this.popupMenu.option('items', menuItemCollection);
        },
        // ASPxClientPopupMenu compatibility
        ShowAtPos: function(x, y) {
            ASPx.SetAbsoluteX(this.targetElement, x);
            ASPx.SetAbsoluteY(this.targetElement, y);
            this.popupMenu.show();
        },
        ShowAtElement: function(element) {
            var rect = element.getBoundingClientRect();
            this.ShowAtPos(rect.left, rect.bottom);
        },
        setExtendedValue: function(value) {
            this.extendedValue = value;
        },
        getExtendedValue: function() {
            return this.extendedValue;
        },
        clearClientCache: function() {
            this.extendedValue = undefined;
        }
    });
})();
var DevExpress="object"==typeof DevExpress?DevExpress:{};DevExpress.AspNetCore=DevExpress.AspNetCore||{},DevExpress.AspNetCore.Spreadsheet=DevExpress.AspNetCore.Spreadsheet||{},DevExpress.AspNetCore.Spreadsheet.dxribbon=function(o){var n={};function r(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return o[t].call(e.exports,e,e.exports,r),e.l=!0,e.exports}return r.m=o,r.c=n,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=5)}([function(t,e,o){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.createTemplate=function(){return{location:"before",locateInMenu:"auto"}},t.prototype.getCssClass=function(){return"dx-ribbon-item"},t}(),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.getOnFocusOut=function(){return function(t){return t.component.close()}},e.prototype.getOnKeyDown=function(){return function(t){9===t.event.keyCode&&t.event.preventDefault()}},e}(e.ToolbarItemTemplateCreator=i);e.ToolbarDropDownItemTemplateCreator=a},function(t,e,o){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(n){function t(t,e){var o=n.call(this)||this;return o.options=t,o.onCommandExecuted=e,o.name=t.name,o}return r(t,n),t.prototype.setEnabled=function(t){this.widget.option("disabled",!t)},t.prototype.setVisible=function(t){this.widget.option("visible",t)},t.prototype.getOnInitializedHandler=function(){var e=this;return function(t){return e.widget=t.component}},t}(o(3).ToolbarItemBase);e.ToolbarInteractiveItem=i},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function e(){}return e.correctIconName=function(t){return 0==t.indexOf("dx")?" "+t:t},e.correctItemsIcons=function(t){t&&t.forEach(function(t){t.icon=t.icon?e.correctIconName(t.icon):void 0,e.correctItemsIcons(t.items)})},e}();e.DxtUtils=n},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return Object.defineProperty(t.prototype,"toolbarItemTemplateCreator",{get:function(){return this._toolbarItemTemplateCreator||(this._toolbarItemTemplateCreator=this.getBuildTemplateStrategy()),this._toolbarItemTemplateCreator},enumerable:!0,configurable:!0}),t.prototype.createToolbarItemTemplate=function(){return this.toolbarItemTemplateCreator.createTemplate()},t}();e.ToolbarItemBase=n},function(t,e,o){"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),(n=e.DxtThemeCssClasses||(e.DxtThemeCssClasses={})).AccentAsBackgroundColor="dx-theme-accent-as-background-color",n.AccentAsBorderColor="dx-theme-accent-as-border-color",n.AccentAsTextColor="dx-theme-accent-as-text-color",n.BackgroundColor="dx-theme-background-color",n.BackgroundColorAsBorderColor="dx-theme-background-color-as-border-color",n.BackgroundColorAsTextColor="dx-theme-background-color-as-text-color",n.BorderColor="dx-theme-border-color",n.BorderColorAsBackgroundColor="dx-theme-border-color-as-background-color",n.BorderColorAsTextColor="dx-theme-border-color-as-text-color ",n.TextColor="dx-theme-text-color",n.TextColorAsBackgroundColor="dx-theme-text-color-as-background-color",n.TextColorAsBorderColor="dx-theme-text-color-as-border-color"},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(6);e.Ribbon=n.Ribbon;var r=o(4);e.DxtThemeCssClasses=r.DxtThemeCssClasses},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=o(7),i=o(9),a=o(11),s=o(13),u=o(16),c=o(18),p=o(20),n=function(){function t(t){this.options=t,this.toolbars=[],this.toolBarItemsByName={},this.contextItemIndexesByCategoryName={}}return t.prototype.render=function(){var o=this;this.tabPanel=new DevExpress.ui.dxTabPanel(this.options.element,{dataSource:this.getRibbonItems().map(function(t,e){return{title:t.title,visible:t.visible,template:function(){return o.createToolbar(t.items,e)}}}),deferRendering:!1,elementAttr:{class:"dx-ribbon "+DevExpress.ui.themes.current()},focusStateEnabled:!1,selectedIndex:this.options.activeTabIndex,loop:!1,animationEnabled:!1,swipeEnabled:!1,showNavButtons:!0,onTitleClick:this.options.onTitleClickHandler,onSelectionChanged:this.options.onSelectionChangedHandler})},t.prototype.getActiveTabIndex=function(){return this.tabPanel.option("selectedIndex")},t.prototype.setActiveTabIndex=function(t){this.tabPanel.option("selectedIndex",t)},t.prototype.setItemVisible=function(t,e){return this.tabPanel.option("items["+t+"].visible",e)},t.prototype.getItemVisible=function(t){return this.tabPanel.option("items["+t+"].visible")},t.prototype.setContextItemsCategoryVisible=function(t,e){var o=this,n=this.getContextItemsIndexes(t);if(n){var r=!1,i=this.getActiveTabIndex();n.forEach(function(t){o.getItemVisible(t)!==e&&(i!=t||e||(r=!0),o.setItemVisible(t,e))}),r&&this.setActiveTabIndex(this.options.activeTabIndex)}},t.prototype.getContextItemsCategoryVisible=function(t){var e=this.getContextItemsIndexes(t);return!(!e||!e.length)&&this.getItemVisible(e[0])},t.prototype.getContextItemsIndexes=function(t){return this.contextItemIndexesByCategoryName[t]},t.prototype.getTabPanel=function(){return this.tabPanel},t.prototype.getItems=function(t){return t&&this.toolBarItemsByName[t]?this.toolBarItemsByName[t]:null},t.prototype.adjustControl=function(){this.tabPanel._dimensionChanged(),this.toolbars.forEach(function(t){return t._dimensionChanged()})},t.prototype.getRibbonItems=function(){var n=this,r=[].concat(this.options.items);return this.options.contextItemsCategories&&this.options.contextItemsCategories.forEach(function(o){n.contextItemIndexesByCategoryName[o.name]||(n.contextItemIndexesByCategoryName[o.name]=[]),o.items.forEach(function(t,e){n.contextItemIndexesByCategoryName[o.name].push(e+r.length)}),r=r.concat(o.items.map(function(t){return{items:t.items,title:t.title,visible:!1}}))}),r},t.prototype.createToolbar=function(t,e){var o=this,n=document.createElement("div"),r={dataSource:this.getToolbarItemTemplates(t,e),onInitialized:function(t){return o.toolbars.push(t.component)},onItemRendered:function(t){t.itemData.dxIsSeparator&&p.ToolbarSeparatorItem.prepareElement(t.itemElement)},templatesRenderAsynchronously:!0};return new DevExpress.ui.dxToolbar(n,r),n},t.prototype.getToolbarItemTemplates=function(t,e){var o=this,n=[];t.forEach(function(t){n=n.concat(o.getToolbarItems(t,e))});var r,i=[];return n.forEach(function(t){t instanceof p.ToolbarSeparatorItem&&(!r||r instanceof p.ToolbarSeparatorItem)||(i.push(t.createToolbarItemTemplate()),r=t)}),i},t.prototype.getToolbarItems=function(t,e){var o=[],n="ColorBox"===t.type||"NumberBox"===t.type||"SelectBox"===t.type;return(t.beginGroup||n)&&o.push(new p.ToolbarSeparatorItem),o.push(this.interactiveToolbarItemFactory(t,e)),n&&o.push(new p.ToolbarSeparatorItem),o},t.prototype.interactiveToolbarItemFactory=function(e,o){var t,n=this;switch(e.type){case"Button":t=new i.ToolbarButtonItem(e,this.options.onCommandExecuted);break;case"ButtonGroup":t=new r.ToolbarButtonGroupItem(e,this.options.onCommandExecuted);break;case"Menu":t=new s.ToolbarMenuItem(e,this.options.onCommandExecuted,function(t){n.addItemToCache(t.name,t),n.raiseOnOnToolbarItemCreated(e,t,o)});break;case"NumberBox":t=new u.ToolbarNumberBoxItem(e,this.options.onCommandExecuted);break;case"ColorBox":t=new a.ToolbarColorBoxItem(e,this.options.onCommandExecuted);break;default:t=new c.ToolbarSelectBoxItem(e,this.options.onCommandExecuted)}return this.addItemToCache(e.name,t),this.raiseOnOnToolbarItemCreated(e,t,o),t},t.prototype.addItemToCache=function(t,e){t&&(this.toolBarItemsByName[t]||(this.toolBarItemsByName[t]=[]),this.toolBarItemsByName[t].push(e))},t.prototype.raiseOnOnToolbarItemCreated=function(t,e,o){this.options.onOnToolbarItemCreated&&this.options.onOnToolbarItemCreated({options:t,item:e,tabIndex:o})},t}();e.Ribbon=n},function(t,e,o){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=o(1),a=o(8),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.getBuildTemplateStrategy=function(){return new a.ButtonGroupToolbarItemTemplateCreator({itemOptions:this.options,onInitialized:this.getOnInitializedHandler(),onClick:this.getOnClickHandler()})},e.prototype.setValue=function(t){},e.prototype.getOnClickHandler=function(){var t=this;return this.onCommandExecuted?function(){t.onCommandExecuted({item:t,parameter:null})}:void 0},e.ToggleStateClassName="dx-r-toggle",e.ToggleButtonDataProperty="dx-ri-value",e}(i.ToolbarInteractiveItem);e.ToolbarButtonGroupItem=s},function(t,e,o){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=o(2),a=function(o){function t(t){var e=o.call(this)||this;return e.options=t,e}return r(t,o),t.prototype.createTemplate=function(){var t=o.prototype.createTemplate.call(this);return t.widget="dxButtonGroup",t.showText=this.options.itemOptions.items[0]&&this.options.itemOptions.items[0].icon&&!this.options.itemOptions.alwaysShowText?"inMenu":"always",t.options=this.getButtonGroupOptions(),t},t.prototype.getButtonGroupOptions=function(){return{focusStateEnabled:!1,onInitialized:this.options.onInitialized,items:this.options.itemOptions.items.map(function(t){var e=t;return e.icon=e.icon?i.DxtUtils.correctIconName(e.icon):e.icon,e})}},t}(o(0).ToolbarItemTemplateCreator);e.ButtonGroupToolbarItemTemplateCreator=a},function(t,e,o){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=o(1),a=o(10),s=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return r(o,t),o.prototype.getBuildTemplateStrategy=function(){return new a.ButtonToolbarItemTemplateCreator({itemOptions:this.options,onInitialized:this.getOnInitializedHandler(),onClick:this.getOnClickHandler()})},o.prototype.setValue=function(t){if(this.options.isToggleMode){var e=this.getElement();(e[o.ToggleButtonDataProperty]=t)?(e.classList.add(o.ToggleStateClassName),e.classList.add(o.ButtonGroupItemClassName),e.classList.add(o.ItemSelectedClassName)):(e.classList.remove(o.ToggleStateClassName),e.classList.remove(o.ButtonGroupItemClassName),e.classList.remove(o.ItemSelectedClassName))}},o.prototype.getValue=function(){return this.options.isToggleMode?this.getElement()[o.ToggleButtonDataProperty]:null},o.prototype.getElement=function(){return this.widget.element().classList?this.widget.element():this.widget.element()[0]},o.prototype.getOnClickHandler=function(){var t=this;return this.onCommandExecuted?function(){t.setValue(!t.getValue()),t.onCommandExecuted({item:t,parameter:t.getValue()})}:void 0},o.ToggleStateClassName="dx-r-toggle",o.ButtonGroupItemClassName="dx-buttongroup-item",o.ItemSelectedClassName="dx-item-selected",o.ToggleButtonDataProperty="dx-ri-value",o}(i.ToolbarInteractiveItem);e.ToolbarButtonItem=s},function(t,e,o){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=o(2),a=function(o){function t(t){var e=o.call(this)||this;return e.options=t,e}return r(t,o),t.prototype.createTemplate=function(){var t=o.prototype.createTemplate.call(this);return t.widget="dxButton",t.showText=!this.options.itemOptions.icon||this.options.itemOptions.alwaysShowText?"always":"inMenu",t.options=this.getButtonOptions(),t},t.prototype.getButtonOptions=function(){return{text:this.options.itemOptions.text,icon:this.options.itemOptions.icon?i.DxtUtils.correctIconName(this.options.itemOptions.icon):void 0,hint:this.options.itemOptions.text,stylingMode:"text",focusStateEnabled:!1,onInitialized:this.options.onInitialized,onClick:this.options.onClick}},t}(o(0).ToolbarItemTemplateCreator);e.ButtonToolbarItemTemplateCreator=a},function(t,e,o){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=o(1),a=o(12),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.getBuildTemplateStrategy=function(){return new a.ColorBoxToolbarItemTemplateCreator({itemOptions:this.options,onInitialized:this.getOnInitializedHandler(),onValueChanged:this.getOnValueChangedHandler()})},e.prototype.setValue=function(t){this.widget.option("value",t)},e.prototype.getOnValueChangedHandler=function(){var e=this;return this.onCommandExecuted?function(t){e.onCommandExecuted({item:e,parameter:t.value})}:void 0},e}(i.ToolbarInteractiveItem);e.ToolbarColorBoxItem=s},function(t,e,o){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(o){function t(t){var e=o.call(this)||this;return e.options=t,e}return r(t,o),t.prototype.createTemplate=function(){var t=o.prototype.createTemplate.call(this);return t.widget="dxColorBox",t.options=this.getWidgetOptions(),t},t.prototype.getWidgetOptions=function(){var o=this;return{placeholder:"",focusStateEnabled:!1,mask:" ",stylingMode:"filled",hint:this.options.itemOptions.text,value:this.options.itemOptions.value,width:70,onValueChanged:this.options.onValueChanged,onInitialized:this.options.onInitialized,onContentReady:function(t){var e=t.element.querySelector?t.element:t.element[0];e.querySelector(".dx-colorbox-color-result-preview").addEventListener("click",function(){o.options.onValueChanged({component:t.component,element:e,model:t.model,value:t.component.option("value")})})},elementAttr:{class:this.getCssClass()}}},t}(o(0).ToolbarItemTemplateCreator);e.ColorBoxToolbarItemTemplateCreator=i},function(t,e,o){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var r=o(1),a=o(14),s=o(15),u=function(r){function t(t,e,o){var n=r.call(this,t,e)||this;return n.onSubMenuItemCreated=o,n.items={},n.createSubMenuItems(t.items),n}return i(t,r),t.prototype.getWidget=function(){return this.widget},t.prototype.getOptions=function(){return this.options},t.prototype.createSubMenuItems=function(t){var o=this;t&&t.forEach(function(t){var e=new s.ToolbarSubMenuItem(t.name,o);o.onSubMenuItemCreated(e),t.name&&(o.items[t.name]=e),o.createSubMenuItems(t.items)})},t.prototype.getBuildTemplateStrategy=function(){return new a.MenuToolbarItemTemplateCreator({itemOptions:this.options,onInitialized:this.getOnInitializedHandler(),onItemRendered:this.getOnItemRenderedHandler(),onItemClick:this.getOnItemClickHandler()})},t.prototype.setValue=function(t){throw new Error("the setValue method is not implemented for the ToolbarMenuItem item")},t.prototype.getOnItemClickHandler=function(){var o=this;return this.onCommandExecuted?function(t){o.closeSubMenuIfRequired(t.component,t.itemData,t.itemElement);var e=t.itemData.name?o.items[t.itemData.name]:void 0;e&&o.onCommandExecuted({item:e,parameter:null})}:void 0},t.prototype.closeSubMenuIfRequired=function(t,e,o){e.isRootElement&&t._visibleSubmenu&&window.setTimeout(function(){return t.unselectItem(o[0]||o)},0)},t.prototype.getOnItemRenderedHandler=function(){var r=this;return function(t){var e=t.itemData.name;if(e){var o=r.items[e],n=t.itemElement[0]?t.itemElement[0]:t.itemElement;o.setElement(n)}}},t}(r.ToolbarInteractiveItem);e.ToolbarMenuItem=u},function(t,e,o){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=o(2),a=function(o){function n(t){var e=o.call(this)||this;return e.options=t,e}return r(n,o),n.prototype.createTemplate=function(){var t=o.prototype.createTemplate.call(this);return t.widget="dxMenu",t.options=this.getMenuOptions(),t},n.prototype.getMenuOptions=function(){var e=this;return i.DxtUtils.correctItemsIcons(this.options.itemOptions.items),{hideSubmenuOnMouseLeave:!0,focusStateEnabled:!1,selectByClick:!1,hint:this.options.itemOptions.text,dataSource:[{icon:this.options.itemOptions.icon?i.DxtUtils.correctIconName(this.options.itemOptions.icon):void 0,text:this.options.itemOptions.text,isRootElement:!0,items:this.options.itemOptions.items.map(function(t){return{beginGroup:t.beginGroup,name:t.name,text:t.text,icon:t.icon,items:t.items}})}],onInitialized:this.options.onInitialized,onItemRendered:this.options.onItemRendered,onItemClick:this.options.onItemClick,elementAttr:{class:this.getCssClass()},onContentReady:function(t){e.options.itemOptions.icon&&!e.options.itemOptions.alwaysShowText&&(t.element.classList?t.element:t.element[0]).classList.add(n.ShowTextInMenuClassName)}}},n.ShowTextInMenuClassName="dx-showTextInMenu",n}(o(0).ToolbarItemTemplateCreator);e.MenuToolbarItemTemplateCreator=a},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function o(t,e){this.name=t,this.menuItem=e}return o.prototype.setValue=function(t){"boolean"==typeof t&&(this.element?this.setValueCore(this.element,t):this.selected=t)},o.prototype.setElement=function(t){this.element=t,void 0!==this.selected&&(this.setValue(this.selected),this.selected=void 0)},o.prototype.setEnabled=function(t){this.setDataOption("disabled",!t)},o.prototype.setVisible=function(t){this.setDataOption("visible",t)},o.prototype.setValueCore=function(t,e){e?t.classList.add(o.SelectedItemClassName):t.classList.remove(o.SelectedItemClassName)},o.prototype.setDataOption=function(t,e){var o=this,n=this.getDataOptionName();n&&setTimeout(function(){return o.menuItem.getWidget().option(n+"."+t,e)},0)},o.prototype.getDataOptionName=function(){return void 0===this.dataOptionName&&(this.dataOptionName=this.getDataOptionNameCore(this.menuItem.getOptions().items,"items[0]")),this.dataOptionName},o.prototype.getDataOptionNameCore=function(t,e){var o=this;if(!t)return null;var n=t.filter(function(t){return t.name==o.name})[0];if(n)return e+".items["+t.indexOf(n)+"]";for(var r=0;r<t.length;r++){var i=this.getDataOptionNameCore(t[r].items,e+".items["+r+"]");if(i)return i}return null},o.SelectedItemClassName="dx-menu-item-selected",o}();e.ToolbarSubMenuItem=n},function(t,e,o){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=o(1),a=o(17),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.getBuildTemplateStrategy=function(){return new a.NumberBoxToolbarItemTemplateCreator({itemOptions:this.options,onInitialized:this.getOnInitializedHandler(),onValueChanged:this.getOnValueChangedHandler()})},e.prototype.setValue=function(t){this.widget.option("value",t)},e.prototype.getOnValueChangedHandler=function(){var e=this;return this.onCommandExecuted?function(t){t.event&&e.onCommandExecuted({item:e,parameter:t.value})}:void 0},e}(i.ToolbarInteractiveItem);e.ToolbarNumberBoxItem=s},function(t,e,o){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(o){function t(t){var e=o.call(this)||this;return e.options=t,e}return r(t,o),t.prototype.createTemplate=function(){var t=o.prototype.createTemplate.call(this);return t.widget="dxNumberBox",t.options=this.getWidgetOptions(),t},t.prototype.getWidgetOptions=function(){return{placeholder:"",focusStateEnabled:!1,hint:this.options.itemOptions.text,stylingMode:"filled",format:this.options.itemOptions.text+": 0.#",width:this.options.itemOptions.width,showSpinButtons:!0,min:this.options.itemOptions.min,max:this.options.itemOptions.max,step:this.options.itemOptions.step,onValueChanged:this.options.onValueChanged,onInitialized:this.options.onInitialized,elementAttr:{class:this.getCssClass()}}},t}(o(0).ToolbarItemTemplateCreator);e.NumberBoxToolbarItemTemplateCreator=i},function(t,e,o){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=o(1),a=o(19),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.getBuildTemplateStrategy=function(){return new a.SelectBoxToolbarItemTemplateCreator({itemOptions:this.options,onInitialized:this.getOnInitializedHandler(),onValueChanged:this.getOnValueChangedHandler()})},e.prototype.setValue=function(t){this.widget.option("value",t)},e.prototype.getOnValueChangedHandler=function(){var e=this;return this.onCommandExecuted?function(t){t.event&&e.onCommandExecuted({item:e,parameter:t.value})}:void 0},e}(i.ToolbarInteractiveItem);e.ToolbarSelectBoxItem=s},function(t,e,o){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=function(o){function t(t){var e=o.call(this)||this;return e.options=t,e}return r(t,o),t.prototype.createTemplate=function(){var t=o.prototype.createTemplate.call(this);return t.widget="dxSelectBox",t.options=this.getWidgetOptions(),t},t.prototype.getWidgetOptions=function(){return{placeholder:"",stylingMode:"filled",searchEnabled:!0,dataSource:this.options.itemOptions.dataSource,width:this.options.itemOptions.width,displayExpr:this.options.itemOptions.displayExpr,valueExpr:this.options.itemOptions.valueExpr,onValueChanged:this.options.onValueChanged,onInitialized:this.options.onInitialized,onFocusOut:o.prototype.getOnFocusOut.call(this),onKeyDown:o.prototype.getOnKeyDown.call(this),elementAttr:{class:this.getCssClass()}}},t}(o(0).ToolbarDropDownItemTemplateCreator);e.SelectBoxToolbarItemTemplateCreator=i},function(t,e,o){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=o(3),a=o(21),s=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),n.prepareElement=function(t){var e=t.classList?t:t[0];if(e){var o=e.querySelector(".dx-toolbar-item-content");o&&o.classList.add(n.SeparatorContainerClassName)}},n.prototype.getBuildTemplateStrategy=function(){return new a.SeparatorToolbarItemTemplateCreator},n.SeparatorContainerClassName="dx-r-separator-container",n}(i.ToolbarItemBase);e.ToolbarSeparatorItem=s},function(t,e,o){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=o(4),a=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return r(o,e),o.prototype.createTemplate=function(){var t=e.prototype.createTemplate.call(this);return t.disabled=!0,t.dxIsSeparator=!0,t.template=function(){var t=document.createElement("div");return t.classList.add(o.SeparatorClassName),t.classList.add(i.DxtThemeCssClasses.BorderColor),t},t},o.SeparatorClassName="dx-r-separator",o}(o(0).ToolbarItemTemplateCreator);e.SeparatorToolbarItemTemplateCreator=a}]);